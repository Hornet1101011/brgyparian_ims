{"version":3,"file":"static/js/351.005191c1.chunk.js","mappings":"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","sources":["pages/inbox-filters.tsx","pages/inbox.tsx","components/TemplatesManager.tsx","pages/staffInbox.tsx","contexts/AuthContext.tsx","components/AvatarImage.tsx","components/AppLayout.tsx","components/Layout.tsx","components/PrivateRoute.tsx","components/StaffRoute.tsx","components/AdminRoute.tsx","utils/officials.ts","components/StatsPanel.tsx","components/LoginForm.tsx","components/RegisterForm.tsx","components/Dashboard.tsx","components/GuestDashboard.tsx","components/StaffDashboard.tsx","services/notificationSocket.ts","components/admin/AdminDashboard.tsx","components/admin/UserManagement.tsx","components/admin/ActivityLogs.tsx","components/admin/Statistics.tsx","components/TestEmailModal.tsx","config/defaultSystemSettings.ts","components/admin/SystemSettings.tsx","components/DocumentRequestForm.tsx","components/InquiryForm.tsx","components/Goodbye.tsx","components/Logout.tsx","pages/InquiryTracker.tsx","components/ResidentCreateModal.tsx","components/ResidentPortal.tsx","components/LandingPage.tsx","pages/ForgotPassword.tsx","pages/ResetPassword.tsx","components/admin/MessageInbox.tsx","components/DocumentHistory.tsx","components/admin/Announcements.tsx","components/AnnouncementsList.tsx","components/admin/VerificationRequests.tsx","theme.ts","App.tsx","services/localDatabase.ts","services/syncService.ts","services/api.ts","utils/formatDate.ts","components/DocumentProcessing.tsx","services/generateFilledDocx.ts"],"sourcesContent":["import React from 'react';\r\nimport { Input, Select, Space } from 'antd';\r\n\r\nconst { Option } = Select;\r\n\r\nexport type FilterState = {\r\n  status: 'all' | 'pending' | 'responded' | 'closed';\r\n  search: string;\r\n};\r\n\r\nexport const defaultFilterState: FilterState = {\r\n  status: 'all',\r\n  search: '',\r\n};\r\n\r\nexport const InboxFilters: React.FC<{\r\n  filter: FilterState;\r\n  setFilter: (f: FilterState) => void;\r\n}> = ({ filter, setFilter }) => (\r\n  <Space style={{ marginBottom: 24, width: '100%' }} direction=\"horizontal\" size={16}>\r\n    <Select\r\n      value={filter.status}\r\n      style={{ width: 160 }}\r\n      onChange={status => setFilter({ ...filter, status })}\r\n    >\r\n      <Option value=\"all\">All</Option>\r\n      <Option value=\"pending\"> Pending</Option>\r\n      <Option value=\"responded\"> Responded</Option>\r\n      <Option value=\"closed\"> Closed</Option>\r\n    </Select>\r\n    <Input.Search\r\n      allowClear\r\n      placeholder=\"Search by date, name, or category\"\r\n      style={{ width: 320 }}\r\n      value={filter.search}\r\n      onChange={e => setFilter({ ...filter, search: e.target.value })}\r\n    />\r\n  </Space>\r\n);\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { Layout, Card, List, Typography, Spin, Empty, message as antdMessage, Divider, Avatar, Row, Col, Space, Badge, Select, Input, Collapse, Button, Tag, Upload, Popconfirm, Result, Skeleton, Tooltip } from 'antd';\r\nimport { EyeOutlined, EyeInvisibleOutlined, DeleteOutlined, DownloadOutlined, InboxOutlined, SendOutlined, MenuFoldOutlined, MenuUnfoldOutlined } from '@ant-design/icons';\r\nimport styles from './inbox.module.css';\r\nimport { InboxFilters, defaultFilterState, FilterState } from './inbox-filters';\r\nimport { contactAPI } from '../services/api';\r\n\r\nconst Inbox: React.FC = () => {\r\n  const [loading, setLoading] = useState(true);\r\n  const [inquiries, setInquiries] = useState<any[]>([]);\r\n  const [filter, setFilter] = useState<FilterState>(defaultFilterState);\r\n  const [category, setCategory] = useState<string>('All');\r\n  const [reply, setReply] = useState<{ [id: string]: string }>({});\r\n  const [replyLoading, setReplyLoading] = useState<{ [id: string]: boolean }>({});\r\n  const [selectedInquiry, setSelectedInquiry] = useState<any | null>(null);\r\n  const [threadVisible, setThreadVisible] = useState(false);\r\n  const [leftCollapsed, setLeftCollapsed] = useState(false);\r\n  // Make messages list fullscreen by default\r\n  const [listFullscreen, setListFullscreen] = useState(true);\r\n  const [replyText, setReplyText] = useState<string>('');\r\n  const [fileList, setFileList] = useState<any[]>([]);\r\n  const [loadingThread, setLoadingThread] = useState<boolean>(false);\r\n  // Ref for auto-scrolling message area\r\n  const messagesEndRef = useRef<HTMLDivElement>(null);\r\n  // read current user profile from localStorage so we can mark replies with the correct author/role\r\n  // Auto-scroll to bottom of message area when selectedInquiry or its responses change\r\n  useEffect(() => {\r\n    if (messagesEndRef.current) {\r\n      messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\r\n    }\r\n  }, [selectedInquiry, selectedInquiry && selectedInquiry.responses && selectedInquiry.responses.length]);\r\n  const storedProfile = (() => {\r\n    try {\r\n      return localStorage.getItem('userProfile') ? JSON.parse(localStorage.getItem('userProfile') || 'null') : null;\r\n    } catch (err) {\r\n      return null;\r\n    }\r\n  })();\r\n\r\n  useEffect(() => {\r\n    setLoading(true);\r\n    contactAPI.getMyInquiries()\r\n      .then(res => {\r\n        setInquiries(res || []);\r\n      })\r\n      .catch(() => {\r\n        antdMessage.error('Failed to load inbox.');\r\n      })\r\n      .finally(() => setLoading(false));\r\n  }, []);\r\n\r\n  // Filtering and search logic\r\n  const filteredInquiries = inquiries.filter(inquiry => {\r\n    // Status filter\r\n    let statusMatch = true;\r\n    if (filter.status === 'pending') statusMatch = !inquiry.responses || inquiry.responses.length === 0;\r\n    // Treat \"responded\" filter as \"has responses OR explicitly resolved\"\r\n    if (filter.status === 'responded') statusMatch = inquiry.status === 'resolved' || (inquiry.responses && inquiry.responses.length > 0);\r\n    if (filter.status === 'closed') statusMatch = inquiry.status === 'closed';\r\n  // Category filter\r\n  let categoryMatch = true;\r\n  if (category && category !== 'All') categoryMatch = inquiry.category === category;\r\n    // Search filter\r\n    const search = filter.search.toLowerCase();\r\n    const searchMatch =\r\n      !search ||\r\n      (inquiry.residentName && inquiry.residentName.toLowerCase().includes(search)) ||\r\n      (inquiry.category && inquiry.category.toLowerCase().includes(search)) ||\r\n      (inquiry.subject && inquiry.subject.toLowerCase().includes(search)) ||\r\n      (inquiry.createdAt && new Date(inquiry.createdAt).toLocaleString().toLowerCase().includes(search));\r\n    return statusMatch && searchMatch && categoryMatch;\r\n  });\r\n\r\n  // Inline reply handler (stub)\r\n  const handleReply = async (id: string) => {\r\n    setReplyLoading(r => ({ ...r, [id]: true }));\r\n    try {\r\n      // TODO: Replace with actual API call\r\n      await new Promise(res => setTimeout(res, 800));\r\n      setReply(r => ({ ...r, [id]: '' }));\r\n      antdMessage.success('Reply sent!');\r\n    } finally {\r\n      setReplyLoading(r => ({ ...r, [id]: false }));\r\n    }\r\n  };\r\n\r\n  const openThread = (inquiry: any) => {\r\n    // simulate loading the thread\r\n    setLoadingThread(true);\r\n    // ensure the conversation panel is visible when opening a thread\r\n    setListFullscreen(false);\r\n    setTimeout(() => {\r\n      setSelectedInquiry(inquiry);\r\n      setLoadingThread(false);\r\n      setThreadVisible(true);\r\n    }, 250);\r\n  };\r\n\r\n  const timeAgo = (iso?: string) => {\r\n    if (!iso) return '';\r\n    const diff = Date.now() - new Date(iso).getTime();\r\n    const mins = Math.floor(diff / 60000);\r\n    if (mins < 1) return 'just now';\r\n    if (mins < 60) return `${mins}m`;\r\n    const hrs = Math.floor(mins / 60);\r\n    if (hrs < 24) return `${hrs}h`;\r\n    const days = Math.floor(hrs / 24);\r\n    return `${days}d`;\r\n  };\r\n\r\n  // Lightweight replacement for AntD Comment to avoid import/type issues\r\n  const MessageComment: React.FC<{ author?: string; avatar?: React.ReactNode; content?: React.ReactNode; datetime?: React.ReactNode; align?: 'left'|'right' }> = ({ author, avatar, content, datetime, align = 'left' }) => (\r\n    <div style={{ display: 'flex', justifyContent: align === 'left' ? 'flex-start' : 'flex-end' }}>\r\n      <div style={{ display: 'flex', gap: 8, alignItems: 'flex-start', maxWidth: '80%' }}>\r\n        {align === 'left' && avatar}\r\n        <div>\r\n          <div style={{ fontSize: 13, fontWeight: 600 }}>{author}</div>\r\n          <div style={{ marginTop: 6 }}>{content}</div>\r\n          {datetime && <div style={{ marginTop: 6, fontSize: 12, color: '#777' }}>{datetime}</div>}\r\n        </div>\r\n        {align === 'right' && avatar}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  // Helper to safely get the first initial from a name-like value\r\n  const getInitial = (val: any, fallback = '?') => {\r\n    if (!val) return fallback;\r\n    try {\r\n      const s = String(val).trim();\r\n      return s.length > 0 ? s.charAt(0).toUpperCase() : fallback;\r\n    } catch (e) {\r\n      return fallback;\r\n    }\r\n  };\r\n\r\n  return (\r\n  <div style={{ minHeight: '100vh', background: '#f0f4f8', padding: '24px', fontFamily: 'Poppins, Arial, sans-serif', position: 'relative' }}>\r\n      <Card\r\n        style={{ maxWidth: 1200, margin: '0 auto', borderRadius: 18, boxShadow: '0 8px 32px 0 rgba(31, 38, 135, 0.08)', padding: 0, background: '#fff' }}\r\n        bodyStyle={{ padding: 0, background: '#fff' }}\r\n      >\r\n        <div style={{ padding: '24px 32px 0 32px' }}>\r\n          <Row gutter={[12, 12]} align=\"middle\" style={{ marginBottom: 12 }}>\r\n            <Col xs={24} sm={6}>\r\n              <Select value={category} onChange={(val) => setCategory(val)} style={{ width: '100%' }}>\r\n                <Select.Option value=\"All\">All</Select.Option>\r\n                <Select.Option value=\"Complaints\">Complaints</Select.Option>\r\n                <Select.Option value=\"Requests\">Requests</Select.Option>\r\n                <Select.Option value=\"Announcements\">Announcements</Select.Option>\r\n              </Select>\r\n            </Col>\r\n            <Col xs={24} sm={12}>\r\n              <Input.Search placeholder=\"Search by date, name, or category\" allowClear value={filter.search} onChange={(e) => setFilter(s => ({ ...s, search: e.target.value }))} onSearch={(val) => setFilter(s => ({ ...s, search: val }))} />\r\n            </Col>\r\n            <Col xs={24} sm={6} style={{ display: 'flex', alignItems: 'center', justifyContent: 'flex-end', gap: 8 }}>\r\n              <div style={{ flex: 1 }} />\r\n              <Button\r\n                type=\"text\"\r\n                onClick={() => setLeftCollapsed(v => !v)}\r\n                style={{ borderRadius: 8 }}\r\n                title={leftCollapsed ? 'Show conversation list' : 'Hide conversation list'}\r\n                icon={leftCollapsed ? <MenuUnfoldOutlined /> : <MenuFoldOutlined />}\r\n              />\r\n            </Col>\r\n          </Row>\r\n          <Typography.Title level={3} style={{ marginBottom: 0, color: '#1890ff', display: 'flex', alignItems: 'center', gap: 8, fontFamily: 'Poppins, Arial, sans-serif' }}>\r\n            <span role=\"img\" aria-label=\"inbox\"></span> Inbox\r\n          </Typography.Title>\r\n        </div>\r\n        <Divider style={{ margin: '16px 0 0 0' }} />\r\n        <div style={{ padding: '0 32px 32px 32px' }}>\r\n          {loading ? (\r\n            <Spin />\r\n          ) : filteredInquiries.length === 0 ? (\r\n            <Result\r\n              icon={<InboxOutlined />}\r\n              status=\"info\"\r\n              title=\"No messages yet\"\r\n              subTitle=\"There are no messages in your inbox.\"\r\n            />\r\n          ) : (\r\n            <div style={{ display: 'flex', gap: 16 }}>\r\n            {/* Conversation list (collapsible) */}\r\n            {!leftCollapsed ? (\r\n              <div style={{ flex: listFullscreen ? 1 : '0 0 300px', maxHeight: listFullscreen ? 'calc(100vh - 220px)' : 500, overflowY: 'auto', position: 'relative' }}>\r\n                <Button\r\n                  type=\"text\"\r\n                  onClick={() => setLeftCollapsed(true)}\r\n                  style={{ position: 'absolute', right: -12, top: -8, zIndex: 10, borderRadius: 8, background: '#fff', boxShadow: '0 2px 8px rgba(0,0,0,0.06)' }}\r\n                  title=\"Collapse list\"\r\n                >\r\n                  <MenuFoldOutlined />\r\n                </Button>\r\n                <List\r\n                  itemLayout=\"vertical\"\r\n                  dataSource={filteredInquiries}\r\n                  renderItem={inquiry => {\r\n                // Prefer explicit 'resolved' status. If not resolved, fall back to checking responses.\r\n                const statusTag = inquiry.status === 'resolved' ? (\r\n                  <Tag color=\"green\">Resolved</Tag>\r\n                ) : Array.isArray(inquiry.responses) && inquiry.responses.length > 0 ? (\r\n                  null\r\n                ) : (\r\n                  <Tag color=\"gold\">Pending</Tag>\r\n                );\r\n\r\n                const typeIcon = (() => {\r\n                  switch ((inquiry.category || '').toLowerCase()) {\r\n                    case 'complaints': return '';\r\n                    case 'requests': return '';\r\n                    case 'announcements': return '';\r\n                    default: return '';\r\n                  }\r\n                })();\r\n\r\n                const isSelected = selectedInquiry && selectedInquiry._id === inquiry._id;\r\n\r\n                return (\r\n                  <List.Item\r\n                    style={{ marginBottom: 8, background: isSelected ? '#f7fbff' : '#fff', borderRadius: 12, border: '1px solid #e6edf3', boxShadow: '0 1px 4px rgba(31,38,135,0.04)', cursor: 'pointer' }}\r\n                    onClick={() => openThread(inquiry)}\r\n                  >\r\n                    <div style={{ display: 'flex', alignItems: 'center', padding: '12px 10px', gap: 10 }}>\r\n                      <div style={{ flex: 1, minWidth: 0 }}>\r\n                        <div style={{ display: 'flex', alignItems: 'center', gap: 8, minWidth: 0 }}>\r\n                          <span style={{ fontSize: 18 }}>{typeIcon}</span>\r\n                          <Typography.Text strong style={{ fontSize: 14, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap', flex: 1 }}>{inquiry.residentName || inquiry.username || (inquiry.createdBy && (inquiry.createdBy.fullName || inquiry.createdBy.username)) || 'Unknown'}</Typography.Text>\r\n                          <Typography.Text type=\"secondary\" style={{ fontSize: 12, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}> {inquiry.subject || 'No subject'}</Typography.Text>\r\n                          <span style={{ marginLeft: 'auto', fontSize: 11, color: '#888' }}>{inquiry.createdAt ? timeAgo(inquiry.createdAt) : ''}</span>\r\n                          {statusTag ? React.cloneElement(statusTag as any, { style: { fontSize: 11, padding: '0 6px', marginLeft: 8 } }) : null}\r\n                        </div>\r\n                        <div style={{ marginTop: 6 }}>\r\n                          <Typography.Text type=\"secondary\" style={{ display: 'block', margin: 0, fontSize: 13, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{inquiry.message}</Typography.Text>\r\n                        </div>\r\n                        <div style={{ marginTop: 6 }}>\r\n                          {Array.isArray(inquiry.responses) && inquiry.responses.length > 0 ? (\r\n                            <Typography.Text type=\"secondary\" style={{ fontSize: 12 }}>{inquiry.responses.length} response(s)</Typography.Text>\r\n                          ) : (\r\n                            <Typography.Text type=\"secondary\" style={{ fontSize: 12 }}>No responses yet</Typography.Text>\r\n                          )}\r\n                        </div>\r\n                      </div>\r\n                      <div style={{ flexShrink: 0, marginLeft: 10 }}>\r\n                        {(() => {\r\n                          const displayName = inquiry.residentName || inquiry.username || (inquiry.createdBy && (inquiry.createdBy.fullName || inquiry.createdBy.username)) || inquiry.subject || 'Unknown';\r\n                          const initial = (displayName && displayName !== 'Unknown') ? getInitial(displayName, '?') : '?';\r\n                          return (\r\n                            <Avatar style={{ background: '#1890ff', color: '#fff', fontWeight: 700 }} size={36}>\r\n                              {initial}\r\n                            </Avatar>\r\n                          );\r\n                        })()}\r\n                      </div>\r\n                    </div>\r\n                  </List.Item>\r\n                );\r\n              }}\r\n                />\r\n              </div>\r\n            ) : (\r\n              <div style={{ width: 72, maxHeight: 500, overflowY: 'auto', display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 8, paddingTop: 8 }}>\r\n                {/* collapse: show compact vertical icons similar to dashboard sidebar */}\r\n                <Button\r\n                  type=\"text\"\r\n                  onClick={() => setLeftCollapsed(false)}\r\n                  style={{ borderRadius: 8, background: '#fff', boxShadow: '0 2px 8px rgba(0,0,0,0.06)' }}\r\n                  title=\"Show list\"\r\n                >\r\n                  <MenuUnfoldOutlined />\r\n                </Button>\r\n\r\n                <div style={{ width: '100%', display: 'flex', flexDirection: 'column', gap: 8, padding: 8 }}>\r\n                  {filteredInquiries.map(inquiry => {\r\n                    const displayName = inquiry.residentName || inquiry.username || (inquiry.createdBy && (inquiry.createdBy.fullName || inquiry.createdBy.username)) || inquiry.subject || 'Unknown';\r\n                    const initial = (displayName && displayName !== 'Unknown') ? getInitial(displayName, '?') : '?';\r\n                    const isSelected = selectedInquiry && selectedInquiry._id === inquiry._id;\r\n                    return (\r\n                      <Tooltip key={inquiry._id} title={`${displayName}  ${inquiry.subject || 'No subject'}`} placement=\"right\">\r\n                        <button\r\n                          onClick={() => openThread(inquiry)}\r\n                          style={{\r\n                            width: '100%',\r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            justifyContent: 'center',\r\n                            padding: 6,\r\n                            borderRadius: 8,\r\n                            border: isSelected ? '2px solid #1890ff' : '1px solid transparent',\r\n                            background: isSelected ? '#e6f7ff' : 'transparent',\r\n                            cursor: 'pointer'\r\n                          }}\r\n                          aria-label={displayName}\r\n                        >\r\n                          <Avatar style={{ background: '#1890ff', color: '#fff', fontWeight: 700 }} size={36}>{initial}</Avatar>\r\n                        </button>\r\n                      </Tooltip>\r\n                    );\r\n                  })}\r\n                </div>\r\n              </div>\r\n            )}\r\n\r\n            {!listFullscreen && (<div style={{ flex: 1 }}>)\r\n              {/* Make conversation panel visually blend into the page by removing card background/shadow */}\r\n              <Card\r\n                style={{ borderRadius: 12, height: '100%', background: 'transparent', boxShadow: 'none', border: 'none' }}\r\n                bodyStyle={{ display: 'flex', flexDirection: 'column', padding: 0, gap: 10, background: 'transparent' }}\r\n              >\r\n                {selectedInquiry ? (\r\n                  <>\r\n                    <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\r\n                      {/* Place staff/respondent info on the left and resident on the right to reflect message flow */}\r\n                      <div style={{ display: 'flex', gap: 6, alignItems: 'center' }}>\r\n                        {/* Removed General and Responded tags */}\r\n                        {selectedInquiry.status === 'resolved' ? (\r\n                          <Tag color=\"green\">Resolved</Tag>\r\n                        ) : (\r\n                          <Tag color=\"gold\">Pending</Tag>\r\n                        )}\r\n                      </div>\r\n                      <div style={{ flex: 1 }}>\r\n                        {(() => {\r\n                          const displayNameSelected = selectedInquiry.residentName || selectedInquiry.username || selectedInquiry.subject || 'Unknown';\r\n                          return (\r\n                            <>\r\n                              <Typography.Text strong style={{ display: 'block', textAlign: 'right', fontSize: 15 }}>{displayNameSelected}</Typography.Text>\r\n                              <Typography.Text type=\"secondary\" style={{ fontSize: 10, display: 'block', textAlign: 'right' }}>{selectedInquiry.createdAt ? new Date(selectedInquiry.createdAt).toLocaleString() : ''}</Typography.Text>\r\n                            </>\r\n                          );\r\n                        })()}\r\n                      </div>\r\n                      {(() => {\r\n                          const displayNameSelected = selectedInquiry.residentName || selectedInquiry.username || (selectedInquiry.createdBy && (selectedInquiry.createdBy.fullName || selectedInquiry.createdBy.username)) || selectedInquiry.subject || 'Unknown';\r\n                        const initial = (displayNameSelected && displayNameSelected !== 'Unknown') ? getInitial(displayNameSelected, '?') : '?';\r\n                        return <Avatar size={40} style={{ background: '#1890ff' }}>{initial}</Avatar>;\r\n                      })()}\r\n                    </div>\r\n\r\n                    <Divider />\r\n\r\n                    <div style={{ overflowY: 'auto', flex: 1, display: 'flex', flexDirection: 'column', gap: 10, paddingRight: 6, minHeight: 0, maxHeight: 220 }}>\r\n                      {/* Resident original message */}\r\n                      <div style={{ alignSelf: 'flex-end', maxWidth: '100%' }}>\r\n                        {(() => {\r\n                          const originalSenderName = selectedInquiry.residentName || selectedInquiry.username || (selectedInquiry.createdBy && (selectedInquiry.createdBy.fullName || selectedInquiry.createdBy.username)) || 'Resident';\r\n                          const originalInitial = (originalSenderName && originalSenderName !== 'Resident') ? getInitial(originalSenderName, 'U') : 'U';\r\n                          return (\r\n                            <MessageComment\r\n                              author={originalSenderName}\r\n                              avatar={<Avatar style={{ background: '#1890ff' }}>{originalInitial}</Avatar>}\r\n                              content={<div style={{ background: '#e6f7ff', padding: 10, borderRadius: 8 }}>\r\n                                <Typography.Paragraph style={{ margin: 0 }}>{selectedInquiry.message}</Typography.Paragraph>\r\n                                {selectedInquiry.attachments && selectedInquiry.attachments.length > 0 && (\r\n                                  <div style={{ marginTop: 8, display: 'flex', flexDirection: 'column', gap: 8 }}>\r\n                                    {selectedInquiry.attachments.map((a: any, i: number) => {\r\n                                      const url = a.url || a.path || '#';\r\n                                      const filename = a.name || a.filename || 'attachment';\r\n                                      const isImage = (a.contentType && a.contentType.startsWith('image/')) || /\\.(jpe?g|png|gif|webp)$/i.test(filename);\r\n                                      return (\r\n                                        <div key={i}>\r\n                                          {isImage ? (\r\n                                            <a href={url} target=\"_blank\" rel=\"noreferrer\">\r\n                                              <img src={url} alt={filename} style={{ maxWidth: 220, maxHeight: 140, borderRadius: 8, objectFit: 'cover', border: '1px solid #f0f0f0' }} />\r\n                                            </a>\r\n                                          ) : (\r\n                                            <div>\r\n                                              <a href={url} target=\"_blank\" rel=\"noreferrer\">{filename}</a>\r\n                                              {a.size ? <span style={{ marginLeft: 8, color: '#888', fontSize: 12 }}>({Math.round(a.size/1024)} KB)</span> : null}\r\n                                            </div>\r\n                                          )}\r\n                                        </div>\r\n                                      );\r\n                                    })}\r\n                                  </div>\r\n                                )}\r\n                              </div>}\r\n                              datetime={<span style={{ fontSize: 12 }}>{selectedInquiry.createdAt ? new Date(selectedInquiry.createdAt).toLocaleString() : ''}</span>}\r\n                              align=\"right\"\r\n                            />\r\n                          );\r\n                        })()}\r\n                      </div>\r\n\r\n                      {/* Staff responses */}\r\n                      {Array.isArray(selectedInquiry.responses) && selectedInquiry.responses.map((r: any, idx: number) => {\r\n                        // Support multiple possible field shapes from server/client.\r\n                        // Primary: trust an explicit role field if present. Fallback: try to detect resident replies\r\n                        // by comparing createdBy id or author name to the selected inquiry's resident info.\r\n                        const roleRaw = r.role || r.authorRole || r.author_role || '';\r\n                        let role = (roleRaw || '').toString().toLowerCase();\r\n\r\n                        // Prefer explicit author name provided by the server (authorName).\r\n                        // Also accept several common alias fields that servers sometimes use.\r\n                        // Only fall back to 'You' when the response was created by the current user.\r\n                        const authorRaw = r.author || r.authorName || r.author_name || r.createdByName || r.createdByFullName || r.userName || r.user || '';\r\n                        const createdById = r.createdBy ? String(r.createdBy) : undefined;\r\n                        const currentUserId = storedProfile && (storedProfile._id || storedProfile.id) ? String(storedProfile._id || storedProfile.id) : undefined;\r\n\r\n                        // If role is missing, try a few heuristics to detect resident replies\r\n                        if (!role) {\r\n                          try {\r\n                            // resident id may be stored in selectedInquiry.createdBy (object or id) or selectedInquiry.residentId\r\n                            let residentId: string | undefined;\r\n                            if (selectedInquiry) {\r\n                              if (selectedInquiry.createdBy && typeof selectedInquiry.createdBy === 'string') residentId = String(selectedInquiry.createdBy);\r\n                              else if (selectedInquiry.createdBy && typeof selectedInquiry.createdBy === 'object' && (selectedInquiry.createdBy._id || selectedInquiry.createdBy.id)) residentId = String(selectedInquiry.createdBy._id || selectedInquiry.createdBy.id);\r\n                              else if (selectedInquiry.residentId) residentId = String(selectedInquiry.residentId);\r\n                            }\r\n\r\n                            const residentName = (selectedInquiry && (selectedInquiry.residentName || selectedInquiry.username || '')) ? String(selectedInquiry.residentName || selectedInquiry.username).toLowerCase() : '';\r\n                            const authorName = (authorRaw || r.authorName || '').toString().toLowerCase();\r\n\r\n                            if (residentId && createdById && residentId === createdById) {\r\n                              role = 'resident';\r\n                            } else if (residentName && authorName && residentName === authorName) {\r\n                              role = 'resident';\r\n                            }\r\n                          } catch (e) {\r\n                            // ignore heuristic errors and fall back to existing logic\r\n                          }\r\n                        }\r\n\r\n                        let authorDisplay: string;\r\n                        if (authorRaw && authorRaw.trim() !== '') {\r\n                          authorDisplay = authorRaw;\r\n                        } else if (currentUserId && createdById && currentUserId === createdById) {\r\n                          authorDisplay = 'You';\r\n                        } else if (r.authorName && r.authorName.trim() !== '') {\r\n                          authorDisplay = r.authorName;\r\n                        } else if (r.createdBy && typeof r.createdBy === 'object' && (r.createdBy.fullName || r.createdBy.username)) {\r\n                          authorDisplay = r.createdBy.fullName || r.createdBy.username;\r\n                        } else if (r.createdByName && typeof r.createdByName === 'string' && r.createdByName.trim() !== '') {\r\n                          authorDisplay = r.createdByName;\r\n                        } else if (r.user && typeof r.user === 'object' && (r.user.fullName || r.user.username)) {\r\n                          authorDisplay = r.user.fullName || r.user.username;\r\n                        } else {\r\n                          // Reasonable fallback depending on role. If this response appears to be from the resident\r\n                          // prefer the selected inquiry's resident name / username so the UI shows the sender's name.\r\n                          if (role === 'resident') {\r\n                            authorDisplay = (selectedInquiry && (selectedInquiry.residentName || selectedInquiry.username)) ? (selectedInquiry.residentName || selectedInquiry.username) : 'Resident';\r\n                          } else {\r\n                            // Try common places for staff name before falling back to 'Staff'\r\n                            // If responses don't include authorName but the inquiry has assignedTo populated,\r\n                            // try to match the response.createdBy id to an assigned staff to show their name.\r\n                            let staffNameFromAssigned: string | undefined;\r\n                            try {\r\n                              if (createdById && selectedInquiry && Array.isArray(selectedInquiry.assignedTo)) {\r\n                                const match = selectedInquiry.assignedTo.find((a: any) => String(a._id) === String(createdById));\r\n                                if (match) staffNameFromAssigned = match.fullName || match.username;\r\n                              }\r\n                            } catch (e) {\r\n                              // ignore\r\n                            }\r\n\r\n                            authorDisplay = r.staffName || r.staffFullName || (r.createdBy && typeof r.createdBy === 'object' && (r.createdBy.fullName || r.createdBy.username)) || staffNameFromAssigned || 'Staff';\r\n                          }\r\n                        }\r\n\r\n                        // Determine alignment: replies from the resident (or the current user) are shown on the right; staff on the left.\r\n                        const isResidentReply = role === 'resident' || role === 'user';\r\n                        const isCurrentUser = currentUserId && createdById && currentUserId === createdById;\r\n                        const align: 'left' | 'right' = (isResidentReply || isCurrentUser) ? 'right' : 'left';\r\n\r\n                        const avatarNode = (isResidentReply || isCurrentUser) ? (\r\n                          <Avatar style={{ background: '#1890ff' }}>{getInitial(authorDisplay, 'U')}</Avatar>\r\n                        ) : (\r\n                          <Avatar style={{ background: '#666' }}>{getInitial(authorDisplay, 'B')}</Avatar>\r\n                        );\r\n\r\n                        return (\r\n                          <div key={idx} style={{ alignSelf: (isResidentReply || isCurrentUser) ? 'flex-end' : 'flex-start', maxWidth: '100%' }}>\r\n                            <MessageComment\r\n                              author={isCurrentUser ? 'You' : authorDisplay}\r\n                              avatar={avatarNode}\r\n                              content={<div style={{ background: (isResidentReply || isCurrentUser) ? '#e6f7ff' : '#f6f6f6', padding: 10, borderRadius: 8 }}>\r\n                                <Typography.Paragraph style={{ margin: 0 }}>{r.text}</Typography.Paragraph>\r\n                                {r.attachments && r.attachments.length > 0 && (\r\n                                  <div style={{ marginTop: 8, display: 'flex', flexDirection: 'column', gap: 8 }}>\r\n                                    {r.attachments.map((a: any, i: number) => {\r\n                                      const url = a.url || a.path || '#';\r\n                                      const filename = a.name || a.filename || 'attachment';\r\n                                      const isImage = (a.contentType && a.contentType.startsWith('image/')) || /\\.(jpe?g|png|gif|webp)$/i.test(filename);\r\n                                      return (\r\n                                        <div key={i}>\r\n                                          {isImage ? (\r\n                                            <a href={url} target=\"_blank\" rel=\"noreferrer\">\r\n                                              <img src={url} alt={filename} style={{ maxWidth: 220, maxHeight: 140, borderRadius: 8, objectFit: 'cover', border: '1px solid #f0f0f0' }} />\r\n                                            </a>\r\n                                          ) : (\r\n                                            <div>\r\n                                              <a href={url} target=\"_blank\" rel=\"noreferrer\">{filename}</a>\r\n                                              {a.size ? <span style={{ marginLeft: 8, color: '#888', fontSize: 12 }}>({Math.round(a.size/1024)} KB)</span> : null}\r\n                                            </div>\r\n                                          )}\r\n                                        </div>\r\n                                      );\r\n                                    })}\r\n                                  </div>\r\n                                )}\r\n                              </div>}\r\n                              datetime={<span style={{ fontSize: 12 }}>{r.createdAt ? new Date(r.createdAt).toLocaleString() : ''}</span>}\r\n                              align={align}\r\n                            />\r\n                          </div>\r\n                        );\r\n                      })}\r\n                      <div ref={messagesEndRef} />\r\n                    </div>\r\n\r\n                    <div style={{ marginTop: 0, flexShrink: 0 }}>\r\n                      {/* Reply bar fixed at bottom of the conversation card */}\r\n                      <div style={{ background: '#fff', paddingTop: 4, paddingBottom: 4, borderTop: '1px solid #f0f0f0', display: 'flex', alignItems: 'flex-end', gap: 8 }}>\r\n                        {/* Auto-resizing textarea implemented with a controlled textarea and a simple resize handler */}\r\n                        <textarea\r\n                          value={replyText}\r\n                          onChange={e => {\r\n                            setReplyText(e.target.value);\r\n                            // auto-resize\r\n                            const el = e.target as HTMLTextAreaElement;\r\n                            el.style.height = 'auto';\r\n                            el.style.height = Math.min(200, el.scrollHeight) + 'px';\r\n                          }}\r\n                          onKeyDown={async (e) => {\r\n                            if (e.key === 'Enter' && !e.shiftKey) {\r\n                              e.preventDefault();\r\n                              // send\r\n                              if (!replyText || replyText.trim() === '') return antdMessage.warning('Reply cannot be empty');\r\n                              if (!selectedInquiry || !selectedInquiry._id) return antdMessage.error('No inquiry selected');\r\n                              const sendingKey = selectedInquiry._id;\r\n                              setReplyLoading(r => ({ ...r, [sendingKey]: true }));\r\n                              try {\r\n                                const resp = await contactAPI.respondToInquiry(selectedInquiry._id, { response: replyText.trim() });\r\n                                const updatedInquiry = resp;\r\n                                setInquiries(prev => prev.map(i => i._id === updatedInquiry._id ? updatedInquiry : i));\r\n                                setSelectedInquiry(updatedInquiry);\r\n                                setReplyText('');\r\n                                antdMessage.success('Reply sent');\r\n                              } catch (err) {\r\n                                console.error('Failed to send reply', err);\r\n                                antdMessage.error('Failed to send reply');\r\n                              } finally {\r\n                                setReplyLoading(r => ({ ...r, [sendingKey]: false }));\r\n                              }\r\n                            }\r\n                          }}\r\n                          placeholder=\"Type your reply...\"\r\n                          style={{\r\n                            width: '100%',\r\n                            minHeight: 40,\r\n                            maxHeight: 200,\r\n                            resize: 'none',\r\n                            padding: '10px 12px',\r\n                            borderRadius: 12,\r\n                            border: '1px solid #e6edf3',\r\n                            boxShadow: '0 1px 4px rgba(15, 23, 42, 0.04)',\r\n                            fontSize: 14,\r\n                            outline: 'none',\r\n                            fontFamily: 'Poppins, Arial, sans-serif',\r\n                            color: '#222'\r\n                          }}\r\n                        />\r\n\r\n                        <div style={{ display: 'flex', alignItems: 'center' }}>\r\n                          <button\r\n                            onClick={async () => {\r\n                              if (!replyText || replyText.trim() === '') return antdMessage.warning('Reply cannot be empty');\r\n                              if (!selectedInquiry || !selectedInquiry._id) return antdMessage.error('No inquiry selected');\r\n                              const sendingKey = selectedInquiry._id;\r\n                              setReplyLoading(r => ({ ...r, [sendingKey]: true }));\r\n                              try {\r\n                                const resp = await contactAPI.respondToInquiry(selectedInquiry._id, { response: replyText.trim() });\r\n                                const updatedInquiry = resp;\r\n                                setInquiries(prev => prev.map(i => i._id === updatedInquiry._id ? updatedInquiry : i));\r\n                                setSelectedInquiry(updatedInquiry);\r\n                                setReplyText('');\r\n                                antdMessage.success('Reply sent');\r\n                              } catch (err) {\r\n                                console.error('Failed to send reply', err);\r\n                                antdMessage.error('Failed to send reply');\r\n                              } finally {\r\n                                setReplyLoading(r => ({ ...r, [sendingKey]: false }));\r\n                              }\r\n                            }}\r\n                            style={{\r\n                              background: '#0ea5a3',\r\n                              color: '#fff',\r\n                              border: 'none',\r\n                              padding: '8px 14px',\r\n                              borderRadius: 10,\r\n                              cursor: 'pointer',\r\n                              fontSize: 18,\r\n                              fontWeight: 600,\r\n                              boxShadow: '0 4px 10px rgba(14,165,163,0.12)',\r\n                              display: 'flex',\r\n                              alignItems: 'center',\r\n                              justifyContent: 'center'\r\n                            }}\r\n                            title=\"Send Reply\"\r\n                            onMouseOver={(e) => (e.currentTarget.style.opacity = '0.95')}\r\n                            onMouseOut={(e) => (e.currentTarget.style.opacity = '1')}\r\n                            disabled={!!(selectedInquiry && replyLoading[selectedInquiry._id])}\r\n                          >\r\n                            <SendOutlined style={{ fontSize: 22, verticalAlign: 'middle' }} />\r\n                          </button>\r\n                        </div>\r\n                      </div>\r\n                    </div>\r\n                  </>\r\n                ) : (\r\n                  <div style={{ textAlign: 'center', padding: 32 }}>\r\n                    <Typography.Text type=\"secondary\">Select a message to view the conversation</Typography.Text>\r\n                  </div>\r\n                )}\r\n              </Card>\r\n            </div>)}\r\n            </div>\r\n          )}\r\n        </div>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Inbox;\r\n","import React, { useState } from 'react';\r\nimport { Button, Tooltip, Upload, message } from 'antd';\r\nimport { UploadOutlined, EyeOutlined, DownloadOutlined, DeleteOutlined, FileWordOutlined } from '@ant-design/icons';\r\nimport { axiosInstance, axiosPublic } from '../services/api';\r\n\r\nconst getLabel = (filename?: string) =>\r\n  filename ? filename.replace(/_/g, \" \").replace(/\\.docx$/, \"\") : \"Untitled\";\r\n\r\nconst TemplatesManager: React.FC = () => {\r\n  const [templateList, setTemplateList] = useState<any[]>([]);\r\n  const [previewId, setPreviewId] = useState<string | null>(null);\r\n  const [showModal, setShowModal] = useState(false);\r\n  const [loading, setLoading] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [downloadError, setDownloadError] = useState<string | null>(null);\r\n  const [previewType, setPreviewType] = useState<'html' | 'pdf' | null>(null);\r\n  const [htmlContent, setHtmlContent] = useState<string>('');\r\n\r\n  React.useEffect(() => {\r\n    // Fetch files from Templates folder\r\n    const fetchTemplatesFolderFiles = async () => {\r\n      try {\r\n        await axiosPublic.get('/templates/list');\r\n      } catch (err) {\r\n        // Ignore error for now\r\n      }\r\n    };\r\n    const fetchTemplates = async () => {\r\n      setLoading(true);\r\n      setError(null);\r\n        try {\r\n          const res = await axiosPublic.get('/documents/list');\r\n          setTemplateList(res.data || []);\r\n        } catch (err) {\r\n          setError('Could not load templates.');\r\n        }\r\n      setLoading(false);\r\n    };\r\n    fetchTemplates();\r\n  }, []);\r\n\r\n  return (\r\n    <div style={{\r\n      padding: \"2rem\",\r\n      background: \"#f3f4f6\",\r\n      borderRadius: \"16px\",\r\n      boxShadow: \"0 2px 8px #e5e7eb\",\r\n      maxWidth: \"2000px\",\r\n      margin: \"2rem auto\"\r\n    }}>\r\n      <h2 style={{ fontWeight: \"bold\", fontSize: \"1.5rem\", marginBottom: \"1.5rem\" }}>\r\n         Templates Manager\r\n      </h2>\r\n      {/* GridFS Files Section */}\r\n      <div style={{ marginBottom: 32 }}>\r\n      <h3 style={{ fontWeight: \"bold\", fontSize: \"1.1rem\", marginBottom: \"0.5rem\", color: '#374151' }}></h3>\r\n        {loading && <div>Loading templates...</div>}\r\n        {error && <div style={{ color: 'red' }}>{error}</div>}\r\n        <div style={{ display: \"flex\", flexWrap: \"wrap\", gap: \"1.5rem\" }}>\r\n          {templateList.filter((file: any) => file && file.filename).map((file: any) => (\r\n            <div key={file._id} style={{\r\n              display: \"flex\",\r\n              flexDirection: \"row\",\r\n              alignItems: \"center\",\r\n              padding: \"1.5rem 2rem\",\r\n              border: \"1px solid #e5e7eb\",\r\n              borderRadius: \"12px\",\r\n              background: \"#fff\",\r\n              color: \"#374151\",\r\n              width: \"500px\",\r\n              minHeight: \"100px\",\r\n              boxShadow: \"0 1px 4px rgba(0,0,0,0.04)\",\r\n              marginBottom: \"1rem\",\r\n              position: \"relative\"\r\n            }}>\r\n              <img src=\"/word.png\" alt=\"Word Icon\" style={{ width: 56, height: 56, marginRight: 24 }} />\r\n              <div style={{ flex: 1 }}>\r\n                <span style={{ fontWeight: \"bold\", fontSize: \"1.1rem\", marginBottom: 4, display: \"block\" }}>{getLabel(file.filename)}</span>\r\n                <div style={{ display: \"flex\", gap: \"1rem\", marginTop: 8 }}>\r\n                  <Tooltip title=\"Preview\">\r\n                    <Button\r\n                      icon={<EyeOutlined />}\r\n                      onClick={async (e) => {\r\n                        e.stopPropagation();\r\n                        if (previewId === file._id) {\r\n                          setPreviewId(null);\r\n                          setHtmlContent('');\r\n                          return;\r\n                        }\r\n                        setPreviewId(file._id);\r\n                        setHtmlContent('');\r\n                          try {\r\n                            const res = await axiosPublic.get(`/documents/preview/${file._id}?format=html`, { responseType: 'text' });\r\n                            setHtmlContent(res.data || '');\r\n                          } catch (err) {\r\n                            setHtmlContent('<div style=\"color:red\">Failed to load preview.</div>');\r\n                          }\r\n                      }}\r\n                    >Preview</Button>\r\n                  </Tooltip>\r\n                  <Tooltip title=\"Download\">\r\n                    <Button\r\n                      type=\"primary\"\r\n                      icon={<DownloadOutlined />}\r\n                      onClick={async () => {\r\n                        setDownloadError(null);\r\n                        try {\r\n                          const res = await axiosInstance.get(`/documents/original/${file._id}`, { responseType: 'blob' });\r\n                          const blob = res.data;\r\n                          const url = window.URL.createObjectURL(blob);\r\n                          const a = document.createElement('a');\r\n                          a.href = url;\r\n                          a.download = file.filename;\r\n                          document.body.appendChild(a);\r\n                          a.click();\r\n                          a.remove();\r\n                          window.URL.revokeObjectURL(url);\r\n                        } catch (err) {\r\n                          setDownloadError(`Failed to download ${file.filename} from MongoDB.`);\r\n                        }\r\n                      }}\r\n                    >Download</Button>\r\n                  </Tooltip>\r\n                  <Tooltip title=\"Remove\">\r\n                    <Button\r\n                      danger\r\n                      icon={<DeleteOutlined />}\r\n                      onClick={async () => {\r\n                        setLoading(true);\r\n                        setError(null);\r\n                          try {\r\n                            const res = await axiosInstance.delete(`/documents/file/${file._id}`);\r\n                            const data = res.data;\r\n                            if (data && data.success) {\r\n                              // Refresh list\r\n                              const resList = await axiosPublic.get('/documents/list');\r\n                              setTemplateList(resList.data || []);\r\n                            } else {\r\n                              setError('Delete failed.');\r\n                            }\r\n                          } catch (err) {\r\n                            setError('Delete failed.');\r\n                          }\r\n                        setLoading(false);\r\n                      }}\r\n                    >Remove</Button>\r\n                  </Tooltip>\r\n                </div>\r\n                {previewId === file._id && htmlContent && (\r\n                  <div\r\n                    style={{\r\n                      position: 'fixed',\r\n                      top: '50%',\r\n                      left: '50%',\r\n                      transform: 'translate(-50%, -50%)',\r\n                      background: '#fff',\r\n                      border: '1px solid #e5e7eb',\r\n                      borderRadius: 12,\r\n                      boxShadow: '0 4px 32px rgba(0,0,0,0.18)',\r\n                      padding: 32,\r\n                      zIndex: 1000,\r\n                      minWidth: 600,\r\n                      maxWidth: 900,\r\n                      maxHeight: 600,\r\n                      overflow: 'auto',\r\n                    }}\r\n                  >\r\n                    <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: 12 }}>\r\n                      <span style={{ fontWeight: 'bold', fontSize: '1.1rem' }}>Preview</span>\r\n                      <button\r\n                        style={{ background: '#ef4444', color: 'white', border: 'none', borderRadius: 4, padding: '4px 12px', cursor: 'pointer' }}\r\n                        onClick={() => { setPreviewId(null); setHtmlContent(''); }}\r\n                      >Close</button>\r\n                    </div>\r\n                    <div dangerouslySetInnerHTML={{ __html: htmlContent }} />\r\n                  </div>\r\n                )}\r\n              </div>\r\n            </div>\r\n          ))}\r\n        </div>\r\n      </div>\r\n      {downloadError && (\r\n        <div style={{ color: 'red', marginBottom: 16 }}>{downloadError}</div>\r\n      )}\r\n      {/* Upload Section */}\r\n      <div style={{ marginTop: 32 }}>\r\n        <Upload\r\n          accept=\".docx\"\r\n          showUploadList={false}\r\n          customRequest={async ({ file, onSuccess, onError }) => {\r\n            setLoading(true);\r\n            setError(null);\r\n            const formData = new FormData();\r\n            formData.append('file', file);\r\n              try {\r\n              const res = await axiosInstance.post('/documents/upload', formData, {\r\n                headers: { 'Content-Type': 'multipart/form-data' }\r\n              });\r\n              const data = res.data;\r\n              if (data && data.success) {\r\n                // Refresh list\r\n                const resList = await axiosPublic.get('/documents/list');\r\n                setTemplateList(resList.data || []);\r\n                message.success('Upload successful');\r\n                onSuccess && onSuccess('ok');\r\n              } else {\r\n                setError('Upload failed.');\r\n                message.error('Upload failed');\r\n                onError && onError(new Error('Upload failed'));\r\n              }\r\n            } catch (err) {\r\n              setError('Upload failed.');\r\n              message.error('Upload failed');\r\n              onError && onError(new Error('Upload failed'));\r\n            }\r\n            setLoading(false);\r\n          }}\r\n        >\r\n          <Button icon={<UploadOutlined />} type=\"primary\">Upload .docx</Button>\r\n        </Upload>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default TemplatesManager;\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { useLocation } from 'react-router-dom';\r\nimport { Layout, Card, List, Typography, Spin, Result, Divider, Avatar, Row, Col, Space, Badge, Select, Tabs, Input, Tag, Button, Modal, message as antdMessage } from 'antd';\r\nimport { InboxOutlined, SendOutlined, CheckOutlined, PlusOutlined } from '@ant-design/icons';\r\nimport { contactAPI, adminAPI } from '../services/api';\r\n\r\ntype FilterState = {\r\n  status: string;\r\n  search: string;\r\n};\r\n\r\nconst StaffInbox: React.FC = () => {\r\n  const [loading, setLoading] = useState(true);\r\n  const [inquiries, setInquiries] = useState<any[]>([]);\r\n  const [filter, setFilter] = useState<FilterState>({ status: 'all', search: '' });\r\n  const [category, setCategory] = useState<string>('All');\r\n  const [selectedInquiry, setSelectedInquiry] = useState<any | null>(null);\r\n  const [replyText, setReplyText] = useState<string>('');\r\n  const [replyLoading, setReplyLoading] = useState<{ [id: string]: boolean }>({});\r\n  const [residentsModalVisible, setResidentsModalVisible] = useState(false);\r\n  const [residentsLoading, setResidentsLoading] = useState(false);\r\n  const [residents, setResidents] = useState<Array<{ label: string; username?: string; barangayID?: string }>>([]);\r\n  const location = useLocation();\r\n  const messagesEndRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    fetchAll();\r\n    // If navigation state contains an inquiry to open, store it for after fetch\r\n    const state: any = (location && (location as any).state) || {};\r\n    if (state && state.openInquiryId) {\r\n      // We'll try to open after loading inquiries\r\n      const openId = state.openInquiryId;\r\n      // Wait for fetchAll to populate inquiries, then open\r\n      const waiter = setInterval(() => {\r\n        const found = inquiries.find(i => i._id === openId);\r\n        if (found) {\r\n          setSelectedInquiry(found);\r\n          clearInterval(waiter);\r\n        }\r\n      }, 200);\r\n      // As fallback, after 3s, try fetching single inquiry from API\r\n      setTimeout(async () => {\r\n        const found = inquiries.find(i => i._id === openId);\r\n        if (!found) {\r\n          try {\r\n            const single = await contactAPI.getInquiryById(openId);\r\n            if (single) setSelectedInquiry(single);\r\n          } catch (e) {\r\n            // ignore\r\n          }\r\n        }\r\n      }, 3000);\r\n    }\r\n  }, []);\r\n\r\n  const fetchAll = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await contactAPI.getAllInquiries();\r\n      setInquiries(res || []);\r\n    } catch (e) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('Failed to load inquiries', e);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (messagesEndRef.current) messagesEndRef.current.scrollIntoView({ behavior: 'smooth' });\r\n  }, [selectedInquiry, selectedInquiry && selectedInquiry.responses && selectedInquiry.responses.length]);\r\n\r\n  const timeAgo = (iso?: string) => {\r\n    if (!iso) return '';\r\n    const diff = Date.now() - new Date(iso).getTime();\r\n    const mins = Math.floor(diff / 60000);\r\n    if (mins < 1) return 'just now';\r\n    if (mins < 60) return `${mins}m`;\r\n    const hrs = Math.floor(mins / 60);\r\n    if (hrs < 24) return `${hrs}h`;\r\n    const days = Math.floor(hrs / 24);\r\n    return `${days}d`;\r\n  };\r\n\r\n  const getInitial = (val: any, fallback = '?') => {\r\n    if (!val) return fallback;\r\n    try { const s = String(val).trim(); return s.length ? s.charAt(0).toUpperCase() : fallback; } catch (e) { return fallback; }\r\n  };\r\n\r\n  // Lightweight message/comment renderer (keeps layout consistent with resident inbox)\r\n  const MessageComment: React.FC<{ author?: string; avatar?: React.ReactNode; content?: React.ReactNode; datetime?: React.ReactNode; align?: 'left'|'right' }> = ({ author, avatar, content, datetime, align = 'left' }) => (\r\n    <div style={{ display: 'flex', justifyContent: align === 'left' ? 'flex-start' : 'flex-end' }}>\r\n      <div style={{ display: 'flex', gap: 8, alignItems: 'flex-start', maxWidth: '80%' }}>\r\n        {align === 'left' && avatar}\r\n        <div>\r\n          <div style={{ fontSize: 13, fontWeight: 600 }}>{author}</div>\r\n          <div style={{ marginTop: 6 }}>{content}</div>\r\n          {datetime && <div style={{ marginTop: 6, fontSize: 12, color: '#888' }}>{datetime}</div>}\r\n        </div>\r\n        {align === 'right' && avatar}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  const openThread = (inquiry: any) => {\r\n    setSelectedInquiry(inquiry);\r\n  };\r\n\r\n  const handleSendReply = async () => {\r\n    if (!replyText || !selectedInquiry || !selectedInquiry._id) return;\r\n    const id = selectedInquiry._id;\r\n    setReplyLoading(s => ({ ...s, [id]: true }));\r\n    try {\r\n      if (selectedInquiry.isNewThread) {\r\n  // Determine recipient username/barangayID from several possible places to avoid falling\r\n  // back to the current staff account (which would make the inquiry show up only on staff)\r\n  let recipientUsername = selectedInquiry.residentUsername || selectedInquiry.username || selectedInquiry.userName || selectedInquiry.author || selectedInquiry.createdBy && (selectedInquiry.createdBy.username || selectedInquiry.createdBy.userName);\r\n  let recipientBarangayID = (selectedInquiry as any).residentBarangayID || selectedInquiry.barangayID || (selectedInquiry.createdBy && selectedInquiry.createdBy.barangayID);\r\n\r\n        // If createdBy info exists, try its username/barangayID\r\n        if ((!recipientUsername || recipientUsername === '') && selectedInquiry.createdBy) {\r\n          if (typeof selectedInquiry.createdBy === 'string') {\r\n            recipientUsername = selectedInquiry.createdBy;\r\n          } else if (selectedInquiry.createdBy.username || selectedInquiry.createdBy.userName) {\r\n            recipientUsername = selectedInquiry.createdBy.username || selectedInquiry.createdBy.userName;\r\n          }\r\n          if (!recipientBarangayID && selectedInquiry.createdBy && (selectedInquiry.createdBy.barangayID)) {\r\n            recipientBarangayID = selectedInquiry.createdBy.barangayID;\r\n          }\r\n        }\r\n\r\n        // Try to resolve from the cached residents list by matching the display label if still missing\r\n        if ((!recipientUsername || recipientUsername === '') && Array.isArray(residents) && selectedInquiry.residentName) {\r\n          const match = residents.find(r => r.label && r.label.toString().toLowerCase() === (selectedInquiry.residentName || '').toString().toLowerCase());\r\n          if (match) {\r\n            recipientUsername = (match as any).username || recipientUsername;\r\n            recipientBarangayID = (match as any).barangayID || recipientBarangayID;\r\n          }\r\n        }\r\n\r\n        const payload: any = {\r\n          type: 'staff_message',\r\n          subject: `Message to ${selectedInquiry.residentName}`,\r\n          message: replyText.trim(),\r\n          // Include explicit recipient identifiers so resident's getMyInquiries will find it\r\n          ...(recipientUsername ? { username: recipientUsername } : {}),\r\n          ...(recipientBarangayID ? { barangayID: recipientBarangayID } : {}),\r\n          // optional: server may accept assignedTo / assignedRole depending on API\r\n        };\r\n\r\n        // If we couldn't resolve a recipient for a staff-created thread, block sending and show an error\r\n        if (!payload.username) {\r\n          antdMessage.error('Please select a resident to send this message to.');\r\n          // Also log for debugging\r\n          // eslint-disable-next-line no-console\r\n          console.warn('Blocked staff-created inquiry without recipient', { selectedInquiry, residents });\r\n          return;\r\n        }\r\n\r\n        // Log payload right before submitting so we can inspect what is being sent\r\n        // eslint-disable-next-line no-console\r\n        console.debug('Submitting staff-created inquiry payload', payload, { selectedInquirySummary: { residentName: selectedInquiry.residentName, residentUsername: selectedInquiry.residentUsername, residentBarangayID: (selectedInquiry as any).residentBarangayID } });\r\n\r\n        const created = await contactAPI.submitInquiry(payload);\r\n        antdMessage.success(`Message sent to ${selectedInquiry.residentName || payload.username}`);\r\n        // add to list and open created thread\r\n        setInquiries(prev => [created].concat(prev));\r\n        setSelectedInquiry(created);\r\n        setReplyText('');\r\n      } else {\r\n        const resp = await contactAPI.respondToInquiry(id, { response: replyText.trim() });\r\n        setInquiries(prev => prev.map(i => i._id === resp._id ? resp : i));\r\n        setSelectedInquiry(resp);\r\n        setReplyText('');\r\n      }\r\n    } catch (e) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('reply failed', e);\r\n    } finally {\r\n      setReplyLoading(s => ({ ...s, [id]: false }));\r\n    }\r\n  };\r\n\r\n  const handleResolve = async () => {\r\n    if (!selectedInquiry || !selectedInquiry._id) return;\r\n    const id = selectedInquiry._id;\r\n    try {\r\n      const resp = await contactAPI.resolveInquiry(id);\r\n      setInquiries(prev => prev.map(i => i._id === resp._id ? resp : i));\r\n      setSelectedInquiry(resp);\r\n    } catch (e) {\r\n      // eslint-disable-next-line no-console\r\n      console.error('resolve failed', e);\r\n    }\r\n  };\r\n\r\n  const filtered = inquiries.filter((inquiry) => {\r\n    let statusMatch = true;\r\n    if (filter.status === 'pending') statusMatch = !inquiry.responses || inquiry.responses.length === 0;\r\n    if (filter.status === 'responded') statusMatch = inquiry.status === 'resolved' || (inquiry.responses && inquiry.responses.length > 0);\r\n    if (filter.status === 'closed') statusMatch = inquiry.status === 'closed';\r\n    let categoryMatch = true;\r\n    if (category && category !== 'All') categoryMatch = inquiry.category === category;\r\n    const search = (filter.search || '').toLowerCase();\r\n    const searchMatch = !search || (inquiry.residentName && inquiry.residentName.toLowerCase().includes(search)) || (inquiry.subject && inquiry.subject.toLowerCase().includes(search));\r\n    return statusMatch && categoryMatch && searchMatch;\r\n  });\r\n\r\n  return (\r\n    <div style={{ minHeight: '100vh', background: '#f7f9fb', padding: 24 }}>\r\n      <Card style={{ maxWidth: 1200, margin: '0 auto', borderRadius: 12 }} bodyStyle={{ padding: 0 }}>\r\n        <div style={{ padding: 20 }}>\r\n          <Row gutter={[12, 12]} align=\"middle\">\r\n            <Col xs={24} sm={6}>\r\n              <Select value={category} onChange={(v) => setCategory(v)} style={{ width: '100%' }}>\r\n                <Select.Option value=\"All\">All</Select.Option>\r\n                <Select.Option value=\"Complaints\">Complaints</Select.Option>\r\n                <Select.Option value=\"Requests\">Requests</Select.Option>\r\n                <Select.Option value=\"Announcements\">Announcements</Select.Option>\r\n              </Select>\r\n            </Col>\r\n            <Col xs={24} sm={12}>\r\n              <Input.Search\r\n                placeholder=\"Search by name or subject\"\r\n                allowClear\r\n                value={filter.search}\r\n                onChange={(e: React.ChangeEvent<HTMLInputElement>) =>\r\n                  setFilter((s: FilterState) => ({ ...s, search: e.target.value }))\r\n                }\r\n                onSearch={(v: string) =>\r\n                  setFilter((s: FilterState) => ({ ...s, search: v }))\r\n                }\r\n              />\r\n            </Col>\r\n            <Col xs={24} sm={6}>\r\n              <Tabs activeKey={filter.status || 'all'} onChange={(k) => setFilter(s => ({ ...s, status: k }))}>\r\n                <Tabs.TabPane tab=\"All\" key=\"all\" />\r\n                <Tabs.TabPane tab=\"Pending\" key=\"pending\" />\r\n                <Tabs.TabPane\r\n                  tab={\r\n                    <span>\r\n                      Responded{' '}\r\n                      <Button\r\n                        type=\"link\"\r\n                        size=\"small\"\r\n                        style={{ marginLeft: 20 }}\r\n                        icon={<PlusOutlined />}\r\n                        onClick={(e) => {\r\n                          // prevent tab change when clicking the icon\r\n                          e.stopPropagation();\r\n                          (async () => {\r\n                            setResidentsModalVisible(true);\r\n                            setResidentsLoading(true);\r\n                            try {\r\n                              const users: any[] = await adminAPI.getUsers();\r\n                              // Heuristic: users that appear to be residents\r\n                              const list = (users || []).filter(u => {\r\n                                const role = (u.role || u.type || '').toString().toLowerCase();\r\n                                return role.includes('resident') || (!role.includes('admin') && !role.includes('staff'));\r\n                              }).map(u => ({\r\n                                label: u.fullName || (u.firstName && u.lastName ? `${u.firstName} ${u.lastName}` : (u.username || u.email || u.name)),\r\n                                // Be liberal in picking a username-like identifier: username, userName, email, or _id\r\n                                username: u.username || u.userName || u.email || u._id,\r\n                                // Barangay ID may be stored in several fields depending on user record shape\r\n                                barangayID: u.barangayID || u.brgy || (u.barangay && (u.barangay.id || u.barangayID))\r\n                              }));\r\n                              setResidents(list.filter(r => r && r.label));\r\n                            } catch (err) {\r\n                              // fallback: empty list\r\n                              setResidents([]);\r\n                            } finally {\r\n                              setResidentsLoading(false);\r\n                            }\r\n                          })();\r\n                        }}\r\n                      />\r\n                    </span>\r\n                  }\r\n                  key=\"responded\"\r\n                />\r\n              </Tabs>\r\n            </Col>\r\n          </Row>\r\n        </div>\r\n        <Divider style={{ margin: 0 }} />\r\n        <Modal\r\n          title=\"Residents\"\r\n          visible={residentsModalVisible}\r\n          onCancel={() => setResidentsModalVisible(false)}\r\n          footer={null}\r\n        >\r\n          {residentsLoading ? <div style={{ textAlign: 'center' }}><Spin /></div> : (\r\n            residents.length === 0 ? (\r\n              <Typography.Text type=\"secondary\">No residents found.</Typography.Text>\r\n            ) : (\r\n              <List\r\n                dataSource={residents}\r\n                renderItem={resident => (\r\n                    <List.Item style={{ cursor: 'pointer' }} onClick={() => {\r\n                    const name = resident.label;\r\n                    const username = resident.username;\r\n                    const barangayID = (resident as any).barangayID;\r\n                    // Try to find an existing inquiry for this resident by username or display name\r\n                    const found = inquiries.find(i => {\r\n                      const rn = (i.username || i.residentName || i.createdBy && (i.createdBy.username || '') || '').toString().toLowerCase();\r\n                      return rn && (username ? rn === (username || '').toString().toLowerCase() : rn === (name || '').toString().toLowerCase());\r\n                    });\r\n                    if (found) {\r\n                      setSelectedInquiry(found);\r\n                      setResidentsModalVisible(false);\r\n                    } else {\r\n                      // create a temporary thread object so staff can send a message\r\n                      const temp: any = {\r\n                        _id: `new-${Date.now()}`,\r\n                        residentName: name,\r\n                        residentUsername: username,\r\n                        residentBarangayID: barangayID,\r\n                        message: '',\r\n                        responses: [],\r\n                        isNewThread: true,\r\n                      };\r\n                      setSelectedInquiry(temp);\r\n                      // debug log the temp selection to ensure username/barangayID are present\r\n                      // eslint-disable-next-line no-console\r\n                      console.debug('Resident selected for new thread', temp);\r\n                      setResidentsModalVisible(false);\r\n                    }\r\n                  }}>\r\n                    <List.Item.Meta\r\n                      avatar={<Avatar style={{ background: '#1890ff' }}>{getInitial(resident.label)}</Avatar>}\r\n                      title={resident.label}\r\n                    />\r\n                  </List.Item>\r\n                )}\r\n              />\r\n            )\r\n          )}\r\n        </Modal>\r\n        <div style={{ padding: 16 }}>\r\n          {loading ? <Spin /> : filtered.length === 0 ? (\r\n            <Result icon={<InboxOutlined />} title=\"No inquiries\" subTitle=\"There are no inquiries to show.\" />\r\n          ) : (\r\n            <div style={{ display: 'flex', gap: 16 }}>\r\n              <div style={{ width: 320, maxHeight: 520, overflowY: 'auto' }}>\r\n                <List\r\n                  dataSource={filtered}\r\n                  renderItem={inquiry => (\r\n                    <List.Item onClick={() => openThread(inquiry)} style={{ cursor: 'pointer', marginBottom: 8, borderRadius: 8, padding: 8, border: selectedInquiry && selectedInquiry._id === inquiry._id ? '1px solid #1890ff' : '1px solid #eee' }}>\r\n                      <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\r\n                        <Avatar style={{ background: '#1890ff' }}>{getInitial(inquiry.residentName || inquiry.username || inquiry.subject, '?')}</Avatar>\r\n                        <div style={{ flex: 1, minWidth: 0 }}>\r\n                          <div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                            <Typography.Text strong style={{ overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{inquiry.residentName || inquiry.username || 'Unknown'}</Typography.Text>\r\n                            <Typography.Text type=\"secondary\" style={{ fontSize: 12 }}> {inquiry.subject || 'No subject'}</Typography.Text>\r\n                            <span style={{ marginLeft: 'auto', fontSize: 11 }}>{inquiry.createdAt ? timeAgo(inquiry.createdAt) : ''}</span>\r\n                          </div>\r\n                          <Typography.Text type=\"secondary\" style={{ display: 'block', fontSize: 13, overflow: 'hidden', textOverflow: 'ellipsis', whiteSpace: 'nowrap' }}>{inquiry.message}</Typography.Text>\r\n                        </div>\r\n                      </div>\r\n                    </List.Item>\r\n                  )}\r\n                />\r\n              </div>\r\n\r\n              <div style={{ flex: 1 }}>\r\n                <Card style={{ borderRadius: 8 }} bodyStyle={{ display: 'flex', flexDirection: 'column', gap: 12, padding: 12 }}>\r\n                  {selectedInquiry ? (\r\n                    <>\r\n                      <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\r\n                        <div style={{ flex: 1 }}>\r\n                          <Typography.Text strong style={{ display: 'block' }}>{selectedInquiry.residentName || selectedInquiry.username || 'Unknown'}</Typography.Text>\r\n                          <Typography.Text type=\"secondary\">{selectedInquiry.createdAt ? new Date(selectedInquiry.createdAt).toLocaleString() : ''}</Typography.Text>\r\n                        </div>\r\n                        <Avatar size={48} style={{ background: '#1890ff' }}>{getInitial(selectedInquiry.residentName || selectedInquiry.username)}</Avatar>\r\n                      </div>\r\n                      <Divider />\r\n                      <div style={{ overflowY: 'auto', maxHeight: 340 }}>\r\n                        <div style={{ marginBottom: 8 }}>\r\n                          <Typography.Paragraph style={{ margin: 0 }}>{selectedInquiry.message}</Typography.Paragraph>\r\n                          {selectedInquiry.attachments && selectedInquiry.attachments.length > 0 && (\r\n                            <div style={{ marginTop: 8, display: 'flex', flexDirection: 'column', gap: 8 }}>\r\n                              {selectedInquiry.attachments.map((a: any, i: number) => {\r\n                                const url = a.url || a.path || '#';\r\n                                const filename = a.name || a.filename || 'attachment';\r\n                                const isImage = (a.contentType && a.contentType.startsWith('image/')) || /\\.(jpe?g|png|gif|webp)$/i.test(filename);\r\n                                return (\r\n                                  <div key={i}>\r\n                                    {isImage ? (\r\n                                      <a href={url} target=\"_blank\" rel=\"noreferrer\">\r\n                                        <img src={url} alt={filename} style={{ maxWidth: 220, maxHeight: 140, borderRadius: 8, objectFit: 'cover', border: '1px solid #f0f0f0' }} />\r\n                                      </a>\r\n                                    ) : (\r\n                                      <div>\r\n                                        <a href={url} target=\"_blank\" rel=\"noreferrer\">{filename}</a>\r\n                                        {a.size ? <span style={{ marginLeft: 8, color: '#888', fontSize: 12 }}>({Math.round(a.size/1024)} KB)</span> : null}\r\n                                      </div>\r\n                                    )}\r\n                                  </div>\r\n                                );\r\n                              })}\r\n                            </div>\r\n                          )}\r\n                        </div>\r\n                        {Array.isArray(selectedInquiry.responses) && selectedInquiry.responses.map((r: any, idx: number) => {\r\n                          // Determine role heuristics similar to resident inbox to calculate alignment\r\n                          const roleRaw = r.role || r.authorRole || r.author_role || '';\r\n                          let role = (roleRaw || '').toString().toLowerCase();\r\n                          const authorRaw = r.author || r.authorName || r.author_name || r.createdByName || r.createdByFullName || r.userName || r.user || '';\r\n                          const createdById = r.createdBy ? String(r.createdBy) : undefined;\r\n                          const currentUserId = undefined; // staff view does not mark current user specially here\r\n\r\n                          // Heuristic: if role missing, try to detect resident replies by matching selectedInquiry createdBy/residentId\r\n                          if (!role) {\r\n                            try {\r\n                              let residentId: string | undefined;\r\n                              if (selectedInquiry) {\r\n                                if (selectedInquiry.createdBy && typeof selectedInquiry.createdBy === 'string') residentId = String(selectedInquiry.createdBy);\r\n                                else if (selectedInquiry.createdBy && typeof selectedInquiry.createdBy === 'object' && (selectedInquiry.createdBy._id || selectedInquiry.createdBy.id)) residentId = String(selectedInquiry.createdBy._id || selectedInquiry.createdBy.id);\r\n                                else if (selectedInquiry.residentId) residentId = String(selectedInquiry.residentId);\r\n                              }\r\n                              const residentName = (selectedInquiry && (selectedInquiry.residentName || selectedInquiry.username || '')) ? String(selectedInquiry.residentName || selectedInquiry.username).toLowerCase() : '';\r\n                              const authorName = (authorRaw || r.authorName || '').toString().toLowerCase();\r\n                              if (residentId && createdById && residentId === createdById) {\r\n                                role = 'resident';\r\n                              } else if (residentName && authorName && residentName === authorName) {\r\n                                role = 'resident';\r\n                              }\r\n                            } catch (e) {\r\n                              // ignore\r\n                            }\r\n                          }\r\n\r\n                          let authorDisplay: string;\r\n                          if (authorRaw && authorRaw.trim() !== '') authorDisplay = authorRaw;\r\n                          else if (r.authorName && r.authorName.trim() !== '') authorDisplay = r.authorName;\r\n                          else if (r.createdBy && typeof r.createdBy === 'object' && (r.createdBy.fullName || r.createdBy.username)) authorDisplay = r.createdBy.fullName || r.createdBy.username;\r\n                          else authorDisplay = role === 'resident' ? (selectedInquiry && (selectedInquiry.residentName || selectedInquiry.username) ? (selectedInquiry.residentName || selectedInquiry.username) : 'Resident') : 'Staff';\r\n\r\n                          const isResidentReply = role === 'resident' || role === 'user';\r\n                          const align: 'left' | 'right' = isResidentReply ? 'right' : 'left';\r\n\r\n                          const avatarNode = isResidentReply ? (\r\n                            <Avatar style={{ background: '#1890ff' }}>{getInitial(authorDisplay, 'U')}</Avatar>\r\n                          ) : (\r\n                            <Avatar style={{ background: '#666' }}>{getInitial(authorDisplay, 'B')}</Avatar>\r\n                          );\r\n\r\n                          return (\r\n                            <div key={idx} style={{ alignSelf: isResidentReply ? 'flex-end' : 'flex-start', maxWidth: '100%' }}>\r\n                              <MessageComment\r\n                                author={authorDisplay}\r\n                                avatar={avatarNode}\r\n                                content={<div style={{ background: isResidentReply ? '#e6f7ff' : '#f6f6f6', padding: 10, borderRadius: 8 }}>\r\n                                  <Typography.Paragraph style={{ margin: 0 }}>{r.text}</Typography.Paragraph>\r\n                                  {r.attachments && r.attachments.length > 0 && (\r\n                                    <div style={{ marginTop: 8, display: 'flex', flexDirection: 'column', gap: 8 }}>\r\n                                      {r.attachments.map((a: any, j: number) => {\r\n                                        const url = a.url || a.path || '#';\r\n                                        const filename = a.name || a.filename || 'attachment';\r\n                                        const isImage = (a.contentType && a.contentType.startsWith('image/')) || /\\.(jpe?g|png|gif|webp)$/i.test(filename);\r\n                                        return (\r\n                                          <div key={j}>\r\n                                            {isImage ? (\r\n                                              <a href={url} target=\"_blank\" rel=\"noreferrer\">\r\n                                                <img src={url} alt={filename} style={{ maxWidth: 220, maxHeight: 140, borderRadius: 8, objectFit: 'cover', border: '1px solid #f0f0f0' }} />\r\n                                              </a>\r\n                                            ) : (\r\n                                              <div>\r\n                                                <a href={url} target=\"_blank\" rel=\"noreferrer\">{filename}</a>\r\n                                                {a.size ? <span style={{ marginLeft: 8, color: '#888', fontSize: 12 }}>({Math.round(a.size/1024)} KB)</span> : null}\r\n                                              </div>\r\n                                            )}\r\n                                          </div>\r\n                                        );\r\n                                      })}\r\n                                    </div>\r\n                                  )}\r\n                                </div>}\r\n                                datetime={<span style={{ fontSize: 12 }}>{r.createdAt ? new Date(r.createdAt).toLocaleString() : ''}</span>}\r\n                                align={align}\r\n                              />\r\n                            </div>\r\n                          );\r\n                        })}\r\n                        <div ref={messagesEndRef} />\r\n                      </div>\r\n\r\n                      <div style={{ display: 'flex', gap: 8, marginTop: 8, alignItems: 'center' }}>\r\n                        <textarea\r\n                          value={replyText}\r\n                          onChange={e => {\r\n                            setReplyText(e.target.value);\r\n                            const el = e.target as HTMLTextAreaElement;\r\n                            el.style.height = 'auto';\r\n                            el.style.height = Math.min(200, el.scrollHeight) + 'px';\r\n                          }}\r\n                          onKeyDown={async (e) => {\r\n                            if (e.key === 'Enter' && !e.shiftKey) {\r\n                              e.preventDefault();\r\n                              await handleSendReply();\r\n                            }\r\n                          }}\r\n                          placeholder=\"Type your reply...\"\r\n                          style={{ flex: 1, minHeight: 40, maxHeight: 200, padding: 10, borderRadius: 8, resize: 'none' }}\r\n                        />\r\n                        <Button type=\"primary\" icon={<SendOutlined />} loading={!!(selectedInquiry && replyLoading[selectedInquiry._id])} onClick={handleSendReply} />\r\n                        <Button icon={<CheckOutlined />} onClick={handleResolve}>Resolve</Button>\r\n                      </div>\r\n                    </>\r\n                  ) : (\r\n                    <div style={{ textAlign: 'center', padding: 32 }}>\r\n                      <Typography.Text type=\"secondary\">Select an inquiry to view details</Typography.Text>\r\n                    </div>\r\n                  )}\r\n                </Card>\r\n              </div>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default StaffInbox;\r\n","import React, { createContext, useContext, useReducer, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { authService } from '../services/api';\r\nimport { AuthState, User } from '../types/auth';\r\nimport { jwtDecode } from 'jwt-decode';\r\n\r\ninterface AuthContextType extends AuthState {\r\n  login: (token: string) => void;\r\n  logout: () => void;\r\n  isStaff: () => boolean;\r\n  isAdmin: () => boolean;\r\n  isResident: () => boolean;\r\n  mode: 'resident' | 'staff';\r\n  switchMode: (mode: 'resident' | 'staff') => void;\r\n  setUser?: (user: User | null) => void;\r\n}\r\n\r\nconst initialState: AuthState = {\r\n  isAuthenticated: false,\r\n  user: null,\r\n  token: null,\r\n};\r\n\r\nconst AuthContext = createContext<AuthContextType>({\r\n  ...initialState,\r\n  login: () => {},\r\n  logout: () => {},\r\n  isStaff: () => false,\r\n  isAdmin: () => false,\r\n  isResident: () => false,\r\n  mode: 'resident',\r\n  switchMode: () => {},\r\n});\r\n\r\nexport const useAuth = () => useContext(AuthContext);\r\n\r\ntype AuthAction =\r\n  | { type: 'LOGIN'; payload: string }\r\n  | { type: 'LOGOUT' }\r\n  | { type: 'RESTORE_TOKEN'; payload: string };\r\n\r\n// Safely decode JWT payload to a User object. Returns null on invalid token.\r\nfunction safeDecodeJwt(token?: string | null): User | null {\r\n  if (!token || typeof token !== 'string') return null;\r\n  // JWT should have three parts separated by dots\r\n  const parts = token.split('.');\r\n  if (parts.length !== 3) {\r\n    console.warn('safeDecodeJwt: token does not have 3 parts, skipping decode');\r\n    return null;\r\n  }\r\n  try {\r\n    // jwtDecode will throw if token part is invalid\r\n    return jwtDecode<User>(token);\r\n  } catch (err) {\r\n    console.warn('safeDecodeJwt: failed to decode token', err);\r\n    return null;\r\n  }\r\n}\r\n\r\nconst authReducer = (state: AuthState, action: AuthAction): AuthState => {\r\n  switch (action.type) {\r\n    case 'LOGIN':\r\n    case 'RESTORE_TOKEN': {\r\n      let user: User | null = null;\r\n      // Only attempt decode when payload looks like a JWT\r\n      user = safeDecodeJwt(action.payload);\r\n      return {\r\n        isAuthenticated: !!user,\r\n        token: user ? action.payload : null,\r\n        user,\r\n      };\r\n    }\r\n    case 'LOGOUT':\r\n      return initialState;\r\n    default:\r\n      return state;\r\n  }\r\n};\r\n\r\nexport const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {\r\n  const [state, dispatch] = useReducer(authReducer, initialState);\r\n  // If we have a cached full profile from previous session, hydrate it\r\n  useEffect(() => {\r\n    try {\r\n      const stored = localStorage.getItem('userProfile');\r\n      if (stored) {\r\n        const parsed = JSON.parse(stored);\r\n        if (parsed && parsed.username) {\r\n          const token = localStorage.getItem('token') || null;\r\n          // Only dispatch LOGIN if we have a valid-looking token\r\n          const decoded = safeDecodeJwt(token);\r\n          if (token && decoded) dispatch({ type: 'LOGIN', payload: token });\r\n          // Overwrite the decoded token user with the full profile\r\n          // Direct state mutation isn't exposed; we rely on components reading localStorage.userProfile when available.\r\n        }\r\n      }\r\n    } catch (err) {\r\n      // ignore\r\n    }\r\n  }, []);\r\n  const [mode, setMode] = React.useState<'resident' | 'staff'>('resident');\r\n  const navigate = useNavigate();\r\n\r\n  // Helper to check if JWT is expired\r\n  function isTokenValid(token: string): boolean {\r\n    try {\r\n      const decoded: any = safeDecodeJwt(token);\r\n      if (!decoded) return false;\r\n      if (!decoded.exp) return false;\r\n      const now = Date.now() / 1000;\r\n      return decoded.exp > now;\r\n    } catch {\r\n      return false;\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    const token = localStorage.getItem('token');\r\n    if (token && isTokenValid(token)) {\r\n      // Restore token and fetch the full user profile from server to populate barangayID and other fields\r\n      dispatch({ type: 'RESTORE_TOKEN', payload: token });\r\n      // Fetch full profile asynchronously and update state\r\n      (async () => {\r\n        try {\r\n          // Import here to avoid circular import at module load\r\n          const { authService } = await import('../services/api');\r\n          const profile = await authService.getCurrentUser();\r\n          if (profile) {\r\n            // Replace token-decoded user with full profile\r\n            dispatch({ type: 'LOGIN', payload: token });\r\n            // Directly replace stored token user via local storage (AuthContext uses token->user decode),\r\n            // but we also want the richer profile available on context.user; we'll patch state by dispatching RESTORE_TOKEN again with the same token\r\n            // and rely on components reading from localStorage or triggering a reload. For now, we set user in localStorage for consumers.\r\n            localStorage.setItem('userProfile', JSON.stringify(profile));\r\n          }\r\n        } catch (err) {\r\n          // ignore profile fetch errors; UI will fallback to token-decoded values\r\n        }\r\n      })();\r\n    } else {\r\n      localStorage.removeItem('token');\r\n      dispatch({ type: 'LOGOUT' });\r\n    }\r\n  }, []);\r\n\r\n  // Listen for cross-component user updates dispatched as a CustomEvent\r\n  useEffect(() => {\r\n    const handler = (e: Event) => {\r\n      try {\r\n        const ce = e as CustomEvent;\r\n        let updatedUser = ce?.detail;\r\n        if (!updatedUser) return;\r\n        // Support nested shapes: { user: {...} } or { data: { user: {...} } }\r\n        if (updatedUser.user) updatedUser = updatedUser.user;\r\n        if (updatedUser.data && updatedUser.data.user) updatedUser = updatedUser.data.user;\r\n        // If it's a deletion notification, and it affects current user, log out\r\n        const current = state.user as any;\r\n        if (!current) return;\r\n        if (updatedUser.deleted && updatedUser._id && current._id && updatedUser._id === current._id) {\r\n          // If the current user was deleted by admin, force logout\r\n          setUser(null);\r\n          return;\r\n        }\r\n        // Only update if the updated user matches the current user's id or username\r\n        if (updatedUser._id && current._id && updatedUser._id === current._id) {\r\n          setUser(updatedUser as User);\r\n        } else if (updatedUser.username && current.username && updatedUser.username === current.username) {\r\n          setUser(updatedUser as User);\r\n        }\r\n      } catch (err) {\r\n        // ignore\r\n      }\r\n    };\r\n    window.addEventListener('userProfileUpdated', handler as EventListener);\r\n    return () => window.removeEventListener('userProfileUpdated', handler as EventListener);\r\n  }, [state.user]);\r\n\r\n  const login = (token: string) => {\r\n    localStorage.setItem('token', token);\r\n    // Set cookie for backend authentication (expires in 1 day)\r\n    document.cookie = `token=${token}; path=/; max-age=86400; SameSite=Lax`;\r\n    dispatch({ type: 'LOGIN', payload: token });\r\n    // Fetch and persist full profile after login\r\n    (async () => {\r\n      try {\r\n        const { authService } = await import('../services/api');\r\n        const profile = await authService.getCurrentUser();\r\n        if (profile) {\r\n          localStorage.setItem('userProfile', JSON.stringify(profile));\r\n          // update state by re-dispatching login (so token will decode) -- components should read latest profile from localStorage when available\r\n          dispatch({ type: 'LOGIN', payload: token });\r\n        }\r\n      } catch (err) {\r\n        // ignore\r\n      }\r\n    })();\r\n  };\r\n\r\n  const setUser = (user: User | null) => {\r\n    if (user) {\r\n      // persist richer profile\r\n      localStorage.setItem('userProfile', JSON.stringify(user));\r\n      // also re-dispatch LOGIN with existing token to keep state consistent\r\n      const token = localStorage.getItem('token');\r\n      if (token) dispatch({ type: 'LOGIN', payload: token });\r\n    } else {\r\n      localStorage.removeItem('userProfile');\r\n      dispatch({ type: 'LOGOUT' });\r\n    }\r\n  };\r\n\r\n  const logout = () => {\r\n    // Try to notify backend, but don't block logout on failure\r\n    authService.logout().catch(() => {});\r\n    localStorage.removeItem('token');\r\n    // Remove the token cookie\r\n    document.cookie = 'token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT;';\r\n    dispatch({ type: 'LOGOUT' });\r\n    navigate('/login', { replace: true });\r\n  };\r\n\r\n  const isStaff = () => state.user?.role === 'staff';\r\n  const isAdmin = () => state.user?.role === 'admin';\r\n  const isResident = () => state.user?.role === 'resident';\r\n\r\n  const switchMode = (newMode: 'resident' | 'staff') => {\r\n    setMode(newMode);\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={{ \r\n      ...state, \r\n      login, \r\n      logout,\r\n      isStaff,\r\n      isAdmin,\r\n      isResident,\r\n      mode,\r\n      switchMode,\r\n      setUser,\r\n    }}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};\r\n","import React from 'react';\r\nimport { getAbsoluteApiUrl } from '../services/api';\r\n\r\ntype AvatarSource = {\r\n  profileImage?: string | null;\r\n  profileImageId?: string | null;\r\n  profilePicture?: string | null; // legacy\r\n  fullName?: string | null;\r\n  username?: string | null;\r\n  email?: string | null;\r\n};\r\n\r\ntype Props = {\r\n  user?: AvatarSource | null;\r\n  src?: string | null;\r\n  profileImageId?: string | null;\r\n  size?: number;\r\n  alt?: string;\r\n  className?: string;\r\n  style?: React.CSSProperties;\r\n};\r\n\r\nconst AvatarImage: React.FC<Props> = ({ user, src, profileImageId, size = 40, alt = '', className, style }) => {\r\n  const u = user as any;\r\n  const id = profileImageId || u?.profileImageId || null;\r\n  const imageSrc = src || u?.profileImage || u?.profilePicture || null;\r\n\r\n  if (id) {\r\n    // Use GridFS streaming endpoint\r\n    return (\r\n      <img\r\n        src={getAbsoluteApiUrl(`/resident/personal-info/avatar/${id}`)}\r\n        alt={alt || u?.fullName || u?.username || u?.email || 'avatar'}\r\n        width={size}\r\n        height={size}\r\n        style={{ width: size, height: size, borderRadius: '50%', objectFit: 'cover', ...style }}\r\n        className={className}\r\n      />\r\n    );\r\n  }\r\n\r\n  if (imageSrc) {\r\n    return (\r\n      <img\r\n        src={imageSrc}\r\n        alt={alt || u?.fullName || u?.username || u?.email || 'avatar'}\r\n        width={size}\r\n        height={size}\r\n        style={{ width: size, height: size, borderRadius: '50%', objectFit: 'cover', ...style }}\r\n        className={className}\r\n      />\r\n    );\r\n  }\r\n\r\n  // Fallback to ui-avatars\r\n  const name = (u?.fullName || u?.username || u?.email || '').toString();\r\n  const avatarUrl = `https://ui-avatars.com/api/?name=${encodeURIComponent(name)}&background=2196F3&color=fff&size=${Math.max(Math.min(size, 256), 32)}`;\r\n  return (\r\n    <img\r\n      src={avatarUrl}\r\n      alt={alt || name || 'avatar'}\r\n      width={size}\r\n      height={size}\r\n      style={{ width: size, height: size, borderRadius: '50%', objectFit: 'cover', ...style }}\r\n      className={className}\r\n    />\r\n  );\r\n};\r\n\r\nexport default AvatarImage;\r\n","import './responsive-system-title.css';\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Layout, Menu, Button, Space, Dropdown, Avatar } from 'antd';\r\nimport {\r\n  LogoutOutlined,\r\n  ClockCircleOutlined,\r\n  UserOutlined,\r\n  NotificationOutlined,\r\n  SettingOutlined,\r\n  HomeOutlined,\r\n  FileTextOutlined,\r\n  MessageOutlined,\r\n  InboxOutlined,\r\n  TeamOutlined,\r\n  BarChartOutlined,\r\n  HistoryOutlined,\r\n  FileDoneOutlined,\r\n  FileSearchOutlined,\r\n  FileProtectOutlined\r\n  ,MenuFoldOutlined, MenuUnfoldOutlined\r\n} from '@ant-design/icons';\r\nimport AvatarImage from './AvatarImage';\r\nimport { getAbsoluteApiUrl } from '../services/api';\r\nimport './AppLayoutSidebar.css';\r\nimport { useNavigate, useLocation } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\n\r\n// Date and Time display component (smaller, subtle, top-right)\r\nconst DateTimeDisplay: React.FC = () => {\r\n  const [now, setNow] = useState(new Date());\r\n  useEffect(() => {\r\n    const timer = setInterval(() => setNow(new Date()), 1000);\r\n    return () => clearInterval(timer);\r\n  }, []);\r\n  const pad = (n: number) => n.toString().padStart(2, '0');\r\n  const date = `${pad(now.getMonth() + 1)}/${pad(now.getDate())}/${now.getFullYear()}`;\r\n  const time = `${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;\r\n  return (\r\n    <span style={{ fontSize: 13, color: '#888', fontWeight: 500, letterSpacing: 0.5, marginRight: 8 }}>\r\n      <ClockCircleOutlined style={{ marginRight: 4 }} />\r\n      {date} {time}\r\n    </span>\r\n  );\r\n};\r\nconst { Header, Content, Sider } = Layout;\r\n\r\nconst SIDEBAR_WIDTH = 240;\r\nconst SIDEBAR_COLLAPSED_WIDTH = 64;\r\nconst HEADER_HEIGHT = 64;\r\n\r\nconst navConfig: {\r\n  resident: { key: string; icon: React.ReactNode; label: string }[];\r\n  admin: { key: string; icon: React.ReactNode; label: string }[];\r\n  staff: { key: string; icon: React.ReactNode; label: string }[];\r\n} = {\r\n  resident: [\r\n    {\r\n      key: '/home',\r\n      icon: <HomeOutlined />,\r\n      label: 'Home',\r\n    },\r\n    {\r\n      key: '/request',\r\n      icon: <FileTextOutlined />,\r\n      label: 'Request',\r\n    },\r\n    {\r\n      key: '/inquiries',\r\n      icon: <MessageOutlined />,\r\n      label: 'Inquiries',\r\n    },\r\n    {\r\n      key: '/inbox',\r\n      icon: <InboxOutlined />,\r\n      label: 'Inbox',\r\n    },\r\n  ],\r\n  admin: [\r\n    {\r\n      key: '/admin/dashboard',\r\n      icon: <HomeOutlined />,\r\n      label: 'Admin Dashboard',\r\n    },\r\n    {\r\n      key: '/admin/users',\r\n      icon: <TeamOutlined />,\r\n      label: 'User Management',\r\n    },\r\n    {\r\n      key: '/admin/activity',\r\n      icon: <FileSearchOutlined />,\r\n      label: 'Activity Logs',\r\n    },\r\n    {\r\n      key: '/admin/statistics',\r\n      icon: <BarChartOutlined />,\r\n      label: 'Statistics',\r\n    },\r\n    {\r\n      key: '/admin/settings',\r\n      icon: <SettingOutlined />,\r\n      label: 'System Settings',\r\n    },\r\n    {\r\n      key: '/admin/verification-requests',\r\n      icon: <FileProtectOutlined />,\r\n      label: 'Verification Requests',\r\n    },\r\n  ],\r\n  staff: [\r\n    {\r\n      key: '/staff-dashboard',\r\n      icon: <HomeOutlined />,\r\n      label: 'Staff Dashboard',\r\n    },\r\n    {\r\n      key: '/staff/inbox',\r\n      icon: <InboxOutlined />,\r\n      label: 'Staff Inbox',\r\n    },\r\n    {\r\n      key: '/templates-manager',\r\n      icon: <FileProtectOutlined />,\r\n      label: 'Templates Manager',\r\n    },\r\n    {\r\n      key: '/document-processing',\r\n      icon: <FileDoneOutlined />,\r\n      label: 'Document Processing',\r\n    },\r\n    {\r\n      key: '/document-history',\r\n      icon: <HistoryOutlined />,\r\n      label: 'Document History',\r\n    },\r\n  ],\r\n};\r\n\r\n\r\n\r\ntype AppLayoutProps = {\r\n  children: React.ReactNode;\r\n};\r\n\r\nconst AppLayout: React.FC<AppLayoutProps> = ({ children }) => {\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const { user } = useAuth();\r\n  // Prefer the context user but fall back to a persisted full profile in localStorage\r\n  let displayUser: any = user;\r\n  if (!displayUser) {\r\n    try {\r\n      const stored = localStorage.getItem('userProfile');\r\n      if (stored) displayUser = JSON.parse(stored);\r\n    } catch (err) {\r\n      // ignore\r\n    }\r\n  }\r\n\r\n  // Utility bar quick actions removed: online/status and dark-mode switch removed\r\n  // You can expand these as needed for your system\r\n  const [residentImageSrc, setResidentImageSrc] = useState<string | null>(null);\r\n  // Start collapsed by default so the navigation is compact on initial load.\r\n  const [collapsed, setCollapsed] = useState(true);\r\n\r\n  useEffect(() => {\r\n    (async () => {\r\n      try {\r\n        const api = await import('../services/api');\r\n        try {\r\n          const data = await api.residentPersonalInfoAPI.getPersonalInfo();\r\n          if (data?.profileImage) {\r\n            const url = data.profileImage.startsWith('http') ? data.profileImage : `${window.location.origin}${data.profileImage}`;\r\n            setResidentImageSrc(url);\r\n            return;\r\n          }\r\n          if (data?.profileImageId) {\r\n            setResidentImageSrc(getAbsoluteApiUrl(`/resident/personal-info/avatar/${data.profileImageId}`));\r\n            return;\r\n          }\r\n        } catch (err) {\r\n          // ignore\r\n        }\r\n        try {\r\n          const resp = await api.default.get('/resident/profile');\r\n          const d = resp.data;\r\n          if (d?.profileImage) {\r\n            const url = d.profileImage.startsWith('http') ? d.profileImage : `${window.location.origin}${d.profileImage}`;\r\n            setResidentImageSrc(url);\r\n          } else if (d?.profileImageId) {\r\n            setResidentImageSrc(getAbsoluteApiUrl(`/resident/personal-info/avatar/${d.profileImageId}`));\r\n          }\r\n        } catch (err) {\r\n          // ignore\r\n        }\r\n      } catch (err) {\r\n        // ignore\r\n      }\r\n    })();\r\n    const handler = (e: Event) => {\r\n      try {\r\n        const ce = e as CustomEvent;\r\n        const updated = ce?.detail;\r\n        if (!updated) return;\r\n        if (updated.profileImage) {\r\n          const url = updated.profileImage.startsWith('http') ? updated.profileImage : `${window.location.origin}${updated.profileImage}`;\r\n          setResidentImageSrc(url);\r\n        } else if (updated.profileImageId) {\r\n          setResidentImageSrc(getAbsoluteApiUrl(`/resident/personal-info/avatar/${updated.profileImageId}`));\r\n        }\r\n      } catch (err) {\r\n        // ignore\r\n      }\r\n    };\r\n    window.addEventListener('userProfileUpdated', handler as EventListener);\r\n    return () => window.removeEventListener('userProfileUpdated', handler as EventListener);\r\n  }, []);\r\n\r\n  // Close dropdown on outside click\r\n  // Removed notification dropdown logic\r\n\r\n  return (\r\n    <Layout style={{ minHeight: '100vh', background: '#000' }}>\r\n      {user && (\r\n        <Sider\r\n          width={SIDEBAR_WIDTH}\r\n          collapsed={collapsed}\r\n          collapsedWidth={SIDEBAR_COLLAPSED_WIDTH}\r\n          style={{\r\n            height: '100vh',\r\n            position: 'fixed',\r\n            left: 0,\r\n            top: 0,\r\n            background: 'linear-gradient(180deg, #40c9ff 0%, #e81cff 100%)', // Original vibrant blue to purple\r\n            display: 'flex',\r\n            flexDirection: 'column',\r\n            padding: 0,\r\n            zIndex: 100,\r\n            boxShadow: '2px 0 16px 0 rgba(64,201,255,0.10)',\r\n            borderRight: 'none',\r\n            overflowX: 'hidden',\r\n          }}\r\n        >\r\n          <div\r\n            style={{\r\n              flex: 1,\r\n              overflowY: 'auto',\r\n              overflowX: 'hidden',\r\n              padding: '24px 0 0 0',\r\n              display: 'flex',\r\n              flexDirection: 'column',\r\n            }}\r\n          >\r\n            <Menu\r\n              theme=\"light\"\r\n              mode=\"inline\"\r\n              selectedKeys={[location.pathname]}\r\n              style={{\r\n                background: 'transparent',\r\n                fontWeight: 600,\r\n                fontSize: 17,\r\n                border: 'none',\r\n              }}\r\n              inlineCollapsed={collapsed}\r\n              items={\r\n                navConfig[\r\n                  user?.role === 'admin'\r\n                    ? 'admin'\r\n                    : user?.role === 'staff'\r\n                    ? 'staff'\r\n                    : 'resident'\r\n                ].map(item => ({\r\n                  ...item,\r\n                  className: location.pathname === item.key ? 'ant-menu-item-active-custom' : undefined\r\n                }))\r\n              }\r\n              onClick={({ key }) => {\r\n                if (location.pathname !== key) {\r\n                  navigate(key);\r\n                }\r\n              }}\r\n            />\r\n          </div>\r\n        </Sider>\r\n      )}\r\n  <Layout style={{ marginLeft: user ? (collapsed ? SIDEBAR_COLLAPSED_WIDTH : SIDEBAR_WIDTH) : 0 }}>\r\n        <Header\r\n          style={{\r\n            height: HEADER_HEIGHT,\r\n            background: '#fff',\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            justifyContent: 'space-between',\r\n            padding: '0 32px',\r\n            position: 'fixed',\r\n            left: user ? (collapsed ? SIDEBAR_COLLAPSED_WIDTH : SIDEBAR_WIDTH) : 0,\r\n            right: 0,\r\n            top: 0,\r\n            zIndex: 101,\r\n            boxShadow: '0 2px 8px #e3e6f3',\r\n          }}\r\n        >\r\n          <div\r\n            className=\"responsive-system-title\"\r\n            style={{\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              gap: 12,\r\n              maxWidth: '100%',\r\n              overflow: 'hidden',\r\n              textOverflow: 'ellipsis',\r\n              whiteSpace: 'nowrap',\r\n            }}\r\n          >\r\n            {user && (\r\n              <Button type=\"text\" onClick={() => setCollapsed(c => !c)} style={{ marginRight: 6 }} icon={collapsed ? <MenuUnfoldOutlined /> : <MenuFoldOutlined />} />\r\n            )}\r\n            {/* Logo icon (served from public/) */}\r\n            <img src={`${process.env.PUBLIC_URL}/logo-parian2.png`} alt=\"Logo\" style={{ width: 36, height: 36, marginRight: 4 }} />\r\n            <span style={{\r\n              fontSize: 26,\r\n              fontWeight: 400,\r\n              letterSpacing: 1,\r\n              background: 'linear-gradient(90deg, #40c9ff, #e81cff)',\r\n              WebkitBackgroundClip: 'text',\r\n              WebkitTextFillColor: 'transparent',\r\n              display: 'inline-block',\r\n              maxWidth: '100%',\r\n              overflow: 'hidden',\r\n              textOverflow: 'ellipsis',\r\n              whiteSpace: 'nowrap',\r\n            }}>\r\n              Barangay Information <span style={{ fontWeight: 800 }}>Management System</span>\r\n            </span>\r\n          </div>\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 16, position: 'relative', marginRight: 8 }}>\r\n            <span style={{ marginRight: 8 }}>\r\n              <DateTimeDisplay />\r\n            </span>\r\n            {/* Utility bar: quick actions */}\r\n            <Space size={12}>\r\n              {displayUser && (\r\n                // Route admins to admin management, others to public announcements\r\n                <Button size=\"small\" onClick={() => navigate(displayUser?.role === 'admin' ? '/admin/announcements' : '/announcements')}\r\n                  icon={<NotificationOutlined />}\r\n                />\r\n              )}\r\n            </Space>\r\n            {/* profile avatar (notification bell removed) */}\r\n            <Dropdown\r\n              popupRender={() => (\r\n                <Menu>\r\n                  <Menu.Item key=\"profile\" icon={<UserOutlined />} onClick={() => navigate('/profile')}>\r\n                    Profile\r\n                  </Menu.Item>\r\n                  <Menu.Item key=\"settings\" icon={<SettingOutlined />} onClick={() => navigate('/admin/settings')}>\r\n                    Settings\r\n                  </Menu.Item>\r\n                  <Menu.Divider />\r\n                  <Menu.Item key=\"logout\" icon={<LogoutOutlined />} onClick={() => navigate('/logout')}>\r\n                    Logout\r\n                  </Menu.Item>\r\n                </Menu>\r\n              )}\r\n              placement=\"bottomRight\"\r\n              trigger={['click']}\r\n            >\r\n                <Avatar size={36} shape=\"circle\">\r\n                  {residentImageSrc ? (\r\n                    <img src={residentImageSrc} alt={displayUser?.fullName || displayUser?.username || 'avatar'} width={36} height={36} style={{ width: 36, height: 36, borderRadius: '50%', objectFit: 'cover' }} />\r\n                  ) : (displayUser && (displayUser.profileImage || displayUser.profilePicture || displayUser.profileImageId) ? (\r\n                    <AvatarImage user={displayUser} size={36} />\r\n                  ) : (\r\n                    <UserOutlined />\r\n                  ))}\r\n                </Avatar>\r\n            </Dropdown>\r\n          </div>\r\n  </Header>\r\n  {/* Divider line below header */}\r\n  <div style={{ height: 1, background: '#f0f0f0', width: '100%', margin: 0, boxShadow: 'none' }} />\r\n        <Content\r\n          style={{\r\n            marginTop: HEADER_HEIGHT,\r\n            padding: 32,\r\n            background: 'linear-gradient(135deg, #e3f6fd 0%, #b3e0ff 60%,  #b3e0ff 100%)',\r\n            minHeight: `calc(100vh - ${HEADER_HEIGHT}px)`,\r\n          }}\r\n        >\r\n          {children}\r\n        </Content>\r\n      </Layout>\r\n    </Layout>\r\n  );\r\n};\r\n\r\nexport default AppLayout;\r\n","\r\nimport React from 'react';\r\nimport AppLayout from './AppLayout';\r\nimport { Outlet } from 'react-router-dom';\r\n\r\ninterface LayoutProps {\r\n  children?: React.ReactNode;\r\n}\r\n\r\nconst Layout: React.FC<LayoutProps> = ({ children }) => {\r\n  // If children are passed, render them (for legacy usage), otherwise render <Outlet /> for nested routes\r\n  return <AppLayout>{children || <Outlet />}</AppLayout>;\r\n};\r\n\r\nexport default Layout;\r\n","import React from 'react';\r\nimport { Navigate } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\n\r\ninterface PrivateRouteProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst PrivateRoute: React.FC<PrivateRouteProps> = ({ children }) => {\r\n  const { isAuthenticated, user } = useAuth();\r\n\r\n  // Allow access when a valid JWT-authenticated user exists OR when a guest profile is present\r\n  // Guest users are stored in context.user with role === 'guest' (set by LoginForm). We treat that as allowed.\r\n  if (!isAuthenticated && !(user && (user as any).role === 'guest')) {\r\n    return <Navigate to=\"/login\" replace />;\r\n  }\r\n\r\n  return <>{children}</>;\r\n};\r\n\r\nexport default PrivateRoute;\r\n","import React from 'react';\r\nimport { Navigate } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\n\r\ninterface StaffRouteProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nconst StaffRoute: React.FC<StaffRouteProps> = ({ children }) => {\r\n  const { isAuthenticated, user } = useAuth();\r\n\r\n  if (!isAuthenticated) {\r\n    return <Navigate to=\"/login\" replace />;\r\n  }\r\n\r\n  if (user?.role !== 'staff' && user?.role !== 'admin') {\r\n    return <Navigate to=\"/dashboard\" replace />;\r\n  }\r\n\r\n  return <>{children}</>;\r\n};\r\n\r\nexport default StaffRoute;\r\n","import React from 'react';\r\nimport { Navigate, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { Spin, Result, Button } from 'antd';\r\n\r\ninterface AdminRouteProps {\r\n  children: React.ReactElement;\r\n}\r\n\r\nconst AdminRoute: React.FC<AdminRouteProps> = ({ children }) => {\r\n  const auth = useAuth();\r\n  const navigate = useNavigate();\r\n\r\n  const currentUser = auth?.user as any;\r\n  const isAdmin = typeof auth?.isAdmin === 'function' ? auth.isAdmin() : currentUser?.role === 'admin' || currentUser?.isAdmin === true;\r\n\r\n  // If no user but there is a token in storage, auth restore may be in progress  show a spinner\r\n  const token = typeof window !== 'undefined' ? localStorage.getItem('token') : null;\r\n  if (!currentUser && token) {\r\n    return (\r\n      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', height: '100%' }}>\r\n        <Spin size=\"large\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  // Not authenticated  redirect to login\r\n  if (!currentUser) {\r\n    return <Navigate to=\"/login\" replace />;\r\n  }\r\n\r\n  // Authenticated but not admin  show 403\r\n  if (!isAdmin) {\r\n    return (\r\n      <Result\r\n        status=\"403\"\r\n        title=\"403\"\r\n        subTitle=\"Sorry, you are not authorized to access this page.\"\r\n        extra={<Button type=\"primary\" onClick={() => navigate('/dashboard')}>Go to Dashboard</Button>}\r\n      />\r\n    );\r\n  }\r\n\r\n  return children;\r\n};\r\n\r\nexport default AdminRoute;\r\n","import { getAbsoluteApiUrl, axiosPublic, axiosInstance } from '../services/api';\r\n\r\nexport interface OfficialLite {\r\n  _id?: string;\r\n  photo?: any;\r\n  photoUrl?: string;\r\n  photoPath?: string;\r\n  previewUrl?: string;\r\n}\r\n\r\nexport interface PublicOfficial {\r\n  _id: string;\r\n  name?: string;\r\n  title?: string;\r\n  term?: string;\r\n  hasPhoto?: boolean;\r\n}\r\n\r\n/**\r\n * Return a URL string to display for an official's photo.\r\n * Priority:\r\n * 1. previewUrl (object URL for immediate client preview)\r\n * 2. DB photo bytes served at /api/admin/officials/:id/photo when `photo` is present\r\n * 3. photoUrl (legacy full URL)\r\n * 4. photoPath (legacy disk path)\r\n * 5. default avatar\r\n */\r\n\r\nexport function getOfficialPhotoSrc(off: OfficialLite) {\r\n  if (!off) return '/Templates/default-avatar.png';\r\n  if (off.previewUrl) return off.previewUrl;\r\n  // If the document has raw photo bytes (admin view) prefer admin photo endpoint\r\n  if ((off as any).photo && off._id) return getAbsoluteApiUrl(`/admin/officials/${off._id}/photo`);\r\n  // If we're dealing with a public official object that only exposes a flag, use the public photo route\r\n  if ((off as any).hasPhoto && off._id) return getAbsoluteApiUrl(`/officials/${off._id}/photo`);\r\n  if (off.photoUrl) return off.photoUrl;\r\n  if (off.photoPath) return getAbsoluteApiUrl(`/${off.photoPath.replace(/^\\//, '')}`);\r\n  return '/Templates/default-avatar.png';\r\n}\r\n\r\nexport default getOfficialPhotoSrc;\r\n\r\n/**\r\n * Fetch public barangay officials for display on unauthenticated pages.\r\n * Calls server public route GET /api/officials which returns minimal fields.\r\n*/\r\n\r\nexport async function fetchPublicOfficials(): Promise<PublicOfficial[]> {\r\n  try {\r\n    // Prefer the public axios instance which respects runtime API_BASE\r\n    const res = await axiosPublic.get('/officials');\r\n    let data: any = res.data;\r\n    // handle wrapped payloads like { data: [...] } or { officials: [...] }\r\n    if (data && Array.isArray(data.data)) data = data.data;\r\n    if (data && Array.isArray(data.officials)) data = data.officials;\r\n    if (!Array.isArray(data)) {\r\n      console.warn('fetchPublicOfficials: unexpected payload shape', data);\r\n      return [];\r\n    }\r\n    if (data.length === 0) console.info('fetchPublicOfficials: server returned empty list');\r\n    return data as PublicOfficial[];\r\n  } catch (err) {\r\n    console.error('fetchPublicOfficials error', err);\r\n    return [];\r\n  }\r\n}\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Card, Typography, Statistic, Row, Col, Spin } from 'antd';\r\nimport { UserOutlined, CrownOutlined, TeamOutlined, HomeOutlined, FileTextOutlined, NotificationOutlined } from '@ant-design/icons';\r\nimport { adminAPI, documentsAPI, contactAPI } from '../services/api';\r\n\r\nconst StatsPanel: React.FC = () => {\r\n  const [stats, setStats] = useState<any | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      try {\r\n        // Fetch admin statistics, list of files, document requests, and public announcements in parallel\r\n        const [resStats, filesRes, docRequestsRes, announcementsRes] = await Promise.all([\r\n          adminAPI.getSystemStatistics(),\r\n          documentsAPI.listFiles().catch(() => ([])),\r\n          documentsAPI.getAllDocuments().catch(() => ([])),\r\n          contactAPI.getAnnouncements().catch(() => ([]))\r\n        ]);\r\n\r\n        if (mounted) {\r\n          // attach filesCount, docRequestsCount and announcementsCount to stats for display\r\n          const filesCount = Array.isArray(filesRes) ? filesRes.length : (filesRes && filesRes.length) || 0;\r\n          const docRequestsCount = Array.isArray(docRequestsRes) ? docRequestsRes.length : (docRequestsRes && docRequestsRes.length) || 0;\r\n          const announcementsCount = Array.isArray(announcementsRes) ? announcementsRes.length : (announcementsRes && announcementsRes.length) || 0;\r\n          setStats({ ...resStats, filesCount, docRequestsCount, announcementsCount });\r\n        }\r\n      } catch (err) {\r\n        console.error('Failed to load system statistics', err);\r\n      } finally {\r\n        if (mounted) setLoading(false);\r\n      }\r\n    })();\r\n    return () => { mounted = false; };\r\n  }, []);\r\n\r\n  if (loading) return <div style={{ width: '100%', textAlign: 'center' }}><Spin /></div>;\r\n  if (!stats) return <div style={{ textAlign: 'center' }}><Typography.Text type=\"secondary\">No statistics available</Typography.Text></div>;\r\n\r\n  const users = stats.users || {};\r\n  const documents = stats.documents || {};\r\n  const filesCount = stats.filesCount ?? 0;\r\n\r\n  // Arrange items so that with a 3-column layout the Documents tile falls under Admins\r\n  const items = [\r\n    { key: 'users', title: 'Total Users', value: users.total ?? 0, icon: <UserOutlined style={{ color: '#9254de', fontSize: 20 }} /> },\r\n    { key: 'admins', title: 'Admins', value: users.byRole?.admin ?? 0, icon: <CrownOutlined style={{ color: '#f5a623', fontSize: 20 }} /> },\r\n    { key: 'staff', title: 'Staff', value: users.byRole?.staff ?? 0, icon: <TeamOutlined style={{ color: '#1677ff', fontSize: 20 }} /> },\r\n    { key: 'residents', title: 'Residents', value: users.byRole?.resident ?? 0, icon: <HomeOutlined style={{ color: '#22c55e', fontSize: 20 }} /> },\r\n    { key: 'announcements', title: 'Announcements', value: stats.announcementsCount ?? 0, icon: <NotificationOutlined style={{ color: '#faad14', fontSize: 20 }} /> },\r\n    { key: 'docFiles', title: 'Documents Available', value: filesCount, icon: <FileTextOutlined style={{ color: '#0ea5e9', fontSize: 20 }} /> },\r\n  ];\r\n\r\n  return (\r\n    <Card className=\"glass-card stats-card\" bordered={false} style={{ width: '100%' }}>\r\n      <Typography.Title level={4}>Quick Stats</Typography.Title>\r\n      <div style={{ height: 6, background: 'linear-gradient(90deg, rgba(22,119,255,0.08), rgba(146,84,222,0.08))', borderRadius: 4, marginBottom: 12 }} />\r\n\r\n      <Row gutter={[12,12]} style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', flexWrap: 'wrap' }}>\r\n        {items.map(it => (\r\n          <Col key={it.key} xs={12} sm={8} md={8} lg={8} style={{ display: 'flex' }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: 12, width: '100%' }}>\r\n              <div style={{ width: 44, height: 44, display: 'flex', alignItems: 'center', justifyContent: 'center', background: 'rgba(255,255,255,0.9)', borderRadius: 8, boxShadow: '0 6px 14px rgba(2,6,23,0.06)' }}>\r\n                {it.icon}\r\n              </div>\r\n              <div style={{ flex: 1 }}>\r\n                <Statistic title={it.title} value={it.value} />\r\n              </div>\r\n            </div>\r\n          </Col>\r\n        ))}\r\n      </Row>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default StatsPanel;\r\n","import React, { useEffect, useRef, useState } from 'react';\r\nimport { Row, Col, Form, Input, Button, Card, Typography, message, Modal } from 'antd';\r\nimport { UserOutlined, LockOutlined } from '@ant-design/icons';\r\nimport { Link as RouterLink, useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { adminAPI, axiosPublic, axiosInstance, getAbsoluteApiUrl } from '../services/api';\r\nimport getOfficialPhotoSrc, { fetchPublicOfficials, PublicOfficial } from '../utils/officials';\r\nimport StatsPanel from './StatsPanel';\r\nimport './LoginForm.css';\r\nimport { LeftOutlined, RightOutlined } from '@ant-design/icons';\r\n\r\nconst LoginForm: React.FC = () => {\r\n  const { login, isAuthenticated, user, setUser } = useAuth() as any;\r\n  const [guestModalVisible, setGuestModalVisible] = useState(false);\r\n  const [emergencyModalVisible, setEmergencyModalVisible] = useState(false);\r\n  const [guestForm] = Form.useForm();\r\n  const navigate = useNavigate();\r\n  const [loading, setLoading] = useState(false);\r\n  const [officials, setOfficials] = useState<PublicOfficial[]>([]);\r\n  const [officialsStatus, setOfficialsStatus] = useState<string>('loading');\r\n  const carouselRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  useEffect(() => {\r\n    if (isAuthenticated && user) {\r\n      if (user.role === 'admin') navigate('/admin/dashboard');\r\n      else if (user.role === 'staff') navigate('/staff-dashboard');\r\n      else if ((user as any).role === 'guest') navigate('/guest/dashboard');\r\n      else navigate('/dashboard');\r\n    }\r\n  }, [isAuthenticated, user, navigate]);\r\n\r\n  useEffect(() => {\r\n    let mounted = true;\r\n    (async () => {\r\n      try {\r\n        setOfficialsStatus('fetching public');\r\n        const offs = await fetchPublicOfficials();\r\n        if (mounted && Array.isArray(offs) && offs.length > 0) {\r\n          setOfficials(offs);\r\n          setOfficialsStatus(`public:${offs.length}`);\r\n        } else {\r\n          // fallback attempt to admin endpoint (useful during local dev when auth may be present)\r\n          // Only attempt admin fallback if the current user is authenticated.\r\n          // Public (unauthenticated) visitors should not hit admin endpoints.\r\n          if (isAuthenticated) {\r\n            setOfficialsStatus('trying-admin-fallback');\r\n            try {\r\n              const adminOffs: any[] = await adminAPI.getOfficials();\r\n              if (mounted && Array.isArray(adminOffs) && adminOffs.length > 0) {\r\n                // normalize to PublicOfficial shape\r\n                const mapped = adminOffs.map(a => ({ _id: a._id, name: a.name, title: a.title, term: a.term, hasPhoto: !!a.photo || !!a.photoPath }));\r\n                setOfficials(mapped);\r\n                setOfficialsStatus(`admin:${mapped.length}`);\r\n              } else {\r\n                setOfficialsStatus('no-officials');\r\n              }\r\n            } catch (e) {\r\n              console.warn('Admin fallback failed', e);\r\n              setOfficialsStatus('error');\r\n            }\r\n          } else {\r\n            setOfficialsStatus('no-officials');\r\n          }\r\n        }\r\n      } catch (e) {\r\n        console.warn('Failed to fetch public officials for login preview', e);\r\n        setOfficialsStatus('error');\r\n      }\r\n    })();\r\n    return () => { mounted = false; };\r\n  }, []);\r\n\r\n  const onFinish = async (values: { username: string; password: string }) => {\r\n    setLoading(true);\r\n    try {\r\n      // Use axiosInstance so runtime API_BASE is respected and credentials are sent\r\n      const resp = await axiosInstance.post('/auth/login', { identifier: values.username, password: values.password });\r\n      const data = resp && resp.data ? resp.data : {};\r\n\r\n      if (!resp || resp.status >= 400) {\r\n        console.error('Login response not OK:', { status: resp?.status, data });\r\n        throw new Error(data.message || 'Login failed');\r\n      }\r\n\r\n      if (!data.token) {\r\n        console.error('No token in response:', data);\r\n        throw new Error('Login failed - No token received');\r\n      }\r\n\r\n      login(data.token);\r\n      message.success(data.message || 'Login successful!');\r\n      // navigation will occur in the useEffect above after auth state updates\r\n    } catch (err: any) {\r\n      message.error(err.message || 'Error logging in');\r\n      console.error('Login error:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n    <div className=\"login-page\">\r\n      <div className=\"login-container two-pane\">\r\n        <Row gutter={24} align=\"stretch\" justify=\"center\" className=\"two-pane-row\">\r\n          {/* Left combined pane - stats + officials */}\r\n          <Col xs={24} md={12} className=\"pane left-pane combined-pane\">\r\n            <div className=\"pane-inner left-inner\">\r\n              <div style={{ width: '100%', display: 'flex', flexDirection: 'column', gap: 18 }}>\r\n                <StatsPanel />\r\n                <Card className=\"glass-card preview-card invisible\" variant=\"outlined\">\r\n                  <Typography.Title level={4} style={{ marginBottom: 8 }}>Barangay Officials</Typography.Title>\r\n                  <div style={{ height: 6, background: 'linear-gradient(90deg, rgba(22,119,255,0.12), rgba(146,84,222,0.12))', borderRadius: 4, marginBottom: 12 }} />\r\n\r\n                  <div className=\"carousel-wrap\">\r\n                    <Button className=\"carousel-arrow left\" icon={<LeftOutlined />} onClick={() => {\r\n                      if (!carouselRef.current) return; carouselRef.current.scrollBy({ left: -240, behavior: 'smooth' });\r\n                    }} />\r\n                    <div ref={carouselRef} className=\"carousel-scroll\">\r\n                      {officials.length === 0 ? (\r\n                        <Typography.Text type=\"secondary\">No officials to preview</Typography.Text>\r\n                      ) : (\r\n                        officials.map(off => (\r\n                          <div key={off._id} className=\"official-card\">\r\n                            <div className=\"official-avatar\">\r\n                              <img\r\n                                alt={off.name}\r\n                                src={getOfficialPhotoSrc(off as any)}\r\n                                style={{ width: '100%', height: '100%', objectFit: 'cover' }}\r\n                                onError={(e) => {\r\n                                  try {\r\n                                    const t = e.currentTarget as HTMLImageElement;\r\n                                    t.onerror = null;\r\n                                    t.src = '/Templates/default-avatar.png';\r\n                                  } catch (err) {}\r\n                                }}\r\n                              />\r\n                            </div>\r\n                            <div style={{ fontWeight: 700 }}>{off.name}</div>\r\n                            <div style={{ color: '#666', fontSize: 13 }}>{off.title}</div>\r\n                            <div style={{ color: '#999', fontSize: 12 }}>{off.term}</div>\r\n                          </div>\r\n                        ))\r\n                      )}\r\n                    </div>\r\n                    <Button className=\"carousel-arrow right\" icon={<RightOutlined />} onClick={() => {\r\n                      if (!carouselRef.current) return; carouselRef.current.scrollBy({ left: 240, behavior: 'smooth' });\r\n                    }} />\r\n                  </div>\r\n                </Card>\r\n              </div>\r\n            </div>\r\n          </Col>\r\n\r\n\r\n          {/* Right pane - login */}\r\n          <Col xs={24} md={12} className=\"pane center-pane login-pane\">\r\n            <div className=\"pane-inner center-inner\">\r\n              <Card className=\"glass-card login-card\" variant=\"outlined\">\r\n               <Typography.Title level={2} className=\"title-blue\" style={{ textAlign: 'center', marginBottom: 6 }}>\r\n                Barangay Information System\r\n              </Typography.Title>\r\n              <Typography.Text style={{ display: 'block', textAlign: 'center', color: '#9254de', fontWeight: 500, marginBottom: 18 }}>\r\n                Sign In\r\n              </Typography.Text>\r\n\r\n              <Form name=\"login\" layout=\"vertical\" onFinish={onFinish} autoComplete=\"off\" requiredMark={false}>\r\n                <Form.Item label=\"Email or Username\" name=\"username\" rules={[{ required: true, message: 'Please input your email or username!' }]}>\r\n                  <Input prefix={<UserOutlined style={{ color: '#40a9ff' }} />} placeholder=\"Enter your email or username\" size=\"large\" />\r\n                </Form.Item>\r\n\r\n                <Form.Item label=\"Password\" name=\"password\" rules={[{ required: true, message: 'Please input your password!' }, { min: 6, message: 'Password must be at least 6 characters' }]}>\r\n                  <Input.Password autoComplete=\"current-password\" prefix={<LockOutlined style={{ color: '#40a9ff' }} />} placeholder=\"Enter your password\" size=\"large\" />\r\n                </Form.Item>\r\n\r\n                <Form.Item>\r\n                  <Button htmlType=\"submit\" size=\"large\" loading={loading} className=\"signin-btn\">\r\n                    {loading ? 'Signing In...' : 'Sign In'}\r\n                  </Button>\r\n                </Form.Item>\r\n\r\n                <Form.Item>\r\n                  <Button onClick={() => setGuestModalVisible(true)} size=\"large\" className=\"guest-warm-btn\" block>\r\n                    Continue as Guest\r\n                  </Button>\r\n                </Form.Item>\r\n\r\n                <div className=\"links-row\">\r\n                  <RouterLink to=\"/forgot-password\"><Typography.Text type=\"secondary\">Forgot Password?</Typography.Text></RouterLink>\r\n                  <RouterLink to=\"/register\"><Typography.Text type=\"secondary\">Sign Up</Typography.Text></RouterLink>\r\n                </div>\r\n                <div style={{ marginTop: 8, textAlign: 'center' }}>\r\n                  <Button type=\"link\" onClick={() => setEmergencyModalVisible(true)}>\r\n                    <Typography.Text type=\"danger\">Emergency Hotline</Typography.Text>\r\n                  </Button>\r\n                </div>\r\n              </Form>\r\n              </Card>\r\n            </div>\r\n          </Col>\r\n        </Row>\r\n      </div>\r\n  </div>\r\n  <Modal\r\n      title=\"Continue as Guest\"\r\n      open={guestModalVisible}\r\n      onCancel={() => { setGuestModalVisible(false); guestForm.resetFields(); }}\r\n      onOk={async () => {\r\n        try {\r\n          const vals = await guestForm.validateFields();\r\n          // submit to server to persist in Guest collection\r\n          try {\r\n            // Use public axios instance so the request goes to the configured API base\r\n            // and does not include any auth cookies.\r\n            const resp = await axiosPublic.post('/auth/guest', { name: vals.name, contactNumber: vals.contactNumber, email: vals.email, intent: vals.intent });\r\n            const data = resp && resp.data ? resp.data : {};\r\n            if (!resp || resp.status >= 400) {\r\n              message.error(data.message || 'Failed to create guest');\r\n              return;\r\n            }\r\n            const guestProfile = {\r\n              _id: data._id,\r\n              username: (vals.name || 'guest').toString().toLowerCase().replace(/\\s+/g, '_'),\r\n              firstName: vals.name || 'Guest',\r\n              contactNumber: vals.contactNumber || '',\r\n              email: vals.email || '',\r\n              intent: vals.intent || '',\r\n              sessionToken: data.sessionToken,\r\n              expiresAt: data.expiresAt,\r\n              role: 'guest'\r\n            };\r\n            if (typeof setUser === 'function') setUser(guestProfile);\r\n            localStorage.setItem('guestInfo', JSON.stringify(guestProfile));\r\n            // Optionally persist sessionToken separately for server calls\r\n            localStorage.setItem('guestSessionToken', data.sessionToken);\r\n            // If the server returned a JWT token, sign in via auth context so PrivateRoute won't redirect\r\n            if (data.token && typeof login === 'function') {\r\n              try {\r\n                await login(data.token);\r\n              } catch (e) {\r\n                // ignore login failure, but keep guest info available locally\r\n                console.warn('Guest token login failed', e);\r\n              }\r\n            }\r\n            setGuestModalVisible(false);\r\n            guestForm.resetFields();\r\n            navigate('/guest/dashboard');\r\n          } catch (err) {\r\n            console.error('Failed to persist guest', err);\r\n            message.error('Failed to create guest account');\r\n          }\r\n        } catch (err) {\r\n          // validation failed\r\n        }\r\n      }}\r\n    >\r\n      <Form layout=\"vertical\" form={guestForm}>\r\n        <Form.Item name=\"name\" label=\"Full name\" rules={[{ required: true, message: 'Please enter your name' }]}>\r\n          <Input placeholder=\"Your full name\" />\r\n        </Form.Item>\r\n        <Form.Item name=\"contactNumber\" label=\"Contact number\" rules={[{ required: true, message: 'Please enter a contact number' }]}>\r\n          <Input placeholder=\"0917...\" />\r\n        </Form.Item>\r\n        <Form.Item name=\"email\" label=\"Email (optional)\" rules={[{ type: 'email', message: 'Enter a valid email' }]}>\r\n          <Input placeholder=\"you@example.com\" />\r\n        </Form.Item>\r\n        <Form.Item name=\"intent\" label=\"Purpose / Intent\" rules={[{ required: true, message: 'Please tell us your intent' }]}>\r\n          <Input.TextArea placeholder=\"Why are you visiting (e.g., check documents, request info)\" rows={3} />\r\n        </Form.Item>\r\n      </Form>\r\n    </Modal>\r\n    <Modal\r\n      title=\"Emergency Hotlines\"\r\n      open={emergencyModalVisible}\r\n      onCancel={() => setEmergencyModalVisible(false)}\r\n      footer={null}\r\n    >\r\n      <div style={{ lineHeight: 1.6 }}>\r\n        <Typography.Paragraph>\r\n          For general emergencies: <strong>911</strong>\r\n        </Typography.Paragraph>\r\n        <Typography.Paragraph>\r\n          National Center for Mental Health (Crisis): <strong>0917-899-8727</strong>\r\n        </Typography.Paragraph>\r\n        <Typography.Paragraph>\r\n          Philippine National Police (Emergency Hotline): <strong>9-1-1</strong> / <strong>8723-0401</strong> / <strong>8537-4500</strong>\r\n        </Typography.Paragraph>\r\n      </div>\r\n    </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default LoginForm;\r\n","import React from 'react';\r\nimport { useFormik } from 'formik';\r\nimport * as Yup from 'yup';\r\nimport { TextField, Button, Box, Link, Paper, Container, InputAdornment, Alert, MenuItem } from '@mui/material';\r\nimport { Email, Lock, Home, Phone, Badge, Person, Visibility, VisibilityOff } from '@mui/icons-material';\r\nimport { Link as RouterLink, useNavigate } from 'react-router-dom';\r\nimport { axiosInstance } from '../services/api';\r\n\r\n// Server requires: min 6 chars, at least one number, one uppercase letter, and one special character\r\nconst PASSWORD_REGEX = /^(?=.*[A-Z])(?=.*\\d)(?=.*[^A-Za-z0-9]).{6,}$/;\r\n\r\nconst validationSchema = Yup.object({\r\n  username: Yup.string()\r\n    .matches(/^[a-zA-Z0-9]{4,20}$/, 'Username must be 4-20 characters and contain only letters and numbers')\r\n    .required('Username is required'),\r\n  email: Yup.string().email('Invalid email address').required('Email is required'),\r\n  password: Yup.string()\r\n    .matches(PASSWORD_REGEX, 'Password must be at least 6 characters long and contain at least one number, one uppercase letter, and one special character')\r\n    .required('Password is required'),\r\n  confirmPassword: Yup.string()\r\n    .oneOf([Yup.ref('password'), undefined], 'Passwords must match')\r\n    .required('Confirm Password is required'),\r\n  address: Yup.string().required('Address is required'),\r\n  contactNumber: Yup.string().required('Contact Number is required'),\r\n  barangayID: Yup.string().required('Barangay ID is required'),\r\n});\r\n\r\nconst RegisterForm = () => {\r\n  const navigate = useNavigate();\r\n  const [error, setError] = React.useState('');\r\n  const [success, setSuccess] = React.useState('');\r\n  const [adminPassword, setAdminPassword] = React.useState('');\r\n  const [adminUnlocked, setAdminUnlocked] = React.useState(false);\r\n  const [showPassword, setShowPassword] = React.useState(false);\r\n  const [showConfirmPassword, setShowConfirmPassword] = React.useState(false);\r\n  const [fieldErrors, setFieldErrors] = React.useState<{ [key: string]: string }>({});\r\n\r\n  // Helper to generate a random unique Barangay ID\r\n  function generateBarangayID() {\r\n    // New format: brgyparian-<YEAR>-<6 chars alphanumeric mixed case>\r\n    const year = new Date().getFullYear();\r\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n    let rand = '';\r\n    for (let i = 0; i < 6; i++) rand += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    return `brgyparian-${year}-${rand}`;\r\n  }\r\n\r\n  const formik = useFormik({\r\n    initialValues: {\r\n      firstName: '',\r\n      middleName: '',\r\n      lastName: '',\r\n      username: '',\r\n      email: '',\r\n      password: '',\r\n      confirmPassword: '',\r\n      address: '',\r\n      contactNumber: '',\r\n      barangayID: generateBarangayID(),\r\n      role: 'resident',\r\n    },\r\n    validationSchema: validationSchema.shape({\r\n      firstName: Yup.string().required('First name is required'),\r\n      lastName: Yup.string().required('Last name is required'),\r\n      role: Yup.string().oneOf(['resident']).required('Role is required'),\r\n    }),\r\n    onSubmit: async (values, { setSubmitting, resetForm }) => {\r\n  setError('');\r\n  setFieldErrors({});\r\n\r\n      // Prevent submission if there are validation errors\r\n      const formErrors = await formik.validateForm();\r\n      if (Object.keys(formErrors).length > 0) {\r\n        setError('Please correct the highlighted errors before submitting.');\r\n        setSubmitting(false);\r\n        return;\r\n      }\r\n\r\n      // role is constrained to 'resident' on the client; admin/staff registration is not exposed here\r\n      try {\r\n        const fullName = [values.firstName, values.middleName, values.lastName].filter(Boolean).join(' ');\r\n\r\n        const resp = await axiosInstance.post('/auth/register', {\r\n          fullName,\r\n          firstName: values.firstName,\r\n          middleName: values.middleName,\r\n          lastName: values.lastName,\r\n          username: values.username,\r\n          email: values.email,\r\n          password: values.password,\r\n          address: values.address,\r\n          contactNumber: values.contactNumber,\r\n          barangayID: values.barangayID,\r\n          role: values.role,\r\n        });\r\n        let data: any = {};\r\n        try {\r\n          data = resp && resp.data ? resp.data : {};\r\n        } catch (jsonErr) {\r\n          setError('Server error: Could not parse response');\r\n          return;\r\n        }\r\n        if (resp && resp.status >= 200 && resp.status < 300) {\r\n          setSuccess('Registration successful! You may now log in.');\r\n          resetForm();\r\n          setTimeout(() => navigate('/login'), 1500);\r\n        } else {\r\n          // Try to extract field-specific errors if present\r\n          if (data.errors && typeof data.errors === 'object') {\r\n            setFieldErrors(data.errors);\r\n            setError('Please correct the highlighted errors before submitting.');\r\n            setSubmitting(false);\r\n            return;\r\n          } else if (data.message) {\r\n            setError(data.message);\r\n          } else if (data.error) {\r\n            setError(data.error);\r\n          } else {\r\n            setError('Registration failed');\r\n          }\r\n        }\r\n      } catch (err) {\r\n        setError('Network or server error. Please try again later.');\r\n      } finally {\r\n        setSubmitting(false);\r\n      }\r\n    },\r\n  });\r\n\r\n  return (\r\n    <Box sx={{\r\n      minHeight: '100vh',\r\n      background: 'linear-gradient(135deg, #40c9ff 0%, #e81cff 100%)',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      py: 6,\r\n    }}>\r\n      <Container maxWidth=\"sm\">\r\n        <Paper elevation={6} sx={{\r\n          borderRadius: 5,\r\n          p: 4,\r\n          background: 'rgba(255,255,255,0.95)',\r\n          boxShadow: '0 8px 32px 0 rgba(64,201,255,0.15)',\r\n        }}>\r\n          <Box sx={{ textAlign: 'center', mb: 3 }}>\r\n            <Box sx={{\r\n              fontWeight: 800,\r\n              fontSize: 32,\r\n              letterSpacing: 1,\r\n              background: 'linear-gradient(90deg, #40c9ff, #e81cff)',\r\n              WebkitBackgroundClip: 'text',\r\n              WebkitTextFillColor: 'transparent',\r\n              display: 'inline-block',\r\n            }}>\r\n              Create Account\r\n            </Box>\r\n          </Box>\r\n          <form onSubmit={formik.handleSubmit}>\r\n            {/* ...existing fields... */}\r\n            <TextField\r\n              fullWidth\r\n              margin=\"normal\"\r\n              label=\"First Name\"\r\n              name=\"firstName\"\r\n              value={formik.values.firstName}\r\n              onChange={formik.handleChange}\r\n              error={formik.touched.firstName && Boolean(formik.errors.firstName)}\r\n              helperText={formik.touched.firstName && formik.errors.firstName}\r\n              sx={{ borderRadius: 3, background: '#f4f6fa', mb: 2 }}\r\n            />\r\n            <TextField\r\n              fullWidth\r\n              margin=\"normal\"\r\n              label=\"Middle Name (optional)\"\r\n              name=\"middleName\"\r\n              value={formik.values.middleName}\r\n              onChange={formik.handleChange}\r\n              error={formik.touched.middleName && Boolean(formik.errors.middleName)}\r\n              helperText={formik.touched.middleName && formik.errors.middleName}\r\n              sx={{ borderRadius: 3, background: '#f4f6fa', mb: 2 }}\r\n            />\r\n            <TextField\r\n              fullWidth\r\n              margin=\"normal\"\r\n              label=\"Last Name\"\r\n              name=\"lastName\"\r\n              value={formik.values.lastName}\r\n              onChange={formik.handleChange}\r\n              error={formik.touched.lastName && Boolean(formik.errors.lastName)}\r\n              helperText={formik.touched.lastName && formik.errors.lastName}\r\n              sx={{ borderRadius: 3, background: '#f4f6fa', mb: 2 }}\r\n            />\r\n            <TextField\r\n              fullWidth\r\n              margin=\"normal\"\r\n              label=\"Username\"\r\n              name=\"username\"\r\n              value={formik.values.username}\r\n              onChange={formik.handleChange}\r\n              error={\r\n                (formik.touched.username && Boolean(formik.errors.username)) ||\r\n                Boolean(fieldErrors.username)\r\n              }\r\n              helperText={\r\n                (formik.touched.username && formik.errors.username) ||\r\n                fieldErrors.username ||\r\n                'Username must be at least 4 characters long and contain only letters and numbers.'\r\n              }\r\n              InputProps={{\r\n                startAdornment: (\r\n                  <InputAdornment position=\"start\">\r\n                    <Person color=\"primary\" />\r\n                  </InputAdornment>\r\n                ),\r\n              }}\r\n              sx={{ borderRadius: 3, background: '#f4f6fa', mb: 2 }}\r\n            />\r\n            <TextField\r\n              fullWidth\r\n              margin=\"normal\"\r\n              label=\"Email\"\r\n              name=\"email\"\r\n              value={formik.values.email}\r\n              onChange={formik.handleChange}\r\n              error={\r\n                (formik.touched.email && Boolean(formik.errors.email)) ||\r\n                Boolean(fieldErrors.email)\r\n              }\r\n              helperText={\r\n                (formik.touched.email && formik.errors.email) ||\r\n                fieldErrors.email\r\n              }\r\n              InputProps={{\r\n                startAdornment: (\r\n                  <InputAdornment position=\"start\">\r\n                    <Email color=\"primary\" />\r\n                  </InputAdornment>\r\n                ),\r\n              }}\r\n              sx={{ borderRadius: 3, background: '#f4f6fa', mb: 2 }}\r\n            />\r\n            {/* Password Field with Show/Hide */}\r\n            <TextField\r\n              fullWidth\r\n              margin=\"normal\"\r\n              label=\"Password\"\r\n              name=\"password\"\r\n              type={showPassword ? \"text\" : \"password\"}\r\n              value={formik.values.password}\r\n              onChange={formik.handleChange}\r\n              error={formik.touched.password && Boolean(formik.errors.password)}\r\n              helperText={\r\n                (formik.touched.password && formik.errors.password) ||\r\n                fieldErrors.password ||\r\n                'Password must be at least 6 characters long and contain at least one number, one uppercase letter, and one special character.'\r\n              }\r\n              InputProps={{\r\n                startAdornment: (\r\n                  <InputAdornment position=\"start\">\r\n                    <Lock color=\"primary\" />\r\n                  </InputAdornment>\r\n                ),\r\n                endAdornment: (\r\n                  <InputAdornment position=\"end\">\r\n                    <Button\r\n                      onClick={() => setShowPassword((prev) => !prev)}\r\n                      tabIndex={-1}\r\n                      sx={{ minWidth: 0, p: 0, color: 'inherit' }}\r\n                    >\r\n                      {showPassword ? <VisibilityOff /> : <Visibility />}\r\n                    </Button>\r\n                  </InputAdornment>\r\n                ),\r\n              }}\r\n              sx={{ borderRadius: 3, background: '#f4f6fa', mb: 2 }}\r\n            />\r\n            {/* Confirm Password Field with Show/Hide */}\r\n            <TextField\r\n              fullWidth\r\n              margin=\"normal\"\r\n              label=\"Confirm Password\"\r\n              name=\"confirmPassword\"\r\n              type={showConfirmPassword ? \"text\" : \"password\"}\r\n              value={formik.values.confirmPassword}\r\n              onChange={formik.handleChange}\r\n              error={formik.touched.confirmPassword && Boolean(formik.errors.confirmPassword)}\r\n              helperText={formik.touched.confirmPassword && formik.errors.confirmPassword}\r\n              InputProps={{\r\n                startAdornment: (\r\n                  <InputAdornment position=\"start\">\r\n                    <Lock color=\"primary\" />\r\n                  </InputAdornment>\r\n                ),\r\n                endAdornment: (\r\n                  <InputAdornment position=\"end\">\r\n                    <Button\r\n                      onClick={() => setShowConfirmPassword((prev) => !prev)}\r\n                      tabIndex={-1}\r\n                      sx={{ minWidth: 0, p: 0, color: 'inherit' }}\r\n                    >\r\n                      {showConfirmPassword ? <VisibilityOff /> : <Visibility />}\r\n                    </Button>\r\n                  </InputAdornment>\r\n                ),\r\n              }}\r\n              sx={{ borderRadius: 3, background: '#f4f6fa', mb: 2 }}\r\n            />\r\n            <TextField\r\n              fullWidth\r\n              margin=\"normal\"\r\n              label=\"Address\"\r\n              name=\"address\"\r\n              value={formik.values.address}\r\n              onChange={formik.handleChange}\r\n              error={formik.touched.address && Boolean(formik.errors.address)}\r\n              helperText={formik.touched.address && formik.errors.address}\r\n              InputProps={{\r\n                startAdornment: (\r\n                  <InputAdornment position=\"start\">\r\n                    <Home color=\"primary\" />\r\n                  </InputAdornment>\r\n                ),\r\n              }}\r\n              sx={{ borderRadius: 3, background: '#f4f6fa', mb: 2 }}\r\n            />\r\n            <TextField\r\n              fullWidth\r\n              margin=\"normal\"\r\n              label=\"Contact Number\"\r\n              name=\"contactNumber\"\r\n              value={formik.values.contactNumber}\r\n              onChange={formik.handleChange}\r\n              error={formik.touched.contactNumber && Boolean(formik.errors.contactNumber)}\r\n              helperText={formik.touched.contactNumber && formik.errors.contactNumber}\r\n              InputProps={{\r\n                startAdornment: (\r\n                  <InputAdornment position=\"start\">\r\n                    <Phone color=\"primary\" />\r\n                  </InputAdornment>\r\n                ),\r\n              }}\r\n              sx={{ borderRadius: 3, background: '#f4f6fa', mb: 2 }}\r\n            />\r\n            {/* Keep Barangay ID out of the visible form but include it as a hidden field so it's submitted */}\r\n            <input type=\"hidden\" name=\"barangayID\" value={formik.values.barangayID} />\r\n\r\n            {/* Role Dropdown */}\r\n            <Box sx={{ mb: 2 }}>\r\n              <TextField\r\n                select\r\n                fullWidth\r\n                label=\"Role\"\r\n                name=\"role\"\r\n                value={formik.values.role}\r\n                onChange={e => {\r\n                  formik.handleChange(e);\r\n                  if (e.target.value !== 'admin') setAdminPassword('');\r\n                }}\r\n                error={formik.touched.role && Boolean(formik.errors.role)}\r\n                helperText={\r\n                  formik.touched.role && formik.errors.role ? formik.errors.role : ''\r\n                }\r\n                sx={{ borderRadius: 3, background: '#f4f6fa' }}\r\n              >\r\n                  <MenuItem value=\"resident\">Resident</MenuItem>\r\n              </TextField>\r\n            </Box>\r\n              {/* admin/staff registration is not available through this public form */}\r\n            <Button\r\n              type=\"submit\"\r\n              fullWidth\r\n              variant=\"contained\"\r\n              sx={{\r\n                mt: 3, mb: 2, borderRadius: 3, fontWeight: 700, fontSize: '1.1rem',\r\n                background: 'linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)',\r\n                color: '#fff',\r\n                boxShadow: '0 2px 8px #e81cff44',\r\n                transition: 'background 0.3s',\r\n                '&:hover': {\r\n                  background: 'linear-gradient(90deg, #40c9ff 0%, #e81cff 100%)',\r\n                },\r\n              }}\r\n              disabled={formik.isSubmitting}\r\n            >\r\n              Register\r\n            </Button>\r\n            {error && <Alert severity=\"error\" sx={{ mt: 2 }}>{error}</Alert>}\r\n            {/* Show field-specific errors in a list if present and not already shown in helperText */}\r\n            {Object.keys(fieldErrors).length > 0 && !error && (\r\n              <Alert severity=\"error\" sx={{ mt: 2 }}>\r\n                {Object.entries(fieldErrors).map(([field, msg]) => (\r\n                  <div key={field}>{msg}</div>\r\n                ))}\r\n              </Alert>\r\n            )}\r\n            {/* Optionally, show a message or unlock admin features if adminUnlocked is true */}\r\n            {adminUnlocked && (\r\n              <Alert severity=\"info\" sx={{ mt: 2 }}>\r\n                Admin access is now unlocked! Redirecting to admin dashboard...\r\n              </Alert>\r\n            )}\r\n            <Box sx={{ textAlign: 'center', mt: 2 }}>\r\n              <Link component={RouterLink} to=\"/login\" variant=\"body2\" sx={{ color: '#e81cff', fontWeight: 600 }}>\r\n                Already have an account? <span style={{ textDecoration: 'underline' }}>Sign In</span>\r\n              </Link>\r\n            </Box>\r\n          </form>\r\n        </Paper>\r\n      </Container>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default RegisterForm;\r\n","\r\nimport React, { useState, useEffect } from 'react';\r\nimport { Row, Col, Card, Typography, Button, List, Spin, Divider, Tag, Badge, Statistic, Space, Modal, Table, Upload, message as antdMessage, Tooltip, Checkbox } from 'antd';\r\nimport { FileTextOutlined, MailOutlined, NotificationOutlined, UploadOutlined, QuestionCircleOutlined } from '@ant-design/icons';\r\nimport AvatarImage from './AvatarImage';\r\nimport { getAbsoluteApiUrl } from '../services/api';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { documentsAPI, contactAPI } from '../services/api';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\ninterface DocumentRequest {\r\n  _id: string;\r\n  documentType: string;\r\n  status: 'PENDING' | 'APPROVED' | 'REJECTED';\r\n  dateRequested: string;\r\n  requesterId?: {\r\n    fullName?: string;\r\n    username?: string;\r\n  };\r\n}\r\n\r\nconst Dashboard: React.FC = () => {\r\n  const { user, setUser } = useAuth();\r\n  // Prefer the in-memory user from AuthContext, but fall back to localStorage's userProfile\r\n  const currentUser = user ?? (() => {\r\n    try {\r\n      const stored = localStorage.getItem('userProfile');\r\n      return stored ? JSON.parse(stored) : null;\r\n    } catch (e) {\r\n      return null;\r\n    }\r\n  })();\r\n  const navigate = useNavigate();\r\n  const [residentImageSrc, setResidentImageSrc] = useState<string | null>(null);\r\n  const [currentTime, setCurrentTime] = useState<string>(() => new Date().toLocaleString());\r\n  const [documents, setDocuments] = useState<DocumentRequest[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [unreadNotifications, setUnreadNotifications] = useState(0);\r\n  const [announcementsCount, setAnnouncementsCount] = useState<number>(0);\r\n  const [announcementsLoading, setAnnouncementsLoading] = useState<boolean>(false);\r\n  const [inquiriesCount, setInquiriesCount] = useState<number>(0);\r\n  const [pendingModalVisible, setPendingModalVisible] = useState(false);\r\n  const [pendingRequestsList, setPendingRequestsList] = useState<any[]>([]);\r\n  const [pendingLoading, setPendingLoading] = useState(false);\r\n  const [approvedModalVisible, setApprovedModalVisible] = useState(false);\r\n  const [approvedRequestsList, setApprovedRequestsList] = useState<any[]>([]);\r\n  const [approvedLoading, setApprovedLoading] = useState(false);\r\n  const [tipsModalVisible, setTipsModalVisible] = useState(false);\r\n  const [hideTips, setHideTips] = useState<boolean>(() => {\r\n    try {\r\n      return localStorage.getItem('residentTips.hide') === 'true';\r\n    } catch (err) {\r\n      return false;\r\n    }\r\n  });\r\n  const [helpHover, setHelpHover] = useState(false);\r\n\r\n  const formatDate = (val?: any) => {\r\n    if (!val) return '';\r\n    try {\r\n      return new Date(val).toLocaleString();\r\n    } catch (err) {\r\n      return String(val);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    const fetchDocuments = async () => {\r\n      try {\r\n        let response;\r\n        if (user?.role === 'admin' || user?.role === 'staff') {\r\n          response = await documentsAPI.getAllDocuments();\r\n        } else {\r\n          response = await documentsAPI.getMyDocuments();\r\n        }\r\n        setDocuments(response);\r\n      } catch (error) {\r\n        console.error('Error fetching documents:', error);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchDocuments();\r\n  // Fetch resident personal info image so dashboard can prefer resident container avatar\r\n    (async () => {\r\n      try {\r\n        // Prefer resident personal-info container image (use axios instance so cookies/token are sent)\r\n        try {\r\n          const r1 = await (await import('../services/api')).residentPersonalInfoAPI.getPersonalInfo();\r\n          const data = r1;\r\n          if (data?.profileImage) {\r\n            const url = data.profileImage.startsWith('http') ? data.profileImage : `${window.location.origin}${data.profileImage}`;\r\n            setResidentImageSrc(url);\r\n            return;\r\n          }\r\n          if (data?.profileImageId) {\r\n            setResidentImageSrc(getAbsoluteApiUrl(`/resident/personal-info/avatar/${data.profileImageId}`));\r\n            return;\r\n          }\r\n        } catch (err) {\r\n          // ignore per-endpoint errors\r\n        }\r\n        // If no resident image, try the user profile endpoint via axios instance\r\n        try {\r\n          const api = await import('../services/api');\r\n          const r2 = await api.default.get('/resident/profile');\r\n          const data2 = r2.data;\r\n          if (data2?.profileImage) {\r\n            const url2 = data2.profileImage.startsWith('http') ? data2.profileImage : `${window.location.origin}${data2.profileImage}`;\r\n            setResidentImageSrc(url2);\r\n          } else if (data2?.profileImageId) {\r\n            setResidentImageSrc(getAbsoluteApiUrl(`/resident/personal-info/avatar/${data2.profileImageId}`));\r\n          }\r\n        } catch (err) {\r\n          // ignore\r\n        }\r\n      } catch (err) {\r\n        // ignore\r\n      }\r\n    })();\r\n    // Live timestamp updater\r\n    const tick = () => setCurrentTime(new Date().toLocaleString());\r\n    const timer = setInterval(tick, 1000);\r\n    return () => clearInterval(timer);\r\n    // TODO: Fetch unread notifications count\r\n  }, [user]);\r\n\r\n  useEffect(() => {\r\n    const fetchInquiries = async () => {\r\n      try {\r\n        let res;\r\n        if (user?.role === 'admin' || user?.role === 'staff') {\r\n          res = await contactAPI.getAllInquiries();\r\n        } else {\r\n          res = await contactAPI.getMyInquiries();\r\n        }\r\n        // API may return array or object with count\r\n        if (Array.isArray(res)) setInquiriesCount(res.length);\r\n        else if (res && typeof res.count === 'number') setInquiriesCount(res.count);\r\n        else setInquiriesCount((res && res.length) || 0);\r\n      } catch (err) {\r\n        console.error('Failed to load inquiries:', err);\r\n        setInquiriesCount(0);\r\n      }\r\n    };\r\n    fetchInquiries();\r\n    // Fetch announcements count for the announcements card\r\n    const fetchAnnouncements = async () => {\r\n      setAnnouncementsLoading(true);\r\n      try {\r\n        const res = await contactAPI.getAnnouncements();\r\n        if (Array.isArray(res)) setAnnouncementsCount(res.length);\r\n        else if (res && typeof res.count === 'number') setAnnouncementsCount(res.count);\r\n        else setAnnouncementsCount((res && res.length) || 0);\r\n      } catch (err) {\r\n        console.error('Failed to fetch announcements:', err);\r\n        setAnnouncementsCount(0);\r\n      } finally {\r\n        setAnnouncementsLoading(false);\r\n      }\r\n    };\r\n    fetchAnnouncements();\r\n  }, [user]);\r\n\r\n  const pendingCount = documents.filter(doc => (doc.status || '').toString().toLowerCase() === 'pending').length;\r\n  const approvedCount = documents.filter(doc => (doc.status || '').toString().toLowerCase() === 'approved').length;\r\n\r\n  return (\r\n    <>\r\n      <div style={{ maxWidth: 1200, margin: '40px auto', padding: '0 16px', position: 'relative' }}>\r\n        {/* Breadcrumb Navigation */}\r\n        <div style={{ marginBottom: 18 }}>\r\n          <Row align=\"middle\">\r\n            <Col>\r\n              <Typography.Text style={{ fontSize: 16, color: '#888' }}>\r\n                <span style={{ marginRight: 8 }}>\r\n                  <span style={{ color: '#1890ff', fontWeight: 600 }}>Dashboard</span> {'>'} Home\r\n                </span>\r\n              </Typography.Text>\r\n            </Col>\r\n          </Row>\r\n        </div>\r\n        {/* Hero Card Section */}\r\n        {user?.role === 'resident' && (\r\n          <Card\r\n            style={{\r\n              width: '100%',\r\n              margin: '0 auto 32px',\r\n              borderRadius: 32,\r\n              boxShadow: '0 8px 32px #bfc7d6cc',\r\n              background: 'linear-gradient(120deg, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)',\r\n              border: 'none',\r\n              padding: 0,\r\n              position: 'relative',\r\n              overflow: 'hidden',\r\n              minHeight: 170\r\n            }}\r\n            bodyStyle={{ padding: 0 }}\r\n          >\r\n            {/* Subtle pattern/gradient background */}\r\n            <div style={{\r\n              position: 'absolute',\r\n              top: 0,\r\n              left: 0,\r\n              height: '100%',\r\n              background: 'radial-gradient(circle at 80% 20%, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)',\r\n              opacity: 0.18,\r\n              zIndex: 0\r\n            }} />\r\n            <Row align=\"middle\" style={{ minHeight: 170, padding: '32px 32px', position: 'relative', zIndex: 1 }} justify=\"space-between\">\r\n              <Col xs={24} md={14} style={{ display: 'flex', alignItems: 'center', gap: 24 }}>\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: 18, width: '100%', justifyContent: 'space-between' }}>\r\n                  <div style={{ display: 'flex', alignItems: 'center', gap: 18 }}>\r\n                    <div style={{ width: 96, height: 96, borderRadius: 12, overflow: 'hidden', background: '#fff', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative' }}>\r\n                      {residentImageSrc ? (\r\n                        <img src={residentImageSrc} alt={user?.fullName || user?.username || 'avatar'} style={{ width: 96, height: 96, objectFit: 'cover', borderRadius: 12 }} />\r\n                      ) : (\r\n                        <AvatarImage user={(() => {\r\n                          let displayUser = user;\r\n                          if (!displayUser) {\r\n                            try {\r\n                              const stored = localStorage.getItem('userProfile');\r\n                              if (stored) displayUser = JSON.parse(stored);\r\n                            } catch (err) {}\r\n                          }\r\n                          return displayUser;\r\n                        })()} size={96} />\r\n                      )}\r\n                      <button\r\n                        onClick={() => navigate('/profile')}\r\n                        title=\"Edit profile\"\r\n                        style={{\r\n                          position: 'absolute',\r\n                          right: 6,\r\n                          bottom: 6,\r\n                          width: 28,\r\n                          height: 28,\r\n                          borderRadius: 14,\r\n                          background: '#fff',\r\n                          border: '1px solid #e8e8e8',\r\n                          display: 'flex',\r\n                          alignItems: 'center',\r\n                          justifyContent: 'center',\r\n                          boxShadow: '0 1px 4px rgba(0,0,0,0.08)',\r\n                          cursor: 'pointer'\r\n                        }}\r\n                      >\r\n                        <svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n                          <path d=\"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z\" fill=\"#595959\"/>\r\n                          <path d=\"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z\" fill=\"#595959\"/>\r\n                        </svg>\r\n                      </button>\r\n                    </div>\r\n                    <div>\r\n                      <Typography.Title level={3} style={{ marginBottom: 0, fontWeight: 800 }}>{user?.fullName ?? user?.username ?? user?.email ?? ''}</Typography.Title>\r\n                      <Typography.Text type=\"secondary\" style={{ fontSize: 18 }}>\r\n                        Barangay ID: {user?.barangayID ?? (() => {\r\n                          try {\r\n                            const stored = localStorage.getItem('userProfile');\r\n                            if (stored) {\r\n                              const p = JSON.parse(stored);\r\n                              return p?.barangayID || 'N/A';\r\n                            }\r\n                          } catch (e) {}\r\n                          return 'N/A';\r\n                        })()}\r\n                      </Typography.Text>\r\n                      <div style={{ marginTop: 8 }}><Typography.Text type=\"secondary\">{new Date().toLocaleString()}</Typography.Text></div>\r\n                    </div>\r\n                  </div>\r\n                </div>\r\n              </Col>\r\n            </Row>\r\n            {/* help button moved to floating bottom-right */}\r\n          </Card>\r\n        )}\r\n\r\n        {/* Statistics Grid */}\r\n        <Row gutter={[32, 32]} justify=\"center\" style={{ marginBottom: 40 }}>\r\n          <Col xs={24} sm={12} md={6}>\r\n            <Card\r\n              hoverable\r\n              style={{\r\n                borderRadius: 20,\r\n                minHeight: 170,\r\n                boxShadow: '0 2px 12px #faad1444',\r\n                transition: 'box-shadow 0.2s, transform 0.2s',\r\n                padding: 0,\r\n                cursor: 'pointer'\r\n              }}\r\n              onClick={async () => {\r\n                setPendingModalVisible(true);\r\n                setPendingLoading(true);\r\n                try {\r\n                  let res;\r\n                  if (user?.role === 'admin' || user?.role === 'staff') {\r\n                    res = await documentsAPI.getAllDocuments();\r\n                    res = (res || []).filter((r: any) => (r.status || '').toString().toLowerCase() === 'pending');\r\n                  } else {\r\n                    res = await documentsAPI.getMyDocuments();\r\n                    res = (res || []).filter((r: any) => (r.status || '').toString().toLowerCase() === 'pending');\r\n                  }\r\n                  setPendingRequestsList(res || []);\r\n                } catch (err) {\r\n                  setPendingRequestsList([]);\r\n                } finally {\r\n                  setPendingLoading(false);\r\n                }\r\n              }}\r\n              bodyStyle={{ padding: 24 }}\r\n              onMouseEnter={e => e.currentTarget.style.transform = 'translateY(-6px) scale(1.03)'}\r\n              onMouseLeave={e => e.currentTarget.style.transform = 'none'}\r\n            >\r\n              <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 12 }}>\r\n                <div style={{ background: '#faad14', borderRadius: '50%', width: 54, height: 54, display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: 8 }}>\r\n                  <MailOutlined style={{ color: '#fff', fontSize: 28, transition: 'transform 0.2s' }} />\r\n                </div>\r\n                <Typography.Title level={2} style={{ margin: 0, fontWeight: 800 }}>{pendingCount}</Typography.Title>\r\n                <Typography.Text style={{ fontSize: 18, color: '#faad14', fontWeight: 700 }}>Pending Requests</Typography.Text>\r\n                {/* subtitle and action button removed */}\r\n              </div>\r\n            </Card>\r\n          </Col>\r\n          <Col xs={24} sm={12} md={6}>\r\n            <Card\r\n              hoverable\r\n              style={{\r\n                borderRadius: 20,\r\n                minHeight: 170,\r\n                boxShadow: '0 2px 12px #52c41a44',\r\n                transition: 'box-shadow 0.2s, transform 0.2s',\r\n                padding: 0,\r\n                cursor: 'pointer'\r\n              }}\r\n              bodyStyle={{ padding: 24 }}\r\n              onClick={async () => {\r\n                setApprovedModalVisible(true);\r\n                setApprovedLoading(true);\r\n                try {\r\n                  let res;\r\n                  if (user?.role === 'admin' || user?.role === 'staff') {\r\n                    res = await documentsAPI.getAllDocuments();\r\n                    res = (res || []).filter((r: any) => (r.status || '').toString().toLowerCase() === 'approved');\r\n                  } else {\r\n                    res = await documentsAPI.getMyDocuments();\r\n                    res = (res || []).filter((r: any) => (r.status || '').toString().toLowerCase() === 'approved');\r\n                  }\r\n                  setApprovedRequestsList(res || []);\r\n                } catch (err) {\r\n                  setApprovedRequestsList([]);\r\n                } finally {\r\n                  setApprovedLoading(false);\r\n                }\r\n              }}\r\n              onMouseEnter={e => e.currentTarget.style.transform = 'translateY(-6px) scale(1.03)'}\r\n              onMouseLeave={e => e.currentTarget.style.transform = 'none'}\r\n            >\r\n              <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 12 }}>\r\n                <div style={{ background: '#52c41a', borderRadius: '50%', width: 54, height: 54, display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: 8 }}>\r\n                  <FileTextOutlined style={{ color: '#fff', fontSize: 28, transition: 'transform 0.2s' }} />\r\n                </div>\r\n                <Typography.Title level={2} style={{ margin: 0, fontWeight: 800 }}>{approvedCount}</Typography.Title>\r\n                <Typography.Text style={{ fontSize: 18, color: '#52c41a', fontWeight: 700 }}>Approved Documents</Typography.Text>\r\n                {/* subtitle and action button removed */}\r\n              </div>\r\n            </Card>\r\n          </Col>\r\n          <Col xs={24} sm={12} md={6}>\r\n            <Card\r\n              hoverable\r\n              style={{\r\n                borderRadius: 20,\r\n                minHeight: 170,\r\n                boxShadow: '0 2px 12px #1890ff44',\r\n                transition: 'box-shadow 0.2s, transform 0.2s',\r\n                padding: 0,\r\n                cursor: 'pointer'\r\n              }}\r\n              onClick={() => navigate('/inbox')}\r\n              bodyStyle={{ padding: 24 }}\r\n              onMouseEnter={e => e.currentTarget.style.transform = 'translateY(-6px) scale(1.03)'}\r\n              onMouseLeave={e => e.currentTarget.style.transform = 'none'}\r\n            >\r\n              <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 12 }}>\r\n                <div style={{ background: '#1890ff', borderRadius: '50%', width: 54, height: 54, display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: 8 }}>\r\n                  <MailOutlined style={{ color: '#fff', fontSize: 28, transition: 'transform 0.2s' }} />\r\n                </div>\r\n                <Typography.Title level={2} style={{ margin: 0, fontWeight: 800 }}>{inquiriesCount}</Typography.Title>\r\n                <Typography.Text style={{ fontSize: 18, color: '#1890ff', fontWeight: 700 }}>Active Inquiries</Typography.Text>\r\n                {/* subtitle and action button removed */}\r\n              </div>\r\n            </Card>\r\n          </Col>\r\n          <Col xs={24} sm={12} md={6}>\r\n            <Card\r\n              onClick={() => navigate('/announcements')}\r\n              hoverable\r\n              style={{\r\n                borderRadius: 20,\r\n                minHeight: 170,\r\n                boxShadow: '0 2px 12px #eb2f9644',\r\n                transition: 'box-shadow 0.2s, transform 0.2s',\r\n                padding: 0,\r\n                cursor: 'pointer'\r\n              }}\r\n              bodyStyle={{ padding: 24 }}\r\n              onMouseEnter={e => e.currentTarget.style.transform = 'translateY(-6px) scale(1.03)'}\r\n              onMouseLeave={e => e.currentTarget.style.transform = 'none'}\r\n            >\r\n              <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 12 }}>\r\n                <div style={{ background: '#eb2f96', borderRadius: '50%', width: 54, height: 54, display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: 8 }}>\r\n                  <Badge count={announcementsCount} offset={[8, 0]}>\r\n                    <NotificationOutlined style={{ color: '#fff', fontSize: 28, transition: 'transform 0.2s' }} />\r\n                  </Badge>\r\n                </div>\r\n                <Typography.Title level={2} style={{ margin: 0, fontWeight: 800 }}>{announcementsCount}</Typography.Title>\r\n                <Typography.Text style={{ fontSize: 18, color: '#eb2f96', fontWeight: 700 }}>Announcements</Typography.Text>\r\n                {/* subtitle and action button removed */}\r\n              </div>\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n        \r\n        {/* Pending Requests Modal */}\r\n        <Modal\r\n          title=\"Pending Requests\"\r\n          visible={pendingModalVisible}\r\n          onCancel={() => setPendingModalVisible(false)}\r\n          footer={null}\r\n          width={800}\r\n        >\r\n          <Table\r\n            dataSource={pendingRequestsList}\r\n            loading={pendingLoading}\r\n            rowKey={(record: any) => record._id}\r\n            pagination={{ pageSize: 8 }}\r\n            columns={[\r\n              {\r\n                title: 'First Name',\r\n                dataIndex: 'fieldValues',\r\n                key: 'firstName',\r\n                render: (fv: any, record: any) => fv?.firstName || record.username || 'Unknown'\r\n              },\r\n              {\r\n                title: 'Doc Type',\r\n                dataIndex: 'type',\r\n                key: 'type',\r\n                render: (text: string) => text || 'Unknown'\r\n              },\r\n              {\r\n                title: 'Status',\r\n                dataIndex: 'status',\r\n                key: 'status',\r\n                render: (text: string) => (text || '').toString().toLowerCase()\r\n              }\r\n            ]}\r\n          />\r\n        </Modal>\r\n        {/* Approved Requests Modal */}\r\n        <Modal\r\n          title=\"Approved Documents\"\r\n          visible={approvedModalVisible}\r\n          onCancel={() => setApprovedModalVisible(false)}\r\n          footer={null}\r\n          width={1000}\r\n        >\r\n          <Table\r\n            dataSource={approvedRequestsList}\r\n            loading={approvedLoading}\r\n            rowKey={(record: any) => record._id}\r\n            pagination={{ pageSize: 8 }}\r\n            columns={[\r\n              {\r\n                title: 'First Name',\r\n                dataIndex: 'fieldValues',\r\n                key: 'firstName',\r\n                render: (fv: any, record: any) => fv?.firstName || record.username || 'Unknown'\r\n              },\r\n              {\r\n                title: 'Doc Type',\r\n                dataIndex: 'type',\r\n                key: 'type',\r\n                render: (text: string) => text || 'Unknown'\r\n              },\r\n              {\r\n                title: 'Date Requested',\r\n                dataIndex: 'dateRequested',\r\n                key: 'dateRequested',\r\n                render: (_: any, record: any) => formatDate(record.dateRequested || record.requestedAt || record.createdAt)\r\n              },\r\n              {\r\n                title: 'Date Approved',\r\n                dataIndex: 'dateApproved',\r\n                key: 'dateApproved',\r\n                render: (_: any, record: any) => formatDate(record.dateApproved || record.approvedAt || record.approvedOn || record.updatedAt)\r\n              },\r\n              {\r\n                title: 'Status',\r\n                dataIndex: 'status',\r\n                key: 'status',\r\n                render: (text: string) => (text || '').toString().toLowerCase()\r\n              }\r\n            ]}\r\n          />\r\n        </Modal>\r\n        {/* Resident Tool Tips Modal */}\r\n        <Modal\r\n          title=\"Resident Tool Tips\"\r\n          visible={tipsModalVisible}\r\n          onCancel={() => setTipsModalVisible(false)}\r\n          footer={(\r\n            <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', width: '100%' }}>\r\n              <Checkbox\r\n                checked={hideTips}\r\n                onChange={e => {\r\n                  const val = e.target.checked;\r\n                  setHideTips(val);\r\n                  try { localStorage.setItem('residentTips.hide', val ? 'true' : 'false'); } catch (err) {}\r\n                }}\r\n              >Don't show again</Checkbox>\r\n              <div>\r\n                <Button onClick={() => setTipsModalVisible(false)} style={{ marginRight: 8 }}>Cancel</Button>\r\n                <Button type=\"primary\" onClick={() => { setTipsModalVisible(false); }}>Got it</Button>\r\n              </div>\r\n            </div>\r\n          )}\r\n          width={720}\r\n        >\r\n          <ul style={{ paddingLeft: 20 }}>\r\n            <li>Use the Request Document button to apply for barangay certificates and permits.</li>\r\n            <li>Check your profile information regularly to ensure accuracy.</li>\r\n            <li>Contact barangay staff for assistance with business registration or solo parent certification.</li>\r\n            <li>For lost documents, use the Inquiry form to request help.</li>\r\n            <li>All document requests are processed during office hours only.</li>\r\n          </ul>\r\n        </Modal>\r\n        {/* Floating help button (bottom-right) */}\r\n        <div style={{ position: 'fixed', right: 20, bottom: 24, zIndex: 1050 }}>\r\n          <Tooltip title={hideTips ? 'Tips hidden (will remain hidden if checked)' : 'Resident Tool Tips'}>\r\n            <Button\r\n              type=\"primary\"\r\n              shape=\"circle\"\r\n              size=\"large\"\r\n              onClick={() => setTipsModalVisible(true)}\r\n              onMouseEnter={() => setHelpHover(true)}\r\n              onMouseLeave={() => setHelpHover(false)}\r\n              icon={<QuestionCircleOutlined style={{ color: '#fff', fontSize: 20 }} />}\r\n              style={{\r\n                width: 56,\r\n                height: 56,\r\n                display: 'flex',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                boxShadow: helpHover ? '0 10px 30px rgba(24,144,255,0.22)' : '0 6px 18px rgba(0,0,0,0.12)',\r\n                transform: helpHover ? 'translateY(-4px) scale(1.03)' : 'none',\r\n                transition: 'transform 160ms cubic-bezier(.2,.8,.2,1), box-shadow 160ms',\r\n              }}\r\n            />\r\n          </Tooltip>\r\n        </div>\r\n        {/* ...other dashboard sections... */}\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Dashboard;\r\n                \r\n","import React, { useState, useEffect } from 'react';\r\nimport { Row, Col, Card, Typography, Button, List, Spin, Divider, Tag, Badge, Statistic, Space, Modal, Table, Upload, message as antdMessage, Tooltip, Checkbox } from 'antd';\r\nimport { FileTextOutlined, MailOutlined, NotificationOutlined, UploadOutlined, QuestionCircleOutlined } from '@ant-design/icons';\r\nimport AvatarImage from './AvatarImage';\r\nimport { getAbsoluteApiUrl } from '../services/api';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { documentsAPI, contactAPI } from '../services/api';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\ninterface DocumentRequest {\r\n\t_id: string;\r\n\tdocumentType: string;\r\n\tstatus: 'PENDING' | 'APPROVED' | 'REJECTED';\r\n\tdateRequested: string;\r\n\trequesterId?: {\r\n\t\tfullName?: string;\r\n\t\tusername?: string;\r\n\t};\r\n}\r\n\r\nconst GuestDashboard: React.FC = () => {\r\n\tconst { user, setUser } = useAuth();\r\n\t// Prefer the in-memory user from AuthContext, but fall back to localStorage's userProfile\r\n\tconst currentUser = user ?? (() => {\r\n\t\ttry {\r\n\t\t\tconst stored = localStorage.getItem('userProfile');\r\n\t\t\treturn stored ? JSON.parse(stored) : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t})();\r\n\tconst navigate = useNavigate();\r\n\tconst [residentImageSrc, setResidentImageSrc] = useState<string | null>(null);\r\n\tconst [currentTime, setCurrentTime] = useState<string>(() => new Date().toLocaleString());\r\n\tconst [documents, setDocuments] = useState<DocumentRequest[]>([]);\r\n\tconst [loading, setLoading] = useState(true);\r\n\tconst [unreadNotifications, setUnreadNotifications] = useState(0);\r\n\tconst [announcementsCount, setAnnouncementsCount] = useState<number>(0);\r\n\tconst [announcementsLoading, setAnnouncementsLoading] = useState<boolean>(false);\r\n\tconst [pendingModalVisible, setPendingModalVisible] = useState(false);\r\n\tconst [pendingRequestsList, setPendingRequestsList] = useState<any[]>([]);\r\n\tconst [pendingLoading, setPendingLoading] = useState(false);\r\n\tconst [approvedModalVisible, setApprovedModalVisible] = useState(false);\r\n\tconst [approvedRequestsList, setApprovedRequestsList] = useState<any[]>([]);\r\n\tconst [approvedLoading, setApprovedLoading] = useState(false);\r\n\tconst [tipsModalVisible, setTipsModalVisible] = useState(false);\r\n\tconst [hideTips, setHideTips] = useState<boolean>(() => {\r\n\t\ttry {\r\n\t\t\treturn localStorage.getItem('residentTips.hide') === 'true';\r\n\t\t} catch (err) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\tconst [helpHover, setHelpHover] = useState(false);\r\n\r\n\tconst formatDate = (val?: any) => {\r\n\t\tif (!val) return '';\r\n\t\ttry {\r\n\t\t\treturn new Date(val).toLocaleString();\r\n\t\t} catch (err) {\r\n\t\t\treturn String(val);\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tconst fetchDocuments = async () => {\r\n\t\t\ttry {\r\n\t\t\t\tlet response;\r\n\t\t\t\tif (user?.role === 'admin' || user?.role === 'staff') {\r\n\t\t\t\t\tresponse = await documentsAPI.getAllDocuments();\r\n\t\t\t\t} else {\r\n\t\t\t\t\tresponse = await documentsAPI.getMyDocuments();\r\n\t\t\t\t}\r\n\t\t\t\tsetDocuments(response);\r\n\t\t\t} catch (error) {\r\n\t\t\t\tconsole.error('Error fetching documents:', error);\r\n\t\t\t} finally {\r\n\t\t\t\tsetLoading(false);\r\n\t\t\t}\r\n\t\t};\r\n\t\tfetchDocuments();\r\n\t\t// Fetch resident personal info image so dashboard can prefer resident container avatar\r\n\t\t(async () => {\r\n\t\t\ttry {\r\n\t\t\t\t// Prefer resident personal-info container image (use axios instance so cookies/token are sent)\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst r1 = await (await import('../services/api')).residentPersonalInfoAPI.getPersonalInfo();\r\n\t\t\t\t\tconst data = r1;\r\n\t\t\t\t\tif (data?.profileImage) {\r\n\t\t\t\t\t\tconst url = data.profileImage.startsWith('http') ? data.profileImage : `${window.location.origin}${data.profileImage}`;\r\n\t\t\t\t\t\tsetResidentImageSrc(url);\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (data?.profileImageId) {\r\n\t\t\t\t\t\tsetResidentImageSrc(getAbsoluteApiUrl(`/resident/personal-info/avatar/${data.profileImageId}`));\r\n\t\t\t\t\t\treturn;\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\t// ignore per-endpoint errors\r\n\t\t\t\t}\r\n\t\t\t\t// If no resident image, try the user profile endpoint via axios instance\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst api = await import('../services/api');\r\n\t\t\t\t\tconst r2 = await api.default.get('/resident/profile');\r\n\t\t\t\t\tconst data2 = r2.data;\r\n\t\t\t\t\tif (data2?.profileImage) {\r\n\t\t\t\t\t\tconst url2 = data2.profileImage.startsWith('http') ? data2.profileImage : `${window.location.origin}${data2.profileImage}`;\r\n\t\t\t\t\t\tsetResidentImageSrc(url2);\r\n\t\t\t\t\t} else if (data2?.profileImageId) {\r\n\t\t\t\t\t\tsetResidentImageSrc(getAbsoluteApiUrl(`/resident/personal-info/avatar/${data2.profileImageId}`));\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\t// ignore\r\n\t\t\t\t}\r\n\t\t\t} catch (err) {\r\n\t\t\t\t// ignore\r\n\t\t\t}\r\n\t\t})();\r\n\t\t// Live timestamp updater\r\n\t\tconst tick = () => setCurrentTime(new Date().toLocaleString());\r\n\t\tconst timer = setInterval(tick, 1000);\r\n\t\treturn () => clearInterval(timer);\r\n\t\t// TODO: Fetch unread notifications count\r\n\t}, [user]);\r\n\r\n\t// We previously toggled a document-level CSS class from this component to hide\r\n\t// the global sider, but AppLayout now respects the `guest` role directly and\r\n\t// does not render the sider for guest users. Remove the injected-class logic\r\n\t// to avoid duplication. (Left the modal/state intact elsewhere.)\r\n\r\n\tuseEffect(() => {\r\n\t\t// Fetch announcements count for the announcements card\r\n\t\tconst fetchAnnouncements = async () => {\r\n\t\t\tsetAnnouncementsLoading(true);\r\n\t\t\ttry {\r\n\t\t\t\tconst res = await contactAPI.getAnnouncements();\r\n\t\t\t\tif (Array.isArray(res)) setAnnouncementsCount(res.length);\r\n\t\t\t\telse if (res && typeof res.count === 'number') setAnnouncementsCount(res.count);\r\n\t\t\t\telse setAnnouncementsCount((res && res.length) || 0);\r\n\t\t\t} catch (err) {\r\n\t\t\t\tconsole.error('Failed to fetch announcements:', err);\r\n\t\t\t\tsetAnnouncementsCount(0);\r\n\t\t\t} finally {\r\n\t\t\t\tsetAnnouncementsLoading(false);\r\n\t\t\t}\r\n\t\t};\r\n\t\tfetchAnnouncements();\r\n\t}, [user]);\r\n\r\n\tconst pendingCount = documents.filter(doc => (doc.status || '').toString().toLowerCase() === 'pending').length;\r\n\tconst approvedCount = documents.filter(doc => (doc.status || '').toString().toLowerCase() === 'approved').length;\r\n\r\n\treturn (\r\n\t\t<>\r\n\t\t\t<div style={{ maxWidth: 1200, margin: '40px auto', padding: '0 16px', position: 'relative' }}>\r\n\t\t\t\t{/* Breadcrumb Navigation */}\r\n\t\t\t\t<div style={{ marginBottom: 18 }}>\r\n\t\t\t\t\t<Row align=\"middle\">\r\n\t\t\t\t\t\t<Col>\r\n\t\t\t\t\t\t\t<Typography.Text style={{ fontSize: 16, color: '#888' }}>\r\n\t\t\t\t\t\t\t\t<span style={{ marginRight: 8 }}>\r\n\t\t\t\t\t\t\t\t\t<span style={{ color: '#1890ff', fontWeight: 600 }}>Dashboard</span> {'>'} Home\r\n\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t</Typography.Text>\r\n\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t</Row>\r\n\t\t\t\t</div>\r\n\t\t\t\t{/* Hero Card Section */}\r\n\t\t\t\t{user?.role === 'resident' && (\r\n\t\t\t\t\t<Card\r\n\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\twidth: '100%',\r\n\t\t\t\t\t\t\tmargin: '0 auto 32px',\r\n\t\t\t\t\t\t\tborderRadius: 32,\r\n\t\t\t\t\t\t\tboxShadow: '0 8px 32px #bfc7d6cc',\r\n\t\t\t\t\t\t\tbackground: 'linear-gradient(120deg, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)',\r\n\t\t\t\t\t\t\tborder: 'none',\r\n\t\t\t\t\t\t\tpadding: 0,\r\n\t\t\t\t\t\t\tposition: 'relative',\r\n\t\t\t\t\t\t\toverflow: 'hidden',\r\n\t\t\t\t\t\t\tminHeight: 170\r\n\t\t\t\t\t\t}}\r\n\t\t\t\t\t\tbodyStyle={{ padding: 0 }}\r\n\t\t\t\t\t>\r\n\t\t\t\t\t\t{/* Subtle pattern/gradient background */}\r\n\t\t\t\t\t\t<div style={{\r\n\t\t\t\t\t\t\tposition: 'absolute',\r\n\t\t\t\t\t\t\ttop: 0,\r\n\t\t\t\t\t\t\tleft: 0,\r\n\t\t\t\t\t\t\theight: '100%',\r\n\t\t\t\t\t\t\tbackground: 'radial-gradient(circle at 80% 20%, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)',\r\n\t\t\t\t\t\t\topacity: 0.18,\r\n\t\t\t\t\t\t\tzIndex: 0\r\n\t\t\t\t\t\t}} />\r\n\t\t\t\t\t\t<Row align=\"middle\" style={{ minHeight: 170, padding: '32px 32px', position: 'relative', zIndex: 1 }} justify=\"space-between\">\r\n\t\t\t\t\t\t\t<Col xs={24} md={14} style={{ display: 'flex', alignItems: 'center', gap: 24 }}>\r\n\t\t\t\t\t\t\t\t<div style={{ display: 'flex', alignItems: 'center', gap: 18, width: '100%', justifyContent: 'space-between' }}>\r\n\t\t\t\t\t\t\t\t\t<div style={{ display: 'flex', alignItems: 'center', gap: 18 }}>\r\n\t\t\t\t\t\t\t\t\t\t<div style={{ width: 96, height: 96, borderRadius: 12, overflow: 'hidden', background: '#fff', display: 'flex', alignItems: 'center', justifyContent: 'center', position: 'relative' }}>\r\n\t\t\t\t\t\t\t\t\t\t\t{residentImageSrc ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<img src={residentImageSrc} alt={user?.fullName || user?.username || 'avatar'} style={{ width: 96, height: 96, objectFit: 'cover', borderRadius: 12 }} />\r\n\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t<AvatarImage user={(() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tlet displayUser = user;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tif (!displayUser) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst stored = localStorage.getItem('userProfile');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stored) displayUser = JSON.parse(stored);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (err) {}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn displayUser;\r\n\t\t\t\t\t\t\t\t\t\t\t\t})()} size={96} />\r\n\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t<button\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={() => navigate('/profile')}\r\n\t\t\t\t\t\t\t\t\t\t\t\ttitle=\"Edit profile\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tposition: 'absolute',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tright: 6,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tbottom: 6,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\twidth: 28,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\theight: 28,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tborderRadius: 14,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tbackground: '#fff',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tborder: '1px solid #e8e8e8',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tdisplay: 'flex',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\talignItems: 'center',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tjustifyContent: 'center',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tboxShadow: '0 1px 4px rgba(0,0,0,0.08)',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tcursor: 'pointer'\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t<svg width=\"14\" height=\"14\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path d=\"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z\" fill=\"#595959\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<path d=\"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z\" fill=\"#595959\"/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</svg>\r\n\t\t\t\t\t\t\t\t\t\t\t</button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t<Typography.Title level={3} style={{ marginBottom: 0, fontWeight: 800 }}>{user?.fullName ?? user?.username ?? user?.email ?? ''}</Typography.Title>\r\n\t\t\t\t\t\t\t\t\t\t\t<Typography.Text type=\"secondary\" style={{ fontSize: 18 }}>\r\n\t\t\t\t\t\t\t\t\t\t\t\tBarangay ID: {user?.barangayID ?? (() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst stored = localStorage.getItem('userProfile');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stored) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst p = JSON.parse(stored);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn p?.barangayID || 'N/A';\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (e) {}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn 'N/A';\r\n\t\t\t\t\t\t\t\t\t\t\t\t})()}\r\n\t\t\t\t\t\t\t\t\t\t\t</Typography.Text>\r\n\t\t\t\t\t\t\t\t\t\t\t<div style={{ marginTop: 8 }}><Typography.Text type=\"secondary\">{new Date().toLocaleString()}</Typography.Text></div>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t{/* help button moved to floating bottom-right */}\r\n\t\t\t\t\t</Card>\r\n\t\t\t\t)}\r\n\r\n\t\t\t\t{/* Statistics Grid */}\r\n\t\t\t\t<Row gutter={[32, 32]} justify=\"center\" style={{ marginBottom: 40 }}>\r\n\r\n\t\t\t\t\t{/* Inquiries / Inbox removed for guest dashboard per request */}\r\n\t\t\t\t\t{/* Request Document card - restored per user's request */}\r\n\t\t\t\t\t<Col xs={24} sm={12} md={6}>\r\n\t\t\t\t\t\t<Card\r\n\t\t\t\t\t\t\tonClick={() => navigate('/request')}\r\n\t\t\t\t\t\t\thoverable\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\tborderRadius: 20,\r\n\t\t\t\t\t\t\t\tminHeight: 170,\r\n\t\t\t\t\t\t\t\tboxShadow: '0 2px 12px #1890ff44',\r\n\t\t\t\t\t\t\t\ttransition: 'box-shadow 0.2s, transform 0.2s',\r\n\t\t\t\t\t\t\t\tpadding: 0,\r\n\t\t\t\t\t\t\t\tcursor: 'pointer'\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tbodyStyle={{ padding: 24 }}\r\n\t\t\t\t\t\t\tonMouseEnter={e => e.currentTarget.style.transform = 'translateY(-6px) scale(1.03)'}\r\n\t\t\t\t\t\t\tonMouseLeave={e => e.currentTarget.style.transform = 'none'}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 12 }}>\r\n\t\t\t\t\t\t\t\t<div style={{ background: '#1890ff', borderRadius: '50%', width: 54, height: 54, display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: 8 }}>\r\n\t\t\t\t\t\t\t\t\t<UploadOutlined style={{ color: '#fff', fontSize: 28, transition: 'transform 0.2s' }} />\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<Typography.Title level={2} style={{ margin: 0, fontWeight: 800 }}>Request</Typography.Title>\r\n\t\t\t\t\t\t\t\t<Typography.Text style={{ fontSize: 18, color: '#1890ff', fontWeight: 700 }}>Request Document</Typography.Text>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</Card>\r\n\t\t\t\t\t</Col>\r\n\t\t\t\t\t<Col xs={24} sm={12} md={6}>\r\n\t\t\t\t\t\t<Card\r\n\t\t\t\t\t\t\tonClick={() => navigate('/announcements')}\r\n\t\t\t\t\t\t\thoverable\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\tborderRadius: 20,\r\n\t\t\t\t\t\t\t\tminHeight: 170,\r\n\t\t\t\t\t\t\t\tboxShadow: '0 2px 12px #eb2f9644',\r\n\t\t\t\t\t\t\t\ttransition: 'box-shadow 0.2s, transform 0.2s',\r\n\t\t\t\t\t\t\t\tpadding: 0,\r\n\t\t\t\t\t\t\t\tcursor: 'pointer'\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tbodyStyle={{ padding: 24 }}\r\n\t\t\t\t\t\t\tonMouseEnter={e => e.currentTarget.style.transform = 'translateY(-6px) scale(1.03)'}\r\n\t\t\t\t\t\t\tonMouseLeave={e => e.currentTarget.style.transform = 'none'}\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div style={{ display: 'flex', flexDirection: 'column', alignItems: 'center', gap: 12 }}>\r\n\t\t\t\t\t\t\t\t<div style={{ background: '#eb2f96', borderRadius: '50%', width: 54, height: 54, display: 'flex', alignItems: 'center', justifyContent: 'center', marginBottom: 8 }}>\r\n\t\t\t\t\t\t\t\t\t<Badge count={announcementsCount} offset={[8, 0]}>\r\n\t\t\t\t\t\t\t\t\t\t<NotificationOutlined style={{ color: '#fff', fontSize: 28, transition: 'transform 0.2s' }} />\r\n\t\t\t\t\t\t\t\t\t</Badge>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<Typography.Title level={2} style={{ margin: 0, fontWeight: 800 }}>{announcementsCount}</Typography.Title>\r\n\t\t\t\t\t\t\t\t<Typography.Text style={{ fontSize: 18, color: '#eb2f96', fontWeight: 700 }}>Announcements</Typography.Text>\r\n\t\t\t\t\t\t\t\t{/* subtitle and action button removed */}\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</Card>\r\n\t\t\t\t\t</Col>\r\n\t\t\t\t</Row>\r\n        \r\n\t\t\t\t{/* Pending Requests Modal */}\r\n\t\t\t\t<Modal\r\n\t\t\t\t\ttitle=\"Pending Requests\"\r\n\t\t\t\t\tvisible={pendingModalVisible}\r\n\t\t\t\t\tonCancel={() => setPendingModalVisible(false)}\r\n\t\t\t\t\tfooter={null}\r\n\t\t\t\t\twidth={800}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Table\r\n\t\t\t\t\t\tdataSource={pendingRequestsList}\r\n\t\t\t\t\t\tloading={pendingLoading}\r\n\t\t\t\t\t\trowKey={(record: any) => record._id}\r\n\t\t\t\t\t\tpagination={{ pageSize: 8 }}\r\n\t\t\t\t\t\tcolumns={[\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttitle: 'First Name',\r\n\t\t\t\t\t\t\t\tdataIndex: 'fieldValues',\r\n\t\t\t\t\t\t\t\tkey: 'firstName',\r\n\t\t\t\t\t\t\t\trender: (fv: any, record: any) => fv?.firstName || record.username || 'Unknown'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttitle: 'Doc Type',\r\n\t\t\t\t\t\t\t\tdataIndex: 'type',\r\n\t\t\t\t\t\t\t\tkey: 'type',\r\n\t\t\t\t\t\t\t\trender: (text: string) => text || 'Unknown'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttitle: 'Status',\r\n\t\t\t\t\t\t\t\tdataIndex: 'status',\r\n\t\t\t\t\t\t\t\tkey: 'status',\r\n\t\t\t\t\t\t\t\trender: (text: string) => (text || '').toString().toLowerCase()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</Modal>\r\n\t\t\t\t{/* Approved Requests Modal */}\r\n\t\t\t\t<Modal\r\n\t\t\t\t\ttitle=\"Approved Documents\"\r\n\t\t\t\t\tvisible={approvedModalVisible}\r\n\t\t\t\t\tonCancel={() => setApprovedModalVisible(false)}\r\n\t\t\t\t\tfooter={null}\r\n\t\t\t\t\twidth={1000}\r\n\t\t\t\t>\r\n\t\t\t\t\t<Table\r\n\t\t\t\t\t\tdataSource={approvedRequestsList}\r\n\t\t\t\t\t\tloading={approvedLoading}\r\n\t\t\t\t\t\trowKey={(record: any) => record._id}\r\n\t\t\t\t\t\tpagination={{ pageSize: 8 }}\r\n\t\t\t\t\t\tcolumns={[\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttitle: 'First Name',\r\n\t\t\t\t\t\t\t\tdataIndex: 'fieldValues',\r\n\t\t\t\t\t\t\t\tkey: 'firstName',\r\n\t\t\t\t\t\t\t\trender: (fv: any, record: any) => fv?.firstName || record.username || 'Unknown'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttitle: 'Doc Type',\r\n\t\t\t\t\t\t\t\tdataIndex: 'type',\r\n\t\t\t\t\t\t\t\tkey: 'type',\r\n\t\t\t\t\t\t\t\trender: (text: string) => text || 'Unknown'\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttitle: 'Date Requested',\r\n\t\t\t\t\t\t\t\tdataIndex: 'dateRequested',\r\n\t\t\t\t\t\t\t\tkey: 'dateRequested',\r\n\t\t\t\t\t\t\t\trender: (_: any, record: any) => formatDate(record.dateRequested || record.requestedAt || record.createdAt)\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttitle: 'Date Approved',\r\n\t\t\t\t\t\t\t\tdataIndex: 'dateApproved',\r\n\t\t\t\t\t\t\t\tkey: 'dateApproved',\r\n\t\t\t\t\t\t\t\trender: (_: any, record: any) => formatDate(record.dateApproved || record.approvedAt || record.approvedOn || record.updatedAt)\r\n\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\ttitle: 'Status',\r\n\t\t\t\t\t\t\t\tdataIndex: 'status',\r\n\t\t\t\t\t\t\t\tkey: 'status',\r\n\t\t\t\t\t\t\t\trender: (text: string) => (text || '').toString().toLowerCase()\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t]}\r\n\t\t\t\t\t/>\r\n\t\t\t\t</Modal>\r\n\t\t\t\t{/* Resident Tool Tips Modal */}\r\n\t\t\t\t<Modal\r\n\t\t\t\t\ttitle=\"Resident Tool Tips\"\r\n\t\t\t\t\tvisible={tipsModalVisible}\r\n\t\t\t\t\tonCancel={() => setTipsModalVisible(false)}\r\n\t\t\t\t\tfooter={(\r\n\t\t\t\t\t\t<div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', width: '100%' }}>\r\n\t\t\t\t\t\t\t<Checkbox\r\n\t\t\t\t\t\t\t\tchecked={hideTips}\r\n\t\t\t\t\t\t\t\tonChange={e => {\r\n\t\t\t\t\t\t\t\t\tconst val = e.target.checked;\r\n\t\t\t\t\t\t\t\t\tsetHideTips(val);\r\n\t\t\t\t\t\t\t\t\ttry { localStorage.setItem('residentTips.hide', val ? 'true' : 'false'); } catch (err) {}\r\n\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t>Don't show again</Checkbox>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<Button onClick={() => setTipsModalVisible(false)} style={{ marginRight: 8 }}>Cancel</Button>\r\n\t\t\t\t\t\t\t\t<Button type=\"primary\" onClick={() => { setTipsModalVisible(false); }}>Got it</Button>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</div>\r\n\t\t\t\t\t)}\r\n\t\t\t\t\twidth={720}\r\n\t\t\t\t>\r\n\t\t\t\t\t<ul style={{ paddingLeft: 20 }}>\r\n\t\t\t\t\t\t<li>Use the Request Document button to apply for barangay certificates and permits.</li>\r\n\t\t\t\t\t\t<li>Check your profile information regularly to ensure accuracy.</li>\r\n\t\t\t\t\t\t<li>Contact barangay staff for assistance with business registration or solo parent certification.</li>\r\n\t\t\t\t\t\t<li>For lost documents, contact barangay staff or visit the office for assistance.</li>\r\n\t\t\t\t\t\t<li>All document requests are processed during office hours only.</li>\r\n\t\t\t\t\t</ul>\r\n\t\t\t\t</Modal>\r\n\t\t\t\t{/* Floating help button (bottom-right) */}\r\n\t\t\t\t<div style={{ position: 'fixed', right: 20, bottom: 24, zIndex: 1050 }}>\r\n\t\t\t\t\t<Tooltip title={hideTips ? 'Tips hidden (will remain hidden if checked)' : 'Resident Tool Tips'}>\r\n\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\ttype=\"primary\"\r\n\t\t\t\t\t\t\tshape=\"circle\"\r\n\t\t\t\t\t\t\tsize=\"large\"\r\n\t\t\t\t\t\t\tonClick={() => setTipsModalVisible(true)}\r\n\t\t\t\t\t\t\tonMouseEnter={() => setHelpHover(true)}\r\n\t\t\t\t\t\t\tonMouseLeave={() => setHelpHover(false)}\r\n\t\t\t\t\t\t\ticon={<QuestionCircleOutlined style={{ color: '#fff', fontSize: 20 }} />}\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\twidth: 56,\r\n\t\t\t\t\t\t\t\theight: 56,\r\n\t\t\t\t\t\t\t\tdisplay: 'flex',\r\n\t\t\t\t\t\t\t\talignItems: 'center',\r\n\t\t\t\t\t\t\t\tjustifyContent: 'center',\r\n\t\t\t\t\t\t\t\tboxShadow: helpHover ? '0 10px 30px rgba(24,144,255,0.22)' : '0 6px 18px rgba(0,0,0,0.12)',\r\n\t\t\t\t\t\t\t\ttransform: helpHover ? 'translateY(-4px) scale(1.03)' : 'none',\r\n\t\t\t\t\t\t\t\ttransition: 'transform 160ms cubic-bezier(.2,.8,.2,1), box-shadow 160ms',\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t/>\r\n\t\t\t\t\t</Tooltip>\r\n\t\t\t\t</div>\r\n\t\t\t\t{/* ...other dashboard sections... */}\r\n\t\t\t</div>\r\n\t\t</>\r\n\t);\r\n};\r\n\r\nexport default GuestDashboard;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Card, Row, Col, Statistic, List, Typography, Space, Avatar, Spin, Button, Modal, Input, Collapse, Tag, Empty, Badge, Timeline, Drawer, Table, notification } from 'antd';\r\nimport {\r\n  HourglassOutlined,\r\n  CaretUpOutlined,\r\n  FolderOutlined,\r\n  DatabaseOutlined,\r\n  CheckCircleOutlined,\r\n  CheckOutlined,\r\n  InboxOutlined,\r\n  RightOutlined,\r\n  FileTextOutlined,\r\n  ClockCircleOutlined,\r\n  ExclamationCircleOutlined,\r\n  FileDoneOutlined,\r\n  FileExclamationOutlined,\r\n  MessageOutlined,\r\n  SafetyCertificateOutlined,\r\n  ProfileOutlined,\r\n  FileSearchOutlined,\r\n  SolutionOutlined,\r\n  TeamOutlined,\r\n  MailOutlined\r\n} from '@ant-design/icons';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { documentsAPI, contactAPI, getAbsoluteApiUrl, axiosInstance } from '../services/api';\r\n\r\n\r\ninterface DocumentRequest {\r\n  _id?: string;\r\n  type?: string;\r\n  title?: string;\r\n  description?: string;\r\n  username?: string;\r\n  barangayID?: string;\r\n  dateRequested?: string;\r\n  status?: string;\r\n  [key: string]: any;\r\n}\r\n\r\nconst StaffDashboard: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const navigate = useNavigate();\r\n  const [loading, setLoading] = useState(false);\r\n  const [documentRequests, setDocumentRequests] = useState<DocumentRequest[]>([]);\r\n  const [inquiries, setInquiries] = useState<any[]>([]);\r\n  const [inboxInquiries, setInboxInquiries] = useState<any[]>([]);\r\n  const [viewedInquiryIds, setViewedInquiryIds] = useState<Set<string>>(() => {\r\n    try {\r\n      const raw = localStorage.getItem('viewedInquiries');\r\n      const arr = raw ? JSON.parse(raw) as string[] : [];\r\n      return new Set(arr || []);\r\n    } catch (e) {\r\n      return new Set<string>();\r\n    }\r\n  });\r\n\r\n  const markInquiryViewed = (id?: string) => {\r\n    if (!id) return;\r\n    setViewedInquiryIds(prev => {\r\n      const next = new Set(Array.from(prev));\r\n      next.add(String(id));\r\n      try { localStorage.setItem('viewedInquiries', JSON.stringify(Array.from(next))); } catch (e) {}\r\n      return next;\r\n    });\r\n  };\r\n\r\n  // Handle responding to an inquiry from the Inquiry Response modal\r\n  const handleInquiryResponse = async () => {\r\n    if (!selectedInquiry) return;\r\n    const id = selectedInquiry._id || selectedInquiry.id;\r\n    if (!id) return;\r\n    try {\r\n      notification.info({ message: 'Sending response', description: 'Posting your reply...', duration: 1.2 });\r\n      await contactAPI.respondToInquiry(id, { response: responseText });\r\n      // Update local inquiries list if present\r\n      setInquiries(prev => (prev || []).map(q => (q && (q._id === id || q.id === id)) ? { ...q, status: 'resolved' } : q));\r\n      notification.success({ message: 'Response sent', description: 'Inquiry has been updated' });\r\n      setSelectedInquiry(null);\r\n      setResponseText('');\r\n    } catch (err: any) {\r\n      console.error('Failed to send inquiry response', err);\r\n      const msg = err?.response?.data?.message || err?.message || 'Failed to send response';\r\n      notification.error({ message: 'Error', description: msg });\r\n    }\r\n  };\r\n  const [recentActivity, setRecentActivity] = useState<any[]>([]);\r\n  // Mini announcements (replace Recent Activity)\r\n  const [miniAnns, setMiniAnns] = useState<any[]>([]);\r\n  const [miniLoading, setMiniLoading] = useState(false);\r\n  const [miniSelected, setMiniSelected] = useState<any | null>(null);\r\n  const [drawerVisible, setDrawerVisible] = useState(false);\r\n  const [selectedDocument, setSelectedDocument] = useState<DocumentRequest | null>(null);\r\n  const [selectedInquiry, setSelectedInquiry] = useState<any>(null);\r\n  const [manageModalVisible, setManageModalVisible] = useState(false);\r\n  const [manageTableData, setManageTableData] = useState<any[] | null>(null);\r\n  const [responseText, setResponseText] = useState('');\r\n  const [documentStatus, setDocumentStatus] = useState('');\r\n  const [responding, setResponding] = useState(false);\r\n  const [completedModalVisible, setCompletedModalVisible] = useState(false);\r\n  // Documents modal state\r\n  const [docsModalVisible, setDocsModalVisible] = useState(false);\r\n  const [allDocuments, setAllDocuments] = useState<any[]>([]);\r\n  const [docsLoading, setDocsLoading] = useState(false);\r\n\r\n  // Group document requests by type for processing\r\n  const requestsByCategory: { [type: string]: DocumentRequest[] } = {};\r\n  documentRequests.forEach((req) => {\r\n    const docType = req.type || 'Unknown';\r\n    if (!requestsByCategory[docType]) requestsByCategory[docType] = [];\r\n    requestsByCategory[docType].push(req);\r\n  });\r\n\r\n  // Example stats for staff\r\n  const [stats, setStats] = useState({\r\n    pendingRequests: 0,\r\n    totalDocuments: 0,\r\n    completedRequests: 0,\r\n  });\r\n\r\n  // Group requests by category\r\n  const categorizeRequests = (requests: DocumentRequest[]) => {\r\n    const categories = {\r\n      'Certificates': {\r\n        icon: <SafetyCertificateOutlined style={{ fontSize: '18px', color: '#1890ff' }} />,\r\n        items: [] as DocumentRequest[],\r\n        color: '#1890ff',\r\n        description: 'Birth, Death, Residency Certificates and more'\r\n      },\r\n      'Permits': {\r\n        icon: <ProfileOutlined style={{ fontSize: '18px', color: '#52c41a' }} />,\r\n        items: [] as DocumentRequest[],\r\n        color: '#52c41a',\r\n        description: 'Building, Business, and Special Event Permits'\r\n      }\r\n      ,\r\n      'Complete': {\r\n        icon: <FileDoneOutlined style={{ fontSize: '18px', color: '#52c41a' }} />,\r\n        items: [] as DocumentRequest[],\r\n        color: '#52c41a',\r\n        description: 'All completed and approved document requests'\r\n      }\r\n    };\r\n\r\n    requests.forEach(req => {\r\n      const type = (req.type || '').toLowerCase();\r\n      const status = (req.status || '').toLowerCase();\r\n      if (type.includes('certificate') || type.includes('certification')) {\r\n        categories['Certificates'].items.push(req);\r\n      } else if (type.includes('permit')) {\r\n        categories['Permits'].items.push(req);\r\n      }\r\n\r\n      // Add to Complete category if status is approved/completed\r\n      if (status === 'approved' || status === 'completed') {\r\n        categories['Complete'].items.push(req);\r\n      }\r\n    });\r\n\r\n    return categories;\r\n  };\r\n\r\n  // Download processed document (handles both metadata id and direct GridFS file id)\r\n  const handleDownloadProcessed = async (rec: any) => {\r\n    try {\r\n      // Follow TemplatesManager behavior: fetch the raw endpoint, convert to blob, and save using the server-provided filename when available.\r\n      // Try metadata id first, then fall back to gridFsFileId if present and the first attempt 404s.\r\n      const normalizeId = (v: any): string | null => {\r\n        if (!v && v !== 0) return null;\r\n        if (typeof v === 'string') return v;\r\n        if (typeof v === 'object') {\r\n          // Mongoose ObjectId-like objects may expose $oid (BSON) or toString()\r\n          if (typeof v.$oid === 'string') return v.$oid;\r\n          try {\r\n            const s = (v as any).toString();\r\n            if (s && s !== '[object Object]') return s;\r\n          } catch (e) {}\r\n          return null;\r\n        }\r\n        return String(v);\r\n      };\r\n\r\n      const tryIds = [] as string[];\r\n      const nid = normalizeId(rec && rec._id);\r\n      const ngfid = normalizeId(rec && rec.gridFsFileId);\r\n      if (nid) tryIds.push(nid);\r\n      if (ngfid) tryIds.push(ngfid);\r\n      // de-dupe\r\n      const ids = Array.from(new Set(tryIds));\r\n      let finalResp: Response | null = null;\r\n      let usedId: string | null = null;\r\n      let lastError: any = null;\r\n\r\n      console.debug('[handleDownloadProcessed] record:', rec, 'candidateIds:', ids);\r\n      let finalBlob: Blob | null = null;\r\n      let finalHeaders: any = null;\r\n      for (const id of ids) {\r\n        try {\r\n          console.debug('[handleDownloadProcessed] attempting id=', id);\r\n          const r = await (await import('../services/api')).axiosInstance.get(`/processed-documents/${id}/raw`, { responseType: 'blob' });\r\n          if (r && r.status >= 200 && r.status < 300) {\r\n            finalBlob = r.data as Blob;\r\n            finalHeaders = r.headers || {};\r\n            usedId = id;\r\n            break;\r\n          }\r\n        } catch (err: any) {\r\n          const status = err && err.response && err.response.status ? err.response.status : null;\r\n          if (status === 404) {\r\n            lastError = { status: 404, body: err.response && err.response.data ? err.response.data : null };\r\n            continue;\r\n          }\r\n          notification.error({ message: 'Download failed', description: status ? `Server returned ${status}` : String(err) });\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (!finalBlob) {\r\n        const msg = lastError && lastError.body && lastError.body.message ? lastError.body.message : (lastError && lastError.message) ? lastError.message : 'File not found';\r\n        notification.error({ message: 'Download failed', description: msg });\r\n        return;\r\n      }\r\n\r\n      const blob = finalBlob;\r\n\r\n      // Prefer filename from Content-Disposition header if provided\r\n      let filename: string | null = null;\r\n      const cd = (finalHeaders && (finalHeaders['content-disposition'] || finalHeaders['Content-Disposition'])) || null;\r\n      if (cd) {\r\n        const m = cd.match(/filename\\*=UTF-8''([^;\\n\\r]+)/i);\r\n        if (m && m[1]) filename = decodeURIComponent(m[1]);\r\n        else {\r\n          const m2 = cd.match(/filename=\"?([^\";]+)\"?/i);\r\n          if (m2 && m2[1]) filename = m2[1];\r\n        }\r\n      }\r\n      // Fallback to X-Processed headers or record fields\r\n      if (!filename) filename = (finalHeaders && (finalHeaders['x-processed-transactioncode'] || finalHeaders['X-Processed-TransactionCode'])) || rec.filename || rec.name || `document_${usedId || rec._id}.docx`;\r\n\r\n      const url = window.URL.createObjectURL(blob);\r\n      const a = document.createElement('a');\r\n      a.href = url;\r\n      const downloadName = filename || `document_${usedId || rec._id}.docx`;\r\n      a.download = downloadName;\r\n      document.body.appendChild(a);\r\n      a.click();\r\n      a.remove();\r\n      window.URL.revokeObjectURL(url);\r\n    } catch (err) {\r\n      console.error('Download error', err);\r\n      notification.error({ message: 'Download error', description: String(err) });\r\n    }\r\n  };\r\n\r\n  const getStatusTag = (status?: string) => {\r\n    const statusColors: { [key: string]: string } = {\r\n      'pending': 'gold',\r\n      'approved': 'success',\r\n      'rejected': 'error',\r\n      'processing': 'processing'\r\n    };\r\n\r\n    return (\r\n      <Tag color={statusColors[status?.toLowerCase() || 'default']}>\r\n        {status?.toUpperCase() || 'UNKNOWN'}\r\n      </Tag>\r\n    );\r\n  };\r\n\r\n  const getActivityIcon = (type: string) => {\r\n    const iconStyle = { fontSize: '20px' };\r\n    const iconMap: { [key: string]: React.ReactNode } = {\r\n      'document_approved': <FileDoneOutlined style={{ ...iconStyle, color: '#52c41a' }} />,\r\n      'document_rejected': <FileExclamationOutlined style={{ ...iconStyle, color: '#ff4d4f' }} />,\r\n      'inquiry_responded': <MessageOutlined style={{ ...iconStyle, color: '#1890ff' }} />,\r\n      'document_submitted': <FileTextOutlined style={{ ...iconStyle, color: '#faad14' }} />,\r\n      'default': <ClockCircleOutlined style={{ ...iconStyle, color: '#8c8c8c' }} />\r\n    };\r\n    return iconMap[type] || iconMap['default'];\r\n  };\r\n\r\n  const fetchData = async () => {\r\n    setLoading(true);\r\n    try {\r\n      // Fetch document records from /documents (not /document-requests/all)\r\n      const [docRecords, inq] = await Promise.all([\r\n        documentsAPI.getDocumentRecords(),\r\n        contactAPI.getAllInquiries()\r\n      ]);\r\n      setDocumentRequests(docRecords);\r\n      setInquiries(inq);\r\n      // Filter for inbox: assignedRole matches user.role or assignedTo includes user._id\r\n      const filtered = inq.filter((inq: any) =>\r\n        (inq.assignedRole && user && inq.assignedRole === user.role) ||\r\n        (inq.assignedTo && Array.isArray(inq.assignedTo) && user && inq.assignedTo.includes(user._id))\r\n      );\r\n      setInboxInquiries(filtered);\r\n      // Attempt to get count of processed documents from server-side processed_documents metadata\r\n      let processedCount = docRecords.length;\r\n      try {\r\n        const resp = await axiosInstance.get('/processed-documents', { params: { page: 1, limit: 1 } });\r\n        const j = resp && resp.data ? resp.data : null;\r\n        if (j && typeof j.total === 'number') processedCount = j.total;\r\n      } catch (e) {\r\n        // ignore and fall back to docRecords.length\r\n      }\r\n\r\n      setStats({\r\n        pendingRequests: docRecords.filter((d: any) => d.status === 'pending').length,\r\n        totalDocuments: processedCount,\r\n        completedRequests: docRecords.filter((d: any) => d.status === 'approved').length,\r\n      });\r\n    } catch (error) {\r\n      console.error('Error fetching data:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchData();\r\n    fetchMiniAnnouncements();\r\n  }, []);\r\n\r\n  // Fetch processed documents (from documents collection) and open modal\r\n  const fetchAllProcessedDocuments = async () => {\r\n    setDocsLoading(true);\r\n    try {\r\n      // Prefer processed_documents metadata endpoint; fallback to older documents listing\r\n      let processedItems: any[] = [];\r\n      try {\r\n        const resp = await axiosInstance.get('/processed-documents', { params: { page: 1, limit: 200 } });\r\n        const j = resp && resp.data ? resp.data : null;\r\n        if (j && Array.isArray(j.items)) {\r\n          processedItems = j.items;\r\n        } else if (Array.isArray(j)) {\r\n          processedItems = j as any[];\r\n        }\r\n      } catch (e) {\r\n        // fallback to older endpoints\r\n        try {\r\n          const files: any = await documentsAPI.listFiles();\r\n          const arr = Array.isArray(files) ? files : (files && files.data) ? files.data : [];\r\n          processedItems = arr.filter((d: any) => {\r\n            const s = (d.status || '').toString().toLowerCase();\r\n            return ['processed', 'approved', 'completed'].includes(s) || d.processed === true;\r\n          });\r\n        } catch (e2) {\r\n          processedItems = [];\r\n        }\r\n      }\r\n\r\n      setAllDocuments(processedItems || []);\r\n    } catch (err) {\r\n      console.error('Failed to fetch documents for modal', err);\r\n      setAllDocuments([]);\r\n    } finally {\r\n      setDocsLoading(false);\r\n      setDocsModalVisible(true);\r\n    }\r\n  };\r\n\r\n  const fetchMiniAnnouncements = async () => {\r\n    setMiniLoading(true);\r\n    try {\r\n      const data = await contactAPI.getAnnouncements();\r\n      setMiniAnns(Array.isArray(data) ? data.slice(0, 6) : []);\r\n    } catch (err) {\r\n      console.error('Failed to load mini announcements', err);\r\n      setMiniAnns([]);\r\n    } finally {\r\n      setMiniLoading(false);\r\n    }\r\n  };\r\n  // Open Manage/Expand modal helper (centralized for logging + notification)\r\n  const openManageModal = (e?: React.MouseEvent) => {\r\n    try {\r\n      if (e && typeof e.stopPropagation === 'function') e.stopPropagation();\r\n    } catch (err) {}\r\n    try {\r\n      console.debug('[StaffDashboard] openManageModal clicked');\r\n      notification.info({ message: 'Opening Inquiries', description: 'Loading inquiries into the table...', duration: 1.5 });\r\n    } catch (err) {}\r\n    setManageTableData(sortByDateDesc(inquiries));\r\n    setManageModalVisible(true);\r\n  };\r\n\r\n  // Handle approve/reject/other document actions from Document Response modal\r\n  const handleDocumentAction = async () => {\r\n    if (!selectedDocument) return;\r\n    const id = selectedDocument._id || selectedDocument.id;\r\n    if (!id) return;\r\n    try {\r\n      // Use documentsAPI to update status; server expects lowercase status strings\r\n      const payload = { status: (documentStatus || '').toString().toLowerCase(), notes: responseText };\r\n      // Show a short in-UI indicator using notification\r\n      notification.info({ message: 'Processing', description: `Updating document status to ${payload.status}...`, duration: 1.2 });\r\n      await documentsAPI.updateDocumentStatus(id, payload);\r\n      // Update local list if present\r\n      setDocumentRequests(prev => (prev || []).map(d => d && (d._id === id || d.id === id) ? { ...d, status: payload.status } : d));\r\n      notification.success({ message: 'Success', description: `Document marked ${payload.status}` });\r\n      // Clear modal and fields\r\n      setSelectedDocument(null);\r\n      setResponseText('');\r\n      setDocumentStatus('');\r\n    } catch (err: any) {\r\n      console.error('Failed to update document status', err);\r\n      const msg = err?.response?.data?.message || err?.message || 'Failed to update document';\r\n      notification.error({ message: 'Error', description: msg });\r\n    }\r\n  };\r\n\r\n  // Format helpers\r\n  // Helper to format document type for display\r\n  function formatDocumentType(type?: string) {\r\n    if (!type) return 'Unknown';\r\n    // If you have a typeToCategory mapping, use it here\r\n    // let name = typeToCategory[type] || type;\r\n    let name = type;\r\n    // Remove 'Other' prefix and extra spaces\r\n    name = name.replace(/^Other\\s*/i, '').trim();\r\n    // Replace underscores with spaces and capitalize each word\r\n    return name\r\n      .split('_')\r\n      .map(word => {\r\n        const w = word || '';\r\n        return w.length > 0 ? (w.charAt(0).toUpperCase() + w.slice(1).toLowerCase()) : '';\r\n      })\r\n      .filter(Boolean)\r\n      .join(' ');\r\n  }\r\n\r\n  // Helper to format date for display\r\n  function formatDate(dateString?: string) {\r\n    if (!dateString) return '';\r\n    const date = new Date(dateString);\r\n    return date.toLocaleString();\r\n  }\r\n\r\n  // Sort an array of inquiries/documents by createdAt descending (newest first)\r\n  const sortByDateDesc = (arr: any[] = []) => {\r\n    return (arr || []).slice().sort((a: any, b: any) => {\r\n      const ta = a && a.createdAt ? new Date(a.createdAt).getTime() : 0;\r\n      const tb = b && b.createdAt ? new Date(b.createdAt).getTime() : 0;\r\n      return tb - ta;\r\n    });\r\n  };\r\n\r\n  // Only one List for Document Categories will be rendered below in the Card section\r\n  // (Card/Col/Row structure continues below)\r\n\r\n  const goWithState = (path: string, state?: any) => {\r\n    navigate(path, { state });\r\n  };\r\n\r\n  const go = (path: string) => {\r\n    try {\r\n      navigate(path);\r\n    } catch (e) {\r\n      window.location.href = path;\r\n    }\r\n  };\r\n\r\n  // No replacement needed - removing the duplicate function\r\n\r\n  return (\r\n    <Spin spinning={loading} tip=\"Loading...\">\r\n      <div>\r\n        {/* KPI Cards Row */}\r\n        <Row gutter={[16, 16]} style={{ marginBottom: 24 }}>\r\n          <Col xs={24} sm={12} md={6}>\r\n            <Card \r\n              hoverable \r\n              bordered={false}\r\n              size=\"small\"\r\n              onClick={() => {\r\n                // If there are pending requests, navigate to document processing and open the first one\r\n                const pending = documentRequests.find(d => d.status === 'pending');\r\n                if (pending && pending._id) {\r\n                  goWithState('/document-processing', { openRequestId: pending._id });\r\n                } else {\r\n                  goWithState('/document-processing');\r\n                }\r\n              }} \r\n              style={{ \r\n                cursor: 'pointer',\r\n                transition: 'all 0.3s',\r\n                boxShadow: '0 1px 2px rgba(0,0,0,0.05)'\r\n              }}\r\n            >\r\n              <Statistic\r\n                title={\r\n                  <Space>\r\n                    <Avatar size=\"small\" style={{ backgroundColor: '#fff7e6', color: '#faad14' }}>\r\n                      <HourglassOutlined style={{ fontSize: '14px' }} />\r\n                    </Avatar>\r\n                    <span>Pending Requests</span>\r\n                  </Space>\r\n                }\r\n                value={stats.pendingRequests}\r\n                valueStyle={{ color: '#faad14', fontSize: '28px', marginBottom: '4px' }}\r\n                prefix={<CaretUpOutlined style={{ fontSize: '16px' }} />}\r\n              />\r\n              <Typography.Link style={{ fontSize: '13px', color: '#faad14' }}>\r\n                View Pending Requests\r\n                <RightOutlined style={{ fontSize: '11px', marginLeft: '4px' }} />\r\n              </Typography.Link>\r\n            </Card>\r\n          </Col>\r\n          <Col xs={24} sm={12} md={6}>\r\n            <Card \r\n              hoverable \r\n              bordered={false}\r\n              size=\"small\"\r\n              onClick={() => fetchAllProcessedDocuments()} \r\n              style={{ \r\n                cursor: 'pointer',\r\n                transition: 'all 0.3s',\r\n                boxShadow: '0 1px 2px rgba(0,0,0,0.05)'\r\n              }}\r\n            >\r\n              <Statistic\r\n                title={\r\n                  <Space>\r\n                    <Avatar size=\"small\" style={{ backgroundColor: '#e6f7ff', color: '#1890ff' }}>\r\n                      <FolderOutlined style={{ fontSize: '14px' }} />\r\n                    </Avatar>\r\n                    <span>Total Documents</span>\r\n                  </Space>\r\n                }\r\n                value={stats.totalDocuments}\r\n                valueStyle={{ color: '#1890ff', fontSize: '28px', marginBottom: '4px' }}\r\n                prefix={<DatabaseOutlined style={{ fontSize: '16px' }} />}\r\n              />\r\n              <Typography.Link style={{ fontSize: '13px', color: '#1890ff' }}>\r\n                Browse Documents\r\n                <RightOutlined style={{ fontSize: '11px', marginLeft: '4px' }} />\r\n              </Typography.Link>\r\n            </Card>\r\n          </Col>\r\n          <Col xs={24} sm={12} md={6}>\r\n            <Card \r\n              hoverable \r\n              bordered={false}\r\n              size=\"small\"\r\n              onClick={() => setCompletedModalVisible(true)} \r\n              style={{ \r\n                cursor: 'pointer',\r\n                transition: 'all 0.3s',\r\n                boxShadow: '0 1px 2px rgba(0,0,0,0.05)'\r\n              }}\r\n            >\r\n              <Statistic\r\n                title={\r\n                  <Space>\r\n                    <Avatar size=\"small\" style={{ backgroundColor: '#f6ffed', color: '#52c41a' }}>\r\n                      <CheckCircleOutlined style={{ fontSize: '14px' }} />\r\n                    </Avatar>\r\n                    <span>Completed Requests</span>\r\n                  </Space>\r\n                }\r\n                value={stats.completedRequests}\r\n                valueStyle={{ color: '#52c41a', fontSize: '28px', marginBottom: '4px' }}\r\n                prefix={<CheckOutlined style={{ fontSize: '16px' }} />}\r\n              />\r\n              <Typography.Link style={{ fontSize: '13px', color: '#52c41a' }}>\r\n                View Completed\r\n                <RightOutlined style={{ fontSize: '11px', marginLeft: '4px' }} />\r\n              </Typography.Link>\r\n            </Card>\r\n          </Col>\r\n          <Col xs={24} sm={12} md={6}>\r\n            <Card \r\n              hoverable \r\n              bordered={false}\r\n              size=\"small\"\r\n              onClick={() => go('/staff/inbox')} \r\n              style={{ \r\n                cursor: 'pointer',\r\n                transition: 'all 0.3s',\r\n                boxShadow: '0 1px 2px rgba(0,0,0,0.05)'\r\n              }}\r\n            >\r\n              <Statistic\r\n                title={\r\n                  <Space>\r\n                    <Avatar size=\"small\" style={{ backgroundColor: '#f9f0ff', color: '#722ed1' }}>\r\n                      <InboxOutlined style={{ fontSize: '14px' }} />\r\n                    </Avatar>\r\n                    <span>Staff Inbox</span>\r\n                  </Space>\r\n                }\r\n                value={inboxInquiries.length}\r\n                valueStyle={{ color: '#722ed1', fontSize: '28px', marginBottom: '4px' }}\r\n                prefix={<MessageOutlined style={{ fontSize: '16px' }} />}\r\n              />\r\n              <Typography.Link style={{ fontSize: '13px', color: '#722ed1' }}>\r\n                Open Inbox\r\n                <RightOutlined style={{ fontSize: '11px', marginLeft: '4px' }} />\r\n              </Typography.Link>\r\n            </Card>\r\n          </Col>\r\n        </Row>\r\n        {/* Main Content Cards */}\r\n        <Row gutter={[16, 16]}>\r\n          <Col xs={24} lg={8}>\r\n            <Card \r\n              title={<Space><FileSearchOutlined /> Document Categories</Space>} \r\n              hoverable\r\n              bordered={false}\r\n              size=\"small\"\r\n              className=\"dashboard-card\"\r\n              style={{ \r\n                transition: 'all 0.3s',\r\n                boxShadow: '0 1px 2px rgba(0,0,0,0.05)'\r\n              }}\r\n              bodyStyle={{ \r\n                padding: '0',\r\n                height: '400px',\r\n                maxHeight: '400px',\r\n                overflow: 'hidden'\r\n              }}\r\n            >\r\n              <Collapse\r\n                defaultActiveKey={['Certificates']}\r\n                expandIcon={({ isActive }) => <RightOutlined rotate={isActive ? 90 : 0} />}\r\n                style={{ \r\n                  background: 'white',\r\n                  height: '400px',\r\n                  overflowY: 'auto'\r\n                }}\r\n              >\r\n                {Object.entries(categorizeRequests(documentRequests)).map(([category, data]) => {\r\n                  const pendingCount = data.items.filter((req: DocumentRequest) => req.status?.toLowerCase() === 'pending').length;\r\n                  return (\r\n                    <Collapse.Panel\r\n                      key={category}\r\n                      header={\r\n                        <div style={{ display: 'flex', alignItems: 'center', width: '100%' }}>\r\n                          <Space align=\"center\">\r\n                            <Avatar size=\"small\" style={{ backgroundColor: data.color + '15', color: data.color }}>\r\n                              {data.icon}\r\n                            </Avatar>\r\n                            <span style={{ fontWeight: 500, fontSize: '14px' }}>{category}</span>\r\n                          </Space>\r\n                          <div style={{ marginLeft: 'auto', display: 'flex', gap: '8px', alignItems: 'center' }}>\r\n                            {pendingCount > 0 && (\r\n                              <Tag color=\"gold\" style={{ marginRight: 0 }}>\r\n                                {pendingCount} pending\r\n                              </Tag>\r\n                            )}\r\n                            <Badge \r\n                              count={data.items.length} \r\n                              style={{ backgroundColor: data.color }}\r\n                              size=\"small\"\r\n                            />\r\n                          </div>\r\n                        </div>\r\n                      }\r\n                    >\r\n                      <div style={{ marginBottom: '16px' }}>\r\n                        <Typography.Text type=\"secondary\" style={{ fontSize: '13px' }}>\r\n                          {data.description}\r\n                        </Typography.Text>\r\n                      </div>\r\n                      \r\n                      <List\r\n                        size=\"small\"\r\n                        dataSource={data.items.slice(0, 5)}\r\n                        split={true}\r\n                        renderItem={request => {\r\n                          const statusColors = {\r\n                            PENDING: { color: '#faad14', bg: '#fff7e6' },\r\n                            APPROVED: { color: '#52c41a', bg: '#f6ffed' },\r\n                            REJECTED: { color: '#ff4d4f', bg: '#fff1f0' },\r\n                            DEFAULT: { color: '#8c8c8c', bg: '#f5f5f5' }\r\n                          };\r\n                          \r\n                          const status = request.status?.toUpperCase() || 'DEFAULT';\r\n                          const statusStyle = statusColors[status as keyof typeof statusColors] || statusColors.DEFAULT;\r\n\r\n                          return (\r\n                            <List.Item\r\n                              onClick={() => navigate('/document-processing', { state: { openRequestId: request._id } })}\r\n                              actions={[\r\n                                request.status === 'PENDING' && (\r\n                                  <Space size={4}>\r\n                                    <Button\r\n                                      type=\"text\"\r\n                                      size=\"small\"\r\n                                      icon={<CheckOutlined style={{ color: '#52c41a' }} />}\r\n                                      onClick={(e) => { e.stopPropagation(); setSelectedDocument(request); setDocumentStatus('APPROVED'); }}\r\n                                    />\r\n                                    <Button\r\n                                      type=\"text\"\r\n                                      size=\"small\"\r\n                                      icon={<ExclamationCircleOutlined style={{ color: '#ff4d4f' }} />}\r\n                                      onClick={(e) => { e.stopPropagation(); setSelectedDocument(request); setDocumentStatus('REJECTED'); }}\r\n                                    />\r\n                                  </Space>\r\n                                )\r\n                              ].filter(Boolean)}\r\n                              style={{ padding: '12px 0' }}\r\n                            >\r\n                              <List.Item.Meta\r\n                                avatar={\r\n                                  <Avatar\r\n                                    size={36}\r\n                                    style={{ \r\n                                      backgroundColor: statusStyle.bg,\r\n                                      color: statusStyle.color\r\n                                    }}\r\n                                    icon={<FileTextOutlined />}\r\n                                  />\r\n                                }\r\n                                title={\r\n                                  <Space size={8} style={{ marginBottom: 4 }}>\r\n                                    <Typography.Text strong style={{ fontSize: '14px' }}>\r\n                                      {formatDocumentType(request.type || request.title)}\r\n                                    </Typography.Text>\r\n                                    <Tag\r\n                                      color={statusStyle.color}\r\n                                      style={{ \r\n                                        margin: 0,\r\n                                        padding: '0 6px',\r\n                                        fontSize: '12px',\r\n                                        lineHeight: '18px'\r\n                                      }}\r\n                                    >\r\n                                      {status}\r\n                                    </Tag>\r\n                                  </Space>\r\n                                }\r\n                                description={\r\n                                  <Space direction=\"vertical\" size={0}>\r\n                                    <Typography.Text type=\"secondary\" style={{ fontSize: '13px' }}>\r\n                                      Requested by: {request.username || 'Unknown'}\r\n                                    </Typography.Text>\r\n                                    <Typography.Text type=\"secondary\" style={{ fontSize: '12px' }}>\r\n                                      {formatDate(request.dateRequested || '')}\r\n                                    </Typography.Text>\r\n                                  </Space>\r\n                                }\r\n                              />\r\n                            </List.Item>\r\n                          );\r\n                        }}\r\n                        locale={{ \r\n                          emptyText: (\r\n                            <Empty \r\n                              image={Empty.PRESENTED_IMAGE_SIMPLE} \r\n                              description={\r\n                                <Typography.Text type=\"secondary\">\r\n                                  No {category.toLowerCase()} requests\r\n                                </Typography.Text>\r\n                              }\r\n                            />\r\n                          )\r\n                        }}\r\n                      />\r\n                      {data.items.length > 0 && (\r\n                        <div style={{ \r\n                          textAlign: 'center', \r\n                          marginTop: '16px',\r\n                          paddingTop: '16px',\r\n                          borderTop: '1px solid #f0f0f0'\r\n                        }}>\r\n                          <Button\r\n                            type=\"link\"\r\n                            size=\"small\"\r\n                            icon={data.icon}\r\n                            onClick={() => go('/documents')}\r\n                          >\r\n                            View All {category}\r\n                          </Button>\r\n                        </div>\r\n                      )}\r\n                    </Collapse.Panel>\r\n                  );\r\n                })}\r\n              </Collapse>\r\n            </Card>\r\n          </Col>\r\n          <Col xs={24} lg={8}>\r\n              <Card \r\n              title={\r\n                <Space>\r\n                  <MailOutlined />\r\n                  <span>Inquiries Inbox</span>\r\n                  <Badge \r\n                    count={inboxInquiries.filter(i => i.status === 'open' || i.status === 'PENDING').length} \r\n                    style={{ backgroundColor: '#722ed1' }}\r\n                  />\r\n                </Space>\r\n              }\r\n              extra={\r\n                <Space>\r\n                  <Statistic\r\n                    value={inboxInquiries.length}\r\n                    suffix=\"total\"\r\n                    valueStyle={{ fontSize: '14px', color: '#8c8c8c' }}\r\n                  />\r\n                </Space>\r\n              }\r\n              hoverable\r\n              bordered={false}\r\n              size=\"small\"\r\n              className=\"dashboard-card\"\r\n              style={{ \r\n                transition: 'all 0.3s',\r\n                boxShadow: '0 1px 2px rgba(0,0,0,0.05)',\r\n                position: 'relative'\r\n              }}\r\n              bodyStyle={{ \r\n                height: '400px',\r\n                maxHeight: '400px',\r\n                padding: 0,\r\n                overflow: 'hidden'\r\n              }}\r\n            >\r\n              <div style={{ padding: '0 12px' }}>\r\n                <Collapse\r\n                  accordion={false}\r\n                  defaultActiveKey={[ 'open' ]}\r\n                  expandIcon={({ isActive }) => <RightOutlined rotate={isActive ? 90 : 0} />}\r\n                  style={{ background: 'white' }}\r\n                >\r\n                  <Collapse.Panel\r\n                    key=\"open\"\r\n                    header={\r\n                      <div style={{ display: 'flex', alignItems: 'center', width: '100%' }}>\r\n                        <Space align=\"center\">\r\n                          <MailOutlined style={{ color: '#722ed1', fontSize: '16px' }} />\r\n                          <Typography.Text strong>Open Inquiries</Typography.Text>\r\n                          <Badge count={inboxInquiries.filter(i => i.status === 'PENDING' || i.status === 'open').length} style={{ backgroundColor: '#722ed1' }} />\r\n                        </Space>\r\n                      </div>\r\n                    }\r\n                  >\r\n                    <div style={{ maxHeight: 300, overflowY: 'auto', paddingRight: 8 }}>\r\n                      {inboxInquiries.filter(i => i.status === 'PENDING' || i.status === 'open').length === 0 ? (\r\n                        <Empty image={Empty.PRESENTED_IMAGE_SIMPLE} description={<Typography.Text type=\"secondary\">No open inquiries</Typography.Text>} />\r\n                      ) : (\r\n            <List\r\n                size=\"large\"\r\n              dataSource={sortByDateDesc(inboxInquiries.filter(i => i.status === 'PENDING' || i.status === 'open'))}\r\n                          renderItem={inquiry => {\r\n                  const isOpen = inquiry.status === 'PENDING' || inquiry.status === 'open';\r\n          const avatarColor = isOpen ? '#722ed1' : '#8c8c8c';\r\n          const avatarBg = isOpen ? '#f9f0ff' : '#f5f5f5';\r\n          const isViewed = inquiry._id && viewedInquiryIds.has(String(inquiry._id));\r\n\r\n          const displayName = inquiry.username || inquiry.residentName || inquiry.subject || 'Unknown';\r\n          const letter = (displayName && displayName !== 'Unknown' && displayName.length > 0) ? displayName.charAt(0).toUpperCase() : '?';\r\n\r\n                      return (\r\n                        <List.Item\r\n                      style={{ \r\n                        padding: '18px 20px',\r\n                        minHeight: 72,\r\n                        borderBottom: '1px solid #f0f0f0',\r\n                        transition: 'all 0.3s ease',\r\n                        cursor: 'pointer',\r\n                        backgroundColor: 'white'\r\n                      }}\r\n                      onClick={() => {\r\n                        // mark as viewed locally so the dot color changes (persisted)\r\n                        if (inquiry._id) markInquiryViewed(String(inquiry._id));\r\n                        navigate('/staff/inbox', { state: { openInquiryId: inquiry._id } });\r\n                      }}\r\n                      onMouseEnter={(e) => {\r\n                        e.currentTarget.style.backgroundColor = '#fafafa';\r\n                      }}\r\n                      onMouseLeave={(e) => {\r\n                        e.currentTarget.style.backgroundColor = 'white';\r\n                      }}\r\n                      \r\n                      >\r\n                      <List.Item.Meta\r\n                        avatar={\r\n                          <Badge dot={isOpen} color={isOpen && !isViewed ? '#faad14' : '#722ed1'} offset={[-6, 6]}>\r\n                            <Avatar\r\n                              size={40}\r\n                              style={{\r\n                                backgroundColor: avatarBg,\r\n                                color: avatarColor,\r\n                                fontSize: '15px',\r\n                                fontWeight: 600\r\n                              }}\r\n                            >\r\n                              {letter}\r\n                            </Avatar>\r\n                          </Badge>\r\n                        }\r\n                        title={\r\n                          <div style={{ \r\n                            display: 'flex',\r\n                            alignItems: 'center',\r\n                            gap: '8px',\r\n                            marginBottom: 0\r\n                          }}>\r\n                            <div style={{ \r\n                              fontSize: '14px',\r\n                              fontWeight: 600,\r\n                              color: 'rgba(0, 0, 0, 0.85)'\r\n                            }}>\r\n                              {inquiry.username || 'Unknown User'}\r\n                            </div>\r\n                            <Tag \r\n                              color={isOpen ? 'gold' : 'success'}\r\n                              style={{ \r\n                                margin: 0,\r\n                                fontSize: '12px',\r\n                                lineHeight: '20px',\r\n                                height: '22px',\r\n                                padding: '0 10px',\r\n                                fontWeight: 'normal',\r\n                                borderRadius: '4px'\r\n                              }}\r\n                            >\r\n                              {isOpen ? 'PENDING' : 'RESOLVED'}\r\n                            </Tag>\r\n                            {isOpen && !isViewed && (\r\n                              <Tag\r\n                                color=\"default\"\r\n                                onClick={(e) => { e.stopPropagation(); if (inquiry._id) markInquiryViewed(String(inquiry._id)); }}\r\n                                style={{ marginLeft: 8, cursor: 'pointer', background: '#fff7e6', color: '#d48806', border: '1px solid #ffd591' }}\r\n                              >\r\n                                UNREAD\r\n                              </Tag>\r\n                            )}\r\n                          </div>\r\n                        }\r\n                        description={\r\n                          <div style={{ display: 'flex', alignItems: 'center', gap: '12px', width: '100%' }}>\r\n                            <Typography.Text\r\n                              style={{ \r\n                                fontSize: '13px',\r\n                                color: 'rgba(0, 0, 0, 0.65)',\r\n                                flexGrow: 1,\r\n                                whiteSpace: 'nowrap',\r\n                                overflow: 'hidden',\r\n                                textOverflow: 'ellipsis',\r\n                                lineHeight: '1.5'\r\n                              }}\r\n                            >\r\n                              {inquiry.message}\r\n                            </Typography.Text>\r\n                            <Typography.Text \r\n                              type=\"secondary\" \r\n                              style={{ \r\n                                fontSize: '12px', \r\n                                flexShrink: 0,\r\n                                color: '#8c8c8c'\r\n                              }}\r\n                            >\r\n                              {formatDate(inquiry.createdAt)}\r\n                            </Typography.Text>\r\n                          </div>\r\n                        }\r\n                      />\r\n                    </List.Item>\r\n                          );\r\n                        }}\r\n                      />\r\n                    )}\r\n                  </div>\r\n                </Collapse.Panel>\r\n                <Collapse.Panel\r\n                  key=\"resolved\"\r\n                  header={\r\n                    <div style={{ display: 'flex', alignItems: 'center', width: '100%' }}>\r\n                      <Space align=\"center\">\r\n                        <MailOutlined style={{ color: '#52c41a', fontSize: '16px' }} />\r\n                        <Typography.Text strong>Resolved Inquiries</Typography.Text>\r\n                        <Badge count={inboxInquiries.filter(i => !(i.status === 'PENDING' || i.status === 'open')).length} style={{ backgroundColor: '#52c41a' }} />\r\n                      </Space>\r\n                    </div>\r\n                  }\r\n                >\r\n                  <div style={{ maxHeight: 220, overflowY: 'auto', paddingRight: 8 }}>\r\n                    {inboxInquiries.filter(i => !(i.status === 'PENDING' || i.status === 'open')).length === 0 ? (\r\n                      <Empty image={Empty.PRESENTED_IMAGE_SIMPLE} description={<Typography.Text type=\"secondary\">No resolved inquiries</Typography.Text>} />\r\n                    ) : (\r\n                      <List\r\n                        size=\"small\"\r\n                        dataSource={sortByDateDesc(inboxInquiries.filter(i => !(i.status === 'PENDING' || i.status === 'open')))}\r\n                        renderItem={inquiry => {\r\n                          const isOpen = false;\r\n                          const avatarColor = '#8c8c8c';\r\n                          const avatarBg = '#f5f5f5';\r\n\r\n                          return (\r\n                            <List.Item\r\n                              style={{ padding: '12px 0', borderBottom: '1px solid #f0f0f0' }}\r\n                            onClick={() => {\r\n                              if (inquiry._id) markInquiryViewed(String(inquiry._id));\r\n                              setSelectedInquiry(inquiry);\r\n                            }}\r\n                            >\r\n                              <List.Item.Meta\r\n                                avatar={<Avatar size={40} style={{ backgroundColor: avatarBg, color: avatarColor, fontSize: 14 }}>{(inquiry.username || 'Unknown').charAt(0).toUpperCase()}</Avatar>}\r\n                                title={<div style={{ display: 'flex', alignItems: 'center', gap: 8 }}>\r\n                                  <div style={{ fontSize: 13, fontWeight: 600 }}>{inquiry.username || 'Unknown User'}</div>\r\n                                  <Tag color=\"success\" style={{ margin: 0, fontSize: 12 }}>{'RESOLVED'}</Tag>\r\n                                </div>}\r\n                                description={<div style={{ fontSize: 12, color: '#888' }}>{inquiry.message}</div>}\r\n                              />\r\n                            </List.Item>\r\n                          );\r\n                        }}\r\n                      />\r\n                    )}\r\n                  </div>\r\n                </Collapse.Panel>\r\n              </Collapse>\r\n              {/* Manage button positioned at bottom-right of the card */}\r\n              <div style={{ position: 'absolute', right: 12, bottom: 12, zIndex: 40 }}>\r\n                <Button\r\n                  type=\"link\"\r\n                  style={{ position: 'absolute', right: 16, bottom: 0, fontSize: 13, color: '#1890ff', zIndex: 50, pointerEvents: 'auto' }}\r\n                  onClick={(e) => { try { e.stopPropagation(); } catch (err) {} ; navigate('/inquiry-tracker'); }}\r\n                >\r\n                  Expand\r\n                </Button>\r\n              </div>\r\n            </div>\r\n            </Card>\r\n          </Col>\r\n          <Col xs={24} lg={8}>\r\n            <Card\r\n              title={<Space><FileTextOutlined /> Announcements</Space>}\r\n              style={{ marginTop: 0, background: '#fafbfc', borderRadius: 12, boxShadow: '0 2px 8px #d9d9d933', border: '1px solid #f0f0f0', position: 'relative' }}\r\n              styles={{ body: { padding: 12 } }}\r\n              size=\"small\"\r\n              hoverable={false}\r\n            >\r\n              {miniAnns.length === 0 ? (\r\n                <Empty\r\n                  image={<FileTextOutlined style={{ fontSize: 42, color: '#d9d9d9' }} />}\r\n                  description={<span style={{ color: '#888' }}>No announcements</span>}\r\n                />\r\n              ) : (\r\n                <div style={{ maxHeight: 320, overflowY: 'auto', paddingRight: 6 }}>\r\n                  <List\r\n                    loading={miniLoading}\r\n                    dataSource={miniAnns}\r\n                    renderItem={(item) => (\r\n                      <List.Item style={{ cursor: 'pointer', padding: '10px 8px', alignItems: 'center' }} onClick={() => { setMiniSelected(item); setDrawerVisible(true); }}>\r\n                        <List.Item.Meta\r\n                          title={<div style={{ display: 'flex', alignItems: 'flex-start', gap: 8 }}>\r\n                            <div style={{ flex: 1, minWidth: 0 }}>\r\n                              <div style={{ fontWeight: 600, fontSize: 13, display: '-webkit-box', WebkitLineClamp: 3, WebkitBoxOrient: 'vertical', overflow: 'hidden', textOverflow: 'ellipsis', lineHeight: '1.2em' }}>{item.text || 'Untitled'}</div>\r\n                              <div style={{ fontSize: 12, color: '#888', marginTop: 6 }}>{new Date(item.createdAt).toLocaleString()}</div>\r\n                            </div>\r\n                          </div>}\r\n                          description={null}\r\n                        />\r\n                        {item.imagePath && (\r\n                          <div style={{ marginLeft: 12, width: 92, display: 'flex', justifyContent: 'flex-end', flexShrink: 0 }}>\r\n                            <img loading=\"lazy\" className=\"rounded-img\" src={getAbsoluteApiUrl(`/announcements/${item._id}/image`)} alt=\"ann\" style={{ width: 92, height: 60, objectFit: 'cover', borderRadius: 6, background: '#f0f0f0' }} />\r\n                          </div>\r\n                        )}\r\n                      </List.Item>\r\n                    )}\r\n                    size=\"small\"\r\n                  />\r\n                </div>\r\n              )}\r\n              <Button type=\"link\" style={{ position: 'absolute', right: 16, bottom: 0, fontSize: 13, color: '#1890ff' }} onClick={() => navigate('/admin/announcements')}>Manage</Button>\r\n\r\n              <Drawer open={drawerVisible} onClose={() => { setDrawerVisible(false); setMiniSelected(null); }} title=\"Announcement\" width={720} placement=\"right\">\r\n                {miniSelected && (\r\n                  <div>\r\n                    <Typography.Text style={{ display: 'block', marginBottom: 12, whiteSpace: 'pre-wrap' }}>{miniSelected.text}</Typography.Text>\r\n                    {miniSelected.imagePath && (\r\n                      <img loading=\"lazy\" className=\"rounded-img rounded-img-lg\" src={getAbsoluteApiUrl(`/announcements/${miniSelected._id}/image`)} alt=\"announcement\" style={{ width: '100%', height: 'auto', borderRadius: 8, background: '#f6f6f6' }} />\r\n                    )}\r\n                    <div style={{ marginTop: 8, color: '#888' }}>{new Date(miniSelected.createdAt).toLocaleString()}</div>\r\n                  </div>\r\n                )}\r\n              </Drawer>\r\n            </Card>\r\n\r\n            {/* Completed Requests card removed per user request */}\r\n          </Col>\r\n        </Row>\r\n        {/* Documents Modal - shows processed documents from documents collection */}\r\n        <Modal\r\n          open={docsModalVisible}\r\n          title={`Processed Documents (${allDocuments.length})`}\r\n          onCancel={() => { setDocsModalVisible(false); }}\r\n          footer={null}\r\n          width={900}\r\n        >\r\n          <Spin spinning={docsLoading}>\r\n            <Table\r\n              dataSource={allDocuments}\r\n              rowKey={(r: any) => r._id || r.id || r.filename}\r\n              pagination={{ pageSize: 10 }}\r\n              columns={[\r\n                { title: 'Title', dataIndex: 'title', key: 'title', render: (t: any, r: any) => t || r.filename || r.name || 'Untitled' },\r\n                { title: 'Date', dataIndex: 'createdAt', key: 'createdAt', render: (d: any) => formatDate(d) },\r\n                {\r\n                  title: 'Action',\r\n                  key: 'action',\r\n                  width: 120,\r\n                  render: (_: any, rec: any) => (\r\n                    <Button type=\"link\" onClick={() => handleDownloadProcessed(rec)}>Download</Button>\r\n                  )\r\n                }\r\n              ]}\r\n            />\r\n          </Spin>\r\n          <Modal\r\n            title=\"Manage Inquiries\"\r\n            open={manageModalVisible}\r\n            onCancel={() => { setManageModalVisible(false); setManageTableData(null); }}\r\n            footer={null}\r\n            width={900}\r\n          >\r\n            <Table\r\n              dataSource={manageTableData !== null ? manageTableData : sortByDateDesc(inquiries)}\r\n              rowKey={(r: any) => r._id}\r\n              pagination={{ pageSize: 10 }}\r\n              onRow={(record) => ({\r\n                onClick: () => {\r\n                  // mark viewed and navigate to the thread\r\n                  if (record && record._id) markInquiryViewed(String(record._id));\r\n                  setManageModalVisible(false);\r\n                  navigate('/staff/inbox', { state: { openInquiryId: record._id } });\r\n                }\r\n              })}\r\n            >\r\n              <Table.Column\r\n                title=\"Name\"\r\n                dataIndex=\"username\"\r\n                key=\"username\"\r\n                render={(v: any, r: any) => v || r.residentName || r.subject || 'Unknown'}\r\n              />\r\n              <Table.Column\r\n                title=\"Type of Inquiry\"\r\n                dataIndex=\"type\"\r\n                key=\"type\"\r\n                render={(t: any) => (t ? String(t) : 'General')}\r\n              />\r\n              <Table.Column\r\n                title=\"Status\"\r\n                dataIndex=\"status\"\r\n                key=\"status\"\r\n                render={(s: any) => getStatusTag(s)}\r\n              />\r\n              <Table.Column\r\n                title=\"Date Inquired\"\r\n                dataIndex=\"createdAt\"\r\n                key=\"createdAt\"\r\n                render={(d: any) => formatDate(d)}\r\n              />\r\n            </Table>\r\n          </Modal>\r\n        </Modal>\r\n\r\n        {/* Document Response Modal */}\r\n        <Modal\r\n          open={!!selectedDocument}\r\n          title={selectedDocument ? `${documentStatus} Document Request` : ''}\r\n          onCancel={() => { setSelectedDocument(null); setResponseText(''); setDocumentStatus(''); }}\r\n          footer={selectedDocument ? [\r\n            <Input.TextArea\r\n              key=\"notes\"\r\n              rows={4}\r\n              value={responseText}\r\n              onChange={e => setResponseText(e.target.value)}\r\n              placeholder=\"Type notes...\"\r\n            />,\r\n            <Button\r\n              key=\"submit\"\r\n              type=\"primary\"\r\n              disabled={!responseText.trim()}\r\n              onClick={handleDocumentAction}\r\n            >Submit</Button>\r\n          ] : null}\r\n        >\r\n          {selectedDocument && (\r\n            <div>\r\n              <Typography.Text strong>Type:</Typography.Text> {formatDocumentType(selectedDocument.type || selectedDocument.title)}<br />\r\n              <Typography.Text strong>Description:</Typography.Text> {selectedDocument.description || ''}<br />\r\n              <Typography.Text strong>Requested by:</Typography.Text> {selectedDocument.username || 'Unknown'}<br />\r\n              <Typography.Text strong>Barangay ID:</Typography.Text> {selectedDocument.barangayID || 'Unknown'}<br />\r\n              <Typography.Text strong>Date:</Typography.Text> {formatDate(selectedDocument.dateRequested || '')}<br />\r\n            </div>\r\n          )}\r\n        </Modal>\r\n        {/* Inquiry Response Modal */}\r\n        <Modal\r\n          open={!!selectedInquiry}\r\n          title={selectedInquiry ? `Respond to Inquiry: ${selectedInquiry.subject}` : ''}\r\n          onCancel={() => { setSelectedInquiry(null); setResponseText(''); }}\r\n          footer={selectedInquiry ? [\r\n            <Input.TextArea\r\n              key=\"response\"\r\n              rows={4}\r\n              value={responseText}\r\n              onChange={e => setResponseText(e.target.value)}\r\n              placeholder=\"Type your response...\"\r\n              disabled={responding}\r\n            />,\r\n            <Button\r\n              key=\"send\"\r\n              type=\"primary\"\r\n              loading={responding}\r\n              disabled={!responseText.trim()}\r\n              onClick={handleInquiryResponse}\r\n            >Send Response</Button>\r\n          ] : null}\r\n        >\r\n          {selectedInquiry && (\r\n            <div>\r\n              <Typography.Text strong>Type:</Typography.Text> {selectedInquiry.type}<br />\r\n              <Typography.Text strong>Message:</Typography.Text> {selectedInquiry.message}<br />\r\n              <Typography.Text strong>From:</Typography.Text> {selectedInquiry.username ? `${selectedInquiry.username} (Barangay ID: ${selectedInquiry.barangayID || 'Unknown'})` : 'Unknown'}<br />\r\n              <Typography.Text strong>Date:</Typography.Text> {formatDate(selectedInquiry.createdAt)}<br />\r\n            </div>\r\n          )}\r\n        </Modal>\r\n        {/* Completed Requests Modal */}\r\n        <Modal\r\n          open={completedModalVisible}\r\n          title={`Completed Requests (${stats.completedRequests || 0})`}\r\n          onCancel={() => setCompletedModalVisible(false)}\r\n          footer={null}\r\n          width={1100}\r\n          bodyStyle={{ padding: 12 }}\r\n        >\r\n          <div style={{ overflowX: 'auto' }}>\r\n            {/* Table of completed document requests (horizontally scrollable) */}\r\n            <Table\r\n              dataSource={documentRequests.filter(d => (d.status || '').toLowerCase() === 'approved' || (d.status || '').toLowerCase() === 'completed')}\r\n              rowKey={(record: any) => record._id}\r\n              pagination={{ pageSize: 10 }}\r\n              scroll={{ x: 1000 }}\r\n              columns={[\r\n                {\r\n                  title: 'Requester',\r\n                  dataIndex: 'username',\r\n                  key: 'username',\r\n                  width: 200,\r\n                  render: (val: any, rec: any) => val || rec.requesterId?.fullName || 'Unknown'\r\n                },\r\n                {\r\n                  title: 'Document',\r\n                  dataIndex: 'type',\r\n                  key: 'type',\r\n                  width: 220,\r\n                  render: (val: any, rec: any) => formatDocumentType(val || rec.title)\r\n                },\r\n                {\r\n                  title: 'Description',\r\n                  dataIndex: 'description',\r\n                  key: 'description',\r\n                  width: 300,\r\n                  render: (val: any) => val || '-'\r\n                },\r\n                {\r\n                  title: 'Date Requested',\r\n                  dataIndex: 'dateRequested',\r\n                  key: 'dateRequested',\r\n                  width: 180,\r\n                  render: (val: any) => formatDate(val)\r\n                },\r\n                {\r\n                  title: 'Status',\r\n                  dataIndex: 'status',\r\n                  key: 'status',\r\n                  width: 120,\r\n                  render: (val: any) => getStatusTag(val)\r\n                },\r\n                {\r\n                  title: 'Action',\r\n                  key: 'action',\r\n                  width: 120,\r\n                  render: (_: any, rec: any) => (\r\n                    <Button type=\"link\" onClick={() => { setSelectedDocument(rec); setCompletedModalVisible(false); setDocumentStatus(''); }}>\r\n                      View\r\n                    </Button>\r\n                  )\r\n                }\r\n              ]}\r\n            />\r\n          </div>\r\n        </Modal>\r\n      </div>\r\n    </Spin>\r\n\r\n  );\r\n}\r\n\r\nexport default StaffDashboard;\r\n","\r\nimport io from 'socket.io-client';\r\ntype SocketType = ReturnType<typeof io>;\r\n\r\nlet socket: SocketType | null = null;\r\n\r\n/**\r\n * Initialize the notification socket.\r\n * Priority for endpoint resolution:\r\n * 1. runtime config `__APP_CONFIG__.SOCKET_URL`\r\n * 2. runtime config `__APP_CONFIG__.API_BASE`\r\n * 3. build-time `REACT_APP_API_URL`\r\n * 4. fallback to relative '/' (dev proxy will route to backend)\r\n */\r\nexport function initNotificationSocket(token?: string) {\r\n  if (socket) return socket;\r\n  const cfg = (globalThis as any).__APP_CONFIG__ || {};\r\n  const envApi = process.env.REACT_APP_API_URL;\r\n  let base = cfg.SOCKET_URL || cfg.API_BASE || envApi || '/api';\r\n  let root = String(base).replace(/\\/$/, '');\r\n  // If base is an API path that contains '/api', strip it to get the host root\r\n  if (root.endsWith('/api')) root = root.replace(/\\/api$/, '');\r\n\r\n  // If root is just '/api' (dev), use empty string so socket.io connects to current origin\r\n  if (root === '/api') root = '';\r\n\r\n  socket = io(root || '/', {\r\n    path: '/socket.io',\r\n    transports: ['websocket'],\r\n    auth: token ? { token } : undefined,\r\n    autoConnect: true,\r\n  });\r\n  return socket;\r\n}\r\n\r\nexport function onNotificationEvent(event: string, handler: (...args: any[]) => void) {\r\n  if (!socket) return;\r\n  socket.on(event, handler);\r\n}\r\n\r\nexport function offNotificationEvent(event: string, handler: (...args: any[]) => void) {\r\n  if (!socket) return;\r\n  socket.off(event, handler);\r\n}\r\n\r\nexport function getSocket() {\r\n  return socket;\r\n}\r\n","\r\nimport React, { useState, useEffect } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { Card, Row, Col, Badge, Statistic, List, Typography, Space, Avatar, Spin, Button, Drawer, Input, Table, Empty, Modal } from 'antd';\r\nimport {\r\n  UserOutlined,\r\n  BellOutlined,\r\n  MailOutlined,\r\n  FileTextOutlined,\r\n  TeamOutlined,\r\n  ClockCircleOutlined,\r\n  CheckCircleOutlined,\r\n  CheckOutlined,\r\n  ExclamationCircleOutlined\r\n} from '@ant-design/icons';\r\nimport { adminAPI, notificationAPI, contactAPI, requestsAPI, verificationAPI, getAbsoluteApiUrl } from '../../services/api';\r\nimport { documentsAPI } from '../../services/api';\r\nimport { initNotificationSocket, onNotificationEvent, offNotificationEvent } from '../../services/notificationSocket';\r\nimport { Notification } from '../../types/notification';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\n\r\n// Color palette for SVG pie chart slices\r\nconst pieColors = [\r\n  '#6366F1', // Indigo\r\n  '#22C55E', // Green\r\n  '#F59E42', // Orange\r\n  '#EF4444', // Red\r\n  '#3B82F6', // Blue\r\n  '#FBBF24', // Yellow\r\n  '#A21CAF', // Purple\r\n  '#14B8A6', // Teal\r\n];\r\n\r\nconst { Title, Text } = Typography;\r\n\r\ninterface DashboardStats {\r\n  totalUsers: number;\r\n  activeUsers: number;\r\n  pendingRequests: number;\r\n  totalDocuments: number;\r\n  completedRequests: number;\r\n  unreadMessages: number;\r\n}\r\n\r\ninterface Activity {\r\n  id: string;\r\n  type: 'document' | 'user' | 'system';\r\n  description: string;\r\n  timestamp: string;\r\n  user?: string;\r\n}\r\n\r\nconst AdminDashboard: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const { user } = useAuth();\r\n  const [loading, setLoading] = useState(false);\r\n  const [documentsModalVisible, setDocumentsModalVisible] = useState(false);\r\n  const [documentRequests, setDocumentRequests] = useState<any[]>([]);\r\n  const [stats, setStats] = useState<DashboardStats>({\r\n    totalUsers: 0,\r\n    activeUsers: 0,\r\n    pendingRequests: 0,\r\n    totalDocuments: 0,\r\n    completedRequests: 0,\r\n    unreadMessages: 0\r\n  });\r\n  const [notifications, setNotifications] = useState<Notification[]>([]);\r\n  const [staffAccessNotifs, setStaffAccessNotifs] = useState<Notification[]>([]);\r\n  const [staffRequests, setStaffRequests] = useState<any[]>([]);\r\n  const [recentActivity, setRecentActivity] = useState<Activity[]>([]);\r\n  const [verifs, setVerifs] = useState<any[]>([]);\r\n  const [verifsLoading, setVerifsLoading] = useState(false);\r\n  const [verifModalVisible, setVerifModalVisible] = useState(false);\r\n  const [selectedVerif, setSelectedVerif] = useState<any | null>(null);\r\n  const [selectedInquiry, setSelectedInquiry] = useState<any | null>(null);\r\n  const [responseText, setResponseText] = useState('');\r\n  const [responding, setResponding] = useState(false);\r\n  const [inquiries, setInquiries] = useState<any[]>([]);\r\n  const [inboxInquiries, setInboxInquiries] = useState<any[]>([]);\r\n  // Demo data for mini charts\r\n  const usersTrend = [3, 5, 4, 6, 7, 8, 10]; // last 7 days\r\n  const requestsByType = [\r\n    { type: 'Clearance', value: 12 },\r\n    { type: 'Certificate', value: 8 },\r\n    { type: 'Permit', value: 5 },\r\n    { type: 'Other', value: 3 },\r\n  ];\r\n  const documentCategoryData = [\r\n    { type: 'Clearance', value: 27 },\r\n    { type: 'Certificate', value: 18 },\r\n    { type: 'Permit', value: 12 },\r\n    { type: 'Other', value: 8 },\r\n  ];\r\n\r\n  // Pure SVG pie chart for Documents\r\n  function PieChartSVG({ data, size = 32 }: { data: { type: string; value: number }[]; size?: number }) {\r\n    const total = data.reduce((sum, d) => sum + d.value, 0);\r\n    let startAngle = 0;\r\n    const colors = ['#52c41a', '#73d13d', '#b7eb8f', '#d9f7be'];\r\n    const center = size / 2;\r\n    const radius = center - 2;\r\n    return (\r\n      <svg width={size} height={size} viewBox={`0 0 ${size} ${size}`}> \r\n        {data.map((slice, i) => {\r\n          const angle = (slice.value / total) * Math.PI * 2;\r\n          const x1 = center + radius * Math.cos(startAngle);\r\n          const y1 = center + radius * Math.sin(startAngle);\r\n          const x2 = center + radius * Math.cos(startAngle + angle);\r\n          const y2 = center + radius * Math.sin(startAngle + angle);\r\n          const largeArc = angle > Math.PI ? 1 : 0;\r\n          const pathData = [\r\n            `M ${center} ${center}`,\r\n            `L ${x1} ${y1}`,\r\n            `A ${radius} ${radius} 0 ${largeArc} 1 ${x2} ${y2}`,\r\n            'Z',\r\n          ].join(' ');\r\n          const el = (\r\n            <path key={i} d={pathData} fill={colors[i % colors.length]} stroke=\"#fff\" strokeWidth=\"1\" />\r\n          );\r\n          startAngle += angle;\r\n          return el;\r\n        })}\r\n      </svg>\r\n    );\r\n  }\r\n\r\n\r\n\r\n  const fetchDashboardData = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const statsRes = await adminAPI.getSystemStatistics();\r\n      // Fetch document requests for modal\r\n  // Fetch document requests for modal\r\n      try {\r\n  const docs = await documentsAPI.getDocumentRecords();\r\n        setDocumentRequests(docs);\r\n      } catch (err) {\r\n        setDocumentRequests([]);\r\n      }\r\n\r\n  const notificationsRes = await notificationAPI.getNotifications();\r\n\r\n  // Only show unread notifications in the dashboard\r\n  const unreadNotifs = notificationsRes.filter((n: Notification) => !n.read);\r\n  setNotifications(unreadNotifs.slice(0, 10)); // show up to 10 unread notifications\r\n\r\n  // Define staff access notifications for pendingRequests calculation (accept both types used in DB)\r\n  const staffApprovalNotifs = unreadNotifs.filter((n: Notification) => (n.type || '').toString().toLowerCase().includes('staff'));\r\n  setStaffAccessNotifs(staffApprovalNotifs);\r\n\r\n  // Fetch staff access Requests from the requests collection\r\n  try {\r\n    const sreqs = await requestsAPI.getStaffAccessRequests();\r\n    setStaffRequests(sreqs || []);\r\n  } catch (err) {\r\n    setStaffRequests([]);\r\n  }\r\n\r\n  // Transform system statistics\r\n  const systemPending = (statsRes.documents?.pending || 0) + staffApprovalNotifs.length;\r\n      const systemTotalDocs = statsRes.documents?.total || 0;\r\n\r\n      // Try to fetch document requests directly and derive pending count to ensure accuracy\r\n      let directPending = 0;\r\n      try {\r\n        const allReqs = await documentsAPI.getDocumentRecords();\r\n        const arr: any[] = Array.isArray(allReqs) ? allReqs : (allReqs && allReqs.data) ? allReqs.data : [];\r\n        directPending = (arr || []).filter(r => (r.status || '').toString().toLowerCase() === 'pending').length;\r\n      } catch (e) {\r\n        directPending = systemPending;\r\n      }\r\n\r\n      const totalPending = directPending + (staffApprovalNotifs ? staffApprovalNotifs.length : 0);\r\n      setStats({\r\n        totalUsers: statsRes.users?.total || 0,\r\n        activeUsers: statsRes.users?.active || 0,\r\n        // Combine pending document requests with unread staff access notifications\r\n        pendingRequests: totalPending,\r\n        totalDocuments: systemTotalDocs,\r\n        completedRequests: statsRes.documents?.completed || 0,\r\n        unreadMessages: 0 // Set to 0 or fetch from a valid source if available\r\n      });\r\n\r\n      // Fetch all resident inquiries for admin inbox\r\n      const inquiriesRes = await contactAPI.getAllInquiries();\r\n      setInquiries(inquiriesRes);\r\n      // Filter for inbox: assignedRole matches user.role or assignedTo includes user._id\r\n      const filtered = inquiriesRes.filter((inq: any) =>\r\n        (inq.assignedRole && user && inq.assignedRole === user.role) ||\r\n        (inq.assignedTo && Array.isArray(inq.assignedTo) && user && inq.assignedTo.includes(user._id))\r\n      );\r\n      setInboxInquiries(filtered);\r\n\r\n      // Fetch real recent activity logs\r\n      const activityRes = await adminAPI.getActivityLogs({});\r\n      // Map backend ActivityLog[] to local Activity[]\r\n      setRecentActivity(activityRes.map((log: any) => ({\r\n        id: log.id,\r\n        type: log.module || 'system',\r\n        description: log.description || log.action,\r\n        timestamp: log.timestamp,\r\n        user: log.userName || log.userId\r\n      })));\r\n    } catch (error) {\r\n      console.error('Error fetching dashboard data:', error);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n\r\n  useEffect(() => {\r\n    // initial fetch\r\n    fetchDashboardData();\r\n\r\n    // Initialize socket and listen for document-related events to refresh dashboard\r\n    try {\r\n      initNotificationSocket();\r\n      const handler = (payload: any) => {\r\n        console.log('Received document socket event, refreshing dashboard', payload);\r\n        fetchDashboardData();\r\n      };\r\n      onNotificationEvent('documentStatusUpdate', handler);\r\n      onNotificationEvent('documentCreated', handler);\r\n      onNotificationEvent('documentDeleted', handler);\r\n      onNotificationEvent('documents-updated', handler);\r\n\r\n      // Poll as a fallback for environments without sockets\r\n      const pollInterval = setInterval(() => {\r\n        fetchDashboardData();\r\n      }, 30000);\r\n\r\n      return () => {\r\n        offNotificationEvent('documentStatusUpdate', handler);\r\n        offNotificationEvent('documentCreated', handler);\r\n        offNotificationEvent('documentDeleted', handler);\r\n        offNotificationEvent('documents-updated', handler);\r\n        clearInterval(pollInterval);\r\n      };\r\n    } catch (err) {\r\n      // If sockets fail, still keep polling\r\n      const pollInterval = setInterval(() => {\r\n        fetchDashboardData();\r\n      }, 30000);\r\n      return () => clearInterval(pollInterval);\r\n    }\r\n  }, []);\r\n\r\n  // Load verification requests (separate from main fetch to keep concerns isolated)\r\n  const loadVerifs = async () => {\r\n    setVerifsLoading(true);\r\n    try {\r\n      const res = await verificationAPI.getRequests();\r\n      setVerifs(Array.isArray(res) ? res : []);\r\n    } catch (err) {\r\n      console.error('Failed to load verification requests', err);\r\n      setVerifs([]);\r\n    } finally {\r\n      setVerifsLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => { loadVerifs(); }, []);\r\n\r\n  // Fetch users count explicitly from User Management and keep it refreshed\r\n  const fetchUsersCount = async () => {\r\n    try {\r\n      const users = await adminAPI.getUsers();\r\n      const usersAny: any = users;\r\n      const count = Array.isArray(usersAny) ? usersAny.length : (usersAny && typeof usersAny.length === 'number' ? usersAny.length : 0);\r\n      setStats(prev => ({ ...prev, totalUsers: count }));\r\n    } catch (err) {\r\n      console.error('Failed to fetch users list for count:', err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    // initial fetch\r\n    fetchUsersCount();\r\n    // poll every 30 seconds to keep the count up-to-date\r\n    const interval = setInterval(fetchUsersCount, 30000);\r\n    return () => clearInterval(interval);\r\n  }, []);\r\n\r\n  // Mark notification as read\r\n  const handleMarkAsRead = async (notif: Notification) => {\r\n    if (!notif._id) return;\r\n    try {\r\n      setLoading(true);\r\n      await notificationAPI.markAsRead(notif._id);\r\n      await fetchDashboardData();\r\n    } catch (err) {\r\n      console.error('Failed to mark as read:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Approve staff request\r\n  const handleApproveStaff = async (notif: Notification) => {\r\n    if (!notif.data?.userId || !notif._id) return;\r\n    try {\r\n      setLoading(true);\r\n      await notificationAPI.approveStaff(notif.data.userId, notif._id);\r\n      await fetchDashboardData();\r\n    } catch (err) {\r\n      console.error('Failed to approve staff:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Reject staff request\r\n  const handleRejectStaff = async (notif: Notification) => {\r\n    if (!notif._id) return;\r\n    const reason = window.prompt('Enter a brief reason for rejection (optional):');\r\n    try {\r\n      setLoading(true);\r\n      await notificationAPI.rejectStaff(notif._id, reason || undefined);\r\n      await fetchDashboardData();\r\n    } catch (err) {\r\n      console.error('Failed to reject staff request:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Simple UnreadBadge component for displaying a red dot\r\n  const UnreadBadge: React.FC = () => (\r\n    <span\r\n      style={{\r\n        display: 'inline-block',\r\n        width: 8,\r\n        height: 8,\r\n        borderRadius: '50%',\r\n        background: '#ff4d4f',\r\n        marginLeft: 6,\r\n        verticalAlign: 'middle',\r\n      }}\r\n      aria-label=\"Unread\"\r\n    />\r\n  );\r\n\r\n  const kpiCards = [\r\n    {\r\n      label: 'Users',\r\n      value: stats.totalUsers,\r\n      icon: '',\r\n      bg: 'linear-gradient(90deg, #1890ff 0%, #40a9ff 100%)',\r\n      color: '#1890ff',\r\n      labelColor: '#e6f7ff',\r\n      onClick: undefined,\r\n      chart: (\r\n                <div style={{ width: '100%', marginTop: 8, height: 32 }}>\r\n                  {/* Pure SVG sparkline for Users */}\r\n                  <svg width=\"100%\" height=\"40\" viewBox=\"0 0 100 40\" preserveAspectRatio=\"none\">\r\n                    <polyline\r\n                      fill=\"none\"\r\n                      stroke=\"#4F46E5\"\r\n                      strokeWidth=\"2\"\r\n                      points={usersTrend.map((d, i) => `${i * (100 / (usersTrend.length - 1))},${40 - (d / Math.max(...usersTrend)) * 35}`).join(' ')}\r\n                    />\r\n                  </svg>\r\n                </div>\r\n      ),\r\n    },\r\n    {\r\n      label: 'Pending Requests',\r\n      value: stats.pendingRequests,\r\n      icon: '',\r\n      bg: 'linear-gradient(90deg, #faad14 0%, #ffe58f 100%)',\r\n      color: '#faad14',\r\n      labelColor: '#fffbe6',\r\n      onClick: undefined,\r\n      chart: (\r\n                <div style={{ width: '100%', marginTop: 8, height: 32 }}>\r\n                  {/* Pure SVG bar chart for Requests */}\r\n                  <svg width=\"100%\" height=\"40\" viewBox=\"0 0 100 40\" preserveAspectRatio=\"none\">\r\n                    {requestsByType.map((d, i) => {\r\n                      const barWidth = 100 / requestsByType.length - 2;\r\n                      const barHeight = (d.value / Math.max(...requestsByType.map(r => r.value))) * 35;\r\n                      return (\r\n                        <rect\r\n                          key={i}\r\n                          x={i * (100 / requestsByType.length) + 1}\r\n                          y={40 - barHeight}\r\n                          width={barWidth}\r\n                          height={barHeight}\r\n                          fill=\"#22C55E\"\r\n                          rx=\"2\"\r\n                        />\r\n                      );\r\n                    })}\r\n                  </svg>\r\n                </div>\r\n      ),\r\n    },\r\n    {\r\n      label: 'Documents',\r\n      value: stats.totalDocuments,\r\n      icon: '',\r\n      bg: 'linear-gradient(90deg, #52c41a 0%, #b7eb8f 100%)',\r\n      color: '#52c41a',\r\n      labelColor: '#f6ffed',\r\n      onClick: undefined,\r\n      chart: (\r\n                <div style={{ width: '100%', marginTop: 8, height: 32, display: 'flex', justifyContent: 'center', alignItems: 'center' }}>\r\n                  {/* Pure SVG pie chart for Documents */}\r\n                  <svg width=\"40\" height=\"40\" viewBox=\"0 0 40 40\">\r\n                    {(() => {\r\n                      const total = documentCategoryData.reduce((sum, d) => sum + d.value, 0);\r\n                      let startAngle = 0;\r\n                      return documentCategoryData.map((d, i) => {\r\n                        const angle = (d.value / total) * 360;\r\n                        const endAngle = startAngle + angle;\r\n                        const largeArc = angle > 180 ? 1 : 0;\r\n                        const x1 = 20 + 18 * Math.cos((Math.PI * (startAngle - 90)) / 180);\r\n                        const y1 = 20 + 18 * Math.sin((Math.PI * (startAngle - 90)) / 180);\r\n                        const x2 = 20 + 18 * Math.cos((Math.PI * (endAngle - 90)) / 180);\r\n                        const y2 = 20 + 18 * Math.sin((Math.PI * (endAngle - 90)) / 180);\r\n                        const path = `M20,20 L${x1},${y1} A18,18 0 ${largeArc} 1 ${x2},${y2} Z`;\r\n                        const el = (\r\n                          <path\r\n                            key={i}\r\n                            d={path}\r\n                            fill={pieColors[i % pieColors.length]}\r\n                          />\r\n                        );\r\n                        startAngle += angle;\r\n                        return el;\r\n                      });\r\n                    })()}\r\n                  </svg>\r\n                </div>\r\n      ),\r\n    },\r\n    {\r\n      label: <span>Messages <UnreadBadge /></span>,\r\n      value: stats.unreadMessages,\r\n      icon: '',\r\n      bg: 'linear-gradient(90deg, #722ed1 0%, #b37feb 100%)',\r\n      color: '#722ed1',\r\n      labelColor: '#f9f0ff',\r\n      onClick: () => navigate('/admin/messages'),\r\n      chart: null,\r\n    },\r\n  ];\r\n\r\n  const statCardSubtitles = [\r\n    'Total Users',\r\n    'Pending Requests',\r\n    'Total Documents',\r\n    'Unread Messages',\r\n  ];\r\n\r\n  const renderStatCards = () => (\r\n    <Row gutter={[24, 24]} style={{ marginBottom: 32 }}>\r\n      {kpiCards.map((card, idx) => (\r\n        <Col xs={24} sm={12} md={6} key={typeof card.label === 'string' ? card.label : String(idx)}>\r\n          <Card\r\n            hoverable\r\n            onClick={card.onClick}\r\n            style={{\r\n              background: card.bg,\r\n              color: '#fff',\r\n              borderRadius: 20,\r\n              minHeight: 170,\r\n              boxShadow: '0 2px 8px 0 rgba(0,0,0,0.08)',\r\n              display: 'flex',\r\n              flexDirection: 'column',\r\n              alignItems: 'center',\r\n              justifyContent: 'center',\r\n              cursor: card.onClick ? 'pointer' : 'default',\r\n              transition: 'box-shadow 0.2s, transform 0.2s',\r\n              position: 'relative',\r\n              marginBottom: 8,\r\n              padding: 24,\r\n            }}\r\n            styles={{\r\n              body: {\r\n                width: '100%',\r\n                padding: 0,\r\n                display: 'flex',\r\n                flexDirection: 'column',\r\n                alignItems: 'center',\r\n                justifyContent: 'center',\r\n                background: 'transparent',\r\n              }\r\n            }}\r\n            onMouseEnter={e => {\r\n              e.currentTarget.style.boxShadow = '0 8px 32px 0 rgba(0,0,0,0.18)';\r\n              e.currentTarget.style.transform = 'translateY(-4px)';\r\n            }}\r\n            onMouseLeave={e => {\r\n              e.currentTarget.style.boxShadow = '0 2px 8px 0 rgba(0,0,0,0.08)';\r\n              e.currentTarget.style.transform = 'none';\r\n            }}\r\n          >\r\n            <span style={{ fontSize: 40, marginBottom: 8, opacity: 0.92 }}>{card.icon}</span>\r\n            <span style={{ fontSize: 38, fontWeight: 700, lineHeight: 1 }}>{card.value}</span>\r\n            <span style={{ fontSize: 15, color: card.labelColor, fontWeight: 500, marginTop: 2, letterSpacing: 0.5 }}>{card.label}</span>\r\n            <span style={{ fontSize: 13, color: 'rgba(255,255,255,0.7)', marginTop: 2, fontWeight: 400 }}>{statCardSubtitles[idx]}</span>\r\n            {card.chart}\r\n          </Card>\r\n        </Col>\r\n      ))}\r\n    </Row>\r\n  );\r\n\r\n  // Table columns for document requests\r\n  const documentColumns = [\r\n    {\r\n      title: 'Name',\r\n      dataIndex: 'requestedByName',\r\n      key: 'requestedByName',\r\n      render: (text: string) => <span style={{ fontWeight: 600 }}>{text}</span>,\r\n    },\r\n    {\r\n      title: 'Document Type',\r\n      dataIndex: 'title',\r\n      key: 'title',\r\n      render: (text: string) => <span>{text.replace(/_/g, ' ')}</span>,\r\n    },\r\n    {\r\n      title: 'Description',\r\n      dataIndex: 'description',\r\n      key: 'description',\r\n      render: (text: string) => <span style={{ color: '#888' }}>{text}</span>,\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'status',\r\n      key: 'status',\r\n      render: (text: string) => <span style={{ color: text === 'Completed' ? '#52c41a' : '#faad14' }}>{text || 'Pending'}</span>,\r\n    },\r\n    {\r\n      title: 'Time Requested',\r\n      dataIndex: 'dateRequested',\r\n      key: 'dateRequested',\r\n      render: (text: string) => <span style={{ fontSize: 12, color: '#aaa' }}>{new Date(text).toLocaleString()}</span>,\r\n    },\r\n  ];\r\n\r\n  const renderNotifications = () => (\r\n    <Card\r\n      title={<Space><BellOutlined /> Staff Access Approval</Space>}\r\n      style={{ marginTop: 0, background: '#fafbfc', borderRadius: 12, boxShadow: '0 2px 8px #d9d9d933', border: '1px solid #f0f0f0', position: 'relative' }}\r\n  styles={{ body: { padding: 16 } }}\r\n      size=\"small\"\r\n      hoverable={false}\r\n    >\r\n  {/* Render a dedicated table for unread staff access approval requests */}\r\n      {staffRequests && staffRequests.length > 0 ? (\r\n        <Table\r\n          size=\"small\"\r\n          pagination={{ pageSize: 5 }}\r\n          dataSource={staffRequests}\r\n          rowKey={r => r._id || String(r.createdAt)}\r\n          columns={[\r\n            {\r\n              title: 'Name',\r\n              dataIndex: 'requestedBy',\r\n              key: 'requestedBy',\r\n              render: (text: any, record: any) => {\r\n                // requestedBy may be a string id, an object, or missing. Prefer data.fullName, requestedByName, then requestedBy.fullName/username, then fallback to string or 'Unknown'\r\n                const nameFromData = record?.data?.fullName;\r\n                const nameFromRequestedByName = record?.requestedByName;\r\n                let nameFromRequestedBy: any = null;\r\n                if (record?.requestedBy) {\r\n                  if (typeof record.requestedBy === 'string') nameFromRequestedBy = record.requestedBy;\r\n                  else if (typeof record.requestedBy === 'object') nameFromRequestedBy = record.requestedBy.fullName || record.requestedBy.username || record.requestedBy._id;\r\n                }\r\n                const displayName = nameFromData || nameFromRequestedByName || nameFromRequestedBy || 'Unknown';\r\n                return <span style={{ fontWeight: 600 }}>{displayName}</span>;\r\n              }\r\n            },\r\n            \r\n            {\r\n              title: 'Requested At',\r\n              dataIndex: 'createdAt',\r\n              key: 'createdAt',\r\n              render: (val: any) => <span style={{ fontSize: 12, color: '#888' }}>{new Date(val).toLocaleString()}</span>\r\n            },\r\n            {\r\n              title: 'Actions',\r\n              key: 'actions',\r\n              render: (_: any, record: any) => (\r\n                <Space>\r\n                  {/* If the row is a Request (has _id and type), call requestsAPI.approveRequest */}\r\n                  <Button\r\n                    type=\"primary\"\r\n                    size=\"small\"\r\n                    onClick={async () => {\r\n                      try {\r\n                        setLoading(true);\r\n                        if (record && record.type === 'staff_access' && record._id) {\r\n                          await requestsAPI.approveRequest(record._id);\r\n                        } else {\r\n                          // fallback to notification-based approve\r\n                          await handleApproveStaff(record as Notification);\r\n                        }\r\n                        await fetchDashboardData();\r\n                      } catch (err) {\r\n                        console.error('Approve action failed', err);\r\n                      } finally {\r\n                        setLoading(false);\r\n                      }\r\n                    }}\r\n                    icon={<CheckOutlined />}\r\n                  >\r\n                    Approve\r\n                  </Button>\r\n                  <Button danger size=\"small\" onClick={() => handleRejectStaff(record)} icon={<ExclamationCircleOutlined />}>Reject</Button>\r\n                </Space>\r\n              )\r\n            }\r\n          ]}\r\n        />\r\n      ) : (\r\n        // Fallback: show recent notifications list for other notification types\r\n        (notifications.length === 0) ? (\r\n          <Empty\r\n            image={<BellOutlined style={{ fontSize: 48, color: '#d9d9d9' }} />}\r\n            description={<span style={{ color: '#888' }}>No notifications</span>}\r\n          />\r\n        ) : (\r\n          <List\r\n            dataSource={notifications}\r\n            renderItem={(notification) => (\r\n              <List.Item\r\n                actions={[\r\n                  (notification.type || '').toString().toLowerCase().includes('staff') && !notification.read && (\r\n                    <Button\r\n                      type=\"primary\"\r\n                      size=\"small\"\r\n                      icon={<CheckOutlined />}\r\n                      onClick={() => handleApproveStaff(notification)}\r\n                    >\r\n                      Approve\r\n                    </Button>\r\n                  ),\r\n                  // removed Mark Read action per design\r\n                ].filter(Boolean)}\r\n              >\r\n                <List.Item.Meta\r\n                  avatar={<Avatar icon={(notification.type || '').toString().toLowerCase().includes('staff') ? <TeamOutlined /> : <BellOutlined />} style={{ backgroundColor: notification.read ? '#8c8c8c' : ((notification.type || '').toString().toLowerCase().includes('staff') ? '#faad14' : '#1890ff') }} />}\r\n                  title={<Text strong={(notification.type || '').toString().toLowerCase().includes('staff')}>{notification.message}</Text>}\r\n                  description={\r\n                    <div>\r\n                      <Text type=\"secondary\">{new Date(notification.createdAt).toLocaleString()}</Text>\r\n                      {((notification.type || '').toString().toLowerCase().includes('staff') && notification.data) && (\r\n                        <div style={{ marginTop: 8 }}>\r\n                          <Text strong>Full Name:</Text> {notification.data.fullName || 'N/A'}<br />\r\n                          <Text strong>Email:</Text> {notification.data.email || 'N/A'}<br />\r\n                          <Text strong>Username:</Text> {notification.data.username || 'N/A'}\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  }\r\n                />\r\n              </List.Item>\r\n            )}\r\n            size=\"small\"\r\n          />\r\n        )\r\n      )}\r\n  <Button type=\"link\" style={{ position: 'absolute', right: 16, bottom: 8, fontSize: 13, color: '#1890ff' }} onClick={() => navigate('/admin/notifications')}>View all</Button>\r\n    </Card>\r\n  );\r\n\r\n  // Verification widget for admin dashboard\r\n  const handleApproveVerif = async (arg: any) => {\r\n    // arg may be a userId string or the verification request object\r\n    try {\r\n      setVerifsLoading(true);\r\n      if (arg && typeof arg === 'object') {\r\n        const reqId = arg._id;\r\n        const userId = arg.userId?._id || arg.userId;\r\n        // mark request approved on server (if endpoint exists)\r\n        try { await verificationAPI.approveRequest(reqId); } catch (e) { /* best-effort */ }\r\n        // set the user verified\r\n        if (userId) await verificationAPI.verifyUser(userId, true);\r\n      } else if (typeof arg === 'string') {\r\n        await verificationAPI.verifyUser(arg, true);\r\n      }\r\n      await loadVerifs();\r\n    } catch (err) {\r\n      console.error('Failed to verify user', err);\r\n    } finally {\r\n      setVerifsLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleRejectVerif = async (arg: any) => {\r\n    try {\r\n      setVerifsLoading(true);\r\n      if (arg && typeof arg === 'object') {\r\n        const reqId = arg._id;\r\n        const userId = arg.userId?._id || arg.userId;\r\n        try { await verificationAPI.rejectRequest(reqId); } catch (e) { /* best-effort */ }\r\n        if (userId) await verificationAPI.verifyUser(userId, false);\r\n      } else if (typeof arg === 'string') {\r\n        // no request id available; just flip user verified to false\r\n        await verificationAPI.verifyUser(arg, false);\r\n      }\r\n      await loadVerifs();\r\n    } catch (err) {\r\n      console.error('Failed to reject verification', err);\r\n    } finally {\r\n      setVerifsLoading(false);\r\n    }\r\n  };\r\n\r\n  const openCheckId = (req: any) => {\r\n    setSelectedVerif(req);\r\n    setVerifModalVisible(true);\r\n  };\r\n\r\n  const renderVerificationWidget = () => (\r\n    <Card\r\n      title={<Space><UserOutlined /> Verification Requests</Space>}\r\n      style={{ marginTop: 0, background: '#fff', borderRadius: 12, boxShadow: '0 2px 8px #d9d9d933', border: '1px solid #f0f0f0' }}\r\n      size=\"small\"\r\n      hoverable={false}\r\n    >\r\n      {verifsLoading ? (\r\n        <div style={{ textAlign: 'center', padding: 24 }}><Spin /></div>\r\n      ) : (!verifs || verifs.length === 0) ? (\r\n        <Empty description=\"No verification requests\" />\r\n      ) : (\r\n        <List\r\n          dataSource={verifs.slice(0, 6)}\r\n          renderItem={(item: any) => (\r\n            <List.Item\r\n              actions={[\r\n                <Button key=\"view\" size=\"small\" onClick={() => openCheckId(item)}>Check ID</Button>,\r\n                <Button key=\"verify\" type=\"primary\" size=\"small\" onClick={() => handleApproveVerif(item.userId?._id || item.userId)}>Verify</Button>,\r\n                <Button key=\"reject\" danger size=\"small\" onClick={() => handleRejectVerif(item.userId?._id || item.userId)}>Reject</Button>\r\n              ]}\r\n            >\r\n              <List.Item.Meta\r\n                title={<span style={{ fontWeight: 600 }}>{(item.userId && (item.userId.fullName || item.userId.username)) || 'Unknown Resident'}</span>}\r\n                description={<span style={{ color: '#888' }}>{item.status || 'pending'}  {new Date(item.createdAt).toLocaleString()}</span>}\r\n              />\r\n            </List.Item>\r\n          )}\r\n          size=\"small\"\r\n        />\r\n      )}\r\n\r\n      <Button type=\"link\" style={{ marginTop: 12 }} onClick={() => navigate('/admin/verification-requests')}>View all</Button>\r\n\r\n      <Modal\r\n        title=\"Verification Files\"\r\n        open={verifModalVisible}\r\n        onCancel={() => setVerifModalVisible(false)}\r\n        footer={null}\r\n        width={720}\r\n      >\r\n        {selectedVerif ? (\r\n          <div>\r\n            <p><strong>Resident:</strong> {(selectedVerif.userId && (selectedVerif.userId.fullName || selectedVerif.userId.username)) || 'Unknown'}</p>\r\n            <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\r\n              {(selectedVerif.gridFileIds || []).map((id: string) => (\r\n                <div key={id} style={{ border: '1px solid #f0f0f0', padding: 8, borderRadius: 6 }}>\r\n                    <div style={{ marginBottom: 8 }}>\r\n                      <a href={getAbsoluteApiUrl(`/verification/file/${id}`)} target=\"_blank\" rel=\"noreferrer\">Open file in new tab</a>\r\n                    </div>\r\n                  {/* inline preview for images if possible */}\r\n                    <div>\r\n                      <img src={getAbsoluteApiUrl(`/verification/file/${id}`)} alt=\"id\" style={{ maxWidth: '100%', maxHeight: 400 }} onError={() => { /* ignore errors for non-images */ }} />\r\n                    </div>\r\n                </div>\r\n              ))}\r\n            </div>\r\n          </div>\r\n        ) : (\r\n          <Empty description=\"No files\" />\r\n        )}\r\n      </Modal>\r\n    </Card>\r\n  );\r\n\r\n  // Mini announcements viewer to replace Recent Activity\r\n  const [miniAnns, setMiniAnns] = useState<any[]>([]);\r\n  const [miniLoading, setMiniLoading] = useState(false);\r\n  const [miniSelected, setMiniSelected] = useState<any | null>(null);\r\n  const [drawerVisible, setDrawerVisible] = useState(false);\r\n\r\n  const fetchMiniAnnouncements = async () => {\r\n    setMiniLoading(true);\r\n    try {\r\n      const data = await contactAPI.getAnnouncements();\r\n      setMiniAnns(Array.isArray(data) ? data.slice(0, 6) : []); // show up to 6\r\n    } catch (err) {\r\n      console.error('Failed to load mini announcements', err);\r\n      setMiniAnns([]);\r\n    } finally {\r\n      setMiniLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => { fetchMiniAnnouncements(); }, []);\r\n\r\n  // helper: simple time-ago\r\n  const timeAgo = (iso?: string) => {\r\n    if (!iso) return ''; \r\n    const d = new Date(iso);\r\n    const diff = Math.floor((Date.now() - d.getTime()) / 1000);\r\n    if (diff < 60) return `${diff}s ago`;\r\n    if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;\r\n    if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;\r\n    if (diff < 604800) return `${Math.floor(diff / 86400)}d ago`;\r\n    return d.toLocaleDateString();\r\n  };\r\n\r\n  const renderRecentActivity = () => (\r\n    <Card\r\n      title={<Space><FileTextOutlined /> Announcements</Space>}\r\n      style={{ marginTop: 0, background: '#fafbfc', borderRadius: 12, boxShadow: '0 2px 8px #d9d9d933', border: '1px solid #f0f0f0', position: 'relative' }}\r\n      styles={{ body: { padding: 12 } }}\r\n      size=\"small\"\r\n      hoverable={false}\r\n    >\r\n      {miniAnns.length === 0 ? (\r\n        <Empty\r\n          image={<FileTextOutlined style={{ fontSize: 42, color: '#d9d9d9' }} />}\r\n          description={<span style={{ color: '#888' }}>No announcements</span>}\r\n        />\r\n      ) : (\r\n  <div style={{ maxHeight: 320, overflowY: 'auto', paddingRight: 6, paddingBottom: 48 }}>\r\n          <List\r\n            loading={miniLoading}\r\n            dataSource={miniAnns}\r\n            renderItem={(item) => (\r\n              <List.Item style={{ cursor: 'pointer', padding: '10px 8px', alignItems: 'center' }} onClick={() => { setMiniSelected(item); setDrawerVisible(true); }}>\r\n                <List.Item.Meta\r\n                  title={<div style={{ display: 'flex', alignItems: 'flex-start', gap: 8 }}>\r\n                    <div style={{ flex: 1, minWidth: 0 }}>\r\n                      <div style={{ fontWeight: 600, fontSize: 13, display: '-webkit-box', WebkitLineClamp: 3, WebkitBoxOrient: 'vertical', overflow: 'hidden', textOverflow: 'ellipsis', lineHeight: '1.2em' }}>{item.text || 'Untitled'}</div>\r\n                      <div style={{ fontSize: 12, color: '#888', marginTop: 6 }}>{timeAgo(item.createdAt)}</div>\r\n                    </div>\r\n                  </div>}\r\n                  description={null}\r\n                />\r\n                  {item.imagePath && (\r\n                    <div style={{ marginLeft: 12, width: 92, display: 'flex', justifyContent: 'flex-end', flexShrink: 0 }}>\r\n                      <img loading=\"lazy\" className=\"rounded-img\" src={getAbsoluteApiUrl(`/announcements/${item._id}/image`)} alt=\"ann\" style={{ width: 92, height: 60, objectFit: 'cover', borderRadius: 6, background: '#f0f0f0' }} />\r\n                    </div>\r\n                  )}\r\n              </List.Item>\r\n            )}\r\n            size=\"small\"\r\n          />\r\n        </div>\r\n      )}\r\n\r\n      {/* Footer area to host Manage link and avoid overlapping the scrollable list */}\r\n      <div style={{ marginTop: 8, display: 'flex', justifyContent: 'flex-end' }}>\r\n        <Button type=\"link\" style={{ fontSize: 13, color: '#1890ff' }} onClick={() => navigate('/admin/announcements')}>Manage</Button>\r\n      </div>\r\n\r\n      <Drawer open={drawerVisible} onClose={() => { setDrawerVisible(false); setMiniSelected(null); }} title=\"Announcement\" width={720} placement=\"right\">\r\n        {miniSelected && (\r\n          <div>\r\n            <Text style={{ display: 'block', marginBottom: 12, whiteSpace: 'pre-wrap' }}>{miniSelected.text}</Text>\r\n                    {miniSelected.imagePath && (\r\n                      <img loading=\"lazy\" className=\"rounded-img rounded-img-lg\" src={getAbsoluteApiUrl(`/announcements/${miniSelected._id}/image`)} alt=\"announcement\" style={{ width: '100%', height: 'auto', borderRadius: 8, background: '#f6f6f6' }} />\r\n                    )}\r\n            <div style={{ marginTop: 8, color: '#888' }}>{timeAgo(miniSelected.createdAt)}</div>\r\n          </div>\r\n        )}\r\n      </Drawer>\r\n    </Card>\r\n  );\r\n\r\n  function renderInbox(): React.ReactNode {\r\n    return (\r\n      <Card\r\n        title={<Space><MailOutlined /> Inquiries Inbox (Assigned to You)</Space>}\r\n        style={{ marginTop: 0, background: '#fafbfc', borderRadius: 12, boxShadow: '0 2px 8px #d9d9d933', border: '1px solid #f0f0f0', position: 'relative' }}\r\n  styles={{ body: { padding: 16 } }}\r\n        size=\"small\"\r\n        hoverable={false}\r\n      >\r\n        {inboxInquiries.length === 0 ? (\r\n          <Empty\r\n            image={<MailOutlined style={{ fontSize: 48, color: '#d9d9d9' }} />}\r\n            description={<span style={{ color: '#888' }}>No assigned inquiries</span>}\r\n          />\r\n        ) : (\r\n          <List\r\n            dataSource={inboxInquiries}\r\n            renderItem={(inquiry: any) => (\r\n              <List.Item\r\n                actions={[\r\n                  <Button key=\"view\" type=\"link\" onClick={() => setSelectedInquiry(inquiry)}>\r\n                    View / Respond\r\n                  </Button>\r\n                ]}\r\n              >\r\n                <List.Item.Meta\r\n                  title={<Text strong>{inquiry.subject}</Text>}\r\n                  description={\r\n                    <>\r\n                      <Text type=\"secondary\">{inquiry.type}</Text><br />\r\n                      <Text>{inquiry.message}</Text><br />\r\n                      <Text type=\"secondary\">\r\n                        Submitted by: {inquiry.createdBy?.fullName || inquiry.createdBy?.username || 'Resident'} on {new Date(inquiry.createdAt).toLocaleString()}\r\n                      </Text>\r\n                    </>\r\n                  }\r\n                />\r\n              </List.Item>\r\n            )}\r\n            size=\"small\"\r\n          />\r\n        )}\r\n    <Button type=\"link\" style={{ position: 'absolute', right: 16, bottom: 8, fontSize: 13, color: '#1890ff' }} onClick={() => navigate('/admin/inquiries')}>View all</Button>\r\n        <Modal\r\n          title=\"Document Requests\"\r\n          open={documentsModalVisible}\r\n          onCancel={() => setDocumentsModalVisible(false)}\r\n          footer={null}\r\n          width={1200}\r\n        >\r\n          {/* Modal content here */}\r\n          <Table\r\n            columns={documentColumns}\r\n            dataSource={documentRequests}\r\n            rowKey={record => record._id || record.dateRequested + record.requestedByName}\r\n            pagination={{ pageSize: 10 }}\r\n          />\r\n        </Modal>\r\n      </Card>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <Spin spinning={loading}>\r\n      <div style={{ padding: 24, backgroundColor: '#f0f2f5', minHeight: '100vh' }}>\r\n        <Title level={4} style={{ marginBottom: 24 }}>Admin Dashboard</Title>\r\n        {renderStatCards()}\r\n        <Row gutter={[24, 24]} style={{ marginTop: 0 }}>\r\n          <Col xs={24} lg={12}>\r\n            {renderNotifications()}\r\n          </Col>\r\n          <Col xs={24} lg={12}>\r\n            {renderRecentActivity()}\r\n          </Col>\r\n        </Row>\r\n        <Row gutter={[24, 24]} style={{ marginTop: 24 }}>\r\n          <Col xs={24}>\r\n            {renderVerificationWidget()}\r\n          </Col>\r\n        </Row>\r\n        {/* Modal is rendered inside renderInbox above */}\r\n      </div>\r\n    </Spin>\r\n  );\r\n};\r\n\r\nexport default AdminDashboard;\r\n","\r\nimport React, { useState, useEffect } from 'react';\r\nimport {\r\n  Card,\r\n  Table,\r\n  Button,\r\n  Space,\r\n  Tag,\r\n  Typography,\r\n  Spin,\r\n  Form,\r\n  Input,\r\n  message,\r\n  Select,\r\n  Drawer,\r\n  Avatar,\r\n  Dropdown,\r\n  Menu,\r\n  DatePicker,\r\n  Row,\r\n  Col,\r\n  Breadcrumb,\r\n  Popconfirm,\r\n  Collapse,\r\n  Modal,\r\n  Tabs,\r\n  Upload,\r\n} from 'antd';\r\nimport { EditOutlined, DeleteOutlined, MoreOutlined, EyeOutlined, StopOutlined, CheckOutlined, ReloadOutlined } from '@ant-design/icons';\r\nimport type { SortOrder } from 'antd/es/table/interface';\r\nimport { adminAPI, staffRegister } from '../../services/api';\r\nimport dayjs from 'dayjs';\r\nimport AvatarImage from '../AvatarImage';\r\nimport { getAbsoluteApiUrl } from '../../services/api';\r\n\r\nconst roleOptions = [\r\n  { text: 'Admin', value: 'admin' },\r\n  { text: 'Staff', value: 'staff' },\r\n  { text: 'Resident', value: 'resident' },\r\n];\r\nconst statusOptions = [\r\n  { text: 'Active', value: true },\r\n  { text: 'Inactive', value: false },\r\n];\r\n\r\n// ...existing code...\r\n// Columns will be defined inside the component to access state/handlers\r\n\r\n\r\nconst UserManagement: React.FC = () => {\r\n  const [users, setUsers] = useState<any[]>([]);\r\n  const [search, setSearch] = useState('');\r\n  const [roleFilter, setRoleFilter] = useState<string | undefined>(undefined);\r\n  const [statusFilter, setStatusFilter] = useState<boolean | undefined>(undefined);\r\n  const [dateRange, setDateRange] = useState<any>(null);\r\n  const [page, setPage] = useState(1);\r\n  const [pageSize, setPageSize] = useState(10);\r\n  const [selectedRowKeys, setSelectedRowKeys] = useState<React.Key[]>([]);\r\n  const [drawerOpen, setDrawerOpen] = useState(false);\r\n  const [selectedUser, setSelectedUser] = useState<any | null>(null);\r\n  const [selectedResident, setSelectedResident] = useState<any | null>(null);\r\n  const [residentLoading, setResidentLoading] = useState(false);\r\n  const [showFullResident, setShowFullResident] = useState(false);\r\n  const [editModalOpen, setEditModalOpen] = useState(false);\r\n  const [editUserModalOpen, setEditUserModalOpen] = useState(false);\r\n  const [userFormValues, setUserFormValues] = useState<any>({});\r\n  const [uploading, setUploading] = useState(false);\r\n  const [uploadProgress, setUploadProgress] = useState(0);\r\n  const [uploadPreview, setUploadPreview] = useState<string | null>(null);\r\n  const pendingUploadRef = React.useRef<Promise<any> | null>(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [editFormValues, setEditFormValues] = useState<any>({});\r\n  // Helper to generate a random unique Barangay ID\r\n  function generateBarangayID() {\r\n    const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\r\n    const length = Math.floor(Math.random() * 9) + 4; // 4-12\r\n    let id = '';\r\n    for (let i = 0; i < length; i++) {\r\n      id += chars.charAt(Math.floor(Math.random() * chars.length));\r\n    }\r\n    return id;\r\n  }\r\n\r\n  const fetchUsers = () => {\r\n    setLoading(true);\r\n    adminAPI.getUsers()\r\n      .then((data: any[]) => {\r\n        setUsers(data.map((user, idx) => ({\r\n          key: user._id || idx,\r\n          _id: user._id || null,\r\n          fullName: user.fullName || user.username || '',\r\n          email: user.email,\r\n          role: user.role,\r\n          isActive: user.isActive,\r\n          createdAt: user.createdAt,\r\n          lastLogin: user.lastLogin,\r\n          avatar: user.avatar || null,\r\n          barangayId: user.barangayId || user.barangayID || user.barangay_id || null,\r\n        })));\r\n      })\r\n      .catch(() => setUsers([]))\r\n      .finally(() => setLoading(false));\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchUsers();\r\n  }, []);\r\n\r\n  // Fetch resident info for a user when drawer opens\r\n  const fetchResidentForUser = async (user: any) => {\r\n    if (!user) return;\r\n    setResidentLoading(true);\r\n    try {\r\n      // Prefer fetching by barangayId when available\r\n      const barangayId = user.barangayId || user.barangayID || user.barangay_id;\r\n      if (barangayId) {\r\n        const resp: any = await adminAPI.getResidentByBarangayID(barangayId);\r\n        // server returns { resident, user }\r\n        setSelectedResident(resp?.resident || null);\r\n      } else if (user._id) {\r\n        const resp: any = await adminAPI.getUserWithResident(user._id);\r\n        setSelectedResident(resp?.resident || null);\r\n      } else {\r\n        setSelectedResident(null);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to fetch resident for user', err);\r\n      setSelectedResident(null);\r\n    } finally {\r\n      setResidentLoading(false);\r\n    }\r\n  };\r\n\r\n  // Disable a user (optionally suspend until a date). Updates UI after success.\r\n  const handleDisableUser = async (userId: string, suspendedUntil?: string | null) => {\r\n    if (!userId) return;\r\n    try {\r\n      message.loading({ content: 'Disabling user...', key: 'disable' });\r\n      const payload = suspendedUntil ? { suspendedUntil } : {};\r\n      const res: any = await adminAPI.disableUser(userId, payload);\r\n      message.success({ content: 'User disabled', key: 'disable', duration: 2 });\r\n      // Refresh list and selected user\r\n      await fetchUsers();\r\n      if (selectedUser && selectedUser._id === userId) {\r\n        setSelectedUser(res.user || res);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to disable user', err);\r\n      message.error('Failed to disable user');\r\n    }\r\n  };\r\n\r\n  const handleEnableUser = async (userId: string) => {\r\n    if (!userId) return;\r\n    try {\r\n      message.loading({ content: 'Enabling user...', key: 'enable' });\r\n      const res: any = await adminAPI.enableUser(userId);\r\n      message.success({ content: 'User enabled', key: 'enable', duration: 2 });\r\n      await fetchUsers();\r\n      if (selectedUser && selectedUser._id === userId) {\r\n        setSelectedUser(res.user || res);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to enable user', err);\r\n      message.error('Failed to enable user');\r\n    }\r\n  };\r\n\r\n  // Demote a staff user back to resident\r\n  const handleDemoteUser = async (userId: string) => {\r\n    if (!userId) return;\r\n    try {\r\n      message.loading({ content: 'Demoting user...', key: 'demote' });\r\n      const res: any = await adminAPI.demoteUser(userId);\r\n      message.success({ content: 'User demoted to resident', key: 'demote', duration: 2 });\r\n      await fetchUsers();\r\n      if (selectedUser && selectedUser._id === userId) {\r\n        setSelectedUser(res.user || res);\r\n      }\r\n    } catch (err) {\r\n      console.error('Failed to demote user', err);\r\n      message.error('Failed to demote user');\r\n    }\r\n  };\r\n\r\n  // add-user helpers removed (UI buttons were removed)\r\n\r\n  // (registration helpers removed  staff registration handled elsewhere)\r\n\r\n  // Filtered and searched users\r\n  const filteredUsers = users.filter(user => {\r\n    const matchesSearch =\r\n      user.fullName.toLowerCase().includes(search.toLowerCase()) ||\r\n      user.email.toLowerCase().includes(search.toLowerCase());\r\n    const matchesRole = roleFilter ? user.role === roleFilter : true;\r\n    const matchesStatus = statusFilter !== undefined ? user.isActive === statusFilter : true;\r\n    const matchesDate = dateRange && dateRange.length === 2\r\n      ? dayjs(user.createdAt).isAfter(dateRange[0], 'day') && dayjs(user.createdAt).isBefore(dateRange[1], 'day')\r\n      : true;\r\n    return matchesSearch && matchesRole && matchesStatus && matchesDate;\r\n  });\r\n\r\n  // Table columns with avatar, tags, actions, sticky header, selection\r\n  const columns = [\r\n    {\r\n      title: 'Name',\r\n      dataIndex: 'fullName',\r\n      key: 'fullName',\r\n      render: (text: string, record: any) => (\r\n        <Space>\r\n          <Avatar style={{ backgroundColor: '#1890ff', verticalAlign: 'middle' }}>\r\n            {record.avatar ? <AvatarImage src={record.avatar} size={36} /> : (\r\n              (() => {\r\n                let displayUser = record;\r\n                try {\r\n                  const stored = localStorage.getItem('userProfile');\r\n                  if (stored) displayUser = JSON.parse(stored);\r\n                } catch (err) {}\r\n                return displayUser?.profileImage || displayUser?.profileImageId\r\n                  ? <AvatarImage user={displayUser} size={36} />\r\n                  : ((text && text.length > 0) ? text.charAt(0).toUpperCase() : '?');\r\n              })()\r\n            )}\r\n          </Avatar>\r\n          <b>{text}</b>\r\n        </Space>\r\n      ),\r\n      sorter: (a: any, b: any) => a.fullName.localeCompare(b.fullName),\r\n      sortDirections: ['ascend' as SortOrder, 'descend' as SortOrder],\r\n      fixed: 'left' as const,\r\n    },\r\n    {\r\n      title: 'Barangay ID',\r\n      dataIndex: 'barangayId',\r\n      key: 'barangayId',\r\n      render: (id: string) => id || '',\r\n      width: 160,\r\n    },\r\n    {\r\n      title: 'Email',\r\n      dataIndex: 'email',\r\n      key: 'email',\r\n      sorter: (a: any, b: any) => a.email.localeCompare(b.email),\r\n      sortDirections: ['ascend' as SortOrder, 'descend' as SortOrder],\r\n    },\r\n    {\r\n      title: 'Role',\r\n      dataIndex: 'role',\r\n      key: 'role',\r\n      render: (role: string) => {\r\n        const r = role || '';\r\n        return <Tag color={r === 'admin' ? 'magenta' : r === 'staff' ? 'blue' : 'green'}>{r ? (r.charAt(0).toUpperCase() + r.slice(1)) : ''}</Tag>;\r\n      },\r\n      filters: roleOptions,\r\n      onFilter: (value: any, record: any) => record.role === value,\r\n    },\r\n    {\r\n      title: 'Status',\r\n      dataIndex: 'isActive',\r\n      key: 'isActive',\r\n      render: (active: boolean) => <Tag color={active ? 'green' : 'red'}>{active ? 'Active' : 'Inactive'}</Tag>,\r\n      filters: statusOptions,\r\n      onFilter: (value: any, record: any) => record.isActive === value,\r\n    },\r\n    {\r\n      title: 'Created',\r\n      dataIndex: 'createdAt',\r\n      key: 'createdAt',\r\n      render: (date: string) => dayjs(date).format('YYYY-MM-DD'),\r\n      sorter: (a: any, b: any) => new Date(a.createdAt).getTime() - new Date(b.createdAt).getTime(),\r\n      sortDirections: ['ascend' as SortOrder, 'descend' as SortOrder],\r\n    },\r\n    {\r\n      title: 'Actions',\r\n      key: 'actions',\r\n      fixed: 'right' as const,\r\n      render: (_: any, record: any) => (\r\n        <Dropdown\r\n          popupRender={() => (\r\n            <Menu>\r\n              <Menu.Item key=\"edit\" icon={<EditOutlined />} onClick={() => { setSelectedUser(record); setDrawerOpen(true); }}>\r\n                Edit\r\n              </Menu.Item>\r\n              <Menu.Item key=\"logs\" icon={<EyeOutlined />} onClick={() => { /* View logs logic */ }}>\r\n                View Logs\r\n              </Menu.Item>\r\n              <Menu.Item key=\"deactivate\" icon={<StopOutlined />} onClick={() => { /* Deactivate logic */ }}>\r\n                Deactivate\r\n              </Menu.Item>\r\n              <Menu.Item key=\"disable_now\" icon={<StopOutlined />} onClick={async () => {\r\n                if (!record || !record._id) { message.error('No user selected'); return; }\r\n                // confirm and disable immediately\r\n                Modal.confirm({\r\n                  title: 'Disable user',\r\n                  content: `Are you sure you want to disable ${record.fullName || record.email || record._id}?`,\r\n                  onOk: async () => { await handleDisableUser(record._id); }\r\n                });\r\n              }}>\r\n                Disable\r\n              </Menu.Item>\r\n              {record.role === 'staff' && (\r\n                <Menu.Item key=\"demote\" icon={<ReloadOutlined />} onClick={async () => {\r\n                  if (!record || !record._id) { message.error('No user selected'); return; }\r\n                  Modal.confirm({\r\n                    title: 'Demote user',\r\n                    content: `Are you sure you want to demote ${record.fullName || record.email || record._id} to resident?`,\r\n                    onOk: async () => { await handleDemoteUser(record._id); }\r\n                  });\r\n                }}>\r\n                  Demote to Resident\r\n                </Menu.Item>\r\n              )}\r\n              <Menu.Item key=\"enable_now\" icon={<CheckOutlined />} onClick={async () => {\r\n                if (!record || !record._id) { message.error('No user selected'); return; }\r\n                Modal.confirm({\r\n                  title: 'Enable user',\r\n                  content: `Are you sure you want to enable ${record.fullName || record.email || record._id}?`,\r\n                  onOk: async () => { await handleEnableUser(record._id); }\r\n                });\r\n              }}>\r\n                Enable\r\n              </Menu.Item>\r\n              <Menu.Item key=\"delete\" icon={<DeleteOutlined />} danger onClick={() => { /* Delete logic */ }}>\r\n                Delete\r\n              </Menu.Item>\r\n            </Menu>\r\n          )}\r\n          trigger={['click']}\r\n        >\r\n          <Button icon={<MoreOutlined />} size=\"small\" />\r\n        </Dropdown>\r\n      ),\r\n    },\r\n  ];\r\n\r\n  // Bulk actions bar\r\n  const hasSelection = selectedRowKeys.length > 0;\r\n  const bulkBar = hasSelection && (\r\n    <Space style={{ marginBottom: 16 }}>\r\n      <Button icon={<CheckOutlined />} onClick={() => {/* bulk activate */}}>Activate</Button>\r\n      <Button icon={<StopOutlined />} onClick={() => {/* bulk deactivate */}}>Deactivate</Button>\r\n      <Popconfirm title=\"Are you sure to delete selected users?\" onConfirm={() => {/* bulk delete */}} okText=\"Yes\" cancelText=\"No\">\r\n        <Button icon={<DeleteOutlined />} danger>Delete</Button>\r\n      </Popconfirm>\r\n      <span style={{ marginLeft: 8 }}>{`Selected ${selectedRowKeys.length} users`}</span>\r\n    </Space>\r\n  );\r\n\r\n  // Pagination info\r\n  const startIdx = (page - 1) * pageSize + 1;\r\n  const endIdx = Math.min(page * pageSize, filteredUsers.length);\r\n\r\n  return (\r\n    <div>\r\n      <Card\r\n        style={{ marginBottom: 16, borderRadius: 8, background: '#fff' }}\r\n        bodyStyle={{ padding: 0 }}\r\n        bordered={false}\r\n        title={\r\n          <Row align=\"middle\" justify=\"space-between\">\r\n            <Col>\r\n              <Typography.Title level={4} style={{ margin: 0 }}>User Management</Typography.Title>\r\n              <Breadcrumb>\r\n                <Breadcrumb.Item>Admin</Breadcrumb.Item>\r\n                <Breadcrumb.Item>User Management</Breadcrumb.Item>\r\n              </Breadcrumb>\r\n            </Col>\r\n            <Col>\r\n              <Space>\r\n                {/* Add-user buttons removed per request */}\r\n              </Space>\r\n            </Col>\r\n          </Row>\r\n        }\r\n      />\r\n      <Card style={{ borderRadius: 16, boxShadow: '0 2px 16px #40c9ff11' }}>\r\n        <Row gutter={16} style={{ marginBottom: 16 }} align=\"middle\">\r\n          <Col>\r\n            <Input.Search\r\n              placeholder=\"Search by name or email\"\r\n              value={search}\r\n              onChange={e => setSearch(e.target.value)}\r\n              allowClear\r\n              style={{ width: 200 }}\r\n            />\r\n          </Col>\r\n          <Col>\r\n            <Select\r\n              placeholder=\"Role\"\r\n              allowClear\r\n              style={{ width: 120 }}\r\n              value={roleFilter}\r\n              onChange={setRoleFilter}\r\n              options={roleOptions}\r\n            />\r\n          </Col>\r\n          <Col>\r\n            <Select\r\n              placeholder=\"Status\"\r\n              allowClear\r\n              style={{ width: 120 }}\r\n              value={statusFilter}\r\n              onChange={setStatusFilter}\r\n              options={statusOptions}\r\n            />\r\n          </Col>\r\n          <Col>\r\n            <DatePicker.RangePicker\r\n              value={dateRange}\r\n              onChange={setDateRange}\r\n              style={{ width: 220 }}\r\n              allowClear\r\n            />\r\n          </Col>\r\n          <Col>\r\n            <Button icon={<ReloadOutlined />} onClick={() => {\r\n              setSearch('');\r\n              setRoleFilter(undefined);\r\n              setStatusFilter(undefined);\r\n              setDateRange(null);\r\n            }}>Reset Filters</Button>\r\n          </Col>\r\n        </Row>\r\n        {bulkBar}\r\n        {loading ? <Spin size=\"large\" /> : (\r\n          <Table\r\n            columns={columns}\r\n            dataSource={filteredUsers}\r\n            rowSelection={{\r\n              selectedRowKeys,\r\n              onChange: setSelectedRowKeys,\r\n            }}\r\n            pagination={{\r\n              pageSize,\r\n              current: page,\r\n              onChange: setPage,\r\n              showSizeChanger: true,\r\n              pageSizeOptions: ['10', '20', '50', '100'],\r\n              onShowSizeChange: (_current, size) => setPageSize(size),\r\n              showTotal: (total) => `Showing ${startIdx}${endIdx} of ${total} users`,\r\n            }}\r\n            onRow={record => ({\r\n              onClick: () => {\r\n                setSelectedUser(record);\r\n                setDrawerOpen(true);\r\n                fetchResidentForUser(record);\r\n              },\r\n            })}\r\n            style={{ cursor: 'pointer' }}\r\n            scroll={{ x: 'max-content' }}\r\n            sticky\r\n          />\r\n        )}\r\n      </Card>\r\n\r\n      <Drawer\r\n        title={selectedUser ? selectedUser.fullName : 'User Profile'}\r\n        open={drawerOpen}\r\n        onClose={() => setDrawerOpen(false)}\r\n        width={400}\r\n      >\r\n        {selectedUser && (\r\n          <Space direction=\"vertical\" size=\"middle\" style={{ width: '100%' }}>\r\n            <Row align=\"middle\" gutter={16}>\r\n              <Col>\r\n                  <Avatar size={64} style={{ backgroundColor: '#1890ff' }}>\r\n                    {selectedResident && (selectedResident.profileImage || selectedResident.profileImageId) ? (\r\n                      selectedResident.profileImage ? (\r\n                        <AvatarImage src={selectedResident.profileImage} size={64} />\r\n                      ) : (\r\n                        <AvatarImage src={getAbsoluteApiUrl(`/resident/personal-info/avatar/${selectedResident.profileImageId}`)} size={64} />\r\n                      )\r\n                    ) : selectedUser.avatar ? (\r\n                      <AvatarImage src={selectedUser.avatar} size={64} />\r\n                    ) : (\r\n                      (() => {\r\n                        let displayUser = selectedUser;\r\n                        try {\r\n                          const stored = localStorage.getItem('userProfile');\r\n                          if (stored) displayUser = JSON.parse(stored);\r\n                        } catch (err) {}\r\n                        return displayUser?.profileImage || displayUser?.profileImageId\r\n                          ? <AvatarImage user={displayUser} size={64} />\r\n                          : ((selectedUser.fullName && selectedUser.fullName.length > 0) ? selectedUser.fullName.charAt(0).toUpperCase() : '?');\r\n                      })()\r\n                    )}\r\n                  </Avatar>\r\n                </Col>\r\n              <Col>\r\n                <Typography.Title level={5} style={{ margin: 0 }}>{selectedUser.fullName}</Typography.Title>\r\n                <div style={{ marginTop: 4 }}>\r\n                  <Tag color={selectedUser.isActive ? 'green' : 'red'} style={{ marginRight: 8 }}>{selectedUser.isActive ? 'Active' : 'Inactive'}</Tag>\r\n                  <Tag color={selectedUser.role === 'admin' ? 'magenta' : selectedUser.role === 'staff' ? 'blue' : 'green'}>{(selectedUser.role ? (selectedUser.role.charAt(0).toUpperCase() + selectedUser.role.slice(1)) : '')}</Tag>\r\n                </div>\r\n                {selectedUser.barangayId && (\r\n                  <div style={{ marginTop: 8 }}>\r\n                    <Typography.Text type=\"secondary\">Barangay ID: </Typography.Text>\r\n                    <Typography.Text copyable>{selectedUser.barangayId}</Typography.Text>\r\n                  </div>\r\n                )}\r\n              </Col>\r\n            </Row>\r\n            <Typography.Text strong>Email:</Typography.Text>\r\n            <Typography.Text>{selectedUser.email}</Typography.Text>\r\n\r\n            {/* Resident Information section (prefer resident container) */}\r\n            <Typography.Title level={5} style={{ marginTop: 12 }}>Resident Information</Typography.Title>\r\n            {residentLoading ? (\r\n              <Spin />\r\n            ) : selectedResident ? (\r\n              <>\r\n                {/* Personal / Identity */}\r\n                <Typography.Title level={5}>Personal Information</Typography.Title>\r\n                <Row gutter={[8, 8]}>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Full Name:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{`${selectedResident.firstName || ''} ${selectedResident.middleName || ''} ${selectedResident.lastName || ''}`.trim() || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Barangay ID:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.barangayID || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Username:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.username || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Email:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.email || selectedUser.email || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Phone:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.contactNumber || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Landline:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.landlineNumber || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n\r\n                  <Col span={24}>\r\n                    <Typography.Text strong>Address:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.address || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>DOB:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.birthDate ? dayjs(selectedResident.birthDate).format('YYYY-MM-DD') : (selectedResident.birthDate || 'N/A')}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Sex/Gender:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.sex || selectedResident.gender || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Civil/Marital Status:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.civilStatus || selectedResident.maritalStatus || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Nationality:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.nationality || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Occupation:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.occupation || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Education:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.educationalAttainment || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                </Row>\r\n\r\n                {/* Identification & IDs */}\r\n                <Typography.Title level={5} style={{ marginTop: 12 }}>Identification</Typography.Title>\r\n                <Row gutter={[8, 8]}>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Passport #:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.passportNumber || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Gov ID #:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.governmentIdNumber || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>TIN:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.tin || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Barangay Clearance #:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.barangayClearanceNumber || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                </Row>\r\n\r\n                {/* Family */}\r\n                <Typography.Title level={5} style={{ marginTop: 12 }}>Family</Typography.Title>\r\n                <Row gutter={[8, 8]}>\r\n                  <Col span={24}>\r\n                    <Typography.Text strong>Spouse:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.spouseName ? `${selectedResident.spouseName} ${selectedResident.spouseLastName || ''}` : 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Number of Children:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{(selectedResident.numberOfChildren || selectedResident.numberOfChildren === 0) ? selectedResident.numberOfChildren : 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Children Names/Ages:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.childrenNames ? `${selectedResident.childrenNames} (${selectedResident.childrenAges || ''})` : 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Mother:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.motherName || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Father:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.fatherName || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                </Row>\r\n\r\n                {/* Emergency */}\r\n                <Typography.Title level={5} style={{ marginTop: 12 }}>Emergency Contact</Typography.Title>\r\n                <Row gutter={[8, 8]}>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Contact Name:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.emergencyContactName || selectedResident.emergencyContact || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Relationship:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.emergencyContactRelationship || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Emergency Phone:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.emergencyContact || selectedResident.spouseContactNumber || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                </Row>\r\n\r\n                {/* Business */}\r\n                <Typography.Title level={5} style={{ marginTop: 12 }}>Business / Employment</Typography.Title>\r\n                <Row gutter={[8, 8]}>\r\n                  <Col span={24}>\r\n                    <Typography.Text strong>Business Name:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.businessName || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Business Type:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.businessType || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Business Contact:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.businessContactNumber || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={24}>\r\n                    <Typography.Text strong>Business Address:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.businessAddress || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                </Row>\r\n\r\n                {/* Other fields / meta */}\r\n                <Typography.Title level={5} style={{ marginTop: 12 }}>Other</Typography.Title>\r\n                <Row gutter={[8, 8]}>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Blood Type:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.bloodType || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Disability Status:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.disabilityStatus || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                </Row>\r\n\r\n                <Row style={{ marginTop: 12 }} gutter={[8, 8]}>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Created At:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.createdAt ? dayjs(selectedResident.createdAt).format('YYYY-MM-DD HH:mm') : 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                  <Col span={12}>\r\n                    <Typography.Text strong>Last Login:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedUser.lastLogin ? dayjs(selectedUser.lastLogin).format('YYYY-MM-DD HH:mm') : 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                </Row>\r\n\r\n                <Typography.Title level={5} style={{ marginTop: 12 }}>Social Media / Links</Typography.Title>\r\n                <Row gutter={[8, 8]}>\r\n                  <Col span={24}>\r\n                    <Typography.Text strong>Facebook:</Typography.Text>\r\n                    {selectedResident.facebook ? (\r\n                      <Typography.Text style={{ display: 'block' }}>\r\n                        <a href={selectedResident.facebook} target=\"_blank\" rel=\"noreferrer\">{selectedResident.facebook}</a>\r\n                      </Typography.Text>\r\n                    ) : <Typography.Text style={{ display: 'block' }}>N/A</Typography.Text>}\r\n                  </Col>\r\n                  <Col span={24}>\r\n                    <Typography.Text strong>Instagram:</Typography.Text>\r\n                    {selectedResident.instagram ? (\r\n                      <Typography.Text style={{ display: 'block' }}>\r\n                        <a href={selectedResident.instagram} target=\"_blank\" rel=\"noreferrer\">{selectedResident.instagram}</a>\r\n                      </Typography.Text>\r\n                    ) : <Typography.Text style={{ display: 'block' }}>N/A</Typography.Text>}\r\n                  </Col>\r\n                  <Col span={24}>\r\n                    <Typography.Text strong>Other Link:</Typography.Text>\r\n                    <Typography.Text style={{ display: 'block' }}>{selectedResident.website || 'N/A'}</Typography.Text>\r\n                  </Col>\r\n                </Row>\r\n              </>\r\n            ) : (\r\n              <Typography.Text type=\"warning\">This resident doesn't have resident info yet.</Typography.Text>\r\n            )}\r\n\r\n            {/* Social Media section */}\r\n            <Typography.Title level={5} style={{ marginTop: 12 }}>Social Media</Typography.Title>\r\n            <Row gutter={[8, 8]}>\r\n              <Col span={24}>\r\n                <Typography.Text strong>Facebook:</Typography.Text>\r\n                {selectedUser.facebook ? (\r\n                  <Typography.Text style={{ display: 'block' }}>\r\n                    <a href={selectedUser.facebook} target=\"_blank\" rel=\"noreferrer\">{selectedUser.facebook}</a>\r\n                  </Typography.Text>\r\n                ) : <Typography.Text style={{ display: 'block' }}>N/A</Typography.Text>}\r\n              </Col>\r\n              <Col span={24}>\r\n                <Typography.Text strong>Twitter:</Typography.Text>\r\n                {selectedUser.twitter ? (\r\n                  <Typography.Text style={{ display: 'block' }}>\r\n                    <a href={selectedUser.twitter} target=\"_blank\" rel=\"noreferrer\">{selectedUser.twitter}</a>\r\n                  </Typography.Text>\r\n                ) : <Typography.Text style={{ display: 'block' }}>N/A</Typography.Text>}\r\n              </Col>\r\n              <Col span={24}>\r\n                <Typography.Text strong>Instagram:</Typography.Text>\r\n                {selectedUser.instagram ? (\r\n                  <Typography.Text style={{ display: 'block' }}>\r\n                    <a href={selectedUser.instagram} target=\"_blank\" rel=\"noreferrer\">{selectedUser.instagram}</a>\r\n                  </Typography.Text>\r\n                ) : <Typography.Text style={{ display: 'block' }}>N/A</Typography.Text>}\r\n              </Col>\r\n            </Row>\r\n\r\n            <div style={{ marginTop: 16, display: 'flex', flexDirection: 'column', gap: 8 }}>\r\n              <Space>\r\n                <Button icon={<EditOutlined />} onClick={() => {\r\n                  setUserFormValues(selectedUser || {});\r\n                  setEditUserModalOpen(true);\r\n                }}>Edit User</Button>\r\n                <Button onClick={() => {\r\n                  if (selectedResident) {\r\n                    setEditFormValues(selectedResident || {});\r\n                    setEditModalOpen(true);\r\n                  } else {\r\n                    message.warning('No resident data to edit');\r\n                  }\r\n                }}>Edit Resident</Button>\r\n              </Space>\r\n\r\n              <Space>\r\n                <Button icon={<EyeOutlined />} onClick={() => { /* view logs action (kept as placeholder) */ }}>View Logs</Button>\r\n                {selectedUser && selectedUser.role === 'staff' && (\r\n                  <Popconfirm\r\n                    title={`Demote ${selectedUser.fullName || selectedUser.email}?`}\r\n                    onConfirm={async () => { if (selectedUser) await handleDemoteUser(selectedUser._id); }}\r\n                    okText=\"Yes\"\r\n                    cancelText=\"No\"\r\n                  >\r\n                    <Button icon={<ReloadOutlined />}>Demote</Button>\r\n                  </Popconfirm>\r\n                )}\r\n                {selectedUser && selectedUser.isActive ? (\r\n                  <Popconfirm\r\n                    title={`Disable ${selectedUser.fullName || selectedUser.email}?`}\r\n                    onConfirm={async () => { await handleDisableUser(selectedUser._id); }}\r\n                    okText=\"Yes\"\r\n                    cancelText=\"No\"\r\n                  >\r\n                    <Button icon={<StopOutlined />} danger>Deactivate</Button>\r\n                  </Popconfirm>\r\n                ) : (\r\n                  <Button icon={<CheckOutlined />} onClick={async () => { if (selectedUser) await handleEnableUser(selectedUser._id); }}>Enable</Button>\r\n                )}\r\n              </Space>\r\n            </div>\r\n            {/* Full resident JSON view removed per design */}\r\n          </Space>\r\n        )}\r\n      </Drawer>\r\n\r\n      <Modal\r\n        title=\"Edit Resident\"\r\n        open={editModalOpen}\r\n        onCancel={() => setEditModalOpen(false)}\r\n        onOk={async () => {\r\n          if (!selectedResident) return;\r\n          try {\r\n            // merge existing resident with form changes; server will whitelist allowed fields\r\n            const payload: any = { ...selectedResident, ...editFormValues };\r\n            const res = await adminAPI.updateResident(selectedResident._id, payload);\r\n            message.success('Resident updated');\r\n            setSelectedResident(res?.resident || { ...selectedResident, ...payload });\r\n            setEditModalOpen(false);\r\n          } catch (err: any) {\r\n            console.error('Failed to save resident', err);\r\n            message.error('Failed to update resident.');\r\n          }\r\n        }}\r\n        width={900}\r\n      >\r\n        {/* Tabbed structured form with validation and avatar upload */}\r\n        <Form\r\n          layout=\"vertical\"\r\n          initialValues={{ ...(selectedResident || {}), barangayID: selectedResident?.barangayID || selectedUser?.barangayId }}\r\n          onValuesChange={(_, values) => setEditFormValues(values as any)}\r\n        >\r\n          <Tabs defaultActiveKey=\"personal\">\r\n            <Tabs.TabPane tab=\"Personal\" key=\"personal\">\r\n              <Row gutter={8}>\r\n                <Col span={8}><Form.Item name=\"firstName\" label=\"First Name\" rules={[{ required: true, message: 'First name is required' }]}><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"middleName\" label=\"Middle Name\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"lastName\" label=\"Last Name\" rules={[{ required: true, message: 'Last name is required' }]}><Input /></Form.Item></Col>\r\n              </Row>\r\n              <Row gutter={8}>\r\n                <Col span={8}><Form.Item name=\"username\" label=\"Username\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"barangayID\" label=\"Barangay ID\" rules={[{ required: true, message: 'Barangay ID is required' }]}><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"email\" label=\"Email\" rules={[{ type: 'email', message: 'Enter a valid email' }]}><Input /></Form.Item></Col>\r\n              </Row>\r\n              <Row gutter={8}>\r\n                <Col span={8}><Form.Item name=\"contactNumber\" label=\"Contact Number\" rules={[{ pattern: /^[0-9+\\-() ]{6,20}$/, message: 'Enter a valid phone number' }]}><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"landlineNumber\" label=\"Landline\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"address\" label=\"Address\"><Input /></Form.Item></Col>\r\n              </Row>\r\n              <Row gutter={8}>\r\n                <Col span={8}><Form.Item name=\"birthDate\" label=\"Birth Date\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"placeOfBirth\" label=\"Place of Birth\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"age\" label=\"Age\"><Input type=\"number\" /></Form.Item></Col>\r\n              </Row>\r\n            </Tabs.TabPane>\r\n\r\n            <Tabs.TabPane tab=\"IDs\" key=\"ids\">\r\n              <Row gutter={8}>\r\n                <Col span={8}><Form.Item name=\"passportNumber\" label=\"Passport #\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"governmentIdNumber\" label=\"Government ID #\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"tin\" label=\"TIN\"><Input /></Form.Item></Col>\r\n              </Row>\r\n              <Row gutter={8}>\r\n                <Col span={8}><Form.Item name=\"bloodType\" label=\"Blood Type\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"disabilityStatus\" label=\"Disability Status\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"educationalAttainment\" label=\"Education\"><Input /></Form.Item></Col>\r\n              </Row>\r\n            </Tabs.TabPane>\r\n\r\n            <Tabs.TabPane tab=\"Family\" key=\"family\">\r\n              <Row gutter={8}>\r\n                <Col span={8}><Form.Item name=\"spouseName\" label=\"Spouse Name\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"spouseMiddleName\" label=\"Spouse Middle\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"spouseLastName\" label=\"Spouse Last\"><Input /></Form.Item></Col>\r\n              </Row>\r\n              <Row gutter={8}>\r\n                <Col span={8}><Form.Item name=\"spouseAge\" label=\"Spouse Age\"><Input type=\"number\" /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"spouseBirthDate\" label=\"Spouse DOB\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"spouseOccupation\" label=\"Spouse Occupation\"><Input /></Form.Item></Col>\r\n              </Row>\r\n              <Row gutter={8}>\r\n                <Col span={8}><Form.Item name=\"numberOfChildren\" label=\"# Children\"><Input type=\"number\" /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"childrenNames\" label=\"Children Names\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"childrenAges\" label=\"Children Ages\"><Input /></Form.Item></Col>\r\n              </Row>\r\n              <Row gutter={8}>\r\n                <Col span={12}><Form.Item name=\"motherName\" label=\"Mother's Name\"><Input /></Form.Item></Col>\r\n                <Col span={12}><Form.Item name=\"fatherName\" label=\"Father's Name\"><Input /></Form.Item></Col>\r\n              </Row>\r\n            </Tabs.TabPane>\r\n\r\n            <Tabs.TabPane tab=\"Business\" key=\"business\">\r\n              <Row gutter={8}>\r\n                <Col span={12}><Form.Item name=\"businessName\" label=\"Business Name\"><Input /></Form.Item></Col>\r\n                <Col span={12}><Form.Item name=\"businessType\" label=\"Business Type\"><Input /></Form.Item></Col>\r\n              </Row>\r\n              <Row gutter={8}>\r\n                <Col span={12}><Form.Item name=\"businessContactNumber\" label=\"Business Contact\"><Input /></Form.Item></Col>\r\n                <Col span={12}><Form.Item name=\"businessEmail\" label=\"Business Email\"><Input /></Form.Item></Col>\r\n              </Row>\r\n              <Row gutter={8}>\r\n                <Col span={24}><Form.Item name=\"businessAddress\" label=\"Business Address\"><Input /></Form.Item></Col>\r\n              </Row>\r\n              <Row gutter={8}>\r\n                <Col span={8}><Form.Item name=\"registrationNumber\" label=\"Registration #\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"businessPermitNumber\" label=\"Business Permit #\"><Input /></Form.Item></Col>\r\n                <Col span={8}><Form.Item name=\"barangayClearanceNumber\" label=\"Barangay Clearance #\"><Input /></Form.Item></Col>\r\n              </Row>\r\n            </Tabs.TabPane>\r\n\r\n            <Tabs.TabPane tab=\"Avatar / Media\" key=\"media\">\r\n              <Row gutter={8}>\r\n                <Col span={12}>\r\n                  <Form.Item label=\"Upload Profile Image\">\r\n                    <Upload\r\n                      accept=\"image/*\"\r\n                      showUploadList={false}\r\n                      beforeUpload={() => false}\r\n                      customRequest={(options: any) => {\r\n                        if (!selectedResident) return;\r\n                        const file = options.file as File;\r\n                        setUploading(true);\r\n                        setUploadProgress(10);\r\n                        // create a pending upload promise so modal save can await it\r\n                        const p = (async () => {\r\n                          try {\r\n                            // small simulated progress\r\n                            setUploadProgress(30);\r\n                            const resp: any = await adminAPI.uploadResidentAvatar(selectedResident._id, file);\r\n                            setUploadProgress(80);\r\n                            if (resp?.resident) {\r\n                              setSelectedResident(resp.resident);\r\n                              setEditFormValues((prev: any) => ({ ...prev, profileImage: resp.resident.profileImage, profileImageId: resp.resident.profileImageId }));\r\n                              setUploadPreview(resp.resident.profileImage || getAbsoluteApiUrl(`/resident/personal-info/avatar/${resp.fileId}`));\r\n                            } else if (resp?.fileId) {\r\n                              setEditFormValues((prev: any) => ({ ...prev, profileImage: getAbsoluteApiUrl(`/resident/personal-info/avatar/${resp.fileId}`), profileImageId: resp.fileId }));\r\n                            setUploadPreview(getAbsoluteApiUrl(`/resident/personal-info/avatar/${resp.fileId}`));\r\n                            }\r\n                            setUploadProgress(100);\r\n                            message.success('Avatar uploaded');\r\n                            return resp;\r\n                          } catch (e: any) {\r\n                            console.error('Avatar upload failed', e);\r\n                            message.error(e?.message || 'Avatar upload failed');\r\n                            throw e;\r\n                          } finally {\r\n                            setUploading(false);\r\n                          }\r\n                        })();\r\n                        pendingUploadRef.current = p;\r\n                        return p as any;\r\n                      }}\r\n                    >\r\n                      <Button type=\"default\">Choose Image</Button>\r\n                    </Upload>\r\n                    {uploading && <div style={{ marginTop: 8 }}>Uploading: {uploadProgress}%</div>}\r\n                    {uploadPreview && <div style={{ marginTop: 8 }}><img src={uploadPreview} alt=\"preview\" style={{ maxWidth: 120, maxHeight: 120, borderRadius: 6 }} /></div>}\r\n                  </Form.Item>\r\n                </Col>\r\n                <Col span={12}>\r\n                  <Form.Item name=\"profileImage\" label=\"Profile Image URL\"><Input /></Form.Item>\r\n                  <Form.Item name=\"profileImageId\" label=\"Profile Image ID\"><Input /></Form.Item>\r\n                </Col>\r\n              </Row>\r\n            </Tabs.TabPane>\r\n          </Tabs>\r\n        </Form>\r\n      </Modal>\r\n\r\n      {/* Edit User Modal */}\r\n      <Modal\r\n        title=\"Edit User\"\r\n        open={editUserModalOpen}\r\n        onCancel={() => setEditUserModalOpen(false)}\r\n        onOk={async () => {\r\n          try {\r\n            // Do not allow changing barangayId or role from this modal (read-only shown)\r\n            const payload = { ...userFormValues };\r\n            // Remove non-editable fields if present\r\n            delete payload.barangayId;\r\n            delete payload.role;\r\n            // Call admin API to update user\r\n            await adminAPI.updateUser(selectedUser._id, payload);\r\n            message.success('User updated');\r\n            // Update local list and selectedUser\r\n            const updatedUsers = users.map(u => u._id === selectedUser._id ? { ...u, ...payload } : u);\r\n            setUsers(updatedUsers);\r\n            setSelectedUser((prev: any) => prev ? { ...prev, ...payload } : prev);\r\n            setEditUserModalOpen(false);\r\n          } catch (err) {\r\n            console.error('Failed to update user', err);\r\n            message.error('Failed to update user');\r\n          }\r\n        }}\r\n        width={600}\r\n      >\r\n        <Form layout=\"vertical\" initialValues={userFormValues} onValuesChange={(_, vals) => setUserFormValues(vals)}>\r\n          <Row gutter={8}>\r\n            <Col span={12}>\r\n              <Form.Item name=\"fullName\" label=\"Full Name\" rules={[{ required: true, message: 'Full name required' }]}>\r\n                <Input />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col span={12}>\r\n              <Form.Item name=\"email\" label=\"Email\" rules={[{ type: 'email', message: 'Enter a valid email' }]}>\r\n                <Input />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n          <Row gutter={8}>\r\n            <Col span={12}>\r\n              <Form.Item name=\"isActive\" label=\"Active\">\r\n                <Select options={[{ label: 'Active', value: true }, { label: 'Inactive', value: false }]} />\r\n              </Form.Item>\r\n            </Col>\r\n            <Col span={12}>\r\n              <Form.Item label=\"Role\">\r\n                <Input value={selectedUser?.role} disabled />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n          <Row gutter={8}>\r\n            <Col span={24}>\r\n              <Form.Item label=\"Barangay ID\">\r\n                <Input value={selectedUser?.barangayId || selectedUser?.barangayID || ''} disabled />\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n        </Form>\r\n      </Modal>\r\n\r\n      {/* Staff Registration Modal */}\r\n      {/* Staff Registration Modal removed */}\r\n\r\n      {/* User Registration Modal */}\r\n      {/* User Registration Modal removed */}\r\n  </div>\r\n  );\r\n};\r\n\r\nexport default UserManagement;\r\n","\r\n// Activity logs temporarily disabled per request.\r\n// The original implementation was removed to prevent the system from using activity logs.\r\nimport React from 'react';\r\n\r\nconst ActivityLogs: React.FC = () => {\r\n  // Return a minimal placeholder so the route/component can remain mounted safely.\r\n  return (\r\n    <div style={{ padding: 20 }}>\r\n      <h3>Activity Logs Disabled</h3>\r\n      <p>The Activity Logs feature has been temporarily disabled in the system.</p>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ActivityLogs;\r\n","\r\nimport React, { useEffect, useState, useCallback, useRef, useMemo } from 'react';\r\nimport { Card, Row, Col, Divider, Skeleton, Empty, Form, Select, DatePicker, Space, Typography, Checkbox, Drawer, Button, Switch, Modal, message, Alert, Dropdown } from 'antd';\r\nimport { DownOutlined } from '@ant-design/icons';\r\nimport { QueryClient, QueryClientProvider, useQueries } from '@tanstack/react-query';\r\nimport { Pie, Bar, Line, Area } from '@ant-design/charts';\r\nimport { axiosInstance } from '../../services/api';\r\nimport type { Moment } from 'moment'; // Add this import at the top if using moment\r\nimport jsPDF from 'jspdf';\r\n\r\nconst { RangePicker } = DatePicker;\r\nconst { Option } = Select;\r\n\r\n// Chart definitions (top-level so hooks depending on them stay stable)\r\n// Only include charts backed by server endpoints to avoid 404s\r\nconst CHARTS: Record<string, { title: string; chartType: 'pie'|'bar'|'line'|'area'; endpoint: string; colors?: string[] }> = {\r\n  gender: { title: 'Sex Distribution', chartType: 'pie', endpoint: '/analytics/gender', colors: ['#1890ff', '#00bcd4', '#888888'] },\r\n  age: { title: 'Age Groups', chartType: 'bar', endpoint: '/analytics/age', colors: ['#1890ff'] },\r\n  'civil-status': { title: 'Civil Status', chartType: 'bar', endpoint: '/analytics/civil-status', colors: ['#1890ff'] },\r\n  education: { title: 'Education', chartType: 'bar', endpoint: '/analytics/education', colors: ['#13c2c2'] },\r\n  'documents-monthly': { title: 'Monthly Document Requests', chartType: 'line', endpoint: '/analytics/documents-monthly', colors: ['#722ed1'] },\r\n};\r\n\r\n// stable array of chart ids (top-level so it's stable across renders)\r\nconst CHART_IDS = Object.keys(CHARTS);\r\n\r\n// default QueryClient shared for this module\r\nconst defaultQueryClient = new QueryClient({ defaultOptions: { queries: { retry: 2, staleTime: 60_000, refetchOnWindowFocus: false } } });\r\n\r\nconst StatisticsInner: React.FC = () => {\r\n  const [loadingSummary, setLoadingSummary] = useState(true);\r\n  const [summary, setSummary] = useState<any>(null);\r\n\r\n  // chart data keyed by chart id\r\n  const [chartData, setChartData] = useState<Record<string, any[]>>({});\r\n  const [chartLoading, setChartLoading] = useState<Record<string, boolean>>({});\r\n\r\n  // (removed unused genderCounts state)\r\n\r\n  const [filters, setFilters] = useState<{ dateRange: Moment[]; residentType: string }>({ dateRange: [], residentType: '' });\r\n\r\n  // selected chart ids\r\n  const [selectedCharts, setSelectedCharts] = useState<string[]>(['gender', 'age', 'occupation', 'education', 'civil-status']);\r\n  // Toggle: when enabled, automatically show only charts that have data\r\n  const [autoEnableWhenData, setAutoEnableWhenData] = useState<boolean>(false);\r\n  // store previous selection to restore when toggle is disabled\r\n  const prevSelectionRef = useRef<string[] | null>(null);\r\n  // Chart settings persisted in localStorage\r\n  const [settingsOpen, setSettingsOpen] = useState(false);\r\n  const [chartSettings, setChartSettings] = useState<Record<string, any>>(() => {\r\n    try {\r\n      const raw = localStorage.getItem('statsChartSettings');\r\n      return raw ? JSON.parse(raw) : {};\r\n    } catch (e) {\r\n      return {};\r\n    }\r\n  });\r\n  const [settingsChartId, setSettingsChartId] = useState<string>('gender');\r\n  // Dropdown controlled open state and pending selection for Apply/Cancel behavior\r\n  const [chartsDropdownOpen, setChartsDropdownOpen] = useState<boolean>(false);\r\n  const [pendingSelectedCharts, setPendingSelectedCharts] = useState<string[]>(selectedCharts);\r\n\r\n  const fetchSummary = useCallback(async () => {\r\n    setLoadingSummary(true);\r\n    try {\r\n      const res = await axiosInstance.get('/analytics/summary', {\r\n        params: {\r\n          startDate: filters.dateRange?.[0]?.format?.('YYYY-MM-DD'),\r\n          endDate: filters.dateRange?.[1]?.format?.('YYYY-MM-DD'),\r\n          residentType: filters.residentType,\r\n        }\r\n      });\r\n      setSummary(res.data || null);\r\n    } catch (err) {\r\n      setSummary(null);\r\n    } finally {\r\n      setLoadingSummary(false);\r\n    }\r\n  }, [filters]);\r\n\r\n  // call summary on mount and whenever filters change (fetchSummary is stable via useCallback)\r\n  useEffect(() => {\r\n    void fetchSummary();\r\n  }, [fetchSummary]);\r\n\r\n  // Fetch gender distribution separately\r\n  // We'll fetch gender via the unified endpoints below when needed\r\n\r\n  // Fetch server-side pre-bucketed age groups\r\n  // pre-bucketed age groups handled via the /age endpoint\r\n\r\n  // Fetch age distributions and bucket them into age groups for the Age Groups chart\r\n  // age bucketing will be performed by server-side /api/analytics/age endpoint\r\n\r\n  \r\n\r\n\r\n  // Fetch one chart's data\r\n  const fetchChart = useCallback(async (chartId: string) => {\r\n    const def = CHARTS[chartId];\r\n    if (!def) return;\r\n    setChartLoading(c => ({ ...c, [chartId]: true }));\r\n    try {\r\n      // choose date range from chart-specific settings if provided, otherwise use global filters\r\n      const cs = chartSettings[chartId] || {};\r\n      const start = cs.dateRange?.[0]?.format?.('YYYY-MM-DD') || filters.dateRange?.[0]?.format?.('YYYY-MM-DD');\r\n      const end = cs.dateRange?.[1]?.format?.('YYYY-MM-DD') || filters.dateRange?.[1]?.format?.('YYYY-MM-DD');\r\n      const res = await axiosInstance.get(def.endpoint, { params: { startDate: start, endDate: end } });\r\n      let payload = res.data?.data || [];\r\n      // server returns { name, value } for sex endpoint; map to { type, value } expected by charts\r\n      if (chartId === 'gender') {\r\n        payload = payload.map((p: any) => ({ type: p.name ?? p.type ?? 'N/A', value: p.value ?? 0 }));\r\n      }\r\n      setChartData(d => ({ ...d, [chartId]: payload }));\r\n      // (removed unused genderCounts population)\r\n    } catch (err) {\r\n      console.error('Error fetching chart', chartId, err);\r\n      setChartData(d => ({ ...d, [chartId]: [] }));\r\n    } finally {\r\n      setChartLoading(c => ({ ...c, [chartId]: false }));\r\n    }\r\n  }, [filters, chartSettings]);\r\n\r\n  // persist chartSettings to localStorage whenever they change\r\n  useEffect(() => {\r\n    try {\r\n      localStorage.setItem('statsChartSettings', JSON.stringify(chartSettings));\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  }, [chartSettings]);\r\n\r\n  // When selection changes, trigger refetch for selected charts (chartQueriesMap is memoized below)\r\n  // NOTE: effect is declared later after chartQueriesMapMemo is created to avoid using it before initialization\r\n\r\n  // Example data mapping (adjust to your backend response)\r\n  // Prefer explicit totalResidents from analytics/gender endpoint if present, otherwise fall back to monthly aggregation\r\n  const totalResidents = summary?.totalResidents ?? 0;\r\n  const totalDocuments = summary?.totalDocumentRequests ?? 0;\r\n\r\n  const ageBarData = chartData['age'] || [];\r\n  const ageMax = ageBarData && ageBarData.length ? Math.max(...ageBarData.map((d: any) => Number(d.value) || 0)) : 0;\r\n  const ageAxisMax = Math.ceil(ageMax / 5) * 5 || 5;\r\n\r\n  const monthlyDocData = chartData['documents-monthly'] || [];\r\n\r\n  // ChartCard component\r\n  const ChartCard: React.FC<{ id?: string; title: string; chartType: 'pie'|'bar'|'line'|'area'; data?: any[]; loading?: boolean; colors?: string[] }> = ({ id, title, chartType, data = [], loading, colors }) => {\r\n    const hasData = Array.isArray(data) && data.length > 0;\r\n    // apply per-chart settings overrides\r\n    const cs = id ? (chartSettings[id] || {}) : {};\r\n    const effectiveChartType = cs.chartType || chartType;\r\n    const showLabels = cs.showLabels ?? true;\r\n    const showTooltips = cs.showTooltips ?? true;\r\n    const showLegend = cs.showLegend ?? true;\r\n\r\n    return (\r\n      <Card\r\n        title={title}\r\n        style={{ borderRadius: 12, boxShadow: '0 8px 24px rgba(15,15,15,0.06)' }}\r\n        styles={{ body: { padding: 16 } }}\r\n      >\r\n        {loading ? <Skeleton active /> : hasData ? (\r\n          effectiveChartType === 'pie' ? (\r\n            <div ref={(el) => { if (id) chartRefs.current[id] = el; }} style={{ background: '#ffffff' }}>\r\n              {\r\n                // normalize pie data to fixed fields to avoid AntV passing wrapper objects without type/value\r\n              }\r\n              {(() => {\r\n                const pieData = (data || []).map((d: any) => {\r\n                  const rawLabel = (d?.type ?? d?.name ?? d?.group ?? d?._id ?? 'Unknown').toString();\r\n                  const norm = rawLabel.trim();\r\n                  return { label: norm, valueNumber: Number(d?.value ?? d?.count ?? 0) };\r\n                });\r\n                return (\r\n                  <Pie\r\n                    data={pieData}\r\n                    angleField=\"valueNumber\"\r\n                    colorField=\"label\"\r\n                    radius={0.9}\r\n                    label={showLabels ? { formatter: (datum: any) => {\r\n                      const p = datum?.data || datum || {};\r\n                      const label = p?.label ?? p?.type ?? 'Unknown';\r\n                      const val = Number(p?.valueNumber ?? p?.value ?? p?.count ?? 0) || 0;\r\n                      return `${label} (${val})`;\r\n                    } } : false}\r\n                    tooltip={showTooltips ? { formatter: (datum: any) => {\r\n                      const p = datum?.data || datum || {};\r\n                      return { name: p?.label ?? p?.type ?? 'Unknown', value: Number(p?.valueNumber ?? p?.value ?? p?.count ?? 0) || 0 };\r\n                    } } : false}\r\n                    color={colors}\r\n                    statistic={{ title: { formatter: () => title }, content: { formatter: () => `${(pieData || []).reduce((s: number, d: any) => s + (Number(d.valueNumber) || 0), 0)} total` } }}\r\n                    legend={showLegend ? { position: 'bottom', formatter: (text: any) => {\r\n                      // append count to legend label\r\n                      const item = (pieData || []).find((p: any) => p.label === text);\r\n                      const val = item ? Number(item.valueNumber || 0) : 0;\r\n                      return `${text} (${val})`;\r\n                    } } : false}\r\n                    height={220}\r\n                  />\r\n                );\r\n              })()}\r\n            </div>\r\n          ) : effectiveChartType === 'bar' ? (\r\n            <div ref={(el) => { if (id) chartRefs.current[id] = el; }} style={{ background: '#ffffff' }}>\r\n              <Bar data={data} xField=\"type\" yField=\"value\" color={colors && colors[0]} label={showLabels ? undefined : false} legend={showLegend ? undefined : false} tooltip={showTooltips ? undefined : false} yAxis={{ min: 0, max: ageAxisMax, tickInterval: 5 }} height={220} />\r\n            </div>\r\n          ) : effectiveChartType === 'line' ? (\r\n            <div ref={(el) => { if (id) chartRefs.current[id] = el; }} style={{ background: '#ffffff' }}>\r\n              <Line data={data} xField=\"type\" yField=\"value\" legend={showLegend ? undefined : false} tooltip={showTooltips ? undefined : false} height={220} />\r\n            </div>\r\n          ) : (\r\n            <div ref={(el) => { if (id) chartRefs.current[id] = el; }} style={{ background: '#ffffff' }}>\r\n              <Area data={data} xField=\"type\" yField=\"value\" legend={showLegend ? undefined : false} tooltip={showTooltips ? undefined : false} height={220} />\r\n            </div>\r\n          )\r\n        ) : <Empty description=\"No data\" />}\r\n      </Card>\r\n    );\r\n  };\r\n\r\n\r\n  // refs for chart containers to capture DOM for PDF\r\n  const chartRefs = useRef<Record<string, HTMLDivElement | null>>({});\r\n  // ref for the whole dashboard area\r\n  const dashboardRef = useRef<HTMLDivElement | null>(null);\r\n\r\n  const chartIds = Object.keys(CHARTS);\r\n\r\n  // create queries for each chart using useQueries (keeps hooks rules safe)\r\n  const chartQueryResults = useQueries({\r\n    queries: chartIds.map((id) => {\r\n      return {\r\n        queryKey: [\r\n          'chart',\r\n          id,\r\n          filters.dateRange?.[0]?.format?.('YYYY-MM-DD') || null,\r\n          filters.dateRange?.[1]?.format?.('YYYY-MM-DD') || null,\r\n          (chartSettings[id]?.dateRange?.[0]?.format?.('YYYY-MM-DD')) || null,\r\n          (chartSettings[id]?.dateRange?.[1]?.format?.('YYYY-MM-DD')) || null,\r\n          filters.residentType || null\r\n        ],\r\n        queryFn: async () => {\r\n          const cs = chartSettings[id] || {};\r\n          const start = cs.dateRange?.[0]?.format?.('YYYY-MM-DD') || filters.dateRange?.[0]?.format?.('YYYY-MM-DD');\r\n          const end = cs.dateRange?.[1]?.format?.('YYYY-MM-DD') || filters.dateRange?.[1]?.format?.('YYYY-MM-DD');\r\n          const res = await axiosInstance.get(CHARTS[id].endpoint, { params: { startDate: start, endDate: end, residentType: filters.residentType } });\r\n          return res.data?.data || [];\r\n        },\r\n        retry: 2\r\n      };\r\n    })\r\n  });\r\n  // build a stable key from query result data to use in deps and memoization\r\n  const chartQueryDataKey = chartQueryResults.map(r => JSON.stringify(r?.data || '')).join('|');\r\n\r\n  const chartQueriesMapMemo = useMemo(() => {\r\n    const m: Record<string, any> = {};\r\n    CHART_IDS.forEach((id, idx) => { m[id] = chartQueryResults[idx]; });\r\n    return m;\r\n  }, [chartQueryDataKey]);\r\n\r\n  // sync query results into local chartData / loading state for compatibility with existing code paths\r\n  useEffect(() => {\r\n    const newData: Record<string, any[]> = {};\r\n    const newLoading: Record<string, boolean> = {};\r\n    chartIds.forEach((id) => {\r\n      const q = chartQueriesMapMemo[id];\r\n      // debug: inspect query result for gender\r\n      if (id === 'gender') {\r\n        // eslint-disable-next-line no-console\r\n        console.debug('chart query gender raw data:', q?.data);\r\n      }\r\n      // map server-side name/value into chart-friendly type/value for sex distribution\r\n      if (id === 'gender') {\r\n        // Normalize server-provided gender labels to canonical Male/Female/Other\r\n        newData[id] = (q?.data || []).map((p: any) => {\r\n          const rawType = (p?.name ?? p?.type ?? p?._id ?? '').toString().trim();\r\n          const lower = (rawType || '').toLowerCase();\r\n          let norm = 'Other';\r\n          if (/^m/.test(lower)) norm = 'Male';\r\n          else if (/^f/.test(lower)) norm = 'Female';\r\n          return { type: norm, value: Number(p?.value ?? p?.count ?? 0) };\r\n        })\r\n        // Aggregate any duplicate normalized labels (in case server returned multiple spellings)\r\n        .reduce((acc: any[], cur: any) => {\r\n          const found = acc.find(a => a.type === cur.type);\r\n          if (found) found.value += cur.value; else acc.push({ ...cur });\r\n          return acc;\r\n        }, [] as any[]);\r\n      } else {\r\n        newData[id] = q?.data || [];\r\n      }\r\n      newLoading[id] = q?.isFetching || q?.isLoading || false;\r\n    });\r\n    setChartData(newData);\r\n    setChartLoading(newLoading);\r\n  }, [chartQueryDataKey, chartQueriesMapMemo]);\r\n\r\n  // When selection changes, trigger refetch for selected charts (chartQueriesMap is memoized above)\r\n  useEffect(() => {\r\n    if (!selectedCharts || !selectedCharts.length) return;\r\n    selectedCharts.forEach(id => chartQueriesMapMemo[id]?.refetch && chartQueriesMapMemo[id].refetch());\r\n  }, [selectedCharts, chartQueriesMapMemo]);\r\n\r\n  // compute which charts currently have non-empty data\r\n  const chartsWithData = useMemo(() => {\r\n    const keys = Object.keys(chartData || {}).filter(k => Array.isArray(chartData[k]) && chartData[k].length > 0);\r\n    return new Set(keys);\r\n  }, [chartData]);\r\n\r\n  // When autoEnableWhenData is turned on, reduce selectedCharts to only those with data.\r\n  useEffect(() => {\r\n    if (autoEnableWhenData) {\r\n      // save previous selection\r\n      prevSelectionRef.current = selectedCharts;\r\n      const available = Array.from(chartsWithData);\r\n      // keep the ordering of CHART_IDS but filter\r\n      const newSel = CHART_IDS.filter(id => available.includes(id)).slice(0, 6); // limit to 6 by default\r\n      if (newSel.length) setSelectedCharts(newSel);\r\n    } else {\r\n      // restore previous selection if present\r\n      if (prevSelectionRef.current) {\r\n        setSelectedCharts(prevSelectionRef.current);\r\n        prevSelectionRef.current = null;\r\n      }\r\n    }\r\n  }, [autoEnableWhenData, chartsWithData]);\r\n\r\n  // Report generation\r\n  const [reportModalOpen, setReportModalOpen] = useState(false);\r\n  const [reportText, setReportText] = useState('');\r\n  // responsive helper to make action buttons stack on small screens\r\n  const [isMobile, setIsMobile] = useState<boolean>(() => typeof window !== 'undefined' ? window.innerWidth < 700 : false);\r\n\r\n  useEffect(() => {\r\n    const onResize = () => setIsMobile(window.innerWidth < 700);\r\n    try {\r\n      window.addEventListener('resize', onResize);\r\n    } catch (e) {}\r\n    return () => { try { window.removeEventListener('resize', onResize); } catch (e) {} };\r\n  }, []);\r\n\r\n  // (removed unused helper 'median')\r\n\r\n  const generateNarrativeReport = (state: { summary?: any; charts?: Record<string, any[]> }) => {\r\n    const s = state.summary || summary || {};\r\n    const charts = state.charts || chartData || {};\r\n\r\n    const totalResidents = Number(s.totalResidents ?? 0);\r\n    const gender = charts['gender'] || [];\r\n    const age = charts['age'] || [];\r\n    const cs = charts['civil-status'] || [];\r\n    const ed = charts['education'] || [];\r\n    const monthly = charts['documents-monthly'] || [];\r\n  const occupation = charts['occupation'] || [];\r\n  const nationality = charts['nationality'] || [];\r\n  const bloodType = charts['bloodType'] || [];\r\n  const disability = charts['disability'] || [];\r\n  const children = charts['children'] || [];\r\n  const businessType = charts['businessType'] || [];\r\n  const businessSize = charts['businessSize'] || [];\r\n  const incomeBrackets = charts['incomeBrackets'] || [];\r\n\r\n    // Gender counts\r\n    const maleCount = Number(gender.find((g:any) => (g.type||'').toLowerCase().startsWith('m'))?.value || 0);\r\n    const femaleCount = Number(gender.find((g:any) => (g.type||'').toLowerCase().startsWith('f'))?.value || 0);\r\n    const otherCount = Math.max(0, (gender || []).reduce((sum:number, g:any) => sum + (Number(g.value)||0), 0) - maleCount - femaleCount);\r\n\r\n    // Top age group\r\n    let topAgeGroup = '';\r\n    if (age.length) {\r\n      const sorted = [...age].sort((a:any,b:any) => (Number(b.value)||0) - (Number(a.value)||0));\r\n      topAgeGroup = sorted[0]?.type || sorted[0]?.group || '';\r\n    }\r\n\r\n    // civil and education top items\r\n    const topCivil = cs.length ? cs.slice(0,3).map((c:any) => `${c.type} (${c.value})`).join(', ') : '';\r\n    const topEducation = ed.length ? ed.slice(0,3).map((c:any) => `${c.type} (${c.value})`).join(', ') : '';\r\n\r\n    // monthly totals and peak\r\n    const monthlyTotal = monthly.length ? monthly.reduce((sum:number,m:any) => sum + (Number(m.value)||0), 0) : 0;\r\n    let peakMonth = '';\r\n    let peakVal = 0;\r\n    if (monthly.length) {\r\n      const peak = monthly.reduce((best:any, m:any) => (Number(m.value)||0) > (Number(best.value)||0) ? m : best, monthly[0]);\r\n      peakMonth = peak?.type || '';\r\n      peakVal = Number(peak?.value || 0);\r\n    }\r\n\r\n    // Build templated sentences with conditionals\r\n    const parts: string[] = [];\r\n\r\n    if (totalResidents > 0) {\r\n      const genderPart = (maleCount || femaleCount || otherCount)\r\n        ? `There are currently ${totalResidents} residents, with ${maleCount} males, ${femaleCount} females${otherCount ? `, and ${otherCount} identifying as other` : ''}.`\r\n        : `There are currently ${totalResidents} residents.`;\r\n      parts.push(genderPart);\r\n    } else {\r\n      parts.push('Resident count is not available.');\r\n    }\r\n\r\n    if (topAgeGroup) {\r\n      parts.push(`The most common age group is ${topAgeGroup}.`);\r\n    } else if (age.length) {\r\n      parts.push('Age distribution is available but no dominant age group could be determined.');\r\n    } else {\r\n      parts.push('Age distribution data is not available.');\r\n    }\r\n\r\n    // Occupation summary\r\n    if (occupation.length) {\r\n      const topOcc = occupation.slice().sort((a:any,b:any) => Number(b.value||0) - Number(a.value||0)).slice(0,3).map((o:any) => `${o.type || o.name} (${o.value})`).join(', ');\r\n      parts.push(`Top occupations: ${topOcc}.`);\r\n    } else {\r\n      parts.push('Occupation distribution is not available.');\r\n    }\r\n\r\n    // Nationality summary\r\n    if (nationality.length) {\r\n      const topNat = nationality.slice().sort((a:any,b:any) => Number(b.value||0) - Number(a.value||0)).slice(0,3).map((n:any) => `${n.type || n.name} (${n.value})`).join(', ');\r\n      parts.push(`Nationality distribution (top): ${topNat}.`);\r\n    }\r\n\r\n    if (topCivil) {\r\n      parts.push(`Civil status (top): ${topCivil}.`);\r\n    } else {\r\n      parts.push('Civil status breakdown is not available.');\r\n    }\r\n\r\n    // Blood type and disability\r\n    if (bloodType.length) {\r\n      const bt = bloodType.map((b:any) => `${b.type || b.name} (${b.value})`).join(', ');\r\n      parts.push(`Blood type breakdown: ${bt}.`);\r\n    }\r\n    if (disability.length) {\r\n      const disabledCount = disability.reduce((s:number, d:any) => s + (Number(d.value)||0), 0);\r\n      parts.push(`Disability reported for ${disabledCount} residents.`);\r\n    }\r\n\r\n    if (topEducation) {\r\n      parts.push(`Educational attainment (top): ${topEducation}.`);\r\n    } else {\r\n      parts.push('Educational attainment data is not available.');\r\n    }\r\n\r\n    // Children distribution\r\n    if (children.length) {\r\n      // children chart should be buckets like 0,1,2,3+\r\n      const avgChildren = children.reduce((sum:any, c:any, idx:any) => sum + (Number(c.value)||0) * (Number(c.type) || idx), 0) / Math.max(1, children.reduce((sum:any, c:any) => sum + (Number(c.value)||0), 0));\r\n      parts.push(`Average reported children per household (approx): ${Number(avgChildren).toFixed(2)}.`);\r\n    }\r\n\r\n    if (monthly.length) {\r\n      parts.push(`During the selected period there were ${monthlyTotal} document requests. The busiest month was ${peakMonth} with ${peakVal} requests.`);\r\n    } else {\r\n      parts.push('Document request trends are not available for the selected period.');\r\n    }\r\n\r\n    // Business stats\r\n    if (businessType.length) {\r\n      const topBiz = businessType.slice().sort((a:any,b:any) => Number(b.value||0) - Number(a.value||0)).slice(0,3).map((b:any) => `${b.type || b.name} (${b.value})`).join(', ');\r\n      parts.push(`Top business types: ${topBiz}.`);\r\n    }\r\n    if (businessSize.length) {\r\n      const totalBusinesses = businessSize.reduce((s:any, b:any) => s + (Number(b.value)||0), 0);\r\n      parts.push(`Business size distribution available for ${totalBusinesses} businesses.`);\r\n    }\r\n\r\n    // Income summary\r\n    if (incomeBrackets.length) {\r\n      const totalReported = incomeBrackets.reduce((s:any, b:any) => s + (Number(b.value)||0), 0);\r\n      const topBracket = incomeBrackets.slice().sort((a:any,b:any) => Number(b.value||0) - Number(a.value||0))[0];\r\n      if (topBracket) parts.push(`Most residents fall into the ${topBracket.type || topBracket.name} income bracket (${topBracket.value}). Total reported incomes: ${totalReported}.`);\r\n    }\r\n\r\n    return parts.join(' ');\r\n  };\r\n\r\n  const openReport = () => {\r\n    const text = generateNarrativeReport({ summary, charts: chartData });\r\n    setReportText(text);\r\n    setReportModalOpen(true);\r\n  };\r\n\r\n  const copyReport = async () => {\r\n    try {\r\n      await navigator.clipboard.writeText(reportText);\r\n      message.success('Report copied to clipboard');\r\n    } catch (e) {\r\n      message.error('Failed to copy');\r\n    }\r\n  };\r\n\r\n  const downloadPdf = async () => {\r\n    const doc = new jsPDF({ orientation: 'portrait' });\r\n    const title = 'Analytics Report';\r\n    doc.setFontSize(16);\r\n    doc.text(title, 14, 20);\r\n    doc.setFontSize(11);\r\n    const split = doc.splitTextToSize(reportText, 180);\r\n    doc.text(split, 14, 30);\r\n    \r\n    // Try to capture currently visible charts and append images\r\n    try {\r\n      const html2canvas = (await import('html2canvas')).default;\r\n      let y = 40 + (split.length * 6);\r\n      for (const id of selectedCharts) {\r\n        const el = chartRefs.current[id];\r\n        if (!el) continue;\r\n        // capture element to canvas\r\n        // @ts-ignore\r\n        const canvas = await html2canvas(el, { background: '#ffffff' });\r\n        const imgData = canvas.toDataURL('image/png');\r\n        const imgWidth = canvas.width;\r\n        const imgHeight = canvas.height;\r\n        const pdfWidth = doc.internal.pageSize.getWidth() - 28; // margins\r\n        const pdfHeight = (imgHeight * pdfWidth) / imgWidth;\r\n        if (y + pdfHeight > doc.internal.pageSize.getHeight() - 20) {\r\n          doc.addPage();\r\n          y = 20;\r\n        }\r\n        doc.addImage(imgData, 'PNG', 14, y, pdfWidth, pdfHeight);\r\n        y += pdfHeight + 8;\r\n      }\r\n    } catch (err) {\r\n      console.warn('html2canvas not available or capture failed, exporting text only', err);\r\n      message.warning('Chart capture failed; exporting text-only PDF. To include images, install html2canvas.');\r\n    }\r\n    \r\n    doc.save('analytics-report.pdf');\r\n  };\r\n\r\n  // Download full analytics (dashboard + narrative) as styled A4 PDF\r\n  const downloadFullAnalytics = async () => {\r\n    if (!dashboardRef.current) {\r\n      message.error('Dashboard not available for capture');\r\n      return;\r\n    }\r\n\r\n    message.loading({ content: 'Preparing full report...', key: 'report' });\r\n\r\n    try {\r\n      const html2canvas = (await import('html2canvas')).default;\r\n      // capture the dashboard DOM\r\n      const el = dashboardRef.current;\r\n  // increase scale for better resolution\r\n  const canvas = await html2canvas(el, { background: '#ffffff' });\r\n      const imgData = canvas.toDataURL('image/png');\r\n\r\n      // A4 dimensions in pt at 72 DPI: 595.28 x 841.89; jsPDF default unit is 'pt'\r\n      const pdf = new jsPDF({ unit: 'pt', format: 'a4', orientation: 'portrait' });\r\n\r\n      // cover page\r\n      const title = 'Barangay Analytics Report';\r\n      pdf.setFontSize(24);\r\n      pdf.text(title, 40, 80);\r\n      pdf.setFontSize(12);\r\n      pdf.text(`Generated: ${new Date().toLocaleString()}`, 40, 110);\r\n      pdf.addPage();\r\n\r\n      // add dashboard image scaling to page width with margins\r\n      const pageWidth = pdf.internal.pageSize.getWidth();\r\n      const pageHeight = pdf.internal.pageSize.getHeight();\r\n      const margin = 40;\r\n      const usableWidth = pageWidth - margin * 2;\r\n      // compute image size in PDF points based on natural image dimensions\r\n      const tmpImg = new Image();\r\n      tmpImg.src = imgData;\r\n      await new Promise((res) => (tmpImg.onload = res));\r\n\r\n      const imgWidthPts = usableWidth; // target width in PDF points\r\n      const imgHeightPts = (tmpImg.height * imgWidthPts) / tmpImg.width;\r\n\r\n      // convert pixels to PDF points ratio\r\n      const pxPerPt = tmpImg.height / imgHeightPts; // pixels per PDF point\r\n      const sliceHeightPt = pageHeight - margin * 2; // available height in PDF points\r\n      const sliceHeightPx = Math.floor(sliceHeightPt * pxPerPt);\r\n\r\n      // draw the full image into offscreen canvas at natural size, then slice vertically\r\n      const offCanvas = document.createElement('canvas');\r\n      offCanvas.width = tmpImg.width;\r\n      offCanvas.height = tmpImg.height;\r\n      const ctx = offCanvas.getContext('2d');\r\n      if (!ctx) throw new Error('Canvas not supported');\r\n      ctx.fillStyle = '#ffffff';\r\n      ctx.fillRect(0,0,offCanvas.width, offCanvas.height);\r\n      ctx.drawImage(tmpImg, 0, 0);\r\n\r\n      let yOffset = 0;\r\n      while (yOffset < offCanvas.height) {\r\n        const sliceCanvas = document.createElement('canvas');\r\n        sliceCanvas.width = offCanvas.width;\r\n        sliceCanvas.height = Math.min(sliceHeightPx, offCanvas.height - yOffset);\r\n        const sctx = sliceCanvas.getContext('2d');\r\n        if (!sctx) break;\r\n        sctx.fillStyle = '#ffffff';\r\n        sctx.fillRect(0,0,sliceCanvas.width, sliceCanvas.height);\r\n        sctx.drawImage(offCanvas, 0, yOffset, sliceCanvas.width, sliceCanvas.height, 0, 0, sliceCanvas.width, sliceCanvas.height);\r\n        const sliceData = sliceCanvas.toDataURL('image/png');\r\n        const drawHeightPts = sliceCanvas.height / pxPerPt; // convert slice pixels back to PDF points\r\n        pdf.addImage(sliceData, 'PNG', margin, margin, imgWidthPts, drawHeightPts);\r\n        yOffset += sliceHeightPx;\r\n        if (yOffset < offCanvas.height) pdf.addPage();\r\n      }\r\n\r\n      pdf.save('barangay-analytics-report.pdf');\r\n      message.success({ content: 'Report ready', key: 'report' });\r\n    } catch (err) {\r\n      console.error('Full report export failed', err);\r\n      message.error({ content: 'Failed to export full report (see console).', key: 'report' });\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Card\r\n      title={<Typography.Title level={4} style={{ margin: 0 }}>Statistics & Analytics</Typography.Title>}\r\n      style={{ borderRadius: 16, boxShadow: '0 2px 16px #40c9ff11' }}\r\n      styles={{ body: { padding: 24 } }}\r\n    >\r\n      <div ref={dashboardRef} style={{ background: '#ffffff', padding: 8 }}>\r\n      {/* Filters */}\r\n  <Form layout={isMobile ? \"vertical\" : \"inline\"} style={{ marginBottom: 24, width: '100%', boxSizing: 'border-box' }}>\r\n        <Form.Item label=\"Date Range\">\r\n          <RangePicker\r\n            value={filters.dateRange as any}\r\n            onChange={dates => setFilters(f => ({ ...f, dateRange: (dates ? dates.filter(Boolean) : []) as Moment[] }))}\r\n            allowClear\r\n          />\r\n        </Form.Item>\r\n        <Form.Item label=\"Resident Type\">\r\n          <Select\r\n            value={filters.residentType}\r\n            onChange={val => setFilters(f => ({ ...f, residentType: val }))}\r\n            style={{ minWidth: 140 }}\r\n            allowClear\r\n            placeholder=\"All Types\"\r\n          >\r\n            <Option value=\"\">All</Option>\r\n            <Option value=\"active\">Active</Option>\r\n            <Option value=\"inactive\">Inactive</Option>\r\n          </Select>\r\n        </Form.Item>\r\n\r\n        <Form.Item label=\"Charts\">\r\n          <Dropdown\r\n            open={chartsDropdownOpen}\r\n            onOpenChange={(open) => {\r\n              if (open) {\r\n                // initialize pending selection from current selection\r\n                setPendingSelectedCharts(selectedCharts.slice());\r\n              } else {\r\n                // when closing without apply, reset pending to current\r\n                setPendingSelectedCharts(selectedCharts.slice());\r\n              }\r\n              setChartsDropdownOpen(open);\r\n            }}\r\n            popupRender={() => (\r\n              <div style={{ padding: 12, background: '#fff', borderRadius: 8, boxShadow: '0 6px 20px rgba(0,0,0,0.08)', minWidth: 340 }}>\r\n                {/* Tidy vertical list with scroll when content overflows */}\r\n                <div style={{ maxHeight: 260, overflowY: 'auto', paddingRight: 8 }} onWheel={(e) => { /* allow native wheel scrolling */ }}>\r\n                  <div style={{ display: 'flex', flexDirection: 'column', gap: 8 }}>\r\n                    {Object.keys(CHARTS).map(k => {\r\n                      const checked = (pendingSelectedCharts || []).includes(k);\r\n                      return (\r\n                        <Checkbox key={k} checked={checked} onChange={(ev) => {\r\n                          const next = new Set(pendingSelectedCharts || []);\r\n                          if ((ev.target as HTMLInputElement).checked) next.add(k); else next.delete(k);\r\n                          setPendingSelectedCharts(Array.from(next));\r\n                        }}>\r\n                          <span style={{ fontSize: 13 }}>{CHARTS[k].title}</span>\r\n                        </Checkbox>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                </div>\r\n                <div style={{ display: 'flex', justifyContent: 'flex-end', gap: 8, marginTop: 12 }}>\r\n                  <Button size=\"small\" onClick={() => { setPendingSelectedCharts(selectedCharts.slice()); setChartsDropdownOpen(false); }}>Cancel</Button>\r\n                  <Button size=\"small\" type=\"primary\" onClick={() => { setSelectedCharts(pendingSelectedCharts.slice()); setChartsDropdownOpen(false); }}>Apply</Button>\r\n                </div>\r\n              </div>\r\n            )}\r\n            trigger={['click']}\r\n          >\r\n            <Button>\r\n              Charts <DownOutlined />\r\n            </Button>\r\n          </Dropdown>\r\n        </Form.Item>\r\n        <Form.Item style={{ width: '100%', boxSizing: 'border-box' }}>\r\n          {/* Use a wrapping flex container so buttons stack/wrap on narrow screens */}\r\n          <div style={{ display: 'flex', flexWrap: 'wrap', gap: 8, alignItems: 'center', width: '100%', boxSizing: 'border-box' }}>\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: 8, minWidth: 200 }}>\r\n              <Switch checked={autoEnableWhenData} onChange={v => setAutoEnableWhenData(!!v)} />\r\n              <span style={{ fontSize: 13 }}>Enable when data exists</span>\r\n            </div>\r\n            {/* Buttons container: on mobile take full row so buttons don't overflow */}\r\n            <div style={{ display: 'flex', gap: 8, flexWrap: 'wrap', flex: isMobile ? '0 0 100%' : '0 1 auto', alignItems: 'center', width: isMobile ? '100%' : undefined, boxSizing: 'border-box', paddingRight: 8 }}>\r\n              <Button onClick={() => { setSettingsOpen(true); setSettingsChartId(selectedCharts[0] || 'gender'); }} block={isMobile} style={isMobile ? { width: '100%', marginBottom: 8 } : undefined}>Chart Settings</Button>\r\n              <Button type=\"primary\" onClick={openReport} block={isMobile} style={isMobile ? { width: '100%', marginBottom: 8 } : undefined}>Generate Report</Button>\r\n              <Button onClick={async () => { await downloadFullAnalytics(); }} block={isMobile} style={isMobile ? { width: '100%' } : undefined}>Download Full Analytics</Button>\r\n            </div>\r\n          </div>\r\n        </Form.Item>\r\n      </Form>\r\n\r\n      <Drawer title=\"Chart Settings\" placement=\"right\" onClose={() => setSettingsOpen(false)} open={settingsOpen} width={420}>\r\n        <Form layout=\"vertical\">\r\n          <Form.Item label=\"Select chart\">\r\n            <Select value={settingsChartId} onChange={(v) => setSettingsChartId(v)}>\r\n              {Object.keys(CHARTS).map(k => <Select.Option key={k} value={k}>{CHARTS[k].title}</Select.Option>)}\r\n            </Select>\r\n          </Form.Item>\r\n\r\n          <Form.Item label=\"Chart type\">\r\n            <Select value={(chartSettings[settingsChartId] && chartSettings[settingsChartId].chartType) || CHARTS[settingsChartId].chartType} onChange={(val) => setChartSettings(s => ({ ...s, [settingsChartId]: { ...(s[settingsChartId] || {}), chartType: val } }))}>\r\n              <Select.Option value=\"pie\">Pie</Select.Option>\r\n              <Select.Option value=\"bar\">Bar</Select.Option>\r\n              <Select.Option value=\"line\">Line</Select.Option>\r\n              <Select.Option value=\"area\">Area</Select.Option>\r\n            </Select>\r\n          </Form.Item>\r\n\r\n          <Form.Item label=\"Date range for this chart\">\r\n            <RangePicker value={(chartSettings[settingsChartId] && chartSettings[settingsChartId].dateRange) || filters.dateRange} onChange={(dates) => setChartSettings(s => ({ ...s, [settingsChartId]: { ...(s[settingsChartId] || {}), dateRange: dates ? dates.filter(Boolean) : [] } }))} allowClear />\r\n          </Form.Item>\r\n\r\n          <Form.Item label=\"Show labels\">\r\n            <Switch checked={(chartSettings[settingsChartId] && chartSettings[settingsChartId].showLabels) ?? true} onChange={(v) => setChartSettings(s => ({ ...s, [settingsChartId]: { ...(s[settingsChartId] || {}), showLabels: v } }))} />\r\n          </Form.Item>\r\n\r\n          <Form.Item label=\"Show tooltips\">\r\n            <Switch checked={(chartSettings[settingsChartId] && chartSettings[settingsChartId].showTooltips) ?? true} onChange={(v) => setChartSettings(s => ({ ...s, [settingsChartId]: { ...(s[settingsChartId] || {}), showTooltips: v } }))} />\r\n          </Form.Item>\r\n\r\n          <Form.Item label=\"Show legend\">\r\n            <Switch checked={(chartSettings[settingsChartId] && chartSettings[settingsChartId].showLegend) ?? true} onChange={(v) => setChartSettings(s => ({ ...s, [settingsChartId]: { ...(s[settingsChartId] || {}), showLegend: v } }))} />\r\n          </Form.Item>\r\n\r\n          <Form.Item>\r\n            <Space>\r\n              <Button type=\"primary\" onClick={() => { setSettingsOpen(false); fetchChart(settingsChartId); }}>Apply</Button>\r\n              <Button onClick={() => { setChartSettings(s => ({ ...s, [settingsChartId]: {} })); }}>Reset</Button>\r\n            </Space>\r\n          </Form.Item>\r\n        </Form>\r\n      </Drawer>\r\n\r\n      <Modal title=\"Analytics Report\" open={reportModalOpen} onCancel={() => setReportModalOpen(false)} footer={[\r\n        <Button key=\"copy\" onClick={copyReport}>Copy</Button>,\r\n        <Button key=\"download\" type=\"primary\" onClick={downloadPdf}>Download as PDF</Button>\r\n      ]}>\r\n        <Typography.Paragraph>{reportText || 'No data available for report.'}</Typography.Paragraph>\r\n      </Modal>\r\n\r\n      {/* Top Metrics */}\r\n      <Row gutter={[24, 24]} style={{ marginBottom: 24 }}>\r\n        <Col xs={24} sm={12} md={8}>\r\n          <Card variant=\"borderless\" style={{ borderRadius: 12, boxShadow: '0 8px 20px rgba(15,15,15,0.04)', textAlign: 'left' }} styles={{ body: { padding: 16 } }}>\r\n            {loadingSummary ? <Skeleton active paragraph={false} /> : (\r\n              <div>\r\n                <Typography.Text type=\"secondary\" style={{ display: 'block', fontSize: 12 }}>Total Residents</Typography.Text>\r\n                <Typography.Title level={3} style={{ margin: 0 }}>{totalResidents}</Typography.Title>\r\n              </div>\r\n            )}\r\n          </Card>\r\n        </Col>\r\n\r\n        <Col xs={24} sm={12} md={8}>\r\n          <Card variant=\"borderless\" style={{ borderRadius: 12, boxShadow: '0 8px 20px rgba(15,15,15,0.04)', textAlign: 'left' }} styles={{ body: { padding: 16 } }}>\r\n            {loadingSummary ? <Skeleton active paragraph={false} /> : (\r\n              <div>\r\n                <Typography.Text type=\"secondary\" style={{ display: 'block', fontSize: 12 }}>Total Documents</Typography.Text>\r\n                <Typography.Title level={3} style={{ margin: 0 }}>{totalDocuments}</Typography.Title>\r\n              </div>\r\n            )}\r\n          </Card>\r\n        </Col>\r\n\r\n        <Col xs={24} sm={24} md={8}>\r\n          <Card style={{ borderRadius: 12, boxShadow: '0 8px 20px rgba(15,15,15,0.04)', textAlign: 'left' }} styles={{ body: { padding: 16 } }}>\r\n            {loadingSummary ? <Skeleton active paragraph={false} /> : (\r\n              <div>\r\n                <Typography.Text type=\"secondary\" style={{ display: 'block', fontSize: 12 }}>Requests (selected period)</Typography.Text>\r\n                <Typography.Title level={3} style={{ margin: 0 }}>{monthlyDocData ? monthlyDocData.reduce((s:any,m:any)=>s + (Number(m.value)||0), 0) : 0}</Typography.Title>\r\n                <Typography.Text type=\"secondary\" style={{ display: 'block', fontSize: 12, marginTop: 6 }}>{monthlyDocData && monthlyDocData.length ? `Latest: ${monthlyDocData[monthlyDocData.length-1].type} (${monthlyDocData[monthlyDocData.length-1].value})` : ''}</Typography.Text>\r\n              </div>\r\n            )}\r\n          </Card>\r\n        </Col>\r\n      </Row>\r\n\r\n      <Divider />\r\n      {/* Charts */}\r\n      {/* Show Alerts for failed chart queries */}\r\n      {chartIds.map(id => {\r\n    const q = chartQueriesMapMemo[id];\r\n        if (q?.isError) {\r\n          return (\r\n            <Alert\r\n              key={`alert-${id}`}\r\n              message={`Failed to load ${CHARTS[id].title}`}\r\n              description={<div>{String(q.error?.message || q.error)} <Button size=\"small\" onClick={() => q.refetch()}>Retry</Button></div>}\r\n              type=\"error\"\r\n              showIcon\r\n              style={{ marginBottom: 12 }}\r\n            />\r\n          );\r\n        }\r\n        return null;\r\n      })}\r\n      <Row gutter={[24, 24]}>\r\n        {selectedCharts.includes('gender') && (\r\n          <Col xs={24} md={12} lg={12}>\r\n            <ChartCard id=\"gender\" title={CHARTS['gender'].title} chartType={CHARTS['gender'].chartType} data={chartData['gender']} loading={chartLoading['gender']} colors={CHARTS['gender'].colors} />\r\n          </Col>\r\n        )}\r\n\r\n        {selectedCharts.includes('age') && (\r\n          <Col xs={24} md={12} lg={12}>\r\n            <ChartCard id=\"age\" title={CHARTS['age'].title} chartType={CHARTS['age'].chartType} data={chartData['age']} loading={chartLoading['age']} colors={CHARTS['age'].colors} />\r\n          </Col>\r\n        )}\r\n\r\n        {selectedCharts.includes('documents-monthly') && (\r\n          <Col xs={24} md={12} lg={12}>\r\n            <ChartCard id=\"documents-monthly\" title={CHARTS['documents-monthly'].title} chartType={CHARTS['documents-monthly'].chartType} data={chartData['documents-monthly']} loading={chartLoading['documents-monthly']} colors={CHARTS['documents-monthly'].colors} />\r\n          </Col>\r\n        )}\r\n\r\n        {selectedCharts.includes('civil-status') && (\r\n          <Col xs={24} md={12} lg={12}>\r\n            <ChartCard id=\"civil-status\" title={CHARTS['civil-status'].title} chartType={CHARTS['civil-status'].chartType} data={chartData['civil-status']} loading={chartLoading['civil-status']} colors={CHARTS['civil-status'].colors} />\r\n          </Col>\r\n        )}\r\n\r\n        {selectedCharts.includes('education') && (\r\n          <Col xs={24} md={12} lg={12}>\r\n            <ChartCard id=\"education\" title={CHARTS['education'].title} chartType={CHARTS['education'].chartType} data={chartData['education']} loading={chartLoading['education']} colors={CHARTS['education'].colors} />\r\n          </Col>\r\n        )}\r\n      </Row>\r\n      \r\n      </div>\r\n  </Card>\r\n  );\r\n};\r\n\r\nconst Statistics: React.FC = () => {\r\n  return (\r\n    <QueryClientProvider client={defaultQueryClient}>\r\n      <StatisticsInner />\r\n    </QueryClientProvider>\r\n  );\r\n};\r\n\r\nexport default Statistics;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Modal, Button, TextField, Box, CircularProgress, Snackbar, Alert } from '@mui/material';\r\nimport { adminAPI } from '../services/api';\r\n\r\ninterface Props {\r\n  open: boolean;\r\n  onClose: () => void;\r\n  contactEmail?: string;\r\n}\r\n\r\nconst TestEmailModal: React.FC<Props> = ({ open, onClose, contactEmail }) => {\r\n  const [to, setTo] = useState(contactEmail || '');\r\n  const [sending, setSending] = useState(false);\r\n\r\n  useEffect(() => {\r\n    setTo(contactEmail || '');\r\n  }, [contactEmail, open]);\r\n\r\n  const [snackOpen, setSnackOpen] = useState(false);\r\n  const [snackMessage, setSnackMessage] = useState('');\r\n  const [snackSeverity, setSnackSeverity] = useState<'success' | 'error'>('success');\r\n\r\n  const handleSend = async () => {\r\n    try {\r\n      setSending(true);\r\n      // Check SMTP settings first to provide a clearer error if not configured\r\n      try {\r\n        const settings: any = await adminAPI.getSystemSettings();\r\n        if (!settings || !settings.smtp || !settings.smtp.host) {\r\n          setSnackMessage('SMTP is not configured. Please configure SMTP settings before sending a test email.');\r\n          setSnackSeverity('error');\r\n          setSnackOpen(true);\r\n          setSending(false);\r\n          return;\r\n        }\r\n      } catch (e) {\r\n        // couldn't fetch settings; continue and let testSmtp surface server message\r\n      }\r\n\r\n      const res = await adminAPI.testSmtp(to);\r\n      const message = res && res.message ? res.message : 'Test email sent successfully';\r\n      setSnackMessage(message);\r\n      setSnackSeverity('success');\r\n      setSnackOpen(true);\r\n      setSending(false);\r\n      // close modal shortly after showing success\r\n      setTimeout(() => {\r\n        setSnackOpen(false);\r\n        onClose();\r\n      }, 900);\r\n    } catch (err: any) {\r\n      setSending(false);\r\n      const message = err?.response?.data?.message || err?.response?.data?.error || err?.message || 'Failed to send test email';\r\n      setSnackMessage(message);\r\n      setSnackSeverity('error');\r\n      setSnackOpen(true);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Modal open={open} onClose={() => { if (!sending) onClose(); }}>\r\n        <Box sx={{ position: 'absolute', top: '50%', left: '50%', transform: 'translate(-50%, -50%)', width: 420, bgcolor: 'background.paper', boxShadow: 24, p: 3 }}>\r\n          <h3>Send Test Email</h3>\r\n          <TextField\r\n            label=\"Recipient Email\"\r\n            type=\"email\"\r\n            value={to}\r\n            onChange={(e) => setTo(e.target.value)}\r\n            fullWidth\r\n            margin=\"normal\"\r\n          />\r\n\r\n          <Box sx={{ display: 'flex', justifyContent: 'flex-end', gap: 2, mt: 2 }}>\r\n            <Button onClick={onClose} disabled={sending}>Cancel</Button>\r\n            <Button variant=\"contained\" onClick={handleSend} disabled={sending || !to}>\r\n              {sending ? <CircularProgress size={20} /> : 'Send Test Email'}\r\n            </Button>\r\n          </Box>\r\n        </Box>\r\n      </Modal>\r\n      <Snackbar open={snackOpen} autoHideDuration={4000} onClose={() => setSnackOpen(false)}>\r\n        <Alert onClose={() => setSnackOpen(false)} severity={snackSeverity} sx={{ width: '100%' }}>\r\n          {snackMessage}\r\n        </Alert>\r\n      </Snackbar>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default TestEmailModal;\r\n","const defaultSystemSettings = {\r\n  siteName: 'Barangay Portal',\r\n  barangayName: 'Barangay Uno',\r\n  barangayAddress: '123 Main St, City, Province',\r\n  contactEmail: 'info@barangayuno.local',\r\n  contactPhone: '+63 912 345 6789',\r\n  maintainanceMode: false,\r\n  allowNewRegistrations: true,\r\n  requireEmailVerification: true,\r\n  maxDocumentRequests: 5,\r\n  documentProcessingDays: 3,\r\n  // Allow creation of multiple accounts from the same IP and the maximum allowed\r\n  allowMultipleAccountsPerIP: false,\r\n  maxAccountsPerIP: 1,\r\n  systemNotice: '',\r\n  smtp: {\r\n    host: '',\r\n    port: 587,\r\n    user: '',\r\n    password: '',\r\n  },\r\n};\r\n\r\nexport default defaultSystemSettings;\r\n","import React, { useState, useEffect, useRef } from 'react';\r\nimport {\r\n  Box,\r\n  Paper,\r\n  Typography,\r\n  TextField,\r\n  Button,\r\n  FormControlLabel,\r\n  Switch,\r\n  Divider,\r\n  Alert,\r\n  CircularProgress,\r\n} from '@mui/material';\r\nimport TestEmailModal from '../TestEmailModal';\r\nimport { adminAPI } from '../../services/api';\r\nimport axios from 'axios';\r\nimport { API_URL } from '../../services/api';\r\nimport { UploadOutlined, UsergroupAddOutlined, DeleteOutlined } from '@ant-design/icons';\r\nimport { Upload as AntdUpload, message as antdMessage, Row, Col, Card, Form as AntdForm, Input as AntdInput, Avatar, Carousel, Divider as AntdDivider, notification, Button as AntdButton } from 'antd';\r\n// framer-motion removed to avoid dependency conflicts; use CSS transitions for preview\r\nimport defaultSystemSettings from '../../config/defaultSystemSettings';\r\nimport getOfficialPhotoSrc from '../../utils/officials';\r\n\r\ninterface SystemSettings {\r\n  siteName: string;\r\n  barangayName: string;\r\n  barangayAddress: string;\r\n  contactEmail: string;\r\n  contactPhone: string;\r\n  maintainanceMode: boolean;\r\n  allowNewRegistrations: boolean;\r\n  requireEmailVerification: boolean;\r\n  maxDocumentRequests: number;\r\n  documentProcessingDays: number;\r\n  // new rate-limiting settings\r\n  allowMultipleAccountsPerIP?: boolean;\r\n  maxAccountsPerIP?: number;\r\n  systemNotice: string;\r\n  smtp?: {\r\n    host?: string;\r\n    port?: number;\r\n    user?: string;\r\n    password?: string;\r\n  };\r\n}\r\n\r\ninterface Official {\r\n  _id?: string;\r\n  name: string;\r\n  title: string;\r\n  term: string;\r\n  photoUrl?: string;\r\n  photoPath?: string;\r\n  previewUrl?: string; // client-side temporary preview for selected file\r\n}\r\n\r\nconst SystemSettings: React.FC = () => {\r\n  const [settings, setSettings] = useState<SystemSettings>(() => ({ ...defaultSystemSettings } as SystemSettings));\r\n  const [loading, setLoading] = useState(true);\r\n  const [saving, setSaving] = useState(false);\r\n  const [success, setSuccess] = useState(false);\r\n  const [error, setError] = useState<string | null>(null);\r\n  const [testModalOpen, setTestModalOpen] = useState(false);\r\n  // Officials state\r\n  const [officials, setOfficials] = useState<Official[]>([]);\r\n  const [officialsLoading, setOfficialsLoading] = useState(false);\r\n  const [savingOfficials, setSavingOfficials] = useState(false);\r\n  const [manualSaveError, setManualSaveError] = useState<string | null>(null);\r\n  const autoSaveTimers = useRef<Record<string, number>>({});\r\n  const [officialSaveStatus, setOfficialSaveStatus] = useState<Record<string, 'idle'|'saving'|'saved'|'error'>>({});\r\n  const previewUrlsRef = useRef<Record<string, string>>({});\r\n  const previewContainerRef = useRef<HTMLDivElement | null>(null);\r\n  const prevOfficialsCountRef = useRef(0);\r\n  const [highlightedIds, setHighlightedIds] = useState<string[]>([]);\r\n  const highlightTimeouts = useRef<Record<string, number>>({});\r\n  const originalSettingsRef = useRef<SystemSettings | null>(null);\r\n  const [dirty, setDirty] = useState(false);\r\n\r\n  // helper to make MUI InputLabel shrink when the field has content or a non-empty value\r\n  const inputLabelShrink = (val: any) => ({ InputLabelProps: { shrink: val !== undefined && val !== null && val !== '' } });\r\n\r\n  useEffect(() => {\r\n    const ac = new AbortController();\r\n    fetchSettings(ac.signal);\r\n    return () => {\r\n      // cancel pending fetch\r\n      try { ac.abort(); } catch (e) {}\r\n      // revoke any created object URLs\r\n      try {\r\n        Object.values(previewUrlsRef.current).forEach(u => {\r\n          try { URL.revokeObjectURL(u); } catch (e) {}\r\n        });\r\n      } catch (e) {}\r\n    };\r\n  }, []);\r\n\r\n  // Scroll preview container to the right when items are appended\r\n  useEffect(() => {\r\n    try {\r\n      const container = previewContainerRef.current;\r\n      if (!container) return;\r\n      if (officials.length > prevOfficialsCountRef.current) {\r\n        container.scrollTo({ left: container.scrollWidth, behavior: 'smooth' });\r\n      }\r\n      prevOfficialsCountRef.current = officials.length;\r\n    } catch (e) {}\r\n  }, [officials.length]);\r\n\r\n  // Detect newly added temp officials and highlight them briefly\r\n  useEffect(() => {\r\n    try {\r\n      const newTemp = officials.filter(o => o._id && o._id.toString().startsWith('new-')).map(o => o._id as string);\r\n      // highlight any temp ids that are new and not already highlighted\r\n      newTemp.forEach(id => {\r\n        if (!highlightedIds.includes(id)) {\r\n          setHighlightedIds(prev => [...prev, id]);\r\n          // remove highlight after 2.5s\r\n          const t = window.setTimeout(() => {\r\n            setHighlightedIds(prev => prev.filter(x => x !== id));\r\n            delete highlightTimeouts.current[id];\r\n          }, 2500);\r\n          highlightTimeouts.current[id] = t;\r\n        }\r\n      });\r\n    } catch (e) {}\r\n    // cleanup when unmounting\r\n    return () => {\r\n      Object.values(highlightTimeouts.current).forEach((tid) => { try { clearTimeout(tid); } catch (e) {} });\r\n      highlightTimeouts.current = {};\r\n    };\r\n  }, [officials, highlightedIds]);\r\n\r\n  // Accept an optional AbortSignal so caller can cancel when unmounting\r\n  const fetchSettings = async (signal?: AbortSignal) => {\r\n    setLoading(true);\r\n    try {\r\n      // primary attempt using adminAPI (uses axiosInstance and auth interceptors)\r\n      let sys: SystemSettings | null = null;\r\n      try {\r\n        sys = await adminAPI.getSystemSettings();\r\n      } catch (err) {\r\n        // fallback: call backend directly at configured API_URL (avoid client origin)\r\n        try {\r\n          const res = await axios.get(`${API_URL}/admin/settings`, { withCredentials: true, signal } as any);\r\n          if (res?.data) sys = res.data;\r\n        } catch (err2) {\r\n          console.warn('Failed to load system settings via adminAPI and API_URL fallback', err, err2);\r\n        }\r\n      }\r\n      if (sys) {\r\n        setSettings(sys);\r\n        originalSettingsRef.current = sys;\r\n      }\r\n\r\n      // officials: try adminAPI then API_URL fallback\r\n      setOfficialsLoading(true);\r\n      try {\r\n        const offs = await adminAPI.getOfficials();\r\n        if (Array.isArray(offs)) {\r\n          setOfficials(offs);\r\n        } else {\r\n          const r = await axios.get(`${API_URL}/admin/officials`, { withCredentials: true, signal } as any);\r\n          if (r?.data) setOfficials(r.data);\r\n        }\r\n      } catch (err) {\r\n        try {\r\n          const r = await axios.get(`${API_URL}/admin/officials`, { withCredentials: true, signal } as any);\r\n          if (r?.data) setOfficials(r.data);\r\n        } catch (err2) {\r\n          console.warn('Failed to load officials via adminAPI and API_URL fallback', err, err2);\r\n        }\r\n      } finally {\r\n        setOfficialsLoading(false);\r\n      }\r\n    } catch (err) {\r\n      if ((err as any)?.name === 'CanceledError' || (err as any)?.name === 'AbortError') {\r\n        // fetch canceled, ignore\r\n        return;\r\n      }\r\n      console.error('Unexpected error in fetchSettings', err);\r\n      antdMessage.error('Unexpected error while loading settings');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Save system settings (used by Save Changes button)\r\n  const handleSave = async () => {\r\n    try {\r\n      setSaving(true);\r\n      setError(null);\r\n      // Normalize numeric fields\r\n      // Normalize numeric fields and map client keys to server-side field names\r\n      const payload: any = {\r\n        ...settings,\r\n        // compatibility: server uses 'maintenanceMode' while client uses 'maintainanceMode' (typo)\r\n        maintenanceMode: (settings as any).maintainanceMode,\r\n        // server expects allowRegistrations and maxDocumentRequestsPerUser\r\n        allowRegistrations: (settings as any).allowNewRegistrations,\r\n        maxDocumentRequestsPerUser: Number((settings as any).maxDocumentRequests) || 1,\r\n        documentProcessingDays: Number(settings.documentProcessingDays) || 1,\r\n        ...(typeof (settings as any).maxAccountsPerIP !== 'undefined'\r\n          ? { maxAccountsPerIP: Number((settings as any).maxAccountsPerIP) || 1 }\r\n          : {}),\r\n      } as SystemSettings;\r\n\r\n      await adminAPI.updateSystemSettings(payload);\r\n      // optimistic: update original copy and clear dirty flag\r\n      originalSettingsRef.current = payload;\r\n      setDirty(false);\r\n      setSuccess(true);\r\n      antdMessage.success('Settings saved');\r\n    } catch (err) {\r\n      console.error('Failed to save settings', err);\r\n      setError('Failed to save settings');\r\n      antdMessage.error('Failed to save settings');\r\n    } finally {\r\n      setSaving(false);\r\n      window.setTimeout(() => setSuccess(false), 2000);\r\n    }\r\n  }\r\n\r\n  // Manual save for officials (fallback)\r\n  const handleManualSaveOfficials = async () => {\r\n    if (!officials || officials.length === 0) return;\r\n    setSavingOfficials(true);\r\n    setManualSaveError(null);\r\n    try {\r\n      const updatedOfficials: Official[] = [];\r\n      for (const off of officials) {\r\n        if (!off._id || off._id.toString().startsWith('new-')) {\r\n          // create\r\n          const created = await adminAPI.createOfficial({ name: off.name, title: off.title, term: off.term });\r\n          updatedOfficials.push(created);\r\n        } else {\r\n          try {\r\n            const updated = await adminAPI.updateOfficial(off._id!, { name: off.name, title: off.title, term: off.term });\r\n            updatedOfficials.push(updated);\r\n          } catch (e) {\r\n            // if update failed, keep local copy so user can retry\r\n            updatedOfficials.push(off);\r\n          }\r\n        }\r\n      }\r\n      // replace list with refreshed items from server if possible\r\n      try {\r\n        const refreshed = await adminAPI.getOfficials();\r\n        if (Array.isArray(refreshed)) setOfficials(refreshed);\r\n        else setOfficials(updatedOfficials);\r\n      } catch (e) {\r\n        setOfficials(updatedOfficials);\r\n      }\r\n      antdMessage.success('Officials saved');\r\n    } catch (err) {\r\n      console.error('Manual save officials failed', err);\r\n      setManualSaveError('Manual save failed');\r\n      antdMessage.error('Manual save failed');\r\n    } finally {\r\n      setSavingOfficials(false);\r\n    }\r\n  }\r\n\r\n  // Combined save used by floating action button: save system settings first, then officials\r\n  const saveAll = async () => {\r\n    // prefer existing saving flags inside the individual handlers\r\n    try {\r\n      await handleSave();\r\n    } catch (e) {\r\n      // handleSave already logs and reports errors\r\n    }\r\n    try {\r\n      await handleManualSaveOfficials();\r\n    } catch (e) {\r\n      // manual save already reports errors\r\n    }\r\n  }\r\n\r\n  // Track whether settings are different from the original copy loaded from server\r\n  useEffect(() => {\r\n    try {\r\n      if (!originalSettingsRef.current) {\r\n        setDirty(false);\r\n        return;\r\n      }\r\n      setDirty(JSON.stringify(originalSettingsRef.current) !== JSON.stringify(settings));\r\n    } catch (e) {\r\n      setDirty(false);\r\n    }\r\n  }, [settings]);\r\n\r\n  const handleDeleteOfficial = async (id?: string) => {\r\n    if (!id) return;\r\n    setSavingOfficials(true);\r\n    try {\r\n      await adminAPI.deleteOfficial(id);\r\n      setOfficials(prev => prev.filter(p => p._id !== id));\r\n      antdMessage.success('Official deleted');\r\n    } catch (err) {\r\n      console.error('Delete official failed', err);\r\n      antdMessage.error('Failed to delete official');\r\n    } finally {\r\n      setSavingOfficials(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <Box sx={{\r\n      // ensure content is pushed below the app header which writes its height to --app-header-height\r\n      pt: 'calc(var(--app-header-height, 64px) + 24px)',\r\n      px: 3,\r\n      pb: 3,\r\n    }}>\r\n      <Paper sx={{ p: 3 }}>\r\n        {/* Barangay Information */}\r\n        <Typography variant=\"subtitle1\" gutterBottom>\r\n          Barangay Information\r\n        </Typography>\r\n        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2, mb: 3 }}>\r\n          <TextField\r\n            label=\"Site Name\"\r\n            value={settings.siteName}\r\n            onChange={(e) => setSettings({ ...settings, siteName: e.target.value })}\r\n            variant=\"outlined\"\r\n            InputLabelProps={{ shrink: true }}\r\n            fullWidth\r\n          />\r\n          <TextField\r\n            label=\"Barangay Name\"\r\n            value={settings.barangayName}\r\n            onChange={(e) => setSettings({ ...settings, barangayName: e.target.value })}\r\n            variant=\"outlined\"\r\n            InputLabelProps={{ shrink: true }}\r\n            fullWidth\r\n          />\r\n          <TextField\r\n            label=\"Barangay Address\"\r\n            value={settings.barangayAddress}\r\n            onChange={(e) => setSettings({ ...settings, barangayAddress: e.target.value })}\r\n            variant=\"outlined\"\r\n            InputLabelProps={{ shrink: true }}\r\n            fullWidth\r\n            multiline\r\n            rows={2}\r\n          />\r\n        </Box>\r\n\r\n        <Divider sx={{ my: 3 }} />\r\n        {/* SMTP / Email Settings */}\r\n        <Typography variant=\"subtitle1\" gutterBottom>\r\n          SMTP / Email Settings\r\n        </Typography>\r\n        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2, mb: 3 }}>\r\n          <TextField\r\n            label=\"SMTP Host\"\r\n            value={(settings as any).smtp?.host || ''}\r\n            onChange={(e) => setSettings((prev) => ({ ...(prev as any), smtp: { ...(prev as any).smtp, host: e.target.value } }) as SystemSettings)}\r\n            variant=\"outlined\"\r\n            InputLabelProps={{ shrink: true }}\r\n            fullWidth\r\n          />\r\n          <TextField\r\n            label=\"SMTP Port\"\r\n            type=\"number\"\r\n            value={(settings as any).smtp?.port || ''}\r\n            onChange={(e) => setSettings((prev) => ({ ...(prev as any), smtp: { ...(prev as any).smtp, port: parseInt(e.target.value || '0') } }) as SystemSettings)}\r\n            variant=\"outlined\"\r\n            InputLabelProps={{ shrink: true }}\r\n            fullWidth\r\n          />\r\n          <TextField\r\n            label=\"SMTP User\"\r\n            value={(settings as any).smtp?.user || ''}\r\n            onChange={(e) => setSettings((prev) => ({ ...(prev as any), smtp: { ...(prev as any).smtp, user: e.target.value } }) as SystemSettings)}\r\n            variant=\"outlined\"\r\n            InputLabelProps={{ shrink: true }}\r\n            fullWidth\r\n          />\r\n          <Box sx={{ display: 'flex', gap: 2 }}>\r\n            <Button variant=\"outlined\" onClick={() => setTestModalOpen(true)}>Send Test Email</Button>\r\n            <Button variant=\"text\" onClick={() => setSettings((prev) => ({ ...(prev as any), smtp: { ...(prev as any).smtp, password: '' } }) as SystemSettings)}>Clear SMTP Password</Button>\r\n          </Box>\r\n        </Box>\r\n\r\n        <TestEmailModal open={testModalOpen} onClose={() => setTestModalOpen(false)} contactEmail={settings.contactEmail} />\r\n\r\n          <Divider sx={{ my: 3 }} />\r\n          {/* Barangay Officials Section */}\r\n          <Typography variant=\"subtitle1\" gutterBottom>\r\n            Barangay Officials\r\n          </Typography>\r\n          <Box sx={{ display: 'flex', gap: 3, alignItems: 'flex-start', mb: 3, flexDirection: { xs: 'column', md: 'row' } }}>\r\n            {/* Left column: header + scrollable list */}\r\n            <Box sx={{ flex: 1, width: '100%' }}>\r\n              <Box sx={{ display: 'flex', justifyContent: 'space-between', mb: 2 }}>\r\n                <Typography variant=\"body1\">Manage officials (auto-saves changes)</Typography>\r\n                <Button onClick={() => {\r\n                  // add new (append to end so preview shows on the right)\r\n                  const temp: Official = { _id: `new-${Date.now()}`, name: '', title: '', term: '' };\r\n                  setOfficials(prev => [...prev, temp]);\r\n                }} startIcon={<UsergroupAddOutlined />}>Add Official</Button>\r\n              </Box>\r\n\r\n              {/* Scrollable list area */}\r\n              <Box sx={{ maxHeight: 420, overflowY: 'auto', pr: 1, border: '1px solid rgba(0,0,0,0.04)', borderRadius: 1, boxShadow: 'inset 0 1px 0 rgba(255,255,255,0.6)' }}>\r\n                {officialsLoading ? <CircularProgress size={24} /> : (\r\n                  <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2 }}>\r\n                    {officials.map((off, idx) => (\r\n                      <Paper key={off._id || idx} sx={{ p: 2, display: 'flex', gap: 2, alignItems: 'center' }}>\r\n                      <Box sx={{ width: 72, height: 72, borderRadius: '50%', overflow: 'hidden', flexShrink: 0, border: '3px solid rgba(0,0,0,0.04)', boxShadow: '0 1px 6px rgba(0,0,0,0.06)' }}>\r\n                        <img\r\n                          src={getOfficialPhotoSrc(off as any)}\r\n                          alt={off.name || 'photo'}\r\n                          style={{ width: '100%', height: '100%', objectFit: 'cover', transition: 'transform .2s', display: 'block' }}\r\n                        />\r\n                      </Box>\r\n                      <Box sx={{ flex: 1 }}>\r\n                        <TextField label=\"Full name\" value={off.name} onChange={(e) => {\r\n                          const v = e.target.value;\r\n                          setOfficials(prev => prev.map(o => o._id === off._id ? { ...o, name: v } : o));\r\n                          // schedule autosave\r\n                          if (autoSaveTimers.current[off._id || '']) clearTimeout(autoSaveTimers.current[off._id || '']);\r\n                          autoSaveTimers.current[off._id || ''] = window.setTimeout(async () => {\r\n                            try {\r\n                              setSavingOfficials(true);\r\n                              if (off._id && !off._id.toString().startsWith('new-')) {\r\n                                await adminAPI.updateOfficial(off._id, { ...off, name: v });\r\n                              } else {\r\n                                const created = await adminAPI.createOfficial({ ...off, name: v });\r\n                                setOfficials(prev => prev.map(p => p._id === off._id ? created : p));\r\n                              }\r\n                              setManualSaveError(null);\r\n                            } catch (err) {\r\n                              console.error('auto-save failed', err);\r\n                              setManualSaveError('Auto-save failed');\r\n                            } finally {\r\n                              setSavingOfficials(false);\r\n                            }\r\n                          }, 900);\r\n                        }} fullWidth size=\"small\" sx={{ mb: 1 }} variant=\"outlined\" InputLabelProps={{ shrink: true }} />\r\n                        <TextField label=\"Title/Position\" value={off.title} onChange={(e) => {\r\n                          const v = e.target.value;\r\n                          setOfficials(prev => prev.map(o => o._id === off._id ? { ...o, title: v } : o));\r\n                          if (autoSaveTimers.current[off._id || '']) clearTimeout(autoSaveTimers.current[off._id || '']);\r\n                          autoSaveTimers.current[off._id || ''] = window.setTimeout(async () => {\r\n                            try {\r\n                              setSavingOfficials(true);\r\n                              if (off._id && !off._id.toString().startsWith('new-')) {\r\n                                await adminAPI.updateOfficial(off._id, { ...off, title: v });\r\n                              } else {\r\n                                const created = await adminAPI.createOfficial({ ...off, title: v });\r\n                                setOfficials(prev => prev.map(p => p._id === off._id ? created : p));\r\n                              }\r\n                              setManualSaveError(null);\r\n                            } catch (err) {\r\n                              console.error('auto-save failed', err);\r\n                              setManualSaveError('Auto-save failed');\r\n                            } finally {\r\n                              setSavingOfficials(false);\r\n                            }\r\n                          }, 900);\r\n                        }} fullWidth size=\"small\" sx={{ mb: 1 }} variant=\"outlined\" InputLabelProps={{ shrink: true }} />\r\n                        <TextField label=\"Term\" value={off.term} onChange={(e) => {\r\n                          const v = e.target.value;\r\n                          setOfficials(prev => prev.map(o => o._id === off._id ? { ...o, term: v } : o));\r\n                          if (autoSaveTimers.current[off._id || '']) clearTimeout(autoSaveTimers.current[off._id || '']);\r\n                          autoSaveTimers.current[off._id || ''] = window.setTimeout(async () => {\r\n                            try {\r\n                              setSavingOfficials(true);\r\n                              if (off._id && !off._id.toString().startsWith('new-')) {\r\n                                await adminAPI.updateOfficial(off._id, { ...off, term: v });\r\n                              } else {\r\n                                const created = await adminAPI.createOfficial({ ...off, term: v });\r\n                                setOfficials(prev => prev.map(p => p._id === off._id ? created : p));\r\n                              }\r\n                              setManualSaveError(null);\r\n                            } catch (err) {\r\n                              console.error('auto-save failed', err);\r\n                              setManualSaveError('Auto-save failed');\r\n                            } finally {\r\n                              setSavingOfficials(false);\r\n                            }\r\n                          }, 900);\r\n                        }} fullWidth size=\"small\" variant=\"outlined\" InputLabelProps={{ shrink: true }} />\r\n                        <Box sx={{ display: 'flex', gap: 1, mt: 1 }}>\r\n                          <AntdUpload showUploadList={false} beforeUpload={(file) => {\r\n                            // Client-side file size limit: 2MB (match server multer limit)\r\n                            const MAX_BYTES = 2 * 1024 * 1024;\r\n                            if (file.size > MAX_BYTES) {\r\n                              antdMessage.warning('File is too large. Maximum allowed size is 2 MB.');\r\n                              return false;\r\n                            }\r\n                            // create local preview immediately\r\n                            try {\r\n                              const url = URL.createObjectURL(file);\r\n                              previewUrlsRef.current[off._id || `temp-${Date.now()}`] = url;\r\n                              setOfficials(prev => prev.map(o => o._id === off._id ? { ...o, previewUrl: url } : o));\r\n                            } catch (e) {}\r\n\r\n                            // upload file\r\n                            (async () => {\r\n                              try {\r\n                                if (!off._id || off._id.toString().startsWith('new-')) {\r\n                                  antdMessage.warning('Please save official first by entering name/title/term');\r\n                                  return;\r\n                                }\r\n                                await adminAPI.uploadOfficialPhoto(off._id, file as File);\r\n                                // refresh list\r\n                                const refreshed = await adminAPI.getOfficials();\r\n                                setOfficials(Array.isArray(refreshed) ? refreshed : officials);\r\n                                antdMessage.success('Photo uploaded');\r\n                                // revoke preview for this official if any\r\n                                try {\r\n                                  const key = off._id || '';\r\n                                  const u = previewUrlsRef.current[key];\r\n                                  if (u) { URL.revokeObjectURL(u); delete previewUrlsRef.current[key]; }\r\n                                } catch (e) {}\r\n                              } catch (err) {\r\n                                console.error('upload failed', err);\r\n                                antdMessage.error('Upload failed');\r\n                              }\r\n                            })();\r\n                            return false; }}>\r\n\r\n                            <Button startIcon={<UploadOutlined />}>Upload Photo</Button>\r\n                          </AntdUpload>\r\n                          <Button color=\"error\" startIcon={<DeleteOutlined />} onClick={() => {\r\n                            if (off._id && !off._id.toString().startsWith('new-')) {\r\n                              handleDeleteOfficial(off._id);\r\n                            } else {\r\n                              setOfficials(prev => prev.filter(p => p._id !== off._id));\r\n                            }\r\n                          }}>Delete</Button>\r\n                        </Box>\r\n                      </Box>\r\n                    </Paper>\r\n                  ))}\r\n                </Box>\r\n              )}\r\n            </Box>\r\n          </Box>\r\n\r\n            <Box sx={{ width: { xs: '100%', md: 360 }, position: { xs: 'relative', md: 'sticky' }, top: { md: 24 }, alignSelf: 'flex-start', mt: { xs: 2, md: 0 } }}>\r\n              <Typography variant=\"body2\" sx={{ mb: 1 }}>Officials Preview</Typography>\r\n              <Box sx={{ background: 'white', borderRadius: 2, p: 2 }}>\r\n                {officials.length === 0 ? (\r\n                  <Typography variant=\"body2\" color=\"text.secondary\">No officials to preview</Typography>\r\n                ) : (\r\n                  (() => {\r\n                    const stable = officials.filter(o => !(o._id && o._id.toString().startsWith('new-')));\r\n                    const newly = officials.filter(o => o._id && o._id.toString().startsWith('new-'));\r\n                    const previewOrder = [...stable, ...newly];\r\n                    return (\r\n                      <div\r\n                        ref={previewContainerRef}\r\n                        style={{ display: 'flex', gap: 12, overflowX: 'auto', padding: '6px 4px', scrollSnapType: 'x mandatory' }}\r\n                        aria-label=\"Officials preview\"\r\n                      >\r\n                        {previewOrder.map(off => {\r\n                          const id = off._id || '';\r\n                          const isHighlighted = highlightedIds.includes(id);\r\n                          return (\r\n                            <div\r\n                              key={id || Math.random()}\r\n                              style={{\r\n                                minWidth: 140,\r\n                                textAlign: 'center',\r\n                                padding: 8,\r\n                                scrollSnapAlign: 'center' as const,\r\n                                transition: 'box-shadow .25s, transform .18s',\r\n                                boxShadow: isHighlighted ? '0 10px 30px rgba(25,118,210,0.18)' : undefined,\r\n                                transform: isHighlighted ? 'translateY(-4px)' : undefined,\r\n                                borderRadius: 8,\r\n                                background: isHighlighted ? 'linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,255,0.98))' : undefined,\r\n                                flex: '0 0 auto'\r\n                              }}\r\n                            >\r\n                              <Avatar size={80} src={getOfficialPhotoSrc(off as any)} style={{ margin: '0 auto', boxShadow: '0 6px 18px rgba(0,0,0,0.06)' }} />\r\n                              <div style={{ marginTop: 8 }}>\r\n                                <div style={{ fontWeight: 600, fontSize: 14 }}>{off.name || ''}</div>\r\n                                <div style={{ color: '#888', fontSize: 12 }}>{off.title}</div>\r\n                                <div style={{ color: '#888', fontSize: 12 }}>{off.term}</div>\r\n                              </div>\r\n                            </div>\r\n                          );\r\n                        })}\r\n                      </div>\r\n                    );\r\n                  })()\r\n                )}\r\n              </Box>\r\n            </Box>\r\n          </Box>\r\n\r\n          {/* Manual Save handled via floating action button  errors still shown inline */}\r\n          {manualSaveError && <Typography color=\"error\" sx={{ mt: 1 }}>{manualSaveError}</Typography>}\r\n\r\n        {/* Contact Information */}\r\n        <Typography variant=\"subtitle1\" gutterBottom>\r\n          Contact Information\r\n        </Typography>\r\n        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2, mb: 3 }}>\r\n          <TextField\r\n            label=\"Contact Email\"\r\n            type=\"email\"\r\n            value={settings.contactEmail}\r\n            onChange={(e) => setSettings({ ...settings, contactEmail: e.target.value })}\r\n            variant=\"outlined\"\r\n            InputLabelProps={{ shrink: true }}\r\n            fullWidth\r\n          />\r\n          <TextField\r\n            label=\"Contact Phone\"\r\n            value={settings.contactPhone}\r\n            onChange={(e) => setSettings({ ...settings, contactPhone: e.target.value })}\r\n            variant=\"outlined\"\r\n            InputLabelProps={{ shrink: true }}\r\n            fullWidth\r\n          />\r\n        </Box>\r\n\r\n        <Divider sx={{ my: 3 }} />\r\n\r\n        {/* System Configuration */}\r\n        <Typography variant=\"subtitle1\" gutterBottom>\r\n          System Configuration\r\n        </Typography>\r\n        <Box sx={{ display: 'flex', flexDirection: 'column', gap: 2, mb: 3 }}>\r\n          <FormControlLabel\r\n            control={\r\n              <Switch\r\n                checked={settings.maintainanceMode}\r\n                onChange={(e) => setSettings({ ...settings, maintainanceMode: e.target.checked })}\r\n              />\r\n            }\r\n            label=\"Maintenance Mode\"\r\n          />\r\n          <FormControlLabel\r\n            control={\r\n              <Switch\r\n                checked={settings.allowNewRegistrations}\r\n                onChange={(e) => setSettings({ ...settings, allowNewRegistrations: e.target.checked })}\r\n              />\r\n            }\r\n            label=\"Allow New Registrations\"\r\n          />\r\n          {/* Allow multiple accounts per IP toggle and limit */}\r\n          <Box>\r\n            <FormControlLabel\r\n              control={\r\n                <Switch\r\n                  checked={(settings as any).allowMultipleAccountsPerIP}\r\n                  onChange={(e) => setSettings({ ...settings, allowMultipleAccountsPerIP: e.target.checked } as SystemSettings)}\r\n                />\r\n              }\r\n              label=\"Allow multiple accounts per IP\"\r\n            />\r\n            <Box sx={{ mt: 1, ml: 4, display: 'flex', alignItems: 'center', gap: 2 }}>\r\n              <TextField\r\n                label=\"Max accounts per IP\"\r\n                type=\"number\"\r\n                size=\"small\"\r\n                value={(settings as any).maxAccountsPerIP ?? 1}\r\n                onChange={(e) => setSettings({ ...settings, maxAccountsPerIP: parseInt(e.target.value || '1') } as SystemSettings)}\r\n                variant=\"outlined\"\r\n                InputLabelProps={{ shrink: true }}\r\n                inputProps={{ min: 1, max: 100 }}\r\n                sx={{ width: 140 }}\r\n              />\r\n              <Typography variant=\"caption\" color=\"text.secondary\">\r\n                Current limit: {(settings as any).maxAccountsPerIP ?? 1}\r\n              </Typography>\r\n            </Box>\r\n          </Box>\r\n          <FormControlLabel\r\n            control={\r\n              <Switch\r\n                checked={settings.requireEmailVerification}\r\n                onChange={(e) => setSettings({ ...settings, requireEmailVerification: e.target.checked })}\r\n              />\r\n            }\r\n            label=\"Require Email Verification\"\r\n          />\r\n          <TextField\r\n            label=\"Maximum Document Requests per User\"\r\n            type=\"number\"\r\n            value={settings.maxDocumentRequests}\r\n            onChange={(e) => setSettings({ ...settings, maxDocumentRequests: parseInt(e.target.value) })}\r\n            variant=\"outlined\"\r\n            InputLabelProps={{ shrink: true }}\r\n            inputProps={{ min: 1, max: 20 }}\r\n          />\r\n          <TextField\r\n            label=\"Document Processing Days\"\r\n            type=\"number\"\r\n            value={settings.documentProcessingDays}\r\n            onChange={(e) => setSettings({ ...settings, documentProcessingDays: parseInt(e.target.value) })}\r\n            variant=\"outlined\"\r\n            InputLabelProps={{ shrink: true }}\r\n            inputProps={{ min: 1, max: 30 }}\r\n            helperText=\"Standard number of days to process document requests\"\r\n          />\r\n        </Box>\r\n\r\n        <Divider sx={{ my: 3 }} />\r\n\r\n        {/* System Notice */}\r\n        <Typography variant=\"subtitle1\" gutterBottom>\r\n          System Notice\r\n        </Typography>\r\n        <Box sx={{ mb: 3 }}>\r\n          <TextField\r\n            label=\"System-wide Notice\"\r\n            value={settings.systemNotice}\r\n            onChange={(e) => setSettings({ ...settings, systemNotice: e.target.value })}\r\n            variant=\"outlined\"\r\n            InputLabelProps={{ shrink: true }}\r\n            fullWidth\r\n            multiline\r\n            rows={3}\r\n            helperText=\"This notice will be displayed to all users\"\r\n          />\r\n        </Box>\r\n\r\n        {/* Save button relocated to floating action button */}\r\n\r\n        {/* Floating Manual Save button (bottom-right) */}\r\n        <Box sx={{\r\n          position: 'fixed',\r\n          right: 24,\r\n          bottom: 24,\r\n          zIndex: 1300,\r\n        }}>\r\n          <Button\r\n            variant=\"contained\"\r\n            onClick={() => saveAll()}\r\n            disabled={saving || savingOfficials}\r\n            sx={{\r\n              width: 64,\r\n              height: 64,\r\n              borderRadius: '50%',\r\n              minWidth: 64,\r\n              boxShadow: '0 8px 24px rgba(25,118,210,0.24)',\r\n              backgroundColor: '#1976d2',\r\n              color: '#fff',\r\n              '&:hover': {\r\n                boxShadow: '0 12px 32px rgba(25,118,210,0.32)',\r\n                backgroundColor: '#1565c0',\r\n              },\r\n              display: 'flex',\r\n              alignItems: 'center',\r\n              justifyContent: 'center',\r\n              fontWeight: 600,\r\n            }}\r\n            aria-label=\"Save Settings and Officials\"\r\n          >\r\n            {(saving || savingOfficials) ? '...' : 'Save'}\r\n          </Button>\r\n        </Box>\r\n      </Paper>\r\n    </Box>\r\n  );\r\n};\r\n\r\nexport default SystemSettings;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { documentsAPI } from '../services/api';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { \r\n  FileWordOutlined, \r\n  SearchOutlined, \r\n  FilterOutlined, \r\n  SortAscendingOutlined,\r\n  MoreOutlined,\r\n  UploadOutlined,\r\n  EyeOutlined,\r\n  DownloadOutlined,\r\n  DeleteOutlined\r\n} from '@ant-design/icons';\r\nimport { \r\n  Card, \r\n  Row, \r\n  Col, \r\n  Typography, \r\n  Input, \r\n  Select, \r\n  Dropdown, \r\n  Button, \r\n  Space,\r\n  Breadcrumb,\r\n  Menu,\r\n  message,\r\n  Modal,\r\n  Form,\r\n  Empty,\r\n  DatePicker,\r\n  Upload\r\n} from 'antd';\r\n// upload icon already imported above\r\n\r\nconst { Title, Text } = Typography;\r\nconst { Search } = Input;\r\n\r\ninterface FormValues {\r\n  purpose: string;\r\n  // fields may contain strings or date objects (dayjs) before serialization\r\n  fields: Record<string, any>;\r\n}\r\n\r\ninterface FileData {\r\n  _id: string;\r\n  filename: string;\r\n  length: number;\r\n  uploadDate: string;\r\n  category?: string;\r\n}\r\n\r\nconst DocumentRequestForm: React.FC = () => {\r\n  // State management\r\n  const [files, setFiles] = useState<FileData[]>([]);\r\n  const [selectedFields, setSelectedFields] = useState<string[]>([]);\r\n  const [modalOpen, setModalOpen] = useState(false);\r\n  const [modalDocName, setModalDocName] = useState('');\r\n  const [fieldValues, setFieldValues] = useState<Record<string, string>>({});\r\n  const [purpose, setPurpose] = useState('');\r\n  const [searchTerm, setSearchTerm] = useState('');\r\n  const [selectedCategory, setSelectedCategory] = useState('all');\r\n  const [sortBy, setSortBy] = useState<'name' | 'date' | 'type'>('name');\r\n  const [loading, setLoading] = useState(false);\r\n  const [submitLoading, setSubmitLoading] = useState(false);\r\n  const [lastRequestId, setLastRequestId] = useState<string | null>(null);\r\n  const [verificationModalOpen, setVerificationModalOpen] = useState(false);\r\n  const [uploadList, setUploadList] = useState<any[]>([]);\r\n  const { user: authUser, setUser } = useAuth();\r\n\r\n  useEffect(() => {\r\n    const fetchFiles = async () => {\r\n      setLoading(true);\r\n      try {\r\n        const data = await documentsAPI.listFiles();\r\n        setFiles(data);\r\n      } catch (error) {\r\n        message.error('Failed to fetch document templates');\r\n        setFiles([]);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchFiles();\r\n  }, []);\r\n\r\n  const handleCardClick = async (file: FileData) => {\r\n    const currentUser = authUser || (() => {\r\n      try { const stored = localStorage.getItem('userProfile'); return stored ? JSON.parse(stored) : null; } catch { return null; }\r\n    })();\r\n    // If resident and not verified, prompt verification upload\r\n    if (currentUser && currentUser.role === 'resident' && !currentUser.verified) {\r\n      setVerificationModalOpen(true);\r\n      return;\r\n    }\r\n    setModalDocName(file.filename.replace(/\\.docx$/i, ''));\r\n    try {\r\n      const api = await import('../services/api');\r\n      const res = await api.axiosPublic.get(`/documents/preview/${file._id}`, { params: { format: 'html' }, responseType: 'text' });\r\n      const html = res && res.data ? res.data : '';\r\n      const regex = /\\{(.*?)\\}/g;\r\n      const fields: string[] = [];\r\n      let match;\r\n      while ((match = regex.exec(html)) !== null) {\r\n        fields.push(match[1].trim());\r\n      }\r\n      // Hide QR field from the request form  it is generated server-side\r\n      const visibleFields = fields.filter(f => f && f.toLowerCase() !== 'qr');\r\n      setSelectedFields(visibleFields);\r\n      const initialValues: Record<string, string> = {};\r\n      // compute current date parts\r\n      const now = new Date();\r\n      const day = now.getDate();\r\n      const monthNum = now.getMonth() + 1;\r\n      const monthName = now.toLocaleString(undefined, { month: 'long' });\r\n      const year = now.getFullYear();\r\n      const mm = String(monthNum).padStart(2, '0');\r\n      const dd = String(day).padStart(2, '0');\r\n      const currentDateFormatted = `${mm}/${dd}/${year}`;\r\n\r\n      visibleFields.forEach(f => {\r\n        // default empty\r\n        initialValues[f] = '';\r\n        // auto-fill common \"current\" fields\r\n        if (/^current(day|dayof)?$/i.test(f) || /currentday/i.test(f)) {\r\n          initialValues[f] = String(day);\r\n        } else if (/current(month)?$/i.test(f) || /currentmonth/i.test(f)) {\r\n          // put human-readable month name\r\n          initialValues[f] = monthName;\r\n        } else if (/current(year)?$/i.test(f) || /currentyear/i.test(f)) {\r\n          initialValues[f] = String(year);\r\n        } else if (/currentdate|current_date|current date|dateofrequest|requesteddate/i.test(f)) {\r\n          // unified date field\r\n          initialValues[f] = currentDateFormatted;\r\n        }\r\n      });\r\n      setFieldValues(initialValues);\r\n      setModalOpen(true);\r\n    } catch (error) {\r\n      message.error('Failed to load document preview');\r\n      setSelectedFields([]);\r\n      setFieldValues({});\r\n    }\r\n  };\r\n\r\n  // Upload verification IDs\r\n  const handleUploadSubmit = async () => {\r\n    if (uploadList.length < 1) {\r\n      message.warning('Please select at least one ID to upload');\r\n      return;\r\n    }\r\n    const form = new FormData();\r\n    uploadList.slice(0, 2).forEach((f, idx) => form.append('ids', f.originFileObj || f));\r\n    try {\r\n      const api = await import('../services/api');\r\n      const res = await api.axiosInstance.post('/verification/upload', form, { headers: { 'Content-Type': 'multipart/form-data' } });\r\n      const data = res && res.data ? res.data : null;\r\n      message.success('Verification documents uploaded. Admin will review shortly.');\r\n      setVerificationModalOpen(false);\r\n      // Optionally refresh user profile from server so verified flag may be updated later\r\n      try {\r\n        const { authService } = await import('../services/api');\r\n        const profile = await authService.getCurrentUser();\r\n        if (profile && setUser) setUser(profile as any);\r\n      } catch (e) {\r\n        // ignore\r\n      }\r\n    } catch (err) {\r\n      console.error('Upload error', err);\r\n      message.error('Upload failed');\r\n    }\r\n  };\r\n\r\n  const getActionMenu = (file: FileData) => [\r\n    {\r\n      key: 'view',\r\n      icon: <EyeOutlined />,\r\n      label: 'View'\r\n    },\r\n    {\r\n      key: 'download',\r\n      icon: <DownloadOutlined />,\r\n      label: 'Download'\r\n    },\r\n    {\r\n      key: 'delete',\r\n      icon: <DeleteOutlined />,\r\n      label: 'Delete'\r\n    }\r\n  ];\r\n\r\n  const filteredFiles = files\r\n    .filter(file => {\r\n      const name = file.filename.toLowerCase();\r\n      const search = searchTerm.toLowerCase();\r\n      const categoryMatch = selectedCategory === 'all' || file.category === selectedCategory;\r\n      return name.includes(search) && categoryMatch;\r\n    })\r\n    .sort((a, b) => {\r\n      switch (sortBy) {\r\n        case 'date':\r\n          return new Date(b.uploadDate).getTime() - new Date(a.uploadDate).getTime();\r\n        case 'type':\r\n          return a.filename.split('.').pop()?.localeCompare(b.filename.split('.').pop() || '') || 0;\r\n        default:\r\n          return a.filename.localeCompare(b.filename);\r\n      }\r\n    });\r\n\r\n  return (\r\n    <div style={{ padding: '24px', minHeight: '80vh', background: '#f0f2f5' }}>\r\n      {/* Header Section */}\r\n      <Row justify=\"start\" align=\"middle\" style={{ marginBottom: 24 }}>\r\n        <Col style={{ textAlign: 'left' }}>\r\n          <Breadcrumb style={{ marginBottom: 8 }}>\r\n            <Breadcrumb.Item>Home</Breadcrumb.Item>\r\n            <Breadcrumb.Item>Documents</Breadcrumb.Item>\r\n            <Breadcrumb.Item>Request</Breadcrumb.Item>\r\n          </Breadcrumb>\r\n          <Title level={2} style={{ margin: 0, textAlign: 'left' }}>Request Document</Title>\r\n        </Col>\r\n      </Row>\r\n\r\n      {/* Filters Section */}\r\n      <Row gutter={16} justify=\"center\" style={{ marginBottom: 24 }}>\r\n        <Col xs={24} sm={16} md={10} lg={8}>\r\n          <Search\r\n            placeholder=\"Search documents...\"\r\n            value={searchTerm}\r\n            onChange={e => setSearchTerm(e.target.value)}\r\n            style={{ width: '100%' }}\r\n          />\r\n        </Col>\r\n        <Col xs={24} sm={16} md={10} lg={8}>\r\n          <Space>\r\n            <Select\r\n              defaultValue=\"all\"\r\n              style={{ width: 220 }}\r\n              onChange={value => setSelectedCategory(value)}\r\n            >\r\n              <Select.Option value=\"all\">All Categories</Select.Option>\r\n              <Select.Option value=\"personal\">Personal Documents</Select.Option>\r\n              <Select.Option value=\"business\">Business Documents</Select.Option>\r\n              <Select.Option value=\"certificates\">Certificates</Select.Option>\r\n            </Select>\r\n            <Select\r\n              defaultValue=\"name\"\r\n              style={{ width: 160 }}\r\n              onChange={value => setSortBy(value as 'name' | 'date' | 'type')}\r\n            >\r\n              <Select.Option value=\"name\">Sort by Name</Select.Option>\r\n              <Select.Option value=\"date\">Sort by Date</Select.Option>\r\n              <Select.Option value=\"type\">Sort by Type</Select.Option>\r\n            </Select>\r\n          </Space>\r\n        </Col>\r\n      </Row>\r\n\r\n      {/* Documents Grid */}\r\n      <Row gutter={[16, 16]}>\r\n        {loading ? (\r\n          <Col span={24} style={{ textAlign: 'center', padding: '40px' }}>\r\n            Loading documents...\r\n          </Col>\r\n        ) : filteredFiles.length === 0 ? (\r\n          <Col span={24} style={{ textAlign: 'center', padding: '40px' }}>\r\n            No documents found\r\n          </Col>\r\n        ) : (\r\n          filteredFiles.map((file) => (\r\n            <Col xs={24} sm={12} md={8} lg={6} key={file._id}>\r\n              <Card\r\n                hoverable\r\n                style={{ \r\n                  transition: 'all 0.3s ease',\r\n                  borderRadius: 8\r\n                }}\r\n                bodyStyle={{ padding: 16 }}\r\n                onClick={() => handleCardClick(file)}\r\n              >\r\n                <div style={{ display: 'flex', alignItems: 'flex-start', marginBottom: 12 }}>\r\n                  <FileWordOutlined style={{ fontSize: 24, color: '#1890ff', marginRight: 12, marginTop: 4 }} />\r\n                  <div style={{ flex: 1, minWidth: 0 }}>\r\n                    <Text strong style={{ \r\n                      display: 'block',\r\n                      overflow: 'hidden',\r\n                      textOverflow: 'ellipsis',\r\n                      whiteSpace: 'nowrap'\r\n                    }}>\r\n                      {file.filename.replace(/\\.docx$/i, '')}\r\n                    </Text>\r\n                    <Text type=\"secondary\" style={{ fontSize: 12 }}>\r\n                      {new Date(file.uploadDate).toLocaleDateString()}  {Math.round(file.length / 1024)} KB\r\n                    </Text>\r\n                  </div>\r\n                  <Dropdown menu={{ items: getActionMenu(file) }} trigger={['click']}>\r\n                    <Button type=\"text\" icon={<MoreOutlined />} onClick={e => e.stopPropagation()} />\r\n                  </Dropdown>\r\n                </div>\r\n              </Card>\r\n            </Col>\r\n          ))\r\n        )}\r\n      </Row>\r\n\r\n      {/* Document Request Modal */}\r\n      <Modal\r\n        open={modalOpen}\r\n        onCancel={() => setModalOpen(false)}\r\n        width={800}\r\n        footer={null}\r\n      >\r\n        {selectedFields.length === 0 ? (\r\n          <Empty description=\"No fields found in this template\" />\r\n        ) : (\r\n          <Form\r\n            layout=\"vertical\"\r\n            initialValues={{ fields: fieldValues }}\r\n            onFinish={async (values: FormValues) => {\r\n              setSubmitLoading(true);\r\n              try {\r\n                // convert any dayjs/date picker values to MM/DD/YYYY strings\r\n                const processedFields: Record<string, any> = { ...values.fields };\r\n                Object.entries(processedFields).forEach(([k, v]) => {\r\n                  // dayjs/date-picker values have a `format` function\r\n                  if (v && typeof (v as any).format === 'function') {\r\n                    // format to MM/DD/YYYY for consistency with UI\r\n                    try {\r\n                      processedFields[k] = (v as any).format('MM/DD/YYYY');\r\n                    } catch (e) {\r\n                      processedFields[k] = String(v);\r\n                    }\r\n                  }\r\n                });\r\n\r\n                const payload = {\r\n                  type: modalDocName,\r\n                  documentType: modalDocName,\r\n                  purpose: values.purpose,\r\n                  fileId: files.find((f) => f.filename.replace(/\\.docx$/i, '') === modalDocName)?._id,\r\n                  fieldValues: processedFields\r\n                };\r\n                const result = await documentsAPI.requestDocument(payload);\r\n                message.success('Request submitted successfully!');\r\n                setLastRequestId(result?.documentRequest?._id || result?._id || null);\r\n                setModalOpen(false);\r\n              } catch (err) {\r\n                message.error('Failed to submit request.');\r\n              } finally {\r\n                setSubmitLoading(false);\r\n              }\r\n            }}\r\n          >\r\n            <Row gutter={[16, 16]}>\r\n              <Col span={24}>\r\n                <Form.Item\r\n                  name=\"purpose\"\r\n                  label=\"Purpose\"\r\n                  rules={[{ required: true, message: 'Please enter the purpose' }]}\r\n                >\r\n                  <Input.TextArea rows={4} placeholder=\"Enter the purpose of your request\" />\r\n                </Form.Item>\r\n              </Col>\r\n              \r\n              {selectedFields.map((field, idx) => (\r\n                <Col xs={24} sm={12} key={idx}>\r\n                  <Form.Item\r\n                    name={['fields', field]}\r\n                    label={field}\r\n                    rules={[{ required: true, message: `Please enter ${field}` }]}\r\n                  >\r\n                    {\r\n                      // If the field name looks like a date (contains 'date', 'dob', 'birth', or 'issued'), show a calendar picker\r\n                      /date|dob|birth|issued/i.test(field)\r\n                        ? <DatePicker style={{ width: '100%' }} format=\"MM/DD/YYYY\" />\r\n                        : <Input placeholder={`Enter ${field}`} />\r\n                    }\r\n                  </Form.Item>\r\n                </Col>\r\n              ))}\r\n              \r\n              <Col span={24} style={{ textAlign: 'right' }}>\r\n                <Space>\r\n                  <Button onClick={() => setModalOpen(false)}>\r\n                    Cancel\r\n                  </Button>\r\n                  <Button type=\"primary\" htmlType=\"submit\" loading={submitLoading}>\r\n                    Submit Request\r\n                  </Button>\r\n                </Space>\r\n              </Col>\r\n            </Row>\r\n          </Form>\r\n        )}\r\n      </Modal>\r\n      {/* Verification Upload Modal for unverified residents */}\r\n      <Modal\r\n        title=\"Account Verification\"\r\n        open={verificationModalOpen}\r\n        onCancel={() => setVerificationModalOpen(false)}\r\n        onOk={handleUploadSubmit}\r\n        okText=\"Upload\"\r\n        width={600}\r\n      >\r\n        <p>Please upload up to two valid government IDs to verify your account. Admin will review and approve.</p>\r\n        <Upload\r\n          multiple\r\n          accept=\"image/*,application/pdf\"\r\n          beforeUpload={() => false}\r\n          fileList={uploadList as any}\r\n          onChange={({ fileList: newList }) => setUploadList(newList)}\r\n          maxCount={2}\r\n        >\r\n          <Button icon={<UploadOutlined />}>Select ID files (max 2)</Button>\r\n        </Upload>\r\n      </Modal>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DocumentRequestForm;","import React, { useState } from 'react';\r\nimport {\r\n  Form,\r\n  Select,\r\n  Input,\r\n  Button,\r\n  Typography,\r\n  message as antdMessage,\r\n  Card,\r\n  Alert,\r\n  Upload,\r\n  Row,\r\n  Col,\r\n  Steps,\r\n  Tooltip,\r\n  Modal,\r\n  Descriptions,\r\n} from 'antd';\r\nimport { UploadOutlined, InfoCircleOutlined, SendOutlined, ReloadOutlined, MailOutlined } from '@ant-design/icons';\r\nimport './InquiryForm.css';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { contactAPI } from '../services/api';\r\n\r\nconst { TextArea } = Input;\r\n\r\n// We will use grouped options for the Inquiry Type select\r\nconst inquiryTypeGroups = [\r\n  {\r\n    label: 'Requests',\r\n    options: [\r\n      { value: 'DOCUMENT_REQUEST', label: 'Document Request' },\r\n      { value: 'SCHEDULE_APPOINTMENT', label: 'Schedule Appointment' },\r\n      { value: 'CERTIFICATE_REQUEST', label: 'Certificate Request' },\r\n    ],\r\n  },\r\n  {\r\n    label: 'Concerns',\r\n    options: [\r\n      { value: 'COMPLAINT', label: 'Complaint' },\r\n      { value: 'ASSISTANCE', label: 'Assistance' },\r\n    ],\r\n  },\r\n];\r\n\r\nconst InquiryForm: React.FC = () => {\r\n  const { user } = useAuth();\r\n  const [loading, setLoading] = useState(false);\r\n  const [showSuccess, setShowSuccess] = useState(false);\r\n  const [form] = Form.useForm();\r\n  const [subjectCount, setSubjectCount] = React.useState(0);\r\n  const [messageCount, setMessageCount] = React.useState(0);\r\n  const SUBJECT_MAX = 100;\r\n  const MESSAGE_MAX = 500;\r\n  const [currentStep, setCurrentStep] = React.useState(0);\r\n  const [fileListState, setFileListState] = React.useState<any[]>([]);\r\n  const [previewModalVisible, setPreviewModalVisible] = React.useState(false);\r\n  const [previewValues, setPreviewValues] = React.useState<any>(null);\r\n  const LOCALSTORAGE_KEY = 'inquiryFormDraft_v1';\r\n\r\n  // Load draft from localStorage on mount\r\n  React.useEffect(() => {\r\n    try {\r\n      const raw = localStorage.getItem(LOCALSTORAGE_KEY);\r\n      if (raw) {\r\n        const parsed = JSON.parse(raw);\r\n        if (parsed) {\r\n          const { type, assignedRole, subject, message, attachments } = parsed;\r\n          form.setFieldsValue({ type, assignedRole, subject, message });\r\n          if (subject) setSubjectCount(subject.length);\r\n          if (message) setMessageCount(message.length);\r\n          if (attachments && Array.isArray(attachments) && attachments.length) {\r\n            // create placeholder file entries (no preview available)\r\n            const restored = attachments.map((name: string, idx: number) => ({ uid: `restored-${idx}`, name }));\r\n            setFileListState(restored);\r\n            form.setFieldsValue({ attachment: restored });\r\n          }\r\n          // set step based on restored values\r\n          if (subject && message && (assignedRole || type)) setCurrentStep(2);\r\n          else if (attachments && attachments.length) setCurrentStep(1);\r\n          else setCurrentStep(0);\r\n        }\r\n      }\r\n    } catch (err) {\r\n      // ignore parse errors\r\n      console.warn('Failed to load inquiry draft', err);\r\n    }\r\n  }, []);\r\n\r\n  // Autosave draft every 5 seconds\r\n  React.useEffect(() => {\r\n    const saveDraft = () => {\r\n      try {\r\n        const values = form.getFieldsValue(true);\r\n        const draft = {\r\n          type: values.type || null,\r\n          assignedRole: values.assignedRole || null,\r\n          subject: values.subject || '',\r\n          message: values.message || '',\r\n          attachments: (fileListState || []).map((f: any) => f.name || (f.originFileObj && f.originFileObj.name) || ''),\r\n          updatedAt: new Date().toISOString(),\r\n        };\r\n        localStorage.setItem(LOCALSTORAGE_KEY, JSON.stringify(draft));\r\n      } catch (err) {\r\n        console.warn('Failed to save draft', err);\r\n      }\r\n    };\r\n\r\n    const id = setInterval(saveDraft, 5000);\r\n    // also save on unload\r\n    const onUnload = () => saveDraft();\r\n    window.addEventListener('beforeunload', onUnload);\r\n    return () => {\r\n      clearInterval(id);\r\n      window.removeEventListener('beforeunload', onUnload);\r\n      // final save\r\n      try {\r\n        const values = form.getFieldsValue(true);\r\n        const draft = {\r\n          type: values.type || null,\r\n          assignedRole: values.assignedRole || null,\r\n          subject: values.subject || '',\r\n          message: values.message || '',\r\n          attachments: (fileListState || []).map((f: any) => f.name || (f.originFileObj && f.originFileObj.name) || ''),\r\n          updatedAt: new Date().toISOString(),\r\n        };\r\n        localStorage.setItem(LOCALSTORAGE_KEY, JSON.stringify(draft));\r\n      } catch (err) {\r\n        // ignore\r\n      }\r\n    };\r\n  }, [fileListState]);\r\n\r\n  const formatBytes = (bytes: number) => {\r\n    if (bytes === 0) return '0 B';\r\n    const k = 1024;\r\n    const sizes = ['B', 'KB', 'MB', 'GB'];\r\n    const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n    return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];\r\n  };\r\n\r\n  const onFinish = async (values: any) => {\r\n    setLoading(true);\r\n    setShowSuccess(false);\r\n    try {\r\n      // Extract uploaded files if any and send as multipart/form-data\r\n      let files: any[] = [];\r\n      if (values.attachment) {\r\n        if (Array.isArray(values.attachment)) files = values.attachment;\r\n        else if (values.attachment.fileList && Array.isArray(values.attachment.fileList)) files = values.attachment.fileList;\r\n      }\r\n      const formData = new FormData();\r\n      formData.append('type', values.type || '');\r\n      formData.append('subject', values.subject || '');\r\n      formData.append('message', values.message || '');\r\n      formData.append('assignedRole', values.assignedRole || 'staff');\r\n      formData.append('username', user?.username || '');\r\n      formData.append('barangayID', user?.barangayID || '');\r\n      if (values.assignedTo && Array.isArray(values.assignedTo)) {\r\n        for (const id of values.assignedTo) formData.append('assignedTo[]', id);\r\n      }\r\n      // Append each file's originFileObj (Upload component stores the file under originFileObj)\r\n      for (const f of files) {\r\n        if (f.originFileObj) formData.append('attachments', f.originFileObj, f.name || (f.originFileObj && f.originFileObj.name));\r\n      }\r\n\r\n      await contactAPI.submitInquiry(formData);\r\n\r\n      setShowSuccess(true);\r\n      form.resetFields();\r\n      setFileListState([]);\r\n      localStorage.removeItem(LOCALSTORAGE_KEY);\r\n      antdMessage.success('Your inquiry has been submitted!');\r\n    } catch (err) {\r\n      console.error(err);\r\n      antdMessage.error('Failed to submit inquiry.');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const onFinishFailed = (_errorInfo: any) => {\r\n    antdMessage.error('Please complete all required fields');\r\n  };\r\n\r\n  // Simple beforeUpload to prevent automatic upload  we keep files in form state\r\n  const beforeUpload = (file: File) => {\r\n    const isAllowed = file.size / 1024 / 1024 < 5; // < 5MB\r\n    if (!isAllowed) antdMessage.error('File must be smaller than 5MB');\r\n    return false; // prevent auto upload\r\n  };\r\n\r\n  return (\r\n    <div style={{ maxWidth: 900, margin: '32px auto', padding: '0 12px' }}>\r\n      <Card\r\n        style={{ borderRadius: 18, boxShadow: '0 4px 24px 0 rgba(64,201,255,0.10)', padding: 0, background: '#fff' }}\r\n        headStyle={{\r\n          borderRadius: '18px 18px 0 0',\r\n          background: 'linear-gradient(90deg, rgba(64,169,255,0.08) 0%, rgba(146,84,222,0.06) 100%)',\r\n          padding: '16px 24px',\r\n        }}\r\n        bodyStyle={{ padding: 24 }}\r\n        bordered={false}\r\n        title={\r\n          <div style={{ display: 'flex', alignItems: 'center', gap: 12 }}>\r\n            <MailOutlined style={{ fontSize: 28, color: '#1890ff' }} />\r\n            <div style={{ lineHeight: 1 }}>\r\n              <Typography.Title level={4} style={{ margin: 0, color: '#1890ff', fontWeight: 700, fontFamily: 'Poppins, Arial, sans-serif' }}>\r\n                Submit an Inquiry\r\n              </Typography.Title>\r\n              <div style={{ fontSize: 12, color: '#6c757d', marginTop: 4 }}>\r\n                Fill out the form below and our staff will get back to you.\r\n              </div>\r\n            </div>\r\n          </div>\r\n        }\r\n      >\r\n        {showSuccess && (\r\n          <Alert\r\n            type=\"success\"\r\n            showIcon\r\n            message={<span style={{ fontWeight: 600 }}><span role=\"img\" aria-label=\"success\"></span> Your inquiry has been submitted!</span>}\r\n            style={{ marginBottom: 16, borderRadius: 8 }}\r\n            banner\r\n          />\r\n        )}\r\n\r\n        <Form\r\n          form={form}\r\n          layout=\"vertical\"\r\n          onFinish={onFinish}\r\n          onFinishFailed={onFinishFailed}\r\n          autoComplete=\"off\"\r\n          onFieldsChange={() => showSuccess && setShowSuccess(false)}\r\n          onValuesChange={(_, allValues) => {\r\n            // Determine step: 0 = Details (type/subject), 1 = Attachments (attachments added), 2 = Review\r\n            if (allValues && (allValues.attachment && allValues.attachment.length > 0)) {\r\n              setCurrentStep(1);\r\n            } else if (allValues && allValues.message && allValues.message.length > 0) {\r\n              setCurrentStep(0);\r\n            }\r\n            // If subject, message, and either assigned role exist, go to review step\r\n            if (\r\n              allValues &&\r\n              allValues.subject &&\r\n              allValues.message &&\r\n              (allValues.assignedRole || allValues.type)\r\n            ) {\r\n              setCurrentStep(2);\r\n            }\r\n          }}\r\n        >\r\n          <div style={{ marginBottom: 16 }}>\r\n            <Steps current={currentStep} size=\"small\">\r\n              <Steps.Step title=\"Details\" />\r\n              <Steps.Step title=\"Attachments\" />\r\n              <Steps.Step title=\"Review & Submit\" />\r\n            </Steps>\r\n          </div>\r\n          <Row gutter={16}>\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                name=\"type\"\r\n                label={\r\n                  <span>\r\n                    Inquiry Type <span style={{ color: 'red' }}>*</span>{' '}\r\n                    <Tooltip title=\"Choose the category that best describes your issue.\">\r\n                      <InfoCircleOutlined style={{ marginLeft: 6, color: '#8c8c8c' }} />\r\n                    </Tooltip>\r\n                  </span>\r\n                }\r\n                rules={[{ required: true, message: 'Please select an inquiry type' }]}\r\n              >\r\n                <Select placeholder=\"Select inquiry type\" className=\"inquiry-rounded-input\">\r\n                  {inquiryTypeGroups.map(group => (\r\n                    <Select.OptGroup key={group.label} label={group.label}>\r\n                      {group.options.map(opt => (\r\n                        <Select.Option key={opt.value} value={opt.value}>{opt.label}</Select.Option>\r\n                      ))}\r\n                    </Select.OptGroup>\r\n                  ))}\r\n                </Select>\r\n              </Form.Item>\r\n\r\n              <Form.Item\r\n                name=\"assignedRole\"\r\n                label={\r\n                  <span>\r\n                    Assign to Role <span style={{ color: 'red' }}>*</span>{' '}\r\n                    <Tooltip title=\"Select which role should handle your inquiry.\">\r\n                      <InfoCircleOutlined style={{ marginLeft: 6, color: '#8c8c8c' }} />\r\n                    </Tooltip>\r\n                  </span>\r\n                }\r\n                initialValue=\"staff\"\r\n                rules={[{ required: true, message: 'Please select a role to assign' }]}\r\n              >\r\n                <Select options={[{ value: 'staff', label: 'Staff' }, { value: 'admin', label: 'Admin' }]} placeholder=\"Assign to role\" className=\"inquiry-rounded-input\" />\r\n              </Form.Item>\r\n\r\n              <Form.Item\r\n                name=\"subject\"\r\n                label={\r\n                  <span>\r\n                    Subject <span style={{ color: 'red' }}>*</span>{' '}\r\n                    <Tooltip title=\"Enter a short subject line.\">\r\n                      <InfoCircleOutlined style={{ marginLeft: 6, color: '#8c8c8c' }} />\r\n                    </Tooltip>\r\n                  </span>\r\n                }\r\n                rules={[\r\n                  { required: true, message: 'Please enter a subject' },\r\n                  { min: 5, message: 'Subject must be at least 5 characters' },\r\n                  { max: SUBJECT_MAX, message: `Subject must be at most ${SUBJECT_MAX} characters` },\r\n                ]}\r\n              >\r\n                <div>\r\n                  <Input\r\n                    placeholder=\"Enter subject\"\r\n                    className=\"inquiry-rounded-input\"\r\n                    maxLength={SUBJECT_MAX + 20} // allow typing beyond limit but show error\r\n                    onChange={(e) => setSubjectCount(e.target.value.length)}\r\n                  />\r\n                  <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: 6 }}>\r\n                    <small style={{ color: subjectCount > SUBJECT_MAX ? 'red' : '#8c8c8c' }}>{subjectCount}/{SUBJECT_MAX}</small>\r\n                  </div>\r\n                </div>\r\n              </Form.Item>\r\n            </Col>\r\n\r\n            <Col xs={24} sm={12}>\r\n              <Form.Item\r\n                name=\"message\"\r\n                label={\r\n                  <span>\r\n                    Message <span style={{ color: 'red' }}>*</span>{' '}\r\n                    <Tooltip title=\"Provide details about your inquiry.\">\r\n                      <InfoCircleOutlined style={{ marginLeft: 6, color: '#8c8c8c' }} />\r\n                    </Tooltip>\r\n                  </span>\r\n                }\r\n                rules={[\r\n                  { required: true, message: 'Please enter your message' },\r\n                  { min: 10, message: 'Message must be at least 10 characters' },\r\n                  { max: MESSAGE_MAX, message: `Message must be at most ${MESSAGE_MAX} characters` },\r\n                ]}\r\n              >\r\n                <div>\r\n                  <TextArea\r\n                    rows={4}\r\n                    placeholder=\"Enter your message\"\r\n                    className=\"inquiry-rounded-input inquiry-large-textarea\"\r\n                    maxLength={MESSAGE_MAX + 50}\r\n                    onChange={(e) => setMessageCount(e.target.value.length)}\r\n                  />\r\n                  <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: 6 }}>\r\n                    <small style={{ color: messageCount > MESSAGE_MAX ? 'red' : '#8c8c8c' }}>{messageCount}/{MESSAGE_MAX}</small>\r\n                  </div>\r\n                </div>\r\n              </Form.Item>\r\n\r\n              <Form.Item\r\n                name=\"attachment\"\r\n                label={\r\n                  <span>\r\n                    Attachments{' '}\r\n                    <Tooltip title=\"Attach supporting documents (PDF, JPG, PNG).\">\r\n                      <InfoCircleOutlined style={{ marginLeft: 6, color: '#8c8c8c' }} />\r\n                    </Tooltip>\r\n                  </span>\r\n                }\r\n                valuePropName=\"fileList\"\r\n                getValueFromEvent={(e: any) => (Array.isArray(e) ? e : e && e.fileList)}\r\n                extra=\"Allowed: PDF, JPG, PNG. Max 5MB each.\"\r\n              >\r\n                <Upload.Dragger\r\n                  multiple\r\n                  accept=\".pdf,.jpg,.jpeg,.png\"\r\n                  fileList={fileListState}\r\n                  beforeUpload={() => false}\r\n                  onChange={(info) => {\r\n                    const incoming = info.fileList || [];\r\n                    const nextList: any[] = [];\r\n                    incoming.forEach((f: any) => {\r\n                      const file = f.originFileObj || f;\r\n                      const isAllowedType = ['application/pdf', 'image/jpeg', 'image/png'].includes(file.type) || (file.name && /\\.(pdf|jpe?g|png)$/i.test(file.name));\r\n                      const isLt5M = (file.size || 0) / 1024 / 1024 < 5;\r\n                      if (!isAllowedType) {\r\n                        antdMessage.error(`${file.name} is not a supported file type`);\r\n                        return;\r\n                      }\r\n                      if (!isLt5M) {\r\n                        antdMessage.error(`${file.name} must be smaller than 5MB`);\r\n                        return;\r\n                      }\r\n\r\n                      // create preview for images\r\n                      if (file.type && file.type.startsWith('image/') && !f.url && !f.preview) {\r\n                        try {\r\n                          // originFileObj exists for newly selected files\r\n                          const preview = URL.createObjectURL(file);\r\n                          f.preview = preview;\r\n                        } catch (e) {\r\n                          // ignore\r\n                        }\r\n                      }\r\n\r\n                      nextList.push(f);\r\n                    });\r\n\r\n                    setFileListState(nextList);\r\n                    // sync with form value\r\n                    form.setFieldsValue({ attachment: nextList });\r\n                  }}\r\n                  onPreview={async (file) => {\r\n                    // open image preview or PDF in new tab\r\n                    const f: any = file;\r\n                    const url = f.url || f.preview || (f.originFileObj && URL.createObjectURL(f.originFileObj));\r\n                    if (url) window.open(url, '_blank');\r\n                  }}\r\n                  showUploadList={false}\r\n                >\r\n                  <p className=\"ant-upload-drag-icon\">\r\n                    <UploadOutlined />\r\n                  </p>\r\n                  <p className=\"ant-upload-text\">Drag files here or click to upload</p>\r\n                  <p className=\"ant-upload-hint\">Support for multiple files. Each must be PDF, JPG, or PNG, and under 5MB.</p>\r\n                </Upload.Dragger>\r\n\r\n                {/* Custom file list with preview, icons and remove */}\r\n                {fileListState && fileListState.length > 0 && (\r\n                  <div style={{ marginTop: 12 }}>\r\n                    {fileListState.map((f: any) => {\r\n                      const name = f.name || (f.originFileObj && f.originFileObj.name) || 'file';\r\n                      const size = (f.size || (f.originFileObj && f.originFileObj.size) || 0);\r\n                      const isImage = (f.type && f.type.startsWith('image/')) || /\\.(jpe?g|png)$/i.test(name);\r\n                      const isPdf = (f.type === 'application/pdf') || /\\.pdf$/i.test(name);\r\n                      return (\r\n                        <div key={f.uid || f.name} style={{ display: 'flex', alignItems: 'center', gap: 12, padding: '8px 12px', border: '1px solid #f0f0f0', borderRadius: 8, marginBottom: 8 }}>\r\n                          <div style={{ width: 48, height: 48, display: 'flex', alignItems: 'center', justifyContent: 'center', background: '#fafafa', borderRadius: 6 }}>\r\n                            {isImage ? (\r\n                              <img src={f.preview || (f.originFileObj && URL.createObjectURL(f.originFileObj))} alt={name} style={{ maxWidth: 44, maxHeight: 44, borderRadius: 4 }} />\r\n                            ) : isPdf ? (\r\n                              <div style={{ fontSize: 20, color: '#ff4d4f' }}>PDF</div>\r\n                            ) : (\r\n                              <div style={{ fontSize: 20 }}>FILE</div>\r\n                            )}\r\n                          </div>\r\n                          <div style={{ flex: 1 }}>\r\n                            <div style={{ fontWeight: 600 }}>{name}</div>\r\n                            <div style={{ color: '#8c8c8c', fontSize: 12 }}>{formatBytes(size)}</div>\r\n                          </div>\r\n                          <div style={{ display: 'flex', gap: 8 }}>\r\n                            <Button type=\"link\" onClick={() => {\r\n                              // preview\r\n                              const url = f.url || f.preview || (f.originFileObj && URL.createObjectURL(f.originFileObj));\r\n                              if (url) window.open(url, '_blank');\r\n                            }}>Preview</Button>\r\n                            <Button type=\"link\" danger onClick={() => {\r\n                              const next = fileListState.filter(x => x.uid !== f.uid && x.name !== f.name);\r\n                              setFileListState(next);\r\n                              form.setFieldsValue({ attachment: next });\r\n                            }}>Remove</Button>\r\n                          </div>\r\n                        </div>\r\n                      );\r\n                    })}\r\n                  </div>\r\n                )}\r\n              </Form.Item>\r\n            </Col>\r\n          </Row>\r\n\r\n          <Form.Item>\r\n            <Row justify=\"end\" gutter={[8, 8]}>\r\n              <Col xs={24} sm=\"auto\" style={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                <Button\r\n                  type=\"default\"\r\n                  onClick={() => {\r\n                    form.resetFields();\r\n                    setSubjectCount(0);\r\n                    setMessageCount(0);\r\n                    setFileListState([]);\r\n                    localStorage.removeItem(LOCALSTORAGE_KEY);\r\n                  }}\r\n                  block\r\n                  icon={<ReloadOutlined />}\r\n                  style={{ borderRadius: 8, minWidth: 120 }}\r\n                >\r\n                  Reset\r\n                </Button>\r\n              </Col>\r\n              <Col xs={24} sm=\"auto\" style={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                <Button\r\n                  type=\"primary\"\r\n                  loading={loading}\r\n                  className=\"inquiry-gradient-btn\"\r\n                  block\r\n                  icon={<SendOutlined />}\r\n                  style={{ borderRadius: 8, fontWeight: 600, fontSize: 16, minWidth: 160 }}\r\n                  onClick={async () => {\r\n                    try {\r\n                      // validate fields before showing preview\r\n                      const values = await form.validateFields();\r\n                      setPreviewValues(values);\r\n                      setPreviewModalVisible(true);\r\n                    } catch (err) {\r\n                      onFinishFailed(err);\r\n                    }\r\n                  }}\r\n                >\r\n                  Submit Inquiry\r\n                </Button>\r\n              </Col>\r\n            </Row>\r\n          </Form.Item>\r\n        </Form>\r\n        <Modal\r\n          title=\"Review your inquiry\"\r\n          open={previewModalVisible}\r\n          onCancel={() => setPreviewModalVisible(false)}\r\n          footer={[\r\n            <Button key=\"edit\" onClick={() => setPreviewModalVisible(false)}>Edit</Button>,\r\n            <Button key=\"confirm\" type=\"primary\" onClick={async () => {\r\n              // call submit with previewValues\r\n              setPreviewModalVisible(false);\r\n              await onFinish(previewValues);\r\n            }}>\r\n              Confirm & Submit\r\n            </Button>\r\n          ]}\r\n        >\r\n          {previewValues && (\r\n            <Descriptions column={1} bordered>\r\n              <Descriptions.Item label=\"Inquiry Type\">{previewValues.type}</Descriptions.Item>\r\n              <Descriptions.Item label=\"Assign to Role\">{previewValues.assignedRole}</Descriptions.Item>\r\n              <Descriptions.Item label=\"Subject\">{previewValues.subject}</Descriptions.Item>\r\n              <Descriptions.Item label=\"Message\">{previewValues.message}</Descriptions.Item>\r\n              <Descriptions.Item label=\"Attachments\">{(fileListState || []).map((f: any) => f.name || (f.originFileObj && f.originFileObj.name)).join(', ')}</Descriptions.Item>\r\n            </Descriptions>\r\n          )}\r\n        </Modal>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InquiryForm;\r\n","import React from 'react';\r\nimport { Button } from 'antd';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst Goodbye: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  return (\r\n    <div style={{ minHeight: '100vh', display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center', background: '#f4f6fa' }}>\r\n      <h1 style={{ color: '#722ed1', fontWeight: 700, fontSize: 32 }}>You have been logged out</h1>\r\n      <p style={{ fontSize: 18, margin: '16px 0 32px' }}>Thank you for using the Barangay Information System.</p>\r\n      <Button type=\"primary\" size=\"large\" onClick={() => navigate('/login', { replace: true })}>\r\n        Log In Again\r\n      </Button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Goodbye;\r\n","import React, { useEffect } from 'react';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst Logout: React.FC = () => {\r\n  const { logout } = useAuth();\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    logout();\r\n    navigate('/login', { replace: true });\r\n  }, [logout, navigate]);\r\n\r\n  return null;\r\n};\r\n\r\nexport default Logout;\r\n","import React, { useEffect, useState, useMemo } from 'react';\r\nimport { Table, Spin, Empty, Tag, Typography, notification, DatePicker, Select, Space, Button } from 'antd';\r\nimport { contactAPI } from '../services/api';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { formatDate } from '../utils/formatDate';\r\n\r\nconst getStatusTag = (status?: string) => {\r\n  const statusColors: { [k: string]: string } = {\r\n    'pending': 'gold',\r\n    'open': 'gold',\r\n    'approved': 'success',\r\n    'resolved': 'green',\r\n    'rejected': 'error'\r\n  };\r\n  const s = (status || '').toString().toLowerCase();\r\n  return <Tag color={statusColors[s] || 'default'}>{(status || '').toUpperCase() || 'UNKNOWN'}</Tag>;\r\n};\r\n\r\nconst InquiryTracker: React.FC = () => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [inquiries, setInquiries] = useState<any[]>([]);\r\n  const [statusFilter, setStatusFilter] = useState<string | null>(null);\r\n  const [typeFilter, setTypeFilter] = useState<string | null>(null);\r\n  const [dateRange, setDateRange] = useState<any[] | null>(null);\r\n  const navigate = useNavigate();\r\n\r\n  const fetch = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await contactAPI.getAllInquiries();\r\n      setInquiries(Array.isArray(res) ? res : (res && res.items) ? res.items : []);\r\n    } catch (err) {\r\n      console.error('Failed to load inquiries', err);\r\n      notification.error({ message: 'Failed to load inquiries' });\r\n      setInquiries([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => { fetch(); }, []);\r\n\r\n  const types = useMemo(() => {\r\n    return Array.from(new Set(inquiries.map(i => (i.type || 'General'))));\r\n  }, [inquiries]);\r\n\r\n  const filtered = useMemo(() => {\r\n    return (inquiries || []).filter((i: any) => {\r\n      if (statusFilter && (!i.status || i.status.toString().toLowerCase() !== statusFilter.toLowerCase())) return false;\r\n      const t = (i.type || 'General');\r\n      if (typeFilter && t.toString().toLowerCase() !== typeFilter.toString().toLowerCase()) return false;\r\n      if (dateRange && dateRange[0] && dateRange[1] && i.createdAt) {\r\n        try {\r\n          const start = dateRange[0].toDate ? dateRange[0].toDate() : new Date(dateRange[0]);\r\n          const end = dateRange[1].toDate ? dateRange[1].toDate() : new Date(dateRange[1]);\r\n          const d = new Date(i.createdAt);\r\n          if (d < start || d > end) return false;\r\n        } catch (e) {\r\n          // ignore parsing errors\r\n        }\r\n      }\r\n      return true;\r\n    });\r\n  }, [inquiries, statusFilter, typeFilter, dateRange]);\r\n\r\n  return (\r\n    <div>\r\n      <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'space-between', marginBottom: 12 }}>\r\n        <Typography.Title level={4} style={{ margin: 0 }}>Inquiry Tracker</Typography.Title>\r\n        <Typography.Text type=\"secondary\">Showing {inquiries.length} records</Typography.Text>\r\n      </div>\r\n\r\n      <Spin spinning={loading}>\r\n        <div style={{ marginBottom: 12, display: 'flex', justifyContent: 'flex-end' }}>\r\n          <Space>\r\n            <Select allowClear placeholder=\"Status\" style={{ width: 160 }} value={statusFilter ?? undefined} onChange={(v) => setStatusFilter(v || null)}>\r\n              <Select.Option value=\"open\">Open</Select.Option>\r\n              <Select.Option value=\"in-progress\">In Progress</Select.Option>\r\n              <Select.Option value=\"resolved\">Resolved</Select.Option>\r\n            </Select>\r\n            <Select allowClear placeholder=\"Type\" style={{ width: 180 }} value={typeFilter ?? undefined} onChange={(v) => setTypeFilter(v || null)}>\r\n              {types.map(t => <Select.Option key={t} value={t}>{t}</Select.Option>)}\r\n            </Select>\r\n            <DatePicker.RangePicker onChange={(vals) => setDateRange(vals ? vals.filter(Boolean) : null)} />\r\n            <Button onClick={() => { setStatusFilter(null); setTypeFilter(null); setDateRange(null); }}>Reset</Button>\r\n          </Space>\r\n        </div>\r\n\r\n        {filtered.length === 0 && !loading ? (\r\n          <Empty description=\"No inquiries\" />\r\n        ) : (\r\n          <Table\r\n            dataSource={filtered.slice().sort((a,b) => (new Date(b.createdAt).getTime() || 0) - (new Date(a.createdAt).getTime() || 0))}\r\n            rowKey={(r:any) => r._id}\r\n            pagination={{ pageSize: 12 }}\r\n            onRow={(record) => ({\r\n              onClick: () => {\r\n                // go to staff inbox and open the thread\r\n                navigate('/staff/inbox', { state: { openInquiryId: record._id } });\r\n              }\r\n            })}\r\n          >\r\n            <Table.Column title=\"Name\" dataIndex=\"username\" key=\"username\" render={(v:any,r:any)=> v || r.residentName || r.subject || 'Unknown'} />\r\n            <Table.Column title=\"Type of Inquiry\" dataIndex=\"type\" key=\"type\" render={(t:any)=> t ? String(t) : 'General'} />\r\n            <Table.Column title=\"Status\" dataIndex=\"status\" key=\"status\" render={(s:any)=> getStatusTag(s)} />\r\n            <Table.Column title=\"Date Inquired\" dataIndex=\"createdAt\" key=\"createdAt\" render={(d:any)=> formatDate(d)} />\r\n            <Table.Column title=\"Date Resolved\" dataIndex=\"updatedAt\" key=\"updatedAt\" render={(d:any, r:any) => (r.status && r.status.toString().toLowerCase() === 'resolved' ? formatDate(d) : '')} />\r\n          </Table>\r\n        )}\r\n      </Spin>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default InquiryTracker;\r\n","import React from 'react';\r\nimport { Modal, Form, Input, message } from 'antd';\r\nimport { axiosInstance } from '../services/api';\r\n\r\ninterface Props {\r\n  visible: boolean;\r\n  onClose: () => void;\r\n  onCreated: (resident: any) => void;\r\n  defaultBarangayID?: string | null;\r\n  defaultUsername?: string | null;\r\n  defaultEmail?: string | null;\r\n}\r\n\r\nconst ResidentCreateModal: React.FC<Props> = ({ visible, onClose, onCreated, defaultBarangayID, defaultUsername, defaultEmail }) => {\r\n  const [form] = Form.useForm();\r\n  const [submitting, setSubmitting] = React.useState(false);\r\n\r\n  React.useEffect(() => {\r\n    if (visible) {\r\n      form.setFieldsValue({\r\n        barangayID: defaultBarangayID || undefined,\r\n        username: defaultUsername || undefined,\r\n        email: defaultEmail || undefined\r\n      });\r\n    } else {\r\n      form.resetFields();\r\n    }\r\n  // only when modal open/close or defaults change\r\n  }, [visible, defaultBarangayID, defaultUsername, defaultEmail, form]);\r\n\r\n  const handleOk = async () => {\r\n    try {\r\n      const values = await form.validateFields();\r\n      setSubmitting(true);\r\n      // Minimal payload expected by server to create resident container\r\n      const payload: any = {\r\n        firstName: values.firstName,\r\n        lastName: values.lastName,\r\n        barangayID: defaultBarangayID || values.barangayID || '',\r\n        username: defaultUsername || values.username || '',\r\n        email: defaultEmail || values.email || ''\r\n      };\r\n  const resp = await axiosInstance.put('/resident/personal-info', payload);\r\n      message.success('Resident container created');\r\n      onCreated(resp.data);\r\n      form.resetFields();\r\n      onClose();\r\n    } catch (err: any) {\r\n      console.error('Failed to create resident container', err);\r\n      if (err?.response?.data?.message) message.error(err.response.data.message);\r\n      else message.error('Failed to create resident container');\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Modal\r\n      title=\"Create Resident Info\"\r\n      visible={visible}\r\n      onOk={handleOk}\r\n      onCancel={() => { form.resetFields(); onClose(); }}\r\n      confirmLoading={submitting}\r\n    >\r\n      <Form form={form} layout=\"vertical\">\r\n        <Form.Item name=\"firstName\" label=\"First name\" rules={[{ required: true, message: 'First name is required' }]}>\r\n          <Input />\r\n        </Form.Item>\r\n        <Form.Item name=\"lastName\" label=\"Last name\" rules={[{ required: true, message: 'Last name is required' }]}>\r\n          <Input />\r\n        </Form.Item>\r\n        <Form.Item name=\"barangayID\" label=\"Barangay ID\">\r\n          <Input disabled />\r\n        </Form.Item>\r\n        <Form.Item name=\"username\" label=\"Username\">\r\n          <Input disabled />\r\n        </Form.Item>\r\n        <Form.Item name=\"email\" label=\"Email\" rules={[{ type: 'email', message: 'Invalid email' }]}>\r\n          <Input disabled />\r\n        </Form.Item>\r\n      </Form>\r\n    </Modal>\r\n  );\r\n};\r\n\r\nexport default ResidentCreateModal;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { useTranslation } from 'react-i18next';\r\nimport { residentPersonalInfoAPI, axiosInstance } from '../services/api';\r\nimport { AxiosResponse } from 'axios';\r\nimport { Form, Input, Button, Select, Typography, Divider, Row, Col, Card, Space, message, Switch, Upload, Alert } from 'antd';\r\nimport { UploadOutlined } from '@ant-design/icons';\r\nimport ResidentCreateModal from './ResidentCreateModal';\r\nimport { useAuth } from '../contexts/AuthContext';\r\nimport AvatarImage from './AvatarImage';\r\n\r\ninterface ResidentProfile {\r\n\t_id: string;\r\n\tusername: string;\r\n\temail: string;\r\n\taddress: string;\r\n\tcontactNumber: string;\r\n\tbarangayID: string;\r\n\trole: string;\r\n\t// Optional display name provided by the user (used to derive first/last name)\r\n\tfullName?: string;\r\n}\r\n// Personal info fields (example, adjust as needed)\r\ninterface PersonalInfo {\r\n\tbarangayID?: string;\r\n\tspouseMiddleName?: string;\r\n\tspouseLastName?: string;\r\n\tmiddleName?: string;\r\n\tnationality?: string;\r\n\tplaceOfBirth?: string;\r\n\treligion?: string;\r\n\tmaritalStatus?: string;\r\n\tpassportNumber?: string;\r\n\tgovernmentIdNumber?: string;\r\n\tbloodType?: string;\r\n\tdisabilityStatus?: string;\r\n\toccupation?: string;\r\n\teducationalAttainment?: string;\r\n\t// Family Information\r\n\tnumberOfChildren?: number;\r\n\tchildrenNames?: string;\r\n\tchildrenAges?: string;\r\n\tspouseNationality?: string;\r\n\tspouseContactNumber?: string;\r\n\temergencyContactName?: string;\r\n\temergencyContactRelationship?: string;\r\n\t// Business Information\r\n\tbusinessName?: string;\r\n\tbusinessType?: string;\r\n\tnatureOfBusiness?: string;\r\n\tbusinessAddress?: string;\r\n\tdateEstablished?: string;\r\n\ttin?: string;\r\n\tregistrationNumber?: string;\r\n\tbusinessPermitNumber?: string;\r\n\tbarangayClearanceNumber?: string;\r\n\tnumberOfEmployees?: number;\r\n\tcapitalInvestment?: number;\r\n\tannualGrossIncome?: number;\r\n\tbusinessContactPerson?: string;\r\n\tbusinessContactNumber?: string;\r\n\tbusinessEmail?: string;\r\n\tfirstName: string;\r\n\tlastName: string;\r\n\tage?: number;\r\n\tbirthDate?: string;\r\n\tdateOfResidency?: string;\r\n\tsex?: string;\r\n\tcivilStatus?: string;\r\n\tfacebook?: string;\r\n\temail?: string;\r\n\tcontactNumber?: string;\r\n\temergencyContact?: string;\r\n\tlandlineNumber?: string;\r\n\tspouseName?: string;\r\n\tspouseAge?: number;\r\n\tspouseBirthDate?: string;\r\n\tspouseOccupation?: string;\r\n\tspouseStatus?: string;\r\n\tmotherName?: string;\r\n\tmotherAge?: number;\r\n\tmotherBirthDate?: string;\r\n\tmotherOccupation?: string;\r\n\tmotherStatus?: string;\r\n\tfatherName?: string;\r\n\tfatherAge?: number;\r\n\tfatherBirthDate?: string;\r\n\tfatherOccupation?: string;\r\n\tfatherStatus?: string;\r\n\t// Add more as needed\r\n}\r\n\r\ninterface DocumentRequest {\r\n\t_id: string;\r\n\ttype: string;\r\n\tstatus: string;\r\n\tdateRequested: string;\r\n\tnotes?: string;\r\n}\r\n\r\nexport default function ResidentPortal() {\r\n\tconst [avatarPreview, setAvatarPreview] = useState<string | null>(null);\r\n\tconst [residentMissing, setResidentMissing] = useState(false);\r\n\tconst [showCreateModal, setShowCreateModal] = useState(false);\r\n\r\n\tconst autoCreateResident = async () => {\r\n\t\ttry {\r\n\t\t\tif (!profile) {\r\n\t\t\t\tmessage.error('Profile not yet loaded. Please try again.');\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\t// derive minimal name values\r\n\t\t\tconst parts = profile.fullName ? profile.fullName.trim().split(' ') : [];\r\n\t\t\tconst firstName = parts.length ? parts[0] : (profile.username || profile.email || 'Resident');\r\n\t\t\tconst lastName = parts.length > 1 ? parts.slice(1).join(' ') : '';\r\n\t\t\tconst payload: any = {\r\n\t\t\t\tfirstName,\r\n\t\t\t\tlastName,\r\n\t\t\t\tbarangayID: profile.barangayID || '',\r\n\t\t\t\tusername: profile.username || '',\r\n\t\t\t\temail: profile.email || ''\r\n\t\t\t};\r\n\t\t\tconst resp = await axiosInstance.put('/resident/personal-info', payload);\r\n\t\t\tsetPersonalInfo(resp.data);\r\n\t\t\tsetPersonalForm(resp.data);\r\n\t\t\tsetResidentMissing(false);\r\n\t\t\tmessage.success('Resident profile created');\r\n\t\t} catch (err) {\r\n\t\t\tconsole.error('Failed to auto-create resident:', err);\r\n\t\t\tmessage.error('Failed to create resident info. Please fill the form manually.');\r\n\t\t}\r\n\t};\r\n\r\n\tconst { setUser } = useAuth();\r\n\t// handle avatar upload for resident portal banner\r\n\tconst handleBannerAvatarUpload = async (file: File | null) => {\r\n\t\tif (!file) return;\r\n\t\tconst reader = new FileReader();\r\n\t\treader.onload = e => setAvatarPreview(e.target?.result as string);\r\n\t\treader.readAsDataURL(file);\r\n\t\tconst form = new FormData();\r\n\t\tform.append('avatar', file);\r\n\t\ttry {\r\n\t\t\tconst resp = await axiosInstance.post('/resident/personal-info/avatar', form, { headers: { 'Content-Type': 'multipart/form-data' } });\r\n\t\t\t// server returns { message, resident, user }\r\n\t\t\tconst updated = resp.data?.resident;\r\n\t\t\tconst returnedUser = resp.data?.user;\r\n\t\t\tif (updated) {\r\n\t\t\t\t// Update resident container state so the picture is saved in the resident container\r\n\t\t\t\tsetPersonalInfo(updated);\r\n\t\t\t\tsetPersonalForm(updated);\r\n\t\t\t\tif (updated.profileImage) {\r\n\t\t\t\t\tconst url = updated.profileImage.startsWith('http') ? updated.profileImage : `${window.location.origin}${updated.profileImage}`;\r\n\t\t\t\t\tsetAvatarPreview(url);\r\n\t\t\t\t}\r\n\t\t\t\tsetResidentMissing(false);\r\n\t\t\t\tmessage.success('Profile image updated');\r\n\t\t\t} else {\r\n\t\t\t\tmessage.success('Profile image updated');\r\n\t\t\t}\r\n\t\t\t// If server returned an updated user, update AuthContext/localStorage\r\n\t\t\tif (returnedUser) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tif (typeof setUser === 'function') setUser(returnedUser);\r\n\t\t\t\t\telse localStorage.setItem('userProfile', JSON.stringify(returnedUser));\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\t// ignore\r\n\t\t\t\t}\r\n\r\n\t\t\t\ttry {\r\n\t\t\t\t\tconst ev = new CustomEvent('userProfileUpdated', { detail: returnedUser });\r\n\t\t\t\t\twindow.dispatchEvent(ev);\r\n\t\t\t\t} catch (err) {\r\n\t\t\t\t\t// ignore\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t} catch (err) {\r\n\t\t\tmessage.error('Failed to upload avatar');\r\n\t\t}\r\n\t};\r\n\t// ...existing code...\r\n\tconst handleRegisterResident = async () => {\r\n\t\ttry {\r\n\t\t\t// Use form (user info) and personalForm (resident info)\r\n\t\t\tconst payload = {\r\n\t\t\t\tbarangayID: form?.barangayID || '',\r\n\t\t\t\tusername: form?.username || '',\r\n\t\t\t\t...personalForm\r\n\t\t\t};\r\n\t\t\tawait axiosInstance.post('/resident', payload);\r\n\t\t\talert('Resident registered successfully!');\r\n\t\t} catch (error) {\r\n\t\t\talert('Failed to register resident.');\r\n\t\t}\r\n\t};\r\n\tconst { t, i18n } = useTranslation();\r\n\tconst [profile, setProfile] = useState<ResidentProfile | null>(null);\r\n\tconst [requests, setRequests] = useState<DocumentRequest[]>([]);\r\n\tconst [editing, setEditing] = useState(false);\r\n\tconst [form, setForm] = useState<ResidentProfile | null>(null);\r\n\tconst [staffRequestSent, setStaffRequestSent] = useState(false);\r\n\tconst [requesting, setRequesting] = useState(false);\r\n\tconst [editingUser, setEditingUser] = useState(false);\r\n\tconst [editingPersonal, setEditingPersonal] = useState(false);\r\n\tconst [personalInfo, setPersonalInfo] = useState<PersonalInfo | null>(null);\r\n\tconst [personalForm, setPersonalForm] = useState<PersonalInfo | null>(null);\r\n\tconst [currentTime, setCurrentTime] = useState<string>('');\r\n\r\n\tuseEffect(() => {\r\n\t// Fetch resident profile and requests\r\n\taxiosInstance.get('/resident/profile').then((res: AxiosResponse<any>) => {\r\n\t\tsetProfile(res.data);\r\n\t\tsetForm(res.data);\r\n\t\tif (res.data?.profileImage) {\r\n\t\t\tconst url = res.data.profileImage.startsWith('http') ? res.data.profileImage : `${window.location.origin}${res.data.profileImage}`;\r\n\t\t\tsetAvatarPreview(url);\r\n\t\t}\r\n\t});\r\n    residentPersonalInfoAPI.getPersonalInfo()\r\n      .then((data: any) => {\r\n        setPersonalInfo(data);\r\n        setPersonalForm(data);\r\n\t\t\t\tif (data?.profileImage) {\r\n\t\t\t\t\t\tconst url = data.profileImage.startsWith('http') ? data.profileImage : `${window.location.origin}${data.profileImage}`;\r\n\t\t\t\t\t\tsetAvatarPreview(url);\r\n\t\t\t\t}\r\n      })\r\n\t\t\t.catch((err: any) => {\r\n\t\t\t\tif (err.response && err.response.status === 404) {\r\n\t\t\t\t\t// No personal info yet, show empty form and flag missing\r\n\t\t\t\t\tsetResidentMissing(true);\r\n\t\t\t\t\tsetPersonalInfo(null);\r\n\t\t\t\t\tsetPersonalForm({\r\n            firstName: '',\r\n            lastName: '',\r\n            age: undefined,\r\n            birthDate: '',\r\n            dateOfResidency: '',\r\n            sex: '',\r\n            civilStatus: '',\r\n            facebook: '',\r\n            email: '',\r\n            contactNumber: '',\r\n            emergencyContact: '',\r\n            landlineNumber: '',\r\n            spouseName: '',\r\n            spouseAge: undefined,\r\n            spouseBirthDate: '',\r\n            spouseOccupation: '',\r\n            spouseStatus: '',\r\n            motherName: '',\r\n            motherAge: undefined,\r\n            motherBirthDate: '',\r\n            motherOccupation: '',\r\n            motherStatus: '',\r\n            fatherName: '',\r\n            fatherAge: undefined,\r\n            fatherBirthDate: '',\r\n            fatherOccupation: '',\r\n            fatherStatus: '',\r\n          });\r\n        }\r\n      });\r\n\taxiosInstance.get('/resident/requests').then((res: AxiosResponse<any>) => {\r\n\t\tsetRequests(res.data);\r\n\t});\r\n}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tconst updateTime = () => {\r\n\t\t\tconst now = new Date();\r\n\t\t\tconst formatted = now.toLocaleString('en-US', {\r\n\t\t\t\tyear: 'numeric', month: '2-digit', day: '2-digit',\r\n\t\t\t\thour: '2-digit', minute: '2-digit', second: '2-digit',\r\n\t\t\t\thour12: false\r\n\t\t\t}).replace(/,/g, '');\r\n\t\t\tsetCurrentTime(formatted);\r\n\t\t};\r\n\t\tupdateTime();\r\n\t\tconst interval = setInterval(updateTime, 1000);\r\n\t\treturn () => clearInterval(interval);\r\n\t}, []);\r\n\r\n\t// User info edit logic\r\n\tconst handleEditUser = () => setEditingUser(true);\r\n\tconst handleCancelUser = () => {\r\n\t\tsetEditingUser(false);\r\n\t\tsetForm(profile);\r\n\t};\r\n\tconst handleChangeUser = (e: React.ChangeEvent<HTMLInputElement>) => {\r\n\t\tif (!form) return;\r\n\t\tsetForm({ ...form, [e.target.name]: e.target.value });\r\n\t};\r\n\tconst handleSaveUser = async () => {\r\n\t\tif (!form) return;\r\n\t\ttry {\r\n\t\t\t// Build a minimal payload containing only allowed fields the server expects\r\n\t\t\tconst deriveNames = () => {\r\n\t\t\t\tlet first = (form as any).firstName || '';\r\n\t\t\t\tlet last = (form as any).lastName || '';\r\n\t\t\t\tif ((!first || !last) && profile && (profile as any).fullName) {\r\n\t\t\t\t\tconst parts = (profile as any).fullName.trim().split(' ');\r\n\t\t\t\t\tfirst = first || parts[0] || '';\r\n\t\t\t\t\tlast = last || (parts.length > 1 ? parts.slice(1).join(' ') : '');\r\n\t\t\t\t}\r\n\t\t\t\t// Fallback to username/email if still missing\r\n\t\t\t\tfirst = first || profile?.username || profile?.email || 'Resident';\r\n\t\t\t\tlast = last || 'User';\r\n\t\t\t\treturn { first, last };\r\n\t\t\t};\r\n\t\t\tconst names = deriveNames();\r\n\t\t\tconst payload: any = {\r\n\t\t\t\tfirstName: names.first,\r\n\t\t\t\tlastName: names.last,\r\n\t\t\t\tbarangayID: form?.barangayID || profile?.barangayID || '',\r\n\t\t\t\temail: form?.email || profile?.email || '',\r\n\t\t\t\tcontactNumber: form?.contactNumber || profile?.contactNumber || '',\r\n\t\t\t\taddress: form?.address || profile?.address || ''\r\n\t\t\t};\r\n\t\t\tconst resp = await axiosInstance.put('/resident/personal-info', payload);\r\n\t\t\t// Update local profile with returned resident/user fields when available\r\n\t\t\tif (resp && resp.data) {\r\n\t\t\t\tsetProfile({ ...profile, ...resp.data });\r\n\t\t\t} else {\r\n\t\t\t\tsetProfile({ ...profile, ...payload } as any);\r\n\t\t\t}\r\n\t\t\tsetEditingUser(false);\r\n\t\t\tmessage.success('Profile saved');\r\n\t\t} catch (err: any) {\r\n\t\t\tconsole.error('Failed to save user info:', err);\r\n\t\t\tif (err?.response && err.response.data) {\r\n\t\t\t\tconst data = err.response.data;\r\n\t\t\t\tif (data.errors) {\r\n\t\t\t\t\t// Validation errors\r\n\t\t\t\t\tconst msgs = Object.values(data.errors).map((v: any) => v.toString()).join('; ');\r\n\t\t\t\t\tmessage.error(msgs || data.message || 'Validation error');\r\n\t\t\t\t} else {\r\n\t\t\t\t\tmessage.error(data.message || 'Failed to save');\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tmessage.error('Failed to save user info');\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\t// Personal info edit logic\r\n\tconst handleEditPersonal = () => setEditingPersonal(true);\r\n\tconst handleCancelPersonal = () => {\r\n\t\tsetEditingPersonal(false);\r\n\t\tsetPersonalForm(personalInfo);\r\n\t};\r\n\tconst handleChangePersonal = (e: React.ChangeEvent<HTMLInputElement | HTMLSelectElement>) => {\r\n\t\tif (!personalForm) return;\r\n\t\tsetPersonalForm({ ...personalForm, [e.target.name]: e.target.value });\r\n\t};\r\n\tconst handleSavePersonal = async () => {\r\n\t\tif (!personalForm || !profile?._id) return;\r\n\t\t// Overwrite the existing record for the displayed user\r\n\t\tawait residentPersonalInfoAPI.updatePersonalInfo({ ...personalForm, userId: profile._id });\r\n\t\tsetPersonalInfo(personalForm);\r\n\t\tsetEditingPersonal(false);\r\n\t};\r\n\r\n\tconst handleRequestStaff = async () => {\r\n\t\tsetRequesting(true);\r\n\t\ttry {\r\n\t\t\tconst resp = await axiosInstance.post('/resident/request-staff-access');\r\n\t\t\tconst serverMsg = resp?.data?.message || 'Request sent to admin for staff access';\r\n\t\t\tif (resp && (resp.status === 200 || resp.status === 201)) {\r\n\t\t\t\tmessage.success(serverMsg);\r\n\t\t\t\tsetStaffRequestSent(true);\r\n\t\t\t} else {\r\n\t\t\t\tmessage.info(serverMsg);\r\n\t\t\t}\r\n \t\t} catch (err) {\r\n \t\t\tconsole.error('Request staff access failed:', err);\r\n \t\t\tconst e: any = err;\r\n \t\t\tconst serverMsg = e?.response?.data?.message || e?.message || 'Failed to send staff access request';\r\n \t\t\tmessage.error(serverMsg);\r\n \t\t} finally {\r\n\t\t\tsetRequesting(false);\r\n\t\t}\r\n\t};\r\n\r\n\t\t// Feedback form state\r\n\t// ...existing code...\r\n\r\n\t\t\treturn (\r\n\t\t\t\t\t<div className=\"max-w-3xl mx-auto p-6\">\r\n\t\t\t\t\t\t{/* Resident Portal Banner -> avatar + upload */}\r\n\t\t\t\t\t\t<Card\r\n\t\t\t\t\t\t\tstyle={{\r\n\t\t\t\t\t\t\t\tbackground: 'linear-gradient(90deg, #f7f8fa 0%, #e0e7ff 100%)',\r\n\t\t\t\t\t\t\t\tborderRadius: 16,\r\n\t\t\t\t\t\t\t\tboxShadow: '0 4px 24px #40c9ff22',\r\n\t\t\t\t\t\t\t\tmarginBottom: 32,\r\n\t\t\t\t\t\t\t\tborder: 'none',\r\n\t\t\t\t\t\t\t\tpadding: 0,\r\n\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\tstyles={{ body: { padding: '24px 32px', display: 'flex', alignItems: 'center', justifyContent: 'space-between' } }}\r\n\t\t\t\t\t\t\tvariant=\"outlined\"\r\n\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t<div style={{ display: 'flex', alignItems: 'center', gap: 18 }}>\r\n\t\t\t\t\t\t\t\t<div style={{ width: 96, height: 96, borderRadius: 12, overflow: 'hidden', background: '#fff', display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n\t\t\t\t\t\t\t\t\t{avatarPreview ? (\r\n\t\t\t\t\t\t\t\t\t\t<img src={avatarPreview} alt=\"avatar\" style={{ width: 96, height: 96, objectFit: 'cover' }} />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AvatarImage user={(() => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tlet displayUser = profile;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (!displayUser) {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tconst stored = localStorage.getItem('userProfile');\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tif (stored) displayUser = JSON.parse(stored);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t} catch (err) {}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\treturn displayUser;\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t})()} size={96} />\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t<Typography.Title level={3} style={{ margin: 0, fontWeight: 800 }}>{profile?.username || profile?.email || 'Resident'}</Typography.Title>\r\n\t\t\t\t\t\t\t\t\t<Typography.Text type=\"secondary\">Barangay ID: {profile?.barangayID || 'N/A'}</Typography.Text>\r\n\t\t\t\t\t\t\t\t\t<div style={{ marginTop: 8 }}><Typography.Text type=\"secondary\">{currentTime}</Typography.Text></div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t<Upload\r\n\t\t\t\t\t\t\t\t\tshowUploadList={false}\r\n\t\t\t\t\t\t\t\t\taccept=\"image/*\"\r\n\t\t\t\t\t\t\t\t\tcustomRequest={async ({ file, onSuccess, onError }) => {\r\n\t\t\t\t\t\t\t\t\t\ttry {\r\n\t\t\t\t\t\t\t\t\t\t\tawait handleBannerAvatarUpload(file as File);\r\n\t\t\t\t\t\t\t\t\t\t\tif (typeof onSuccess === 'function') onSuccess('ok');\r\n\t\t\t\t\t\t\t\t\t\t} catch (err) {\r\n\t\t\t\t\t\t\t\t\t\t\tif (typeof onError === 'function') onError(err as any);\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t<Button icon={<UploadOutlined />}>Replace / Upload Profile Picture</Button>\r\n\t\t\t\t\t\t\t\t</Upload>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t</Card>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Prompt to create resident info if missing */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{residentMissing && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div style={{ marginBottom: 16 }}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Alert\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmessage=\"Your resident profile is incomplete\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdescription={\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<p>We couldn't find your resident information. Please create your resident profile so you can upload documents and profile pictures.</p>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button type=\"primary\" onClick={() => setShowCreateModal(true)}>Create Resident Info</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tshowIcon\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<ResidentCreateModal\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvisible={showCreateModal}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClose={() => setShowCreateModal(false)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonCreated={(resident: any) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetPersonalInfo(resident);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetPersonalForm(resident);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetResidentMissing(false);\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefaultBarangayID={profile?.barangayID || ''}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefaultUsername={profile?.username || ''}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdefaultEmail={profile?.email || ''}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* Resident Tool Tips moved to Dashboard */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{/* User Info Section */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t<Card\r\n\t\t\t\t\t\t\t\t\t\t\t\t   style={{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   background: 'linear-gradient(135deg, #f8fafc 0%, #e3e6f3 40%, #f6f1f7 100%)',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   borderRadius: 20,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   boxShadow: '0 8px 32px #bfc7d6cc',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   marginBottom: 32,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   border: 'none',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   backdropFilter: 'blur(2px)',\r\n\t\t\t\t\t\t\t\t\t\t\t\t   }}\r\n\t\t\t\t\t\t\t\t\t\t\t\t   styles={{ body: { padding: 40 } }}\r\n\t\t\t\t\t\t\t\t\t\t\t\t   variant=\"outlined\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t <div style={{ maxWidth: 900, margin: '0 auto' }}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Typography.Title level={3} style={{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfontWeight: 900,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmarginBottom: 24,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tletterSpacing: 1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttextAlign: 'left',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfontSize: 28,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbackground: 'linear-gradient(90deg, #40c9ff, #e81cff)',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWebkitBackgroundClip: 'text',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWebkitTextFillColor: 'transparent',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}>{t('userInformation')}</Typography.Title>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t {form && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t <Form layout=\"vertical\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Row gutter={24}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={12}><Form.Item label={t('username')}><Input name=\"username\" value={form.username} onChange={handleChangeUser} disabled={!editingUser} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={12}><Form.Item label={t('email')}><Input name=\"email\" value={form.email} onChange={handleChangeUser} disabled={!editingUser} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Row gutter={24}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={12}><Form.Item label={t('address')}><Input name=\"address\" value={form.address} onChange={handleChangeUser} disabled={!editingUser} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={12}><Form.Item label={t('contactNumber')}><Input name=\"contactNumber\" value={form.contactNumber} onChange={handleChangeUser} disabled={!editingUser} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Row gutter={24}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={12}><Form.Item label={t('barangayID') || 'Barangay ID'}><Input name=\"barangayID\" value={form.barangayID} disabled /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={12}><Form.Item label={t('role') || 'Role'}><Input name=\"role\" value={form.role} disabled /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Space style={{ marginTop: 24 }}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{editingUser ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button type=\"primary\" onClick={handleSaveUser} style={{ background: 'linear-gradient(90deg, #43e97b 0%, #38f9d7 100%)', border: 'none', fontWeight: 600 }}>Save</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button onClick={handleCancelUser}>Cancel</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button onClick={handleEditUser} style={{ fontWeight: 600 }}>Edit</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t )}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttype=\"dashed\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonClick={handleRequestStaff}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={staffRequestSent || requesting}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tstyle={{ color: '#341f97', borderColor: '#341f97', fontWeight: 600 }}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{staffRequestSent ? 'Request Sent' : 'Request Staff Access'}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Space>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Form>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t </div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t</Card>\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\t{/* Personal Info Section */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t   {personalForm && (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Card\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   style={{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   background: 'linear-gradient(135deg, #f8fafc 0%, #e3e6f3 40%, #f6f1f7 100%)',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   borderRadius: 20,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   boxShadow: '0 8px 32px #bfc7d6cc',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   marginBottom: 32,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   border: 'none',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   backdropFilter: 'blur(2px)',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   }}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   styles={{ body: { padding: 40 } }}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   variant=\"outlined\"\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   >\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Form layout=\"vertical\" style={{ maxWidth: 900, margin: '0 auto' }}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   {/* Resident Info Main Title */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Typography.Title level={2} style={{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfontWeight: 900,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmarginBottom: 24,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tletterSpacing: 1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttextAlign: 'left',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfontSize: 34,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbackground: 'linear-gradient(90deg, #40c9ff, #e81cff)',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWebkitBackgroundClip: 'text',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWebkitTextFillColor: 'transparent',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}>Resident Information</Typography.Title>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   {/* Personal Info Subcategory */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Typography.Title level={3} style={{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfontWeight: 900,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmarginBottom: 16,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tletterSpacing: 1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttextAlign: 'left',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfontSize: 24,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbackground: 'linear-gradient(90deg, #ffb347, #ff4e50)',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWebkitBackgroundClip: 'text',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWebkitTextFillColor: 'transparent',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}>Personal Information</Typography.Title>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"First Name\"><Input name=\"firstName\" value={personalForm.firstName} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Middle Name\"><Input name=\"middleName\" value={personalForm.middleName || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Last Name\"><Input name=\"lastName\" value={personalForm.lastName} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Age\"><Input name=\"age\" type=\"number\" value={personalForm.age || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Birth Date\"><Input name=\"birthDate\" type=\"date\" value={personalForm.birthDate || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Place of Birth\"><Input name=\"placeOfBirth\" value={personalForm.placeOfBirth || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Nationality\"><Input name=\"nationality\" value={personalForm.nationality || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Religion\"><Input name=\"religion\" value={personalForm.religion || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Date of Residency\"><Input name=\"dateOfResidency\" type=\"date\" value={personalForm.dateOfResidency || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Sex\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   value={personalForm.sex || ''}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   onChange={value => setPersonalForm(prev => prev ? { ...prev, sex: value } : prev)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   disabled={!editingPersonal}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   >\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"\">Select</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Male\">Male</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Female\">Female</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Other\">Other</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Select>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Blood Type\"><Input name=\"bloodType\" value={personalForm.bloodType || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Disability Status\"><Input name=\"disabilityStatus\" value={personalForm.disabilityStatus || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Passport Number\"><Input name=\"passportNumber\" value={personalForm.passportNumber || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Government ID Number\"><Input name=\"governmentIdNumber\" value={personalForm.governmentIdNumber || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Occupation\"><Input name=\"occupation\" value={personalForm.occupation || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Educational Attainment\"><Input name=\"educationalAttainment\" value={personalForm.educationalAttainment || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Form.Item label=\"Civil Status\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   value={personalForm.civilStatus || ''}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   onChange={value => setPersonalForm(prev => prev ? { ...prev, civilStatus: value } : prev)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   disabled={!editingPersonal}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   >\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"\">Select</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Single\">Single</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Married\">Married</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Widowed\">Widowed</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Divorced\">Divorced</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Separated\">Separated</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Annulled\">Annulled</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Domestic Partnership\">Domestic Partnership</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Other\">Other</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Select>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Form.Item>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   {/* Social Media Info Subcategory */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Typography.Title level={3} style={{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfontWeight: 900,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmarginBottom: 16,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tletterSpacing: 1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttextAlign: 'left',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfontSize: 24,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbackground: 'linear-gradient(90deg, #ffb347, #ff4e50)',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWebkitBackgroundClip: 'text',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWebkitTextFillColor: 'transparent',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}>Social Media Information</Typography.Title>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}><Form.Item label=\"Facebook\"><Input name=\"facebook\" value={personalForm.facebook || ''} onChange={handleChangePersonal} disabled={!editingPersonal} placeholder=\"Facebook profile/link\" /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}><Form.Item label=\"Valid Email\"><Input name=\"email\" type=\"email\" value={personalForm.email || ''} onChange={handleChangePersonal} disabled={!editingPersonal} placeholder=\"Email address\" /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}><Form.Item label=\"Contact Number\"><Input name=\"contactNumber\" type=\"number\" value={personalForm.contactNumber || ''} onChange={handleChangePersonal} disabled={!editingPersonal} placeholder=\"Contact No.\" /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}><Form.Item label=\"Emergency Contact\"><Input name=\"emergencyContact\" type=\"number\" value={personalForm.emergencyContact || ''} onChange={handleChangePersonal} disabled={!editingPersonal} placeholder=\"Emergency contact number\" /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}><Form.Item label=\"Landline Number\"><Input name=\"landlineNumber\" type=\"number\" value={personalForm.landlineNumber || ''} onChange={handleChangePersonal} disabled={!editingPersonal} placeholder=\"Landline number\" /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   {/* Family Info Subcategory */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Typography.Title level={3} style={{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfontWeight: 900,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmarginBottom: 16,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tletterSpacing: 1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttextAlign: 'left',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfontSize: 24,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbackground: 'linear-gradient(90deg, #ffb347, #ff4e50)',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWebkitBackgroundClip: 'text',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWebkitTextFillColor: 'transparent',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}>Family Information</Typography.Title>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Spouse Name\"><Input name=\"spouseName\" value={personalForm.spouseName || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Spouse Middle Name\"><Input name=\"spouseMiddleName\" value={personalForm.spouseMiddleName || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Spouse Last Name\"><Input name=\"spouseLastName\" value={personalForm.spouseLastName || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Spouse Age\"><Input name=\"spouseAge\" type=\"number\" value={personalForm.spouseAge || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Spouse Birthdate\"><Input name=\"spouseBirthDate\" type=\"date\" value={personalForm.spouseBirthDate || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Spouse Nationality\"><Input name=\"spouseNationality\" value={personalForm.spouseNationality || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Spouse Occupation\"><Input name=\"spouseOccupation\" value={personalForm.spouseOccupation || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Spouse Contact Number\"><Input name=\"spouseContactNumber\" value={personalForm.spouseContactNumber || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Spouse Status\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   value={personalForm.spouseStatus || ''}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   onChange={value => setPersonalForm(prev => prev ? { ...prev, spouseStatus: value } : prev)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   disabled={!editingPersonal}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   >\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"\">Select status</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Alive\">Alive</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Deceased\">Deceased</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Unknown\">Unknown</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Missing\">Missing</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Abroad\">Abroad</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"With Family\">With Family</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Separated\">Separated</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Other\">Other</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Select>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Number of Children\"><Input name=\"numberOfChildren\" type=\"number\" value={personalForm.numberOfChildren || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Children's Names\"><Input name=\"childrenNames\" value={personalForm.childrenNames || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Children's Ages\"><Input name=\"childrenAges\" value={personalForm.childrenAges || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Emergency Contact Name\"><Input name=\"emergencyContactName\" value={personalForm.emergencyContactName || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={6}><Form.Item label=\"Emergency Contact Relationship\"><Input name=\"emergencyContactRelationship\" value={personalForm.emergencyContactRelationship || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}><Form.Item label=\"Mother's Name\"><Input name=\"motherName\" value={personalForm.motherName || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}><Form.Item label=\"Mother's Age\"><Input name=\"motherAge\" type=\"number\" value={personalForm.motherAge || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}><Form.Item label=\"Mother's Birthdate\"><Input name=\"motherBirthDate\" type=\"date\" value={personalForm.motherBirthDate || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}><Form.Item label=\"Mother's Occupation\"><Input name=\"motherOccupation\" value={personalForm.motherOccupation || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Form.Item label=\"Mother's Status\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={personalForm.motherStatus || ''}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={value => setPersonalForm(prev => prev ? { ...prev, motherStatus: value } : prev)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={!editingPersonal}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"\">Select status</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Alive\">Alive</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Deceased\">Deceased</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Unknown\">Unknown</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Missing\">Missing</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Abroad\">Abroad</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"With Family\">With Family</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Separated\">Separated</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Other\">Other</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Select>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Form.Item>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}><Form.Item label=\"Father's Name\"><Input name=\"fatherName\" value={personalForm.fatherName || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}><Form.Item label=\"Father's Age\"><Input name=\"fatherAge\" type=\"number\" value={personalForm.fatherAge || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}><Form.Item label=\"Father's Birthdate\"><Input name=\"fatherBirthDate\" type=\"date\" value={personalForm.fatherBirthDate || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}><Form.Item label=\"Father's Occupation\"><Input name=\"fatherOccupation\" value={personalForm.fatherOccupation || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Col span={8}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Form.Item label=\"Father's Status\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tvalue={personalForm.fatherStatus || ''}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={value => setPersonalForm(prev => prev ? { ...prev, fatherStatus: value } : prev)}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tdisabled={!editingPersonal}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"\">Select status</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Alive\">Alive</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Deceased\">Deceased</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Unknown\">Unknown</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Missing\">Missing</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Abroad\">Abroad</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"With Family\">With Family</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Separated\">Separated</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Select.Option value=\"Other\">Other</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Select>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Form.Item>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   {/* Business Info Subcategory */}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Typography.Title level={3} style={{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfontWeight: 900,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tmarginBottom: 16,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tletterSpacing: 1,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\ttextAlign: 'left',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tfontSize: 24,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tbackground: 'linear-gradient(90deg, #ffb347, #ff4e50)',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWebkitBackgroundClip: 'text',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tWebkitTextFillColor: 'transparent',\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}>Business Information</Typography.Title>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"Business Name\"><Input name=\"businessName\" value={personalForm.businessName || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"Business Type\">\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select value={personalForm.businessType || ''} onChange={value => setPersonalForm(prev => prev ? { ...prev, businessType: value } : prev)} disabled={!editingPersonal}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"\">Select</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Sole Proprietorship\">Sole Proprietorship</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Partnership\">Partnership</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Corporation\">Corporation</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Cooperative\">Cooperative</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Select.Option value=\"Other\">Other</Select.Option>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Select>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"Nature of Business\"><Input name=\"natureOfBusiness\" value={personalForm.natureOfBusiness || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"Business Address\"><Input name=\"businessAddress\" value={personalForm.businessAddress || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"Date Established\"><Input name=\"dateEstablished\" type=\"date\" value={personalForm.dateEstablished || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"TIN\"><Input name=\"tin\" value={personalForm.tin || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"DTI/SEC/CDA Registration No.\"><Input name=\"registrationNumber\" value={personalForm.registrationNumber || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"Business Permit No.\"><Input name=\"businessPermitNumber\" value={personalForm.businessPermitNumber || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"Barangay Clearance No.\"><Input name=\"barangayClearanceNumber\" value={personalForm.barangayClearanceNumber || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"Number of Employees\"><Input name=\"numberOfEmployees\" type=\"number\" value={personalForm.numberOfEmployees || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"Capital Investment\"><Input name=\"capitalInvestment\" type=\"number\" value={personalForm.capitalInvestment || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"Annual Gross Income\"><Input name=\"annualGrossIncome\" type=\"number\" value={personalForm.annualGrossIncome || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Row gutter={16}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"Contact Person\"><Input name=\"businessContactPerson\" value={personalForm.businessContactPerson || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"Contact Number\"><Input name=\"businessContactNumber\" value={personalForm.businessContactNumber || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Col span={8}><Form.Item label=\"Email Address\"><Input name=\"businessEmail\" type=\"email\" value={personalForm.businessEmail || ''} onChange={handleChangePersonal} disabled={!editingPersonal} /></Form.Item></Col>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Row>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <div style={{ display: 'flex', gap: 8, marginTop: 16 }}>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   {editingPersonal ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Button type=\"primary\" onClick={handleSavePersonal} style={{ fontWeight: 600 }}>Save</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Button onClick={handleCancelPersonal}>Cancel</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   ) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   <Button onClick={handleEditPersonal} style={{ fontWeight: 600, marginRight: 8 }}>Edit</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   {personalInfo && personalInfo.barangayID ? (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button type=\"primary\" disabled style={{ fontWeight: 600, background: '#b2bec3', border: 'none' }}>Registered</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Button type=\"primary\" style={{ fontWeight: 600 }} onClick={handleRegisterResident}>Register</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   )}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t   )}\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </div>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t   </Form>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t   </Card>\r\n\t\t\t\t\t\t\t\t\t\t\t\t)}\r\n\r\n\t\t\t</div>\r\n\t\t);\r\n}\r\nexport {};\r\n","import React from 'react';\r\nimport './LandingPage.css';\r\nimport './responsive-system-title.css';\r\n\r\nconst LandingPage: React.FC = () => {\r\n  return (\r\n    <div className=\"landing-bg\" style={{\r\n      minHeight: '100vh',\r\n      background: 'linear-gradient(135deg, #40c9ff 0%, #e81cff 100%)',\r\n      display: 'flex',\r\n      alignItems: 'center',\r\n      justifyContent: 'center',\r\n      fontFamily: 'Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif',\r\n    }}>\r\n      <div className=\"floating-box\" style={{\r\n        background: 'rgba(255,255,255,0.95)',\r\n        boxShadow: '0 8px 32px 0 rgba(64,201,255,0.15)',\r\n        borderRadius: 24,\r\n        padding: '48px 32px',\r\n        textAlign: 'center',\r\n        maxWidth: 420,\r\n        width: '100%',\r\n        animation: 'float 2s infinite ease-in-out alternate',\r\n        display: 'flex',\r\n        flexDirection: 'column',\r\n        alignItems: 'center',\r\n      }}>\r\n  <img src={`${process.env.PUBLIC_URL}/logo-parian2.png`} alt=\"Barangay Logo\" style={{ width: 80, marginBottom: 24 }} />\r\n        <h1\r\n          className=\"responsive-system-title\"\r\n          style={{\r\n            fontSize: '1.7rem',\r\n            marginBottom: 24,\r\n            fontWeight: 800,\r\n            background: 'linear-gradient(90deg, #40c9ff, #e81cff)',\r\n            WebkitBackgroundClip: 'text',\r\n            WebkitTextFillColor: 'transparent',\r\n            letterSpacing: 1,\r\n            maxWidth: '100%',\r\n            overflow: 'hidden',\r\n            textOverflow: 'ellipsis',\r\n            whiteSpace: 'pre-line',\r\n            wordBreak: 'break-word',\r\n            textAlign: 'center',\r\n          }}\r\n        >\r\n          Welcome to\r\n          <br />\r\n          Barangay Information Management System\r\n          <br />\r\n          Parian\r\n        </h1>\r\n        <button\r\n          className=\"get-started-btn\"\r\n          style={{\r\n            background: 'linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)',\r\n            color: '#fff',\r\n            border: 'none',\r\n            borderRadius: 8,\r\n            padding: '14px 40px',\r\n            fontSize: '1.15rem',\r\n            fontWeight: 700,\r\n            cursor: 'pointer',\r\n            boxShadow: '0 2px 8px #e81cff44',\r\n            marginTop: 8,\r\n            transition: 'background 0.2s',\r\n          }}\r\n          onClick={() => window.location.href = '/login'}\r\n          onMouseOver={e => (e.currentTarget.style.background = 'linear-gradient(90deg, #40c9ff 0%, #e81cff 100%)')}\r\n          onMouseOut={e => (e.currentTarget.style.background = 'linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)')}\r\n        >\r\n          Get Started\r\n        </button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LandingPage;\r\n","import React, { useState } from 'react';\r\nimport { Form, Input, Button, Card, Typography, notification, Radio } from 'antd';\r\nimport { axiosPublic } from '../services/api';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst ForgotPassword: React.FC = () => {\r\n  const [loading, setLoading] = useState(false);\r\n  const [sent, setSent] = useState(false);\r\n  const [mode, setMode] = useState<'link' | 'otp'>('link');\r\n  const [submittedEmail, setSubmittedEmail] = useState<string | null>(null);\r\n  const [code, setCode] = useState('');\r\n  const [verifying, setVerifying] = useState(false);\r\n  const navigate = useNavigate();\r\n\r\n  const onFinish = async (values: { email: string }) => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await axiosPublic.post('/auth/forgot-password', { email: values.email, mode });\r\n      // server returns generic success message\r\n      notification.success({ message: 'Request sent', description: res.data?.message || 'Check your email for instructions.' });\r\n      setSent(true);\r\n      setSubmittedEmail(values.email);\r\n    } catch (err: any) {\r\n      const msg = err?.response?.data?.message || err.message || 'Failed to send reset email';\r\n      notification.error({ message: 'Error', description: msg });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const handleDigit = (d: string) => {\r\n    if (code.length >= 6) return;\r\n    setCode(prev => prev + d);\r\n  };\r\n  const handleBackspace = () => setCode(prev => prev.slice(0, -1));\r\n  const handleClear = () => setCode('');\r\n\r\n  const submitOtp = async () => {\r\n    if (code.length !== 6) {\r\n      notification.error({ message: 'Enter code', description: 'Please enter the 6-digit code.' });\r\n      return;\r\n    }\r\n    setVerifying(true);\r\n    try {\r\n      // send token to server; server will email a temporary password if token is valid\r\n      const payload: any = { token: code };\r\n      if (submittedEmail) payload.email = submittedEmail;\r\n      const res = await axiosPublic.post('/auth/verify-otp', payload);\r\n      notification.success({ message: 'If valid', description: res.data?.message || 'Check your email for the new temporary password.' });\r\n      // clear input and allow user to go back to login\r\n      setCode('');\r\n      setSent(false);\r\n      setSubmittedEmail(null);\r\n      navigate('/login');\r\n    } catch (err: any) {\r\n      const msg = err?.response?.data?.message || err.message || 'Failed to verify code';\r\n      notification.error({ message: 'Error', description: msg });\r\n    } finally {\r\n      setVerifying(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 24 }}>\r\n      <Card style={{ width: 420, borderRadius: 12 }}>\r\n        <Typography.Title level={3} style={{ textAlign: 'center' }}>Forgot Password</Typography.Title>\r\n        {!sent ? (\r\n          <Form layout=\"vertical\" onFinish={onFinish} requiredMark={false}>\r\n            <Form.Item label=\"Choose how to receive reset instructions\">\r\n              <Radio.Group value={mode} onChange={(e) => setMode(e.target.value)}>\r\n                <Radio value=\"link\">Send reset link (email)</Radio>\r\n                <Radio value=\"otp\">Send 6-digit code (email)</Radio>\r\n              </Radio.Group>\r\n            </Form.Item>\r\n            <Form.Item\r\n              label=\"Email\"\r\n              name=\"email\"\r\n              rules={[{ required: true, message: 'Please input your email' }, { type: 'email', message: 'Please enter a valid email' }]}\r\n            >\r\n              <Input placeholder=\"you@example.com\" size=\"large\" />\r\n            </Form.Item>\r\n            <Form.Item>\r\n              <Button type=\"primary\" htmlType=\"submit\" block loading={loading}>\r\n                {loading ? 'Sending...' : mode === 'otp' ? 'Send code' : 'Send reset link'}\r\n              </Button>\r\n            </Form.Item>\r\n            <Button type=\"link\" block onClick={() => navigate('/login')}>Back to login</Button>\r\n          </Form>\r\n        ) : (\r\n          <div>\r\n            {mode === 'otp' ? (\r\n              <div>\r\n                <Typography.Paragraph>\r\n                  Enter the 6-digit code sent to <strong>{submittedEmail}</strong>\r\n                </Typography.Paragraph>\r\n                <div style={{ display: 'flex', justifyContent: 'center', marginBottom: 12 }}>\r\n                  {Array.from({ length: 6 }).map((_, i) => (\r\n                    <div key={i} style={{ width: 40, height: 48, margin: 4, border: '1px solid #ddd', display: 'flex', alignItems: 'center', justifyContent: 'center', fontSize: 18 }}>\r\n                      {code[i] || ''}\r\n                    </div>\r\n                  ))}\r\n                </div>\r\n                <div style={{ display: 'grid', gridTemplateColumns: 'repeat(3, 1fr)', gap: 8, maxWidth: 300, margin: '0 auto 12px' }}>\r\n                  {['1','2','3','4','5','6','7','8','9','0'].map(d => (\r\n                    <Button key={d} onClick={() => handleDigit(d)} disabled={verifying}>{d}</Button>\r\n                  ))}\r\n                  <Button onClick={handleBackspace} disabled={verifying}></Button>\r\n                  <Button onClick={handleClear} disabled={verifying}>Clear</Button>\r\n                  <Button type=\"primary\" onClick={submitOtp} loading={verifying} disabled={verifying}>Verify</Button>\r\n                </div>\r\n                <Button type=\"link\" block onClick={() => { setSent(false); setSubmittedEmail(null); }}>Back</Button>\r\n              </div>\r\n            ) : (\r\n              <div>\r\n                <Typography.Paragraph>\r\n                  Check your email for password reset instructions.\r\n                </Typography.Paragraph>\r\n                <Button type=\"primary\" block onClick={() => navigate('/login')}>Back to login</Button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ForgotPassword;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { Form, Input, Button, Card, Typography, notification, Progress } from 'antd';\r\nimport { useParams, useNavigate, useLocation } from 'react-router-dom';\r\nimport { axiosPublic } from '../services/api';\r\n\r\nconst ResetPassword: React.FC = () => {\r\n  const { token } = useParams<{ token: string }>();\r\n  const navigate = useNavigate();\r\n  const location = useLocation();\r\n  const search = new URLSearchParams(location.search);\r\n  const mode = search.get('mode'); // 'otp' if user is using code flow\r\n  const [loading, setLoading] = useState(false);\r\n  const [strengthScore, setStrengthScore] = useState<number | null>(null);\r\n  const [strengthLabel, setStrengthLabel] = useState<string>('');\r\n\r\n  const evaluateStrength = (pwd: string) => {\r\n    if (!pwd) {\r\n      setStrengthScore(null);\r\n      setStrengthLabel('');\r\n      return;\r\n    }\r\n    // simple regex-based scoring\r\n    let score = 0;\r\n    if (pwd.length >= 8) score += 2;\r\n    if (/[A-Z]/.test(pwd)) score += 1;\r\n    if (/[a-z]/.test(pwd)) score += 1;\r\n    if (/\\d/.test(pwd)) score += 1;\r\n    if (/[^A-Za-z0-9]/.test(pwd)) score += 1;\r\n    // map to 0..4\r\n    const mapped = Math.min(4, Math.floor((score / 6) * 5));\r\n    const pct = mapped * 20;\r\n    const labels = ['Very weak', 'Weak', 'Fair', 'Good', 'Strong'];\r\n    setStrengthScore(pct);\r\n    setStrengthLabel(labels[mapped] || '');\r\n  };\r\n\r\n  const onFinish = async (values: { password: string; confirm: string; code?: string }) => {\r\n    if (values.password !== values.confirm) {\r\n      notification.error({ message: 'Passwords do not match' });\r\n      return;\r\n    }\r\n    // enforce client-side minimal complexity consistent with server\r\n    const strongPwdRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\\d)(?=.*[^A-Za-z0-9]).{8,}$/;\r\n    if (!strongPwdRegex.test(values.password)) {\r\n      notification.error({ message: 'Password does not meet complexity requirements. Use 8+ chars, mixed case, numbers and symbols.' });\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    try {\r\n      let res;\r\n      // If token is present in URL, use the legacy link endpoint\r\n      if (token) {\r\n        res = await axiosPublic.post(`/auth/reset-password/${token}`, { password: values.password });\r\n      } else if (mode === 'otp') {\r\n        // OTP flow: code is provided by user in a field; submit token in body\r\n        if (!values.code) {\r\n          notification.error({ message: 'Please enter the 6-digit code sent to your email' });\r\n          setLoading(false);\r\n          return;\r\n        }\r\n        res = await axiosPublic.post(`/auth/reset-password`, { token: values.code, password: values.password });\r\n      } else {\r\n        // fallback: attempt body token\r\n        res = await axiosPublic.post(`/auth/reset-password`, { token: values.code || '', password: values.password });\r\n      }\r\n      notification.success({ message: 'Password reset', description: res.data?.message || 'Your password has been reset. Please log in.' });\r\n      navigate('/login');\r\n    } catch (err: any) {\r\n      const msg = err?.response?.data?.message || err.message || 'Failed to reset password';\r\n      notification.error({ message: 'Error', description: msg });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{ minHeight: '100vh', display: 'flex', alignItems: 'center', justifyContent: 'center', padding: 24 }}>\r\n      <Card style={{ width: 420, borderRadius: 12 }}>\r\n        <Typography.Title level={3} style={{ textAlign: 'center' }}>Reset Password</Typography.Title>\r\n        <Form layout=\"vertical\" onFinish={onFinish} requiredMark={false}>\r\n          {mode === 'otp' && !token && (\r\n            <Form.Item\r\n              label=\"6-digit code\"\r\n              name=\"code\"\r\n              rules={[{ required: true, message: 'Please input the 6-digit code sent to your email' }, { len: 6, message: 'Code must be 6 digits' }]}\r\n            >\r\n              <Input placeholder=\"123456\" size=\"large\" />\r\n            </Form.Item>\r\n          )}\r\n          <Form.Item\r\n              label=\"New password\"\r\n              name=\"password\"\r\n              rules={[{ required: true, message: 'Please input your new password' }, { min: 6, message: 'Password must be at least 6 characters' }]}\r\n            >\r\n              <Input.Password size=\"large\" onChange={(e) => evaluateStrength(e.target.value)} />\r\n            </Form.Item>\r\n          {strengthScore !== null && (\r\n            <div style={{ marginBottom: 12 }}>\r\n              <Progress percent={strengthScore} size=\"small\" status={strengthScore < 40 ? 'exception' : 'normal'} />\r\n              <div style={{ textAlign: 'right', fontSize: 12, color: '#666' }}>{strengthLabel}</div>\r\n            </div>\r\n          )}\r\n          <Form.Item\r\n            label=\"Confirm password\"\r\n            name=\"confirm\"\r\n            rules={[{ required: true, message: 'Please confirm your new password' }]}\r\n          >\r\n            <Input.Password size=\"large\" />\r\n          </Form.Item>\r\n          <Form.Item>\r\n            <Button type=\"primary\" htmlType=\"submit\" block loading={loading}>\r\n              {loading ? 'Resetting...' : 'Reset password'}\r\n            </Button>\r\n          </Form.Item>\r\n        </Form>\r\n      </Card>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default ResetPassword;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Card, List, Typography, Avatar, Spin, Button, Space } from 'antd';\r\nimport { BellOutlined, TeamOutlined, CheckCircleOutlined, ArrowLeftOutlined } from '@ant-design/icons';\r\nimport { getInbox, axiosInstance } from '../../services/api';\r\nimport { Notification } from '../../types/notification';\r\nimport { useNavigate } from 'react-router-dom';\r\n\r\nconst { Title, Text } = Typography;\r\n\r\nconst MessageInbox: React.FC = () => {\r\n  // now use messages (inbox) which includes verification request messages\r\n  const [messages, setMessages] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const navigate = useNavigate();\r\n\r\n  const fetchNotifications = async () => {\r\n    setLoading(true);\r\n    try {\r\n  const resp = await getInbox();\r\n  const data = resp && resp.data ? resp.data : [];\r\n  setMessages(Array.isArray(data) ? data : []);\r\n    } catch (err) {\r\n      console.error('Failed to fetch inbox messages', err);\r\n      setMessages([]);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchNotifications();\r\n  }, []);\r\n\r\n  const handleMarkAsRead = async (msg: any) => {\r\n    if (!msg._id || msg.status === 'read') return;\r\n    setLoading(true);\r\n    try {\r\n      // mark the message as read via messages endpoint\r\n      await axiosInstance.patch(`/messages/${msg._id}/read`);\r\n      await fetchNotifications();\r\n    } catch (err) {\r\n      // Optionally show error\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <Spin spinning={loading}>\r\n      <div style={{ padding: 24, backgroundColor: '#f0f2f5', minHeight: '100vh' }}>\r\n        <Space style={{ marginBottom: 24 }}>\r\n          <Button type=\"default\" icon={<ArrowLeftOutlined />} onClick={() => navigate('/admin/dashboard')}>\r\n            Back to Dashboard\r\n          </Button>\r\n          <Title level={4} style={{ marginBottom: 0 }}>Message Inbox</Title>\r\n        </Space>\r\n        <Card>\r\n          <List\r\n            dataSource={Array.isArray(messages) ? messages : []}\r\n            renderItem={notification => (\r\n              <List.Item\r\n                actions={[\r\n                  notification.status === 'unread' && (\r\n                    <Button\r\n                      size=\"small\"\r\n                      icon={<CheckCircleOutlined />}\r\n                      onClick={() => handleMarkAsRead(notification)}\r\n                    >Mark Read</Button>\r\n                  )\r\n                ].filter(Boolean)}\r\n              >\r\n                <List.Item.Meta\r\n                  avatar={<Avatar icon={<BellOutlined />} style={{ backgroundColor: notification.status === 'read' ? '#8c8c8c' : '#1890ff' }} />}\r\n                  title={<Text strong>{notification.subject}</Text>}\r\n                  description={\r\n                    <div>\r\n                      <Text type=\"secondary\">{new Date(notification.createdAt).toLocaleString()}</Text>\r\n                      {/* Show body for verification requests */}\r\n                      {notification.subject === 'New Verification Request' && (\r\n                        <div style={{ marginTop: 8 }}>\r\n                          <Text strong>Verification request submitted.</Text>\r\n                          <div>{notification.body}</div>\r\n                        </div>\r\n                      )}\r\n                    </div>\r\n                  }\r\n                />\r\n              </List.Item>\r\n            )}\r\n            locale={{ emptyText: 'No notifications' }}\r\n          />\r\n        </Card>\r\n      </div>\r\n    </Spin>\r\n  );\r\n};\r\n\r\nexport default MessageInbox;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Table, Typography, Spin } from 'antd';\r\nimport { documentsAPI } from '../services/api';\r\nimport { formatDate as formatDateUtil } from '../utils/formatDate';\r\n\r\nconst DocumentHistory: React.FC = () => {\r\n  const [history, setHistory] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  useEffect(() => {\r\n    const fetchHistory = async () => {\r\n      setLoading(true);\r\n      try {\r\n        // Fetch all completed/rejected document requests\r\n        const requests = await documentsAPI.getAllDocuments();\r\n        const filtered = (requests || []).filter((r: any) => {\r\n          const status = r.status && r.status.toLowerCase();\r\n          return status === 'rejected' || status === 'completed' || status === 'approved';\r\n        });\r\n        setHistory(filtered);\r\n      } catch {\r\n        setHistory([]);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n    fetchHistory();\r\n  }, []);\r\n\r\n  return (\r\n    <div style={{ maxWidth: 2000, margin: '12px auto', padding: '0 16px' }}>\r\n      <Typography.Title level={3} style={{ marginTop: 8, marginBottom: 12 }}>Document History</Typography.Title>\r\n      {loading ? <Spin /> : (\r\n        <Table\r\n          dataSource={history}\r\n          rowKey=\"_id\"\r\n          pagination={{ pageSize: 8 }}\r\n          columns={[\r\n            { title: 'Requester Name', dataIndex: 'username', key: 'username', render: (text: string) => text || 'Unknown' },\r\n            { title: 'Transactional ID', dataIndex: 'transactionCode', key: 'transactionCode', render: (text: string) => text || '' },\r\n            { title: 'Type', dataIndex: 'type', key: 'type', render: (text: string) => text || 'Unknown' },\r\n            { title: 'Date Approved', dataIndex: 'completedAt', key: 'completedAt', render: (text: string, record: any) => {\r\n                const date = text || record.dateApproved || record.completedAt || record.approvedAt || null;\r\n                if (!date) return '';\r\n                try {\r\n                  return formatDateUtil(date);\r\n                } catch {\r\n                  return String(date);\r\n                }\r\n              }\r\n            },\r\n            { title: 'Status', dataIndex: 'status', key: 'status', render: (text: string, record: any) => {\r\n                // Prefer the staff's fullName when available, fall back to username, then Unknown\r\n                const staffName = record.processedBy?.fullName || record.processedBy?.username || 'Unknown';\r\n                const staffBarangayID = record.processedBy?.barangayID || 'Unknown';\r\n                if (text && text.toLowerCase() === 'rejected') {\r\n                  return <span style={{ color: '#FF3B3B', fontWeight: 600 }}>Rejected by: {staffName} ({staffBarangayID})</span>;\r\n                } else if (text && (text.toLowerCase() === 'completed' || text.toLowerCase() === 'approved')) {\r\n                  return <span style={{ color: '#43D96B', fontWeight: 600 }}>Completed by: {staffName} ({staffBarangayID})</span>;\r\n                } else {\r\n                  return <span>{text}</span>;\r\n                }\r\n              }\r\n            }\r\n          ]}\r\n        />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DocumentHistory;\r\n","import React, { useState, useEffect } from 'react';\r\nimport { useAuth } from '../../contexts/AuthContext';\r\nimport { Card, Input, Upload, Button, message, Typography, List, Popconfirm, Image, Modal, Space, Tooltip } from 'antd';\r\nimport { UploadOutlined, CheckCircleOutlined, CloseCircleOutlined, DeleteOutlined, EyeOutlined, EditOutlined } from '@ant-design/icons';\r\nimport { adminAPI, getAbsoluteApiUrl } from '../../services/api';\r\n\r\nconst { TextArea } = Input;\r\n\r\nconst Announcements: React.FC = () => {\r\n  const [text, setText] = useState('');\r\n  const [file, setFile] = useState<File | null>(null);\r\n  const [submitting, setSubmitting] = useState(false);\r\n  const [anns, setAnns] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [viewing, setViewing] = useState<any | null>(null);\r\n  const [editing, setEditing] = useState<any | null>(null);\r\n  const [editText, setEditText] = useState('');\r\n  const [editFile, setEditFile] = useState<File | null>(null);\r\n\r\n  const { user } = useAuth();\r\n\r\n  const loadAnns = async () => {\r\n    // Avoid calling admin endpoint when user isn't admin or no token available\r\n    if (!user || user.role !== 'admin') return;\r\n    const token = localStorage.getItem('token');\r\n    if (!token) {\r\n      // No token - likely not logged in yet\r\n      return;\r\n    }\r\n    setLoading(true);\r\n    try {\r\n      const data = await adminAPI.listAdminAnnouncements();\r\n      setAnns(Array.isArray(data) ? data : []);\r\n    } catch (err: any) {\r\n      // Handle 401 explicitly\r\n      if (err?.response?.status === 401) {\r\n        message.error('Not authorized. Please sign in as an admin.');\r\n      } else {\r\n        console.error('Failed to load announcements', err);\r\n        message.error('Failed to load announcements');\r\n      }\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  // Load admin announcements only when we have an authenticated admin user\r\n  useEffect(() => {\r\n    if (user?.role === 'admin') {\r\n      loadAnns();\r\n    }\r\n  }, [user]);\r\n\r\n  const beforeUpload = (f: File) => {\r\n    // accept only images\r\n    const isImage = f.type.startsWith('image/');\r\n    if (!isImage) {\r\n      message.error('Only image files are allowed');\r\n      return Upload.LIST_IGNORE;\r\n    }\r\n    // keep single file\r\n    setFile(f);\r\n    return Upload.LIST_IGNORE; // Prevent auto upload\r\n  };\r\n\r\n  const removeFile = () => setFile(null);\r\n\r\n  const beforeEditUpload = (f: File) => {\r\n    const isImage = f.type.startsWith('image/');\r\n    if (!isImage) {\r\n      message.error('Only image files are allowed');\r\n      return Upload.LIST_IGNORE;\r\n    }\r\n    setEditFile(f);\r\n    return Upload.LIST_IGNORE;\r\n  };\r\n\r\n  const handleSubmit = async () => {\r\n    if (!text || text.trim() === '') return message.warning('Announcement text cannot be empty');\r\n    setSubmitting(true);\r\n    try {\r\n      const form = new FormData();\r\n      form.append('text', text.trim());\r\n      if (file) form.append('image', file, file.name);\r\n      // POST to admin announcements endpoint\r\n      await adminAPI.createAnnouncement(form);\r\n      message.success('Announcement posted');\r\n      setText('');\r\n      setFile(null);\r\n    } catch (err: any) {\r\n      console.error('Failed to post announcement', err);\r\n      message.error(err?.response?.data?.message || 'Failed to post announcement');\r\n    } finally {\r\n      setSubmitting(false);\r\n    }\r\n  };\r\n\r\n  const openView = (item: any) => setViewing(item);\r\n\r\n  const openEdit = (item: any) => {\r\n    setEditing(item);\r\n    setEditText(item.text || '');\r\n    setEditFile(null);\r\n  };\r\n\r\n  const handleEditSave = async () => {\r\n    if (!editing) return;\r\n    try {\r\n      const form = new FormData();\r\n      form.append('text', editText.trim());\r\n      if (editFile) form.append('image', editFile, editFile.name);\r\n      await adminAPI.updateAnnouncement(editing._id, form);\r\n      message.success('Updated');\r\n      setEditing(null);\r\n      setEditFile(null);\r\n      setEditText('');\r\n      loadAnns();\r\n    } catch (err) {\r\n      console.error(err);\r\n      message.error('Update failed');\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      <Card title={<Typography.Title level={4} style={{ margin: 0 }}>{user?.role === 'admin' ? 'Post Announcement' : 'Announcements'}</Typography.Title>}>\r\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\r\n          {/* Show create form only to admins */}\r\n          {user?.role === 'admin' && (\r\n            <>\r\n              <TextArea value={text} onChange={e => setText(e.target.value)} rows={6} placeholder=\"Write your announcement here\" />\r\n\r\n              <Upload beforeUpload={beforeUpload} onRemove={removeFile} accept=\"image/*\" maxCount={1} showUploadList={{ showPreviewIcon: false }}>\r\n                <Button icon={<UploadOutlined />}>Upload Image (optional)</Button>\r\n              </Upload>\r\n\r\n              {/* Image upload confirmation */}\r\n              {file && (\r\n                <div style={{ display: 'flex', alignItems: 'center', gap: 8, color: '#237804' }}>\r\n                  <CheckCircleOutlined style={{ color: '#52c41a' }} />\r\n                  <span style={{ fontWeight: 600 }}>Image uploaded:</span>\r\n                  <span style={{ marginLeft: 6 }}>{file.name}</span>\r\n                  <Button type=\"text\" icon={<CloseCircleOutlined />} onClick={removeFile} style={{ marginLeft: 8 }} />\r\n                </div>\r\n              )}\r\n\r\n              <div style={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n                <Button type=\"primary\" onClick={handleSubmit} loading={submitting} disabled={!text.trim()}>\r\n                  Post Announcement\r\n                </Button>\r\n              </div>\r\n            </>\r\n          )}\r\n\r\n          <div style={{ marginTop: 12 }}>\r\n            <Typography.Title level={5} style={{ marginBottom: 8 }}>Existing Announcements</Typography.Title>\r\n            <List\r\n              loading={loading}\r\n              dataSource={anns}\r\n              renderItem={item => (\r\n                <List.Item actions={\r\n                  [\r\n                    <Tooltip key=\"view\" title=\"View\" placement=\"top\">\r\n                      <Button shape=\"circle\" size=\"small\" icon={<EyeOutlined />} onClick={() => openView(item)} aria-label={`View announcement ${item._id}`} />\r\n                    </Tooltip>,\r\n                    user?.role === 'admin' ? (\r\n                      <Tooltip key=\"edit\" title=\"Edit\" placement=\"top\">\r\n                        <Button shape=\"circle\" size=\"small\" icon={<EditOutlined />} onClick={() => openEdit(item)} aria-label={`Edit announcement ${item._id}`} />\r\n                      </Tooltip>\r\n                    ) : null,\r\n                    user?.role === 'admin' ? (\r\n                      <Popconfirm key=\"del\" title=\"Delete announcement?\" onConfirm={async () => {\r\n                        try {\r\n                          await adminAPI.deleteAnnouncement(item._id);\r\n                          message.success('Deleted');\r\n                          loadAnns();\r\n                        } catch (err) {\r\n                          console.error(err);\r\n                          message.error('Delete failed');\r\n                        }\r\n                      }}>\r\n                        <Tooltip title=\"Delete\" placement=\"top\">\r\n                          <Button danger shape=\"circle\" size=\"small\" icon={<DeleteOutlined />} aria-label={`Delete announcement ${item._id}`} />\r\n                        </Tooltip>\r\n                      </Popconfirm>\r\n                    ) : null\r\n                  ].filter(Boolean) as any\r\n                }>\r\n                  <List.Item.Meta title={new Date(item.createdAt).toLocaleString()} description={item.text} />\r\n                  {item.imagePath && <Image className=\"rounded-img\" width={80} src={getAbsoluteApiUrl(`/announcements/${item._id}/image`)} />}\r\n                </List.Item>\r\n              )}\r\n            />\r\n          </div>\r\n        </div>\r\n      </Card>\r\n\r\n      {/* View Modal */}\r\n      <Modal\r\n        title={viewing ? `Announcement - ${new Date(viewing.createdAt).toLocaleString()}` : 'Announcement'}\r\n        open={!!viewing}\r\n        onCancel={() => setViewing(null)}\r\n        footer={[<Button key=\"close\" onClick={() => setViewing(null)}>Close</Button>]}\r\n      >\r\n        {viewing && (\r\n          <div>\r\n            <p>{viewing.text}</p>\r\n            {viewing.imagePath && <Image className=\"rounded-img rounded-img-lg\" src={getAbsoluteApiUrl(`/announcements/${viewing._id}/image`)} width={320} />}\r\n          </div>\r\n        )}\r\n      </Modal>\r\n\r\n      {/* Edit Modal */}\r\n      <Modal\r\n        title={`Edit Announcement`}\r\n        open={!!editing}\r\n        onCancel={() => { setEditing(null); setEditFile(null); setEditText(''); }}\r\n        onOk={handleEditSave}\r\n        okText=\"Save\"\r\n      >\r\n        <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\r\n          <TextArea value={editText} onChange={e => setEditText(e.target.value)} rows={6} />\r\n          <Upload beforeUpload={beforeEditUpload} onRemove={() => setEditFile(null)} accept=\"image/*\" maxCount={1} showUploadList={{ showPreviewIcon: false }}>\r\n            <Button icon={<UploadOutlined />}>Replace Image</Button>\r\n          </Upload>\r\n          {editFile && (\r\n            <div style={{ display: 'flex', alignItems: 'center', gap: 8, color: '#237804' }}>\r\n              <CheckCircleOutlined style={{ color: '#52c41a' }} />\r\n              <span style={{ fontWeight: 600 }}>New image selected:</span>\r\n              <span style={{ marginLeft: 6 }}>{editFile?.name}</span>\r\n              <Button type=\"text\" icon={<CloseCircleOutlined />} onClick={() => setEditFile(null)} style={{ marginLeft: 8 }} />\r\n            </div>\r\n          )}\r\n        </div>\r\n      </Modal>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default Announcements;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Card, List, Typography, Modal, Image, Empty } from 'antd';\r\nimport { contactAPI, getAbsoluteApiUrl } from '../services/api';\r\n\r\nconst { Title, Paragraph } = Typography;\r\n\r\nconst AnnouncementsList: React.FC = () => {\r\n  const [anns, setAnns] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n  const [selected, setSelected] = useState<any | null>(null);\r\n\r\n  const fetch = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const data = await contactAPI.getAnnouncements();\r\n      setAnns(Array.isArray(data) ? data : []);\r\n    } catch (err) {\r\n      console.error('Failed to load announcements', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => { fetch(); }, []);\r\n\r\n  return (\r\n    <Card title={<Title level={4} style={{ margin: 0 }}>Announcements</Title>}>\r\n      {anns.length === 0 ? (\r\n        <Empty description=\"No announcements\" />\r\n      ) : (\r\n        <List\r\n          loading={loading}\r\n          dataSource={anns}\r\n          renderItem={item => (\r\n            <List.Item style={{ cursor: 'pointer', display: 'flex', alignItems: 'center', justifyContent: 'space-between' }} onClick={() => setSelected(item)}>\r\n              <div style={{ flex: 1, minWidth: 0 }}>\r\n                <List.Item.Meta\r\n                  title={<div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                    <span>{new Date(item.createdAt).toLocaleString()}</span>\r\n                  </div>}\r\n                  description={<Paragraph ellipsis={{ rows: 2 }}>{item.text}</Paragraph>}\r\n                />\r\n              </div>\r\n              {item.imagePath && (\r\n                <div style={{ marginLeft: 12, width: 80, display: 'flex', justifyContent: 'flex-end' }}>\r\n                  <Image className=\"rounded-img\" width={72} height={48} src={getAbsoluteApiUrl(`/announcements/${item._id}/image`)} alt=\"announcement\" preview={false} />\r\n                </div>\r\n              )}\r\n            </List.Item>\r\n          )}\r\n        />\r\n      )}\r\n\r\n      <Modal open={!!selected} onCancel={() => setSelected(null)} footer={null} title=\"Announcement\">\r\n            {selected && (\r\n              <div>\r\n                <Paragraph>{selected.text}</Paragraph>\r\n                {selected.imagePath && (\r\n                  <Image className=\"rounded-img rounded-img-lg\" src={getAbsoluteApiUrl(`/announcements/${selected._id}/image`)} alt=\"announcement\" />\r\n                )}\r\n              </div>\r\n            )}\r\n      </Modal>\r\n    </Card>\r\n  );\r\n};\r\n\r\nexport default AnnouncementsList;\r\n","import React, { useEffect, useState } from 'react';\r\nimport { Table, Button, Space, Tag, message, Spin } from 'antd';\r\nimport { verificationAPI, getAbsoluteApiUrl } from '../../services/api';\r\n\r\ninterface IVReq {\r\n  _id: string;\r\n  userId: any;\r\n  files: string[];\r\n  gridFileIds: string[];\r\n  status: string;\r\n  createdAt: string;\r\n}\r\n\r\nconst VerificationRequests: React.FC = () => {\r\n  const [data, setData] = useState<IVReq[]>([]);\r\n  const [loading, setLoading] = useState(false);\r\n\r\n  const load = async () => {\r\n    setLoading(true);\r\n    try {\r\n      const res = await verificationAPI.getRequests();\r\n      setData(Array.isArray(res) ? res : []);\r\n    } catch (err) {\r\n      console.error(err);\r\n      message.error('Failed to load verification requests');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => { load(); }, []);\r\n\r\n  const approve = async (userId: string) => {\r\n    setLoading(true);\r\n    try {\r\n      await verificationAPI.verifyUser(userId, true);\r\n      message.success('User verified');\r\n      await load();\r\n    } catch (err) {\r\n      console.error(err);\r\n      message.error('Failed to verify user');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const reject = async (record: IVReq) => {\r\n    setLoading(true);\r\n    try {\r\n      // Try to call rejectRequest if request id available, then flip user's verified flag\r\n      if (record && record._id) {\r\n        try { await verificationAPI.rejectRequest(record._id); } catch (e) { /* best-effort */ }\r\n      }\r\n      const userId = record.userId?._id || record.userId;\r\n      if (userId) await verificationAPI.verifyUser(userId, false);\r\n      message.success('Verification request rejected');\r\n      await load();\r\n    } catch (err) {\r\n      console.error(err);\r\n      message.error('Failed to reject verification');\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const columns = [\r\n    {\r\n      title: 'Resident',\r\n      dataIndex: 'userId',\r\n      key: 'user',\r\n      render: (u: any) => u ? (u.fullName || u.username || u.email) : 'Unknown'\r\n    },\r\n    { title: 'Status', dataIndex: 'status', key: 'status', render: (s: string) => <Tag color={s === 'pending' ? 'orange' : s === 'approved' ? 'green' : 'red'}>{s}</Tag> },\r\n    { title: 'Submitted', dataIndex: 'createdAt', key: 'createdAt', render: (d: string) => new Date(d).toLocaleString() },\r\n    { title: 'Files', dataIndex: 'gridFileIds', key: 'files', render: (ids: string[]) => (\r\n      <Space>\r\n        {ids && ids.map((id: string) => (\r\n          <Button key={id} type=\"link\" href={getAbsoluteApiUrl(`/verification/file/${id}`)} target=\"_blank\">Open</Button>\r\n        ))}\r\n      </Space>\r\n    ) },\r\n    { title: 'Action', key: 'action', render: (_: any, record: IVReq) => (\r\n      <Space>\r\n        <Button onClick={() => approve(record.userId._id || record.userId)} type=\"primary\">Verify</Button>\r\n        <Button danger onClick={() => reject(record)}>Reject</Button>\r\n        <Button type=\"link\" href={getAbsoluteApiUrl(`/verification/file/${(record.gridFileIds && record.gridFileIds[0]) || ''}`)} target=\"_blank\">Check ID</Button>\r\n      </Space>\r\n    ) }\r\n  ];\r\n\r\n  return (\r\n    <div style={{ padding: 24 }}>\r\n      <h2>Verification Requests</h2>\r\n      <Spin spinning={loading}>\r\n        <Table rowKey=\"_id\" loading={loading} dataSource={data} columns={columns as any} />\r\n      </Spin>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VerificationRequests;\r\n","import { createTheme } from '@mui/material/styles';\r\n\r\nconst theme = createTheme({\r\n  palette: {\r\n    primary: {\r\n      main: '#1976d2',\r\n      light: '#42a5f5',\r\n      dark: '#1565c0',\r\n    },\r\n    secondary: {\r\n      main: '#9c27b0',\r\n      light: '#ba68c8',\r\n      dark: '#7b1fa2',\r\n    },\r\n  },\r\n  typography: {\r\n    fontFamily: [\r\n      '-apple-system',\r\n      'BlinkMacSystemFont',\r\n      '\"Segoe UI\"',\r\n      'Roboto',\r\n      '\"Helvetica Neue\"',\r\n      'Arial',\r\n      'sans-serif',\r\n    ].join(','),\r\n  },\r\n  components: {\r\n    MuiButton: {\r\n      styleOverrides: {\r\n        root: {\r\n          textTransform: 'none',\r\n        },\r\n      },\r\n    },\r\n    MuiPaper: {\r\n      styleOverrides: {\r\n        root: {\r\n          borderRadius: 8,\r\n        },\r\n      },\r\n    },\r\n  },\r\n});\r\n\r\nexport default theme;\r\n","import Inbox from './pages/inbox';\nimport type { FC } from 'react';\nimport React from 'react';\nimport TemplatesManager from './components/TemplatesManager';\nimport StaffInbox from './pages/staffInbox';\nimport { BrowserRouter as Router, Route, Routes, Navigate } from 'react-router-dom';\nimport { ThemeProvider } from '@mui/material/styles';\nimport CssBaseline from '@mui/material/CssBaseline';\nimport { ConfigProvider } from 'antd';\nimport { AuthProvider, useAuth } from './contexts/AuthContext';\nimport Layout from './components/Layout';\nimport PrivateRoute from './components/PrivateRoute';\nimport StaffRoute from './components/StaffRoute';\nimport AdminRoute from './components/AdminRoute';\nimport MinimalChart from './components/MinimalChart';\n\n// Pages\nimport LoginForm from './components/LoginForm';\nimport RegisterForm from './components/RegisterForm';\nimport Dashboard from './components/Dashboard';\nimport GuestDashboard from './components/GuestDashboard';\nimport StaffDashboard from './components/StaffDashboard';\nimport AdminDashboard from './components/admin/AdminDashboard';\nimport UserManagement from './components/admin/UserManagement';\nimport ActivityLogs from './components/admin/ActivityLogs';\nimport Statistics from './components/admin/Statistics';\nimport SystemSettings from './components/admin/SystemSettings';\nimport DocumentRequestForm from './components/DocumentRequestForm';\nimport InquiryForm from './components/InquiryForm';\nimport Goodbye from './components/Goodbye';\nimport Logout from './components/Logout';\nimport InquiryTracker from './pages/InquiryTracker';\nimport ResidentPortal from './components/ResidentPortal';\nimport LandingPage from './components/LandingPage';\nimport ForgotPassword from './pages/ForgotPassword';\nimport ResetPassword from './pages/ResetPassword';\nimport MessageInbox from './components/admin/MessageInbox';\nimport DocumentHistory from './components/DocumentHistory';\nimport Announcements from './components/admin/Announcements';\nimport AnnouncementsList from './components/AnnouncementsList';\nimport VerificationRequests from './components/admin/VerificationRequests';\nimport theme from './theme';\n\nconst RootRedirect: React.FC = () => {\n  const { user } = useAuth();\n  if (!user) {\n    return <Navigate to=\"/login\" replace />;\n  }\n  if (user.role === 'admin') {\n    return <Navigate to=\"/admin/dashboard\" replace />;\n  }\n  if (user.role === 'staff') {\n    return <Navigate to=\"/staff-dashboard\" replace />;\n  }\n  return <Navigate to=\"/dashboard\" replace />;\n};\n\ninterface AppProps {}\n\nconst App: FC<AppProps> = () => {\n  return (\n    <ThemeProvider theme={theme}>\n      <CssBaseline />\n      <ConfigProvider>\n        <Router>\n          <AuthProvider>\n            <Routes>\n              {/* Landing Page as root */}\n              <Route path=\"/\" element={<LandingPage />} />\n              <Route path=\"/redirect\" element={<RootRedirect />} />\n              {/* Public Routes */}\n              <Route path=\"/login\" element={<LoginForm />} />\n              <Route path=\"/forgot-password\" element={<ForgotPassword />} />\n              <Route path=\"/reset-password/:token\" element={<ResetPassword />} />\n              <Route path=\"/register\" element={<RegisterForm />} />\n              <Route path=\"/goodbye\" element={<Goodbye />} />\n              <Route path=\"/logout\" element={<Logout />} />\n              {/* Protected Routes (with Layout) */}\n              <Route element={<Layout />}>\n                {/* Added for sidebar navigation */}\n                <Route path=\"/home\" element={<PrivateRoute><Dashboard /></PrivateRoute>} />\n                <Route path=\"/request\" element={<PrivateRoute><DocumentRequestForm /></PrivateRoute>} />\n                <Route path=\"/dashboard\" element={<PrivateRoute><Dashboard /></PrivateRoute>} />\n                <Route path=\"/guest/dashboard\" element={<PrivateRoute><GuestDashboard /></PrivateRoute>} />\n                <Route path=\"/request-document\" element={<PrivateRoute><DocumentRequestForm /></PrivateRoute>} />\n                <Route path=\"/contact\" element={<PrivateRoute><InquiryForm /></PrivateRoute>} />\n                <Route path=\"/inquiries\" element={<PrivateRoute><InquiryForm /></PrivateRoute>} />\n                <Route path=\"/inquiry-tracker\" element={<StaffRoute><InquiryTracker /></StaffRoute>} />\n                {/* Staff Routes */}\n                <Route path=\"/staff-dashboard\" element={<StaffRoute><StaffDashboard /></StaffRoute>} />\n                <Route path=\"/document-processing\" element={<StaffRoute>{React.createElement(require('./components/DocumentProcessing').default)}</StaffRoute>} />\n                <Route path=\"/templates-manager\" element={<StaffRoute><TemplatesManager /></StaffRoute>} />\n                <Route path=\"/staff/inbox\" element={<StaffRoute><StaffInbox /></StaffRoute>} />\n                {/* Admin Routes */}\n                <Route path=\"/admin/dashboard\" element={<AdminRoute><AdminDashboard /></AdminRoute>} />\n                <Route path=\"/admin/messages\" element={<AdminRoute><MessageInbox /></AdminRoute>} />\n                <Route path=\"/admin/verification-requests\" element={<AdminRoute><VerificationRequests /></AdminRoute>} />\n                {/* Announcements listing for residents/staff */}\n                <Route path=\"/announcements\" element={<PrivateRoute><AnnouncementsList /></PrivateRoute>} />\n                {/* Admin-only announcement compose page */}\n                <Route path=\"/admin/announcements\" element={<AdminRoute><Announcements /></AdminRoute>} />\n                <Route path=\"/admin\" element={<Navigate to=\"/admin/dashboard\" replace />} />\n                <Route path=\"/admin/users\" element={<AdminRoute><UserManagement /></AdminRoute>} />\n                <Route path=\"/admin/activity\" element={<AdminRoute><ActivityLogs /></AdminRoute>} />\n                <Route path=\"/admin/statistics\" element={<AdminRoute><Statistics /></AdminRoute>} />\n                <Route path=\"/admin/settings\" element={<AdminRoute><SystemSettings /></AdminRoute>} />\n                {/* Resident Profile Route */}\n                <Route path=\"/profile\" element={<PrivateRoute><ResidentPortal /></PrivateRoute>} />\n                <Route path=\"/document-history\" element={<PrivateRoute><DocumentHistory /></PrivateRoute>} />\n                <Route path=\"/inbox\" element={<PrivateRoute><Inbox /></PrivateRoute>} />\n              </Route>\n            </Routes>\n          </AuthProvider>\n        </Router>\n      </ConfigProvider>\n    </ThemeProvider>\n  );\n};\n\nexport type { AppProps };\nexport default App;\n","import { openDB, DBSchema, IDBPDatabase } from 'idb';\r\n\r\ninterface BarangayDB extends DBSchema {\r\n  users: {\r\n    key: string;\r\n    value: any;\r\n    indexes: { 'by-email': string };\r\n  };\r\n  documents: {\r\n    key: string;\r\n    value: any;\r\n    indexes: { 'by-user': string };\r\n  };\r\n  syncQueue: {\r\n    key: string;\r\n    value: {\r\n      operation: 'create' | 'update' | 'delete';\r\n      collection: string;\r\n      data: any;\r\n      timestamp: number;\r\n    };\r\n  };\r\n}\r\n\r\nclass LocalDatabase {\r\n  private db: IDBPDatabase<BarangayDB> | null = null;\r\n  private static instance: LocalDatabase;\r\n\r\n  private constructor() {}\r\n\r\n  static getInstance(): LocalDatabase {\r\n    if (!LocalDatabase.instance) {\r\n      LocalDatabase.instance = new LocalDatabase();\r\n    }\r\n    return LocalDatabase.instance;\r\n  }\r\n\r\n  async initialize(): Promise<void> {\r\n    this.db = await openDB<BarangayDB>('barangay-system', 1, {\r\n      upgrade(db) {\r\n        // Users store\r\n        if (!db.objectStoreNames.contains('users')) {\r\n          const userStore = db.createObjectStore('users', { keyPath: '_id' });\r\n          userStore.createIndex('by-email', 'email');\r\n        }\r\n\r\n        // Documents store\r\n        if (!db.objectStoreNames.contains('documents')) {\r\n          const docStore = db.createObjectStore('documents', { keyPath: '_id' });\r\n          docStore.createIndex('by-user', 'userId');\r\n        }\r\n\r\n        // Sync queue store\r\n        if (!db.objectStoreNames.contains('syncQueue')) {\r\n          db.createObjectStore('syncQueue', { \r\n            keyPath: '_id',\r\n            autoIncrement: true \r\n          });\r\n        }\r\n      },\r\n    });\r\n  }\r\n\r\n  async addToSyncQueue(operation: 'create' | 'update' | 'delete', collection: string, data: any): Promise<void> {\r\n    if (!this.db) await this.initialize();\r\n    await this.db!.add('syncQueue', {\r\n      operation,\r\n      collection,\r\n      data,\r\n      timestamp: Date.now()\r\n    });\r\n  }\r\n\r\n  async getAllFromSyncQueue(): Promise<any[]> {\r\n    if (!this.db) await this.initialize();\r\n    return this.db!.getAll('syncQueue');\r\n  }\r\n\r\n  async clearSyncQueue(): Promise<void> {\r\n    if (!this.db) await this.initialize();\r\n    const tx = this.db!.transaction('syncQueue', 'readwrite');\r\n    await tx.objectStore('syncQueue').clear();\r\n  }\r\n\r\n  // Users\r\n  async saveUser(user: any): Promise<void> {\r\n    if (!this.db) await this.initialize();\r\n    await this.db!.put('users', user);\r\n  }\r\n\r\n  async getUser(id: string): Promise<any | undefined> {\r\n    if (!this.db) await this.initialize();\r\n    return this.db!.get('users', id);\r\n  }\r\n\r\n  async getAllUsers(): Promise<any[]> {\r\n    if (!this.db) await this.initialize();\r\n    return this.db!.getAll('users');\r\n  }\r\n\r\n  async deleteUser(id: string): Promise<void> {\r\n    if (!this.db) await this.initialize();\r\n    await this.db!.delete('users', id);\r\n  }\r\n\r\n  // Documents\r\n  async saveDocument(document: any): Promise<void> {\r\n    if (!this.db) await this.initialize();\r\n    await this.db!.put('documents', document);\r\n  }\r\n\r\n  async getDocument(id: string): Promise<any | undefined> {\r\n    if (!this.db) await this.initialize();\r\n    return this.db!.get('documents', id);\r\n  }\r\n\r\n  async getAllDocuments(): Promise<any[]> {\r\n    if (!this.db) await this.initialize();\r\n    return this.db!.getAll('documents');\r\n  }\r\n\r\n  async deleteDocument(id: string): Promise<void> {\r\n    if (!this.db) await this.initialize();\r\n    await this.db!.delete('documents', id);\r\n  }\r\n\r\n  // Settings\r\n  async saveSettings(settings: any): Promise<void> {\r\n    if (!this.db) await this.initialize();\r\n    await this.db!.put('users', { _id: 'settings', ...settings });\r\n  }\r\n\r\n  async getSettings(): Promise<any | undefined> {\r\n    if (!this.db) await this.initialize();\r\n    return this.db!.get('users', 'settings');\r\n  }\r\n}\r\n\r\nexport const localDB = LocalDatabase.getInstance();\r\n","import { localDB } from './localDatabase';\r\nimport { axiosInstance } from './api';\r\n\r\nclass SyncService {\r\n  private static instance: SyncService;\r\n  private isOnline: boolean = navigator.onLine;\r\n  private syncInterval: NodeJS.Timeout | null = null;\r\n\r\n  private constructor() {\r\n    this.setupEventListeners();\r\n    this.startSyncInterval();\r\n  }\r\n\r\n  static getInstance(): SyncService {\r\n    if (!SyncService.instance) {\r\n      SyncService.instance = new SyncService();\r\n    }\r\n    return SyncService.instance;\r\n  }\r\n\r\n  private setupEventListeners(): void {\r\n    window.addEventListener('online', this.handleOnline);\r\n    window.addEventListener('offline', this.handleOffline);\r\n  }\r\n\r\n  private handleOnline = async (): Promise<void> => {\r\n    this.isOnline = true;\r\n    console.log('Connection restored. Starting sync...');\r\n    await this.syncWithServer();\r\n  };\r\n\r\n  private handleOffline = (): void => {\r\n    this.isOnline = false;\r\n    console.log('Connection lost. Operating in offline mode...');\r\n  };\r\n\r\n  private startSyncInterval(): void {\r\n    if (this.syncInterval) return;\r\n    \r\n    // Attempt to sync every 5 minutes when online\r\n    this.syncInterval = setInterval(async () => {\r\n      if (this.isOnline) {\r\n        await this.syncWithServer();\r\n      }\r\n    }, 5 * 60 * 1000);\r\n  }\r\n\r\n  private async syncWithServer(): Promise<void> {\r\n    try {\r\n      const pendingChanges = await localDB.getAllFromSyncQueue();\r\n      if (pendingChanges.length === 0) return;\r\n      console.log(`Syncing ${pendingChanges.length} pending changes...`);\r\n      for (const change of pendingChanges) {\r\n        try {\r\n          await this.processSyncItem(change);\r\n        } catch (error) {\r\n          if (error && typeof error === 'object' && 'message' in error && typeof (error as any).message === 'string') {\r\n            console.error(`Failed to sync item:`, change, error);\r\n            if ((error as any).message === 'Network Error') {\r\n              this.isOnline = false;\r\n              break;\r\n            }\r\n          } else {\r\n            console.error(`Failed to sync item:`, change, error);\r\n          }\r\n        }\r\n      }\r\n      // Clear successfully synced items\r\n      await localDB.clearSyncQueue();\r\n    } catch (error) {\r\n      if (error && typeof error === 'object' && 'message' in error && typeof (error as any).message === 'string') {\r\n        console.error('Sync failed:', (error as any).message);\r\n      } else {\r\n        console.error('Sync failed:', error);\r\n      }\r\n    }\r\n  }\r\n\r\n  private async processSyncItem(item: any): Promise<void> {\r\n    const { operation, collection, data } = item;\r\n    \r\n    switch (operation) {\r\n      case 'create':\r\n        await axiosInstance.post(`/${collection}`, data);\r\n        break;\r\n      \r\n      case 'update':\r\n        await axiosInstance.put(`/${collection}/${data._id}`, data);\r\n        break;\r\n      \r\n      case 'delete':\r\n        await axiosInstance.delete(`/${collection}/${data._id}`);\r\n        break;\r\n    }\r\n  }\r\n\r\n  public async performOperation(\r\n    operation: 'create' | 'update' | 'delete',\r\n    collection: string,\r\n    data: any\r\n  ): Promise<void> {\r\n    // Save to local database first\r\n    switch (operation) {\r\n      case 'create':\r\n      case 'update':\r\n        await localDB.saveUser(data);\r\n        break;\r\n      case 'delete':\r\n        await localDB.deleteUser(data._id);\r\n        break;\r\n    }\r\n\r\n    // Add to sync queue\r\n    await localDB.addToSyncQueue(operation, collection, data);\r\n\r\n    // If online, try to sync immediately\r\n    if (this.isOnline) {\r\n      await this.syncWithServer();\r\n    }\r\n  }\r\n\r\n  public cleanup(): void {\r\n    if (this.syncInterval) {\r\n      clearInterval(this.syncInterval);\r\n    }\r\n    window.removeEventListener('online', this.handleOnline);\r\n    window.removeEventListener('offline', this.handleOffline);\r\n  }\r\n}\r\n\r\nexport const syncService = SyncService.getInstance();\r\n","import axios from 'axios';\r\nimport { \r\n  SystemSettings,\r\n  User,\r\n  ActivityLog,\r\n  SystemStatistics\r\n} from '../types/admin';\r\nimport { Notification } from '../types/notification';\r\nimport { localDB } from './localDatabase';\r\nimport { syncService } from './syncService';\r\n// Fetch template text for a document type\r\nexport const getTemplateText = (type: string) =>\r\n  axiosInstance.get(`/templates/${type}`).then(res => res.data.text);\r\n\r\n// Notification API\r\nconst notificationAPI = {\r\n  // Get all notifications for current admin\r\n  getNotifications: async (): Promise<Notification[]> => {\r\n    try {\r\n      const response = await axiosInstance.get('/notifications');\r\n      // Normalize response to array\r\n      const data = Array.isArray(response.data) ? response.data : (response.data && response.data.data) ? response.data.data : [];\r\n      return data;\r\n    } catch (err: any) {\r\n      // If the primary endpoint fails (404 or auth), attempt public fallback which returns [] in server routes\r\n      try {\r\n        const fallback = await axiosInstance.get('/notifications/fallback');\r\n        return Array.isArray(fallback.data) ? fallback.data : (fallback.data && fallback.data.data) ? fallback.data.data : [];\r\n      } catch (err2) {\r\n        // As a last resort, return empty array so UI remains functional\r\n        console.error('notificationAPI.getNotifications failed:', err);\r\n        return [];\r\n      }\r\n    }\r\n  },\r\n  // Approve staff request\r\n  approveStaff: async (userId: string, notificationId: string) => {\r\n    const response = await axiosInstance.post('/notifications/approve', { userId, notificationId });\r\n    return response.data;\r\n  },\r\n  // Reject staff request\r\n  rejectStaff: async (notificationId: string, reason?: string) => {\r\n    const response = await axiosInstance.post('/notifications/reject', { notificationId, reason });\r\n    return response.data;\r\n  },\r\n  // Mark notification as read\r\n  markAsRead: async (notificationId: string) => {\r\n    const response = await axiosInstance.post('/notifications/read', { notificationId });\r\n    return response.data;\r\n  },\r\n};\r\n\r\n// Staff registration API\r\nexport const staffRegister = async (data: any) => {\r\n  const response = await axiosInstance.post('/auth/register/staff', data);\r\n  return response.data;\r\n};\r\n\r\n// Use a relative API base so the dev server proxy and production deployment\r\n// both route requests correctly (avoids hard-coded localhost which can\r\n// cause CORS or incorrect-host issues). The CRA dev server has a proxy\r\n// set to http://localhost:5000 in client/package.json, so using '/api'\r\n// will be forwarded to the backend during development.\r\n// Allow an override via REACT_APP_API_URL for cases where the API is hosted\r\n// on a different origin (useful for staging). Default to the relative `/api`\r\n// so the CRA dev proxy forwards requests to the backend in development.\r\n// Resolve API URL in this order:\r\n// 1. runtime config served from /config.json (globalThis.__APP_CONFIG__.API_BASE)\r\n// 2. build-time env var REACT_APP_API_URL\r\n// 3. fallback to relative '/api' so dev proxy works\r\nconst runtimeCfg = (globalThis as any).__APP_CONFIG__;\r\nexport const API_URL = (runtimeCfg && runtimeCfg.API_BASE) || process.env.REACT_APP_API_URL || '/api';\r\n\r\nexport const axiosInstance = axios.create({\r\n  baseURL: API_URL,\r\n  headers: {\r\n    'Content-Type': 'application/json',\r\n  },\r\n  withCredentials: true, // Send cookies with every request\r\n});\r\n\r\n// Public axios instance (no credentials) that uses the same resolved API base.\r\n// Use this for public endpoints (guest views) so we don't send auth cookies\r\n// and avoid 401/redirect HTML pages that the client may try to parse as JSON.\r\nexport const axiosPublic = axios.create({\r\n  baseURL: API_URL,\r\n  headers: { 'Content-Type': 'application/json' },\r\n  withCredentials: false,\r\n});\r\n\r\n// Build an absolute URL to the API given a path (path may start with '/').\r\n// This normalizes the configured API base (runtime config -> REACT_APP_API_URL -> '/api')\r\n// and ensures requests to asset URLs (images/files) resolve to the correct origin.\r\nexport function getAbsoluteApiUrl(path: string) {\r\n  const cfg = (globalThis as any).__APP_CONFIG__;\r\n  const base = (cfg && cfg.API_BASE) || process.env.REACT_APP_API_URL || '/api';\r\n  let root = String(base).replace(/\\/$/, '');\r\n  // If the base includes the '/api' suffix, strip it to create a root host\r\n  if (root.endsWith('/api')) root = root.replace(/\\/api$/, '');\r\n  // Ensure path begins with a single '/'\r\n  const p = path.startsWith('/') ? path : `/${path}`;\r\n  return `${root}/api${p}`;\r\n}\r\n\r\n\r\n// Auth service wrapper\r\nexport const authService = {\r\n  login: async (email: string, password: string) => {\r\n    const response = await axiosInstance.post('/auth/login', { email, password });\r\n    return response.data;\r\n  },\r\n  register: async (userData: any) => {\r\n    const response = await axiosInstance.post('/auth/register', userData);\r\n    return response.data;\r\n  },\r\n  logout: async () => {\r\n    await axiosInstance.post('/auth/logout');\r\n  },\r\n  // Fetch current authenticated user's full profile\r\n  getCurrentUser: async () => {\r\n    const response = await axiosInstance.get('/auth/me');\r\n    return response.data;\r\n  }\r\n};\r\n\r\n// Add auth token to requests\r\naxiosInstance.interceptors.request.use((config) => {\r\n  // Prefer the primary auth token (set at login). Fall back to a guest session\r\n  // token if present so guest users can make authenticated requests that the\r\n  // server accepts (the server issues `sessionToken` for guest flows).\r\n  const token = localStorage.getItem('token') || localStorage.getItem('guestSessionToken');\r\n  if (token && config.headers) {\r\n    config.headers.Authorization = `Bearer ${token}`;\r\n  }\r\n  return config;\r\n});\r\n\r\n// Global response handler: if any request returns 401, clear auth and redirect to login\r\naxiosInstance.interceptors.response.use(\r\n  (response) => response,\r\n  (error) => {\r\n    try {\r\n      const status = error?.response?.status;\r\n      if (status === 401) {\r\n        // Avoid redirect loops: only redirect if we're not already on the login page\r\n        // and the failed request was not the login attempt itself.\r\n        if (typeof window !== 'undefined') {\r\n          const currentPath = window.location.pathname || '';\r\n          const requestUrl = (error?.config && (error.config.url || '')) || (error?.request && error.request.responseURL) || '';\r\n          const isLoginRequest = requestUrl.includes('/auth/login') || requestUrl.includes('/auth/me');\r\n          const isLoginPage = currentPath === '/login' || currentPath.startsWith('/login');\r\n\r\n          if (!isLoginPage && !isLoginRequest) {\r\n            console.warn('API responded 401 Unauthorized  clearing auth and redirecting to login');\r\n            try {\r\n              localStorage.removeItem('token');\r\n              localStorage.removeItem('guestSessionToken');\r\n            } catch (e) {}\r\n\r\n            // Debounce multiple simultaneous 401s so we only force one navigation.\r\n            try {\r\n              if (!sessionStorage.getItem('redirectingToLogin')) {\r\n                sessionStorage.setItem('redirectingToLogin', '1');\r\n                // Small timeout so callers can finish their promise chains and avoid\r\n                // racing navigation that could otherwise produce reload storms.\r\n                setTimeout(() => {\r\n                  window.location.href = '/login';\r\n                }, 100);\r\n              } else {\r\n                // Already in the process of redirecting; no-op to avoid loops.\r\n              }\r\n            } catch (e) {\r\n              // sessionStorage may throw in some environments; fallback to immediate redirect\r\n              try {\r\n                window.location.href = '/login';\r\n              } catch (_e) {}\r\n            }\r\n          } else {\r\n            // If we're already on the login page or this was the login request,\r\n            // don't redirect  let the login UI display the error to the user.\r\n            // Also clear tokens in case they're present.\r\n            try { localStorage.removeItem('guestSessionToken'); } catch (e) {}\r\n          }\r\n        }\r\n      }\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n    return Promise.reject(error);\r\n  }\r\n);\r\n\r\n// API interfaces\r\n\r\nexport const getInbox = async () => {\r\n  return axiosInstance.get('/messages/inbox');\r\n};\r\n\r\n// Verification API for admin actions\r\nexport const verificationAPI = {\r\n  getRequests: async () => axiosInstance.get('/verification/admin/requests').then(res => res.data),\r\n  verifyUser: async (userId: string, verified: boolean) => axiosInstance.post(`/verification/admin/verify-user/${userId}`, { verified }).then(res => res.data),\r\n  // URL to stream/download a verification file by GridFS id\r\n  getFileUrl: (fileId: string) => `${API_URL.replace(/\\/$/, '')}/verification/file/${fileId}`,\r\n  // Approve a verification request by request id (admin)\r\n  approveRequest: async (requestId: string) => axiosInstance.post(`/verification/admin/requests/${requestId}/approve`).then(res => res.data),\r\n  // Reject a verification request by request id (admin)\r\n  rejectRequest: async (requestId: string, reason?: string) => axiosInstance.post(`/verification/admin/requests/${requestId}/reject`, { reason }).then(res => res.data),\r\n};\r\ninterface LoginCredentials {\r\n  email: string;\r\n  password: string;\r\n}\r\n\r\ninterface RegisterData {\r\n  firstName: string;\r\n  lastName: string;\r\n  email: string;\r\n  password: string;\r\n  address: string;\r\n  contactNumber: string;\r\n  barangayID: string;\r\n  fullName?: string;\r\n  username?: string;\r\n}\r\n\r\ninterface DocumentRequest {\r\n  type: string; // add this for backend compatibility\r\n  documentType: string;\r\n  purpose: string;\r\n  additionalDetails?: Record<string, any>;\r\n  barangayID?: string;\r\n}\r\n\r\ninterface InquiryRequest {\r\n  type: string;\r\n  subject: string;\r\n  message: string;\r\n  assignedRole?: string;\r\n  assignedTo?: string[];\r\n}\r\n\r\n// API implementations\r\nconst auth = {\r\n  login: (credentials: LoginCredentials) => \r\n    axiosInstance.post('/auth/login', credentials).then(response => response.data),\r\n  register: (data: RegisterData) => \r\n    axiosInstance.post('/auth/register', data).then(response => response.data),\r\n};\r\n\r\nexport const documentsAPI = {\r\n  getMyDocuments: () => \r\n    axiosInstance.get('/document-requests/my-requests').then(response => response.data),\r\n  requestDocument: (data: DocumentRequest) => \r\n    axiosInstance.post('/document-requests', data).then(response => response.data),\r\n  getDocumentById: (id: string) => \r\n    axiosInstance.get(`/document-requests/${id}`).then(response => response.data),\r\n  getAllDocuments: () =>\r\n    axiosInstance.get('/document-requests/all')\r\n      .then(response => response.data)\r\n      .catch((err) => {\r\n        // If unauthenticated (401) return an empty list instead of throwing\r\n        // so public pages don't log parse errors or unhandled rejections.\r\n        const status = err?.response?.status;\r\n        if (status === 401) {\r\n          return [] as any[];\r\n        }\r\n        // Re-throw other errors so callers can handle them as before.\r\n        throw err;\r\n      }),\r\n  getDocumentRecords: () =>\r\n    axiosInstance.get('/document-requests/all').then(response => response.data),\r\n  updateDocumentStatus: (id: string, data: { status: string; notes?: string }) =>\r\n    axiosInstance.patch(`/document-requests/${id}/process`, data).then(response => response.data),\r\n  processDocument: (id: string) =>\r\n    axiosInstance.patch(`/document-requests/${id}/process`).then(response => response.data),\r\n  listFiles: () =>\r\n    axiosInstance.get('/documents/list').then(response => response.data),\r\n  deleteFile: (id: string) =>\r\n    axiosInstance.delete(`/documents/file/${id}`).then(response => response.data),\r\n  updateFileStatus: (id: string, data: { status: string }) =>\r\n    axiosInstance.patch(`/documents/file/${id}/status`, data).then(response => response.data),\r\n  getFilledDocument: (id: string) =>\r\n    axiosInstance.get(`/document-requests/${id}/filled`).then(response => response.data),\r\n  previewFilledDocument: (data: any) =>\r\n    axiosInstance.post('/document-requests/preview-filled', data).then(response => response.data),\r\n};\r\n\r\nconst contact = {\r\n  submitInquiry: (data: any) => {\r\n    // Support FormData (multipart) or JSON payloads\r\n    if (typeof FormData !== 'undefined' && data instanceof FormData) {\r\n      return axiosInstance.post('/inquiries', data, { headers: { 'Content-Type': 'multipart/form-data' } }).then(response => response.data);\r\n    }\r\n    return axiosInstance.post('/inquiries', data).then(response => response.data);\r\n  },\r\n  getMyInquiries: (username?: string, barangayID?: string) =>\r\n    axiosInstance.get('/inquiries/my-inquiries', {\r\n      params: username && barangayID ? { username, barangayID } : undefined\r\n    }).then(response => response.data),\r\n  getInquiryById: (id: string) =>\r\n    axiosInstance.get(`/inquiries/${id}`).then(response => response.data),\r\n  // Staff-specific endpoints\r\n  getAllInquiries: () =>\r\n  axiosInstance.get('/inquiries').then(response => response.data),\r\n  respondToInquiry: (id: string, data: { response: string }) =>\r\n    axiosInstance.post(`/inquiries/${id}/responses`, data).then(response => response.data),\r\n  // Mark an inquiry as resolved (admin/staff)\r\n  resolveInquiry: (id: string) =>\r\n    axiosInstance.patch(`/inquiries/${id}`, { status: 'resolved' }).then(response => response.data),\r\n  // Public announcements\r\n  getAnnouncements: () =>\r\n    axiosInstance.get('/announcements').then(response => response.data),\r\n  getAnnouncementById: (id: string) =>\r\n    axiosInstance.get(`/announcements/${id}`).then(response => response.data),\r\n};\r\n\r\n// Requests API (generic requests collection)\r\nexport const requestsAPI = {\r\n  // Get all requests (admin/staff)\r\n  getAllRequests: async () => axiosInstance.get('/requests').then(response => response.data),\r\n  // Get a single request by id\r\n  getRequestById: async (id: string) => axiosInstance.get(`/requests/${id}`).then(response => response.data),\r\n  // Get staff access requests only (client-side filter)\r\n  getStaffAccessRequests: async () => {\r\n    const all = await axiosInstance.get('/requests').then(response => response.data);\r\n    return Array.isArray(all)\r\n      ? all.filter((r: any) => (r.type || '').toString().toLowerCase() === 'staff_access' && (r.status || '').toString().toLowerCase() === 'pending')\r\n      : [];\r\n  }\r\n  ,\r\n  // Approve a request by id (admin)\r\n  approveRequest: async (id: string) => {\r\n    const response = await axiosInstance.post(`/requests/${id}/approve`);\r\n    return response.data;\r\n  }\r\n};\r\n\r\n// Admin API\r\nconst admin = {\r\n  createUser: async (userData: any): Promise<void> => {\r\n    try {\r\n      const response = await axiosInstance.post('/admin/users', userData);\r\n      if (response.data) {\r\n        await localDB.saveUser(response.data);\r\n        try {\r\n          // Notify listeners that a user profile was created/updated\r\n          const ev = new CustomEvent('userProfileUpdated', { detail: response.data });\r\n          window.dispatchEvent(ev);\r\n        } catch (err) {\r\n          // ignore\r\n        }\r\n      }\r\n    } catch (error) {\r\n      if (!navigator.onLine) {\r\n        await syncService.performOperation('create', 'users', userData);\r\n      }\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  updateUser: async (userId: string, userData: any): Promise<void> => {\r\n    try {\r\n      const response = await axiosInstance.put(`/admin/users/${userId}`, userData);\r\n      if (response.data) {\r\n        await localDB.saveUser(response.data);\r\n        try {\r\n          // Notify any listeners (e.g., AuthContext) that a user profile has updated\r\n          const ev = new CustomEvent('userProfileUpdated', { detail: response.data });\r\n          window.dispatchEvent(ev);\r\n        } catch (err) {\r\n          // ignore\r\n        }\r\n      }\r\n    } catch (error) {\r\n      if (!navigator.onLine) {\r\n        await syncService.performOperation('update', 'users', { ...userData, _id: userId });\r\n      }\r\n      throw error;\r\n    }\r\n  },\r\n  // Demote a staff user back to resident\r\n  demoteUser: async (userId: string) => {\r\n    try {\r\n      const response = await axiosInstance.put(`/admin/users/${userId}`, { role: 'resident' });\r\n      return response.data;\r\n    } catch (error) {\r\n      if (!navigator.onLine) {\r\n        // queue for sync if offline\r\n        await syncService.performOperation('update', 'users', { _id: userId, role: 'resident' });\r\n        return;\r\n      }\r\n      throw error;\r\n    }\r\n  },\r\n  // System Settings\r\n  getSystemSettings: async (): Promise<SystemSettings> => {\r\n    try {\r\n      // Try admin-only settings first\r\n      const response = await axiosInstance.get('/admin/settings');\r\n      return response.data;\r\n    } catch (error) {\r\n      // If offline, return cached settings\r\n      if (!navigator.onLine) {\r\n        const settings = await localDB.getSettings();\r\n        if (settings) return settings;\r\n      }\r\n      // If the dev proxy isn't forwarding (requests hit :3000 and return 404),\r\n      // try fallbacks in order: /settings (non-admin), then admin settings,\r\n      // then absolute /settings, and finally /settings/public if enabled on server.\r\n      try {\r\n        // try non-admin path on same base (/api/settings)\r\n        const resp = await axiosInstance.get('/settings');\r\n        return resp.data;\r\n      } catch (e1) {\r\n        try {\r\n          // attempt admin settings again via configured API base\r\n          const resp2 = await axiosInstance.get('/admin/settings');\r\n          return resp2.data;\r\n        } catch (e2) {\r\n          try {\r\n            const resp3 = await axiosInstance.get('/settings');\r\n            return resp3.data;\r\n          } catch (e3) {\r\n            try {\r\n              // try optional public endpoint if server enabled DEBUG_PUBLIC_SETTINGS\r\n              const resp4 = await axiosInstance.get('/settings/public');\r\n              return resp4.data;\r\n            } catch (e4) {\r\n              // As a last resort, return cached settings or a minimal default so UI does not crash\r\n              try {\r\n                const cached = await localDB.getSettings();\r\n                if (cached) return cached;\r\n              } catch (dbErr) {\r\n                // ignore\r\n              }\r\n              console.warn('getSystemSettings: all fallbacks failed; returning empty defaults. Original error:', error);\r\n              // Return a minimal default settings object to keep UI functional\r\n              const defaults: any = {\r\n                siteName: 'Barangay Information System',\r\n                contactEmail: '',\r\n                smtp: { passwordSet: false },\r\n              };\r\n              return defaults as SystemSettings;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  updateSystemSettings: async (settings: SystemSettings): Promise<void> => {\r\n    try {\r\n      const response = await axiosInstance.put('/admin/settings', settings);\r\n      await localDB.saveSettings(settings);\r\n      return response.data;\r\n    } catch (error) {\r\n      // If offline, queue for sync and return\r\n      if (!navigator.onLine) {\r\n        await syncService.performOperation('update', 'settings', settings);\r\n        return;\r\n      }\r\n      // If the dev proxy isn't forwarding (requests hit :3000 and return 404),\r\n      // try a direct request to the backend API base as a fallback.\r\n      try {\r\n        // Attempt direct PUT using configured API base\r\n        const resp = await axiosInstance.put('/admin/settings', settings, { withCredentials: true });\r\n        // persist locally as well\r\n        try { await localDB.saveSettings(settings); } catch (e) {}\r\n        return resp.data;\r\n      } catch (fall) {\r\n        // rethrow original error so callers receive the initial failure context\r\n        throw error;\r\n      }\r\n    }\r\n  },\r\n\r\n  // Send test SMTP email using current system SMTP settings (server-side will decrypt)\r\n  testSmtp: async (to: string) => {\r\n    const response = await axiosInstance.post('/admin/settings/test-smtp', { to });\r\n    return response.data;\r\n  },\r\n\r\n  // User Management\r\n  getUsers: async (): Promise<User[]> => {\r\n    try {\r\n  const response = await axiosInstance.get('/auth/users');\r\n      const users = response.data;\r\n      // Cache users locally\r\n      for (const user of users) {\r\n        await localDB.saveUser(user);\r\n      }\r\n      return users;\r\n    } catch (error) {\r\n      if (!navigator.onLine) {\r\n        // Return cached users if offline\r\n        return localDB.getAllUsers();\r\n      }\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  updateUserStatus: async (userId: string, status: string): Promise<void> => {\r\n    try {\r\n      const response = await axiosInstance.put(`/admin/users/${userId}/status`, { status });\r\n      const user = await localDB.getUser(userId);\r\n      if (user) {\r\n        user.status = status;\r\n        await localDB.saveUser(user);\r\n        try {\r\n          // Notify listeners that a user's status has changed\r\n          const ev = new CustomEvent('userProfileUpdated', { detail: user });\r\n          window.dispatchEvent(ev);\r\n        } catch (err) {\r\n          // ignore\r\n        }\r\n      }\r\n      return response.data;\r\n    } catch (error) {\r\n      if (!navigator.onLine) {\r\n        // Update locally and queue for sync\r\n        const user = await localDB.getUser(userId);\r\n        if (user) {\r\n          user.status = status;\r\n          await syncService.performOperation('update', 'users', user);\r\n        }\r\n        return;\r\n      }\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  deleteUser: async (userId: string): Promise<void> => {\r\n    try {\r\n      await axiosInstance.delete(`/admin/users/${userId}`);\r\n      await localDB.deleteUser(userId);\r\n      try {\r\n        // Notify listeners that a user was deleted; include id so listeners can react\r\n        const ev = new CustomEvent('userProfileUpdated', { detail: { _id: userId, deleted: true } });\r\n        window.dispatchEvent(ev);\r\n      } catch (err) {\r\n        // ignore\r\n      }\r\n    } catch (error) {\r\n      if (!navigator.onLine) {\r\n        // Delete locally and queue for sync\r\n        await syncService.performOperation('delete', 'users', { _id: userId });\r\n        return;\r\n      }\r\n      throw error;\r\n    }\r\n  },\r\n\r\n  // Activity Logs\r\n  getActivityLogs: (filters: { startDate?: string; endDate?: string; module?: string; userId?: string }): Promise<ActivityLog[]> =>\r\n    axiosInstance.get('/admin/logs', { params: filters }).then(response => response.data),\r\n\r\n  // Statistics\r\n  getSystemStatistics: (): Promise<SystemStatistics> =>\r\n    axiosInstance.get('/admin/statistics').then(response => response.data),\r\n\r\n  // Staff Applicants\r\n  getStaffApplicants: async (): Promise<{ count: number; applicants: any[] }> => {\r\n    const response = await axiosInstance.get('/admin/staff-applications');\r\n    return response.data;\r\n  },\r\n  // Get user with resident info (admin)\r\n  getUserWithResident: async (userId: string) => {\r\n    const response = await axiosInstance.get(`/admin/users/${userId}/with-resident`);\r\n    return response.data;\r\n  },\r\n  // Admin: lookup resident by barangayID\r\n  getResidentByBarangayID: async (barangayID: string) => {\r\n    const response = await axiosInstance.get(`/admin/resident/${encodeURIComponent(barangayID)}`);\r\n    return response.data;\r\n  },\r\n  // Admin: get resident by id\r\n  getResident: async (residentId: string) => {\r\n    const response = await axiosInstance.get(`/admin/resident/id/${residentId}`);\r\n    return response.data;\r\n  },\r\n  // Admin: update resident record\r\n  updateResident: async (residentId: string, data: any) => {\r\n    const response = await axiosInstance.put(`/admin/resident/${residentId}`, data);\r\n    return response.data;\r\n  },\r\n  // Admin: upload resident avatar (multipart/form-data)\r\n  uploadResidentAvatar: async (residentId: string, file: File) => {\r\n    const form = new FormData();\r\n    form.append('avatar', file);\r\n    const response = await axiosInstance.post(`/admin/resident/${residentId}/avatar`, form, {\r\n      // Let the browser/axios set the Content-Type including the multipart boundary\r\n    });\r\n    return response.data;\r\n  },\r\n  // Barangay Officials endpoints\r\n  getOfficials: async () => {\r\n    try {\r\n      const response = await axiosInstance.get('/admin/officials');\r\n      return response.data;\r\n    } catch (error) {\r\n      // If proxies/backends aren't responding or return 404, try a public backend URL\r\n      // This attempts the absolute API base (REACT_APP_API_URL or localhost fallback)\r\n      // and purposely omits credentials so public endpoints aren't blocked by auth/proxy.\r\n      // If that also fails, return an empty array so UI remains functional.\r\n      console.warn('getOfficials: primary request failed; attempting public backend fallback. Error:', error);\r\n      try {\r\n        const resp2 = await axiosPublic.get('/officials');\r\n        return Array.isArray(resp2.data) ? resp2.data : [];\r\n      } catch (pfall) {\r\n        return [];\r\n      }\r\n    }\r\n  },\r\n  createOfficial: async (data: any) => {\r\n    try {\r\n      const response = await axiosInstance.post('/admin/officials', data);\r\n      return response.data;\r\n    } catch (error) {\r\n      // Creating an official is an admin operation and should fail loudly if\r\n      // the authenticated request does not succeed. Rethrow the original\r\n      // error so callers can handle/show the proper message.\r\n      throw error;\r\n    }\r\n  },\r\n  updateOfficial: async (id: string, data: any) => {\r\n    try {\r\n      const response = await axiosInstance.put(`/admin/officials/${id}`, data);\r\n      return response.data;\r\n    } catch (error) {\r\n      // If offline, queue for sync\r\n      if (!navigator.onLine) {\r\n        await syncService.performOperation('update', 'officials', { ...data, _id: id });\r\n        return;\r\n      }\r\n      // Rethrow original error so callers can handle it; fallback to a\r\n      // direct backend URL is unnecessary when runtime `API_BASE` exists.\r\n      throw error;\r\n    }\r\n  },\r\n  deleteOfficial: async (id: string) => {\r\n    const response = await axiosInstance.delete(`/admin/officials/${id}`);\r\n    return response.data;\r\n  },\r\n  // Disable (optionally suspend until a date) a user\r\n  disableUser: async (userId: string, data?: { suspendedUntil?: string }) => {\r\n    const response = await axiosInstance.patch(`/admin/users/${userId}/disable`, data || {});\r\n    return response.data;\r\n  },\r\n  // Enable a previously disabled user\r\n  enableUser: async (userId: string) => {\r\n    const response = await axiosInstance.patch(`/admin/users/${userId}/enable`);\r\n    return response.data;\r\n  },\r\n  uploadOfficialPhoto: async (id: string, file: File) => {\r\n    const form = new FormData();\r\n    form.append('photo', file);\r\n    // Try the axios instance first (should let browser set multipart boundary).\r\n    try {\r\n      const response = await axiosInstance.post(`/admin/officials/${id}/photo`, form, { headers: {} });\r\n      return response.data;\r\n    } catch (err: any) {\r\n      // If server returned a 400 possibly due to malformed multipart headers,\r\n      // attempt a raw fetch fallback which uses the browser-native request\r\n      // (ensures proper Content-Type/boundary). Also surface server response\r\n      // where possible to aid debugging.\r\n      try {\r\n        if (err && err.response && err.response.data) {\r\n          console.error('uploadOfficialPhoto axios error response:', err.response.data);\r\n        } else {\r\n          console.error('uploadOfficialPhoto axios error', err);\r\n        }\r\n      } catch (e) {}\r\n\r\n      // Fallback to fetch with credentials so cookies/auth are sent\r\n      try {\r\n        const url = `${API_URL}/admin/officials/${id}/photo`;\r\n        const resp = await fetch(url, {\r\n          method: 'POST',\r\n          body: form,\r\n          credentials: 'include'\r\n        });\r\n        const data = await resp.json().catch(() => ({}));\r\n        if (!resp.ok) {\r\n          const msg = (data && data.message) ? data.message : `Upload failed with status ${resp.status}`;\r\n          const error = new Error(msg) as any;\r\n          error.response = { status: resp.status, data };\r\n          throw error;\r\n        }\r\n        return data;\r\n      } catch (fetchErr) {\r\n        throw fetchErr;\r\n      }\r\n    }\r\n  },\r\n  // Approve a staff applicant (server should expose this endpoint)\r\n  approveStaffApplicant: async (applicantId: string) => {\r\n    const response = await axiosInstance.post(`/admin/staff-applications/${applicantId}/approve`);\r\n    return response.data;\r\n  },\r\n  // Announcements\r\n  createAnnouncement: async (formData: FormData) => {\r\n    const response = await axiosInstance.post('/admin/announcements', formData, {\r\n      headers: { 'Content-Type': 'multipart/form-data' }\r\n    });\r\n    return response.data;\r\n  },\r\n  listAdminAnnouncements: async () => {\r\n    const response = await axiosInstance.get('/admin/announcements/list');\r\n    return response.data;\r\n  },\r\n  deleteAnnouncement: async (id: string) => {\r\n    const response = await axiosInstance.delete(`/admin/announcements/${id}`);\r\n    return response.data;\r\n  },\r\n  updateAnnouncement: async (id: string, formData: FormData) => {\r\n    const response = await axiosInstance.put(`/admin/announcements/${id}`, formData, {\r\n      headers: { 'Content-Type': 'multipart/form-data' }\r\n    });\r\n    return response.data;\r\n  },\r\n};\r\n\r\n// Resident Personal Info API\r\nconst residentPersonalInfoAPI = {\r\n  getPersonalInfo: async () => {\r\n    // Try several common endpoints used across versions of the server\r\n    const candidates = ['/resident/my-info', '/resident/personal-info', '/resident/profile'];\r\n    for (const path of candidates) {\r\n      try {\r\n        const resp = await axiosInstance.get(path);\r\n        if (resp && resp.data) return resp.data;\r\n      } catch (e) {\r\n        // continue to next candidate\r\n      }\r\n    }\r\n    // Last-resort: hit absolute API_URL to avoid using client origin (avoids 3000 -> 404)\r\n    try {\r\n      const resp = await axiosInstance.get('/resident/personal-info');\r\n      if (resp && resp.data) return resp.data;\r\n    } catch (e) {\r\n      // ignore and throw below\r\n    }\r\n    const err: any = new Error('Resident personal info not found');\r\n    // attach a pseudo-response to aid callers checking err.response?.status\r\n    err.response = { status: 404 };\r\n    throw err;\r\n  },\r\n  updatePersonalInfo: async (data: any) => {\r\n    const response = await axiosInstance.put('/resident/my-info', data);\r\n    return response.data;\r\n  },\r\n};\r\n\r\nexport const authAPI = {\r\n  ...auth,\r\n  getUsers: async (): Promise<User[]> => {\r\n    try {\r\n      const response = await axiosInstance.get('/auth/users');\r\n      return response.data;\r\n    } catch (error) {\r\n      // keep logging minimal and rethrow so callers can handle errors\r\n      // ...existing error handling might expect a thrown error\r\n      // eslint-disable-next-line no-console\r\n      console.error('authAPI.getUsers failed', error);\r\n      throw error;\r\n    }\r\n  }\r\n};\r\nexport { \r\n  contact as contactAPI, \r\n  admin as adminAPI,\r\n  notificationAPI,\r\n  residentPersonalInfoAPI,\r\n  axiosInstance as default\r\n};\r\n","import dayjs from 'dayjs';\r\n\r\n/**\r\n * Format a date (string|Date|number) into MM/DD/YYYY or MM/DD/YYYY h:mm:ss A\r\n */\r\nexport function formatDate(d?: string | Date | number | null, includeTime = false): string {\r\n  if (!d) return '';\r\n  try {\r\n    const dt = dayjs(d);\r\n    if (!dt.isValid()) return String(d);\r\n    return includeTime ? dt.format('MM/DD/YYYY h:mm:ss A') : dt.format('MM/DD/YYYY');\r\n  } catch (e) {\r\n    return String(d);\r\n  }\r\n}\r\n","import { useRef } from 'react';\r\nimport React, { useEffect, useState } from 'react';\r\nimport './DocumentProcessingHighlight.css';\r\nimport { useLocation, useNavigate } from 'react-router-dom';\r\nimport { Card, Typography, Row, Col, Modal, Spin, Table, Input, Tooltip, Tag, Space, Button, Radio, Select, DatePicker, notification } from 'antd';\r\nimport { SearchOutlined } from '@ant-design/icons';\r\nimport { FileWordOutlined, FilePdfOutlined, FileImageOutlined, EyeOutlined } from '@ant-design/icons';\r\nimport { documentsAPI, API_URL } from '../services/api';\r\nimport { formatDate as formatDateUtil } from '../utils/formatDate';\r\nimport { generateFilledDocx } from '../services/generateFilledDocx';\r\n\r\nconst DocumentProcessing: React.FC = () => {\r\n  const [files, setFiles] = useState<any[]>([]);\r\n  const [loading, setLoading] = useState(true);\r\n  const [modalVisible, setModalVisible] = useState(false);\r\n  const [selectedFile, setSelectedFile] = useState<any | null>(null);\r\n  const [requestedTypes, setRequestedTypes] = useState<string[]>([]);\r\n  const [fileRequestMap, setFileRequestMap] = useState<Record<string, any>>({});\r\n  const [previewVisible, setPreviewVisible] = useState(false);\r\n  const [previewHtml, setPreviewHtml] = useState('');\r\n  const [previewLoading, setPreviewLoading] = useState(false);\r\n  const [previewRequests, setPreviewRequests] = useState<any[]>([]);\r\n  const [previewTemplateHtml, setPreviewTemplateHtml] = useState<string>('');\r\n  const [previewSelectedRequestId, setPreviewSelectedRequestId] = useState<string | null>(null);\r\n  const rowRefs = useRef<Record<string, HTMLDivElement | null>>({});\r\n  const highlightTimeoutRef = useRef<number | null>(null);\r\n  const [residentInfo, setResidentInfo] = useState<any>(null);\r\n  const [requestFieldValues, setRequestFieldValues] = useState<Record<string, string>>({});\r\n  const [prioritizeModalVisible, setPrioritizeModalVisible] = useState(false);\r\n  const [prioritizeCandidates, setPrioritizeCandidates] = useState<any[]>([]);\r\n  const [selectedPriorityRequest, setSelectedPriorityRequest] = useState<string | null>(null);\r\n  const [prioritizeTargetFileId, setPrioritizeTargetFileId] = useState<string | null>(null);\r\n  const [generatedCopyId, setGeneratedCopyId] = useState<string | null>(null);\r\n  const [generatedModalVisible, setGeneratedModalVisible] = useState(false);\r\n  const [processedDocId, setProcessedDocId] = useState<string | null>(null);\r\n  const [isMobile, setIsMobile] = useState<boolean>(false);\r\n  const [filterQuery, setFilterQuery] = useState<string>('');\r\n  const [filterType, setFilterType] = useState<string | null>(null);\r\n  const [filterStatus, setFilterStatus] = useState<string | null>(null);\r\n  const [filterRange, setFilterRange] = useState<any | null>(null);\r\n  const location = useLocation();\r\n  const navigate = useNavigate();\r\n  const openRequestIdFromNav = (location && (location.state as any) && (location.state as any).openRequestId) ? (location.state as any).openRequestId : null;\r\n\r\n  // Helpers to work with fileRequestMap which stores arrays per file id\r\n  const getRequestsForFile = (fileId: string) => {\r\n    const v = fileRequestMap[fileId];\r\n    if (!v) return [];\r\n    return Array.isArray(v) ? v : [v];\r\n  };\r\n\r\n  const getPrimaryRequest = (fileId: string) => {\r\n    const arr = getRequestsForFile(fileId);\r\n    return arr.length ? arr[0] : null;\r\n  };\r\n\r\n  const getPrioritizedRequest = (fileId: string) => {\r\n    const arr = getRequestsForFile(fileId);\r\n    if (!arr || !arr.length) return null;\r\n    const found = arr.find((r: any) => ((r.notes && r.notes.toString().toLowerCase().includes('priority')) || r.priority === true));\r\n    return found || arr[0];\r\n  };\r\n  // Fetch files and requests and build fileRequestMap. Extracted so we can call it after prioritization.\r\n  const fetchFilesAndRequests = async () => {\r\n    setLoading(true);\r\n    try {\r\n      // Fetch all GridFS files\r\n      const fileList = await documentsAPI.listFiles();\r\n      // Fetch document requests (all, for staff/admin; use getMyDocuments for user)\r\n      const requests = await documentsAPI.getDocumentRecords();\r\n      // Extract unique requested types (normalize to lowercase for matching)\r\n      const types: string[] = Array.from(new Set((requests || []).map((r: any) => (r.type || '').toLowerCase()).filter(Boolean)));\r\n      setRequestedTypes(types);\r\n      // Map files to their matching requests (by type in filename)\r\n      // We store an array per file id to support multiple requests for the same template/file\r\n      const fileRequestMapLocal: Record<string, any> = {};\r\n      // Helper to normalize strings: remove all non-alphanumeric chars, lowercase\r\n      const normalize = (str: string) => (str || '').replace(/[^a-zA-Z0-9]/g, '').toLowerCase();\r\n      fileList.forEach((file: any) => {\r\n        if (!file || !file.filename) return;\r\n        const normalizedFilename = normalize(file.filename);\r\n        // Find all requests whose type matches filename (robust normalization)\r\n        const matchedRequests = (requests || []).filter((req: any) =>\r\n          req.type && normalizedFilename.includes(normalize(req.type))\r\n        );\r\n        if (matchedRequests && matchedRequests.length) fileRequestMapLocal[file._id] = matchedRequests;\r\n      });\r\n      // Filter files to only those matching requested types\r\n      const filteredFiles = fileList.filter((file: any) => {\r\n        if (!file || !file.filename) return false;\r\n        if (types.length === 0) return true; // If no requests, show all\r\n        const normalizedFilename = file.filename.replace(/[_\\s]/g, '').toLowerCase();\r\n        return types.some((type: string) => normalizedFilename.includes(type.replace(/[_\\s]/g, '')));\r\n      });\r\n      setFiles(filteredFiles);\r\n      setFileRequestMap(fileRequestMapLocal);\r\n    } catch (err) {\r\n      setFileRequestMap({});\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchFilesAndRequests();\r\n    const onResize = () => setIsMobile(window.innerWidth <= 720);\r\n    onResize();\r\n    window.addEventListener('resize', onResize);\r\n    return () => window.removeEventListener('resize', onResize);\r\n  }, []);\r\n\r\n  // After files and mapping are fetched, if navigation included an openRequestId, open the preview\r\n  useEffect(() => {\r\n    if (!openRequestIdFromNav) return;\r\n    // Find the file that contains this request\r\n    const fileId = Object.keys(fileRequestMap).find(fid => {\r\n      const arr = Array.isArray(fileRequestMap[fid]) ? fileRequestMap[fid] : (fileRequestMap[fid] ? [fileRequestMap[fid]] : []);\r\n      return arr.some((r: any) => (r._id || r.requestId) === openRequestIdFromNav);\r\n    });\r\n    if (fileId) {\r\n      const file = files.find(f => f._id === fileId);\r\n      if (file) {\r\n        // open preview for that file and request\r\n        setSelectedFile(file);\r\n        handleProcessClick(file).then(() => {\r\n          setPreviewSelectedRequestId(openRequestIdFromNav);\r\n          renderPreviewForRequest(openRequestIdFromNav);\r\n          setPreviewVisible(true);\r\n        }).catch(() => {});\r\n      }\r\n    }\r\n    else {\r\n      // No matching file found in the mapping. Try fetching the request directly and open a lightweight preview\r\n      (async () => {\r\n        try {\r\n          if ((documentsAPI as any).getDocumentById) {\r\n            const req = await (documentsAPI as any).getDocumentById(openRequestIdFromNav);\r\n            if (req) {\r\n              // Ensure previewRequests contains this request and open the preview modal\r\n              setPreviewRequests([req]);\r\n              setPreviewSelectedRequestId(openRequestIdFromNav);\r\n              // Build a simple previewHtml from the request.fieldValues if template HTML isn't available\r\n              try {\r\n                const fieldValues = req.fieldValues || {};\r\n                const keys = Object.keys(fieldValues);\r\n                if (keys.length) {\r\n                  const tableHtml = `\r\n                    <table style=\"width:100%;border-collapse:collapse;\">\r\n                      <thead>\r\n                        <tr>\r\n                          <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Field</th>\r\n                          <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Submitted Value</th>\r\n                        </tr>\r\n                      </thead>\r\n                      <tbody>\r\n                        ${keys.map(k => `<tr><td style='border:1px solid #ccc;padding:8px;'>${k}</td><td style='border:1px solid #ccc;padding:8px;'>${(fieldValues[k] || '')}</td></tr>`).join('')}\r\n                      </tbody>\r\n                    </table>\r\n                    // when we open a preview for a request that wasn't tied to a specific file in mapping,\r\n                    // attempt to scroll to and highlight the request's entry if present in the UI\r\n                    setTimeout(() => {\r\n                      try {\r\n                        const el = rowRefs.current[openRequestIdFromNav];\r\n                        if (el && el.scrollIntoView) {\r\n                          el.scrollIntoView({ behavior: 'smooth', block: 'center' });\r\n                          el.classList.add('cv-highlight');\r\n                          if (highlightTimeoutRef.current) window.clearTimeout(highlightTimeoutRef.current);\r\n                          // remove highlight after 2s\r\n                          // @ts-ignore - window.setTimeout returns number in browser\r\n                          highlightTimeoutRef.current = window.setTimeout(() => el.classList.remove('cv-highlight'), 2000);\r\n                        }\r\n                      } catch (e) {}\r\n                    }, 120);\r\n                  `;\r\n                  setPreviewHtml(tableHtml);\r\n                } else {\r\n                  setPreviewHtml('<div style=\"color:#666\">No submitted field values available.</div>');\r\n                }\r\n              } catch (e) {\r\n                setPreviewHtml('<div style=\"color:red\">Failed to build preview.</div>');\r\n              }\r\n              setPreviewVisible(true);\r\n            }\r\n          }\r\n        } catch (e) {\r\n          // ignore  best effort\r\n        }\r\n      })();\r\n    }\r\n    // clear navigation state so it doesn't re-open repeatedly\r\n    try { navigate(location.pathname, { replace: true, state: {} }); } catch (e) {}\r\n  }, [fileRequestMap, files]);\r\n\r\n  const handleCardClick = (file: any) => {\r\n    setSelectedFile(file);\r\n    setModalVisible(true);\r\n  };\r\n\r\n  // Prioritize flow: open modal with candidates of same type\r\n  const openPrioritizeModal = async (record: any) => {\r\n    // Show only requests associated with this file\r\n    const requestsForFile = Array.isArray(fileRequestMap[record._id]) ? fileRequestMap[record._id] : (fileRequestMap[record._id] ? [fileRequestMap[record._id]] : []);\r\n    // Only include candidates that have a concrete request id (avoid using file ids)\r\n    const candidates = (requestsForFile || [])\r\n      .map((r: any) => ({\r\n        fileId: record._id,\r\n        requesterName: r.username || r.requesterName || 'Unknown',\r\n        createdAt: r.createdAt || r._created || null,\r\n        requestId: r._id || r.requestId\r\n      }))\r\n      .filter((c: any) => !!(c.requestId));\r\n\r\n    setPrioritizeCandidates(candidates);\r\n    setSelectedPriorityRequest(candidates.length ? candidates[0].requestId : null);\r\n    setPrioritizeTargetFileId(record._id);\r\n    setPrioritizeModalVisible(true);\r\n  };\r\n\r\n  const confirmPrioritize = async () => {\r\n    if (!selectedPriorityRequest) {\r\n      alert('Select a request to prioritize');\r\n      return;\r\n    }\r\n    try {\r\n      if ((documentsAPI as any).prioritize) {\r\n        await (documentsAPI as any).prioritize(selectedPriorityRequest);\r\n      } else if (documentsAPI.updateDocumentStatus) {\r\n        // updateDocumentStatus requires a status; use current request status or 'pending' and add notes flag\r\n        let currentReq: any = null;\r\n        for (const v of Object.values(fileRequestMap)) {\r\n          const arr = Array.isArray(v) ? v : [v];\r\n          const found = arr.find((r: any) => (r._id || r.requestId) === selectedPriorityRequest);\r\n          if (found) {\r\n            currentReq = found;\r\n            break;\r\n          }\r\n        }\r\n        const currentStatus = currentReq?.status || 'pending';\r\n        await documentsAPI.updateDocumentStatus(selectedPriorityRequest, { status: currentStatus, notes: 'PRIORITY' });\r\n      }\r\n\r\n      setPrioritizeModalVisible(false);\r\n      // Refresh files and request mapping so UI reflects priority changes\r\n      await fetchFilesAndRequests();\r\n\r\n      // Update only the specific file mapping if possible\r\n      if (prioritizeTargetFileId) {\r\n        try {\r\n          const refreshed = getRequestsForFile(prioritizeTargetFileId);\r\n          let updated: any = refreshed.find((r: any) => (r._id || r.requestId) === selectedPriorityRequest) || null;\r\n\r\n          if (!updated && (documentsAPI as any).getDocumentById) {\r\n            try {\r\n              const fetched = await (documentsAPI as any).getDocumentById(selectedPriorityRequest);\r\n              updated = fetched;\r\n            } catch (e) {\r\n              updated = null;\r\n            }\r\n          }\r\n\r\n          if (updated) {\r\n            setFileRequestMap(prev => {\r\n              const cloned: Record<string, any> = { ...prev };\r\n              cloned[prioritizeTargetFileId] = Array.isArray(refreshed) ? refreshed : (refreshed ? [refreshed] : []);\r\n              return cloned;\r\n            });\r\n          } else {\r\n            // fallback: mark the selected request as prioritized in the specific file mapping\r\n            setFileRequestMap(prev => {\r\n              try {\r\n                const cloned: Record<string, any> = { ...prev };\r\n                const v = cloned[prioritizeTargetFileId];\r\n                const arr = Array.isArray(v) ? v.slice() : (v ? [v] : []);\r\n                const idx = arr.findIndex((r: any) => (r._id || r.requestId) === selectedPriorityRequest);\r\n                if (idx !== -1) {\r\n                  arr[idx] = { ...arr[idx], priority: true, notes: (arr[idx].notes || '') + ' PRIORITY' };\r\n                }\r\n                cloned[prioritizeTargetFileId] = arr;\r\n                return cloned;\r\n              } catch (e) {\r\n                return prev;\r\n              }\r\n            });\r\n          }\r\n        } catch (e) {\r\n          // ignore and leave UI refreshed from fetchFilesAndRequests\r\n        }\r\n      }\r\n\r\n      // If preview modal is open for this file, update previewRequests and selection so modal reflects the change\r\n      if (selectedFile && prioritizeTargetFileId && selectedFile._id === prioritizeTargetFileId) {\r\n        const updatedRequests = getRequestsForFile(prioritizeTargetFileId);\r\n        setPreviewRequests(updatedRequests);\r\n        setPreviewSelectedRequestId(selectedPriorityRequest);\r\n        // re-render preview for the newly prioritized request\r\n        if (selectedPriorityRequest) {\r\n          await renderPreviewForRequest(selectedPriorityRequest);\r\n        }\r\n      }\r\n\r\n      alert('Prioritization saved');\r\n      setPrioritizeTargetFileId(null);\r\n    } catch (err) {\r\n      console.error(err);\r\n      alert('Failed to prioritize');\r\n    }\r\n  };\r\n\r\n  const handleProcessClick = async (file: any) => {\r\n    setPreviewVisible(true);\r\n    setPreviewLoading(true);\r\n    setPreviewHtml('');\r\n    try {\r\n      // Populate preview-related state: all requests for file and template HTML\r\n  const requests = getRequestsForFile(file._id) || [];\r\n  // Only show pending requests in the preview selector\r\n  const pendingRequests = requests.filter((r: any) => ((r.status || '').toString().toLowerCase() === 'pending'));\r\n  setPreviewRequests(pendingRequests);\r\n  const prioritized = getPrioritizedRequest(file._id);\r\n  // Prefer prioritized request if it is pending, otherwise fall back to the first pending request\r\n  const firstPending = pendingRequests[0] || null;\r\n  const prioritizedPending = prioritized && ((prioritized.status || '').toString().toLowerCase() === 'pending') ? prioritized : null;\r\n  setPreviewSelectedRequestId(prioritizedPending ? (prioritizedPending._id || prioritizedPending.requestId) : (firstPending?._id || firstPending?.requestId || null));\r\n      // Fetch template preview HTML once for this file\r\n      const previewResp = await (await import('../services/api')).axiosPublic.get(`/documents/preview/${file._id}`, { params: { format: 'html' }, responseType: 'text' });\r\n      const html = previewResp && previewResp.data ? previewResp.data : '';\r\n      setPreviewTemplateHtml(html);\r\n      // Render preview for the selected/prioritized request\r\n  const selectedReqId = prioritizedPending ? (prioritizedPending._id || prioritizedPending.requestId) : (firstPending?._id || firstPending?.requestId || null);\r\n      if (selectedReqId) await renderPreviewForRequest(selectedReqId);\r\n    } catch (err) {\r\n      setPreviewHtml('<div style=\"color:red\">Failed to load preview.</div>');\r\n    }\r\n    setPreviewLoading(false);\r\n  };\r\n\r\n  // Render previewHtml for a specific request id using cached previewTemplateHtml\r\n  const renderPreviewForRequest = async (requestId: string) => {\r\n    try {\r\n      const req = Object.values(fileRequestMap).flat().find((r: any) => (r._id || r.requestId) === requestId) || null;\r\n  const fieldValues = req?.fieldValues || {};\r\n      // If template html not present, nothing to render\r\n      const html = previewTemplateHtml || '';\r\n      const regex = /\\{(.*?)\\}/g;\r\n      let match;\r\n      const fields: string[] = [];\r\n      while ((match = regex.exec(html)) !== null) {\r\n        fields.push(match[1].trim());\r\n      }\r\n      if (fields.length > 0) {\r\n        const tableHtml = `\r\n          <table style=\"width:100%;border-collapse:collapse;\">\r\n            <thead>\r\n              <tr>\r\n                <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Field</th>\r\n                <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Submitted Value</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              ${fields.map(f => {\r\n                const value = fieldValues[f] || '';\r\n                return `<tr><td style='border:1px solid #ccc;padding:8px;'>${f}</td><td style='border:1px solid #ccc;padding:8px;'>${value}</td></tr>`;\r\n              }).join('')}\r\n            </tbody>\r\n          </table>\r\n        `;\r\n        setPreviewHtml(tableHtml);\r\n      } else {\r\n        setPreviewHtml('<div style=\"color:red\">No { ... } content found.</div>');\r\n      }\r\n    } catch (err) {\r\n      setPreviewHtml('<div style=\"color:red\">Failed to load preview.</div>');\r\n    }\r\n  };\r\n\r\n  // Open preview for a selected record (used by table Actions)\r\n  const openPreview = async (record: any) => {\r\n    setSelectedFile(record);\r\n    await handleProcessClick(record);\r\n  };\r\n\r\n  // (Removed download and status update helpers  preview-only workflow)\r\n \r\n  if (loading) {\r\n    return (\r\n      <div style={{ width: '100%', minHeight: 300, display: 'flex', alignItems: 'center', justifyContent: 'center' }}>\r\n        <Spin size=\"large\" />\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div style={{ maxWidth: 2000, margin: '12px auto', padding: '16px 24px' }}>\r\n  <Typography.Title level={3} style={{ marginBottom: 12, marginTop: 0 }}></Typography.Title>\r\n      {/* Document Processing Table */}\r\n      <Card title=\"Document Processing\" extra={\r\n        <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\r\n          <Input\r\n            prefix={<SearchOutlined />}\r\n            placeholder=\"Search documents\"\r\n            style={{ width: 420 }}\r\n            value={filterQuery}\r\n            onChange={(e) => setFilterQuery(e.target.value)}\r\n            onPressEnter={() => {}}\r\n          />\r\n          <Select allowClear placeholder=\"Document Type\" style={{ width: 160 }} value={filterType} onChange={(v) => setFilterType(v)}>\r\n            {requestedTypes.map((t) => <Select.Option key={t} value={t}>{t}</Select.Option>)}\r\n          </Select>\r\n          <Select allowClear placeholder=\"Status\" style={{ width: 140 }} value={filterStatus} onChange={(v) => setFilterStatus(v)}>\r\n            <Select.Option value=\"pending\">Pending</Select.Option>\r\n            <Select.Option value=\"approved\">Approved</Select.Option>\r\n            <Select.Option value=\"rejected\">Rejected</Select.Option>\r\n          </Select>\r\n          <DatePicker.RangePicker onChange={(vals) => setFilterRange(vals)} />\r\n        </div>\r\n      }>\r\n        {isMobile ? (\r\n          <div style={{ display: 'flex', flexDirection: 'column', gap: 12 }}>\r\n            {files.filter((file: any) => {\r\n              // client-side filtering\r\n              if (filterQuery && !(file.filename || '').toLowerCase().includes(filterQuery.toLowerCase())) return false;\r\n              if (filterType && ((file.type || '').toLowerCase() !== filterType.toLowerCase())) return false;\r\n              const primary = getPrimaryRequest(file._id);\r\n              const status = primary?.status || '';\r\n              if (filterStatus && status.toLowerCase() !== filterStatus.toLowerCase()) return false;\r\n              if (filterRange && filterRange[0] && filterRange[1] && file.uploadDate) {\r\n                const d = new Date(file.uploadDate);\r\n                const start = filterRange[0].toDate();\r\n                const end = filterRange[1].toDate();\r\n                if (d < start || d > end) return false;\r\n              }\r\n              return true;\r\n            }).map((file: any) => {\r\n              const name = file.filename || '';\r\n              const ext = (name.split('.').pop() || '').toLowerCase();\r\n              let icon = <FileWordOutlined style={{ color: '#2B6CB0', fontSize: 20 }} />;\r\n              if (ext === 'pdf') icon = <FilePdfOutlined style={{ color: '#E53E3E', fontSize: 20 }} />;\r\n              if (['png', 'jpg', 'jpeg', 'gif', 'svg', 'bmp'].includes(ext)) icon = <FileImageOutlined style={{ color: '#319795', fontSize: 20 }} />;\r\n              const primary = getPrimaryRequest(file._id);\r\n              const status = primary?.status || '';\r\n              return (\r\n                <Card key={file._id} size=\"small\" ref={(el: any) => { /* mobile cards keyed by primary request id if exists */\r\n                  const primary = getPrimaryRequest(file._id);\r\n                  const rid = primary && (primary._id || primary.requestId);\r\n                  if (rid) rowRefs.current[rid] = el;\r\n                }}>\r\n                  <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'flex-start' }}>\r\n                    <div style={{ display: 'flex', gap: 12, alignItems: 'center' }}>\r\n                      {icon}\r\n                      <div>\r\n                        <Tooltip title={name}><div style={{ maxWidth: 220, whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis', fontWeight: 600 }}>{name.replace(/\\.docx$/i, '')}</div></Tooltip>\r\n                        <div style={{ fontSize: 12, color: '#666' }}>{file.type || 'Unknown'}</div>\r\n                      </div>\r\n                    </div>\r\n                    <div style={{ display: 'flex', flexDirection: 'column', alignItems: 'flex-end', gap: 8 }}>\r\n                      <Tag color={status === 'pending' ? 'orange' : status === 'approved' ? 'green' : status === 'rejected' ? 'red' : 'default'}>{(status || '').toUpperCase()}</Tag>\r\n                      <div style={{ display: 'flex', gap: 8 }}>\r\n                        <Button size=\"small\" icon={<EyeOutlined />} onClick={() => openPreview(file)}>Preview</Button>\r\n                      </div>\r\n                      <div style={{ fontSize: 11, color: '#999' }}>{file.uploadDate ? formatDateUtil(file.uploadDate) : ''}</div>\r\n                    </div>\r\n                  </div>\r\n                </Card>\r\n              );\r\n            })}\r\n          </div>\r\n        ) : (\r\n          <Table\r\n            rowKey={(record) => record._id}\r\n            dataSource={files.filter((file: any) => {\r\n              if (filterQuery && !(file.filename || '').toLowerCase().includes(filterQuery.toLowerCase())) return false;\r\n              if (filterType && ((file.type || '').toLowerCase() !== filterType.toLowerCase())) return false;\r\n              const primary = getPrimaryRequest(file._id);\r\n              const status = primary?.status || '';\r\n              if (filterStatus && status.toLowerCase() !== filterStatus.toLowerCase()) return false;\r\n              if (filterRange && filterRange[0] && filterRange[1] && file.uploadDate) {\r\n                const d = new Date(file.uploadDate);\r\n                const start = filterRange[0].toDate();\r\n                const end = filterRange[1].toDate();\r\n                if (d < start || d > end) return false;\r\n              }\r\n              return true;\r\n            })}\r\n            pagination={{ pageSize: 10 }}\r\n            columns={[\r\n              {\r\n                title: 'File',\r\n                dataIndex: 'filename',\r\n                key: 'filename',\r\n                sorter: (a: any, b: any) => (a.filename || '').localeCompare(b.filename || ''),\r\n                render: (text: string, rec: any) => {\r\n                  // derive icon by extension\r\n                  const name = text || '';\r\n                  const ext = (name.split('.').pop() || '').toLowerCase();\r\n                  let icon = <FileWordOutlined style={{ color: '#2B6CB0' }} />;\r\n                  if (ext === 'pdf') icon = <FilePdfOutlined style={{ color: '#E53E3E' }} />;\r\n                  if (['png', 'jpg', 'jpeg', 'gif', 'svg', 'bmp'].includes(ext)) icon = <FileImageOutlined style={{ color: '#319795' }} />;\r\n                      return (\r\n                    <Tooltip title={name}>\r\n                      <span style={{ maxWidth: 280, display: 'inline-block', whiteSpace: 'nowrap', overflow: 'hidden', textOverflow: 'ellipsis' }}>\r\n                        <Space align=\"center\">\r\n                          {icon}\r\n                          <span>{name.replace(/\\.docx$/i, '')}</span>\r\n                        </Space>\r\n                      </span>\r\n                    </Tooltip>\r\n                  );\r\n                }\r\n              },\r\n              // Type column removed per request\r\n              {\r\n                title: 'Status',\r\n                dataIndex: 'status',\r\n                key: 'status',\r\n                render: (_: any, record: any) => {\r\n                  // Show document availability (online/offline) based on GridFS file metadata\r\n                  // Prefer explicit flags if present, otherwise infer from contentType/length\r\n                  const file = record || {};\r\n                  const isOnline = (file.metadata && file.metadata.online === true) || (typeof file.length === 'number' ? file.length > 0 : Boolean(file.contentType));\r\n                  const label = isOnline ? 'ONLINE' : 'OFFLINE';\r\n                  const color = isOnline ? 'green' : 'red';\r\n                  return (<Tag color={color}>{label}</Tag>);\r\n                }\r\n              },\r\n              {\r\n                title: 'Uploaded On',\r\n                dataIndex: 'uploadDate',\r\n                key: 'uploadDate',\r\n                sorter: (a: any, b: any) => new Date(a.uploadDate).getTime() - new Date(b.uploadDate).getTime(),\r\n                render: (d: any) => d ? formatDateUtil(d) : ''\r\n              },\r\n              {\r\n                title: 'Actions',\r\n                key: 'actions',\r\n                render: (_: any, record: any) => (\r\n                  <Space>\r\n                    <Button size=\"small\" icon={<EyeOutlined />} onClick={() => openPreview(record)}>Preview</Button>\r\n                  </Space>\r\n                )\r\n              }\r\n            ]}\r\n            // Attach a rowClassName and onRow so we can populate rowRefs for direct scrolling/highlighting\r\n            rowClassName={(record) => {\r\n              // Attach a data attribute later via onRow\r\n              return '';\r\n            }}\r\n            onRow={(record) => {\r\n              const primary = getPrimaryRequest(record._id);\r\n              const rid = primary && (primary._id || primary.requestId);\r\n              return {\r\n                ref: (el: HTMLDivElement | null) => {\r\n                  if (rid) rowRefs.current[rid] = el;\r\n                }\r\n              } as any;\r\n            }}\r\n          />\r\n        )}\r\n      </Card>\r\n\r\n      <Modal\r\n        title={selectedFile ? selectedFile.filename.replace(/\\.docx$/i, '') : ''}\r\n        open={modalVisible}\r\n        onCancel={() => setModalVisible(false)}\r\n        footer={null}\r\n        width={800}\r\n      >\r\n        {selectedFile ? (\r\n          <div style={{ minWidth: 700 }}>\r\n            <Table\r\n              dataSource={[\r\n                      {\r\n                        ...selectedFile,\r\n                        requesterName: getPrimaryRequest(selectedFile._id)?.username || getPrimaryRequest(selectedFile._id)?.requesterName || 'Unknown',\r\n                        barangayID: getPrimaryRequest(selectedFile._id)?.barangayID || 'Unknown',\r\n                        status: getPrimaryRequest(selectedFile._id)?.status || 'Unknown',\r\n                      },\r\n              ]}\r\n              pagination={false}\r\n              rowKey=\"_id\"\r\n              columns={[\r\n                {\r\n                  title: 'Requester Name',\r\n                  dataIndex: 'requesterName',\r\n                  key: 'requesterName',\r\n                  render: (text: string) => text || 'Unknown',\r\n                },\r\n                {\r\n                  title: 'Barangay ID',\r\n                  dataIndex: 'barangayID',\r\n                  key: 'barangayID',\r\n                  render: (text: string) => text || 'Unknown',\r\n                },\r\n                {\r\n                  title: 'Status',\r\n                  dataIndex: 'status',\r\n                  key: 'status',\r\n                  render: (text: string) => text || 'Unknown',\r\n                },\r\n                {\r\n                  title: 'Actions',\r\n                  key: 'actions',\r\n                  render: (_: any, record: any) => (\r\n                    <div style={{ display: 'flex', gap: 8 }}>\r\n                      <button\r\n                        style={{ background: '#2196F3', color: '#fff', border: 'none', borderRadius: 6, padding: '4px 12px', cursor: 'pointer', fontWeight: 600 }}\r\n                        onClick={() => handleProcessClick(record)}\r\n                      >Process</button>\r\n                      <button style={{ background: '#43D96B', color: '#fff', border: 'none', borderRadius: 6, padding: '4px 12px', cursor: 'pointer', fontWeight: 600 }}>Complete</button>\r\n                      <button style={{ background: '#FF3B3B', color: '#fff', border: 'none', borderRadius: 6, padding: '4px 12px', cursor: 'pointer', fontWeight: 600 }}>Reject</button>\r\n                    </div>\r\n                  ),\r\n                },\r\n              ]}\r\n            />\r\n          </div>\r\n        ) : (\r\n          <Spin />\r\n        )}\r\n      </Modal>\r\n\r\n      <Modal\r\n        title=\"Generated / Processed Copy Saved\"\r\n        open={generatedModalVisible}\r\n        onCancel={() => setGeneratedModalVisible(false)}\r\n        footer={[\r\n          <Button key=\"close\" onClick={() => setGeneratedModalVisible(false)}>Close</Button>\r\n        ]}\r\n      >\r\n        <div>\r\n          <div style={{ marginBottom: 8 }}>A copy of the generated document was saved.</div>\r\n          {generatedCopyId ? (\r\n            <div style={{ marginBottom: 10 }}>\r\n              <div style={{ marginBottom: 6 }}><strong>Generated metadata ID:</strong> <code>{generatedCopyId}</code></div>\r\n              <div>\r\n                <a href={`${API_URL.replace(/\\/$/, '')}/generated-documents/${generatedCopyId}/raw`} target=\"_blank\" rel=\"noreferrer\">Open generated copy (generated_documents)</a>\r\n              </div>\r\n            </div>\r\n          ) : null}\r\n\r\n          {processedDocId ? (\r\n            <div>\r\n              <div style={{ marginBottom: 6 }}><strong>Processed document ID:</strong> <code>{processedDocId}</code></div>\r\n              <div>\r\n                <a href={`${API_URL.replace(/\\/$/, '')}/processed-documents/${processedDocId}/raw`} target=\"_blank\" rel=\"noreferrer\">Open processed copy (processed_documents)</a>\r\n              </div>\r\n            </div>\r\n          ) : null}\r\n\r\n          {(!generatedCopyId && !processedDocId) ? <div>No saved copy id available.</div> : null}\r\n        </div>\r\n      </Modal>\r\n\r\n      {/* Prioritize Modal */}\r\n      <Modal\r\n        title=\"Prioritize Request\"\r\n        open={prioritizeModalVisible}\r\n        onCancel={() => setPrioritizeModalVisible(false)}\r\n        onOk={confirmPrioritize}\r\n        okText=\"Save Priority\"\r\n        cancelText=\"Cancel\"\r\n        okButtonProps={{ disabled: prioritizeCandidates.length === 0 || !selectedPriorityRequest }}\r\n      >\r\n        {prioritizeCandidates.length === 0 ? (\r\n          <div>No other requests found for this document type.</div>\r\n        ) : (\r\n          <Radio.Group\r\n            onChange={(e) => setSelectedPriorityRequest(e.target.value)}\r\n            value={selectedPriorityRequest}\r\n            style={{ display: 'flex', flexDirection: 'column', gap: 8 }}\r\n          >\r\n            {prioritizeCandidates.map((c: any) => (\r\n              <Radio key={c.requestId || c.fileId} value={c.requestId || c.fileId} style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center' }}>\r\n                <div style={{ display: 'flex', flexDirection: 'column' }}>\r\n                  <strong>{c.requesterName}</strong>\r\n                  <small style={{ color: '#666' }}>{c.createdAt ? formatDateUtil(c.createdAt) : ''}</small>\r\n                </div>\r\n                <div style={{ marginLeft: 12 }}>\r\n                  {/* show a small hint if this candidate is currently selected as priority */}\r\n                  {selectedPriorityRequest === (c.requestId || c.fileId) ? <Tag color=\"red\">Selected</Tag> : null}\r\n                </div>\r\n              </Radio>\r\n            ))}\r\n          </Radio.Group>\r\n        )}\r\n      </Modal>\r\n\r\n      {/* Preview Modal for Process */}\r\n      <Modal\r\n        title={selectedFile ? `Preview: ${selectedFile.filename.replace(/\\.docx$/i, '')}` : 'Preview'}\r\n        open={previewVisible}\r\n        onCancel={() => setPreviewVisible(false)}\r\n        footer={null}\r\n        width={900}\r\n      >\r\n        {previewLoading ? (\r\n          <Spin />\r\n        ) : (\r\n          <>\r\n            <div style={{ minHeight: 300 }} dangerouslySetInnerHTML={{ __html: previewHtml }} />\r\n            {/* Request selector inside preview (select which request to render) */}\r\n            <div style={{ marginTop: 12, padding: 8, border: '1px solid #eee', borderRadius: 6 }}>\r\n              <div style={{ marginBottom: 8, fontWeight: 600 }}>Select Request to Preview</div>\r\n              <div style={{ maxHeight: 300, overflowY: 'auto', paddingRight: 6 }}>\r\n                <Radio.Group\r\n                  value={previewSelectedRequestId}\r\n                  onChange={async (e) => {\r\n                    const newId = e.target.value as string;\r\n                    setPreviewSelectedRequestId(newId);\r\n                    // re-render preview for selected request\r\n                    await renderPreviewForRequest(newId);\r\n                  }}\r\n                  style={{ display: 'flex', flexDirection: 'column', gap: 8 }}\r\n                >\r\n                  {previewRequests && previewRequests.length ? previewRequests.map((r: any) => (\r\n                    <Radio key={(r._id || r.requestId)} value={(r._id || r.requestId)}>\r\n                      <div style={{ display: 'flex', justifyContent: 'space-between', width: '100%' }}>\r\n                        <div>\r\n                          <div style={{ fontWeight: 600 }}>{r.username || r.requesterName || 'Unknown'}</div>\r\n                          <div style={{ fontSize: 12, color: '#666' }}>{r.createdAt ? formatDateUtil(r.createdAt) : ''}</div>\r\n                        </div>\r\n                        <div style={{ alignSelf: 'center' }}>{(r.notes && r.notes.toString().toLowerCase().includes('priority')) || r.priority ? <Tag color=\"red\">PRIORITY</Tag> : null}</div>\r\n                      </div>\r\n                    </Radio>\r\n                  )) : <div style={{ color: '#666' }}>No pending requests available for this file.</div>}\r\n                </Radio.Group>\r\n              </div>\r\n            </div>\r\n            <div style={{ display: 'flex', justifyContent: 'flex-end', marginTop: 16, gap: 12 }}>\r\n                      {/* Complete button removed; Generate will also mark request complete after successful generation */}\r\n              <button\r\n                style={{ background: '#43D96B', color: '#fff', border: 'none', borderRadius: 6, padding: '8px 24px', cursor: 'pointer', fontWeight: 600 }}\r\n                onClick={async () => {\r\n                  if (!selectedFile) return;\r\n                  try {\r\n                    // Prefer the currently previewed request if available\r\n                    let request: any = null;\r\n                    if (previewSelectedRequestId) {\r\n                      // find in mapping\r\n                      const requestsForFile = getRequestsForFile(selectedFile._id);\r\n                      request = requestsForFile.find((r: any) => (r._id || r.requestId) === previewSelectedRequestId) || null;\r\n                    }\r\n                    // fallback to prioritized or primary\r\n                    if (!request) request = getPrioritizedRequest(selectedFile._id) || getPrimaryRequest(selectedFile._id);\r\n\r\n                    if (!request || !request.fieldValues) {\r\n                      alert('No document request or field values found for this file.');\r\n                      return;\r\n                    }\r\n\r\n                    // Generate filled docx via server endpoint (returns blob). Server may save the generated file and return X-Filled-File-Id header.\r\n                    const result = await generateFilledDocx(selectedFile._id, request.fieldValues, (request._id || request.requestId));\r\n                    const blob = result.blob;\r\n                    // Use the transaction/request id as the downloaded filename when available.\r\n                    // Prefer explicit transaction identifiers if present to avoid using resident/user ids.\r\n                    // Prefer transactionCode fields (server uses 'transactionCode'), fallback to older keys and finally server headers/ids\r\n                    const txId = (request && (request.transactionCode || request.transactionId || request.txId || request.transaction_id || request._id || request.requestId)) || result.transactionCode || result.generatedCopyId || result.processedDocId || null;\r\n                    const safeId = txId ? String(txId).replace(/[^a-zA-Z0-9-_.]/g, '_') : null;\r\n                    // Prefer transactionCode (returned in header) for filename, then request.transactionCode, then server filename, then safe id, then fallback\r\n                    const preferredCode = result.transactionCode || (request && request.transactionCode) || safeId || null;\r\n                    const serverFilename = preferredCode ? `${String(preferredCode).replace(/[^a-zA-Z0-9-_.]/g, '_')}.docx` : (result.filename || `filled_${selectedFile.filename || 'document'}.docx`);\r\n\r\n                    // Trigger download using server filename\r\n                    const url = window.URL.createObjectURL(new Blob([blob], { type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' }));\r\n                    const link = document.createElement('a');\r\n                    link.href = url;\r\n                    link.setAttribute('download', serverFilename);\r\n                    document.body.appendChild(link);\r\n                    link.click();\r\n                    link.parentNode?.removeChild(link);\r\n                    window.URL.revokeObjectURL(url);\r\n\r\n                    // If server returned a saved id header, we assume it's already saved to GridFS; refresh listing\r\n                    const savedId = result.savedId || null;\r\n                    if (savedId) {\r\n                      // Refresh list so uploaded/generated file appears\r\n                      await fetchFilesAndRequests();\r\n                      const processedId = result.processedDocId || null;\r\n                      if (processedId) {\r\n                        notification.open({\r\n                          message: 'Generated copy saved',\r\n                          description: (\r\n                            <div>Saved to processed documents. <a href={`${API_URL.replace(/\\/$/, '')}/processed-documents/${processedId}/raw`} target=\"_blank\" rel=\"noreferrer\">Open processed copy</a></div>\r\n                          ),\r\n                          duration: 8,\r\n                        });\r\n                        setProcessedDocId(processedId);\r\n                        setGeneratedModalVisible(true);\r\n                      } else {\r\n                        notification.open({ message: 'Generated document saved', description: 'Saved to server processed documents.', duration: 6 });\r\n                      }\r\n                      if (result.generatedCopyId) {\r\n                        setGeneratedCopyId(result.generatedCopyId);\r\n                        setGeneratedModalVisible(true);\r\n                      }\r\n                    } else {\r\n                      // Attempt to upload the generated file to the documents endpoint so the backend will store .files and .chunks (GridFS)\r\n                      try {\r\n                        const form = new FormData();\r\n                        form.append('file', new Blob([blob], { type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' }), serverFilename);\r\n                        // include source metadata if helpful\r\n                        form.append('sourceTemplateId', selectedFile._id || '');\r\n                        form.append('requestId', (request._id || request.requestId) || '');\r\n                        // try a couple of likely endpoints\r\n                        const base = API_URL.replace(/\\/$/, '');\r\n                        let uploaded = false;\r\n                        // Prefer uploading directly into the processed_documents bucket if available on the server\r\n                        const tryUrls = [ `${base}/processed-documents/upload`, `${base}/documents/upload-inline`, `${base}/documents/upload`, `${base}/documents`, `${base}/admin/documents/upload` ];\r\n                        for (const u of tryUrls) {\r\n                          try {\r\n                            const resp = await fetch(u, { method: 'POST', body: form, credentials: 'include' });\r\n                            if (resp.ok) {\r\n                              uploaded = true;\r\n                              break;\r\n                            }\r\n                          } catch (e) {\r\n                            // continue\r\n                          }\r\n                        }\r\n                        if (uploaded) {\r\n                          await fetchFilesAndRequests();\r\n                          // show a non-blocking toast with a direct link to the processed copy when available\r\n                          const processedId = result.processedDocId || null;\r\n                          if (processedId) {\r\n                            notification.open({\r\n                              message: 'Generated copy saved',\r\n                              description: (\r\n                                <div>Saved to processed documents. <a href={`${API_URL.replace(/\\/$/, '')}/processed-documents/${processedId}/raw`} target=\"_blank\" rel=\"noreferrer\">Open processed copy</a></div>\r\n                              ),\r\n                              duration: 8,\r\n                            });\r\n                            setProcessedDocId(processedId);\r\n                            setGeneratedModalVisible(true);\r\n                          } else {\r\n                            notification.open({ message: 'Generated document uploaded', description: 'Uploaded to server processed documents.', duration: 6 });\r\n                          }\r\n                        } else {\r\n                          console.warn('Upload fallback failed; generated file was downloaded but not uploaded to documents collection.');\r\n                          alert('Generated document downloaded. Server-side save not confirmed.');\r\n                        }\r\n                      } catch (uploadErr) {\r\n                        console.error('Upload fallback error', uploadErr);\r\n                        alert('Generated document downloaded but upload to server failed.');\r\n                      }\r\n                    }\r\n                    // After successful generation (and attempted save), also mark the associated request as completed\r\n                    try {\r\n                      // Determine request id to mark as approved\r\n                      let requestId: string | null = previewSelectedRequestId;\r\n                      if (!requestId) {\r\n                        const r = getPrioritizedRequest(selectedFile._id) || getPrimaryRequest(selectedFile._id);\r\n                        requestId = (r && (r._id || r.requestId)) || null;\r\n                      }\r\n                      if (requestId) {\r\n                        if (documentsAPI.updateDocumentStatus) {\r\n                          await documentsAPI.updateDocumentStatus(requestId, { status: 'approved' });\r\n                        } else {\r\n                          await (await import('../services/api')).axiosInstance.patch(`/document-requests/${requestId}/process`);\r\n                        }\r\n                        // Refresh mapping/UI after marking complete\r\n                        await fetchFilesAndRequests();\r\n                        setPreviewVisible(false);\r\n                        alert('Request marked as completed.');\r\n                      }\r\n                    } catch (markErr) {\r\n                      console.warn('Failed to mark request complete after generation', (markErr as any)?.message || markErr);\r\n                    }\r\n                  } catch (err) {\r\n                    console.error('Generation error', err);\r\n                    alert('Failed to generate filled document.');\r\n                  }\r\n                  setPreviewVisible(false);\r\n                }}\r\n              >Generate</button>\r\n            </div>\r\n          </>\r\n        )}\r\n      </Modal>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default DocumentProcessing;\r\n","import { axiosInstance } from './api';\r\n\r\nexport async function generateFilledDocx(fileId: string, fieldValues: Record<string, string>, requestId?: string) {\r\n  const payload: any = { fieldValues };\r\n  if (requestId) payload.requestId = requestId;\r\n  const response = await axiosInstance.post(`/documents/${fileId}/generate-filled`, payload, {\r\n    responseType: 'blob',\r\n  });\r\n  // Parse filename from Content-Disposition header if present\r\n  const contentDisposition = response.headers['content-disposition'] || response.headers['Content-Disposition'];\r\n  let filename = '';\r\n  if (contentDisposition) {\r\n    // Look for filename*=UTF-8''encoded or filename=\"...\" or filename=...\r\n    const fnStarMatch = contentDisposition.match(/filename\\*=(?:UTF-8'')?([^;\\n\\r]+)/i);\r\n    const fnMatch = contentDisposition.match(/filename=\"?([^\";]+)\"?/i);\r\n    if (fnStarMatch && fnStarMatch[1]) {\r\n      try {\r\n        filename = decodeURIComponent(fnStarMatch[1].replace(/^UTF-8''/, ''));\r\n      } catch (e) {\r\n        filename = fnStarMatch[1];\r\n      }\r\n    } else if (fnMatch && fnMatch[1]) {\r\n      filename = fnMatch[1];\r\n    }\r\n  }\r\n  const savedId = response.headers['x-filled-file-id'] || response.headers['X-Filled-File-Id'] || null;\r\n  // Prefer the processed GridFS id if available (server may store generated copies in processed_documents bucket)\r\n  const processedGridFsId = response.headers['x-processed-gridfs-id'] || response.headers['X-Processed-GridFS-Id'] || null;\r\n  const finalSavedId = processedGridFsId || savedId;\r\n  const generatedCopyId = response.headers['x-generated-doc-id'] || response.headers['X-Generated-Doc-Id'] || null;\r\n  const processedDocId = response.headers['x-processed-doc-id'] || response.headers['X-Processed-Doc-Id'] || null;\r\n  const transactionCode = response.headers['x-transaction-code'] || response.headers['X-Transaction-Code'] || null;\r\n\r\n  // Temporary debug: log what filename and transactionCode were returned by the server\r\n  // Remove or comment out this log after debugging in production\r\n  // eslint-disable-next-line no-console\r\n  console.log('[generateFilledDocx] transactionCode=', transactionCode, 'content-disposition filename=', filename);\r\n  return { blob: response.data, filename, savedId: finalSavedId, generatedCopyId, processedDocId, processedGridFsId, transactionCode };\r\n}\r\n"],"names":["Option","Select","defaultFilterState","status","search","Inbox","loading","setLoading","useState","inquiries","setInquiries","filter","setFilter","category","setCategory","reply","setReply","replyLoading","setReplyLoading","selectedInquiry","setSelectedInquiry","threadVisible","setThreadVisible","leftCollapsed","setLeftCollapsed","listFullscreen","setListFullscreen","replyText","setReplyText","fileList","setFileList","loadingThread","setLoadingThread","messagesEndRef","useRef","useEffect","current","scrollIntoView","behavior","responses","length","storedProfile","localStorage","getItem","JSON","parse","err","contactAPI","getMyInquiries","then","res","catch","antdMessage","error","finally","filteredInquiries","inquiry","statusMatch","categoryMatch","toLowerCase","searchMatch","residentName","includes","subject","createdAt","Date","toLocaleString","openThread","setTimeout","timeAgo","iso","diff","now","getTime","mins","Math","floor","concat","hrs","days","MessageComment","_ref","author","avatar","content","datetime","align","_jsx","style","display","justifyContent","children","_jsxs","gap","alignItems","maxWidth","fontSize","fontWeight","marginTop","color","getInitial","val","fallback","arguments","undefined","s","String","trim","charAt","toUpperCase","e","minHeight","background","padding","fontFamily","position","Card","margin","borderRadius","boxShadow","bodyStyle","Row","gutter","marginBottom","Col","xs","sm","value","onChange","width","Input","Search","placeholder","allowClear","_objectSpread","target","onSearch","flex","Button","type","onClick","v","title","icon","MenuUnfoldOutlined","MenuFoldOutlined","Typography","Title","level","role","Divider","Spin","Result","InboxOutlined","subTitle","maxHeight","overflowY","flexDirection","paddingTop","map","displayName","username","createdBy","fullName","initial","isSelected","_id","Tooltip","placement","border","cursor","Avatar","size","right","top","zIndex","List","itemLayout","dataSource","renderItem","statusTag","Tag","Array","isArray","typeIcon","Item","minWidth","Text","strong","overflow","textOverflow","whiteSpace","marginLeft","React","message","flexShrink","height","_Fragment","displayNameSelected","textAlign","paddingRight","alignSelf","originalSenderName","originalInitial","Paragraph","attachments","a","i","url","path","filename","name","isImage","contentType","startsWith","test","href","rel","src","alt","objectFit","round","r","idx","authorRole","author_role","toString","authorRaw","authorName","author_name","createdByName","createdByFullName","userName","user","createdById","currentUserId","id","residentId","authorDisplay","staffNameFromAssigned","assignedTo","match","find","staffName","staffFullName","isResidentReply","isCurrentUser","avatarNode","text","ref","paddingBottom","borderTop","el","min","scrollHeight","onKeyDown","async","key","shiftKey","preventDefault","warning","sendingKey","updatedInquiry","respondToInquiry","response","prev","success","console","resize","outline","onMouseOver","currentTarget","opacity","onMouseOut","disabled","SendOutlined","verticalAlign","TemplatesManager","templateList","setTemplateList","previewId","setPreviewId","showModal","setShowModal","setError","downloadError","setDownloadError","previewType","setPreviewType","htmlContent","setHtmlContent","axiosPublic","get","data","fetchTemplates","flexWrap","file","marginRight","replace","EyeOutlined","stopPropagation","responseType","DownloadOutlined","blob","axiosInstance","window","URL","createObjectURL","document","createElement","download","body","appendChild","click","remove","revokeObjectURL","danger","DeleteOutlined","delete","resList","left","transform","dangerouslySetInnerHTML","__html","Upload","accept","showUploadList","customRequest","onSuccess","onError","formData","FormData","append","post","headers","Error","UploadOutlined","StaffInbox","residentsModalVisible","setResidentsModalVisible","residentsLoading","setResidentsLoading","residents","setResidents","location","useLocation","fetchAll","state","openInquiryId","openId","waiter","setInterval","found","clearInterval","single","getInquiryById","getAllInquiries","handleSendReply","isNewThread","recipientUsername","residentUsername","recipientBarangayID","residentBarangayID","barangayID","label","payload","warn","debug","selectedInquirySummary","created","submitInquiry","resp","filtered","Tabs","activeKey","k","TabPane","tab","PlusOutlined","list","adminAPI","getUsers","u","firstName","lastName","email","brgy","barangay","Modal","visible","onCancel","footer","resident","rn","temp","Meta","j","CheckOutlined","resolveInquiry","initialState","isAuthenticated","token","AuthContext","createContext","login","logout","isStaff","isAdmin","isResident","mode","switchMode","useAuth","useContext","safeDecodeJwt","split","jwtDecode","authReducer","action","AuthProvider","dispatch","useReducer","stored","parsed","decoded","setMode","navigate","useNavigate","exp","_unused","isTokenValid","authService","profile","getCurrentUser","setItem","stringify","removeItem","handler","updatedUser","detail","deleted","setUser","addEventListener","removeEventListener","Provider","cookie","_state$user","_state$user2","_state$user3","newMode","profileImageId","className","imageSrc","profileImage","profilePicture","getAbsoluteApiUrl","avatarUrl","encodeURIComponent","max","DateTimeDisplay","setNow","timer","pad","n","padStart","date","getMonth","getDate","getFullYear","time","getHours","getMinutes","getSeconds","letterSpacing","ClockCircleOutlined","Header","Content","Sider","Layout","navConfig","HomeOutlined","FileTextOutlined","MessageOutlined","admin","TeamOutlined","FileSearchOutlined","BarChartOutlined","SettingOutlined","FileProtectOutlined","staff","FileDoneOutlined","HistoryOutlined","_displayUser2","_displayUser3","displayUser","residentImageSrc","setResidentImageSrc","collapsed","setCollapsed","api","residentPersonalInfoAPI","getPersonalInfo","origin","d","default","updated","collapsedWidth","borderRight","overflowX","Menu","theme","selectedKeys","pathname","inlineCollapsed","items","item","_ref2","c","process","WebkitBackgroundClip","WebkitTextFillColor","Space","_displayUser","NotificationOutlined","Dropdown","popupRender","UserOutlined","LogoutOutlined","trigger","shape","AvatarImage","AppLayout","Outlet","Navigate","to","auth","currentUser","extra","off","previewUrl","photo","hasPhoto","photoUrl","photoPath","StatsPanel","_stats$filesCount","_users$total","_users$byRole$admin","_users$byRole","_users$byRole$staff","_users$byRole2","_users$byRole$residen","_users$byRole3","_stats$announcementsC","stats","setStats","mounted","resStats","filesRes","docRequestsRes","announcementsRes","Promise","all","getSystemStatistics","documentsAPI","listFiles","getAllDocuments","getAnnouncements","filesCount","docRequestsCount","announcementsCount","users","documents","total","byRole","CrownOutlined","bordered","it","md","lg","Statistic","LoginForm","guestModalVisible","setGuestModalVisible","emergencyModalVisible","setEmergencyModalVisible","guestForm","Form","useForm","officials","setOfficials","officialsStatus","setOfficialsStatus","carouselRef","offs","info","fetchPublicOfficials","adminOffs","getOfficials","mapped","term","justify","variant","LeftOutlined","scrollBy","getOfficialPhotoSrc","t","onerror","RightOutlined","layout","onFinish","identifier","values","password","autoComplete","requiredMark","rules","required","prefix","Password","LockOutlined","htmlType","block","RouterLink","open","resetFields","onOk","vals","validateFields","contactNumber","intent","guestProfile","sessionToken","expiresAt","form","TextArea","rows","lineHeight","validationSchema","Yup","matches","confirmPassword","oneOf","address","RegisterForm","setSuccess","adminPassword","setAdminPassword","adminUnlocked","setAdminUnlocked","showPassword","setShowPassword","showConfirmPassword","setShowConfirmPassword","fieldErrors","setFieldErrors","formik","useFormik","initialValues","middleName","year","chars","rand","random","generateBarangayID","onSubmit","setSubmitting","resetForm","formErrors","validateForm","Object","keys","Boolean","join","jsonErr","errors","Box","sx","py","Container","Paper","elevation","p","mb","handleSubmit","TextField","fullWidth","handleChange","touched","helperText","InputProps","startAdornment","InputAdornment","Person","Email","Lock","endAdornment","tabIndex","VisibilityOff","Visibility","Home","Phone","select","MenuItem","mt","transition","isSubmitting","Alert","severity","entries","field","msg","Link","component","textDecoration","Dashboard","_user$fullName","_user$barangayID","currentTime","setCurrentTime","setDocuments","unreadNotifications","setUnreadNotifications","setAnnouncementsCount","announcementsLoading","setAnnouncementsLoading","inquiriesCount","setInquiriesCount","pendingModalVisible","setPendingModalVisible","pendingRequestsList","setPendingRequestsList","pendingLoading","setPendingLoading","approvedModalVisible","setApprovedModalVisible","approvedRequestsList","setApprovedRequestsList","approvedLoading","setApprovedLoading","tipsModalVisible","setTipsModalVisible","hideTips","setHideTips","helpHover","setHelpHover","formatDate","getMyDocuments","fetchDocuments","data2","url2","tick","count","fetchInquiries","fetchAnnouncements","pendingCount","doc","approvedCount","bottom","viewBox","fill","xmlns","hoverable","onMouseEnter","onMouseLeave","MailOutlined","Badge","offset","Table","rowKey","record","pagination","pageSize","columns","dataIndex","render","fv","_","dateRequested","requestedAt","dateApproved","approvedAt","approvedOn","updatedAt","Checkbox","checked","paddingLeft","QuestionCircleOutlined","GuestDashboard","StaffDashboard","documentRequests","setDocumentRequests","inboxInquiries","setInboxInquiries","viewedInquiryIds","setViewedInquiryIds","raw","arr","Set","markInquiryViewed","next","from","add","recentActivity","setRecentActivity","miniAnns","setMiniAnns","miniLoading","setMiniLoading","miniSelected","setMiniSelected","drawerVisible","setDrawerVisible","selectedDocument","setSelectedDocument","manageModalVisible","setManageModalVisible","manageTableData","setManageTableData","responseText","setResponseText","documentStatus","setDocumentStatus","responding","setResponding","completedModalVisible","setCompletedModalVisible","docsModalVisible","setDocsModalVisible","allDocuments","setAllDocuments","docsLoading","setDocsLoading","requestsByCategory","forEach","req","docType","push","pendingRequests","totalDocuments","completedRequests","getStatusTag","docRecords","inq","getDocumentRecords","assignedRole","processedCount","params","page","limit","fetchData","fetchMiniAnnouncements","slice","formatDocumentType","word","w","dateString","sortByDateDesc","sort","b","ta","goWithState","go","spinning","tip","pending","openRequestId","backgroundColor","HourglassOutlined","valueStyle","CaretUpOutlined","processedItems","files","processed","e2","fetchAllProcessedDocuments","FolderOutlined","DatabaseOutlined","CheckCircleOutlined","Collapse","defaultActiveKey","expandIcon","isActive","rotate","requests","categories","SafetyCertificateOutlined","description","ProfileOutlined","categorizeRequests","_req$status","Panel","header","request","_request$status","statusColors","PENDING","bg","APPROVED","REJECTED","DEFAULT","statusStyle","actions","ExclamationCircleOutlined","direction","locale","emptyText","Empty","image","PRESENTED_IMAGE_SIMPLE","suffix","accordion","_ref3","isOpen","avatarColor","avatarBg","isViewed","has","letter","borderBottom","dot","flexGrow","pointerEvents","styles","WebkitLineClamp","WebkitBoxOrient","imagePath","Drawer","onClose","rec","normalizeId","$oid","tryIds","nid","ngfid","gridFsFileId","ids","usedId","lastError","finalBlob","finalHeaders","notification","cd","m","decodeURIComponent","m2","downloadName","handleDownloadProcessed","onRow","Column","notes","duration","updateDocumentStatus","_err$response2","_err$response2$data","q","_err$response","_err$response$data","scroll","x","_rec$requesterId","requesterId","socket","onNotificationEvent","event","on","offNotificationEvent","pieColors","AdminDashboard","documentsModalVisible","setDocumentsModalVisible","totalUsers","activeUsers","unreadMessages","notifications","setNotifications","staffAccessNotifs","setStaffAccessNotifs","staffRequests","setStaffRequests","verifs","setVerifs","verifsLoading","setVerifsLoading","verifModalVisible","setVerifModalVisible","selectedVerif","setSelectedVerif","usersTrend","requestsByType","documentCategoryData","fetchDashboardData","_statsRes$documents","_statsRes$documents2","_statsRes$users","_statsRes$users2","_statsRes$documents3","statsRes","docs","unreadNotifs","notificationAPI","getNotifications","read","staffApprovalNotifs","sreqs","requestsAPI","getStaffAccessRequests","systemPending","systemTotalDocs","directPending","allReqs","totalPending","active","completed","inquiriesRes","activityRes","getActivityLogs","log","module","timestamp","userId","cfg","globalThis","__APP_CONFIG__","base","SOCKET_URL","API_BASE","root","endsWith","io","transports","autoConnect","initNotificationSocket","pollInterval","loadVerifs","verificationAPI","getRequests","fetchUsersCount","usersAny","interval","handleApproveStaff","_notif$data","notif","approveStaff","UnreadBadge","kpiCards","labelColor","chart","preserveAspectRatio","stroke","strokeWidth","points","barWidth","barHeight","y","rx","reduce","sum","startAngle","angle","endAngle","largeArc","x1","cos","PI","y1","sin","x2","y2","statCardSubtitles","toLocaleDateString","card","BellOutlined","_record$data","nameFromData","nameFromRequestedByName","requestedByName","nameFromRequestedBy","requestedBy","approveRequest","reason","prompt","rejectStaff","handleRejectStaff","_item$userId","arg","_arg$userId","reqId","verifyUser","handleApproveVerif","_item$userId2","_arg$userId2","rejectRequest","handleRejectVerif","gridFileIds","roleOptions","statusOptions","UserManagement","setUsers","setSearch","roleFilter","setRoleFilter","statusFilter","setStatusFilter","dateRange","setDateRange","setPage","setPageSize","selectedRowKeys","setSelectedRowKeys","drawerOpen","setDrawerOpen","selectedUser","setSelectedUser","selectedResident","setSelectedResident","residentLoading","setResidentLoading","showFullResident","setShowFullResident","editModalOpen","setEditModalOpen","editUserModalOpen","setEditUserModalOpen","userFormValues","setUserFormValues","uploading","setUploading","uploadProgress","setUploadProgress","uploadPreview","setUploadPreview","pendingUploadRef","editFormValues","setEditFormValues","fetchUsers","lastLogin","barangayId","barangay_id","handleDisableUser","suspendedUntil","disableUser","handleEnableUser","enableUser","handleDemoteUser","demoteUser","filteredUsers","matchesSearch","matchesRole","matchesStatus","matchesDate","dayjs","isAfter","isBefore","sorter","localeCompare","sortDirections","fixed","filters","onFilter","format","EditOutlined","StopOutlined","confirm","ReloadOutlined","MoreOutlined","bulkBar","Popconfirm","onConfirm","okText","cancelText","startIdx","endIdx","Breadcrumb","options","DatePicker","RangePicker","rowSelection","showSizeChanger","pageSizeOptions","onShowSizeChange","_current","showTotal","getResidentByBarangayID","getUserWithResident","fetchResidentForUser","sticky","_displayUser4","copyable","span","landlineNumber","birthDate","sex","gender","civilStatus","maritalStatus","nationality","occupation","educationalAttainment","passportNumber","governmentIdNumber","tin","barangayClearanceNumber","spouseName","spouseLastName","numberOfChildren","childrenNames","childrenAges","motherName","fatherName","emergencyContactName","emergencyContact","emergencyContactRelationship","spouseContactNumber","businessName","businessType","businessContactNumber","businessAddress","bloodType","disabilityStatus","facebook","instagram","website","twitter","updateResident","onValuesChange","pattern","beforeUpload","uploadResidentAvatar","fileId","updateUser","updatedUsers","ActivityLogs","CHARTS","chartType","endpoint","colors","age","education","CHART_IDS","defaultQueryClient","QueryClient","defaultOptions","queries","retry","staleTime","refetchOnWindowFocus","StatisticsInner","_summary$totalResiden","_summary$totalDocumen","_ref14","_ref15","_ref16","loadingSummary","setLoadingSummary","summary","setSummary","chartData","setChartData","chartLoading","setChartLoading","setFilters","residentType","selectedCharts","setSelectedCharts","autoEnableWhenData","setAutoEnableWhenData","prevSelectionRef","settingsOpen","setSettingsOpen","chartSettings","setChartSettings","settingsChartId","setSettingsChartId","chartsDropdownOpen","setChartsDropdownOpen","pendingSelectedCharts","setPendingSelectedCharts","fetchSummary","useCallback","_filters$dateRange","_filters$dateRange$","_filters$dateRange$$f","_filters$dateRange2","_filters$dateRange2$","_filters$dateRange2$$","startDate","call","endDate","fetchChart","def","chartId","_cs$dateRange","_cs$dateRange$","_cs$dateRange$$format","_filters$dateRange3","_filters$dateRange3$","_filters$dateRange3$$","_cs$dateRange2","_cs$dateRange2$","_cs$dateRange2$$forma","_filters$dateRange4","_filters$dateRange4$","_filters$dateRange4$$","_res$data","cs","start","end","_p$name","_p$value","totalResidents","totalDocumentRequests","ageBarData","ageMax","Number","ageAxisMax","ceil","monthlyDocData","ChartCard","_cs$showLabels","_cs$showTooltips","_cs$showLegend","hasData","effectiveChartType","showLabels","showTooltips","showLegend","Skeleton","chartRefs","pieData","_ref4","_ref5","_d$type","_ref6","_d$value","group","valueNumber","Pie","angleField","colorField","radius","formatter","datum","_ref7","_p$label","_ref8","_ref9","_p$valueNumber","tooltip","_ref0","_p$label2","_ref1","_ref10","_p$valueNumber2","statistic","legend","Bar","xField","yField","yAxis","tickInterval","Line","Area","dashboardRef","chartIds","chartQueryResults","useQueries","_filters$dateRange5","_filters$dateRange5$","_filters$dateRange5$$","_filters$dateRange6","_filters$dateRange6$","_filters$dateRange6$$","_chartSettings$id","_chartSettings$id$dat","_chartSettings$id$dat2","_chartSettings$id$dat3","_chartSettings$id2","_chartSettings$id2$da","_chartSettings$id2$da2","_chartSettings$id2$da3","queryKey","queryFn","_cs$dateRange3","_cs$dateRange3$","_cs$dateRange3$$forma","_filters$dateRange7","_filters$dateRange7$","_filters$dateRange7$$","_cs$dateRange4","_cs$dateRange4$","_cs$dateRange4$$forma","_filters$dateRange8","_filters$dateRange8$","_filters$dateRange8$$","_res$data2","chartQueryDataKey","chartQueriesMapMemo","useMemo","newData","newLoading","_ref11","_ref12","_p$name2","_ref13","_p$value2","lower","norm","acc","cur","isFetching","isLoading","_chartQueriesMapMemo$","refetch","chartsWithData","available","newSel","reportModalOpen","setReportModalOpen","reportText","setReportText","isMobile","setIsMobile","innerWidth","onResize","boxSizing","dates","f","onOpenChange","onWheel","ev","DownOutlined","Switch","openReport","_s$totalResidents","_gender$find","_gender$find2","charts","ed","monthly","disability","businessSize","incomeBrackets","maleCount","g","femaleCount","otherCount","topAgeGroup","_sorted$","_sorted$2","sorted","topCivil","topEducation","monthlyTotal","peakMonth","peakVal","peak","best","parts","genderPart","topOcc","o","topNat","bt","disabledCount","avgChildren","toFixed","topBiz","totalBusinesses","totalReported","topBracket","generateNarrativeReport","html2canvas","imgData","toDataURL","pdf","jsPDF","unit","orientation","setFontSize","addPage","pageWidth","internal","getWidth","pageHeight","getHeight","usableWidth","tmpImg","Image","onload","imgWidthPts","imgHeightPts","pxPerPt","sliceHeightPt","sliceHeightPx","offCanvas","ctx","getContext","fillStyle","fillRect","drawImage","yOffset","sliceCanvas","sctx","sliceData","drawHeightPts","addImage","save","downloadFullAnalytics","navigator","clipboard","writeText","splitTextToSize","canvas","imgWidth","imgHeight","pdfWidth","pdfHeight","paragraph","_q$error","isError","showIcon","Statistics","QueryClientProvider","client","contactEmail","setTo","sending","setSending","snackOpen","setSnackOpen","snackMessage","setSnackMessage","snackSeverity","setSnackSeverity","bgcolor","settings","getSystemSettings","smtp","host","testSmtp","CircularProgress","Snackbar","autoHideDuration","siteName","barangayName","barangayAddress","contactPhone","maintainanceMode","allowNewRegistrations","requireEmailVerification","maxDocumentRequests","documentProcessingDays","allowMultipleAccountsPerIP","maxAccountsPerIP","systemNotice","port","SystemSettings","_smtp","_smtp2","_smtp3","_maxAccountsPerIP","_maxAccountsPerIP2","setSettings","defaultSystemSettings","saving","setSaving","testModalOpen","setTestModalOpen","officialsLoading","setOfficialsLoading","savingOfficials","setSavingOfficials","manualSaveError","setManualSaveError","autoSaveTimers","officialSaveStatus","setOfficialSaveStatus","previewUrlsRef","previewContainerRef","prevOfficialsCountRef","highlightedIds","setHighlightedIds","highlightTimeouts","originalSettingsRef","dirty","setDirty","ac","AbortController","fetchSettings","signal","abort","container","scrollTo","scrollWidth","tid","clearTimeout","sys","axios","API_URL","withCredentials","err2","saveAll","maintenanceMode","allowRegistrations","maxDocumentRequestsPerUser","updateSystemSettings","handleSave","updatedOfficials","createOfficial","updateOfficial","refreshed","handleManualSaveOfficials","pt","px","pb","gutterBottom","InputLabelProps","shrink","multiline","my","parseInt","TestEmailModal","startIcon","UsergroupAddOutlined","pr","AntdUpload","uploadOfficialPhoto","deleteOfficial","handleDeleteOfficial","previewOrder","scrollSnapType","isHighlighted","scrollSnapAlign","FormControlLabel","control","ml","inputProps","DocumentRequestForm","setFiles","selectedFields","setSelectedFields","modalOpen","setModalOpen","modalDocName","setModalDocName","fieldValues","setFieldValues","purpose","setPurpose","searchTerm","setSearchTerm","selectedCategory","setSelectedCategory","sortBy","setSortBy","submitLoading","setSubmitLoading","lastRequestId","setLastRequestId","verificationModalOpen","setVerificationModalOpen","uploadList","setUploadList","authUser","fetchFiles","filteredFiles","_a$filename$split$pop","uploadDate","pop","defaultValue","verified","html","regex","fields","exec","visibleFields","day","monthNum","monthName","month","mm","dd","currentDateFormatted","handleCardClick","FileWordOutlined","menu","_files$find","_result$documentReque","processedFields","documentType","result","requestDocument","documentRequest","originFileObj","multiple","newList","maxCount","inquiryTypeGroups","InquiryForm","showSuccess","setShowSuccess","subjectCount","setSubjectCount","messageCount","setMessageCount","SUBJECT_MAX","MESSAGE_MAX","currentStep","setCurrentStep","fileListState","setFileListState","previewModalVisible","setPreviewModalVisible","previewValues","setPreviewValues","LOCALSTORAGE_KEY","setFieldsValue","restored","uid","attachment","saveDraft","getFieldsValue","draft","toISOString","onUnload","formatBytes","bytes","parseFloat","pow","onFinishFailed","_errorInfo","headStyle","banner","onFieldsChange","allValues","Steps","Step","InfoCircleOutlined","OptGroup","opt","initialValue","maxLength","valuePropName","getValueFromEvent","Dragger","incoming","nextList","isAllowedType","isLt5M","preview","onPreview","isPdf","Descriptions","column","Goodbye","Logout","InquiryTracker","typeFilter","setTypeFilter","fetch","types","toDate","onCreated","defaultBarangayID","defaultUsername","defaultEmail","submitting","put","confirmLoading","ResidentPortal","avatarPreview","setAvatarPreview","residentMissing","setResidentMissing","showCreateModal","setShowCreateModal","i18n","useTranslation","setProfile","setRequests","editing","setEditing","setForm","staffRequestSent","setStaffRequestSent","requesting","setRequesting","editingUser","setEditingUser","editingPersonal","setEditingPersonal","personalInfo","setPersonalInfo","personalForm","setPersonalForm","dateOfResidency","spouseAge","spouseBirthDate","spouseOccupation","spouseStatus","motherAge","motherBirthDate","motherOccupation","motherStatus","fatherAge","fatherBirthDate","fatherOccupation","fatherStatus","updateTime","formatted","hour","minute","second","hour12","handleChangeUser","handleChangePersonal","reader","FileReader","_e$target","readAsDataURL","_resp$data","_resp$data2","returnedUser","CustomEvent","dispatchEvent","handleBannerAvatarUpload","ResidentCreateModal","backdropFilter","names","deriveNames","first","last","msgs","handleCancelUser","handleEditUser","_resp$data3","serverMsg","_e$response","_e$response$data","borderColor","placeOfBirth","religion","spouseMiddleName","spouseNationality","natureOfBusiness","dateEstablished","registrationNumber","businessPermitNumber","numberOfEmployees","capitalInvestment","annualGrossIncome","businessContactPerson","businessEmail","updatePersonalInfo","handleCancelPersonal","handleEditPersonal","alert","LandingPage","animation","wordBreak","ForgotPassword","sent","setSent","submittedEmail","setSubmittedEmail","code","setCode","verifying","setVerifying","gridTemplateColumns","handleDigit","handleBackspace","handleClear","Radio","ResetPassword","useParams","URLSearchParams","strengthScore","setStrengthScore","strengthLabel","setStrengthLabel","len","pwd","score","evaluateStrength","Progress","percent","MessageInbox","messages","setMessages","fetchNotifications","getInbox","ArrowLeftOutlined","patch","handleMarkAsRead","DocumentHistory","history","setHistory","fetchHistory","completedAt","formatDateUtil","_unused2","_record$processedBy","_record$processedBy2","_record$processedBy3","processedBy","staffBarangayID","Announcements","setText","setFile","anns","setAnns","viewing","setViewing","editText","setEditText","editFile","setEditFile","loadAnns","listAdminAnnouncements","removeFile","LIST_IGNORE","onRemove","showPreviewIcon","CloseCircleOutlined","createAnnouncement","openView","openEdit","deleteAnnouncement","updateAnnouncement","AnnouncementsList","selected","setSelected","ellipsis","VerificationRequests","setData","load","approve","_record$userId","reject","createTheme","palette","primary","main","light","dark","secondary","typography","components","MuiButton","styleOverrides","textTransform","MuiPaper","RootRedirect","App","ThemeProvider","CssBaseline","ConfigProvider","Router","Routes","Route","element","PrivateRoute","StaffRoute","require","AdminRoute","LocalDatabase","constructor","db","getInstance","instance","initialize","this","openDB","upgrade","objectStoreNames","contains","createObjectStore","keyPath","createIndex","autoIncrement","addToSyncQueue","operation","collection","getAllFromSyncQueue","getAll","clearSyncQueue","tx","transaction","objectStore","clear","saveUser","getUser","getAllUsers","deleteUser","saveDocument","getDocument","deleteDocument","saveSettings","getSettings","localDB","SyncService","isOnline","onLine","syncInterval","handleOnline","syncWithServer","handleOffline","setupEventListeners","startSyncInterval","pendingChanges","change","processSyncItem","performOperation","cleanup","syncService","getTemplateText","notificationId","markAsRead","staffRegister","runtimeCfg","create","baseURL","register","userData","interceptors","use","config","Authorization","_error$response","currentPath","requestUrl","responseURL","isLoginRequest","sessionStorage","_e","getFileUrl","requestId","credentials","getDocumentById","processDocument","deleteFile","updateFileStatus","getFilledDocument","previewFilledDocument","contact","getAnnouncementById","getAllRequests","getRequestById","createUser","e1","e3","e4","cached","dbErr","passwordSet","fall","updateUserStatus","getStaffApplicants","getResident","resp2","pfall","method","json","ok","fetchErr","approveStaffApplicant","applicantId","candidates","authAPI","includeTime","dt","isValid","DocumentProcessing","_getPrimaryRequest","_getPrimaryRequest2","_getPrimaryRequest3","_getPrimaryRequest4","modalVisible","setModalVisible","selectedFile","setSelectedFile","requestedTypes","setRequestedTypes","fileRequestMap","setFileRequestMap","previewVisible","setPreviewVisible","previewHtml","setPreviewHtml","previewLoading","setPreviewLoading","previewRequests","setPreviewRequests","previewTemplateHtml","setPreviewTemplateHtml","previewSelectedRequestId","setPreviewSelectedRequestId","rowRefs","residentInfo","setResidentInfo","requestFieldValues","setRequestFieldValues","prioritizeModalVisible","setPrioritizeModalVisible","prioritizeCandidates","setPrioritizeCandidates","selectedPriorityRequest","setSelectedPriorityRequest","prioritizeTargetFileId","setPrioritizeTargetFileId","generatedCopyId","setGeneratedCopyId","generatedModalVisible","setGeneratedModalVisible","processedDocId","setProcessedDocId","filterQuery","setFilterQuery","filterType","setFilterType","filterStatus","setFilterStatus","filterRange","setFilterRange","openRequestIdFromNav","getRequestsForFile","getPrimaryRequest","getPrioritizedRequest","priority","fetchFilesAndRequests","fileRequestMapLocal","normalize","str","normalizedFilename","matchedRequests","some","fid","handleProcessClick","renderPreviewForRequest","tableHtml","prioritized","firstPending","prioritizedPending","previewResp","selectedReqId","flat","openPreview","SearchOutlined","onPressEnter","ext","FilePdfOutlined","FileImageOutlined","rid","metadata","online","rowClassName","requesterName","prioritize","_currentReq","currentReq","currentStatus","cloned","findIndex","updatedRequests","okButtonProps","newId","_link$parentNode","contentDisposition","fnStarMatch","fnMatch","savedId","processedGridFsId","finalSavedId","transactionCode","generateFilledDocx","txId","transactionId","transaction_id","safeId","preferredCode","serverFilename","Blob","link","setAttribute","parentNode","removeChild","processedId","uploaded","tryUrls","uploadErr","markErr"],"sourceRoot":""}