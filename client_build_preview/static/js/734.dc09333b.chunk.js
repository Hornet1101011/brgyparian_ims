"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[734],{11527:(e,t,n)=>{n.r(t),n.d(t,{getAvailableAppointmentDates:()=>i});var a=n(4159),s=n.n(a);function i(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;const t=[];let n=s()().startOf("day");for(n=n.add(1,"day");t.length<e;){const e=n.day();0!==e&&6!==e&&t.push(n),n=n.add(1,"day")}return t}},38734:(e,t,n)=>{n.r(t),n.d(t,{default:()=>cs});var a=n(89379),s=n(9950),i=n(32858),r=n(82056),l=n(87094),o=n(41988),d=n(89096),c=n(78401),u=n(65369),h=n(43850),m=n(23072),p=n(75376),x=n(62934),g=n(35398),f=n(35621),y=n(96172),A=n(51496),j=n(44414);const v=e=>{let{user:t,src:n,profileImageId:i,size:r=40,alt:l="",className:o,style:d,cacheBust:c=!1,cacheToken:u}=e;const h=t,m=i||(null===h||void 0===h?void 0:h.profileImageId)||null,[p,x]=(0,s.useState)(!1);let g=n||(null===h||void 0===h?void 0:h.profileImage)||(null===h||void 0===h?void 0:h.profilePicture)||null;try{g&&"string"===typeof g&&!g.startsWith("http")&&(g=(0,A.getAbsoluteApiUrl)(g))}catch(S){}let f=null,y=null,v=null;try{m&&(f=(0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(m)),y=c?"".concat(f).concat(f.includes("?")?"&":"?","t=").concat(null!==u&&void 0!==u?u:Date.now()):f)}catch(S){}try{y||!g||"string"!==typeof g||g.startsWith("http")?!y&&g&&(v=g):v=(0,A.getAbsoluteApiUrl)(g)}catch(S){}const b=y||v||null;if((0,s.useEffect)(()=>{x(!1)},[b]),b&&!p)return(0,j.jsx)("img",{src:b,alt:l||(null===h||void 0===h?void 0:h.fullName)||(null===h||void 0===h?void 0:h.username)||(null===h||void 0===h?void 0:h.email)||"avatar",width:r,height:r,onError:()=>x(!0),style:(0,a.A)({width:r,height:r,borderRadius:"50%",objectFit:"cover"},d),className:o});const w=((null===h||void 0===h?void 0:h.fullName)||(null===h||void 0===h?void 0:h.username)||(null===h||void 0===h?void 0:h.email)||"").toString().trim()||"User",I="https://ui-avatars.com/api/?name=".concat(encodeURIComponent(w),"&background=2196F3&color=fff&size=").concat(Math.max(Math.min(r,256),32));return(0,j.jsx)("img",{src:I,alt:l||w||"avatar",width:r,height:r,style:(0,a.A)({width:r,height:r,borderRadius:"50%",objectFit:"cover"},d),className:o})},b=e=>{let{src:t,user:n,profileImageId:s,size:i="default",alt:r,className:l,style:o,children:d,icon:c,background:u="#1890ff",color:h="#fff"}=e;const m=(e=>{if("number"===typeof e)return e;switch(e){case"small":return 24;case"large":return 56;default:return 36}})(i),p=Boolean(t||s||n&&(n.profileImage||n.profileImageId||n.profilePicture||n.avatar)),x=["app-avatar","string"===typeof i?"app-avatar--".concat(i):"",l].filter(Boolean).join(" ");if(p){const e=(0,j.jsx)(v,{src:t,user:n,profileImageId:s,size:m,alt:r,className:"app-avatar__img"});if("number"===typeof i){const t=(0,a.A)({width:m,height:m,borderRadius:10,overflow:"hidden",display:"inline-block"},o);return(0,j.jsx)("div",{className:x,style:t,"aria-hidden":!0,children:e})}return(0,j.jsx)("div",{className:x,style:o,"aria-hidden":!0,children:e})}const g=c?(0,j.jsx)("span",{className:"app-avatar__content",children:c}):(0,j.jsx)("span",{className:"app-avatar__content",children:d||(n&&(n.fullName||n.username||n.email)?String((n.fullName||n.username||n.email)[0]).toUpperCase():"U")});if("number"===typeof i){const e=(0,a.A)({width:m,height:m,borderRadius:10,display:"inline-flex",alignItems:"center",justifyContent:"center",background:u,color:h,fontSize:Math.max(12,Math.floor(m/2.8))},o);return(0,j.jsx)("div",{className:x,style:e,"aria-hidden":!0,children:g})}return(0,j.jsx)("div",{className:x,style:o,"aria-hidden":!0,children:g})};var w=n(60405),I=n(74930),S=n(70396),C=n(73608);const k="inbox_message-container__rX6C-",N="inbox_chatImage__YoIVB",T="inbox_inboxPage__qLICz",D="inbox_conversationList__V8Qfk",P="inbox_conversationCard__0ZhMt",_="inbox_replyBarWrap__NrUXO",R="inbox_replyBar__qUVby",U="inbox_sendButton__10H5U",B="inbox_listItem__TZQpm",q="inbox_listItemInner__+Z2ab",L="inbox_listItemMain__R3uU0",O="inbox_listItemHeader__h-API",F="inbox_typeIcon__ANjkn",E="inbox_listItemName__IGuuH",z="inbox_listItemSubject__MISAk",M="inbox_listItemTime__ly-VI",W="inbox_listItemPreview__QUfIX",Y="inbox_listItemPreviewText__0W1MG",V="inbox_listItemResponses__BN1Uo",H="inbox_listItemAvatar__GZMLt",{Option:G}=d.A,K={status:"all",search:""},J=()=>{var e,t;const[n,v]=(0,s.useState)(!0),[G,J]=(0,s.useState)([]),[Z,$]=(0,s.useState)(K),[Q,X]=(0,s.useState)("All"),[ee,te]=(0,s.useState)({}),[ne,ae]=(0,s.useState)(null),[,se]=(0,s.useState)(!1),[ie,re]=(0,s.useState)(!1),[le,oe]=(0,s.useState)(!0),[de,ce]=(0,s.useState)("undefined"!==typeof window&&window.innerWidth<=720),[ue,he]=(0,s.useState)(""),[,me]=(0,s.useState)(!1),pe=(0,s.useRef)(null),xe=null!==(e=null===ne||void 0===ne||null===(t=ne.responses)||void 0===t?void 0:t.length)&&void 0!==e?e:0;(0,s.useEffect)(()=>{pe.current&&pe.current.scrollIntoView({behavior:"smooth"})},[ne,xe]);const ge=(()=>{try{return localStorage.getItem("userProfile")?JSON.parse(localStorage.getItem("userProfile")||"null"):null}catch(e){return null}})();(0,s.useEffect)(()=>{v(!0),A.contactAPI.getMyInquiries().then(e=>{J(e||[])}).catch(()=>{i.Ay.error("Failed to load inbox.")}).finally(()=>v(!1))},[]),(0,s.useEffect)(()=>{const e=()=>{try{ce(window.innerWidth<=720)}catch(e){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{de?(re(!0),oe(!1)):(re(!1),oe(!0))},[de]);const fe=G.filter(e=>{let t=!0;"pending"===Z.status&&(t=!e.responses||0===e.responses.length),"responded"===Z.status&&(t="resolved"===e.status||e.responses&&e.responses.length>0),"closed"===Z.status&&(t="closed"===e.status);let n=!0;Q&&"All"!==Q&&(n=e.category===Q);const a=Z.search.toLowerCase(),s=!a||e.residentName&&e.residentName.toLowerCase().includes(a)||e.category&&e.category.toLowerCase().includes(a)||e.subject&&e.subject.toLowerCase().includes(a)||e.createdAt&&new Date(e.createdAt).toLocaleString().toLowerCase().includes(a);return t&&s&&n}),ye=e=>{me(!0),oe(!1),re(!0),setTimeout(()=>{ae(e),me(!1),se(!0)},250)},Ae=e=>{if(!e)return"";const t=Date.now()-new Date(e).getTime(),n=Math.floor(t/6e4);if(n<1)return"just now";if(n<60)return"".concat(n,"m");const a=Math.floor(n/60);if(a<24)return"".concat(a,"h");const s=Math.floor(a/24);return"".concat(s,"d")},je=e=>{let{author:t,avatar:n,content:a,datetime:s,align:i="left"}=e;return(0,j.jsx)("div",{style:{display:"flex",justifyContent:"left"===i?"flex-start":"flex-end"},children:(0,j.jsxs)("div",{className:k,children:["left"===i&&n,(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{style:{fontSize:13,fontWeight:600},children:t}),(0,j.jsx)("div",{style:{marginTop:6},children:a}),s&&(0,j.jsx)("div",{style:{marginTop:6,fontSize:12,color:"#777"},children:s})]}),"right"===i&&n]})})},ve=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?";if(!e)return t;try{const n=String(e).trim();return n.length>0?n.charAt(0).toUpperCase():t}catch(n){return t}};return(0,j.jsx)("div",{className:T,style:{minHeight:"100vh",background:"#f0f4f8",padding:"24px",fontFamily:"Poppins, Arial, sans-serif",position:"relative"},children:(0,j.jsxs)(r.A,{style:{maxWidth:1200,margin:"0 auto",borderRadius:18,boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.08)",padding:0,background:"#fff"},styles:{body:{padding:0,background:"#fff"}},children:[(0,j.jsxs)("div",{style:{padding:"24px 32px 0 32px"},children:[(0,j.jsxs)(l.A,{gutter:[12,12],align:"middle",style:{marginBottom:12},children:[(0,j.jsx)(o.A,{xs:24,sm:6,children:(0,j.jsxs)(d.A,{value:Q,onChange:e=>X(e),style:{width:"100%"},children:[(0,j.jsx)(d.A.Option,{value:"All",children:"All"}),(0,j.jsx)(d.A.Option,{value:"Complaints",children:"Complaints"}),(0,j.jsx)(d.A.Option,{value:"Requests",children:"Requests"}),(0,j.jsx)(d.A.Option,{value:"Announcements",children:"Announcements"})]})}),(0,j.jsx)(o.A,{xs:24,sm:12,children:(0,j.jsx)(c.A.Search,{placeholder:"Search by date, name, or category",allowClear:!0,value:Z.search,onChange:e=>$(t=>(0,a.A)((0,a.A)({},t),{},{search:e.target.value})),onSearch:e=>$(t=>(0,a.A)((0,a.A)({},t),{},{search:e}))})}),(0,j.jsxs)(o.A,{xs:24,sm:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:8},children:[(0,j.jsx)("div",{style:{flex:1}}),(0,j.jsx)(u.Ay,{type:"text",onClick:()=>re(e=>!e),style:{borderRadius:8},title:ie?"Show conversation list":"Hide conversation list",icon:ie?(0,j.jsx)(w.A,{}):(0,j.jsx)(I.A,{})})]})]}),(0,j.jsxs)(h.A.Title,{level:3,style:{marginBottom:0,color:"#1890ff",display:"flex",alignItems:"center",gap:8,fontFamily:"Poppins, Arial, sans-serif"},children:[(0,j.jsx)("span",{role:"img","aria-label":"inbox",children:"\ud83d\udce9"})," Inbox"]})]}),(0,j.jsx)(m.A,{style:{margin:"16px 0 0 0"}}),(0,j.jsx)("div",{style:{padding:"0 32px 32px 32px"},children:n?(0,j.jsx)(p.A,{}):0===fe.length?(0,j.jsx)(x.Ay,{icon:(0,j.jsx)(S.A,{}),status:"info",title:"No messages yet",subTitle:"There are no messages in your inbox."}):(0,j.jsxs)("div",{style:{display:"flex",gap:16},children:[ie?(0,j.jsxs)("div",{style:{width:72,maxHeight:500,overflowY:"auto",display:"flex",flexDirection:"column",alignItems:"center",gap:8,paddingTop:8},children:[(0,j.jsx)(u.Ay,{type:"text",onClick:()=>re(!1),style:{borderRadius:8,background:"#fff",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},title:"Show list",children:(0,j.jsx)(w.A,{})}),(0,j.jsx)("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:8,padding:8},children:fe.map(e=>{const t=e.residentName||e.username||e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||e.subject||"Unknown",n=t&&"Unknown"!==t?ve(t,"?"):"?",a=ne&&ne._id===e._id;return(0,j.jsx)(y.A,{title:"".concat(t," \u2014 ").concat(e.subject||"No subject"),placement:"right",children:(0,j.jsx)("button",{onClick:()=>ye(e),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",padding:6,borderRadius:8,border:a?"2px solid #1890ff":"1px solid transparent",background:a?"#e6f7ff":"transparent",cursor:"pointer"},"aria-label":t,children:(0,j.jsx)(b,{style:{background:"#1890ff",color:"#fff",fontWeight:700},size:36,children:n})})},e._id)})})]}):(0,j.jsxs)("div",{className:D,style:{flex:le?1:"0 0 300px",maxHeight:le?"calc(100vh - 220px)":500,overflowY:"auto",position:"relative"},children:[(0,j.jsx)(u.Ay,{type:"text",onClick:()=>re(!0),style:{position:"absolute",right:-12,top:-8,zIndex:10,borderRadius:8,background:"#fff",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},title:"Collapse list",children:(0,j.jsx)(I.A,{})}),(0,j.jsx)(g.A,{itemLayout:"vertical",dataSource:fe,renderItem:e=>{const t="resolved"===e.status?(0,j.jsx)(f.A,{color:"green",children:"Resolved"}):Array.isArray(e.responses)&&e.responses.length>0?null:(0,j.jsx)(f.A,{color:"gold",children:"Pending"}),n=(()=>{switch((e.category||"").toLowerCase()){case"complaints":return"\ud83d\uded1";case"requests":return"\ud83d\udce8";case"announcements":return"\ud83d\udce3";default:return"\u2709\ufe0f"}})(),a=ne&&ne._id===e._id;return(0,j.jsx)(g.A.Item,{className:B,style:{marginBottom:8,background:a?"#f7fbff":"#fff",borderRadius:12,border:"1px solid #e6edf3",boxShadow:"0 1px 4px rgba(31,38,135,0.04)",cursor:"pointer"},onClick:()=>ye(e),children:(0,j.jsxs)("div",{className:q,children:[(0,j.jsxs)("div",{className:L,children:[(0,j.jsxs)("div",{className:O,children:[(0,j.jsx)("span",{className:F,"aria-hidden":!0,children:n}),(0,j.jsx)(h.A.Text,{strong:!0,className:E,children:e.residentName||e.username||e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||"Unknown"}),(0,j.jsxs)(h.A.Text,{type:"secondary",className:z,children:["\u2014 ",e.subject||"No subject"]}),(0,j.jsx)("span",{className:M,children:e.createdAt?Ae(e.createdAt):""}),t?s.cloneElement(t,{style:{fontSize:11,padding:"0 6px",marginLeft:8}}):null]}),(0,j.jsx)("div",{className:W,children:(0,j.jsx)(h.A.Text,{type:"secondary",className:Y,children:e.message})}),(0,j.jsx)("div",{className:V,children:Array.isArray(e.responses)&&e.responses.length>0?(0,j.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:12},children:[e.responses.length," response(s)"]}):(0,j.jsx)(h.A.Text,{type:"secondary",style:{fontSize:12},children:"No responses yet"})})]}),(0,j.jsx)("div",{className:H,children:(()=>{const t=e.residentName||e.username||e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||e.subject||"Unknown",n=t&&"Unknown"!==t?ve(t,"?"):"?";return(0,j.jsx)(b,{style:{background:"#1890ff",color:"#fff",fontWeight:700},size:36,children:n})})()})]})})}})]}),!le&&(0,j.jsxs)("div",{style:{flex:1},children:[")",(0,j.jsx)(r.A,{className:P,style:{borderRadius:12,height:"100%",background:"transparent",boxShadow:"none",border:"none"},styles:{body:{display:"flex",flexDirection:"column",padding:0,gap:10,background:"transparent"}},children:ne?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,j.jsx)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:"resolved"===ne.status?(0,j.jsx)(f.A,{color:"green",children:"Resolved"}):(0,j.jsx)(f.A,{color:"gold",children:"Pending"})}),(0,j.jsx)("div",{style:{flex:1},children:(()=>{const e=ne.residentName||ne.username||ne.subject||"Unknown";return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(h.A.Text,{strong:!0,style:{display:"block",textAlign:"right",fontSize:15},children:e}),(0,j.jsx)(h.A.Text,{type:"secondary",style:{fontSize:10,display:"block",textAlign:"right"},children:ne.createdAt?new Date(ne.createdAt).toLocaleString():""})]})})()}),(()=>{const e=ne.residentName||ne.username||ne.createdBy&&(ne.createdBy.fullName||ne.createdBy.username)||ne.subject||"Unknown",t=e&&"Unknown"!==e?ve(e,"?"):"?";return(0,j.jsx)(b,{size:40,style:{background:"#1890ff"},children:t})})()]}),(0,j.jsx)(m.A,{}),(0,j.jsxs)("div",{style:{overflowY:"auto",flex:1,display:"flex",flexDirection:"column",gap:10,paddingRight:6,minHeight:0,maxHeight:220},children:[(0,j.jsx)("div",{style:{alignSelf:"flex-end",maxWidth:"100%"},children:(()=>{const e=ne.residentName||ne.username||ne.createdBy&&(ne.createdBy.fullName||ne.createdBy.username)||"Resident",t=e&&"Resident"!==e?ve(e,"U"):"U";return(0,j.jsx)(je,{author:e,avatar:(0,j.jsx)(b,{style:{background:"#1890ff"},children:t}),content:(0,j.jsxs)("div",{style:{background:"#e6f7ff",padding:10,borderRadius:8},children:[(0,j.jsx)(h.A.Paragraph,{style:{margin:0},children:ne.message}),ne.attachments&&ne.attachments.length>0&&(0,j.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:ne.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,j.jsx)("div",{children:s?(0,j.jsx)("a",{href:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),target:"_blank",rel:"noreferrer",children:(0,j.jsx)("img",{src:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),alt:a,className:N})}):(0,j.jsxs)("div",{children:[(0,j.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,j.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),datetime:(0,j.jsx)("span",{style:{fontSize:12},children:ne.createdAt?new Date(ne.createdAt).toLocaleString():""}),align:"right"})})()}),Array.isArray(ne.responses)&&ne.responses.map((e,t)=>{let n=(e.role||e.authorRole||e.author_role||""||"").toString().toLowerCase();const a=e.author||e.authorName||e.author_name||e.createdByName||e.createdByFullName||e.userName||e.user||"",s=e.createdBy?String(e.createdBy):void 0,i=ge&&(ge._id||ge.id)?String(ge._id||ge.id):void 0;if(!n)try{let t;ne&&(ne.createdBy&&"string"===typeof ne.createdBy?t=String(ne.createdBy):ne.createdBy&&"object"===typeof ne.createdBy&&(ne.createdBy._id||ne.createdBy.id)?t=String(ne.createdBy._id||ne.createdBy.id):ne.residentId&&(t=String(ne.residentId)));const i=ne&&(ne.residentName||ne.username)?String(ne.residentName||ne.username).toLowerCase():"",r=(a||e.authorName||"").toString().toLowerCase();(t&&s&&t===s||i&&r&&i===r)&&(n="resident")}catch(u){}let r;if(a&&""!==a.trim())r=a;else if(i&&s&&i===s)r="You";else if(e.authorName&&""!==e.authorName.trim())r=e.authorName;else if(e.createdBy&&"object"===typeof e.createdBy&&(e.createdBy.fullName||e.createdBy.username))r=e.createdBy.fullName||e.createdBy.username;else if(e.createdByName&&"string"===typeof e.createdByName&&""!==e.createdByName.trim())r=e.createdByName;else if(e.user&&"object"===typeof e.user&&(e.user.fullName||e.user.username))r=e.user.fullName||e.user.username;else if("resident"===n)r=ne&&(ne.residentName||ne.username)?ne.residentName||ne.username:"Resident";else{let t;try{if(s&&ne&&Array.isArray(ne.assignedTo)){const e=ne.assignedTo.find(e=>String(e._id)===String(s));e&&(t=e.fullName||e.username)}}catch(u){}r=e.staffName||e.staffFullName||e.createdBy&&"object"===typeof e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||t||"Staff"}const l="resident"===n||"user"===n,o=i&&s&&i===s,d=l||o?"right":"left",c=l||o?(0,j.jsx)(b,{style:{background:"#1890ff"},children:ve(r,"U")}):(0,j.jsx)(b,{style:{background:"#666"},children:ve(r,"B")});return(0,j.jsx)("div",{style:{alignSelf:l||o?"flex-end":"flex-start",maxWidth:"100%"},children:(0,j.jsx)(je,{author:o?"You":r,avatar:c,content:(0,j.jsxs)("div",{style:{background:l||o?"#e6f7ff":"#f6f6f6",padding:10,borderRadius:8},children:[(0,j.jsx)(h.A.Paragraph,{style:{margin:0},children:e.text}),e.attachments&&e.attachments.length>0&&(0,j.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:e.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,j.jsx)("div",{children:s?(0,j.jsx)("a",{href:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),target:"_blank",rel:"noreferrer",children:(0,j.jsx)("img",{src:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),alt:a,className:N})}):(0,j.jsxs)("div",{children:[(0,j.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,j.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),datetime:(0,j.jsx)("span",{style:{fontSize:12},children:e.createdAt?new Date(e.createdAt).toLocaleString():""}),align:d})},t)}),(0,j.jsx)("div",{ref:pe})]}),(0,j.jsx)("div",{style:{marginTop:0,flexShrink:0},className:_,children:(0,j.jsxs)("div",{className:R,style:{background:"#fff",paddingTop:4,paddingBottom:4,borderTop:"1px solid #f0f0f0",display:"flex",alignItems:"flex-end",gap:8},children:[(0,j.jsx)("textarea",{value:ue,onChange:e=>{he(e.target.value);const t=e.target;t.style.height="auto",t.style.height=Math.min(200,t.scrollHeight)+"px"},onKeyDown:async e=>{if("Enter"===e.key&&!e.shiftKey){if(e.preventDefault(),!ue||""===ue.trim())return i.Ay.warning("Reply cannot be empty");if(!ne||!ne._id)return i.Ay.error("No inquiry selected");const n=ne._id;te(e=>(0,a.A)((0,a.A)({},e),{},{[n]:!0}));try{const e=await A.contactAPI.respondToInquiry(ne._id,{response:ue.trim()});J(t=>t.map(t=>t._id===e._id?e:t)),ae(e),he(""),i.Ay.success("Reply sent")}catch(t){console.error("Failed to send reply",t),i.Ay.error("Failed to send reply")}finally{te(e=>(0,a.A)((0,a.A)({},e),{},{[n]:!1}))}}},placeholder:"Type your reply...",style:{width:"100%",minHeight:40,maxHeight:200,resize:"none",padding:"10px 12px",borderRadius:12,border:"1px solid #e6edf3",boxShadow:"0 1px 4px rgba(15, 23, 42, 0.04)",fontSize:14,outline:"none",fontFamily:"Poppins, Arial, sans-serif",color:"#222"}}),(0,j.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,j.jsx)("button",{onClick:async()=>{if(!ue||""===ue.trim())return i.Ay.warning("Reply cannot be empty");if(!ne||!ne._id)return i.Ay.error("No inquiry selected");const e=ne._id;te(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!0}));try{const e=await A.contactAPI.respondToInquiry(ne._id,{response:ue.trim()});J(t=>t.map(t=>t._id===e._id?e:t)),ae(e),he(""),i.Ay.success("Reply sent")}catch(t){console.error("Failed to send reply",t),i.Ay.error("Failed to send reply")}finally{te(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!1}))}},className:U,style:{background:"#0ea5a3",color:"#fff",border:"none",padding:"8px 14px",borderRadius:10,cursor:"pointer",fontSize:18,fontWeight:600,boxShadow:"0 4px 10px rgba(14,165,163,0.12)",display:"flex",alignItems:"center",justifyContent:"center"},title:"Send Reply",onMouseOver:e=>e.currentTarget.style.opacity="0.95",onMouseOut:e=>e.currentTarget.style.opacity="1",disabled:!(!ne||!ee[ne._id]),children:(0,j.jsx)(C.A,{style:{fontSize:22,verticalAlign:"middle"}})})})]})})]}):(0,j.jsx)("div",{style:{textAlign:"center",padding:32},children:(0,j.jsx)(h.A.Text,{type:"secondary",children:"Select a message to view the conversation"})})})]})]})})]})})};var Z=n(65124),$=n(54021),Q=n(45470),X=n(78433),ee=n(61323);const te="TemplatesManager_wrapper__Ir6oJ",ne="TemplatesManager_heading__IOTUf",ae="TemplatesManager_grid__HGJY6",se="TemplatesManager_card__5oVoa",ie="TemplatesManager_icon__Ngf7T",re="TemplatesManager_cardBody__eAZm7",le="TemplatesManager_cardTitle__11PxV",oe="TemplatesManager_actions__0blV1",de="TemplatesManager_previewModal__MLCBR",ce="TemplatesManager_previewHeader__hgaku",ue="TemplatesManager_previewTitle__uRp0+",he="TemplatesManager_previewClose__uTvt8",me="TemplatesManager_uploadWrap__gDNYG",pe=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(null),[r,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null),[c,h]=(0,s.useState)(null),[m,p]=(0,s.useState)("");return s.useEffect(()=>{(async()=>{l(!0),d(null);try{const e=await A.axiosPublic.get("/documents/list");t(e.data||[])}catch(e){d("Could not load templates.")}l(!1)})()},[]),(0,j.jsxs)("div",{className:te,children:[(0,j.jsx)("h2",{className:ne,children:"\ud83d\udcc2 Templates Manager"}),(0,j.jsxs)("div",{style:{marginBottom:32},children:[r&&(0,j.jsx)("div",{children:"Loading templates..."}),o&&(0,j.jsx)("div",{style:{color:"red"},children:o}),(0,j.jsx)("div",{className:ae,children:e.filter(e=>e&&e.filename).map(e=>{return(0,j.jsxs)("div",{className:se,children:[(0,j.jsx)("img",{src:"/word.png",alt:"Word Icon",className:ie}),(0,j.jsxs)("div",{className:re,children:[(0,j.jsx)("span",{className:le,children:(s=e.filename,s?s.replace(/_/g," ").replace(/\.docx$/,""):"Untitled")}),(0,j.jsxs)("div",{className:oe,children:[(0,j.jsx)(y.A,{title:"Preview",children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)($.A,{}),onClick:async t=>{if(t.stopPropagation(),n===e._id)return a(null),void p("");a(e._id),p("");try{const t=await A.axiosPublic.get("/documents/preview/".concat(e._id,"?format=html"),{responseType:"text"});p(t.data||"")}catch(s){p('<div style="color:red">Failed to load preview.</div>')}},children:"Preview"})}),(0,j.jsx)(y.A,{title:"Download",children:(0,j.jsx)(u.Ay,{type:"primary",icon:(0,j.jsx)(Q.A,{}),onClick:async()=>{h(null);try{const t=(await A.axiosInstance.get("/documents/original/".concat(e._id),{responseType:"blob"})).data,n=window.URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=e.filename,document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(n)}catch(t){h("Failed to download ".concat(e.filename," from MongoDB."))}},children:"Download"})}),(0,j.jsx)(y.A,{title:"Remove",children:(0,j.jsx)(u.Ay,{danger:!0,icon:(0,j.jsx)(X.A,{}),onClick:async()=>{l(!0),d(null);try{const n=(await A.axiosInstance.delete("/documents/file/".concat(e._id))).data;if(n&&n.success){const e=await A.axiosPublic.get("/documents/list");t(e.data||[])}else d("Delete failed.")}catch(n){d("Delete failed.")}l(!1)},children:"Remove"})})]}),n===e._id&&m&&(0,j.jsxs)("div",{className:de,children:[(0,j.jsxs)("div",{className:ce,children:[(0,j.jsx)("span",{className:ue,children:"Preview"}),(0,j.jsx)("button",{className:he,onClick:()=>{a(null),p("")},children:"Close"})]}),(0,j.jsx)("div",{dangerouslySetInnerHTML:{__html:m}})]})]})]},e._id);var s})})]}),c&&(0,j.jsx)("div",{style:{color:"red",marginBottom:16},children:c}),(0,j.jsx)("div",{className:me,children:(0,j.jsx)(Z.A,{accept:".docx",showUploadList:!1,customRequest:async e=>{let{file:n,onSuccess:a,onError:s}=e;l(!0),d(null);const r=new FormData;r.append("file",n);try{const e=(await A.axiosInstance.post("/documents/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data;if(e&&e.success){const e=await A.axiosPublic.get("/documents/list");t(e.data||[]),i.Ay.success("Upload successful"),a&&a("ok")}else d("Upload failed."),i.Ay.error("Upload failed"),s&&s(new Error("Upload failed"))}catch(o){d("Upload failed."),i.Ay.error("Upload failed"),s&&s(new Error("Upload failed"))}l(!1)},children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(ee.A,{}),type:"primary",children:"Upload .docx"})})})]})};var xe=n(10827),ge=n(91285),fe=n(89790);const ye="staffInbox_container__KxE+f",Ae="staffInbox_listPanel__zpTLD",je="staffInbox_threadPanel__xFqlp",ve="staffInbox_replyBar__iIm26",be="staffInbox_replyTextarea__VFa9n";var we=n(59334),Ie=n(65472);const Se=()=>{var e,t;const[n,f]=(0,s.useState)(!0),[y,v]=(0,s.useState)([]),[w,I]=(0,s.useState)({status:"all",search:""}),[k,N]=(0,s.useState)("All"),[T,D]=(0,s.useState)(null),[P,_]=(0,s.useState)(""),[R,U]=(0,s.useState)({}),[B,q]=(0,s.useState)(!1),[L,O]=(0,s.useState)(!1),[F,E]=(0,s.useState)([]),z=(0,xe.zy)(),M=(0,s.useRef)(null);(0,s.useEffect)(()=>{const e=z&&z.state||{},t=e&&e.openInquiryId;t?(async()=>{f(!0);try{const n=await A.contactAPI.getAllInquiries();v(n||[]);const a=(n||[]).find(e=>e._id===t);if(a)return void D(a);try{const e=await A.contactAPI.getInquiryById(t);e&&D(e)}catch(e){}}catch(e){try{const e=await A.contactAPI.getInquiryById(t);e&&(D(e),v(t=>[e,...t]))}catch(n){}}finally{f(!1)}})():W()},[z]);const W=async()=>{f(!0);try{const e=await A.contactAPI.getAllInquiries();v(e||[])}catch(e){console.error("Failed to load inquiries",e)}finally{f(!1)}},Y=null!==(e=null===T||void 0===T||null===(t=T.responses)||void 0===t?void 0:t.length)&&void 0!==e?e:0;(0,s.useEffect)(()=>{M.current&&M.current.scrollIntoView({behavior:"smooth"})},[T,Y]);const V=e=>{if(!e)return"";const t=Date.now()-new Date(e).getTime(),n=Math.floor(t/6e4);if(n<1)return"just now";if(n<60)return"".concat(n,"m");const a=Math.floor(n/60);if(a<24)return"".concat(a,"h");const s=Math.floor(a/24);return"".concat(s,"d")},H=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?";if(!e)return t;try{const n=String(e).trim();return n.length?n.charAt(0).toUpperCase():t}catch(n){return t}},G=e=>{let{author:t,avatar:n,content:a,datetime:s,align:i="left"}=e;return(0,j.jsx)("div",{style:{display:"flex",justifyContent:"left"===i?"flex-start":"flex-end"},children:(0,j.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"flex-start",maxWidth:"80%"},children:["left"===i&&n,(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{style:{fontSize:13,fontWeight:600},children:t}),(0,j.jsx)("div",{style:{marginTop:6},children:a}),s&&(0,j.jsx)("div",{style:{marginTop:6,fontSize:12,color:"#888"},children:s})]}),"right"===i&&n]})})},K=async()=>{if(!P||!T||!T._id)return;const e=T._id;U(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!0}));try{if(T.isNewThread){let e=T.residentUsername||T.username||T.userName||T.author||T.createdBy&&(T.createdBy.username||T.createdBy.userName),t=T.residentBarangayID||T.barangayID||T.createdBy&&T.createdBy.barangayID;if(e&&""!==e||!T.createdBy||("string"===typeof T.createdBy?e=T.createdBy:(T.createdBy.username||T.createdBy.userName)&&(e=T.createdBy.username||T.createdBy.userName),!t&&T.createdBy&&T.createdBy.barangayID&&(t=T.createdBy.barangayID)),(!e||""===e)&&Array.isArray(F)&&T.residentName){const n=F.find(e=>e.label&&e.label.toString().toLowerCase()===(T.residentName||"").toString().toLowerCase());n&&(e=n.username||e,t=n.barangayID||t)}const n=(0,a.A)((0,a.A)({type:"staff_message",subject:"Message to ".concat(T.residentName),message:P.trim()},e?{username:e}:{}),t?{barangayID:t}:{});if(!n.username)return i.Ay.error("Please select a resident to send this message to."),void console.warn("Blocked staff-created inquiry without recipient",{selectedInquiry:T,residents:F});console.debug("Submitting staff-created inquiry payload",n,{selectedInquirySummary:{residentName:T.residentName,residentUsername:T.residentUsername,residentBarangayID:T.residentBarangayID}});const s=await A.contactAPI.submitInquiry(n);i.Ay.success("Message sent to ".concat(T.residentName||n.username)),v(e=>[s].concat(e)),D(s),_("")}else{const t=await A.contactAPI.respondToInquiry(e,{response:P.trim()});v(e=>e.map(e=>e._id===t._id?t:e)),D(t),_("")}}catch(t){console.error("reply failed",t)}finally{U(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!1}))}},J=y.filter(e=>{let t=!0;"pending"===w.status&&(t=!e.responses||0===e.responses.length),"responded"===w.status&&(t="resolved"===e.status||e.responses&&e.responses.length>0),"closed"===w.status&&(t="closed"===e.status);let n=!0;k&&"All"!==k&&(n=e.category===k);const a=(w.search||"").toLowerCase(),s=!a||e.residentName&&e.residentName.toLowerCase().includes(a)||e.subject&&e.subject.toLowerCase().includes(a);return t&&n&&s});return(0,j.jsx)("div",{style:{minHeight:"100vh",background:"#f7f9fb",padding:24},children:(0,j.jsxs)(r.A,{style:{maxWidth:1200,margin:"0 auto",borderRadius:12},styles:{body:{padding:0}},children:[(0,j.jsx)("div",{style:{padding:20},children:(0,j.jsxs)(l.A,{gutter:[12,12],align:"middle",children:[(0,j.jsx)(o.A,{xs:24,sm:6,children:(0,j.jsxs)(d.A,{value:k,onChange:e=>N(e),style:{width:"100%"},children:[(0,j.jsx)(d.A.Option,{value:"All",children:"All"}),(0,j.jsx)(d.A.Option,{value:"Complaints",children:"Complaints"}),(0,j.jsx)(d.A.Option,{value:"Requests",children:"Requests"}),(0,j.jsx)(d.A.Option,{value:"Announcements",children:"Announcements"})]})}),(0,j.jsx)(o.A,{xs:24,sm:12,children:(0,j.jsx)(c.A.Search,{placeholder:"Search by name or subject",allowClear:!0,value:w.search,onChange:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{search:e.target.value})),onSearch:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{search:e}))})}),(0,j.jsx)(o.A,{xs:24,sm:6,children:(0,j.jsxs)(ge.A,{activeKey:w.status||"all",onChange:e=>I(t=>(0,a.A)((0,a.A)({},t),{},{status:e})),children:[(0,j.jsx)(ge.A.TabPane,{tab:"All"},"all"),(0,j.jsx)(ge.A.TabPane,{tab:"Pending"},"pending"),(0,j.jsx)(ge.A.TabPane,{tab:(0,j.jsxs)("span",{children:["Responded"," ",(0,j.jsx)(u.Ay,{type:"link",size:"small",style:{marginLeft:20},icon:(0,j.jsx)(we.A,{}),onClick:e=>{e.stopPropagation(),(async()=>{q(!0),O(!0);try{const e=(await A.adminAPI.getUsers()||[]).filter(e=>{const t=(e.role||e.type||"").toString().toLowerCase();return t.includes("resident")||!t.includes("admin")&&!t.includes("staff")}).map(e=>({label:e.fullName||(e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):e.username||e.email||e.name),username:e.username||e.userName||e.email||e._id,barangayID:e.barangayID||e.brgy||e.barangay&&(e.barangay.id||e.barangayID)}));E(e.filter(e=>e&&e.label))}catch(e){E([])}finally{O(!1)}})()}})]})},"responded")]})})]})}),(0,j.jsx)(m.A,{style:{margin:0}}),(0,j.jsx)(fe.A,{title:"Residents",open:B,onCancel:()=>q(!1),footer:null,children:L?(0,j.jsx)("div",{style:{textAlign:"center"},children:(0,j.jsx)(p.A,{})}):0===F.length?(0,j.jsx)(h.A.Text,{type:"secondary",children:"No residents found."}):(0,j.jsx)(g.A,{dataSource:F,renderItem:e=>(0,j.jsx)(g.A.Item,{style:{cursor:"pointer"},onClick:()=>{const t=e.label,n=e.username,a=e.barangayID,s=y.find(e=>{const a=(e.username||e.residentName||e.createdBy&&(e.createdBy.username||"")||"").toString().toLowerCase();return a&&(n?a===(n||"").toString().toLowerCase():a===(t||"").toString().toLowerCase())});if(s)D(s),q(!1);else{const e={_id:"new-".concat(Date.now()),residentName:t,residentUsername:n,residentBarangayID:a,message:"",responses:[],isNewThread:!0};D(e),console.debug("Resident selected for new thread",e),q(!1)}},children:(0,j.jsx)(g.A.Item.Meta,{avatar:(0,j.jsx)(b,{style:{background:"#1890ff"},children:H(e.label)}),title:e.label})})})}),(0,j.jsx)("div",{style:{padding:16},children:n?(0,j.jsx)(p.A,{}):0===J.length?(0,j.jsx)(x.Ay,{icon:(0,j.jsx)(S.A,{}),title:"No inquiries",subTitle:"There are no inquiries to show."}):(0,j.jsxs)("div",{className:ye,children:[(0,j.jsx)("div",{className:Ae,children:(0,j.jsx)(g.A,{dataSource:J,renderItem:e=>(0,j.jsx)(g.A.Item,{onClick:()=>(e=>{D(e)})(e),style:{cursor:"pointer",marginBottom:8,borderRadius:8,padding:8,border:T&&T._id===e._id?"1px solid #1890ff":"1px solid #eee"},children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,j.jsx)(b,{style:{background:"#1890ff"},children:H(e.residentName||e.username||e.subject,"?")}),(0,j.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,j.jsx)(h.A.Text,{strong:!0,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.residentName||e.username||"Unknown"}),(0,j.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:12},children:["\u2014 ",e.subject||"No subject"]}),(0,j.jsx)("span",{style:{marginLeft:"auto",fontSize:11},children:e.createdAt?V(e.createdAt):""})]}),(0,j.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:13,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.message})]})]})})})}),(0,j.jsx)("div",{className:je,children:(0,j.jsx)(r.A,{style:{borderRadius:8},styles:{body:{display:"flex",flexDirection:"column",gap:12,padding:12}},children:T?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,j.jsxs)("div",{style:{flex:1},children:[(0,j.jsx)(h.A.Text,{strong:!0,style:{display:"block"},children:T.residentName||T.username||"Unknown"}),(0,j.jsx)(h.A.Text,{type:"secondary",children:T.createdAt?new Date(T.createdAt).toLocaleString():""})]}),(0,j.jsx)(b,{size:48,style:{background:"#1890ff"},children:H(T.residentName||T.username)})]}),(0,j.jsx)(m.A,{}),(0,j.jsxs)("div",{style:{overflowY:"auto",maxHeight:340},children:[(0,j.jsxs)("div",{style:{marginBottom:8},children:[(0,j.jsx)(h.A.Paragraph,{style:{margin:0},children:T.message}),T.attachments&&T.attachments.length>0&&(0,j.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:T.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,j.jsx)("div",{children:s?(0,j.jsx)("a",{href:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),target:"_blank",rel:"noreferrer",children:(0,j.jsx)("img",{src:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),alt:a,style:{maxWidth:220,maxHeight:140,borderRadius:8,objectFit:"cover",border:"1px solid #f0f0f0"}})}):(0,j.jsxs)("div",{children:[(0,j.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,j.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),Array.isArray(T.responses)&&T.responses.map((e,t)=>{let n=(e.role||e.authorRole||e.author_role||""||"").toString().toLowerCase();const a=e.author||e.authorName||e.author_name||e.createdByName||e.createdByFullName||e.userName||e.user||"",s=e.createdBy?String(e.createdBy):void 0;if(!n)try{let t;T&&(T.createdBy&&"string"===typeof T.createdBy?t=String(T.createdBy):T.createdBy&&"object"===typeof T.createdBy&&(T.createdBy._id||T.createdBy.id)?t=String(T.createdBy._id||T.createdBy.id):T.residentId&&(t=String(T.residentId)));const i=T&&(T.residentName||T.username)?String(T.residentName||T.username).toLowerCase():"",r=(a||e.authorName||"").toString().toLowerCase();(t&&s&&t===s||i&&r&&i===r)&&(n="resident")}catch(d){}let i;i=a&&""!==a.trim()?a:e.authorName&&""!==e.authorName.trim()?e.authorName:e.createdBy&&"object"===typeof e.createdBy&&(e.createdBy.fullName||e.createdBy.username)?e.createdBy.fullName||e.createdBy.username:"resident"===n?T&&(T.residentName||T.username)?T.residentName||T.username:"Resident":"Staff";const r="resident"===n||"user"===n,l=r?"right":"left",o=r?(0,j.jsx)(b,{style:{background:"#1890ff"},children:H(i,"U")}):(0,j.jsx)(b,{style:{background:"#666"},children:H(i,"B")});return(0,j.jsx)("div",{style:{alignSelf:r?"flex-end":"flex-start",maxWidth:"100%"},children:(0,j.jsx)(G,{author:i,avatar:o,content:(0,j.jsxs)("div",{style:{background:r?"#e6f7ff":"#f6f6f6",padding:10,borderRadius:8},children:[(0,j.jsx)(h.A.Paragraph,{style:{margin:0},children:e.text}),e.attachments&&e.attachments.length>0&&(0,j.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:e.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,j.jsx)("div",{children:s?(0,j.jsx)("a",{href:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),target:"_blank",rel:"noreferrer",children:(0,j.jsx)("img",{src:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),alt:a,style:{maxWidth:220,maxHeight:140,borderRadius:8,objectFit:"cover",border:"1px solid #f0f0f0"}})}):(0,j.jsxs)("div",{children:[(0,j.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,j.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),datetime:(0,j.jsx)("span",{style:{fontSize:12},children:e.createdAt?new Date(e.createdAt).toLocaleString():""}),align:l})},t)}),(0,j.jsx)("div",{ref:M})]}),(0,j.jsxs)("div",{className:ve,children:[(0,j.jsx)("textarea",{value:P,onChange:e=>{_(e.target.value);const t=e.target;t.style.height="auto",t.style.height=Math.min(200,t.scrollHeight)+"px"},onKeyDown:async e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),await K())},placeholder:"Type your reply...",className:be}),(0,j.jsx)(u.Ay,{type:"primary",icon:(0,j.jsx)(C.A,{}),loading:!(!T||!R[T._id]),onClick:K}),(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(Ie.A,{}),onClick:async()=>{if(!T||!T._id)return;const e=T._id;try{const t=await A.contactAPI.resolveInquiry(e);v(e=>e.map(e=>e._id===t._id?t:e)),D(t)}catch(t){console.error("resolve failed",t)}},children:"Resolve"})]})]}):(0,j.jsx)("div",{style:{textAlign:"center",padding:32},children:(0,j.jsx)(h.A.Text,{type:"secondary",children:"Select an inquiry to view details"})})})})]})})]})})};var Ce=n(13191),ke=n(5332),Ne=n(29063),Te=n(80369);const De={isAuthenticated:!1,user:null,token:null},Pe=(0,s.createContext)((0,a.A)((0,a.A)({},De),{},{login:()=>{},logout:()=>{},isStaff:()=>!1,isAdmin:()=>!1,isResident:()=>!1,mode:"resident",switchMode:()=>{}})),_e=()=>(0,s.useContext)(Pe);function Re(e){if(!e||"string"!==typeof e)return null;if(3!==e.split(".").length)return console.warn("safeDecodeJwt: token does not have 3 parts, skipping decode"),null;try{return(0,Te.s)(e)}catch(t){return console.warn("safeDecodeJwt: failed to decode token",t),null}}const Ue=(e,t)=>{switch(t.type){case"LOGIN":case"RESTORE_TOKEN":{let e=null;return e=Re(t.payload),{isAuthenticated:!!e,token:e?t.payload:null,user:e}}case"LOGOUT":return De;default:return e}},Be=e=>{let{children:t}=e;const[i,r]=(0,s.useReducer)(Ue,De);(0,s.useEffect)(()=>{try{const e=localStorage.getItem("userProfile");if(e){const t=JSON.parse(e);if(t&&t.username){const e=localStorage.getItem("token")||null,t=Re(e);e&&t&&r({type:"LOGIN",payload:e})}}}catch(e){}},[]);const[l,o]=s.useState("resident"),d=(0,xe.Zp)();(0,s.useEffect)(()=>{const e=localStorage.getItem("token");e&&function(e){try{const t=Re(e);if(!t)return!1;if(!t.exp)return!1;const n=Date.now()/1e3;return t.exp>n}catch(t){return!1}}(e)?(r({type:"RESTORE_TOKEN",payload:e}),(async()=>{try{const{authService:t}=await Promise.resolve().then(n.bind(n,51496)),a=await t.getCurrentUser();a&&(r({type:"LOGIN",payload:e}),localStorage.setItem("userProfile",JSON.stringify(a)))}catch(t){}})()):(localStorage.removeItem("token"),r({type:"LOGOUT"}))},[]),(0,s.useEffect)(()=>{const e=e=>{try{let t=null===e||void 0===e?void 0:e.detail;if(!t)return;t.user&&(t=t.user),t.data&&t.data.user&&(t=t.data.user);const n=i.user;if(!n)return;if(t.deleted&&t._id&&n._id&&t._id===n._id)return void c(null);(t._id&&n._id&&t._id===n._id||t.username&&n.username&&t.username===n.username)&&c(t)}catch(t){}};return window.addEventListener("userProfileUpdated",e),()=>window.removeEventListener("userProfileUpdated",e)},[i.user]);const c=e=>{if(e){localStorage.setItem("userProfile",JSON.stringify(e));const t=localStorage.getItem("token");t&&r({type:"LOGIN",payload:t})}else localStorage.removeItem("userProfile"),r({type:"LOGOUT"})};return(0,j.jsx)(Pe.Provider,{value:(0,a.A)((0,a.A)({},i),{},{login:e=>{localStorage.setItem("token",e),document.cookie="token=".concat(e,"; path=/; max-age=86400; SameSite=Lax"),r({type:"LOGIN",payload:e}),(async()=>{try{const{authService:t}=await Promise.resolve().then(n.bind(n,51496)),a=await t.getCurrentUser();a&&(localStorage.setItem("userProfile",JSON.stringify(a)),r({type:"LOGIN",payload:e}))}catch(t){}})()},logout:()=>{A.authService.logout().catch(()=>{}),localStorage.removeItem("token"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT;",r({type:"LOGOUT"}),d("/login",{replace:!0})},isStaff:()=>{var e;return"staff"===(null===(e=i.user)||void 0===e?void 0:e.role)},isAdmin:()=>{var e;return"admin"===(null===(e=i.user)||void 0===e?void 0:e.role)},isResident:()=>{var e;return"resident"===(null===(e=i.user)||void 0===e?void 0:e.role)},mode:l,switchMode:e=>{o(e)},setUser:c}),children:t})};var qe=n(63274),Le=n(89980),Oe=n(46004),Fe=n(92163),Ee=n(31990),ze=n(99097),Me=n(88251),We=n(49111),Ye=n(80167),Ve=n(52189),He=n(51844),Ge=n(91381),Ke=n(95727),Je=n(10604),Ze=n(2140),$e=n(9392),Qe=n(54149),Xe=n(62465),et=n(83152),tt=n(15141);const nt=()=>{const[e,t]=(0,s.useState)(new Date);(0,s.useEffect)(()=>{const e=setInterval(()=>t(new Date),1e3);return()=>clearInterval(e)},[]);const n=e=>e.toString().padStart(2,"0"),a="".concat(n(e.getMonth()+1),"/").concat(n(e.getDate()),"/").concat(e.getFullYear()),i="".concat(n(e.getHours()),":").concat(n(e.getMinutes()),":").concat(n(e.getSeconds()));return(0,j.jsxs)("span",{style:{fontSize:13,color:"#888",fontWeight:500,letterSpacing:.5,marginRight:8},children:[(0,j.jsx)(Ee.A,{style:{marginRight:4}}),a," ",i]})},{Header:at,Content:st,Sider:it}=qe.A,rt={resident:[{key:"/home",icon:(0,j.jsx)(ze.A,{}),label:"Home"},{key:"/request",icon:(0,j.jsx)(Me.A,{}),label:"Request"},{key:"/inquiries",icon:(0,j.jsx)(We.A,{}),label:"Inquiries"},{key:"/inbox",icon:(0,j.jsx)(S.A,{}),label:"Inbox"}],admin:[{key:"/admin/dashboard",icon:(0,j.jsx)(ze.A,{}),label:"Admin Dashboard"},{key:"/admin/users",icon:(0,j.jsx)(Ye.A,{}),label:"User Management"},{key:"/admin/statistics",icon:(0,j.jsx)(Ve.A,{}),label:"Statistics"},{key:"/admin/settings",icon:(0,j.jsx)(He.A,{}),label:"System Settings"},{key:"/admin/verification-requests",icon:(0,j.jsx)(Ge.A,{}),label:"Verification Requests"},{key:"/admin/notifications",icon:(0,j.jsx)(Ke.A,{}),label:"Notifications"}],staff:[{key:"/staff-dashboard",icon:(0,j.jsx)(ze.A,{}),label:"Staff Dashboard"},{key:"/staff/inbox",icon:(0,j.jsx)(S.A,{}),label:"Staff Inbox"},{key:"/staff/appointments",icon:(0,j.jsx)(Je.A,{}),label:"Appointments"},{key:"/templates-manager",icon:(0,j.jsx)(Ge.A,{}),label:"Templates Manager"},{key:"/document-processing",icon:(0,j.jsx)(Ze.A,{}),label:"Document Processing"},{key:"/document-history",icon:(0,j.jsx)($e.A,{}),label:"Document History"}]},lt=e=>{let{children:t}=e;const n=(0,xe.zy)(),i=(0,xe.Zp)(),{user:r}=_e();let l=r;try{const e=localStorage.getItem("userProfile");if(e){const t=JSON.parse(e);l=(0,a.A)((0,a.A)({},r||{}),t||{})}}catch(d){}const[o]=(0,s.useState)(!0);return(0,j.jsxs)(qe.A,{style:{minHeight:"100vh",background:"#000"},children:[r&&(0,j.jsx)(it,{width:240,collapsed:o,collapsedWidth:64,style:{height:"100vh",position:"fixed",left:0,top:0,background:"linear-gradient(180deg, #40c9ff 0%, #e81cff 100%)",display:"flex",flexDirection:"column",padding:0,zIndex:100,boxShadow:"2px 0 16px 0 rgba(64,201,255,0.10)",borderRight:"none",overflowX:"hidden"},children:(0,j.jsx)("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"24px 0 0 0",display:"flex",flexDirection:"column"},children:(0,j.jsx)(Le.A,{theme:"light",mode:"inline",selectedKeys:[n.pathname],style:{background:"transparent",fontWeight:600,fontSize:17,border:"none"},inlineCollapsed:o,items:rt["admin"===(null===r||void 0===r?void 0:r.role)?"admin":"staff"===(null===r||void 0===r?void 0:r.role)?"staff":"resident"].map(e=>(0,a.A)((0,a.A)({},e),{},{className:n.pathname===e.key?"ant-menu-item-active-custom":void 0})),onClick:e=>{let{key:t}=e;n.pathname!==t&&i(t)}})})}),(0,j.jsxs)(qe.A,{style:{marginLeft:r?o?64:240:0},children:[(0,j.jsxs)(at,{className:"app-header",style:{height:64,background:"#fff",display:"flex",flexWrap:"nowrap",alignItems:"center",justifyContent:"space-between",padding:"0 32px",position:"fixed",left:r?o?64:240:0,right:0,top:0,zIndex:101,boxShadow:"0 2px 8px #e3e6f3"},children:[(0,j.jsxs)("div",{className:"responsive-system-title",style:{display:"flex",alignItems:"center",gap:12,maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[(0,j.jsx)("img",{src:"".concat("","/logo-parian2.png"),alt:"Logo",style:{width:36,height:36,marginRight:4}}),(0,j.jsxs)("span",{style:{fontSize:26,fontWeight:400,letterSpacing:1,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",display:"inline-block",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["Barangay Information ",(0,j.jsx)("span",{style:{fontWeight:800},children:"Management System"})]})]}),(0,j.jsxs)("div",{className:"header-controls",style:{display:"flex",alignItems:"center",gap:16,position:"relative",marginRight:8},children:[(0,j.jsx)("span",{style:{marginRight:8},children:(0,j.jsx)(nt,{})}),(0,j.jsx)(Oe.A,{size:12,children:l&&(0,j.jsx)(u.Ay,{size:"small",onClick:()=>{var e;return i("admin"===(null===(e=l)||void 0===e?void 0:e.role)?"/admin/announcements":"/announcements")},icon:(0,j.jsx)(Qe.A,{})})}),(()=>{const e=[{key:"profile",icon:(0,j.jsx)(Xe.A,{}),label:"Profile"},..."admin"===(null===r||void 0===r?void 0:r.role)?[{key:"settings",icon:(0,j.jsx)(He.A,{}),label:"Settings"}]:[],{type:"divider",key:"divider-1"},{key:"logout",icon:(0,j.jsx)(et.A,{}),label:"Logout"}];return(0,j.jsx)(Fe.A,{menu:{items:e,onClick:e=>{let{key:t}=e;"profile"===t?i("/profile"):"settings"===t?i("/admin/settings"):"logout"===t&&i("/logout")}},placement:"bottomRight",trigger:["click"],children:(0,j.jsx)("div",{style:{cursor:"pointer",display:"inline-flex",alignItems:"center",gap:8,padding:2},children:(0,j.jsx)(u.Ay,{type:"default",shape:"circle",size:"small",icon:(0,j.jsx)(tt.A,{})})})})})()]})]}),(0,j.jsx)("div",{style:{height:1,background:"#f0f0f0",width:"100%",margin:0,boxShadow:"none"}}),(0,j.jsx)(st,{style:{marginTop:64,padding:32,background:"linear-gradient(135deg, #e3f6fd 0%, #b3e0ff 60%,  #b3e0ff 100%)",minHeight:"calc(100vh - ".concat(64,"px)")},children:t})]})]})},ot=e=>{let{children:t}=e;return(0,j.jsx)(lt,{children:t||(0,j.jsx)(xe.sv,{})})},dt=e=>{let{children:t}=e;const{isAuthenticated:n,user:a}=_e();return n||a&&"guest"===a.role?(0,j.jsx)(j.Fragment,{children:t}):(0,j.jsx)(xe.C5,{to:"/login",replace:!0})},ct=e=>{let{children:t}=e;const{isAuthenticated:n,user:a}=_e();return n?"staff"!==(null===a||void 0===a?void 0:a.role)&&"admin"!==(null===a||void 0===a?void 0:a.role)?(0,j.jsx)(xe.C5,{to:"/dashboard",replace:!0}):(0,j.jsx)(j.Fragment,{children:t}):(0,j.jsx)(xe.C5,{to:"/login",replace:!0})},ut=e=>{let{children:t}=e;const n=_e(),a=(0,xe.Zp)(),s=null===n||void 0===n?void 0:n.user,i="function"===typeof(null===n||void 0===n?void 0:n.isAdmin)?n.isAdmin():"admin"===(null===s||void 0===s?void 0:s.role)||!0===(null===s||void 0===s?void 0:s.isAdmin),r="undefined"!==typeof window?localStorage.getItem("token"):null;return!s&&r?(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:(0,j.jsx)(p.A,{size:"large"})}):s?i?t:(0,j.jsx)(x.Ay,{status:"403",title:"403",subTitle:"Sorry, you are not authorized to access this page.",extra:(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>a("/dashboard"),children:"Go to Dashboard"})}):(0,j.jsx)(xe.C5,{to:"/login",replace:!0})},ht=e=>{let{children:t}=e;const{isAuthenticated:n,user:a}=_e();(0,xe.Zp)();if(!n&&(!a||"guest"!==a.role))return(0,j.jsx)(xe.C5,{to:"/login",replace:!0});try{if(a&&"resident"===a.role&&!1===a.verified){try{i.Ay.info("Please verify your account or wait for admin approval before requesting documents. Redirecting to your profile.")}catch(s){}return(0,j.jsx)(xe.C5,{to:"/profile",replace:!0})}}catch(r){}return(0,j.jsx)(j.Fragment,{children:t})};var mt=n(56991),pt=n(32221);const xt=function(e){const t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=";return e?e.previewUrl?e.previewUrl:e.photo&&e._id?(0,A.getAbsoluteApiUrl)("/admin/officials/".concat(e._id,"/photo")):e.hasPhoto&&e._id?(0,A.getAbsoluteApiUrl)("/officials/".concat(e._id,"/photo")):e.photoUrl?e.photoUrl:e.photoPath?(0,A.getAbsoluteApiUrl)("/".concat(e.photoPath.replace(/^\//,""))):t:t};var gt=n(26483),ft=n(97427);const yt=()=>{var e,t,n,i,d,c,u,m,x;const[g,f]=(0,s.useState)(null),[y,v]=(0,s.useState)(!0);if((0,s.useEffect)(()=>{let e=!0;return(async()=>{try{const[n,s,i]=await Promise.all([A.documentsAPI.listFiles().catch(()=>[]),A.documentsAPI.getAllDocuments().catch(()=>[]),A.contactAPI.getAnnouncements().catch(()=>[])]);let r=null;try{r=await A.adminAPI.getSystemStatistics()}catch(t){console.warn("Could not fetch admin statistics (likely unauthenticated):",String(t)),r=null}if(e){const e=Array.isArray(n)?n.length:n&&n.length||0,t=Array.isArray(s)?s.length:s&&s.length||0,l=Array.isArray(i)?i.length:i&&i.length||0;f((0,a.A)((0,a.A)({},r||{}),{},{filesCount:e,docRequestsCount:t,announcementsCount:l}))}}catch(n){console.error("Failed to load system statistics",n)}finally{e&&v(!1)}})(),()=>{e=!1}},[]),y)return(0,j.jsx)("div",{style:{width:"100%",textAlign:"center"},children:(0,j.jsx)(p.A,{})});if(!g)return(0,j.jsx)("div",{style:{textAlign:"center"},children:(0,j.jsx)(h.A.Text,{type:"secondary",children:"No statistics available"})});const b=g.users||{},w=null!==(e=g.filesCount)&&void 0!==e?e:0,I=[{key:"users",title:"Total Users",value:null!==(t=b.total)&&void 0!==t?t:0,icon:(0,j.jsx)(Xe.A,{style:{color:"#9254de",fontSize:20}})},{key:"admins",title:"Admins",value:null!==(n=null===(i=b.byRole)||void 0===i?void 0:i.admin)&&void 0!==n?n:0,icon:(0,j.jsx)(ft.A,{style:{color:"#f5a623",fontSize:20}})},{key:"staff",title:"Staff",value:null!==(d=null===(c=b.byRole)||void 0===c?void 0:c.staff)&&void 0!==d?d:0,icon:(0,j.jsx)(Ye.A,{style:{color:"#1677ff",fontSize:20}})},{key:"residents",title:"Residents",value:null!==(u=null===(m=b.byRole)||void 0===m?void 0:m.resident)&&void 0!==u?u:0,icon:(0,j.jsx)(ze.A,{style:{color:"#22c55e",fontSize:20}})},{key:"announcements",title:"Announcements",value:null!==(x=g.announcementsCount)&&void 0!==x?x:0,icon:(0,j.jsx)(Qe.A,{style:{color:"#faad14",fontSize:20}})},{key:"docFiles",title:"Documents Available",value:w,icon:(0,j.jsx)(Me.A,{style:{color:"#0ea5e9",fontSize:20}})}];return(0,j.jsxs)(r.A,{className:"glass-card stats-card",style:{width:"100%"},children:[(0,j.jsx)(h.A.Title,{level:4,children:"Quick Stats"}),(0,j.jsx)("div",{style:{height:6,background:"linear-gradient(90deg, rgba(22,119,255,0.08), rgba(146,84,222,0.08))",borderRadius:4,marginBottom:12}}),(0,j.jsx)(l.A,{gutter:[12,12],style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:I.map(e=>(0,j.jsx)(o.A,{xs:12,sm:8,md:8,lg:8,style:{display:"flex"},children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,width:"100%"},children:[(0,j.jsx)("div",{style:{width:44,height:44,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.9)",borderRadius:8,boxShadow:"0 6px 14px rgba(2,6,23,0.06)"},children:e.icon}),(0,j.jsx)("div",{style:{flex:1},children:(0,j.jsx)(gt.A,{title:e.title,value:e.value})})]})},e.key))})]})};var At=n(18271),jt=n(10734);const vt=()=>{const{login:e,isAuthenticated:t,user:n,setUser:a}=_e(),[d,m]=(0,s.useState)(!1),[p,x]=(0,s.useState)(!1),[g]=mt.A.useForm(),f=(0,xe.Zp)(),[y,v]=(0,s.useState)(!1),[b,w]=(0,s.useState)([]),[,I]=(0,s.useState)("loading"),S=(0,s.useRef)(null);(0,s.useEffect)(()=>{t&&n&&("admin"===n.role?f("/admin/dashboard"):"staff"===n.role?f("/staff-dashboard"):"guest"===n.role?f("/guest/dashboard"):f("/dashboard"))},[t,n,f]),(0,s.useEffect)(()=>{let e=!0;return(async()=>{try{I("fetching public");const a=await async function(){try{let e=(await A.axiosPublic.get("/officials")).data;return e&&Array.isArray(e.data)&&(e=e.data),e&&Array.isArray(e.officials)&&(e=e.officials),Array.isArray(e)?(0===e.length&&console.info("fetchPublicOfficials: server returned empty list"),e):(console.warn("fetchPublicOfficials: unexpected payload shape",e),[])}catch(e){return console.error("fetchPublicOfficials error",e),[]}}();if(e&&Array.isArray(a)&&a.length>0)w(a),I("public:".concat(a.length));else if(t){I("trying-admin-fallback");try{const t=await A.adminAPI.getOfficials();if(e&&Array.isArray(t)&&t.length>0){const e=t.map(e=>({_id:e._id,name:e.name,title:e.title,term:e.term,hasPhoto:!!e.photo||!!e.photoPath}));w(e),I("admin:".concat(e.length))}else I("no-officials")}catch(n){console.warn("Admin fallback failed",n),I("error")}}else I("no-officials")}catch(n){console.warn("Failed to fetch public officials for login preview",n),I("error")}})(),()=>{e=!1}},[t]);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:"login-page",children:(0,j.jsx)("div",{className:"login-container two-pane",children:(0,j.jsxs)(l.A,{gutter:24,align:"stretch",justify:"center",className:"two-pane-row",children:[(0,j.jsx)(o.A,{xs:24,md:12,className:"pane left-pane combined-pane",children:(0,j.jsx)("div",{className:"pane-inner left-inner",children:(0,j.jsxs)("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:18},children:[(0,j.jsx)(yt,{}),(0,j.jsxs)(r.A,{className:"glass-card preview-card invisible",variant:"outlined",children:[(0,j.jsx)(h.A.Title,{level:4,style:{marginBottom:8},children:"Barangay Officials"}),(0,j.jsx)("div",{style:{height:6,background:"linear-gradient(90deg, rgba(22,119,255,0.12), rgba(146,84,222,0.12))",borderRadius:4,marginBottom:12}}),(0,j.jsxs)("div",{className:"carousel-wrap",children:[(0,j.jsx)(u.Ay,{className:"carousel-arrow left",icon:(0,j.jsx)(At.A,{}),onClick:()=>{S.current&&S.current.scrollBy({left:-240,behavior:"smooth"})}}),(0,j.jsx)("div",{ref:S,className:"carousel-scroll",children:0===b.length?(0,j.jsx)(h.A.Text,{type:"secondary",children:"No officials to preview"}):b.map(e=>(0,j.jsxs)("div",{className:"official-card",children:[(0,j.jsx)("div",{className:"official-avatar",children:(0,j.jsx)("img",{alt:e.name,src:xt(e),style:{width:"100%",height:"100%",objectFit:"cover"},onError:e=>{try{const t=e.currentTarget;t.onerror=null,t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII="}catch(t){}}})}),(0,j.jsx)("div",{style:{fontWeight:700},children:e.name}),(0,j.jsx)("div",{style:{color:"#666",fontSize:13},children:e.title}),(0,j.jsx)("div",{style:{color:"#999",fontSize:12},children:e.term})]},e._id))}),(0,j.jsx)(u.Ay,{className:"carousel-arrow right",icon:(0,j.jsx)(jt.A,{}),onClick:()=>{S.current&&S.current.scrollBy({left:240,behavior:"smooth"})}})]})]})]})})}),(0,j.jsx)(o.A,{xs:24,md:12,className:"pane center-pane login-pane",children:(0,j.jsx)("div",{className:"pane-inner center-inner",children:(0,j.jsxs)(r.A,{className:"glass-card login-card",variant:"outlined",children:[(0,j.jsx)(h.A.Title,{level:2,className:"title-blue",style:{textAlign:"center",marginBottom:6},children:"Barangay Information System"}),(0,j.jsx)(h.A.Text,{style:{display:"block",textAlign:"center",color:"#9254de",fontWeight:500,marginBottom:18},children:"Sign In"}),(0,j.jsxs)(mt.A,{name:"login",layout:"vertical",onFinish:async t=>{v(!0);try{const n=(t.username||"").toString().trim(),a=n.includes("@")?{email:n,password:t.password}:{identifier:n,password:t.password},s=await A.axiosInstance.post("/auth/login",a),r=s&&s.data?s.data:{};if(!s||s.status>=400)throw console.error("Login response not OK:",{status:null===s||void 0===s?void 0:s.status,data:r}),new Error(r.message||"Login failed");if(!r.token)throw console.error("No token in response:",r),new Error("Login failed - No token received");e(r.token),i.Ay.success(r.message||"Login successful!")}catch(s){const e=null===s||void 0===s?void 0:s.response;if(e&&e.status)if(401===e.status)i.Ay.error("Invalid username/email or password");else if(403===e.status){var n;const t=(null===(n=e.data)||void 0===n?void 0:n.message)||"Account is not allowed to login";i.Ay.error(t)}else if(404===e.status)i.Ay.error("Account not found");else{var a;i.Ay.error((null===(a=e.data)||void 0===a?void 0:a.message)||"Login failed")}else i.Ay.error(s.message||"Error logging in");console.error("Login error:",s)}finally{v(!1)}},autoComplete:"off",requiredMark:!1,children:[(0,j.jsx)(mt.A.Item,{label:"Email or Username",name:"username",rules:[{required:!0,message:"Please input your email or username!"}],children:(0,j.jsx)(c.A,{prefix:(0,j.jsx)(Xe.A,{style:{color:"#40a9ff"}}),placeholder:"Enter your email or username",size:"large"})}),(0,j.jsx)(mt.A.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"},{min:6,message:"Password must be at least 6 characters"}],children:(0,j.jsx)(c.A.Password,{autoComplete:"current-password",prefix:(0,j.jsx)(pt.A,{style:{color:"#40a9ff"}}),placeholder:"Enter your password",size:"large"})}),(0,j.jsx)(mt.A.Item,{children:(0,j.jsx)(u.Ay,{htmlType:"submit",size:"large",loading:y,className:"signin-btn",children:y?"Signing In...":"Sign In"})}),(0,j.jsx)(mt.A.Item,{children:(0,j.jsx)(u.Ay,{onClick:()=>m(!0),size:"large",className:"guest-warm-btn",block:!0,children:"Continue as Guest"})}),(0,j.jsxs)("div",{className:"links-row",children:[(0,j.jsx)(xe.N_,{to:"/forgot-password",children:(0,j.jsx)(h.A.Text,{type:"secondary",children:"Forgot Password?"})}),(0,j.jsx)(xe.N_,{to:"/register",children:(0,j.jsx)(h.A.Text,{type:"secondary",children:"Sign Up"})})]}),(0,j.jsx)("div",{style:{marginTop:8,textAlign:"center"},children:(0,j.jsx)(u.Ay,{type:"link",onClick:()=>x(!0),children:(0,j.jsx)(h.A.Text,{type:"danger",children:"Emergency Hotline"})})})]})]})})})]})})}),(0,j.jsx)(fe.A,{title:"Continue as Guest",open:d,onCancel:()=>{m(!1),g.resetFields()},onOk:async()=>{try{const s=await g.validateFields();try{const n=await A.axiosPublic.post("/auth/guest",{name:s.name,contactNumber:s.contactNumber,email:s.email,intent:s.intent}),r=n&&n.data?n.data:{};if(!n||n.status>=400)return void i.Ay.error(r.message||"Failed to create guest");const l={_id:r._id,username:(s.name||"guest").toString().toLowerCase().replace(/\s+/g,"_"),firstName:s.name||"Guest",contactNumber:s.contactNumber||"",email:s.email||"",intent:s.intent||"",sessionToken:r.sessionToken,expiresAt:r.expiresAt,role:"guest"};if("function"===typeof a&&a(l),localStorage.setItem("guestInfo",JSON.stringify(l)),localStorage.setItem("guestSessionToken",r.sessionToken),r.token&&"function"===typeof e)try{await e(r.token)}catch(t){console.warn("Guest token login failed",t)}m(!1),g.resetFields(),f("/guest/dashboard")}catch(n){console.error("Failed to persist guest",n),i.Ay.error("Failed to create guest account")}}catch(n){}},children:(0,j.jsxs)(mt.A,{layout:"vertical",form:d?g:void 0,children:[(0,j.jsx)(mt.A.Item,{name:"name",label:"Full name",rules:[{required:!0,message:"Please enter your name"}],children:(0,j.jsx)(c.A,{placeholder:"Your full name"})}),(0,j.jsx)(mt.A.Item,{name:"contactNumber",label:"Contact number",rules:[{required:!0,message:"Please enter a contact number"}],children:(0,j.jsx)(c.A,{placeholder:"0917..."})}),(0,j.jsx)(mt.A.Item,{name:"email",label:"Email (optional)",rules:[{type:"email",message:"Enter a valid email"}],children:(0,j.jsx)(c.A,{placeholder:"you@example.com"})}),(0,j.jsx)(mt.A.Item,{name:"intent",label:"Purpose / Intent",rules:[{required:!0,message:"Please tell us your intent"}],children:(0,j.jsx)(c.A.TextArea,{placeholder:"Why are you visiting (e.g., check documents, request info)",rows:3})})]})}),(0,j.jsx)(fe.A,{title:"Emergency Hotlines",open:p,onCancel:()=>x(!1),footer:null,children:(0,j.jsxs)("div",{style:{lineHeight:1.6},children:[(0,j.jsxs)(h.A.Paragraph,{children:["For general emergencies: ",(0,j.jsx)("strong",{children:"911"})]}),(0,j.jsxs)(h.A.Paragraph,{children:["National Center for Mental Health (Crisis): ",(0,j.jsx)("strong",{children:"0917-899-8727"})]}),(0,j.jsxs)(h.A.Paragraph,{children:["Philippine National Police (Emergency Hotline): ",(0,j.jsx)("strong",{children:"9-1-1"})," / ",(0,j.jsx)("strong",{children:"8723-0401"})," / ",(0,j.jsx)("strong",{children:"8537-4500"})]})]})})]})};var bt=n(43939),wt=n(29714),It=n(27321),St=n(36703),Ct=n(38796),kt=n(65342),Nt=n(31752),Tt=n(5352),Dt=n(66615),Pt=n(41680),_t=n(29920),Rt=n(18544),Ut=n(34244),Bt=n(17742),qt=n(48864),Lt=n(9494),Ot=n(13285),Ft=n(23670),Et=n(17871),zt=n(20599),Mt=n(39872),Wt=n(81211),Yt=n(53574);const Vt=/^[A-Za-z\s'-]+$/,Ht=wt.Ik({username:wt.Yj().matches(/^[a-zA-Z0-9]{4,20}$/,"Username must be 4-20 characters and contain only letters and numbers").required("Username is required"),email:wt.Yj().email("Invalid email address").required("Email is required"),password:wt.Yj().matches(/^(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{6,}$/,"Password must be at least 6 characters long and contain at least one number, one uppercase letter, and one special character").required("Password is required"),confirmPassword:wt.Yj().oneOf([wt.KR("password"),void 0],"Passwords must match").required("Confirm Password is required"),address:wt.Yj().required("Address is required"),contactNumber:wt.Yj().matches(/^\d{11}$/,"Contact number must be exactly 11 digits").required("Contact Number is required"),barangayID:wt.Yj().required("Barangay ID is required")}),Gt=()=>{const e=(0,xe.Zp)(),[t,n]=s.useState(""),[,a]=s.useState(""),[r]=s.useState(!1),[l,o]=s.useState(!1),[d,c]=s.useState(!1),[m,p]=s.useState({}),[x,g]=s.useState(null),[f,v]=s.useState(null),[b,w]=s.useState([]),[I,S]=s.useState([]),[C,k]=s.useState([]),N=s.useRef(new Set);s.useEffect(()=>{const e=N.current;return()=>{try{e.forEach(e=>{try{URL.revokeObjectURL(e)}catch(t){}})}catch(t){}try{e.clear()}catch(n){}}},[]);const[T,D]=s.useState(0),[P,_]=s.useState(!1),[R,U]=s.useState(""),[B,q]=s.useState(null),[L,O]=s.useState(!1),[F,E]=s.useState(0),[z,M]=s.useState(""),[W,Y]=s.useState(!1),[V,H]=s.useState(!1);const G=(0,bt.Wx)({initialValues:{firstName:"",middleName:"",lastName:"",username:"",email:"",password:"",confirmPassword:"",address:"",contactNumber:"",barangayID:function(){const e=(new Date).getFullYear(),t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let a=0;a<6;a++)n+=t.charAt(Math.floor(62*Math.random()));return"brgyparian-".concat(e,"-").concat(n)}(),role:"resident"},validationSchema:Ht.shape({firstName:wt.Yj().matches(Vt,"First name may only contain letters, spaces, hyphens, and apostrophes").required("First name is required"),middleName:wt.Yj().matches(Vt,"Middle name may only contain letters, spaces, hyphens, and apostrophes").notRequired(),lastName:wt.Yj().matches(Vt,"Last name may only contain letters, spaces, hyphens, and apostrophes").required("Last name is required"),role:wt.Yj().oneOf(["resident"]).required("Role is required")}),validateOnChange:!0,validateOnBlur:!0,onSubmit:async(t,s)=>{let{setSubmitting:r,resetForm:l}=s;n(""),p({}),O(!0),E(5),M("Checking information fields...");const o=await G.validateForm();if(Object.keys(o).length>0)return n("Please correct the highlighted errors before submitting."),r(!1),M("Validation failed. Please correct the highlighted fields."),E(0),void O(!1);E(15),M("Validating availability of username, email and contact number...");try{var d,c,u;const[e,a,s]=await Promise.all([A.axiosInstance.get("/auth/check-username",{params:{username:t.username}}),A.axiosInstance.get("/auth/check-email",{params:{email:t.email}}),A.axiosInstance.get("/auth/check-contact",{params:{contact:t.contactNumber}})]),i=Boolean(null===e||void 0===e||null===(d=e.data)||void 0===d?void 0:d.available),l=Boolean(null===a||void 0===a||null===(c=a.data)||void 0===c?void 0:c.available),o=Boolean(null===s||void 0===s||null===(u=s.data)||void 0===u?void 0:u.available);if(!i||!l||!o){const e={};return i||(e.username="Username already in use"),l||(e.email="Email already registered"),o||(e.contactNumber="Contact number already registered"),p(e),n("Please correct the highlighted errors before submitting."),r(!1),M("Some fields are already in use. Fix them and try again."),E(0),void O(!1)}}catch(h){console.warn("Availability checks failed",h),M("Availability checks could not be completed \u2014 proceeding with submission."),E(30)}try{const s=[t.firstName,t.middleName,t.lastName].filter(Boolean).join(" ");E(40),M("Saving account...");const o=await A.axiosInstance.post("/auth/register",{fullName:s,firstName:t.firstName,middleName:t.middleName,lastName:t.lastName,username:t.username,email:t.email,password:t.password,address:t.address,contactNumber:t.contactNumber,barangayID:t.barangayID,role:t.role});let d={};try{d=o&&o.data?o.data:{}}catch(m){return void n("Server error: Could not parse response")}if(o&&o.status>=200&&o.status<300){a("Registration successful!");const s=d&&d.token?d.token:null;if(s&&(x||f||B))try{U("Uploading verification documents..."),E(60),M("Uploading verification documents..."),_(!0),D(0);const e={"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(s)},n=new FormData;x&&n.append("ids",x,x.name),f&&n.append("ids",f,f.name),B&&n.append("ids",B,B.name),x&&n.append("fileTypes","proof"),f&&n.append("fileTypes","govid"),B&&n.append("fileTypes","selfie"),t.barangayID&&n.append("barangayID",t.barangayID),await A.axiosInstance.post("/verification/upload",n,{headers:e,onUploadProgress:e=>{const t="number"===typeof(null===e||void 0===e?void 0:e.loaded)?e.loaded:0,n="number"===typeof(null===e||void 0===e?void 0:e.total)?e.total:0;if(n>0){const e=Math.round(100*t/n);D(e),E(60+Math.round(e/100*30))}}}),U("Upload complete"),E(95),M("Finalizing verification request..."),i.Ay.success("Verification documents uploaded successfully"),a("Registration complete. Verification documents uploaded.")}catch(g){console.warn("Verification upload failed after registration",g),U("Upload failed"),i.Ay.error("Uploading verification documents failed. You can upload them later from your profile."),n("Registration succeeded but uploading verification documents failed. You can upload them later from your profile.")}finally{_(!1)}E(100),M("Done"),setTimeout(()=>{O(!1),E(0),M("")},800),l(),setTimeout(()=>e("/login"),1500)}else{if(d.errors&&"object"===typeof d.errors)return p(d.errors),n("Please correct the highlighted errors before submitting."),void r(!1);d.message?n(d.message):d.error?n(d.error):n("Registration failed")}}catch(y){const e=null===y||void 0===y?void 0:y.response;if(e&&e.data){const t=e.data;if(409===e.status||t.message&&/already/i.test(String(t.message))){const e={};if(t.keyValue?(t.keyValue.username&&(e.username="Username already in use"),t.keyValue.email&&(e.email="Email already registered")):(/email/i.test(String(t.message))&&(e.email=t.message),/username/i.test(String(t.message))&&(e.username=t.message)),Object.keys(e).length)return p(e),n("Please correct the highlighted errors before submitting."),void r(!1)}if(400===e.status)return n(t.message||"Invalid input"),void r(!1)}n("Network or server error. Please try again later.")}finally{r(!1)}}}),[K,J]=s.useState(null),[$,Q]=s.useState(null),[X,te]=s.useState(!1),[ne,ae]=s.useState(!1),[se,ie]=s.useState(!1),[re,le]=s.useState(null),oe=s.useRef(null),de=s.useRef(null),ce=s.useRef(null);s.useEffect(()=>{const e=String(G.values.username||"").trim();if(J(null),de.current&&clearTimeout(de.current),e&&!(e.length<3))return te(!0),de.current=setTimeout(async()=>{try{var t;const n=await A.axiosInstance.get("/auth/check-username",{params:{username:e}});J(Boolean(null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.available))}catch(n){J(null)}finally{te(!1)}},500),()=>{de.current&&clearTimeout(de.current)};te(!1)},[G.values.username]),s.useEffect(()=>{const e=String(G.values.email||"").trim();if(Q(null),ce.current&&clearTimeout(ce.current),e&&/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(e))return ae(!0),ce.current=setTimeout(async()=>{try{var t;const n=await A.axiosInstance.get("/auth/check-email",{params:{email:e}});Q(Boolean(null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.available))}catch(n){Q(null)}finally{ae(!1)}},500),()=>{ce.current&&clearTimeout(ce.current)};ae(!1)},[G.values.email]),s.useEffect(()=>{const e=String(G.values.contactNumber||"").trim();if(le(null),oe.current&&clearTimeout(oe.current),e&&!(e.length<11))return ie(!0),oe.current=setTimeout(async()=>{try{var t;const n=await A.axiosInstance.get("/auth/check-contact",{params:{contact:e}}),a=Boolean(null===n||void 0===n||null===(t=n.data)||void 0===t?void 0:t.available);le(a),a?G.setFieldError("contactNumber",""):(G.setFieldError("contactNumber","Contact number already registered"),G.setFieldTouched("contactNumber",!0,!1))}catch(n){le(null),G.setFieldError("contactNumber","")}finally{ie(!1)}},500),()=>{oe.current&&clearTimeout(oe.current)};ie(!1)},[G.values.contactNumber]);const ue=s.useCallback(e=>{let t=0;if(!e)return{percent:0,label:"Too short"};e.length>=6&&(t+=1),/[A-Z]/.test(e)&&(t+=1),/\d/.test(e)&&(t+=1),/[^A-Za-z0-9]/.test(e)&&(t+=1);return{percent:Math.min(100,Math.round(t/4*100)),label:t<=1?"Weak":2===t?"Fair":3===t?"Good":"Strong"}},[]),he=s.useMemo(()=>{const e=[G.values.firstName,G.values.lastName,G.values.username,G.values.email,G.values.password,G.values.confirmPassword,G.values.address,G.values.contactNumber],t=e.filter(e=>Boolean(e&&String(e).trim().length>0)).length,n=Number(!!x)+Number(!!f)+Number(!!B),a=e.length+3;return Math.round((t+n)/a*100)},[G.values,x,f,B]),me=he<34?0:he<67?1:2,pe=(e,t)=>(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,j.jsx)("span",{children:e}),(0,j.jsx)(y.A,{title:t,placement:"right",children:(0,j.jsx)(Lt.A,{style:{color:"#888"}})})]}),ye=e=>e.replace(/[^A-Za-z\s'-]/g,""),Ae=Boolean(x&&f&&B),je=Ae&&W;return(0,j.jsx)(It.A,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #40c9ff 0%, #e81cff 100%)",display:"flex",alignItems:"center",justifyContent:"center",py:6},children:(0,j.jsx)(St.A,{maxWidth:"sm",children:(0,j.jsxs)(Ct.A,{elevation:6,sx:{borderRadius:5,p:4,background:"rgba(255,255,255,0.95)",boxShadow:"0 8px 32px 0 rgba(64,201,255,0.15)"},children:[(0,j.jsx)(It.A,{sx:{textAlign:"center",mb:3},children:(0,j.jsxs)(It.A,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:2,flexDirection:"column"},children:[(0,j.jsx)(h.A.Title,{level:3,style:{margin:0,fontWeight:800,background:"linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",display:"inline-block"},children:"Barangay Parian Resident Registration"}),(0,j.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,j.jsx)(kt.A,{variant:"body2",color:"textSecondary",children:"This service is for residents of Barangay Parian only."}),(0,j.jsx)(y.A,{title:"This service is only available to residents of Barangay Parian.",children:(0,j.jsx)(Lt.A,{style:{color:"#888"}})})]})]})}),(0,j.jsxs)(It.A,{sx:{maxWidth:560,mx:"auto",mb:3},children:[(0,j.jsxs)(Bt.A,{current:me,size:"small",children:[(0,j.jsx)(Bt.A.Step,{title:"Account"}),(0,j.jsx)(Bt.A.Step,{title:"Personal"}),(0,j.jsx)(Bt.A.Step,{title:"Verification"})]}),(0,j.jsx)("div",{style:{marginTop:8},children:(0,j.jsx)(qt.A,{percent:he,showInfo:!0,strokeColor:{"0%":"#e81cff","100%":"#40c9ff"}})})]}),(0,j.jsxs)("form",{onSubmit:G.handleSubmit,children:[L&&(0,j.jsx)("div",{style:{position:"absolute",left:0,top:0,right:0,bottom:0,zIndex:40,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(0,0,0,0.35)"},children:(0,j.jsxs)("div",{style:{width:460,padding:20,borderRadius:8,background:"#fff",boxShadow:"0 6px 24px rgba(0,0,0,0.2)"},children:[(0,j.jsx)(kt.A,{variant:"h6",sx:{mb:1,fontWeight:700},children:"Processing"}),(0,j.jsx)(kt.A,{variant:"body2",sx:{mb:2},children:z}),(0,j.jsx)(qt.A,{percent:F,status:F<100?"active":"success"})]})}),(0,j.jsx)(Nt.A,{fullWidth:!0,margin:"normal",label:pe("First Name","Enter your given/first name. Use letters, spaces, hyphens and apostrophes only."),name:"firstName",value:G.values.firstName,onChange:e=>{G.setFieldValue("firstName",ye(e.target.value))},error:G.touched.firstName&&Boolean(G.errors.firstName),helperText:G.touched.firstName&&G.errors.firstName,sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(Nt.A,{fullWidth:!0,margin:"normal",label:pe("Middle Name (optional)","Middle name is optional. Use letters, spaces, hyphens and apostrophes only."),name:"middleName",value:G.values.middleName,onChange:e=>{G.setFieldValue("middleName",ye(e.target.value))},error:G.touched.middleName&&Boolean(G.errors.middleName),helperText:G.touched.middleName&&G.errors.middleName,sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(Nt.A,{fullWidth:!0,margin:"normal",label:pe("Last Name","Enter your family/last name."),name:"lastName",value:G.values.lastName,onChange:e=>{G.setFieldValue("lastName",ye(e.target.value))},error:G.touched.lastName&&Boolean(G.errors.lastName),helperText:G.touched.lastName&&G.errors.lastName,sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(Nt.A,{fullWidth:!0,margin:"normal",label:pe("Username","Choose a unique username (4-20 letters or numbers)."),name:"username",value:G.values.username,onChange:G.handleChange,error:G.touched.username&&Boolean(G.errors.username)||Boolean(m.username)||!1===K,helperText:G.touched.username&&G.errors.username||m.username||(X?"Checking availability...":!1===K?"Username already taken":!0===K?"Username available":"Username must be at least 4 characters long and contain only letters and numbers."),InputProps:{startAdornment:(0,j.jsx)(Tt.A,{position:"start",children:(0,j.jsx)(Ot.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(Nt.A,{fullWidth:!0,margin:"normal",label:pe("Email","Enter a valid email address used for account recovery and notifications."),name:"email",value:G.values.email,onChange:G.handleChange,error:G.touched.email&&Boolean(G.errors.email)||Boolean(m.email)||!1===$,helperText:G.touched.email&&G.errors.email||m.email||(ne?"Checking email...":!1===$?"Email already registered":!0===$?"Email looks available":""),InputProps:{startAdornment:(0,j.jsx)(Tt.A,{position:"start",children:(0,j.jsx)(Ft.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(Nt.A,{fullWidth:!0,margin:"normal",label:pe("Password","At least 6 characters, include uppercase, number and special character."),name:"password",type:l?"text":"password",value:G.values.password,onChange:G.handleChange,error:G.touched.password&&Boolean(G.errors.password),helperText:G.touched.password&&G.errors.password||m.password||"Password must be at least 6 characters long and contain at least one number, one uppercase letter, and one special character.",InputProps:{startAdornment:(0,j.jsx)(Tt.A,{position:"start",children:(0,j.jsx)(Et.A,{color:"primary"})}),endAdornment:(0,j.jsx)(Tt.A,{position:"end",children:(0,j.jsx)(Dt.A,{onClick:()=>o(e=>!e),tabIndex:-1,sx:{minWidth:0,p:0,color:"inherit"},children:l?(0,j.jsx)(zt.A,{}):(0,j.jsx)(Mt.A,{})})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)("div",{style:{marginTop:-8,marginBottom:12},children:(()=>{const{percent:e,label:t}=ue(String(G.values.password||""));return(0,j.jsxs)("div",{children:[(0,j.jsx)(qt.A,{percent:e,showInfo:!1,strokeColor:e<34?"#ff4d4f":e<67?"#faad14":"#52c41a"}),(0,j.jsx)(kt.A,{variant:"caption",sx:{display:"block",mt:.5},children:t})]})})()}),(0,j.jsx)(Nt.A,{fullWidth:!0,margin:"normal",label:pe("Confirm Password","Re-enter your password to confirm."),name:"confirmPassword",type:d?"text":"password",value:G.values.confirmPassword,onChange:G.handleChange,error:G.touched.confirmPassword&&Boolean(G.errors.confirmPassword),helperText:G.touched.confirmPassword&&G.errors.confirmPassword,InputProps:{startAdornment:(0,j.jsx)(Tt.A,{position:"start",children:(0,j.jsx)(Et.A,{color:"primary"})}),endAdornment:(0,j.jsx)(Tt.A,{position:"end",children:(0,j.jsx)(Dt.A,{onClick:()=>c(e=>!e),tabIndex:-1,sx:{minWidth:0,p:0,color:"inherit"},children:d?(0,j.jsx)(zt.A,{}):(0,j.jsx)(Mt.A,{})})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(Nt.A,{fullWidth:!0,margin:"normal",label:pe("Permanent Address","Street, barangay, city \u2014 used for official correspondence and verification."),name:"address",value:G.values.address,onChange:G.handleChange,error:G.touched.address&&Boolean(G.errors.address),helperText:G.touched.address&&G.errors.address,InputProps:{startAdornment:(0,j.jsx)(Tt.A,{position:"start",children:(0,j.jsx)(Wt.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(Nt.A,{fullWidth:!0,margin:"normal",label:pe("Contact Number","Enter digits only. Include area code if applicable."),name:"contactNumber",value:G.values.contactNumber,onChange:e=>{G.setFieldValue("contactNumber",e.target.value.replace(/\D/g,"").slice(0,11))},onPaste:e=>{const t=(e.clipboardData||window.clipboardData).getData("text")||"",n=String(t).replace(/\D/g,"").slice(0,11);e.preventDefault(),G.setFieldValue("contactNumber",n)},inputProps:{inputMode:"numeric",maxLength:11},error:G.touched.contactNumber&&Boolean(G.errors.contactNumber)||Boolean(m.contactNumber)||G.touched.contactNumber&&!1===re,helperText:G.touched.contactNumber&&G.errors.contactNumber||m.contactNumber||(se?"Checking contact...":!1===re?"Contact number already registered":!0===re?"Contact number looks available":""),InputProps:{startAdornment:(0,j.jsx)(Tt.A,{position:"start",children:(0,j.jsx)(Yt.A,{color:"primary"})}),inputProps:{inputMode:"numeric",maxLength:11}},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsxs)(It.A,{sx:{mb:2},children:[(0,j.jsx)(h.A.Title,{level:4,style:{marginBottom:8,fontWeight:700,background:"linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",display:"inline-block"},children:"Barangay Parian Residency Verification"}),(0,j.jsx)(kt.A,{variant:"body2",color:"textSecondary",sx:{mb:1},children:"Please upload the following documents to verify your residency."})]}),(0,j.jsxs)(It.A,{sx:{mb:2},children:[(0,j.jsx)(kt.A,{component:"label",sx:{display:"block",fontWeight:600,mb:1},children:pe("Proof of Residency","Upload a document showing your address (e.g., utility bill, lease, or bank statement).")}),(0,j.jsx)(Z.A,{accept:"image/*,application/pdf",fileList:b,beforeUpload:e=>!1,onChange:e=>{let{fileList:t}=e;b.forEach(e=>{if(e&&e.thumbUrl){try{URL.revokeObjectURL(String(e.thumbUrl))}catch(t){}N.current.delete(String(e.thumbUrl))}});const n=(t||[]).slice(-1);n.forEach(e=>{if(e.originFileObj&&!e.thumbUrl&&e.type&&e.type.startsWith("image/")){const t=URL.createObjectURL(e.originFileObj);e.thumbUrl=t,N.current.add(t)}}),w(n),g(n[0]&&n[0].originFileObj||null)},listType:"picture-card",showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0},maxCount:1,children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,j.jsx)(ee.A,{})," ",(0,j.jsx)("span",{style:{fontWeight:600},children:"Select Proof"})]})})]}),(0,j.jsxs)(It.A,{sx:{mb:2},children:[(0,j.jsx)(kt.A,{component:"label",sx:{display:"block",fontWeight:600,mb:1},children:pe("Government-issued ID","Upload a government-issued ID such as passport, driver's license, or national ID.")}),(0,j.jsx)(Z.A,{accept:"image/*,application/pdf",fileList:I,beforeUpload:e=>!1,onChange:e=>{let{fileList:t}=e;I.forEach(e=>{if(e&&e.thumbUrl){try{URL.revokeObjectURL(String(e.thumbUrl))}catch(t){}N.current.delete(String(e.thumbUrl))}});const n=(t||[]).slice(-1);n.forEach(e=>{if(e.originFileObj&&!e.thumbUrl&&e.type&&e.type.startsWith("image/")){const t=URL.createObjectURL(e.originFileObj);e.thumbUrl=t,N.current.add(t)}}),S(n),v(n[0]&&n[0].originFileObj||null)},listType:"picture-card",showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0},maxCount:1,children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,j.jsx)(ee.A,{})," ",(0,j.jsx)("span",{style:{fontWeight:600},children:"Select ID"})]})})]}),(0,j.jsxs)(It.A,{sx:{mb:2},children:[(0,j.jsx)(kt.A,{component:"label",sx:{display:"block",fontWeight:600,mb:1},children:pe("Selfie with Government-issued ID","Take a clear photo of yourself holding your government ID next to your face.")}),(0,j.jsx)(Z.A,{accept:"image/*",fileList:C,beforeUpload:e=>!1,onChange:e=>{let{fileList:t}=e;C.forEach(e=>{if(e&&e.thumbUrl){try{URL.revokeObjectURL(String(e.thumbUrl))}catch(t){}N.current.delete(String(e.thumbUrl))}});const n=(t||[]).slice(-1);n.forEach(e=>{if(e.originFileObj&&!e.thumbUrl&&e.type&&e.type.startsWith("image/")){const t=URL.createObjectURL(e.originFileObj);e.thumbUrl=t,N.current.add(t)}}),k(n),q(n[0]&&n[0].originFileObj||null)},listType:"picture-card",showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0},maxCount:1,children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,j.jsx)(ee.A,{})," ",(0,j.jsx)("span",{style:{fontWeight:600},children:"Select Selfie with ID"})]})})]}),(0,j.jsx)(It.A,{sx:{mt:2,mb:1},children:(0,j.jsx)(Pt.A,{control:(0,j.jsx)(_t.A,{checked:W,onChange:e=>{e.target.checked?H(!0):Y(!1)},name:"terms",color:"primary",inputProps:{"aria-label":"Accept terms and policy"}}),label:(0,j.jsxs)("span",{children:["I agree to the ",(0,j.jsx)("a",{href:"#",onClick:e=>{e.preventDefault(),H(!0)},children:"Terms & Policy"})]})})}),(0,j.jsx)(fe.A,{title:(0,j.jsx)("span",{style:{fontWeight:700},children:"Parian Residency Verification \u2014 Terms & Policy"}),centered:!0,visible:V,onCancel:()=>H(!1),footer:(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"flex-start",gap:8,width:"100%"},children:[(0,j.jsx)(u.Ay,{onClick:()=>{H(!1)},children:"Cancel"},"cancel"),(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>{Y(!0),H(!1),i.Ay.success("Terms accepted")},children:"Accept"},"accept")]}),width:Math.min(920,window.innerWidth-48),bodyStyle:{maxHeight:"60vh",overflowY:"auto"},children:(0,j.jsxs)(ge.A,{defaultActiveKey:"1",type:"card",children:[(0,j.jsx)(ge.A.TabPane,{tab:"\ud83d\udcd8 TERMS OF SERVICE (TOS)",children:(0,j.jsxs)(h.A,{children:[(0,j.jsx)(h.A.Title,{level:4,children:"Barangay Information Management System (BIMS)"}),(0,j.jsx)(h.A.Title,{level:5,children:"1. Acceptance of Terms"}),(0,j.jsx)(h.A.Paragraph,{children:"By accessing or using the BIMS Web Application (the \u201cSystem\u201d), you agree to comply with and be bound by these Terms of Service. If you do not agree, you must discontinue use of the System immediately."}),(0,j.jsx)(h.A.Title,{level:5,children:"2. Purpose of the System"}),(0,j.jsx)(h.A.Paragraph,{children:"The System is an official digital platform used for managing: resident information, announcements and public notices, inquiries and requests, processing of templates and official documents, and administrative records of the Barangay. The System is intended for legitimate and authorized use only."}),(0,j.jsx)(h.A.Title,{level:5,children:"3. User Eligibility"}),(0,j.jsx)(h.A.Paragraph,{children:"Users must be authorized barangay staff with valid credentials, or registered residents using the system for official transactions. Any unauthorized access is strictly prohibited."}),(0,j.jsx)(h.A.Title,{level:5,children:"4. User Responsibilities"}),(0,j.jsx)(h.A.Paragraph,{children:"Users agree to provide accurate and truthful information, keep login credentials secure, use the System only for lawful and official purposes, and immediately report suspicious or unauthorized activity. Users must not attempt to bypass security controls, upload malicious files, access information beyond their role, or misuse system data."}),(0,j.jsx)(h.A.Title,{level:5,children:"5. Data Accuracy and Submission"}),(0,j.jsx)(h.A.Paragraph,{children:"Users are responsible for ensuring that any data they submit \u2014 including inquiries, requests, and personal information \u2014 is accurate and complete."}),(0,j.jsx)(h.A.Title,{level:5,children:"6. System Availability"}),(0,j.jsx)(h.A.Paragraph,{children:"The Barangay reserves the right to modify, suspend, or terminate system access at any time for updates, security, or administrative purposes."}),(0,j.jsx)(h.A.Title,{level:5,children:"7. Intellectual Property"}),(0,j.jsx)(h.A.Paragraph,{children:"All content, system design, database structures, and digital materials are owned by the Barangay. Copying or redistributing without authorization is prohibited."}),(0,j.jsx)(h.A.Title,{level:5,children:"8. Limitation of Liability"}),(0,j.jsx)(h.A.Paragraph,{children:"The Barangay shall not be liable for downtime or service interruptions, loss of data due to technical issues beyond reasonable control, or unauthorized access resulting from user negligence."}),(0,j.jsx)(h.A.Title,{level:5,children:"9. Termination of Access"}),(0,j.jsx)(h.A.Paragraph,{children:"The Barangay may suspend or terminate user accounts for violations of this TOS, misuse of system data, security threats, or administrative decisions."}),(0,j.jsx)(h.A.Title,{level:5,children:"10. Changes to Terms"}),(0,j.jsx)(h.A.Paragraph,{children:"Updates to these Terms may be made at any time. Continued use of the System signifies acceptance of the updated Terms."})]})},"1"),(0,j.jsx)(ge.A.TabPane,{tab:"\ud83d\udcd8 PRIVACY POLICY",children:(0,j.jsxs)(h.A,{children:[(0,j.jsx)(h.A.Title,{level:4,children:"Barangay Information Management System (BIMS)"}),(0,j.jsx)(h.A.Paragraph,{children:(0,j.jsx)("em",{children:"Compliant with RA 10173 \u2013 Data Privacy Act of 2012"})}),(0,j.jsx)(h.A.Title,{level:5,children:"1. Purpose"}),(0,j.jsx)(h.A.Paragraph,{children:"This Privacy Policy explains how the System collects, uses, stores, and protects personal information of residents and staff."}),(0,j.jsx)(h.A.Title,{level:5,children:"2. Information We Collect"}),(0,j.jsx)(h.A.Paragraph,{children:"We may collect personal data depending on your role and transaction. For residents: full name, address, contact information, age, gender, civil status, government-issued ID details, document request information, submitted forms and inquiries. For staff/admins: login credentials, user activity logs, role- and task-related information. Automatically collected data includes IP address, browser/device details, date and time of access, and system usage logs."}),(0,j.jsx)(h.A.Title,{level:5,children:"3. Legal Basis for Processing"}),(0,j.jsx)(h.A.Paragraph,{children:"Data is collected and processed under RA 10173 \u2013 Data Privacy Act of 2012, legitimate interests of the Barangay, performance of official public functions, and consent of the data subject (when required)."}),(0,j.jsx)(h.A.Title,{level:5,children:"4. How We Use Your Information"}),(0,j.jsx)(h.A.Paragraph,{children:"Personal data is used for processing resident documents and requests, keeping official barangay records, sending announcements and updates, responding to inquiries, authenticating users, and maintaining system security and audit logs."}),(0,j.jsx)(h.A.Title,{level:5,children:"5. Data Sharing and Disclosure"}),(0,j.jsx)(h.A.Paragraph,{children:"Data may only be shared with authorized barangay personnel, national or local agencies when legally required, law enforcement under lawful orders, and third-party service providers (e.g., cloud hosting) with Data Sharing Agreements. We never sell or share data for marketing or commercial purposes."}),(0,j.jsx)(h.A.Title,{level:5,children:"6. Data Storage and Retention"}),(0,j.jsx)(h.A.Paragraph,{children:"Data is stored securely in encrypted databases and retained only for the duration required for completing transactions, performing barangay functions, and legal/audit purposes. After the retention period, data is securely deleted."}),(0,j.jsx)(h.A.Title,{level:5,children:"7. Security Measures"}),(0,j.jsx)(h.A.Paragraph,{children:"The System uses industry-standard security protocols, including encrypted connections (HTTPS), role-based access control, activity logging, firewalls and intrusion detection, and regular security audits."}),(0,j.jsx)(h.A.Title,{level:5,children:"8. Your Rights as a Data Subject (RA 10173)"}),(0,j.jsx)(h.A.Paragraph,{children:"You have the right to be informed, access your data, request correction or updating, object to processing, withdraw consent, file a complaint with the National Privacy Commission, and obtain a copy of your personal data."}),(0,j.jsx)(h.A.Title,{level:5,children:"9. Contact Information (DPO)"}),(0,j.jsx)(h.A.Paragraph,{children:"For privacy concerns, contact: Barangay Data Protection Officer (DPO) \u2014 [Insert Name], [Insert Email], [Insert Office Address]."})]})},"2"),(0,j.jsx)(ge.A.TabPane,{tab:"\ud83d\udcd8 DATA PRIVACY STATEMENT",children:(0,j.jsxs)(h.A,{children:[(0,j.jsx)(h.A.Title,{level:4,children:"BIMS \u2013 Compliance with the Data Privacy Act of 2012"}),(0,j.jsx)(h.A.Paragraph,{children:"The Barangay is committed to protecting your personal information in compliance with Republic Act 10173 (Data Privacy Act of 2012) and its Implementing Rules and Regulations. All data collected through the BIMS Web Application is processed lawfully, fairly, and transparently, and used strictly for official barangay transactions."}),(0,j.jsx)(h.A.Paragraph,{children:"By using the system, you voluntarily consent to the collection and processing of your information as described in this Privacy Policy."})]})},"3")]})}),P&&(0,j.jsxs)(It.A,{sx:{mb:2},children:[(0,j.jsx)(kt.A,{sx:{fontSize:14,mb:1},children:"Uploading verification documents"}),(0,j.jsx)(qt.A,{percent:T}),(0,j.jsx)(kt.A,{variant:"caption",sx:{display:"block",mt:1},children:R})]}),(0,j.jsx)("input",{type:"hidden",name:"barangayID",value:G.values.barangayID}),(0,j.jsx)("input",{type:"hidden",name:"role",value:"resident"}),!Ae&&(0,j.jsxs)(Rt.A,{severity:"warning",sx:{mt:2},children:["Please upload ",(0,j.jsx)("strong",{children:"Proof of Residency"}),", a ",(0,j.jsx)("strong",{children:"Government-issued ID"}),", and a ",(0,j.jsx)("strong",{children:"Selfie with your ID"})," before registering."]}),(0,j.jsx)(Dt.A,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,borderRadius:3,fontWeight:700,fontSize:"1.1rem",background:"linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",color:"#fff",boxShadow:"0 2px 8px #e81cff44",transition:"background 0.3s","&:hover":{background:"linear-gradient(90deg, #40c9ff 0%, #e81cff 100%)"}},disabled:G.isSubmitting||!je,children:"Register"}),t&&(0,j.jsx)(Rt.A,{severity:"error",sx:{mt:2},children:t}),Object.keys(m).length>0&&!t&&(0,j.jsx)(Rt.A,{severity:"error",sx:{mt:2},children:Object.entries(m).map(e=>{let[t,n]=e;return(0,j.jsx)("div",{children:n},t)})}),r&&(0,j.jsx)(Rt.A,{severity:"info",sx:{mt:2},children:"Admin access is now unlocked! Redirecting to admin dashboard..."}),(0,j.jsx)(It.A,{sx:{textAlign:"center",mt:2},children:(0,j.jsxs)(Ut.A,{component:xe.N_,to:"/login",variant:"body2",sx:{color:"#e81cff",fontWeight:600},children:["Already have an account? ",(0,j.jsx)("span",{style:{textDecoration:"underline"},children:"Sign In"})]})})]})]})})})};var Kt=n(32077),Jt=n(15429),Zt=n(10495),$t=n(93549),Qt=n(30630);const Xt={heroRow:"dashboard_heroRow__quuQi",avatarContainer:"dashboard_avatarContainer__JX79N",avatarImg:"dashboard_avatarImg__DN0Od",editButton:"dashboard_editButton__4xJDP",userInfo:"dashboard_userInfo__hqud0",userName:"dashboard_userName__3cWlZ",userMeta:"dashboard_userMeta__g3BmN","ant-col":"dashboard_ant-col__-mqgu",hideOnMobile:"dashboard_hideOnMobile__TUNot",showOnMobile:"dashboard_showOnMobile__5QHQr",verificationUnderAvatar:"dashboard_verificationUnderAvatar__DP9Dy","ant-tag":"dashboard_ant-tag__pHnMu"},en=()=>{var e,t,a,i;const{user:d}=_e(),c=(0,xe.Zp)(),[m,p]=(0,s.useState)(null),[,x]=(0,s.useState)(()=>(new Date).toLocaleString()),[g,f]=(0,s.useState)([]),[,b]=(0,s.useState)(!0),[w,I]=(0,s.useState)(0),[,S]=(0,s.useState)(!1),[C,k]=(0,s.useState)(0),[N,T]=(0,s.useState)(!1),[D,P]=(0,s.useState)([]),[_,R]=(0,s.useState)(!1),[U,B]=(0,s.useState)(!1),[q,L]=(0,s.useState)([]),[O,F]=(0,s.useState)(!1),[E,z]=(0,s.useState)(!1),[M,W]=(0,s.useState)(()=>{try{return"true"===localStorage.getItem("residentTips.hide")}catch(e){return!1}}),[Y,V]=(0,s.useState)(!1),H=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch(t){return String(e)}};(0,s.useEffect)(()=>{(async()=>{try{let e;e="admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?await A.documentsAPI.getAllDocuments():await A.documentsAPI.getMyDocuments(),f(e)}catch(e){console.error("Error fetching documents:",e)}finally{b(!1)}})(),(async()=>{try{try{const e=await(await Promise.resolve().then(n.bind(n,51496))).residentPersonalInfoAPI.getPersonalInfo();if(null!==e&&void 0!==e&&e.profileImage){const t=e.profileImage.startsWith("http")?e.profileImage:(0,A.getAbsoluteApiUrl)(e.profileImage);return void p(t)}if(null!==e&&void 0!==e&&e.profileImageId)return void p((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.profileImageId)))}catch(e){}try{const e=await Promise.resolve().then(n.bind(n,51496)),t=(await e.default.get("/resident/profile")).data;if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:(0,A.getAbsoluteApiUrl)(t.profileImage);p(e)}else null!==t&&void 0!==t&&t.profileImageId&&p((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(t.profileImageId)))}catch(e){}}catch(e){}})();const e=setInterval(()=>x((new Date).toLocaleString()),1e3);return()=>clearInterval(e)},[d]);const[G,K]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let e=!0;return(async()=>{try{if("resident"===(null===d||void 0===d?void 0:d.role)){const t=await A.verificationAPI.getMyRequests();if(!e)return;if(Array.isArray(t)&&t.length>0){const e=t.some(e=>"pending"===(e.status||"").toString().toLowerCase());K(e)}else K(!1)}}catch(t){}})(),()=>{e=!1}},[d]),(0,s.useEffect)(()=>{(async()=>{try{let e;e="admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?await A.contactAPI.getAllInquiries():await A.contactAPI.getMyInquiries(),Array.isArray(e)?k(e.length):e&&"number"===typeof e.count?k(e.count):k(e&&e.length||0)}catch(e){console.error("Failed to load inquiries:",e),k(0)}})();(async()=>{S(!0);try{const e=await A.contactAPI.getAnnouncements();Array.isArray(e)?I(e.length):e&&"number"===typeof e.count?I(e.count):I(e&&e.length||0)}catch(e){console.error("Failed to fetch announcements:",e),I(0)}finally{S(!1)}})()},[d]);const J=g.filter(e=>"pending"===(e.status||"").toString().toLowerCase()).length,Z=g.filter(e=>"approved"===(e.status||"").toString().toLowerCase()).length;return(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("div",{style:{maxWidth:1200,margin:"40px auto",padding:"0 16px",position:"relative"},children:[(0,j.jsx)("div",{style:{marginBottom:18},children:(0,j.jsx)(l.A,{align:"middle",children:(0,j.jsx)(o.A,{children:(0,j.jsx)(h.A.Text,{style:{fontSize:16,color:"#888"},children:(0,j.jsxs)("span",{style:{marginRight:8},children:[(0,j.jsx)("span",{style:{color:"#1890ff",fontWeight:600},children:"Dashboard"})," ",">"," Home"]})})})})}),"resident"===(null===d||void 0===d?void 0:d.role)&&(0,j.jsxs)(r.A,{className:Xt.residentCard,style:{width:"100%",margin:"0 auto 32px",borderRadius:32,boxShadow:"0 8px 32px #bfc7d6cc",background:"linear-gradient(120deg, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",border:"none",padding:0,position:"relative",overflow:"hidden",minHeight:170},styles:{body:{padding:0}},children:[(0,j.jsx)("div",{style:{position:"absolute",top:0,left:0,height:"100%",background:"radial-gradient(circle at 80% 20%, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",opacity:.18,zIndex:0}}),(0,j.jsx)(l.A,{align:"middle",className:Xt.heroRow,style:{minHeight:170,padding:"32px 32px",position:"relative",zIndex:1},justify:"space-between",children:(0,j.jsx)(o.A,{xs:24,md:14,style:{display:"flex",alignItems:"center",gap:24},children:(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",gap:18,width:"100%",justifyContent:"space-between"},children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:18},children:[(0,j.jsxs)("div",{className:Xt.avatarContainer,children:[m?(0,j.jsx)("img",{className:Xt.avatarImg,src:m,alt:(null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||"avatar"}):(0,j.jsx)(v,{user:(()=>{let e=d;if(!e)try{const t=localStorage.getItem("userProfile");t&&(e=JSON.parse(t))}catch(t){}return e})(),size:96}),(0,j.jsx)("button",{onClick:()=>c("/profile"),title:"Edit profile",className:Xt.editButton,children:(0,j.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,j.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z",fill:"#595959"}),(0,j.jsx)("path",{d:"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#595959"})]})})]}),(0,j.jsxs)("div",{className:Xt.userInfo,children:[(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,j.jsx)(h.A.Title,{level:3,className:Xt.userName,style:{marginBottom:0,fontWeight:800},children:null!==(e=null!==(t=null!==(a=null===d||void 0===d?void 0:d.fullName)&&void 0!==a?a:null===d||void 0===d?void 0:d.username)&&void 0!==t?t:null===d||void 0===d?void 0:d.email)&&void 0!==e?e:""}),(0,j.jsxs)(h.A.Text,{type:"secondary",className:Xt.userMeta,children:["Barangay ID: ",null!==(i=null===d||void 0===d?void 0:d.barangayID)&&void 0!==i?i:(()=>{try{const e=localStorage.getItem("userProfile");if(e){const t=JSON.parse(e);return(null===t||void 0===t?void 0:t.barangayID)||"N/A"}}catch(e){}return"N/A"})()]})]}),(0,j.jsx)("div",{style:{marginTop:8},children:(0,j.jsx)(h.A.Text,{type:"secondary",className:Xt.userMeta,children:(new Date).toLocaleString()})})]})]})})})})]}),(0,j.jsxs)(l.A,{gutter:[32,32],justify:"center",style:{marginBottom:40},children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(r.A,{hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #faad1444",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},onClick:async()=>{T(!0),R(!0);try{let e;"admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?(e=await A.documentsAPI.getAllDocuments(),e=(e||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase())):(e=await A.documentsAPI.getMyDocuments(),e=(e||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase())),P(e||[])}catch(e){P([])}finally{R(!1)}},styles:{body:{padding:24}},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,j.jsx)("div",{style:{background:"#faad14",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,j.jsx)($t.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,j.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:J}),(0,j.jsx)(h.A.Text,{style:{fontSize:18,color:"#faad14",fontWeight:700},children:"Pending Requests"})]})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(r.A,{hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #52c41a44",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},styles:{body:{padding:24}},onClick:async()=>{B(!0),F(!0);try{let e;"admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?(e=await A.documentsAPI.getAllDocuments(),e=(e||[]).filter(e=>"approved"===(e.status||"").toString().toLowerCase())):(e=await A.documentsAPI.getMyDocuments(),e=(e||[]).filter(e=>"approved"===(e.status||"").toString().toLowerCase())),L(e||[])}catch(e){L([])}finally{F(!1)}},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,j.jsx)("div",{style:{background:"#52c41a",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,j.jsx)(Me.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,j.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:Z}),(0,j.jsx)(h.A.Text,{style:{fontSize:18,color:"#52c41a",fontWeight:700},children:"Approved Documents"})]})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(r.A,{hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #1890ff44",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},onClick:()=>c("/inbox"),styles:{body:{padding:24}},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,j.jsx)("div",{style:{background:"#1890ff",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,j.jsx)($t.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,j.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:C}),(0,j.jsx)(h.A.Text,{style:{fontSize:18,color:"#1890ff",fontWeight:700},children:"Active Inquiries"})]})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(r.A,{onClick:()=>c("/announcements"),hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #eb2f9644",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},styles:{body:{padding:24}},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,j.jsx)("div",{style:{background:"#eb2f96",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,j.jsx)(Kt.A,{count:w,offset:[8,0],children:(0,j.jsx)(Qe.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})})}),(0,j.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:w}),(0,j.jsx)(h.A.Text,{style:{fontSize:18,color:"#eb2f96",fontWeight:700},children:"Announcements"})]})})})]}),(0,j.jsx)(fe.A,{title:"Pending Requests",open:N,onCancel:()=>T(!1),footer:null,width:800,children:(0,j.jsx)(Jt.A,{dataSource:D,loading:_,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,j.jsx)(fe.A,{title:"Approved Documents",open:U,onCancel:()=>B(!1),footer:null,width:1e3,children:(0,j.jsx)(Jt.A,{dataSource:q,loading:O,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Date Requested",dataIndex:"dateRequested",key:"dateRequested",render:(e,t)=>H(t.dateRequested||t.requestedAt||t.createdAt)},{title:"Date Approved",dataIndex:"dateApproved",key:"dateApproved",render:(e,t)=>H(t.dateApproved||t.approvedAt||t.approvedOn||t.updatedAt)},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,j.jsx)(fe.A,{title:"Resident Tool Tips",open:E,onCancel:()=>z(!1),footer:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,j.jsx)(Zt.A,{checked:M,onChange:e=>{const t=e.target.checked;W(t);try{localStorage.setItem("residentTips.hide",t?"true":"false")}catch(n){}},children:"Don't show again"}),(0,j.jsxs)("div",{children:[(0,j.jsx)(u.Ay,{onClick:()=>z(!1),style:{marginRight:8},children:"Cancel"}),(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>{z(!1)},children:"Got it"})]})]}),width:720,children:(0,j.jsxs)("ul",{style:{paddingLeft:20},children:[(0,j.jsx)("li",{children:"Use the Request Document button to apply for barangay certificates and permits."}),(0,j.jsx)("li",{children:"Check your profile information regularly to ensure accuracy."}),(0,j.jsx)("li",{children:"Contact barangay staff for assistance with business registration or solo parent certification."}),(0,j.jsx)("li",{children:"For lost documents, use the Inquiry form to request help."}),(0,j.jsx)("li",{children:"All document requests are processed during office hours only."})]})}),(0,j.jsx)("div",{style:{position:"fixed",right:20,bottom:24,zIndex:1050},children:(0,j.jsx)(y.A,{title:M?"Tips hidden (will remain hidden if checked)":"Resident Tool Tips",children:(0,j.jsx)(u.Ay,{type:"primary",shape:"circle",size:"large",onClick:()=>z(!0),onMouseEnter:()=>V(!0),onMouseLeave:()=>V(!1),icon:(0,j.jsx)(Qt.A,{style:{color:"#fff",fontSize:20}}),style:{width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:Y?"0 10px 30px rgba(24,144,255,0.22)":"0 6px 18px rgba(0,0,0,0.12)",transform:Y?"translateY(-4px) scale(1.03)":"none",transition:"transform 160ms cubic-bezier(.2,.8,.2,1), box-shadow 160ms"}})})})]})})},tn=()=>{var e,t,a,i;const{user:d}=_e(),c=(0,xe.Zp)(),[m,p]=(0,s.useState)(null),[,x]=(0,s.useState)(()=>(new Date).toLocaleString()),[,g]=(0,s.useState)([]),[,f]=(0,s.useState)(!0),[v,b]=(0,s.useState)(0),[,w]=(0,s.useState)(!1),[I,S]=(0,s.useState)(!1),[C,k]=(0,s.useState)(!1),[N,T]=(0,s.useState)(!1),[D,P]=(0,s.useState)(()=>{try{return"true"===localStorage.getItem("residentTips.hide")}catch(e){return!1}}),[_,R]=(0,s.useState)(!1),U=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch(t){return String(e)}};return(0,s.useEffect)(()=>{(async()=>{try{let e;e="admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?await A.documentsAPI.getAllDocuments():await A.documentsAPI.getMyDocuments(),g(e)}catch(e){console.error("Error fetching documents:",e)}finally{f(!1)}})(),(async()=>{try{try{const e=await(await Promise.resolve().then(n.bind(n,51496))).residentPersonalInfoAPI.getPersonalInfo();if(null!==e&&void 0!==e&&e.profileImage){const t=e.profileImage.startsWith("http")?e.profileImage:(0,A.getAbsoluteApiUrl)(e.profileImage);return void p(t)}if(null!==e&&void 0!==e&&e.profileImageId)return void p((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.profileImageId)))}catch(e){}try{const e=await Promise.resolve().then(n.bind(n,51496)),t=(await e.default.get("/resident/profile")).data;if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:(0,A.getAbsoluteApiUrl)(t.profileImage);p(e)}else null!==t&&void 0!==t&&t.profileImageId&&p((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(t.profileImageId)))}catch(e){}}catch(e){}})();const e=setInterval(()=>x((new Date).toLocaleString()),1e3);return()=>clearInterval(e)},[d]),(0,s.useEffect)(()=>{(async()=>{w(!0);try{const e=await A.contactAPI.getAnnouncements();Array.isArray(e)?b(e.length):e&&"number"===typeof e.count?b(e.count):b(e&&e.length||0)}catch(e){console.error("Failed to fetch announcements:",e),b(0)}finally{w(!1)}})()},[d]),(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("div",{style:{maxWidth:1200,margin:"40px auto",padding:"0 16px",position:"relative"},children:[(0,j.jsx)("div",{style:{marginBottom:18},children:(0,j.jsx)(l.A,{align:"middle",children:(0,j.jsx)(o.A,{children:(0,j.jsx)(h.A.Text,{style:{fontSize:16,color:"#888"},children:(0,j.jsxs)("span",{style:{marginRight:8},children:[(0,j.jsx)("span",{style:{color:"#1890ff",fontWeight:600},children:"Dashboard"})," ",">"," Home"]})})})})}),"resident"===(null===d||void 0===d?void 0:d.role)&&(0,j.jsxs)(r.A,{style:{width:"100%",margin:"0 auto 32px",borderRadius:32,boxShadow:"0 8px 32px #bfc7d6cc",background:"linear-gradient(120deg, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",border:"none",padding:0,position:"relative",overflow:"hidden",minHeight:170},styles:{body:{padding:0}},children:[(0,j.jsx)("div",{style:{position:"absolute",top:0,left:0,height:"100%",background:"radial-gradient(circle at 80% 20%, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",opacity:.18,zIndex:0}}),(0,j.jsx)(l.A,{align:"middle",style:{minHeight:170,padding:"32px 32px",position:"relative",zIndex:1},justify:"space-between",children:(0,j.jsx)(o.A,{xs:24,md:14,style:{display:"flex",alignItems:"center",gap:24},children:(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",gap:18,width:"100%",justifyContent:"space-between"},children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:18},children:[(0,j.jsxs)("div",{style:{width:96,height:96,borderRadius:12,overflow:"hidden",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[m?(0,j.jsx)("img",{src:m,alt:(null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||"avatar",style:{width:96,height:96,objectFit:"cover",borderRadius:12}}):(0,j.jsx)("div",{style:{width:96,height:96,display:"flex",alignItems:"center",justifyContent:"center",background:"#1890ff",borderRadius:12},children:(0,j.jsx)(Xe.A,{style:{color:"#fff",fontSize:44}})}),(()=>{const e=[{key:"profile",icon:(0,j.jsx)(Xe.A,{}),label:"Profile"},..."admin"===(null===d||void 0===d?void 0:d.role)?[{key:"settings",icon:(0,j.jsx)(He.A,{}),label:"Settings"}]:[],{type:"divider",key:"divider-1"},{key:"tips",icon:(0,j.jsx)(Qt.A,{}),label:"Tips"},{key:"logout",icon:(0,j.jsx)(et.A,{}),label:"Logout"}];return(0,j.jsx)(Fe.A,{menu:{items:e,onClick:e=>{let{key:t}=e;"profile"===t?c("/profile"):"settings"===t?c("/admin/settings"):"logout"===t?c("/logout"):"tips"===t&&T(!0)}},placement:"bottomLeft",trigger:["click"],children:(0,j.jsx)(u.Ay,{type:"default",shape:"circle",size:"small",title:"Menu",icon:(0,j.jsx)(tt.A,{}),style:{position:"absolute",left:-12,top:-12,width:36,height:36,display:"flex",alignItems:"center",justifyContent:"center"}})})})()]}),(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Title,{level:3,style:{marginBottom:0,fontWeight:800},children:null!==(e=null!==(t=null!==(a=null===d||void 0===d?void 0:d.fullName)&&void 0!==a?a:null===d||void 0===d?void 0:d.username)&&void 0!==t?t:null===d||void 0===d?void 0:d.email)&&void 0!==e?e:""}),(0,j.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:18},children:["Barangay ID: ",null!==(i=null===d||void 0===d?void 0:d.barangayID)&&void 0!==i?i:(()=>{try{const e=localStorage.getItem("userProfile");if(e){const t=JSON.parse(e);return(null===t||void 0===t?void 0:t.barangayID)||"N/A"}}catch(e){}return"N/A"})()]}),(0,j.jsx)("div",{style:{marginTop:8},children:(0,j.jsx)(h.A.Text,{type:"secondary",children:(new Date).toLocaleString()})})]})]})})})})]}),(0,j.jsxs)(l.A,{gutter:[32,32],justify:"center",style:{marginBottom:40},children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(r.A,{onClick:()=>c("/request"),hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #1890ff44",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},styles:{body:{padding:24}},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,j.jsx)("div",{style:{background:"#1890ff",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,j.jsx)(ee.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,j.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:"Request"}),(0,j.jsx)(h.A.Text,{style:{fontSize:18,color:"#1890ff",fontWeight:700},children:"Request Document"})]})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(r.A,{onClick:()=>c("/announcements"),hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #eb2f9644",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},styles:{body:{padding:24}},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,j.jsx)("div",{style:{background:"#eb2f96",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,j.jsx)(Kt.A,{count:v,offset:[8,0],children:(0,j.jsx)(Qe.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})})}),(0,j.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:v}),(0,j.jsx)(h.A.Text,{style:{fontSize:18,color:"#eb2f96",fontWeight:700},children:"Announcements"})]})})})]}),(0,j.jsx)(fe.A,{title:"Pending Requests",open:I,onCancel:()=>S(!1),footer:null,width:800,children:(0,j.jsx)(Jt.A,{dataSource:[],loading:!1,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,j.jsx)(fe.A,{title:"Approved Documents",open:C,onCancel:()=>k(!1),footer:null,width:1e3,children:(0,j.jsx)(Jt.A,{dataSource:[],loading:!1,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Date Requested",dataIndex:"dateRequested",key:"dateRequested",render:(e,t)=>U(t.dateRequested||t.requestedAt||t.createdAt)},{title:"Date Approved",dataIndex:"dateApproved",key:"dateApproved",render:(e,t)=>U(t.dateApproved||t.approvedAt||t.approvedOn||t.updatedAt)},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,j.jsx)(fe.A,{title:"Resident Tool Tips",open:N,onCancel:()=>T(!1),footer:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,j.jsx)(Zt.A,{checked:D,onChange:e=>{const t=e.target.checked;P(t);try{localStorage.setItem("residentTips.hide",t?"true":"false")}catch(n){}},children:"Don't show again"}),(0,j.jsxs)("div",{children:[(0,j.jsx)(u.Ay,{onClick:()=>T(!1),style:{marginRight:8},children:"Cancel"}),(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>{T(!1)},children:"Got it"})]})]}),width:720,children:(0,j.jsxs)("ul",{style:{paddingLeft:20},children:[(0,j.jsx)("li",{children:"Use the Request Document button to apply for barangay certificates and permits."}),(0,j.jsx)("li",{children:"Check your profile information regularly to ensure accuracy."}),(0,j.jsx)("li",{children:"Contact barangay staff for assistance with business registration or solo parent certification."}),(0,j.jsx)("li",{children:"For lost documents, contact barangay staff or visit the office for assistance."}),(0,j.jsx)("li",{children:"All document requests are processed during office hours only."})]})}),(0,j.jsx)("div",{style:{position:"fixed",right:20,bottom:24,zIndex:1050},children:(0,j.jsx)(y.A,{title:D?"Tips hidden (will remain hidden if checked)":"Resident Tool Tips",children:(0,j.jsx)(u.Ay,{type:"primary",shape:"circle",size:"large",onClick:()=>T(!0),onMouseEnter:()=>R(!0),onMouseLeave:()=>R(!1),icon:(0,j.jsx)(Qt.A,{style:{color:"#fff",fontSize:20}}),style:{width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:_?"0 10px 30px rgba(24,144,255,0.22)":"0 6px 18px rgba(0,0,0,0.12)",transform:_?"translateY(-4px) scale(1.03)":"none",transition:"transform 160ms cubic-bezier(.2,.8,.2,1), box-shadow 160ms"}})})})]})})};var nn=n(89485),an=n(52378),sn=n(67984),rn=n(1203),ln=n(73658),on=n(29049),dn=n(73317),cn=n(47994),un=n(2382),hn=n(82046),mn=n(65619),pn=n(27044),xn=n(15932),gn=n(48489);const fn=()=>{const{user:e}=_e(),t=(0,xe.Zp)(),[i,d]=(0,s.useState)(!1),[m,x]=(0,s.useState)([]),[y,v]=(0,s.useState)([]),[w,I]=(0,s.useState)([]),[C,k]=(0,s.useState)(()=>{try{const e=localStorage.getItem("viewedInquiries"),t=e?JSON.parse(e):[];return new Set(t||[])}catch(e){return new Set}}),N=e=>{e&&k(t=>{const n=new Set(Array.from(t));n.add(String(e));try{localStorage.setItem("viewedInquiries",JSON.stringify(Array.from(n)))}catch(a){}return n})},[T,D]=(0,s.useState)([]),[P,_]=(0,s.useState)(!1),[R,U]=(0,s.useState)(null),[B,q]=(0,s.useState)(!1),[L,O]=(0,s.useState)(null),[F,E]=(0,s.useState)(null),[z,M]=(0,s.useState)(!1),[W,Y]=(0,s.useState)(null),[V,H]=(0,s.useState)(""),[G,K]=(0,s.useState)(""),[J]=(0,s.useState)(!1),[Z,$]=(0,s.useState)(!1),[Q,X]=(0,s.useState)(!1),[ee,te]=(0,s.useState)([]),[ne,ae]=(0,s.useState)(!1),[se,ie]=(0,s.useState)(!1),[re,le]=(0,s.useState)(null),[oe,de]=(0,s.useState)(""),ce=an.Ay.useBreakpoint(),ue={};m.forEach(e=>{const t=e.type||"Unknown";ue[t]||(ue[t]=[]),ue[t].push(e)});const[he,me]=(0,s.useState)({pendingRequests:0,totalDocuments:0,completedRequests:0}),pe=async e=>{try{const a=e=>{if(!e&&0!==e)return null;if("string"===typeof e)return e;if("object"===typeof e){if("string"===typeof e.$oid)return e.$oid;try{const t=e.toString();if(t&&"[object Object]"!==t)return t}catch(t){}return null}return String(e)},s=[],i=a(e&&e._id),r=a(e&&e.gridFsFileId);i&&s.push(i),r&&s.push(r);const l=Array.from(new Set(s));let o=null,d=null;console.debug("[handleDownloadProcessed] record:",e,"candidateIds:",l);let c=null,u=null;for(const e of l)try{console.debug("[handleDownloadProcessed] attempting id=",e);const t=await(await Promise.resolve().then(n.bind(n,51496))).axiosInstance.get("/processed-documents/".concat(e,"/raw"),{responseType:"blob"});if(t&&t.status>=200&&t.status<300){c=t.data,u=t.headers||{},o=e;break}}catch(t){const e=t&&t.response&&t.response.status?t.response.status:null;if(404===e){d={status:404,body:t.response&&t.response.data?t.response.data:null};continue}return void nn.Ay.error({message:"Download failed",description:e?"Server returned ".concat(e):String(t)})}if(!c){const e=d&&d.body&&d.body.message?d.body.message:d&&d.message?d.message:"File not found";return void nn.Ay.error({message:"Download failed",description:e})}const h=c;let m=null;const p=u&&(u["content-disposition"]||u["Content-Disposition"])||null;if(p){const e=p.match(/filename\*=UTF-8''([^;\n\r]+)/i);if(e&&e[1])m=decodeURIComponent(e[1]);else{const e=p.match(/filename="?([^";]+)"?/i);e&&e[1]&&(m=e[1])}}m||(m=u&&(u["x-processed-transactioncode"]||u["X-Processed-TransactionCode"])||e.filename||e.name||"document_".concat(o||e._id,".docx"));const x=window.URL.createObjectURL(h),g=document.createElement("a");g.href=x;const f=m||"document_".concat(o||e._id,".docx");g.download=f,document.body.appendChild(g),g.click(),g.remove(),window.URL.revokeObjectURL(x)}catch(t){console.error("Download error",t),nn.Ay.error({message:"Download error",description:String(t)})}},ge=e=>(0,j.jsx)(f.A,{color:{pending:"gold",approved:"success",rejected:"error",processing:"processing"}[(null===e||void 0===e?void 0:e.toLowerCase())||"default"],children:(null===e||void 0===e?void 0:e.toUpperCase())||"UNKNOWN"}),ye=(0,s.useCallback)(async()=>{d(!0);try{const[n,a]=await Promise.all([A.documentsAPI.getDocumentRecords(),A.contactAPI.getAllInquiries()]);x(n),v(a);const s=a.filter(t=>t.assignedRole&&e&&t.assignedRole===e.role||t.assignedTo&&Array.isArray(t.assignedTo)&&e&&t.assignedTo.includes(e._id));I(s);let i=n.length;try{const e=await A.axiosInstance.get("/processed-documents",{params:{page:1,limit:1}}),t=e&&e.data?e.data:null;t&&"number"===typeof t.total&&(i=t.total)}catch(t){}me({pendingRequests:n.filter(e=>"pending"===e.status).length,totalDocuments:i,completedRequests:n.filter(e=>"approved"===e.status).length})}catch(n){console.error("Error fetching data:",n)}finally{d(!1)}},[e]),Ae=(0,s.useCallback)(async()=>{_(!0);try{const e=await A.contactAPI.getAnnouncements();D(Array.isArray(e)?e.slice(0,6):[])}catch(e){console.error("Failed to load mini announcements",e),D([])}finally{_(!1)}},[]);(0,s.useEffect)(()=>{ye(),Ae()},[ye,Ae]);function je(e){if(!e)return"Unknown";let t=e;return t=t.replace(/^Other\s*/i,"").trim(),t.split("_").map(e=>{const t=e||"";return t.length>0?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():""}).filter(Boolean).join(" ")}function ve(e){if(!e)return"";return new Date(e).toLocaleString()}const be=function(){return((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])||[]).slice().sort((e,t)=>{const n=e&&e.createdAt?new Date(e.createdAt).getTime():0;return(t&&t.createdAt?new Date(t.createdAt).getTime():0)-n})},we=(e,n)=>{t(e,{state:n})},Se=e=>{try{t(e)}catch(n){window.location.href=e}};return(0,j.jsx)(p.A,{spinning:i,tip:"Loading...",children:(0,j.jsxs)("div",{children:[(0,j.jsxs)(l.A,{gutter:[16,16],style:{marginBottom:24},children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>{const e=m.find(e=>"pending"===e.status);e&&e._id?we("/document-processing",{openRequestId:e._id}):we("/document-processing")},style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,j.jsx)(gt.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(b,{size:"small",background:"#fff7e6",color:"#faad14",icon:(0,j.jsx)(cn.A,{style:{fontSize:"14px"}})}),(0,j.jsx)("span",{children:"Pending Requests"})]}),value:he.pendingRequests,valueStyle:{color:"#faad14",fontSize:"28px",marginBottom:"4px"},prefix:(0,j.jsx)(un.A,{style:{fontSize:"16px"}})}),(0,j.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#faad14"},children:["View Pending Requests",(0,j.jsx)(jt.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>(async()=>{ae(!0);try{let n=[];try{const e=await A.axiosInstance.get("/processed-documents",{params:{page:1,limit:200}}),t=e&&e.data?e.data:null;t&&Array.isArray(t.items)?n=t.items:Array.isArray(t)&&(n=t)}catch(e){try{const e=await A.documentsAPI.listFiles();n=(Array.isArray(e)?e:e&&e.data?e.data:[]).filter(e=>{const t=(e.status||"").toString().toLowerCase();return["processed","approved","completed"].includes(t)||!0===e.processed})}catch(t){n=[]}}te(n||[])}catch(n){console.error("Failed to fetch documents for modal",n),te([])}finally{ae(!1),X(!0)}})(),style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,j.jsx)(gt.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(b,{size:"small",background:"#e6f7ff",color:"#1890ff",icon:(0,j.jsx)(hn.A,{style:{fontSize:"14px"}})}),(0,j.jsx)("span",{children:"Total Documents"})]}),value:he.totalDocuments,valueStyle:{color:"#1890ff",fontSize:"28px",marginBottom:"4px"},prefix:(0,j.jsx)(mn.A,{style:{fontSize:"16px"}})}),(0,j.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#1890ff"},children:["Browse Documents",(0,j.jsx)(jt.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>$(!0),style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,j.jsx)(gt.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(b,{size:"small",background:"#f6ffed",color:"#52c41a",icon:(0,j.jsx)(pn.A,{style:{fontSize:"14px"}})}),(0,j.jsx)("span",{children:"Completed Requests"})]}),value:he.completedRequests,valueStyle:{color:"#52c41a",fontSize:"28px",marginBottom:"4px"},prefix:(0,j.jsx)(Ie.A,{style:{fontSize:"16px"}})}),(0,j.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#52c41a"},children:["View Completed",(0,j.jsx)(jt.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>Se("/staff/inbox"),style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,j.jsx)(gt.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(b,{size:"small",background:"#f9f0ff",color:"#722ed1",icon:(0,j.jsx)(S.A,{style:{fontSize:"14px"}})}),(0,j.jsx)("span",{children:"Staff Inbox"})]}),value:w.length,valueStyle:{color:"#722ed1",fontSize:"28px",marginBottom:"4px"},prefix:(0,j.jsx)(We.A,{style:{fontSize:"16px"}})}),(0,j.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#722ed1"},children:["Open Inbox",(0,j.jsx)(jt.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})})]}),(0,j.jsxs)(l.A,{gutter:[16,16],children:[(0,j.jsx)(o.A,{xs:24,lg:8,children:(0,j.jsx)(r.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(xn.A,{})," Document Categories"]}),hoverable:!0,bordered:!1,size:"small",className:"dashboard-card",style:{transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},styles:{body:{padding:"0",height:"400px",maxHeight:"400px",overflow:"hidden"}},children:(0,j.jsx)(sn.A,{defaultActiveKey:["Certificates"],expandIcon:e=>{let{isActive:t}=e;return(0,j.jsx)(jt.A,{rotate:t?90:0})},style:{background:"white",height:"400px",overflowY:"auto"},children:Object.entries((e=>{const t={Certificates:{icon:(0,j.jsx)(on.A,{style:{fontSize:"18px",color:"#1890ff"}}),items:[],color:"#1890ff",description:"Birth, Death, Residency Certificates and more"},Permits:{icon:(0,j.jsx)(dn.A,{style:{fontSize:"18px",color:"#52c41a"}}),items:[],color:"#52c41a",description:"Building, Business, and Special Event Permits"},Complete:{icon:(0,j.jsx)(Ze.A,{style:{fontSize:"18px",color:"#52c41a"}}),items:[],color:"#52c41a",description:"All completed and approved document requests"}};return e.forEach(e=>{const n=(e.type||"").toLowerCase(),a=(e.status||"").toLowerCase();n.includes("certificate")||n.includes("certification")?t.Certificates.items.push(e):n.includes("permit")&&t.Permits.items.push(e),"approved"!==a&&"completed"!==a||t.Complete.items.push(e)}),t})(m)).map(e=>{let[n,a]=e;const s=a.items.filter(e=>{var t;return"pending"===(null===(t=e.status)||void 0===t?void 0:t.toLowerCase())}).length;return(0,j.jsxs)(sn.A.Panel,{header:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[(0,j.jsxs)(Oe.A,{align:"center",children:[(0,j.jsx)(b,{size:"small",background:a.color+"15",color:a.color,icon:a.icon}),(0,j.jsx)("span",{style:{fontWeight:500,fontSize:"14px"},children:n})]}),(0,j.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:"8px",alignItems:"center"},children:[s>0&&(0,j.jsxs)(f.A,{color:"gold",style:{marginRight:0},children:[s," pending"]}),(0,j.jsx)(Kt.A,{count:a.items.length,style:{backgroundColor:a.color},size:"small"})]})]}),children:[(0,j.jsx)("div",{style:{marginBottom:"16px"},children:(0,j.jsx)(h.A.Text,{type:"secondary",style:{fontSize:"13px"},children:a.description})}),(0,j.jsx)(g.A,{size:"small",dataSource:a.items.slice(0,5),split:!0,renderItem:e=>{var n;const a={PENDING:{color:"#faad14",bg:"#fff7e6"},APPROVED:{color:"#52c41a",bg:"#f6ffed"},REJECTED:{color:"#ff4d4f",bg:"#fff1f0"},DEFAULT:{color:"#8c8c8c",bg:"#f5f5f5"}},s=(null===(n=e.status)||void 0===n?void 0:n.toUpperCase())||"DEFAULT",i=a[s]||a.DEFAULT;return(0,j.jsx)(g.A.Item,{onClick:()=>t("/document-processing",{state:{openRequestId:e._id}}),actions:["PENDING"===e.status&&(0,j.jsxs)(Oe.A,{size:4,children:[(0,j.jsx)(u.Ay,{type:"text",size:"small",icon:(0,j.jsx)(Ie.A,{style:{color:"#52c41a"}}),onClick:t=>{t.stopPropagation(),O(e),K("APPROVED")}}),(0,j.jsx)(u.Ay,{type:"text",size:"small",icon:(0,j.jsx)(gn.A,{style:{color:"#ff4d4f"}}),onClick:t=>{t.stopPropagation(),O(e),K("REJECTED")}})]})].filter(Boolean),style:{padding:"12px 0"},children:(0,j.jsx)(g.A.Item.Meta,{avatar:(0,j.jsx)(b,{size:36,background:i.bg,color:i.color,icon:(0,j.jsx)(Me.A,{})}),title:(0,j.jsxs)(Oe.A,{size:8,style:{marginBottom:4},children:[(0,j.jsx)(h.A.Text,{strong:!0,style:{fontSize:"14px"},children:je(e.type||e.title)}),(0,j.jsx)(f.A,{color:i.color,style:{margin:0,padding:"0 6px",fontSize:"12px",lineHeight:"18px"},children:s})]}),description:(0,j.jsxs)(Oe.A,{direction:"vertical",size:0,children:[(0,j.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:"13px"},children:["Requested by: ",e.username||"Unknown"]}),(0,j.jsx)(h.A.Text,{type:"secondary",style:{fontSize:"12px"},children:ve(e.dateRequested||"")})]})})})},locale:{emptyText:(0,j.jsx)(rn.A,{image:rn.A.PRESENTED_IMAGE_SIMPLE,description:(0,j.jsxs)(h.A.Text,{type:"secondary",children:["No ",n.toLowerCase()," requests"]})})}}),a.items.length>0&&(0,j.jsx)("div",{style:{textAlign:"center",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #f0f0f0"},children:(0,j.jsxs)(u.Ay,{type:"link",size:"small",icon:a.icon,onClick:()=>Se("/documents"),children:["View All ",n]})})]},n)})})})}),(0,j.jsx)(o.A,{xs:24,lg:8,children:(0,j.jsx)(r.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)($t.A,{}),(0,j.jsx)("span",{children:"Inquiries Inbox"}),(0,j.jsx)(Kt.A,{count:w.filter(e=>"open"===e.status||"PENDING"===e.status).length,style:{backgroundColor:"#722ed1"}})]}),extra:(0,j.jsx)(Oe.A,{children:(0,j.jsx)(gt.A,{value:w.length,suffix:"total",valueStyle:{fontSize:"14px",color:"#8c8c8c"}})}),hoverable:!0,bordered:!1,size:"small",className:"dashboard-card",style:{transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",position:"relative"},styles:{body:{height:"400px",maxHeight:"400px",padding:0,overflow:"hidden"}},children:(0,j.jsxs)("div",{style:{padding:"0 12px"},children:[(0,j.jsxs)(sn.A,{accordion:!1,defaultActiveKey:["open"],expandIcon:e=>{let{isActive:t}=e;return(0,j.jsx)(jt.A,{rotate:t?90:0})},style:{background:"white"},children:[(0,j.jsx)(sn.A.Panel,{header:(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:(0,j.jsxs)(Oe.A,{align:"center",children:[(0,j.jsx)($t.A,{style:{color:"#722ed1",fontSize:"16px"}}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Open Inquiries"}),(0,j.jsx)(Kt.A,{count:w.filter(e=>"PENDING"===e.status||"open"===e.status).length,style:{backgroundColor:"#722ed1"}})]})}),children:(0,j.jsx)("div",{style:{maxHeight:300,overflowY:"auto",paddingRight:8},children:0===w.filter(e=>"PENDING"===e.status||"open"===e.status).length?(0,j.jsx)(rn.A,{image:rn.A.PRESENTED_IMAGE_SIMPLE,description:(0,j.jsx)(h.A.Text,{type:"secondary",children:"No open inquiries"})}):(0,j.jsx)(g.A,{size:"large",dataSource:be(w.filter(e=>"PENDING"===e.status||"open"===e.status)),renderItem:e=>{const n="PENDING"===e.status||"open"===e.status,a=n?"#722ed1":"#8c8c8c",s=n?"#f9f0ff":"#f5f5f5",i=e._id&&C.has(String(e._id)),r=e.username||e.residentName||e.subject||"Unknown",l=r&&"Unknown"!==r&&r.length>0?r.charAt(0).toUpperCase():"?";return(0,j.jsx)(g.A.Item,{style:{padding:"18px 20px",minHeight:72,borderBottom:"1px solid #f0f0f0",transition:"all 0.3s ease",cursor:"pointer",backgroundColor:"white"},onClick:()=>{e._id&&N(String(e._id)),t("/staff/inbox",{state:{openInquiryId:e._id}})},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#fafafa"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="white"},children:(0,j.jsx)(g.A.Item.Meta,{avatar:(0,j.jsx)(Kt.A,{dot:n,color:n&&!i?"#faad14":"#722ed1",offset:[-6,6],children:(0,j.jsx)(b,{size:40,style:{backgroundColor:s,color:a,fontSize:"15px",fontWeight:600},children:l})}),title:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:0},children:[(0,j.jsx)("div",{style:{fontSize:"14px",fontWeight:600,color:"rgba(0, 0, 0, 0.85)"},children:e.username||"Unknown User"}),(0,j.jsx)(f.A,{color:n?"gold":"success",style:{margin:0,fontSize:"12px",lineHeight:"20px",height:"22px",padding:"0 10px",fontWeight:"normal",borderRadius:"4px"},children:n?"PENDING":"RESOLVED"}),n&&!i&&(0,j.jsx)(f.A,{color:"default",onClick:t=>{t.stopPropagation(),e._id&&N(String(e._id))},style:{marginLeft:8,cursor:"pointer",background:"#fff7e6",color:"#d48806",border:"1px solid #ffd591"},children:"UNREAD"})]}),description:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",width:"100%"},children:[(0,j.jsx)(h.A.Text,{style:{fontSize:"13px",color:"rgba(0, 0, 0, 0.65)",flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.5"},children:e.message}),(0,j.jsx)(h.A.Text,{type:"secondary",style:{fontSize:"12px",flexShrink:0,color:"#8c8c8c"},children:ve(e.createdAt)})]})})})}})})},"open"),(0,j.jsx)(sn.A.Panel,{header:(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:(0,j.jsxs)(Oe.A,{align:"center",children:[(0,j.jsx)($t.A,{style:{color:"#52c41a",fontSize:"16px"}}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Resolved Inquiries"}),(0,j.jsx)(Kt.A,{count:w.filter(e=>!("PENDING"===e.status||"open"===e.status)).length,style:{backgroundColor:"#52c41a"}})]})}),children:(0,j.jsx)("div",{style:{maxHeight:220,overflowY:"auto",paddingRight:8},children:0===w.filter(e=>!("PENDING"===e.status||"open"===e.status)).length?(0,j.jsx)(rn.A,{image:rn.A.PRESENTED_IMAGE_SIMPLE,description:(0,j.jsx)(h.A.Text,{type:"secondary",children:"No resolved inquiries"})}):(0,j.jsx)(g.A,{size:"small",dataSource:be(w.filter(e=>!("PENDING"===e.status||"open"===e.status))),renderItem:e=>(0,j.jsx)(g.A.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},onClick:()=>{e._id&&N(String(e._id)),E(e)},children:(0,j.jsx)(g.A.Item.Meta,{avatar:(0,j.jsx)(b,{size:40,style:{backgroundColor:"#f5f5f5",color:"#8c8c8c",fontSize:14},children:(e.username||"Unknown").charAt(0).toUpperCase()}),title:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,j.jsx)("div",{style:{fontSize:13,fontWeight:600},children:e.username||"Unknown User"}),(0,j.jsx)(f.A,{color:"success",style:{margin:0,fontSize:12},children:"RESOLVED"})]}),description:(0,j.jsx)("div",{style:{fontSize:12,color:"#888"},children:e.message})})})})})},"resolved")]}),(0,j.jsx)("div",{style:{position:"absolute",right:12,bottom:12,zIndex:40},children:(0,j.jsx)(u.Ay,{type:"link",style:{position:"absolute",right:16,bottom:0,fontSize:13,color:"#1890ff",zIndex:50,pointerEvents:"auto"},onClick:e=>{try{e.stopPropagation()}catch(n){}t("/inquiry-tracker")},children:"Expand"})})]})})}),(0,j.jsx)(o.A,{xs:24,lg:8,children:(0,j.jsxs)(r.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(Me.A,{})," Announcements"]}),style:{marginTop:0,background:"#fafbfc",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0",position:"relative"},styles:{body:{padding:12}},size:"small",hoverable:!1,children:[0===T.length?(0,j.jsx)(rn.A,{image:(0,j.jsx)(Me.A,{style:{fontSize:42,color:"#d9d9d9"}}),description:(0,j.jsx)("span",{style:{color:"#888"},children:"No announcements"})}):(0,j.jsx)("div",{style:{maxHeight:320,overflowY:"auto",paddingRight:6},children:(0,j.jsx)(g.A,{loading:P,dataSource:T,renderItem:e=>(0,j.jsxs)(g.A.Item,{style:{cursor:"pointer",padding:"10px 8px",alignItems:"center"},onClick:()=>{U(e),q(!0)},children:[(0,j.jsx)(g.A.Item.Meta,{title:(0,j.jsx)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:(0,j.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,j.jsx)("div",{style:{fontWeight:600,fontSize:13,display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.2em"},children:e.text||"Untitled"}),(0,j.jsx)("div",{style:{fontSize:12,color:"#888",marginTop:6},children:new Date(e.createdAt).toLocaleString()})]})}),description:null}),e.imagePath&&(0,j.jsx)("div",{style:{marginLeft:12,width:92,display:"flex",justifyContent:"flex-end",flexShrink:0},children:(0,j.jsx)("img",{loading:"lazy",className:"rounded-img",src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image")),alt:"ann",style:{width:92,height:60,objectFit:"cover",borderRadius:6,background:"#f0f0f0"}})})]}),size:"small"})}),(0,j.jsx)(u.Ay,{type:"link",style:{position:"absolute",right:16,bottom:0,fontSize:13,color:"#1890ff"},onClick:()=>t("/admin/announcements"),children:"Manage"}),(0,j.jsx)(ln.A,{open:B,onClose:()=>{q(!1),U(null)},title:"Announcement",width:720,placement:"right",children:R&&(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Text,{style:{display:"block",marginBottom:12,whiteSpace:"pre-wrap"},children:R.text}),R.imagePath&&(0,j.jsx)("img",{loading:"lazy",className:"rounded-img rounded-img-lg",src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(R._id,"/image")),alt:"announcement",style:{width:"100%",height:"auto",borderRadius:8,background:"#f6f6f6"}}),(0,j.jsx)("div",{style:{marginTop:8,color:"#888"},children:new Date(R.createdAt).toLocaleString()})]})})]})})]}),(0,j.jsxs)(fe.A,{open:Q,title:"Processed Documents (".concat(ee.length,")"),onCancel:()=>{X(!1)},footer:null,width:ce.xs?"95%":ce.md?1e3:1200,styles:{body:{padding:"12px 18px"}},children:[(0,j.jsxs)(p.A,{spinning:ne,children:[(0,j.jsxs)("div",{style:{display:"flex",gap:12,marginBottom:12,flexDirection:ce.xs?"column":"row",alignItems:ce.xs?"stretch":"center"},children:[(0,j.jsx)(c.A.Search,{placeholder:"Search by title, filename, transaction code or uploader",allowClear:!0,enterButton:!1,onSearch:e=>de(String(e||"").trim()),onChange:e=>de(e.target.value),style:{maxWidth:420,flex:1},value:oe}),(0,j.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[(0,j.jsx)(u.Ay,{onClick:()=>{de("")},children:"Clear"}),(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>{te(ee.slice().sort((e,t)=>new Date(t.createdAt||0).getTime()-new Date(e.createdAt||0).getTime()))},children:"Sort Newest"})]})]}),(0,j.jsx)(Jt.A,{dataSource:ee.filter(e=>{if(!oe)return!0;const t=oe.toLowerCase();return[e.title,e.filename,e.name,e.transactionCode,e.transactioncode,e.uploadedBy&&(e.uploadedBy.username||e.uploadedBy.name)||e.uploadedBy||""].some(e=>e&&String(e).toLowerCase().includes(t))}),rowKey:e=>e._id||e.id||e.filename,pagination:{pageSize:10},scroll:{x:"max-content"},columns:[{title:"Title",dataIndex:"title",key:"title",render:(e,t)=>(0,j.jsxs)("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[(0,j.jsx)(b,{size:36,icon:(0,j.jsx)(Me.A,{})}),(0,j.jsxs)("div",{style:{minWidth:0},children:[(0,j.jsx)("div",{style:{fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e||t.filename||t.name||"Untitled"}),(0,j.jsx)("div",{style:{fontSize:12,color:"#888"},children:t.sourceTemplateName||t.templateName||""})]})]})},{title:"Transaction",dataIndex:"transactionCode",key:"transactionCode",responsive:["sm"],render:e=>e||"-"},{title:"Uploaded By",dataIndex:"uploadedBy",key:"uploadedBy",responsive:["md"],render:e=>e&&(e.username||e.name)||("string"===typeof e?e:"-")},{title:"Date",dataIndex:"createdAt",key:"createdAt",responsive:["sm"],render:e=>ve(e)},{title:"Actions",key:"action",width:220,render:(e,t)=>(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(u.Ay,{size:"small",onClick:()=>pe(t),children:"Download"}),(0,j.jsx)(u.Ay,{size:"small",onClick:()=>{le(t),ie(!0)},children:"Preview"}),(t.transactionCode||t.transactioncode)&&(0,j.jsx)(u.Ay,{size:"small",onClick:()=>{var e;null===(e=navigator.clipboard)||void 0===e||e.writeText(t.transactionCode||t.transactioncode||""),nn.Ay.success({message:"Copied",description:"Transaction code copied to clipboard"})},children:"Copy TX"})]})}]})]}),(0,j.jsx)(ln.A,{title:re&&(re.title||re.filename)||"Document",placement:"right",onClose:()=>{ie(!1),le(null)},open:se,width:ce.xs?"95%":560,children:re?(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{style:{fontWeight:700},children:re.title||re.filename||"Untitled"}),(0,j.jsx)("div",{style:{fontSize:12,color:"#888"},children:re.sourceTemplateName||re.templateName||""})]}),(0,j.jsx)("div",{children:(0,j.jsx)(u.Ay,{onClick:()=>pe(re),type:"primary",children:"Download"})})]}),(0,j.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,j.jsxs)(f.A,{color:"blue",children:["Created: ",ve(re.createdAt)]}),re.transactionCode&&(0,j.jsxs)(f.A,{color:"purple",children:["TX: ",re.transactionCode]}),re.uploadedBy&&(0,j.jsxs)(f.A,{children:["By: ",re.uploadedBy.username||re.uploadedBy.name||re.uploadedBy]})]}),(0,j.jsxs)("div",{style:{color:"#444",fontSize:13},children:[(0,j.jsx)("div",{style:{marginBottom:8},children:re.description||re.notes||""}),(0,j.jsx)("div",{style:{marginTop:8},children:(0,j.jsx)(u.Ay,{type:"link",onClick:()=>{var e;null===(e=navigator.clipboard)||void 0===e||e.writeText(re.transactionCode||""),nn.Ay.success({message:"Copied",description:"Transaction code copied"})},children:"Copy Transaction Code"})})]})]}):(0,j.jsx)("div",{children:"No document selected"})}),(0,j.jsx)(fe.A,{title:"Manage Inquiries",open:z,onCancel:()=>{M(!1),Y(null)},footer:null,width:900,children:(0,j.jsxs)(Jt.A,{dataSource:null!==W?W:be(y),rowKey:e=>e._id,pagination:{pageSize:10},onRow:e=>({onClick:()=>{e&&e._id&&N(String(e._id)),M(!1),t("/staff/inbox",{state:{openInquiryId:e._id}})}}),children:[(0,j.jsx)(Jt.A.Column,{title:"Name",dataIndex:"username",render:(e,t)=>e||t.residentName||t.subject||"Unknown"},"username"),(0,j.jsx)(Jt.A.Column,{title:"Type of Inquiry",dataIndex:"type",render:e=>e?String(e):"General"},"type"),(0,j.jsx)(Jt.A.Column,{title:"Status",dataIndex:"status",render:e=>ge(e)},"status"),(0,j.jsx)(Jt.A.Column,{title:"Date Inquired",dataIndex:"createdAt",render:e=>ve(e)},"createdAt")]})})]}),(0,j.jsx)(fe.A,{open:!!L,title:L?"".concat(G," Document Request"):"",onCancel:()=>{O(null),H(""),K("")},footer:L?[(0,j.jsx)(c.A.TextArea,{rows:4,value:V,onChange:e=>H(e.target.value),placeholder:"Type notes..."},"notes"),(0,j.jsx)(u.Ay,{type:"primary",disabled:!V.trim(),onClick:async()=>{if(!L)return;const e=L._id||L.id;if(e)try{const t={status:(G||"").toString().toLowerCase(),notes:V};nn.Ay.info({message:"Processing",description:"Updating document status to ".concat(t.status,"..."),duration:1.2}),await A.documentsAPI.updateDocumentStatus(e,t),x(n=>(n||[]).map(n=>!n||n._id!==e&&n.id!==e?n:(0,a.A)((0,a.A)({},n),{},{status:t.status}))),nn.Ay.success({message:"Success",description:"Document marked ".concat(t.status)}),O(null),H(""),K("")}catch(s){var t,n;console.error("Failed to update document status",s);const e=(null===s||void 0===s||null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||(null===s||void 0===s?void 0:s.message)||"Failed to update document";nn.Ay.error({message:"Error",description:e})}},children:"Submit"},"submit")]:null,children:L&&(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Type:"})," ",je(L.type||L.title),(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Description:"})," ",L.description||"",(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Requested by:"})," ",L.username||"Unknown",(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Barangay ID:"})," ",L.barangayID||"Unknown",(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Date:"})," ",ve(L.dateRequested||""),(0,j.jsx)("br",{})]})}),(0,j.jsx)(fe.A,{open:!!F,title:F?"Respond to Inquiry: ".concat(F.subject):"",onCancel:()=>{E(null),H("")},footer:F?[(0,j.jsx)(c.A.TextArea,{rows:4,value:V,onChange:e=>H(e.target.value),placeholder:"Type your response...",disabled:J},"response"),(0,j.jsx)(u.Ay,{type:"primary",loading:J,disabled:!V.trim(),onClick:async()=>{if(!F)return;const e=F._id||F.id;if(e)try{nn.Ay.info({message:"Sending response",description:"Posting your reply...",duration:1.2}),await A.contactAPI.respondToInquiry(e,{response:V}),v(t=>(t||[]).map(t=>!t||t._id!==e&&t.id!==e?t:(0,a.A)((0,a.A)({},t),{},{status:"resolved"}))),nn.Ay.success({message:"Response sent",description:"Inquiry has been updated"}),E(null),H("")}catch(s){var t,n;console.error("Failed to send inquiry response",s);const e=(null===s||void 0===s||null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||(null===s||void 0===s?void 0:s.message)||"Failed to send response";nn.Ay.error({message:"Error",description:e})}},children:"Send Response"},"send")]:null,children:F&&(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Type:"})," ",F.type,(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Message:"})," ",F.message,(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"From:"})," ",F.username?"".concat(F.username," (Barangay ID: ").concat(F.barangayID||"Unknown",")"):"Unknown",(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Date:"})," ",ve(F.createdAt),(0,j.jsx)("br",{})]})}),(0,j.jsx)(fe.A,{open:Z,title:"Completed Requests (".concat(he.completedRequests||0,")"),onCancel:()=>$(!1),footer:null,width:1100,styles:{body:{padding:12}},children:(0,j.jsx)("div",{style:{overflowX:"auto"},children:(0,j.jsx)(Jt.A,{dataSource:m.filter(e=>"approved"===(e.status||"").toLowerCase()||"completed"===(e.status||"").toLowerCase()),rowKey:e=>e._id,pagination:{pageSize:10},scroll:{x:1e3},columns:[{title:"Requester",dataIndex:"username",key:"username",width:200,render:(e,t)=>{var n;return e||(null===(n=t.requesterId)||void 0===n?void 0:n.fullName)||"Unknown"}},{title:"Document",dataIndex:"type",key:"type",width:220,render:(e,t)=>je(e||t.title)},{title:"Description",dataIndex:"description",key:"description",width:300,render:e=>e||"-"},{title:"Date Requested",dataIndex:"dateRequested",key:"dateRequested",width:180,render:e=>ve(e)},{title:"Status",dataIndex:"status",key:"status",width:120,render:e=>ge(e)},{title:"Action",key:"action",width:120,render:(e,t)=>(0,j.jsx)(u.Ay,{type:"link",onClick:()=>{O(t),$(!1),K("")},children:"View"})}]})})})]})})};var yn=n(73422);let An=null;function jn(e){if(An)return An;const t=globalThis.__APP_CONFIG__||{};let n=t.SOCKET_URL||t.API_BASE||"https://my-backend.onrender.com/api",a=String(n).replace(/\/$/,"");return a.endsWith("/api")&&(a=a.replace(/\/api$/,"")),"/api"===a&&(a=""),An=(0,yn.Ay)(a||"/",{path:"/socket.io",transports:["websocket"],auth:e?{token:e}:void 0,autoConnect:!0}),An}function vn(e,t){An&&An.on(e,t)}function bn(e,t){An&&An.off(e,t)}const wn=["#6366F1","#22C55E","#F59E42","#EF4444","#3B82F6","#FBBF24","#A21CAF","#14B8A6"],{Title:In,Text:Sn}=h.A,Cn=()=>{const e=(0,xe.Zp)(),{user:t}=_e(),[n,i]=(0,s.useState)(!1),[,d]=(0,s.useState)([]),[c,h]=(0,s.useState)({totalUsers:0,activeUsers:0,pendingRequests:0,totalDocuments:0,completedRequests:0,unreadMessages:0}),[m,x]=(0,s.useState)([]),[f,y]=(0,s.useState)([]),[,v]=(0,s.useState)([]),[b,w]=(0,s.useState)([]),[I,S]=(0,s.useState)(!1),[C,k]=(0,s.useState)(!1),[N,T]=(0,s.useState)(null),[,D]=(0,s.useState)([]),[,P]=(0,s.useState)([]),_=[3,5,4,6,7,8,10],R=[{type:"Clearance",value:12},{type:"Certificate",value:8},{type:"Permit",value:5},{type:"Other",value:3}],U=[{type:"Clearance",value:27},{type:"Certificate",value:18},{type:"Permit",value:12},{type:"Other",value:8}],B=(0,s.useCallback)(async()=>{try{var e,n,a,s,r;i(!0);const c=await A.adminAPI.getSystemStatistics();try{const e=await A.documentsAPI.getDocumentRecords();d(e)}catch(l){d([])}const u=(await A.notificationAPI.getNotifications()).filter(e=>!e.read);x(u.slice(0,10));const m=u.filter(e=>"staff_approval"===(e.type||"").toString().toLowerCase());y(m);const p=((null===(e=c.documents)||void 0===e?void 0:e.pending)||0)+m.length,g=(null===(n=c.documents)||void 0===n?void 0:n.total)||0;let f=0;try{const e=await A.documentsAPI.getDocumentRecords();f=((Array.isArray(e)?e:e&&e.data?e.data:[])||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase()).length}catch(o){f=p}const j=f+(m?m.length:0);h({totalUsers:(null===(a=c.users)||void 0===a?void 0:a.total)||0,activeUsers:(null===(s=c.users)||void 0===s?void 0:s.active)||0,pendingRequests:j,totalDocuments:g,completedRequests:(null===(r=c.documents)||void 0===r?void 0:r.completed)||0,unreadMessages:u&&Array.isArray(u)?u.length:0});const b=await A.contactAPI.getAllInquiries();D(b);const w=b.filter(e=>e.assignedRole&&t&&e.assignedRole===t.role||e.assignedTo&&Array.isArray(e.assignedTo)&&t&&e.assignedTo.includes(t._id));P(w);const I=await A.adminAPI.getActivityLogs({});v(I.map(e=>({id:e.id,type:e.module||"system",description:e.description||e.action,timestamp:e.timestamp,user:e.userName||e.userId})))}catch(c){console.error("Error fetching dashboard data:",c)}finally{i(!1)}},[t]);(0,s.useEffect)(()=>{B();try{jn();const e=e=>{console.log("Received document socket event, refreshing dashboard",e),B()};vn("documentStatusUpdate",e),vn("documentCreated",e),vn("documentDeleted",e),vn("documents-updated",e);const t=setInterval(()=>{B()},3e4);return()=>{bn("documentStatusUpdate",e),bn("documentCreated",e),bn("documentDeleted",e),bn("documents-updated",e),clearInterval(t)}}catch(e){const t=setInterval(()=>{B()},3e4);return()=>clearInterval(t)}},[B]);const q=async()=>{S(!0);try{const e=await A.verificationAPI.getRequests();w(Array.isArray(e)?e:[])}catch(e){console.error("Failed to load verification requests",e),w([])}finally{S(!1)}};(0,s.useEffect)(()=>{q()},[]);const L=async()=>{try{const e=await A.adminAPI.getUsers(),t=Array.isArray(e)||e&&"number"===typeof e.length?e.length:0;h(e=>(0,a.A)((0,a.A)({},e),{},{totalUsers:t}))}catch(e){console.error("Failed to fetch users list for count:",e)}};(0,s.useEffect)(()=>{L();const e=setInterval(L,3e4);return()=>clearInterval(e)},[]);const O=[{label:"Users",value:c.totalUsers,icon:"\ud83d\udc64",bg:"linear-gradient(90deg, #1890ff 0%, #40a9ff 100%)",color:"#1890ff",labelColor:"#e6f7ff",onClick:void 0,chart:(0,j.jsx)("div",{style:{width:"100%",marginTop:8,height:32},children:(0,j.jsx)("svg",{width:"100%",height:"40",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:(0,j.jsx)("polyline",{fill:"none",stroke:"#4F46E5",strokeWidth:"2",points:_.map((e,t)=>"".concat(t*(100/(_.length-1)),",").concat(40-e/Math.max(..._)*35)).join(" ")})})})},{label:"Pending Requests",value:c.pendingRequests,icon:"\u23f3",bg:"linear-gradient(90deg, #faad14 0%, #ffe58f 100%)",color:"#faad14",labelColor:"#fffbe6",onClick:void 0,chart:(0,j.jsx)("div",{style:{width:"100%",marginTop:8,height:32},children:(0,j.jsx)("svg",{width:"100%",height:"40",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:R.map((e,t)=>{const n=100/R.length-2,a=e.value/Math.max(...R.map(e=>e.value))*35;return(0,j.jsx)("rect",{x:t*(100/R.length)+1,y:40-a,width:n,height:a,fill:"#22C55E",rx:"2"},t)})})})},{label:"Documents",value:c.totalDocuments,icon:"\ud83d\udcc4",bg:"linear-gradient(90deg, #52c41a 0%, #b7eb8f 100%)",color:"#52c41a",labelColor:"#f6ffed",onClick:void 0,chart:(0,j.jsx)("div",{style:{width:"100%",marginTop:8,height:32,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,j.jsx)("svg",{width:"40",height:"40",viewBox:"0 0 40 40",children:(()=>{const e=U.reduce((e,t)=>e+t.value,0);let t=0;return U.map((n,a)=>{const s=n.value/e*360,i=t+s,r=s>180?1:0,l=20+18*Math.cos(Math.PI*(t-90)/180),o=20+18*Math.sin(Math.PI*(t-90)/180),d=20+18*Math.cos(Math.PI*(i-90)/180),c=20+18*Math.sin(Math.PI*(i-90)/180),u="M20,20 L".concat(l,",").concat(o," A18,18 0 ").concat(r," 1 ").concat(d,",").concat(c," Z");return t+=s,(0,j.jsx)("path",{d:u,fill:wn[a%wn.length]},a)})})()})})},{label:"Notifications",value:c.unreadMessages,icon:"\ud83d\udd14",bg:"linear-gradient(90deg, #722ed1 0%, #b37feb 100%)",color:"#722ed1",labelColor:"#f9f0ff",onClick:()=>e("/admin/notifications"),chart:null}],F=["Total Users","Pending Requests","Total Documents","Unread Messages"],[E,z]=(0,s.useState)([]),[M,W]=(0,s.useState)(!1),[Y,V]=(0,s.useState)(null),[H,G]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{W(!0);try{const e=await A.contactAPI.getAnnouncements();z(Array.isArray(e)?e.slice(0,6):[])}catch(e){console.error("Failed to load mini announcements",e),z([])}finally{W(!1)}})()},[]);const K=e=>{if(!e)return"";const t=new Date(e),n=Math.floor((Date.now()-t.getTime())/1e3);return n<60?"".concat(n,"s ago"):n<3600?"".concat(Math.floor(n/60),"m ago"):n<86400?"".concat(Math.floor(n/3600),"h ago"):n<604800?"".concat(Math.floor(n/86400),"d ago"):t.toLocaleDateString()};return(0,j.jsx)(p.A,{spinning:n,children:(0,j.jsxs)("div",{style:{padding:24,backgroundColor:"#f0f2f5",minHeight:"100vh"},children:[(0,j.jsx)(In,{level:4,style:{marginBottom:24},children:"Admin Dashboard"}),(0,j.jsx)(l.A,{gutter:[24,24],style:{marginBottom:32},children:O.map((e,t)=>(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsxs)(r.A,{hoverable:!0,onClick:e.onClick,style:{background:e.bg,color:"#fff",borderRadius:20,minHeight:170,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:e.onClick?"pointer":"default",transition:"box-shadow 0.2s, transform 0.2s",position:"relative",marginBottom:8,padding:24},styles:{body:{width:"100%",padding:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"transparent"}},onMouseEnter:e=>{e.currentTarget.style.boxShadow="0 8px 32px 0 rgba(0,0,0,0.18)",e.currentTarget.style.transform="translateY(-4px)"},onMouseLeave:e=>{e.currentTarget.style.boxShadow="0 2px 8px 0 rgba(0,0,0,0.08)",e.currentTarget.style.transform="none"},children:[(0,j.jsx)("span",{style:{fontSize:40,marginBottom:8,opacity:.92},children:e.icon}),(0,j.jsx)("span",{style:{fontSize:38,fontWeight:700,lineHeight:1},children:e.value}),(0,j.jsx)("span",{style:{fontSize:15,color:e.labelColor,fontWeight:500,marginTop:2,letterSpacing:.5},children:e.label}),(0,j.jsx)("span",{style:{fontSize:13,color:"rgba(255,255,255,0.7)",marginTop:2,fontWeight:400},children:F[t]}),e.chart]})},"string"===typeof e.label?e.label:String(t)))}),(0,j.jsxs)(l.A,{gutter:[24,24],style:{marginTop:0},children:[(0,j.jsx)(o.A,{xs:24,lg:12,children:(0,j.jsxs)(r.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(Ke.A,{})," Staff Access Approval"]}),style:{marginTop:0,background:"#fafbfc",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0",position:"relative"},styles:{body:{padding:16}},size:"small",hoverable:!1,children:[f&&f.length>0&&(0,j.jsx)("div",{style:{marginBottom:12},children:(0,j.jsx)(Jt.A,{size:"small",pagination:{pageSize:5},dataSource:f,rowKey:e=>e._id||String(e.createdAt),columns:[{title:"Name",key:"requestedBy",render:(e,t)=>{const n=t.data||{},a=n.fullName||n.userId&&(n.userId.fullName||n.userId.username),s=t.requestedByName,i=a||s||t.message||"Unknown";return(0,j.jsx)("span",{style:{fontWeight:600},children:i})}},{title:"Requested At",dataIndex:"createdAt",key:"createdAt",render:(e,t)=>(0,j.jsx)("span",{style:{fontSize:12,color:"#888"},children:new Date(t.createdAt||e).toLocaleString()})},{title:"Actions",key:"actions",render:(e,t)=>(0,j.jsxs)(Oe.A,{children:[!t.read&&(0,j.jsx)(u.Ay,{type:"primary",size:"small",onClick:()=>(async e=>{var t;if(null!==(t=e.data)&&void 0!==t&&t.userId&&e._id)try{i(!0),await A.notificationAPI.approveStaff(e.data.userId,e._id),await B()}catch(n){console.error("Failed to approve staff:",n)}finally{i(!1)}})(t),icon:(0,j.jsx)(Ie.A,{}),children:"Approve"}),(0,j.jsx)(u.Ay,{danger:!0,size:"small",onClick:()=>(async e=>{if(!e._id)return;const t=window.prompt("Enter a brief reason for rejection (optional):");try{i(!0),await A.notificationAPI.rejectStaff(e._id,t||void 0),await B()}catch(n){console.error("Failed to reject staff request:",n)}finally{i(!1)}})(t),icon:(0,j.jsx)(gn.A,{}),children:"Reject"})]})}]})}),(0,j.jsx)(u.Ay,{type:"link",style:{position:"absolute",right:16,bottom:8,fontSize:13,color:"#1890ff"},onClick:()=>e("/admin/notifications"),children:"View all"})]})}),(0,j.jsx)(o.A,{xs:24,lg:12,children:(0,j.jsxs)(r.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(Me.A,{})," Announcements"]}),style:{marginTop:0,background:"#fafbfc",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0",position:"relative"},styles:{body:{padding:12}},size:"small",hoverable:!1,children:[0===E.length?(0,j.jsx)(rn.A,{image:(0,j.jsx)(Me.A,{style:{fontSize:42,color:"#d9d9d9"}}),description:(0,j.jsx)("span",{style:{color:"#888"},children:"No announcements"})}):(0,j.jsx)("div",{style:{maxHeight:320,overflowY:"auto",paddingRight:6,paddingBottom:48},children:(0,j.jsx)(g.A,{loading:M,dataSource:E,renderItem:e=>(0,j.jsxs)(g.A.Item,{style:{cursor:"pointer",padding:"10px 8px",alignItems:"center"},onClick:()=>{V(e),G(!0)},children:[(0,j.jsx)(g.A.Item.Meta,{title:(0,j.jsx)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:(0,j.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,j.jsx)("div",{style:{fontWeight:600,fontSize:13,display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.2em"},children:e.text||"Untitled"}),(0,j.jsx)("div",{style:{fontSize:12,color:"#888",marginTop:6},children:K(e.createdAt)})]})}),description:null}),e.imagePath&&(0,j.jsx)("div",{style:{marginLeft:12,width:92,display:"flex",justifyContent:"flex-end",flexShrink:0},children:(0,j.jsx)("img",{loading:"lazy",className:"rounded-img",src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image")),alt:"ann",style:{width:92,height:60,objectFit:"cover",borderRadius:6,background:"#f0f0f0"}})})]}),size:"small"})}),(0,j.jsx)("div",{style:{marginTop:8,display:"flex",justifyContent:"flex-end"},children:(0,j.jsx)(u.Ay,{type:"link",style:{fontSize:13,color:"#1890ff"},onClick:()=>e("/admin/announcements"),children:"Manage"})}),(0,j.jsx)(ln.A,{open:H,onClose:()=>{G(!1),V(null)},title:"Announcement",width:720,placement:"right",children:Y&&(0,j.jsxs)("div",{children:[(0,j.jsx)(Sn,{style:{display:"block",marginBottom:12,whiteSpace:"pre-wrap"},children:Y.text}),Y.imagePath&&(0,j.jsx)("img",{loading:"lazy",className:"rounded-img rounded-img-lg",src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(Y._id,"/image")),alt:"announcement",style:{width:"100%",height:"auto",borderRadius:8,background:"#f6f6f6"}}),(0,j.jsx)("div",{style:{marginTop:8,color:"#888"},children:K(Y.createdAt)})]})})]})})]}),(0,j.jsx)(l.A,{gutter:[24,24],style:{marginTop:24},children:(0,j.jsx)(o.A,{xs:24,children:(0,j.jsxs)(r.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(Xe.A,{})," Verification Requests"]}),style:{marginTop:0,background:"#fff",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0"},size:"small",hoverable:!1,children:[I?(0,j.jsx)("div",{style:{textAlign:"center",padding:24},children:(0,j.jsx)(p.A,{})}):b&&0!==b.length?(0,j.jsx)(Jt.A,{size:"small",pagination:{pageSize:6},dataSource:b,rowKey:e=>e._id,columns:[{title:"Resident",key:"resident",render:(e,t)=>(0,j.jsx)("span",{style:{fontWeight:600},children:t.userId&&(t.userId.fullName||t.userId.username)||"Unknown Resident"})},{title:"Status",dataIndex:"status",key:"status",render:e=>(0,j.jsx)("span",{style:{color:"approved"===e?"#167d3b":"#d48806",fontWeight:600},children:e||"pending"})},{title:"Submitted",dataIndex:"createdAt",key:"createdAt",render:e=>(0,j.jsx)("span",{style:{color:"#888"},children:e?new Date(e).toLocaleString():"-"})},{title:"Verified",dataIndex:"approvedAt",key:"approvedAt",render:e=>(0,j.jsx)("span",{style:{color:"#888"},children:e?new Date(e).toLocaleString():"-"})},{title:"Files",key:"files",render:(e,t)=>{const n=Array.isArray(t.filesMeta)&&t.filesMeta.length?t.filesMeta:Array.isArray(t.gridFileIds)?t.gridFileIds.map(e=>({filename:e,gridFileId:e})):[];return(0,j.jsx)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:n.map((e,t)=>(0,j.jsx)("a",{href:(0,A.getAbsoluteApiUrl)("/verification/file/".concat(e.gridFileId||e.filename)),target:"_blank",rel:"noreferrer",children:e.fileType?"".concat(e.fileType):"Open"},t))})}},{title:"Action",key:"action",render:(e,t)=>(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(u.Ay,{size:"small",onClick:()=>(T(t),void k(!0)),children:"Check ID"}),"approved"===t.status?(0,j.jsx)(u.Ay,{size:"small",onClick:()=>(async e=>{try{if(S(!0),e&&"object"===typeof e){var t;const a=e._id,s=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;try{a&&await A.verificationAPI.unapproveRequest(a)}catch(n){}s&&await A.verificationAPI.verifyUser(s,!1),await q()}else"string"===typeof e&&(await A.verificationAPI.verifyUser(e,!1),await q())}catch(a){console.error("Failed to unverify user",a)}finally{S(!1)}})(t),children:"Unverify"}):(0,j.jsx)(u.Ay,{type:"primary",size:"small",onClick:()=>(async e=>{try{if(S(!0),e&&"object"===typeof e){var t;const a=e._id,s=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;try{await A.verificationAPI.approveRequest(a)}catch(n){}s&&await A.verificationAPI.verifyUser(s,!0),await q()}else"string"===typeof e&&await A.verificationAPI.verifyUser(e,!0)}catch(a){console.error("Failed to verify user",a)}finally{S(!1)}})(t),children:"Verify"}),"approved"===t.status?null:(0,j.jsx)(u.Ay,{danger:!0,size:"small",onClick:()=>(async e=>{try{if(S(!0),e&&"object"===typeof e){var t;const a=e._id,s=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;try{await A.verificationAPI.rejectRequest(a)}catch(n){}s&&await A.verificationAPI.verifyUser(s,!1)}else"string"===typeof e&&await A.verificationAPI.verifyUser(e,!1);await q()}catch(a){console.error("Failed to reject verification",a)}finally{S(!1)}})(t),children:"Reject"})]})}]}):(0,j.jsx)(rn.A,{description:"No verification requests"}),(0,j.jsx)(u.Ay,{type:"link",style:{marginTop:12},onClick:()=>e("/admin/verification-requests"),children:"View all"}),(0,j.jsx)(fe.A,{title:"Verification Files",open:C,onCancel:()=>k(!1),footer:null,width:840,children:N?(0,j.jsxs)("div",{children:[(0,j.jsxs)("p",{children:[(0,j.jsx)("strong",{children:"Resident:"})," ",N.userId&&(N.userId.fullName||N.userId.username)||"Unknown"]}),(0,j.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:(N.filesMeta&&N.filesMeta.length?N.filesMeta:(N.gridFileIds||[]).map(e=>({filename:e,gridFileId:e}))).map((e,t)=>{const n=e.gridFileId||e.filename,a=(0,A.getAbsoluteApiUrl)("/verification/file/".concat(n)),s=e.fileType?e.fileType.charAt(0).toUpperCase()+e.fileType.slice(1):e.filename||"File";return(0,j.jsxs)("div",{style:{border:"1px solid #f0f0f0",padding:12,borderRadius:8,background:"#fff"},children:[(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,j.jsx)("div",{style:{fontWeight:600},children:s}),(0,j.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,j.jsx)("a",{href:a,target:"_blank",rel:"noreferrer",children:"Open"}),(0,j.jsx)("a",{href:a,download:!0,children:"Download"})]})]}),(0,j.jsxs)("div",{style:{textAlign:"center"},children:[(0,j.jsx)("img",{src:a,alt:s,style:{maxWidth:"100%",maxHeight:360},onError:e=>{e.currentTarget.style.display="none"}}),(0,j.jsx)("div",{style:{marginTop:8,color:"#666",fontSize:13},children:e.filename||n})]})]},t)})})]}):(0,j.jsx)(rn.A,{description:"No files"})})]})})})]})})};var kn=n(54826),Nn=n(95436),Tn=n(68689),Dn=n(90582),Pn=n(52842),_n=n(39535),Rn=n(179),Un=n(4159),Bn=n.n(Un);const qn=[{text:"Admin",value:"admin"},{text:"Staff",value:"staff"},{text:"Resident",value:"resident"}],Ln=[{text:"Active",value:!0},{text:"Inactive",value:!1}],On=()=>{const[e,t]=(0,s.useState)([]),[m,x]=(0,s.useState)(""),[g,y]=(0,s.useState)(void 0),[v,w]=(0,s.useState)(void 0),[I,S]=(0,s.useState)(null),[C,k]=(0,s.useState)(1),[N,T]=(0,s.useState)(10),[D,P]=(0,s.useState)([]),[_,R]=(0,s.useState)(!1),[U,B]=(0,s.useState)(null),[q,L]=(0,s.useState)(null),[O,F]=(0,s.useState)(!1),[E,z]=(0,s.useState)(!1),[M,W]=(0,s.useState)(!1),[Y,V]=(0,s.useState)({}),[H,G]=(0,s.useState)(!1),[K,J]=(0,s.useState)(0),[Q,ee]=(0,s.useState)(null),te=s.useRef(null),[ne,ae]=(0,s.useState)(!0),[se,ie]=(0,s.useState)({}),re=()=>{ae(!0),A.adminAPI.getUsers().then(e=>{t(e.map((e,t)=>({key:e._id||t,_id:e._id||null,fullName:e.fullName||e.username||"",email:e.email,role:e.role,isActive:e.isActive,verified:!!e.verified,createdAt:e.createdAt,lastLogin:e.lastLogin,avatar:e.avatar||null,barangayId:e.barangayId||e.barangayID||e.barangay_id||null})))}).catch(()=>t([])).finally(()=>ae(!1))};(0,s.useEffect)(()=>{re()},[]);const le=async(e,t)=>{if(e)try{i.Ay.loading({content:"Disabling user...",key:"disable"});const n=t?{suspendedUntil:t}:{},a=await A.adminAPI.disableUser(e,n);i.Ay.success({content:"User disabled",key:"disable",duration:2}),await re(),U&&U._id===e&&B(a.user||a)}catch(n){console.error("Failed to disable user",n),i.Ay.error("Failed to disable user")}},oe=async e=>{if(e)try{i.Ay.loading({content:"Enabling user...",key:"enable"});const t=await A.adminAPI.enableUser(e);i.Ay.success({content:"User enabled",key:"enable",duration:2}),await re(),U&&U._id===e&&B(t.user||t)}catch(t){console.error("Failed to enable user",t),i.Ay.error("Failed to enable user")}},de=async e=>{if(e)try{i.Ay.loading({content:"Demoting user...",key:"demote"});const t=await A.adminAPI.demoteUser(e);i.Ay.success({content:"User demoted to resident",key:"demote",duration:2}),await re(),U&&U._id===e&&B(t.user||t)}catch(t){console.error("Failed to demote user",t),i.Ay.error("Failed to demote user")}},ce=e.filter(e=>{const t=e.fullName.toLowerCase().includes(m.toLowerCase())||e.email.toLowerCase().includes(m.toLowerCase()),n=!g||e.role===g,a=void 0===v||e.isActive===v,s=!I||2!==I.length||Bn()(e.createdAt).isAfter(I[0],"day")&&Bn()(e.createdAt).isBefore(I[1],"day");return t&&n&&a&&s}),ue=[{title:"Name",dataIndex:"fullName",key:"fullName",render:(e,t)=>(0,j.jsxs)(Oe.A,{children:[(()=>{let n=t;try{const e=localStorage.getItem("userProfile");e&&(n=JSON.parse(e))}catch(a){}return(0,j.jsx)(b,{style:{backgroundColor:"#1890ff",verticalAlign:"middle"},src:t.avatar,user:n,size:36,children:e&&e.length>0?e.charAt(0).toUpperCase():"?"})})(),(0,j.jsx)("b",{children:e})]}),sorter:(e,t)=>e.fullName.localeCompare(t.fullName),sortDirections:["ascend","descend"],fixed:"left"},{title:"Barangay ID",dataIndex:"barangayId",key:"barangayId",render:e=>e||"\u2014",width:160},{title:"Email",dataIndex:"email",key:"email",sorter:(e,t)=>e.email.localeCompare(t.email),sortDirections:["ascend","descend"]},{title:"Role",dataIndex:"role",key:"role",render:e=>{const t=e||"";return(0,j.jsx)(f.A,{color:"admin"===t?"magenta":"staff"===t?"blue":"green",children:t?t.charAt(0).toUpperCase()+t.slice(1):""})},filters:qn,onFilter:(e,t)=>t.role===e},{title:"Status",dataIndex:"isActive",key:"isActive",render:e=>(0,j.jsx)(f.A,{color:e?"green":"red",children:e?"Active":"Inactive"}),filters:Ln,onFilter:(e,t)=>t.isActive===e},{title:"Created",dataIndex:"createdAt",key:"createdAt",render:e=>Bn()(e).format("YYYY-MM-DD"),sorter:(e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime(),sortDirections:["ascend","descend"]},{title:"Actions",key:"actions",fixed:"right",render:(e,t)=>(0,j.jsx)(Fe.A,{popupRender:()=>(0,j.jsxs)(Le.A,{children:[(0,j.jsx)(Le.A.Item,{icon:(0,j.jsx)(Dn.A,{}),onClick:()=>{B(t),R(!0)},children:"Edit"},"edit"),(0,j.jsx)(Le.A.Item,{icon:(0,j.jsx)($.A,{}),onClick:()=>{},children:"View Logs"},"logs"),(0,j.jsx)(Le.A.Item,{icon:(0,j.jsx)(Pn.A,{}),onClick:()=>{},children:"Deactivate"},"deactivate"),(0,j.jsx)(Le.A.Item,{icon:(0,j.jsx)(Ie.A,{}),onClick:async()=>{if(!t||!t._id)return void i.Ay.error("No user selected");const e=t.verified?"Mark ".concat(t.fullName||t.email," as unverified?"):"Mark ".concat(t.fullName||t.email," as verified?");fe.A.confirm({title:t.verified?"Unverify user":"Verify user",content:e,onOk:async()=>{await(async(e,t)=>{if(e)try{const s=t?"Unverify":"Mark as Verified";i.Ay.loading({content:"".concat(s,"..."),key:"verify"}),await(await Promise.resolve().then(n.bind(n,51496))).verificationAPI.verifyUser(e,!t),i.Ay.success({content:"".concat(s," succeeded"),key:"verify",duration:2}),await re(),U&&U._id===e&&B(e=>e?(0,a.A)((0,a.A)({},e),{},{verified:!t}):e)}catch(s){console.error("Failed to toggle verified",s),i.Ay.error("Failed to update verification status")}})(t._id,!!t.verified)}})},children:t.verified?"Unverify":"Verify"},"toggleVerified"),(0,j.jsx)(Le.A.Item,{icon:(0,j.jsx)(Pn.A,{}),onClick:async()=>{t&&t._id?fe.A.confirm({title:"Disable user",content:"Are you sure you want to disable ".concat(t.fullName||t.email||t._id,"?"),onOk:async()=>{await le(t._id)}}):i.Ay.error("No user selected")},children:"Disable"},"disable_now"),"staff"===t.role&&(0,j.jsx)(Le.A.Item,{icon:(0,j.jsx)(_n.A,{}),onClick:async()=>{t&&t._id?fe.A.confirm({title:"Demote user",content:"Are you sure you want to demote ".concat(t.fullName||t.email||t._id," to resident?"),onOk:async()=>{await de(t._id)}}):i.Ay.error("No user selected")},children:"Demote to Resident"},"demote"),(0,j.jsx)(Le.A.Item,{icon:(0,j.jsx)(Ie.A,{}),onClick:async()=>{t&&t._id?fe.A.confirm({title:"Enable user",content:"Are you sure you want to enable ".concat(t.fullName||t.email||t._id,"?"),onOk:async()=>{await oe(t._id)}}):i.Ay.error("No user selected")},children:"Enable"},"enable_now"),(0,j.jsx)(Le.A.Item,{icon:(0,j.jsx)(X.A,{}),danger:!0,onClick:()=>{},children:"Delete"},"delete")]}),trigger:["click"],children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(Rn.A,{}),size:"small"})})}],he=D.length>0&&(0,j.jsxs)(Oe.A,{style:{marginBottom:16},children:[(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(Ie.A,{}),onClick:()=>{},children:"Activate"}),(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(Pn.A,{}),onClick:()=>{},children:"Deactivate"}),(0,j.jsx)(kn.A,{title:"Are you sure to delete selected users?",onConfirm:()=>{},okText:"Yes",cancelText:"No",children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(X.A,{}),danger:!0,children:"Delete"})}),(0,j.jsx)("span",{style:{marginLeft:8},children:"Selected ".concat(D.length," users")})]}),me=(C-1)*N+1,pe=Math.min(C*N,ce.length);return(0,j.jsxs)("div",{children:[(0,j.jsx)(r.A,{style:{marginBottom:16,borderRadius:8,background:"#fff"},styles:{body:{padding:0}},bordered:!1,title:(0,j.jsxs)(l.A,{align:"middle",justify:"space-between",children:[(0,j.jsxs)(o.A,{children:[(0,j.jsx)(h.A.Title,{level:4,style:{margin:0},children:"User Management"}),(0,j.jsxs)(Nn.A,{children:[(0,j.jsx)(Nn.A.Item,{children:"Admin"}),(0,j.jsx)(Nn.A.Item,{children:"User Management"})]})]}),(0,j.jsx)(o.A,{children:(0,j.jsx)(Oe.A,{})})]})}),(0,j.jsxs)(r.A,{style:{borderRadius:16,boxShadow:"0 2px 16px #40c9ff11"},children:[(0,j.jsxs)(l.A,{gutter:16,style:{marginBottom:16},align:"middle",children:[(0,j.jsx)(o.A,{children:(0,j.jsx)(c.A.Search,{placeholder:"Search by name or email",value:m,onChange:e=>x(e.target.value),allowClear:!0,style:{width:200}})}),(0,j.jsx)(o.A,{children:(0,j.jsx)(d.A,{placeholder:"Role",allowClear:!0,style:{width:120},value:g,onChange:y,options:qn})}),(0,j.jsx)(o.A,{children:(0,j.jsx)(d.A,{placeholder:"Status",allowClear:!0,style:{width:120},value:v,onChange:w,options:Ln})}),(0,j.jsx)(o.A,{children:(0,j.jsx)(Tn.A.RangePicker,{value:I,onChange:S,style:{width:220},allowClear:!0})}),(0,j.jsx)(o.A,{children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(_n.A,{}),onClick:()=>{x(""),y(void 0),w(void 0),S(null)},children:"Reset Filters"})})]}),he,ne?(0,j.jsx)(p.A,{size:"large"}):(0,j.jsx)(Jt.A,{columns:ue,dataSource:ce,rowSelection:{selectedRowKeys:D,onChange:P},pagination:{pageSize:N,current:C,onChange:k,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onShowSizeChange:(e,t)=>T(t),showTotal:e=>"Showing ".concat(me,"\u2013").concat(pe," of ").concat(e," users")},onRow:e=>({onClick:()=>{B(e),R(!0),(async e=>{if(e){F(!0);try{const t=e.barangayId||e.barangayID||e.barangay_id;if(t){const e=await A.adminAPI.getResidentByBarangayID(t);L((null===e||void 0===e?void 0:e.resident)||null)}else if(e._id){const t=await A.adminAPI.getUserWithResident(e._id);L((null===t||void 0===t?void 0:t.resident)||null)}else L(null)}catch(t){console.error("Failed to fetch resident for user",t),L(null)}finally{F(!1)}}})(e)}}),style:{cursor:"pointer"},scroll:{x:"max-content"},sticky:!0})]}),(0,j.jsx)(ln.A,{title:U?U.fullName:"User Profile",open:_,onClose:()=>R(!1),width:400,children:U&&(0,j.jsxs)(Oe.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,j.jsxs)(l.A,{align:"middle",gutter:16,children:[(0,j.jsx)(o.A,{children:(()=>{let e=U;try{const t=localStorage.getItem("userProfile");t&&(e=JSON.parse(t))}catch(n){}const t=q&&(q.profileImage||q.profileImageId)?q.profileImage?q.profileImage:(0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(q.profileImageId)):U.avatar||null;return(0,j.jsx)(b,{size:64,style:{backgroundColor:"#1890ff"},src:t,user:e,children:U.fullName&&U.fullName.length>0?U.fullName.charAt(0).toUpperCase():"?"})})()}),(0,j.jsxs)(o.A,{children:[(0,j.jsx)(h.A.Title,{level:5,style:{margin:0},children:U.fullName}),(0,j.jsxs)("div",{style:{marginTop:4},children:[(0,j.jsx)(f.A,{color:U.isActive?"green":"red",style:{marginRight:8},children:U.isActive?"Active":"Inactive"}),(0,j.jsx)(f.A,{color:U.verified?"green":"default",style:{marginRight:8},children:U.verified?"Verified":"Unverified"}),(0,j.jsx)(f.A,{color:"admin"===U.role?"magenta":"staff"===U.role?"blue":"green",children:U.role?U.role.charAt(0).toUpperCase()+U.role.slice(1):""})]}),U.barangayId&&(0,j.jsxs)("div",{style:{marginTop:8},children:[(0,j.jsx)(h.A.Text,{type:"secondary",children:"Barangay ID: "}),(0,j.jsx)(h.A.Text,{copyable:!0,children:U.barangayId})]})]})]}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Email:"}),(0,j.jsx)(h.A.Text,{children:U.email}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Resident Information"}),O?(0,j.jsx)(p.A,{}):q?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(h.A.Title,{level:5,children:"Personal Information"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Full Name:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:"".concat(q.firstName||""," ").concat(q.middleName||""," ").concat(q.lastName||"").trim()||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Barangay ID:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.barangayID||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Username:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.username||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Email:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.email||U.email||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Phone:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.contactNumber||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Landline:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.landlineNumber||"N/A"})]}),(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Address:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.address||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"DOB:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.birthDate?Bn()(q.birthDate).format("YYYY-MM-DD"):q.birthDate||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Sex/Gender:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.sex||q.gender||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Civil/Marital Status:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.civilStatus||q.maritalStatus||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Nationality:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.nationality||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Occupation:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.occupation||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Education:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.educationalAttainment||"N/A"})]})]}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Identification"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Passport #:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.passportNumber||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Gov ID #:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.governmentIdNumber||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"TIN:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.tin||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Barangay Clearance #:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.barangayClearanceNumber||"N/A"})]})]}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Family"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Spouse:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.spouseName?"".concat(q.spouseName," ").concat(q.spouseLastName||""):"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Number of Children:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.numberOfChildren||0===q.numberOfChildren?q.numberOfChildren:"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Children Names/Ages:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.childrenNames?"".concat(q.childrenNames," (").concat(q.childrenAges||"",")"):"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Mother:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.motherName||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Father:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.fatherName||"N/A"})]})]}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Emergency Contact"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Contact Name:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.emergencyContactName||q.emergencyContact||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Relationship:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.emergencyContactRelationship||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Emergency Phone:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.emergencyContact||q.spouseContactNumber||"N/A"})]})]}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Business / Employment"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Business Name:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.businessName||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Business Type:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.businessType||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Business Contact:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.businessContactNumber||"N/A"})]}),(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Business Address:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.businessAddress||"N/A"})]})]}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Other"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Blood Type:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.bloodType||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Disability Status:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.disabilityStatus||"N/A"})]})]}),(0,j.jsxs)(l.A,{style:{marginTop:12},gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Created At:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.createdAt?Bn()(q.createdAt).format("YYYY-MM-DD HH:mm"):"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Last Login:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:U.lastLogin?Bn()(U.lastLogin).format("YYYY-MM-DD HH:mm"):"N/A"})]})]}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Social Media / Links"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Facebook:"}),q.facebook?(0,j.jsx)(h.A.Text,{style:{display:"block"},children:(0,j.jsx)("a",{href:q.facebook,target:"_blank",rel:"noreferrer",children:q.facebook})}):(0,j.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Instagram:"}),q.instagram?(0,j.jsx)(h.A.Text,{style:{display:"block"},children:(0,j.jsx)("a",{href:q.instagram,target:"_blank",rel:"noreferrer",children:q.instagram})}):(0,j.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Other Link:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.website||"N/A"})]})]})]}):(0,j.jsx)(h.A.Text,{type:"warning",children:"This resident doesn't have resident info yet."}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Social Media"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Facebook:"}),U.facebook?(0,j.jsx)(h.A.Text,{style:{display:"block"},children:(0,j.jsx)("a",{href:U.facebook,target:"_blank",rel:"noreferrer",children:U.facebook})}):(0,j.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Twitter:"}),U.twitter?(0,j.jsx)(h.A.Text,{style:{display:"block"},children:(0,j.jsx)("a",{href:U.twitter,target:"_blank",rel:"noreferrer",children:U.twitter})}):(0,j.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Instagram:"}),U.instagram?(0,j.jsx)(h.A.Text,{style:{display:"block"},children:(0,j.jsx)("a",{href:U.instagram,target:"_blank",rel:"noreferrer",children:U.instagram})}):(0,j.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]})]}),(0,j.jsxs)("div",{style:{marginTop:16,display:"flex",flexDirection:"column",gap:8},children:[(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(Dn.A,{}),onClick:()=>{V(U||{}),W(!0)},children:"Edit User"}),(0,j.jsx)(u.Ay,{onClick:()=>{q?(ie(q||{}),z(!0)):i.Ay.warning("No resident data to edit")},children:"Edit Resident"})]}),(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(u.Ay,{icon:(0,j.jsx)($.A,{}),onClick:()=>{},children:"View Logs"}),U&&"staff"===U.role&&(0,j.jsx)(kn.A,{title:"Demote ".concat(U.fullName||U.email,"?"),onConfirm:async()=>{U&&await de(U._id)},okText:"Yes",cancelText:"No",children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(_n.A,{}),children:"Demote"})}),U&&U.isActive?(0,j.jsx)(kn.A,{title:"Disable ".concat(U.fullName||U.email,"?"),onConfirm:async()=>{await le(U._id)},okText:"Yes",cancelText:"No",children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(Pn.A,{}),danger:!0,children:"Deactivate"})}):(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(Ie.A,{}),onClick:async()=>{U&&await oe(U._id)},children:"Enable"})]})]})]})}),(0,j.jsx)(fe.A,{title:"Edit Resident",open:E,onCancel:()=>z(!1),onOk:async()=>{if(q)try{const e=(0,a.A)((0,a.A)({},q),se),t=await A.adminAPI.updateResident(q._id,e);i.Ay.success("Resident updated"),L((null===t||void 0===t?void 0:t.resident)||(0,a.A)((0,a.A)({},q),e)),z(!1)}catch(e){console.error("Failed to save resident",e),i.Ay.error("Failed to update resident.")}},width:900,children:(0,j.jsx)(mt.A,{layout:"vertical",initialValues:(0,a.A)((0,a.A)({},q||{}),{},{barangayID:(null===q||void 0===q?void 0:q.barangayID)||(null===U||void 0===U?void 0:U.barangayId)}),onValuesChange:(e,t)=>ie(t),children:(0,j.jsxs)(ge.A,{defaultActiveKey:"personal",children:[(0,j.jsxs)(ge.A.TabPane,{tab:"Personal",children:[(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"firstName",label:"First Name",rules:[{required:!0,message:"First name is required"}],children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"middleName",label:"Middle Name",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"lastName",label:"Last Name",rules:[{required:!0,message:"Last name is required"}],children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"username",label:"Username",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"barangayID",label:"Barangay ID",rules:[{required:!0,message:"Barangay ID is required"}],children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Enter a valid email"}],children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"contactNumber",label:"Contact Number",rules:[{pattern:/^[0-9+\-() ]{6,20}$/,message:"Enter a valid phone number"}],children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"landlineNumber",label:"Landline",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"address",label:"Address",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"birthDate",label:"Birth Date",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"placeOfBirth",label:"Place of Birth",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"age",label:"Age",children:(0,j.jsx)(c.A,{type:"number"})})})]})]},"personal"),(0,j.jsxs)(ge.A.TabPane,{tab:"IDs",children:[(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"passportNumber",label:"Passport #",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"governmentIdNumber",label:"Government ID #",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"tin",label:"TIN",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"bloodType",label:"Blood Type",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"disabilityStatus",label:"Disability Status",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"educationalAttainment",label:"Education",children:(0,j.jsx)(c.A,{})})})]})]},"ids"),(0,j.jsxs)(ge.A.TabPane,{tab:"Family",children:[(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"spouseName",label:"Spouse Name",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"spouseMiddleName",label:"Spouse Middle",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"spouseLastName",label:"Spouse Last",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"spouseAge",label:"Spouse Age",children:(0,j.jsx)(c.A,{type:"number"})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"spouseBirthDate",label:"Spouse DOB",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"spouseOccupation",label:"Spouse Occupation",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"numberOfChildren",label:"# Children",children:(0,j.jsx)(c.A,{type:"number"})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"childrenNames",label:"Children Names",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"childrenAges",label:"Children Ages",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(mt.A.Item,{name:"motherName",label:"Mother's Name",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(mt.A.Item,{name:"fatherName",label:"Father's Name",children:(0,j.jsx)(c.A,{})})})]})]},"family"),(0,j.jsxs)(ge.A.TabPane,{tab:"Business",children:[(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(mt.A.Item,{name:"businessName",label:"Business Name",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(mt.A.Item,{name:"businessType",label:"Business Type",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(mt.A.Item,{name:"businessContactNumber",label:"Business Contact",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(mt.A.Item,{name:"businessEmail",label:"Business Email",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsx)(l.A,{gutter:8,children:(0,j.jsx)(o.A,{span:24,children:(0,j.jsx)(mt.A.Item,{name:"businessAddress",label:"Business Address",children:(0,j.jsx)(c.A,{})})})}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"registrationNumber",label:"Registration #",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"businessPermitNumber",label:"Business Permit #",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(mt.A.Item,{name:"barangayClearanceNumber",label:"Barangay Clearance #",children:(0,j.jsx)(c.A,{})})})]})]},"business"),(0,j.jsx)(ge.A.TabPane,{tab:"Avatar / Media",children:(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsxs)(mt.A.Item,{label:"Upload Profile Image",children:[(0,j.jsx)(Z.A,{accept:"image/*",showUploadList:!1,beforeUpload:()=>!1,customRequest:e=>{if(!q)return;const t=e.file;G(!0),J(10);const n=(async()=>{try{J(30);const e=await A.adminAPI.uploadResidentAvatar(q._id,t);return J(80),null!==e&&void 0!==e&&e.resident?(L(e.resident),ie(t=>(0,a.A)((0,a.A)({},t),{},{profileImage:e.resident.profileImage,profileImageId:e.resident.profileImageId})),ee(e.resident.profileImage||"".concat((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.fileId)),"?t=").concat(Date.now()))):null!==e&&void 0!==e&&e.fileId&&(ie(t=>(0,a.A)((0,a.A)({},t),{},{profileImage:(0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.fileId)),profileImageId:e.fileId})),ee("".concat((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.fileId)),"?t=").concat(Date.now()))),J(100),i.Ay.success("Avatar uploaded"),e}catch(e){throw console.error("Avatar upload failed",e),i.Ay.error((null===e||void 0===e?void 0:e.message)||"Avatar upload failed"),e}finally{G(!1)}})();return te.current=n,n},children:(0,j.jsx)(u.Ay,{type:"default",children:"Choose Image"})}),H&&(0,j.jsxs)("div",{style:{marginTop:8},children:["Uploading: ",K,"%"]}),Q&&(0,j.jsx)("div",{style:{marginTop:8},children:(0,j.jsx)("img",{src:"string"!==typeof Q||Q.startsWith("http")?Q:(0,A.getAbsoluteApiUrl)(Q),alt:"preview",style:{maxWidth:120,maxHeight:120,borderRadius:6}})})]})}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(mt.A.Item,{name:"profileImage",label:"Profile Image URL",children:(0,j.jsx)(c.A,{})}),(0,j.jsx)(mt.A.Item,{name:"profileImageId",label:"Profile Image ID",children:(0,j.jsx)(c.A,{})})]})]})},"media")]})})}),(0,j.jsx)(fe.A,{title:"Edit User",open:M,onCancel:()=>W(!1),onOk:async()=>{try{const n=(0,a.A)({},Y);delete n.barangayId,delete n.role,await A.adminAPI.updateUser(U._id,n),i.Ay.success("User updated");const s=e.map(e=>e._id===U._id?(0,a.A)((0,a.A)({},e),n):e);t(s),B(e=>e?(0,a.A)((0,a.A)({},e),n):e),W(!1)}catch(n){console.error("Failed to update user",n),i.Ay.error("Failed to update user")}},width:600,children:(0,j.jsxs)(mt.A,{layout:"vertical",initialValues:Y,onValuesChange:(e,t)=>V(t),children:[(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(mt.A.Item,{name:"fullName",label:"Full Name",rules:[{required:!0,message:"Full name required"}],children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(mt.A.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Enter a valid email"}],children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(mt.A.Item,{name:"isActive",label:"Active",children:(0,j.jsx)(d.A,{options:[{label:"Active",value:!0},{label:"Inactive",value:!1}]})})}),(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(mt.A.Item,{label:"Role",children:(0,j.jsx)(c.A,{value:null===U||void 0===U?void 0:U.role,disabled:!0})})})]}),(0,j.jsx)(l.A,{gutter:8,children:(0,j.jsx)(o.A,{span:24,children:(0,j.jsx)(mt.A.Item,{label:"Barangay ID",children:(0,j.jsx)(c.A,{value:(null===U||void 0===U?void 0:U.barangayId)||(null===U||void 0===U?void 0:U.barangayID)||"",disabled:!0})})})})]})})]})},Fn=()=>(0,j.jsxs)("div",{style:{padding:20},children:[(0,j.jsx)("h3",{children:"Activity Logs Disabled"}),(0,j.jsx)("p",{children:"The Activity Logs feature has been temporarily disabled in the system."})]});var En=n(57895),zn=n(16895),Mn=n(15480),Wn=n(73022),Yn=n(87901),Vn=n(79682),Hn=n(15441),Gn=n(58179),Kn=n(58484),Jn=n(75641),Zn=n(42730),$n=n(18795);const{RangePicker:Qn}=Tn.A,{Option:Xn}=d.A,ea={gender:{title:"Sex Distribution",chartType:"pie",endpoint:"/analytics/gender",colors:["#1890ff","#00bcd4","#888888"]},age:{title:"Age Groups",chartType:"bar",endpoint:"/analytics/age",colors:["#1890ff"]},"civil-status":{title:"Civil Status",chartType:"bar",endpoint:"/analytics/civil-status",colors:["#1890ff"]},education:{title:"Education",chartType:"bar",endpoint:"/analytics/education",colors:["#13c2c2"]},"documents-monthly":{title:"Monthly Document Requests",chartType:"line",endpoint:"/analytics/documents-monthly",colors:["#722ed1"]}},ta=Object.keys(ea),na=new Yn.E({defaultOptions:{queries:{retry:2,staleTime:6e4,refetchOnWindowFocus:!1}}}),aa=()=>{var e,t,c,p,x;const[g,f]=(0,s.useState)(!0),[y,v]=(0,s.useState)(null),[b,w]=(0,s.useState)({}),[I,S]=(0,s.useState)({}),[C,k]=(0,s.useState)({dateRange:[],residentType:""}),[N,T]=(0,s.useState)(["gender","age","occupation","education","civil-status"]),[D,P]=(0,s.useState)(!1),_=(0,s.useRef)(null),[R,U]=(0,s.useState)(!1),[B,q]=(0,s.useState)(()=>{try{const e=localStorage.getItem("statsChartSettings");return e?JSON.parse(e):{}}catch(e){return{}}}),[L,O]=(0,s.useState)("gender"),[F,E]=(0,s.useState)(!1),[z,M]=(0,s.useState)(N),W=(0,s.useCallback)(async()=>{f(!0);try{var e,t,n,a,s,i;const r=await A.axiosInstance.get("/analytics/summary",{params:{startDate:null===(e=C.dateRange)||void 0===e||null===(t=e[0])||void 0===t||null===(n=t.format)||void 0===n?void 0:n.call(t,"YYYY-MM-DD"),endDate:null===(a=C.dateRange)||void 0===a||null===(s=a[1])||void 0===s||null===(i=s.format)||void 0===i?void 0:i.call(s,"YYYY-MM-DD"),residentType:C.residentType}});v(r.data||null)}catch(r){v(null)}finally{f(!1)}},[C]);(0,s.useEffect)(()=>{W()},[W]);const Y=(0,s.useCallback)(async e=>{const t=ea[e];if(t){S(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!0}));try{var n,s,i,r,l,o,d,c,u,h,m,p,x;const g=B[e]||{},f=(null===(n=g.dateRange)||void 0===n||null===(s=n[0])||void 0===s||null===(i=s.format)||void 0===i?void 0:i.call(s,"YYYY-MM-DD"))||(null===(r=C.dateRange)||void 0===r||null===(l=r[0])||void 0===l||null===(o=l.format)||void 0===o?void 0:o.call(l,"YYYY-MM-DD")),y=(null===(d=g.dateRange)||void 0===d||null===(c=d[1])||void 0===c||null===(u=c.format)||void 0===u?void 0:u.call(c,"YYYY-MM-DD"))||(null===(h=C.dateRange)||void 0===h||null===(m=h[1])||void 0===m||null===(p=m.format)||void 0===p?void 0:p.call(m,"YYYY-MM-DD"));let j=(null===(x=(await A.axiosInstance.get(t.endpoint,{params:{startDate:f,endDate:y}})).data)||void 0===x?void 0:x.data)||[];"gender"===e&&(j=j.map(e=>{var t,n,a;return{type:null!==(t=null!==(n=e.name)&&void 0!==n?n:e.type)&&void 0!==t?t:"N/A",value:null!==(a=e.value)&&void 0!==a?a:0}})),w(t=>(0,a.A)((0,a.A)({},t),{},{[e]:j}))}catch(g){console.error("Error fetching chart",e,g),w(t=>(0,a.A)((0,a.A)({},t),{},{[e]:[]}))}finally{S(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!1}))}}},[C,B]);(0,s.useEffect)(()=>{try{localStorage.setItem("statsChartSettings",JSON.stringify(B))}catch(e){}},[B]);const V=null!==(e=null===y||void 0===y?void 0:y.totalResidents)&&void 0!==e?e:0,H=null!==(t=null===y||void 0===y?void 0:y.totalDocumentRequests)&&void 0!==t?t:0,G=b.age||[],K=G&&G.length?Math.max(...G.map(e=>Number(e.value)||0)):0,J=5*Math.ceil(K/5)||5,Z=b["documents-monthly"]||[],$=e=>{var t,n,a;let{id:s,title:i,chartType:l,data:o=[],loading:d,colors:c}=e;const u=Array.isArray(o)&&o.length>0,h=s&&B[s]||{},m=h.chartType||l,p=null===(t=h.showLabels)||void 0===t||t,x=null===(n=h.showTooltips)||void 0===n||n,g=null===(a=h.showLegend)||void 0===a||a;return(0,j.jsx)(r.A,{title:i,style:{borderRadius:12,boxShadow:"0 8px 24px rgba(15,15,15,0.06)"},styles:{body:{padding:16}},children:d?(0,j.jsx)(En.A,{active:!0}):u?"pie"===m?(0,j.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(()=>{const e=(o||[]).map(e=>{var t,n,a,s,i,r;return{label:(null!==(t=null!==(n=null!==(a=null!==(s=null===e||void 0===e?void 0:e.type)&&void 0!==s?s:null===e||void 0===e?void 0:e.name)&&void 0!==a?a:null===e||void 0===e?void 0:e.group)&&void 0!==n?n:null===e||void 0===e?void 0:e._id)&&void 0!==t?t:"Unknown").toString().trim(),valueNumber:Number(null!==(i=null!==(r=null===e||void 0===e?void 0:e.value)&&void 0!==r?r:null===e||void 0===e?void 0:e.count)&&void 0!==i?i:0)}});return(0,j.jsx)(Gn.A,{data:e,angleField:"valueNumber",colorField:"label",radius:.9,label:!!p&&{formatter:e=>{var t,n,a,s,i;const r=(null===e||void 0===e?void 0:e.data)||e||{},l=null!==(t=null!==(n=null===r||void 0===r?void 0:r.label)&&void 0!==n?n:null===r||void 0===r?void 0:r.type)&&void 0!==t?t:"Unknown",o=Number(null!==(a=null!==(s=null!==(i=null===r||void 0===r?void 0:r.valueNumber)&&void 0!==i?i:null===r||void 0===r?void 0:r.value)&&void 0!==s?s:null===r||void 0===r?void 0:r.count)&&void 0!==a?a:0)||0;return"".concat(l," (").concat(o,")")}},tooltip:!!x&&{formatter:e=>{var t,n,a,s,i;const r=(null===e||void 0===e?void 0:e.data)||e||{};return{name:null!==(t=null!==(n=null===r||void 0===r?void 0:r.label)&&void 0!==n?n:null===r||void 0===r?void 0:r.type)&&void 0!==t?t:"Unknown",value:Number(null!==(a=null!==(s=null!==(i=null===r||void 0===r?void 0:r.valueNumber)&&void 0!==i?i:null===r||void 0===r?void 0:r.value)&&void 0!==s?s:null===r||void 0===r?void 0:r.count)&&void 0!==a?a:0)||0}}},color:c,statistic:{title:{formatter:()=>i},content:{formatter:()=>"".concat((e||[]).reduce((e,t)=>e+(Number(t.valueNumber)||0),0)," total")}},legend:!!g&&{position:"bottom",formatter:t=>{const n=(e||[]).find(e=>e.label===t),a=n?Number(n.valueNumber||0):0;return"".concat(t," (").concat(a,")")}},height:220})})()}):"bar"===m?(0,j.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(0,j.jsx)(Kn.A,{data:o,xField:"type",yField:"value",color:c&&c[0],label:!!p&&void 0,legend:!!g&&void 0,tooltip:!!x&&void 0,yAxis:{min:0,max:J,tickInterval:5},height:220})}):"line"===m?(0,j.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(0,j.jsx)(Jn.A,{data:o,xField:"type",yField:"value",legend:!!g&&void 0,tooltip:!!x&&void 0,height:220})}):(0,j.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(0,j.jsx)(Zn.A,{data:o,xField:"type",yField:"value",legend:!!g&&void 0,tooltip:!!x&&void 0,height:220})}):(0,j.jsx)(rn.A,{description:"No data"})})},Q=(0,s.useRef)({}),X=(0,s.useRef)(null),ee=Object.keys(ea),te=(0,Vn.E)({queries:ee.map(e=>{var t,n,a,s,i,r,l,o,d,c,u,h,m,p;return{queryKey:["chart",e,(null===(t=C.dateRange)||void 0===t||null===(n=t[0])||void 0===n||null===(a=n.format)||void 0===a?void 0:a.call(n,"YYYY-MM-DD"))||null,(null===(s=C.dateRange)||void 0===s||null===(i=s[1])||void 0===i||null===(r=i.format)||void 0===r?void 0:r.call(i,"YYYY-MM-DD"))||null,(null===(l=B[e])||void 0===l||null===(o=l.dateRange)||void 0===o||null===(d=o[0])||void 0===d||null===(c=d.format)||void 0===c?void 0:c.call(d,"YYYY-MM-DD"))||null,(null===(u=B[e])||void 0===u||null===(h=u.dateRange)||void 0===h||null===(m=h[1])||void 0===m||null===(p=m.format)||void 0===p?void 0:p.call(m,"YYYY-MM-DD"))||null,C.residentType||null],queryFn:async()=>{var t,n,a,s,i,r,l,o,d,c,u,h,m;const p=B[e]||{},x=(null===(t=p.dateRange)||void 0===t||null===(n=t[0])||void 0===n||null===(a=n.format)||void 0===a?void 0:a.call(n,"YYYY-MM-DD"))||(null===(s=C.dateRange)||void 0===s||null===(i=s[0])||void 0===i||null===(r=i.format)||void 0===r?void 0:r.call(i,"YYYY-MM-DD")),g=(null===(l=p.dateRange)||void 0===l||null===(o=l[1])||void 0===o||null===(d=o.format)||void 0===d?void 0:d.call(o,"YYYY-MM-DD"))||(null===(c=C.dateRange)||void 0===c||null===(u=c[1])||void 0===u||null===(h=u.format)||void 0===h?void 0:h.call(u,"YYYY-MM-DD"));return(null===(m=(await A.axiosInstance.get(ea[e].endpoint,{params:{startDate:x,endDate:g,residentType:C.residentType}})).data)||void 0===m?void 0:m.data)||[]},retry:2}})}),ne=te.map(e=>JSON.stringify((null===e||void 0===e?void 0:e.data)||"")).join("|"),ae=(0,s.useMemo)(()=>{const e={};return ta.forEach((t,n)=>{e[t]=te[n]}),e},[te]);(0,s.useEffect)(()=>{const e={},t={};ee.forEach(n=>{const s=ae[n];"gender"===n&&console.debug("chart query gender raw data:",null===s||void 0===s?void 0:s.data),e[n]="gender"===n?((null===s||void 0===s?void 0:s.data)||[]).map(e=>{var t,n,a,s,i;const r=((null!==(t=null!==(n=null!==(a=null===e||void 0===e?void 0:e.name)&&void 0!==a?a:null===e||void 0===e?void 0:e.type)&&void 0!==n?n:null===e||void 0===e?void 0:e._id)&&void 0!==t?t:"").toString().trim()||"").toLowerCase();let l="Other";return/^m/.test(r)?l="Male":/^f/.test(r)&&(l="Female"),{type:l,value:Number(null!==(s=null!==(i=null===e||void 0===e?void 0:e.value)&&void 0!==i?i:null===e||void 0===e?void 0:e.count)&&void 0!==s?s:0)}}).reduce((e,t)=>{const n=e.find(e=>e.type===t.type);return n?n.value+=t.value:e.push((0,a.A)({},t)),e},[]):(null===s||void 0===s?void 0:s.data)||[],t[n]=(null===s||void 0===s?void 0:s.isFetching)||(null===s||void 0===s?void 0:s.isLoading)||!1}),w(e),S(t)},[ne,ae,ee]),(0,s.useEffect)(()=>{N&&N.length&&N.forEach(e=>{var t;return(null===(t=ae[e])||void 0===t?void 0:t.refetch)&&ae[e].refetch()})},[N,ae]);const se=(0,s.useMemo)(()=>{const e=Object.keys(b||{}).filter(e=>Array.isArray(b[e])&&b[e].length>0);return new Set(e)},[b]);(0,s.useEffect)(()=>{if(D){_.current=N;const e=Array.from(se),t=ta.filter(t=>e.includes(t)).slice(0,6);t.length&&T(t)}else _.current&&(T(_.current),_.current=null)},[D,se,N]);const[ie,re]=(0,s.useState)(!1),[le,oe]=(0,s.useState)(""),[de,ce]=(0,s.useState)(()=>"undefined"!==typeof window&&window.innerWidth<700);(0,s.useEffect)(()=>{const e=()=>ce(window.innerWidth<700);try{window.addEventListener("resize",e)}catch(t){}return()=>{try{window.removeEventListener("resize",e)}catch(t){}}},[]);return(0,j.jsx)(r.A,{title:(0,j.jsx)(h.A.Title,{level:4,style:{margin:0},children:"Statistics & Analytics"}),style:{borderRadius:16,boxShadow:"0 2px 16px #40c9ff11"},styles:{body:{padding:24}},children:(0,j.jsxs)("div",{ref:X,style:{background:"#ffffff",padding:8},children:[(0,j.jsxs)(mt.A,{layout:de?"vertical":"inline",style:{marginBottom:24,width:"100%",boxSizing:"border-box"},children:[(0,j.jsx)(mt.A.Item,{label:"Date Range",children:(0,j.jsx)(Qn,{value:C.dateRange,onChange:e=>k(t=>(0,a.A)((0,a.A)({},t),{},{dateRange:e?e.filter(Boolean):[]})),allowClear:!0})}),(0,j.jsx)(mt.A.Item,{label:"Resident Type",children:(0,j.jsxs)(d.A,{value:C.residentType,onChange:e=>k(t=>(0,a.A)((0,a.A)({},t),{},{residentType:e})),style:{minWidth:140},allowClear:!0,placeholder:"All Types",children:[(0,j.jsx)(Xn,{value:"",children:"All"}),(0,j.jsx)(Xn,{value:"active",children:"Active"}),(0,j.jsx)(Xn,{value:"inactive",children:"Inactive"})]})}),(0,j.jsx)(mt.A.Item,{label:"Charts",children:(0,j.jsx)(Fe.A,{open:F,onOpenChange:e=>{M(N.slice()),E(e)},popupRender:()=>(0,j.jsxs)("div",{style:{padding:12,background:"#fff",borderRadius:8,boxShadow:"0 6px 20px rgba(0,0,0,0.08)",minWidth:340},children:[(0,j.jsx)("div",{style:{maxHeight:260,overflowY:"auto",paddingRight:8},onWheel:e=>{},children:(0,j.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Object.keys(ea).map(e=>{const t=(z||[]).includes(e);return(0,j.jsx)(Zt.A,{checked:t,onChange:t=>{const n=new Set(z||[]);t.target.checked?n.add(e):n.delete(e),M(Array.from(n))},children:(0,j.jsx)("span",{style:{fontSize:13},children:ea[e].title})},e)})})}),(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[(0,j.jsx)(u.Ay,{size:"small",onClick:()=>{M(N.slice()),E(!1)},children:"Cancel"}),(0,j.jsx)(u.Ay,{size:"small",type:"primary",onClick:()=>{T(z.slice()),E(!1)},children:"Apply"})]})]}),trigger:["click"],children:(0,j.jsxs)(u.Ay,{children:["Charts ",(0,j.jsx)(Wn.A,{})]})})}),(0,j.jsx)(mt.A.Item,{style:{width:"100%",boxSizing:"border-box"},children:(0,j.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center",width:"100%",boxSizing:"border-box"},children:[(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:200},children:[(0,j.jsx)(zn.A,{checked:D,onChange:e=>P(!!e)}),(0,j.jsx)("span",{style:{fontSize:13},children:"Enable when data exists"})]}),(0,j.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",flex:de?"0 0 100%":"0 1 auto",alignItems:"center",width:de?"100%":void 0,boxSizing:"border-box",paddingRight:8},children:[(0,j.jsx)(u.Ay,{onClick:()=>{U(!0),O(N[0]||"gender")},block:de,style:de?{width:"100%",marginBottom:8}:void 0,children:"Chart Settings"}),(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>{const e=(e=>{var t,n,a;const s=e.summary||y||{},i=e.charts||b||{},r=Number(null!==(t=s.totalResidents)&&void 0!==t?t:0),l=i.gender||[],o=i.age||[],d=i["civil-status"]||[],c=i.education||[],u=i["documents-monthly"]||[],h=i.occupation||[],m=i.nationality||[],p=i.bloodType||[],x=i.disability||[],g=i.children||[],f=i.businessType||[],A=i.businessSize||[],j=i.incomeBrackets||[],v=Number((null===(n=l.find(e=>(e.type||"").toLowerCase().startsWith("m")))||void 0===n?void 0:n.value)||0),w=Number((null===(a=l.find(e=>(e.type||"").toLowerCase().startsWith("f")))||void 0===a?void 0:a.value)||0),I=Math.max(0,(l||[]).reduce((e,t)=>e+(Number(t.value)||0),0)-v-w);let S="";if(o.length){var C,k;const e=[...o].sort((e,t)=>(Number(t.value)||0)-(Number(e.value)||0));S=(null===(C=e[0])||void 0===C?void 0:C.type)||(null===(k=e[0])||void 0===k?void 0:k.group)||""}const N=d.length?d.slice(0,3).map(e=>"".concat(e.type," (").concat(e.value,")")).join(", "):"",T=c.length?c.slice(0,3).map(e=>"".concat(e.type," (").concat(e.value,")")).join(", "):"",D=u.length?u.reduce((e,t)=>e+(Number(t.value)||0),0):0;let P="",_=0;if(u.length){const e=u.reduce((e,t)=>(Number(t.value)||0)>(Number(e.value)||0)?t:e,u[0]);P=(null===e||void 0===e?void 0:e.type)||"",_=Number((null===e||void 0===e?void 0:e.value)||0)}const R=[];if(r>0){const e=v||w||I?"There are currently ".concat(r," residents, with ").concat(v," males, ").concat(w," females").concat(I?", and ".concat(I," identifying as other"):"","."):"There are currently ".concat(r," residents.");R.push(e)}else R.push("Resident count is not available.");if(S?R.push("The most common age group is ".concat(S,".")):o.length?R.push("Age distribution is available but no dominant age group could be determined."):R.push("Age distribution data is not available."),h.length){const e=h.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0)).slice(0,3).map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");R.push("Top occupations: ".concat(e,"."))}else R.push("Occupation distribution is not available.");if(m.length){const e=m.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0)).slice(0,3).map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");R.push("Nationality distribution (top): ".concat(e,"."))}if(N?R.push("Civil status (top): ".concat(N,".")):R.push("Civil status breakdown is not available."),p.length){const e=p.map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");R.push("Blood type breakdown: ".concat(e,"."))}if(x.length){const e=x.reduce((e,t)=>e+(Number(t.value)||0),0);R.push("Disability reported for ".concat(e," residents."))}if(T?R.push("Educational attainment (top): ".concat(T,".")):R.push("Educational attainment data is not available."),g.length){const e=g.reduce((e,t,n)=>e+(Number(t.value)||0)*(Number(t.type)||n),0)/Math.max(1,g.reduce((e,t)=>e+(Number(t.value)||0),0));R.push("Average reported children per household (approx): ".concat(Number(e).toFixed(2),"."))}if(u.length?R.push("During the selected period there were ".concat(D," document requests. The busiest month was ").concat(P," with ").concat(_," requests.")):R.push("Document request trends are not available for the selected period."),f.length){const e=f.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0)).slice(0,3).map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");R.push("Top business types: ".concat(e,"."))}if(A.length){const e=A.reduce((e,t)=>e+(Number(t.value)||0),0);R.push("Business size distribution available for ".concat(e," businesses."))}if(j.length){const e=j.reduce((e,t)=>e+(Number(t.value)||0),0),t=j.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0))[0];t&&R.push("Most residents fall into the ".concat(t.type||t.name," income bracket (").concat(t.value,"). Total reported incomes: ").concat(e,"."))}return R.join(" ")})({summary:y,charts:b});oe(e),re(!0)},block:de,style:de?{width:"100%",marginBottom:8}:void 0,children:"Generate Report"}),(0,j.jsx)(u.Ay,{onClick:async()=>{await(async()=>{if(X.current){i.Ay.loading({content:"Preparing full report...",key:"report"});try{const e=(await n.e(52).then(n.t.bind(n,81052,23))).default,t=X.current,a=(await e(t,{background:"#ffffff"})).toDataURL("image/png"),s=new $n.Ay({unit:"pt",format:"a4",orientation:"portrait"}),r="Barangay Analytics Report";s.setFontSize(24),s.text(r,40,80),s.setFontSize(12),s.text("Generated: ".concat((new Date).toLocaleString()),40,110),s.addPage();const l=s.internal.pageSize.getWidth(),o=s.internal.pageSize.getHeight(),d=40,c=l-2*d,u=new Image;u.src=a,await new Promise(e=>u.onload=e);const h=c,m=u.height*h/u.width,p=u.height/m,x=o-2*d,g=Math.floor(x*p),f=document.createElement("canvas");f.width=u.width,f.height=u.height;const y=f.getContext("2d");if(!y)throw new Error("Canvas not supported");y.fillStyle="#ffffff",y.fillRect(0,0,f.width,f.height),y.drawImage(u,0,0);let A=0;for(;A<f.height;){const e=document.createElement("canvas");e.width=f.width,e.height=Math.min(g,f.height-A);const t=e.getContext("2d");if(!t)break;t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height),t.drawImage(f,0,A,e.width,e.height,0,0,e.width,e.height);const n=e.toDataURL("image/png"),a=e.height/p;s.addImage(n,"PNG",d,d,h,a),A+=g,A<f.height&&s.addPage()}s.save("barangay-analytics-report.pdf"),i.Ay.success({content:"Report ready",key:"report"})}catch(e){console.error("Full report export failed",e),i.Ay.error({content:"Failed to export full report (see console).",key:"report"})}}else i.Ay.error("Dashboard not available for capture")})()},block:de,style:de?{width:"100%"}:void 0,children:"Download Full Analytics"})]})]})})]}),(0,j.jsx)(ln.A,{title:"Chart Settings",placement:"right",onClose:()=>U(!1),open:R,width:420,children:(0,j.jsxs)(mt.A,{layout:"vertical",children:[(0,j.jsx)(mt.A.Item,{label:"Select chart",children:(0,j.jsx)(d.A,{value:L,onChange:e=>O(e),children:Object.keys(ea).map(e=>(0,j.jsx)(d.A.Option,{value:e,children:ea[e].title},e))})}),(0,j.jsx)(mt.A.Item,{label:"Chart type",children:(0,j.jsxs)(d.A,{value:B[L]&&B[L].chartType||ea[L].chartType,onChange:e=>q(t=>(0,a.A)((0,a.A)({},t),{},{[L]:(0,a.A)((0,a.A)({},t[L]||{}),{},{chartType:e})})),children:[(0,j.jsx)(d.A.Option,{value:"pie",children:"Pie"}),(0,j.jsx)(d.A.Option,{value:"bar",children:"Bar"}),(0,j.jsx)(d.A.Option,{value:"line",children:"Line"}),(0,j.jsx)(d.A.Option,{value:"area",children:"Area"})]})}),(0,j.jsx)(mt.A.Item,{label:"Date range for this chart",children:(0,j.jsx)(Qn,{value:B[L]&&B[L].dateRange||C.dateRange,onChange:e=>q(t=>(0,a.A)((0,a.A)({},t),{},{[L]:(0,a.A)((0,a.A)({},t[L]||{}),{},{dateRange:e?e.filter(Boolean):[]})})),allowClear:!0})}),(0,j.jsx)(mt.A.Item,{label:"Show labels",children:(0,j.jsx)(zn.A,{checked:null===(c=B[L]&&B[L].showLabels)||void 0===c||c,onChange:e=>q(t=>(0,a.A)((0,a.A)({},t),{},{[L]:(0,a.A)((0,a.A)({},t[L]||{}),{},{showLabels:e})}))})}),(0,j.jsx)(mt.A.Item,{label:"Show tooltips",children:(0,j.jsx)(zn.A,{checked:null===(p=B[L]&&B[L].showTooltips)||void 0===p||p,onChange:e=>q(t=>(0,a.A)((0,a.A)({},t),{},{[L]:(0,a.A)((0,a.A)({},t[L]||{}),{},{showTooltips:e})}))})}),(0,j.jsx)(mt.A.Item,{label:"Show legend",children:(0,j.jsx)(zn.A,{checked:null===(x=B[L]&&B[L].showLegend)||void 0===x||x,onChange:e=>q(t=>(0,a.A)((0,a.A)({},t),{},{[L]:(0,a.A)((0,a.A)({},t[L]||{}),{},{showLegend:e})}))})}),(0,j.jsx)(mt.A.Item,{children:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>{U(!1),Y(L)},children:"Apply"}),(0,j.jsx)(u.Ay,{onClick:()=>{q(e=>(0,a.A)((0,a.A)({},e),{},{[L]:{}}))},children:"Reset"})]})})]})}),(0,j.jsx)(fe.A,{title:"Analytics Report",open:ie,onCancel:()=>re(!1),footer:[(0,j.jsx)(u.Ay,{onClick:async()=>{try{await navigator.clipboard.writeText(le),i.Ay.success("Report copied to clipboard")}catch(e){i.Ay.error("Failed to copy")}},children:"Copy"},"copy"),(0,j.jsx)(u.Ay,{type:"primary",onClick:async()=>{const e=new $n.Ay({orientation:"portrait"});e.setFontSize(16),e.text("Analytics Report",14,20),e.setFontSize(11);const t=e.splitTextToSize(le,180);e.text(t,14,30);try{const a=(await n.e(52).then(n.t.bind(n,81052,23))).default;let s=40+6*t.length;for(const t of N){const n=Q.current[t];if(!n)continue;const i=await a(n,{background:"#ffffff"}),r=i.toDataURL("image/png"),l=i.width,o=i.height,d=e.internal.pageSize.getWidth()-28,c=o*d/l;s+c>e.internal.pageSize.getHeight()-20&&(e.addPage(),s=20),e.addImage(r,"PNG",14,s,d,c),s+=c+8}}catch(a){console.warn("html2canvas not available or capture failed, exporting text only",a),i.Ay.warning("Chart capture failed; exporting text-only PDF. To include images, install html2canvas.")}e.save("analytics-report.pdf")},children:"Download as PDF"},"download")],children:(0,j.jsx)(h.A.Paragraph,{children:le||"No data available for report."})}),(0,j.jsxs)(l.A,{gutter:[24,24],style:{marginBottom:24},children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:8,children:(0,j.jsx)(r.A,{variant:"borderless",style:{borderRadius:12,boxShadow:"0 8px 20px rgba(15,15,15,0.04)",textAlign:"left"},styles:{body:{padding:16}},children:g?(0,j.jsx)(En.A,{active:!0,paragraph:!1}):(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12},children:"Total Residents"}),(0,j.jsx)(h.A.Title,{level:3,style:{margin:0},children:V})]})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:8,children:(0,j.jsx)(r.A,{variant:"borderless",style:{borderRadius:12,boxShadow:"0 8px 20px rgba(15,15,15,0.04)",textAlign:"left"},styles:{body:{padding:16}},children:g?(0,j.jsx)(En.A,{active:!0,paragraph:!1}):(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12},children:"Total Documents"}),(0,j.jsx)(h.A.Title,{level:3,style:{margin:0},children:H})]})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:8,children:(0,j.jsx)(r.A,{style:{borderRadius:12,boxShadow:"0 8px 20px rgba(15,15,15,0.04)",textAlign:"left"},styles:{body:{padding:16}},children:g?(0,j.jsx)(En.A,{active:!0,paragraph:!1}):(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12},children:"Requests (selected period)"}),(0,j.jsx)(h.A.Title,{level:3,style:{margin:0},children:Z?Z.reduce((e,t)=>e+(Number(t.value)||0),0):0}),(0,j.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12,marginTop:6},children:Z&&Z.length?"Latest: ".concat(Z[Z.length-1].type," (").concat(Z[Z.length-1].value,")"):""})]})})})]}),(0,j.jsx)(m.A,{}),ee.map(e=>{const t=ae[e];var n;return null!==t&&void 0!==t&&t.isError?(0,j.jsx)(Mn.A,{message:"Failed to load ".concat(ea[e].title),description:(0,j.jsxs)("div",{children:[String((null===(n=t.error)||void 0===n?void 0:n.message)||t.error)," ",(0,j.jsx)(u.Ay,{size:"small",onClick:()=>t.refetch(),children:"Retry"})]}),type:"error",showIcon:!0,style:{marginBottom:12}},"alert-".concat(e)):null}),(0,j.jsxs)(l.A,{gutter:[24,24],children:[N.includes("gender")&&(0,j.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,j.jsx)($,{id:"gender",title:ea.gender.title,chartType:ea.gender.chartType,data:b.gender,loading:I.gender,colors:ea.gender.colors})}),N.includes("age")&&(0,j.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,j.jsx)($,{id:"age",title:ea.age.title,chartType:ea.age.chartType,data:b.age,loading:I.age,colors:ea.age.colors})}),N.includes("documents-monthly")&&(0,j.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,j.jsx)($,{id:"documents-monthly",title:ea["documents-monthly"].title,chartType:ea["documents-monthly"].chartType,data:b["documents-monthly"],loading:I["documents-monthly"],colors:ea["documents-monthly"].colors})}),N.includes("civil-status")&&(0,j.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,j.jsx)($,{id:"civil-status",title:ea["civil-status"].title,chartType:ea["civil-status"].chartType,data:b["civil-status"],loading:I["civil-status"],colors:ea["civil-status"].colors})}),N.includes("education")&&(0,j.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,j.jsx)($,{id:"education",title:ea.education.title,chartType:ea.education.chartType,data:b.education,loading:I.education,colors:ea.education.colors})})]})]})})},sa=()=>(0,j.jsx)(Hn.Ht,{client:na,children:(0,j.jsx)(aa,{})});var ia=n(89988),ra=n(13852),la=n(6503),oa=n(65827),da=n(6732),ca=n(65250),ua=n(47371),ha=n(36707),ma=n(24514);const pa=e=>{let{open:t,onClose:n,contactEmail:a}=e;const[i,r]=(0,s.useState)(a||""),[l,o]=(0,s.useState)(!1);(0,s.useEffect)(()=>{r(a||"")},[a,t]);const[d,c]=(0,s.useState)(!1),[u,h]=(0,s.useState)(""),[m,p]=(0,s.useState)("success");return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(ha.A,{open:t,onClose:()=>{l||n()},children:(0,j.jsxs)(It.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:420,bgcolor:"background.paper",boxShadow:24,p:3},children:[(0,j.jsx)("h3",{children:"Send Test Email"}),(0,j.jsx)(Nt.A,{label:"Recipient Email",type:"email",value:i,onChange:e=>r(e.target.value),fullWidth:!0,margin:"normal"}),(0,j.jsxs)(It.A,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[(0,j.jsx)(Dt.A,{onClick:n,disabled:l,children:"Cancel"}),(0,j.jsx)(Dt.A,{variant:"contained",onClick:async()=>{try{o(!0);try{const e=await A.adminAPI.getSystemSettings();if(!e||!e.smtp||!e.smtp.host)return h("SMTP is not configured. Please configure SMTP settings before sending a test email."),p("error"),c(!0),void o(!1)}catch(r){}const e=await A.adminAPI.testSmtp(i),t=e&&e.message?e.message:"Test email sent successfully";h(t),p("success"),c(!0),o(!1),setTimeout(()=>{c(!1),n()},900)}catch(l){var e,t,a,s;o(!1);const n=(null===l||void 0===l||null===(e=l.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||(null===l||void 0===l||null===(a=l.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.error)||(null===l||void 0===l?void 0:l.message)||"Failed to send test email";h(n),p("error"),c(!0)}},disabled:l||!i,children:l?(0,j.jsx)(la.A,{size:20}):"Send Test Email"})]})]})}),(0,j.jsx)(ma.A,{open:d,autoHideDuration:4e3,onClose:()=>c(!1),children:(0,j.jsx)(Rt.A,{onClose:()=>c(!1),severity:m,sx:{width:"100%"},children:u})})]})};var xa=n(90287),ga=n(723);const fa={siteName:"Barangay Portal",barangayName:"Barangay Uno",barangayAddress:"123 Main St, City, Province",contactEmail:"info@barangayuno.local",contactPhone:"+63 912 345 6789",maintainanceMode:!1,allowNewRegistrations:!0,requireEmailVerification:!0,enableVerifications:!1,maxDocumentRequests:5,documentProcessingDays:3,allowMultipleAccountsPerIP:!1,maxAccountsPerIP:1,systemNotice:"",smtp:{host:"",port:587,user:"",password:""}},ya=()=>{var e,t,n,r,l;const[o,d]=(0,s.useState)(()=>(0,a.A)({},fa)),[c,u]=(0,s.useState)(!0),[h,m]=(0,s.useState)(!1),[p,x]=(0,s.useState)(!1),[,g]=(0,s.useState)(!1),[,f]=(0,s.useState)(null),[y,v]=(0,s.useState)(!1),[w,I]=(0,s.useState)([]),[S,C]=(0,s.useState)(!1),[k,N]=(0,s.useState)(!1),[T,D]=(0,s.useState)(null),P=(0,s.useRef)({}),_=(0,s.useRef)({}),R=(0,s.useRef)(null),U=(0,s.useRef)(0),[B,q]=(0,s.useState)([]),L=(0,s.useRef)({}),O=(0,s.useRef)(null),[,F]=(0,s.useState)(!1);(0,s.useEffect)(()=>{const e=new AbortController;E(e.signal);const t=_.current;return()=>{try{e.abort()}catch(n){}try{Object.values(t).forEach(e=>{try{URL.revokeObjectURL(e)}catch(n){}})}catch(n){}}},[]),(0,s.useEffect)(()=>{try{const e=R.current;if(!e)return;w.length>U.current&&e.scrollTo({left:e.scrollWidth,behavior:"smooth"}),U.current=w.length}catch(e){}},[w.length]),(0,s.useEffect)(()=>{try{w.filter(e=>e._id&&e._id.toString().startsWith("new-")).map(e=>e._id).forEach(e=>{if(!B.includes(e)){q(t=>[...t,e]);const t=window.setTimeout(()=>{q(t=>t.filter(t=>t!==e)),delete L.current[e]},2500);L.current[e]=t}})}catch(e){}return()=>{Object.values(L.current).forEach(t=>{try{clearTimeout(t)}catch(e){}}),L.current={}}},[w,B]);const E=async e=>{u(!0);try{let a=null;try{a=await A.adminAPI.getSystemSettings()}catch(t){try{const t=await xa.A.get("".concat(A.API_URL,"/admin/settings"),{withCredentials:!0,signal:e});null!==t&&void 0!==t&&t.data&&(a=t.data)}catch(n){console.warn("Failed to load system settings via adminAPI and API_URL fallback",t,n)}}a&&(d(a),O.current=a),C(!0);try{const t=await A.adminAPI.getOfficials();if(Array.isArray(t))I(t);else{const t=await xa.A.get("".concat(A.API_URL,"/admin/officials"),{withCredentials:!0,signal:e});null!==t&&void 0!==t&&t.data&&I(t.data)}}catch(t){try{const t=await xa.A.get("".concat(A.API_URL,"/admin/officials"),{withCredentials:!0,signal:e});null!==t&&void 0!==t&&t.data&&I(t.data)}catch(n){console.warn("Failed to load officials via adminAPI and API_URL fallback",t,n)}}finally{C(!1)}}catch(t){if("CanceledError"===(null===t||void 0===t?void 0:t.name)||"AbortError"===(null===t||void 0===t?void 0:t.name))return;console.error("Unexpected error in fetchSettings",t),i.Ay.error("Unexpected error while loading settings")}finally{u(!1)}},z=async()=>{try{m(!0),f(null);const e=(0,a.A)((0,a.A)({},o),{},{maintenanceMode:o.maintainanceMode,allowRegistrations:o.allowNewRegistrations,maxDocumentRequestsPerUser:Number(o.maxDocumentRequests)||1,documentProcessingDays:Number(o.documentProcessingDays)||1},"undefined"!==typeof o.maxAccountsPerIP?{maxAccountsPerIP:Number(o.maxAccountsPerIP)||1}:{});await A.adminAPI.updateSystemSettings(e),O.current=e,F(!1),g(!0),i.Ay.success("Settings saved")}catch(e){console.error("Failed to save settings",e),f("Failed to save settings"),i.Ay.error("Failed to save settings")}finally{m(!1),window.setTimeout(()=>g(!1),2e3)}},M=async()=>{try{await(async()=>{try{const e=O.current,t=!e||Boolean(e.enableVerifications),n=Boolean(o.enableVerifications);if(t&&!1===n)return void x(!0);await z()}catch(e){console.error("handleSave error",e)}})()}catch(e){}try{await(async()=>{if(w&&0!==w.length){N(!0),D(null);try{const t=[];for(const n of w)if(!n._id||n._id.toString().startsWith("new-")){const e=await A.adminAPI.createOfficial({name:n.name,title:n.title,term:n.term});t.push(e)}else try{const e=await A.adminAPI.updateOfficial(n._id,{name:n.name,title:n.title,term:n.term});t.push(e)}catch(e){t.push(n)}try{const e=await A.adminAPI.getOfficials();Array.isArray(e)?I(e):I(t)}catch(e){I(t)}i.Ay.success("Officials saved")}catch(t){console.error("Manual save officials failed",t),D("Manual save failed"),i.Ay.error("Manual save failed")}finally{N(!1)}}})()}catch(e){}};(0,s.useEffect)(()=>{try{if(!O.current)return void F(!1);F(JSON.stringify(O.current)!==JSON.stringify(o))}catch(e){F(!1)}},[o]);return(0,j.jsxs)(It.A,{sx:{pt:"calc(var(--app-header-height, 64px) + 24px)",px:3,pb:3},children:[(0,j.jsxs)(Ct.A,{sx:{p:3},children:[(0,j.jsx)(kt.A,{variant:"subtitle1",gutterBottom:!0,children:"Barangay Information"}),(0,j.jsxs)(It.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,j.jsx)(Nt.A,{label:"Site Name",value:o.siteName,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{siteName:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,j.jsx)(Nt.A,{label:"Barangay Name",value:o.barangayName,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{barangayName:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,j.jsx)(Nt.A,{label:"Barangay Address",value:o.barangayAddress,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{barangayAddress:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0,multiline:!0,rows:2})]}),(0,j.jsx)(ia.A,{sx:{my:3}}),(0,j.jsx)(kt.A,{variant:"subtitle1",gutterBottom:!0,children:"SMTP / Email Settings"}),(0,j.jsxs)(It.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,j.jsx)(Nt.A,{label:"SMTP Host",value:(null===(e=o.smtp)||void 0===e?void 0:e.host)||"",onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{smtp:(0,a.A)((0,a.A)({},t.smtp),{},{host:e.target.value})})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,j.jsx)(Nt.A,{label:"SMTP Port",type:"number",value:(null===(t=o.smtp)||void 0===t?void 0:t.port)||"",onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{smtp:(0,a.A)((0,a.A)({},t.smtp),{},{port:parseInt(e.target.value||"0")})})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,j.jsx)(Nt.A,{label:"SMTP User",value:(null===(n=o.smtp)||void 0===n?void 0:n.user)||"",onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{smtp:(0,a.A)((0,a.A)({},t.smtp),{},{user:e.target.value})})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,j.jsxs)(It.A,{sx:{display:"flex",gap:2},children:[(0,j.jsx)(Dt.A,{variant:"outlined",onClick:()=>v(!0),children:"Send Test Email"}),(0,j.jsx)(Dt.A,{variant:"text",onClick:()=>d(e=>(0,a.A)((0,a.A)({},e),{},{smtp:(0,a.A)((0,a.A)({},e.smtp),{},{password:""})})),children:"Clear SMTP Password"})]})]}),(0,j.jsx)(pa,{open:y,onClose:()=>v(!1),contactEmail:o.contactEmail}),(0,j.jsx)(ia.A,{sx:{my:3}}),(0,j.jsx)(kt.A,{variant:"subtitle1",gutterBottom:!0,children:"Resident Verifications"}),(0,j.jsxs)(It.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[(0,j.jsx)(Pt.A,{control:(0,j.jsx)(ra.A,{checked:Boolean(o.enableVerifications),onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{enableVerifications:e.target.checked}))}),label:"Enable Resident Verifications"}),(0,j.jsx)(Dt.A,{variant:"text",onClick:()=>i.Ay.info("When disabled, all pending verification requests will be deleted on the server."),children:"More info"})]}),!1===o.enableVerifications&&(0,j.jsxs)(It.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,j.jsx)(Rt.A,{severity:"warning",children:"Disabling verifications will permanently delete pending verification requests and uploaded files when you save changes."}),!c&&!O.current&&(0,j.jsx)(Rt.A,{severity:"info",children:"Resident verifications are currently disabled by default. Enable them to allow residents to submit verification requests."})]}),(0,j.jsx)(ia.A,{sx:{my:3}}),(0,j.jsx)(kt.A,{variant:"subtitle1",gutterBottom:!0,children:"Barangay Officials"}),(0,j.jsxs)(It.A,{sx:{display:"flex",gap:3,alignItems:"flex-start",mb:3,flexDirection:{xs:"column",md:"row"}},children:[(0,j.jsxs)(It.A,{sx:{flex:1,width:"100%"},children:[(0,j.jsxs)(It.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[(0,j.jsx)(kt.A,{variant:"body1",children:"Manage officials (auto-saves changes)"}),(0,j.jsx)(Dt.A,{onClick:()=>{const e={_id:"new-".concat(Date.now()),name:"",title:"",term:""};I(t=>[...t,e])},startIcon:(0,j.jsx)(ga.A,{}),children:"Add Official"})]}),(0,j.jsx)(It.A,{sx:{maxHeight:420,overflowY:"auto",pr:1,border:"1px solid rgba(0,0,0,0.04)",borderRadius:1,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.6)"},children:S?(0,j.jsx)(la.A,{size:24}):(0,j.jsx)(It.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:w.map((e,t)=>(0,j.jsxs)(Ct.A,{sx:{p:2,display:"flex",gap:2,alignItems:"center"},children:[(0,j.jsx)(It.A,{sx:{width:72,height:72,borderRadius:"50%",overflow:"hidden",flexShrink:0,border:"3px solid rgba(0,0,0,0.04)",boxShadow:"0 1px 6px rgba(0,0,0,0.06)"},children:(0,j.jsx)("img",{src:xt(e),alt:e.name||"photo",style:{width:"100%",height:"100%",objectFit:"cover",transition:"transform .2s",display:"block"}})}),(0,j.jsxs)(It.A,{sx:{flex:1},children:[(0,j.jsx)(Nt.A,{label:"Full name",value:e.name,onChange:t=>{const n=t.target.value;I(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{name:n}):t)),P.current[e._id||""]&&clearTimeout(P.current[e._id||""]),P.current[e._id||""]=window.setTimeout(async()=>{try{if(N(!0),e._id&&!e._id.toString().startsWith("new-"))await A.adminAPI.updateOfficial(e._id,(0,a.A)((0,a.A)({},e),{},{name:n}));else{const t=await A.adminAPI.createOfficial((0,a.A)((0,a.A)({},e),{},{name:n}));I(n=>n.map(n=>n._id===e._id?t:n))}D(null)}catch(t){console.error("auto-save failed",t),D("Auto-save failed")}finally{N(!1)}},900)},fullWidth:!0,size:"small",sx:{mb:1},variant:"outlined",InputLabelProps:{shrink:!0}}),(0,j.jsx)(Nt.A,{label:"Title/Position",value:e.title,onChange:t=>{const n=t.target.value;I(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{title:n}):t)),P.current[e._id||""]&&clearTimeout(P.current[e._id||""]),P.current[e._id||""]=window.setTimeout(async()=>{try{if(N(!0),e._id&&!e._id.toString().startsWith("new-"))await A.adminAPI.updateOfficial(e._id,(0,a.A)((0,a.A)({},e),{},{title:n}));else{const t=await A.adminAPI.createOfficial((0,a.A)((0,a.A)({},e),{},{title:n}));I(n=>n.map(n=>n._id===e._id?t:n))}D(null)}catch(t){console.error("auto-save failed",t),D("Auto-save failed")}finally{N(!1)}},900)},fullWidth:!0,size:"small",sx:{mb:1},variant:"outlined",InputLabelProps:{shrink:!0}}),(0,j.jsx)(Nt.A,{label:"Term",value:e.term,onChange:t=>{const n=t.target.value;I(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{term:n}):t)),P.current[e._id||""]&&clearTimeout(P.current[e._id||""]),P.current[e._id||""]=window.setTimeout(async()=>{try{if(N(!0),e._id&&!e._id.toString().startsWith("new-"))await A.adminAPI.updateOfficial(e._id,(0,a.A)((0,a.A)({},e),{},{term:n}));else{const t=await A.adminAPI.createOfficial((0,a.A)((0,a.A)({},e),{},{term:n}));I(n=>n.map(n=>n._id===e._id?t:n))}D(null)}catch(t){console.error("auto-save failed",t),D("Auto-save failed")}finally{N(!1)}},900)},fullWidth:!0,size:"small",variant:"outlined",InputLabelProps:{shrink:!0}}),(0,j.jsxs)(It.A,{sx:{display:"flex",gap:1,mt:1},children:[(0,j.jsx)(Z.A,{showUploadList:!1,beforeUpload:t=>{if(t.size>2097152)return i.Ay.warning("File is too large. Maximum allowed size is 2 MB."),!1;try{const n=URL.createObjectURL(t);_.current[e._id||"temp-".concat(Date.now())]=n,I(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{previewUrl:n}):t))}catch(n){}return(async()=>{try{if(!e._id||e._id.toString().startsWith("new-"))return void i.Ay.warning("Please save official first by entering name/title/term");await A.adminAPI.uploadOfficialPhoto(e._id,t);const a=await A.adminAPI.getOfficials();I(Array.isArray(a)?a:w),i.Ay.success("Photo uploaded");try{const t=e._id||"",n=_.current[t];n&&(URL.revokeObjectURL(n),delete _.current[t])}catch(n){}}catch(a){console.error("upload failed",a),i.Ay.error("Upload failed")}})(),!1},children:(0,j.jsx)(Dt.A,{startIcon:(0,j.jsx)(ee.A,{}),children:"Upload Photo"})}),(0,j.jsx)(Dt.A,{color:"error",startIcon:(0,j.jsx)(X.A,{}),onClick:()=>{e._id&&!e._id.toString().startsWith("new-")?(async e=>{if(e){N(!0);try{await A.adminAPI.deleteOfficial(e),I(t=>t.filter(t=>t._id!==e)),i.Ay.success("Official deleted")}catch(t){console.error("Delete official failed",t),i.Ay.error("Failed to delete official")}finally{N(!1)}}})(e._id):I(t=>t.filter(t=>t._id!==e._id))},children:"Delete"})]})]})]},e._id||t))})})]}),(0,j.jsxs)(It.A,{sx:{width:{xs:"100%",md:360},position:{xs:"relative",md:"sticky"},top:{md:24},alignSelf:"flex-start",mt:{xs:2,md:0}},children:[(0,j.jsx)(kt.A,{variant:"body2",sx:{mb:1},children:"Officials Preview"}),(0,j.jsx)(It.A,{sx:{background:"white",borderRadius:2,p:2},children:0===w.length?(0,j.jsx)(kt.A,{variant:"body2",color:"text.secondary",children:"No officials to preview"}):(()=>{const e=[...w.filter(e=>!(e._id&&e._id.toString().startsWith("new-"))),...w.filter(e=>e._id&&e._id.toString().startsWith("new-"))];return(0,j.jsx)("div",{ref:R,style:{display:"flex",gap:12,overflowX:"auto",padding:"6px 4px",scrollSnapType:"x mandatory"},"aria-label":"Officials preview",children:e.map(e=>{const t=e._id||"",n=B.includes(t);return(0,j.jsxs)("div",{style:{minWidth:140,textAlign:"center",padding:8,scrollSnapAlign:"center",transition:"box-shadow .25s, transform .18s",boxShadow:n?"0 10px 30px rgba(25,118,210,0.18)":void 0,transform:n?"translateY(-4px)":void 0,borderRadius:8,background:n?"linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,255,0.98))":void 0,flex:"0 0 auto"},children:[(0,j.jsx)(b,{size:80,src:xt(e),style:{margin:"0 auto",boxShadow:"0 6px 18px rgba(0,0,0,0.06)"}}),(0,j.jsxs)("div",{style:{marginTop:8},children:[(0,j.jsx)("div",{style:{fontWeight:600,fontSize:14},children:e.name||"\u2014"}),(0,j.jsx)("div",{style:{color:"#888",fontSize:12},children:e.title}),(0,j.jsx)("div",{style:{color:"#888",fontSize:12},children:e.term})]})]},t||Math.random())})})})()})]})]}),T&&(0,j.jsx)(kt.A,{color:"error",sx:{mt:1},children:T}),(0,j.jsx)(kt.A,{variant:"subtitle1",gutterBottom:!0,children:"Contact Information"}),(0,j.jsxs)(It.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,j.jsx)(Nt.A,{label:"Contact Email",type:"email",value:o.contactEmail,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{contactEmail:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,j.jsx)(Nt.A,{label:"Contact Phone",value:o.contactPhone,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{contactPhone:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0})]}),(0,j.jsx)(ia.A,{sx:{my:3}}),(0,j.jsx)(kt.A,{variant:"subtitle1",gutterBottom:!0,children:"System Configuration"}),(0,j.jsxs)(It.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,j.jsx)(Pt.A,{control:(0,j.jsx)(ra.A,{checked:o.maintainanceMode,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{maintainanceMode:e.target.checked}))}),label:"Maintenance Mode"}),(0,j.jsx)(Pt.A,{control:(0,j.jsx)(ra.A,{checked:o.allowNewRegistrations,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{allowNewRegistrations:e.target.checked}))}),label:"Allow New Registrations"}),(0,j.jsxs)(It.A,{children:[(0,j.jsx)(Pt.A,{control:(0,j.jsx)(ra.A,{checked:o.allowMultipleAccountsPerIP,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{allowMultipleAccountsPerIP:e.target.checked}))}),label:"Allow multiple accounts per IP"}),(0,j.jsxs)(It.A,{sx:{mt:1,ml:4,display:"flex",alignItems:"center",gap:2},children:[(0,j.jsx)(Nt.A,{label:"Max accounts per IP",type:"number",size:"small",value:null!==(r=o.maxAccountsPerIP)&&void 0!==r?r:1,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{maxAccountsPerIP:parseInt(e.target.value||"1")})),variant:"outlined",InputLabelProps:{shrink:!0},inputProps:{min:1,max:100},sx:{width:140}}),(0,j.jsxs)(kt.A,{variant:"caption",color:"text.secondary",children:["Current limit: ",null!==(l=o.maxAccountsPerIP)&&void 0!==l?l:1]})]})]}),(0,j.jsx)(Pt.A,{control:(0,j.jsx)(ra.A,{checked:o.requireEmailVerification,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{requireEmailVerification:e.target.checked}))}),label:"Require Email Verification"}),(0,j.jsx)(Nt.A,{label:"Maximum Document Requests per User",type:"number",value:o.maxDocumentRequests,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{maxDocumentRequests:parseInt(e.target.value)})),variant:"outlined",InputLabelProps:{shrink:!0},inputProps:{min:1,max:20}}),(0,j.jsx)(Nt.A,{label:"Document Processing Days",type:"number",value:o.documentProcessingDays,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{documentProcessingDays:parseInt(e.target.value)})),variant:"outlined",InputLabelProps:{shrink:!0},inputProps:{min:1,max:30},helperText:"Standard number of days to process document requests"})]}),(0,j.jsx)(ia.A,{sx:{my:3}}),(0,j.jsx)(kt.A,{variant:"subtitle1",gutterBottom:!0,children:"System Notice"}),(0,j.jsx)(It.A,{sx:{mb:3},children:(0,j.jsx)(Nt.A,{label:"System-wide Notice",value:o.systemNotice,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{systemNotice:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0,multiline:!0,rows:3,helperText:"This notice will be displayed to all users"})}),(0,j.jsx)(It.A,{sx:{position:"fixed",right:24,bottom:24,zIndex:1300},children:(0,j.jsx)(Dt.A,{variant:"contained",onClick:()=>M(),disabled:h||k,sx:{width:64,height:64,borderRadius:"50%",minWidth:64,boxShadow:"0 8px 24px rgba(25,118,210,0.24)",backgroundColor:"#1976d2",color:"#fff","&:hover":{boxShadow:"0 12px 32px rgba(25,118,210,0.32)",backgroundColor:"#1565c0"},display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600},"aria-label":"Save Settings and Officials",children:h||k?"...":"Save"})})]}),(0,j.jsxs)(oa.A,{open:p,onClose:()=>x(!1),children:[(0,j.jsx)(da.A,{children:"Disable Resident Verifications?"}),(0,j.jsx)(ca.A,{children:(0,j.jsx)(kt.A,{children:"Disabling resident verifications will permanently delete all pending verification requests and their uploaded files on the server. This action cannot be undone. Are you sure you want to proceed?"})}),(0,j.jsxs)(ua.A,{children:[(0,j.jsx)(Dt.A,{onClick:()=>x(!1),disabled:h,children:"Cancel"}),(0,j.jsx)(Dt.A,{onClick:()=>(async()=>{x(!1),await z()})(),color:"error",disabled:h,children:"Yes, disable and save"})]})]})]})};var Aa=n(49600);const{Title:ja,Text:va}=h.A,{Search:ba}=c.A,wa=()=>{const[e,t]=(0,s.useState)([]),[h,m]=(0,s.useState)([]),[p,x]=(0,s.useState)(!1),[g,f]=(0,s.useState)(""),[y,v]=(0,s.useState)({}),[b,w]=(0,s.useState)(!1),[I,S]=(0,s.useState)(""),[C,k]=(0,s.useState)("all"),[N,T]=(0,s.useState)("name"),[D,P]=(0,s.useState)(!1),[_,R]=(0,s.useState)(!1),{user:U}=_e(),[B,q]=(0,s.useState)(()=>{try{const e=localStorage.getItem("userProfile");return e?JSON.parse(e):null}catch(e){return null}});(0,s.useEffect)(()=>{let e=!0;return(async()=>{try{const n=await A.axiosInstance.get("/resident/profile");if(e&&n&&n.data){q(n.data);try{localStorage.setItem("userProfile",JSON.stringify(n.data))}catch(t){}}}catch(n){}})(),()=>{e=!1}},[]);const L=Boolean(U&&"resident"===U.role&&!(B&&!0===B.verified||!0===U.verified));(0,s.useEffect)(()=>{(async()=>{P(!0);try{const e=await A.documentsAPI.listFiles();t(e)}catch(e){i.Ay.error("Failed to fetch document templates"),t([])}finally{P(!1)}})()},[]);const O=e.filter(e=>{const t=e.filename||"";if(/^filled_/i.test(t))return!1;if(/^\d{4}-/.test(t))return!1;const n=t.toLowerCase(),a=I.toLowerCase(),s="all"===C||e.category===C;return n.includes(a)&&s}).sort((e,t)=>{var n;switch(N){case"date":return new Date(t.uploadDate).getTime()-new Date(e.uploadDate).getTime();case"type":return(null===(n=e.filename.split(".").pop())||void 0===n?void 0:n.localeCompare(t.filename.split(".").pop()||""))||0;default:return e.filename.localeCompare(t.filename)}});return(0,j.jsxs)("div",{style:{padding:"24px",minHeight:"80vh",background:"#f0f2f5"},children:[(0,j.jsx)(l.A,{justify:"start",align:"middle",style:{marginBottom:24},children:(0,j.jsxs)(o.A,{style:{textAlign:"left"},children:[(0,j.jsxs)(Nn.A,{style:{marginBottom:8},children:[(0,j.jsx)(Nn.A.Item,{children:"Home"}),(0,j.jsx)(Nn.A.Item,{children:"Documents"}),(0,j.jsx)(Nn.A.Item,{children:"Request"})]}),(0,j.jsx)(ja,{level:2,style:{margin:0,textAlign:"left"},children:"Request Document"})]})}),(0,j.jsxs)(l.A,{gutter:16,justify:"center",style:{marginBottom:24},children:[(0,j.jsx)(o.A,{xs:24,sm:16,md:10,lg:8,children:(0,j.jsx)(ba,{placeholder:"Search documents...",value:I,onChange:e=>S(e.target.value),style:{width:"100%"}})}),(0,j.jsx)(o.A,{xs:24,sm:16,md:10,lg:8,children:(0,j.jsxs)("div",{className:"filter-controls",children:[(0,j.jsxs)(d.A,{defaultValue:"all",className:"filter-select category-select",style:{width:220},onChange:e=>k(e),children:[(0,j.jsx)(d.A.Option,{value:"all",children:"All Categories"}),(0,j.jsx)(d.A.Option,{value:"personal",children:"Personal Documents"}),(0,j.jsx)(d.A.Option,{value:"business",children:"Business Documents"}),(0,j.jsx)(d.A.Option,{value:"certificates",children:"Certificates"})]}),(0,j.jsxs)(d.A,{defaultValue:"name",className:"filter-select sort-select",style:{width:160},onChange:e=>T(e),children:[(0,j.jsx)(d.A.Option,{value:"name",children:"Sort by Name"}),(0,j.jsx)(d.A.Option,{value:"date",children:"Sort by Date"}),(0,j.jsx)(d.A.Option,{value:"type",children:"Sort by Type"})]})]})})]}),(0,j.jsx)(l.A,{gutter:[16,16],children:D?(0,j.jsx)(o.A,{span:24,style:{textAlign:"center",padding:"40px"},children:"Loading documents..."}):0===O.length?(0,j.jsx)(o.A,{span:24,style:{textAlign:"center",padding:"40px"},children:"No documents found"}):O.map(e=>{const t=L;return(0,j.jsx)(o.A,{xs:24,sm:12,md:8,lg:6,children:(0,j.jsx)(r.A,{hoverable:!t,style:{transition:"all 0.3s ease",borderRadius:8,opacity:t?.65:1,cursor:t?"not-allowed":"pointer"},styles:{body:{padding:16}},onClick:()=>{t?w(!0):(async e=>{if(L)w(!0);else{f(e.filename.replace(/\.docx$/i,""));try{const t=await Promise.resolve().then(n.bind(n,51496)),a=await t.axiosPublic.get("/documents/preview/".concat(e._id),{params:{format:"html"},responseType:"text"}),s=a&&a.data?a.data:"",i=/\{(.*?)\}/g,r=[];let l;for(;null!==(l=i.exec(s));)r.push(l[1].trim());const o=r.filter(e=>e&&"qr"!==e.toLowerCase());m(o);const d={},c=new Date,u=c.getDate(),h=c.getMonth()+1,p=c.toLocaleString(void 0,{month:"long"}),g=c.getFullYear(),f=String(h).padStart(2,"0"),y=String(u).padStart(2,"0"),A="".concat(f,"/").concat(y,"/").concat(g);o.forEach(e=>{d[e]="",/^current(day|dayof)?$/i.test(e)||/currentday/i.test(e)?d[e]=String(u):/current(month)?$/i.test(e)||/currentmonth/i.test(e)?d[e]=p:/current(year)?$/i.test(e)||/currentyear/i.test(e)?d[e]=String(g):/currentdate|current_date|current date|dateofrequest|requesteddate/i.test(e)&&(d[e]=A)}),v(d),x(!0)}catch(t){i.Ay.error("Failed to load document preview"),m([]),v({})}}})(e)},children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",marginBottom:12},children:[(0,j.jsx)(Aa.A,{style:{fontSize:24,color:"#1890ff",marginRight:12,marginTop:4}}),(0,j.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,j.jsx)(va,{strong:!0,style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.filename.replace(/\.docx$/i,"")}),(0,j.jsxs)(va,{type:"secondary",style:{fontSize:12},children:[new Date(e.uploadDate).toLocaleDateString()," \xb7 ",Math.round(e.length/1024)," KB"]})]}),t?(0,j.jsx)(u.Ay,{type:"text",icon:(0,j.jsx)(Rn.A,{}),disabled:!0,onClick:e=>e.stopPropagation()}):(0,j.jsx)(Fe.A,{menu:{items:[{key:"view",icon:(0,j.jsx)($.A,{}),label:"View"},{key:"download",icon:(0,j.jsx)(Q.A,{}),label:"Download"}]},trigger:["click"],children:(0,j.jsx)(u.Ay,{type:"text",icon:(0,j.jsx)(Rn.A,{}),onClick:e=>e.stopPropagation()})})]})})},e._id)})}),(0,j.jsx)(fe.A,{open:p,onCancel:()=>x(!1),width:800,footer:null,children:0===h.length?(0,j.jsx)(rn.A,{description:"No fields found in this template"}):(0,j.jsx)(mt.A,{layout:"vertical",initialValues:{fields:y},onFinish:async t=>{R(!0);try{var n;const s=(0,a.A)({},t.fields);Object.entries(s).forEach(e=>{let[t,n]=e;if(n&&"function"===typeof n.format)try{s[t]=n.format("MM/DD/YYYY")}catch(a){s[t]=String(n)}});const r={type:g,documentType:g,purpose:t.purpose,fileId:null===(n=e.find(e=>e.filename.replace(/\.docx$/i,"")===g))||void 0===n?void 0:n._id,fieldValues:s,username:U&&U.username||void 0,barangayID:U&&U.barangayID||void 0};await A.documentsAPI.requestDocument(r),i.Ay.success("Request submitted successfully!"),x(!1)}catch(s){i.Ay.error("Failed to submit request.")}finally{R(!1)}},children:(0,j.jsxs)(l.A,{gutter:[16,16],children:[(0,j.jsx)(o.A,{span:24,children:(0,j.jsx)(mt.A.Item,{name:"purpose",label:"Purpose",rules:[{required:!0,message:"Please enter the purpose"}],children:(0,j.jsx)(c.A.TextArea,{rows:4,placeholder:"Enter the purpose of your request"})})}),h.map((e,t)=>(0,j.jsx)(o.A,{xs:24,sm:12,children:(0,j.jsx)(mt.A.Item,{name:["fields",e],label:e,rules:[{required:!0,message:"Please enter ".concat(e)}],children:/date|dob|birth|issued/i.test(e)?(0,j.jsx)(Tn.A,{style:{width:"100%"},format:"MM/DD/YYYY"}):(0,j.jsx)(c.A,{placeholder:"Enter ".concat(e)})})},t)),(0,j.jsx)(o.A,{span:24,style:{textAlign:"right"},children:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(u.Ay,{onClick:()=>x(!1),children:"Cancel"}),(0,j.jsx)(u.Ay,{type:"primary",htmlType:"submit",loading:_,children:"Submit Request"})]})})]})})}),(0,j.jsx)(fe.A,{open:b,onCancel:()=>w(!1),title:"Verification required",footer:[(0,j.jsx)(u.Ay,{onClick:()=>w(!1),children:"Close"},"cancel"),(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>{w(!1),window.location.href="/profile"},children:"Go to Profile"},"profile")],children:(0,j.jsx)("p",{children:"To request documents you must verify your resident profile. Please visit your profile page and complete the verification steps to unlock this service."})})]})};var Ia=n(82241),Sa=n(9762);const{TextArea:Ca}=c.A,ka=[{label:"Requests",options:[{value:"DOCUMENT_REQUEST",label:"Document Request"},{value:"SCHEDULE_APPOINTMENT",label:"Schedule Appointment"},{value:"CERTIFICATE_REQUEST",label:"Certificate Request"}]},{label:"Concerns",options:[{value:"COMPLAINT",label:"Complaint"},{value:"ASSISTANCE",label:"Assistance"}]}],Na=()=>{const{user:e}=_e(),[t,a]=(0,s.useState)(!1),[m,p]=(0,s.useState)(!1),[x]=mt.A.useForm(),g=s.useRef(null);s.useEffect(()=>{g.current=x},[x]);const f=s.useRef(null),[v,b]=s.useState(0),[w,I]=s.useState(0),S=100,k=500,[N,T]=s.useState(0),[D,P]=s.useState([]),[_,R]=s.useState(!1),[U,B]=s.useState(null),q="inquiryFormDraft_v1",[L,O]=s.useState(!1),[F,E]=s.useState([]),[z,M]=s.useState(Bn()()),[W,Y]=s.useState(Bn()()),V=e=>{try{return e?"function"===typeof e.format?e.format("YYYY-MM-DD"):e instanceof Date?e.toISOString().slice(0,10):new Date(e).toISOString().slice(0,10):""}catch(t){return""}},{getAvailableAppointmentDates:H}=n(11527),G=s.useMemo(()=>H(30),[]),K=s.useMemo(()=>G.filter(e=>!e.isSame(Bn()(),"day")),[G]),J=s.useMemo(()=>new Set(K.map(e=>e.format("YYYY-MM-DD"))),[K]);s.useEffect(()=>{Y(Bn()());const e=setInterval(()=>Y(Bn()()),36e5),t=Bn()().add(1,"day").startOf("day").diff(Bn()()),n=setTimeout(()=>Y(Bn()()),t+1e3);return()=>{clearInterval(e),clearTimeout(n)}},[]),s.useEffect(()=>{try{const e=W.startOf("month"),t=W.startOf("month").add(11,"month");(z.isBefore(e)||z.isAfter(t))&&M(e)}catch(e){}},[W]),s.useEffect(()=>{if(K&&K.length>0){const e=K[0].format("YYYY-MM-DD");E(t=>t.length?t:[e])}},[K]),s.useEffect(()=>{const e=x.getFieldValue("type");O("SCHEDULE_APPOINTMENT"===e)},[x]);s.useEffect(()=>{try{const n=localStorage.getItem(q);if(n){const a=JSON.parse(n);if(a){var e;const{type:n,assignedRole:s,subject:i,message:r,attachments:l}=a;if(null===(e=g.current)||void 0===e||e.setFieldsValue({type:n,assignedRole:s,subject:i,message:r}),i&&b(i.length),r&&I(r.length),l&&Array.isArray(l)&&l.length){var t;const e=l.map((e,t)=>({uid:"restored-".concat(t),name:e}));P(e),null===(t=g.current)||void 0===t||t.setFieldsValue({attachment:e})}i&&r&&(s||n)?T(2):l&&l.length?T(1):T(0)}}}catch(n){console.warn("Failed to load inquiry draft",n)}},[]),s.useEffect(()=>{const e=()=>{try{var e;const t=(null===(e=g.current)||void 0===e?void 0:e.getFieldsValue(!0))||{},n={type:t.type||null,assignedRole:t.assignedRole||null,subject:t.subject||"",message:t.message||"",attachments:(D||[]).map(e=>e.name||e.originFileObj&&e.originFileObj.name||""),updatedAt:(new Date).toISOString()};localStorage.setItem(q,JSON.stringify(n))}catch(t){console.warn("Failed to save draft",t)}},t=setInterval(e,5e3),n=()=>e();return window.addEventListener("beforeunload",n),()=>{clearInterval(t),window.removeEventListener("beforeunload",n);try{var e;const t=(null===(e=g.current)||void 0===e?void 0:e.getFieldsValue(!0))||{},n={type:t.type||null,assignedRole:t.assignedRole||null,subject:t.subject||"",message:t.message||"",attachments:(D||[]).map(e=>e.name||e.originFileObj&&e.originFileObj.name||""),updatedAt:(new Date).toISOString()};localStorage.setItem(q,JSON.stringify(n))}catch(a){}}},[D]);const $=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},Q=async t=>{a(!0),p(!1);try{const s=t&&Array.isArray(t.appointmentDates)&&t.appointmentDates.length?t.appointmentDates:F;if(t&&"SCHEDULE_APPOINTMENT"===t.type&&(!s||0===s.length))return i.Ay.error("Please select at least one appointment date before submitting."),void a(!1);let r=[];t.attachment&&(Array.isArray(t.attachment)?r=t.attachment:t.attachment.fileList&&Array.isArray(t.attachment.fileList)&&(r=t.attachment.fileList));const l=new FormData;if(l.append("type",t.type||""),l.append("subject",t.subject||""),l.append("message",t.message||""),l.append("assignedRole",t.assignedRole||"staff"),l.append("username",(null===e||void 0===e?void 0:e.username)||""),l.append("barangayID",(null===e||void 0===e?void 0:e.barangayID)||""),t.assignedTo&&Array.isArray(t.assignedTo))for(const e of t.assignedTo)l.append("assignedTo[]",e);if(s&&Array.isArray(s)&&s.length)for(const e of s)l.append("appointmentDates[]",e);for(const e of r)e.originFileObj&&l.append("attachments",e.originFileObj,e.name||e.originFileObj&&e.originFileObj.name);await A.contactAPI.submitInquiry(l),p(!0),x.resetFields(),P([]),localStorage.removeItem(q),i.Ay.success("Your inquiry has been submitted!");try{setTimeout(()=>{window.location.reload()},1200)}catch(n){}}catch(s){console.error(s),i.Ay.error("Failed to submit inquiry.")}finally{a(!1)}},X=e=>{i.Ay.error("Please complete all required fields")};return(0,j.jsx)("div",{style:{maxWidth:900,margin:"32px auto",padding:"0 12px"},children:(0,j.jsxs)(r.A,{style:{borderRadius:18,boxShadow:"0 4px 24px 0 rgba(64,201,255,0.10)",padding:0,background:"#fff"},headStyle:{borderRadius:"18px 18px 0 0",background:"linear-gradient(90deg, rgba(64,169,255,0.08) 0%, rgba(146,84,222,0.06) 100%)",padding:"16px 24px"},styles:{body:{padding:24}},bordered:!1,title:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,j.jsx)($t.A,{style:{fontSize:28,color:"#1890ff"}}),(0,j.jsxs)("div",{style:{lineHeight:1},children:[(0,j.jsx)(h.A.Title,{level:4,style:{margin:0,color:"#1890ff",fontWeight:700,fontFamily:"Poppins, Arial, sans-serif"},children:"Submit an Inquiry"}),(0,j.jsx)("div",{style:{fontSize:12,color:"#6c757d",marginTop:4},children:"Fill out the form below and our staff will get back to you."})]})]}),children:[m&&(0,j.jsx)(Mn.A,{type:"success",showIcon:!0,message:(0,j.jsxs)("span",{style:{fontWeight:600},children:[(0,j.jsx)("span",{role:"img","aria-label":"success",children:"\u2705"})," Your inquiry has been submitted!"]}),style:{marginBottom:16,borderRadius:8},banner:!0}),(0,j.jsxs)(mt.A,{form:x,layout:"vertical",onFinish:Q,onFinishFailed:X,autoComplete:"off",onFieldsChange:()=>m&&p(!1),onValuesChange:(e,t)=>{t&&t.attachment&&t.attachment.length>0?T(1):t&&t.message&&t.message.length>0&&T(0),t&&t.subject&&t.message&&(t.assignedRole||t.type)&&T(2)},children:[(0,j.jsx)("div",{style:{marginBottom:16},children:(0,j.jsxs)(Bt.A,{current:N,size:"small",children:[(0,j.jsx)(Bt.A.Step,{title:"Details"}),(0,j.jsx)(Bt.A.Step,{title:"Attachments"}),(0,j.jsx)(Bt.A.Step,{title:"Review & Submit"})]})}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsxs)(o.A,{xs:24,sm:12,children:[(0,j.jsx)(mt.A.Item,{name:"type",label:(0,j.jsxs)("span",{children:["Inquiry Type ",(0,j.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,j.jsx)(y.A,{title:"Choose the category that best describes your issue.",children:(0,j.jsx)(Lt.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),rules:[{required:!0,message:"Please select an inquiry type"}],children:(0,j.jsx)(d.A,{placeholder:"Select inquiry type",className:"inquiry-rounded-input",onChange:e=>{try{if("SCHEDULE_APPOINTMENT"===e){if(O(!0),F&&0!==F.length||!K||!K.length)x.setFieldsValue({type:e});else{const t=K[0].format("YYYY-MM-DD");E([t]),x.setFieldsValue({type:e,appointmentDates:[t]})}setTimeout(()=>{try{var e;null===(e=f.current)||void 0===e||e.scrollIntoView({behavior:"smooth",block:"center"}),i.Ay.info("Opening appointment calendar \u2014 choose up to 3 dates",2),f.current&&(f.current.classList.add("af-scroll-highlight"),setTimeout(()=>f.current&&f.current.classList.remove("af-scroll-highlight"),1600))}catch(t){}},120)}else O(!1),E([]),x.setFieldsValue({type:e,appointmentDates:[]});T(0)}catch(t){console.warn("Error handling type change",t)}},children:ka.map(e=>(0,j.jsx)(d.A.OptGroup,{label:e.label,children:e.options.map(e=>(0,j.jsx)(d.A.Option,{value:e.value,children:e.label},e.value))},e.label))})}),(0,j.jsx)(mt.A.Item,{name:"assignedRole",label:(0,j.jsxs)("span",{children:["Assign to Role ",(0,j.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,j.jsx)(y.A,{title:"Select which role should handle your inquiry.",children:(0,j.jsx)(Lt.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),initialValue:"staff",rules:[{required:!0,message:"Please select a role to assign"}],children:(0,j.jsx)(d.A,{options:[{value:"staff",label:"Staff"},{value:"admin",label:"Admin"}],placeholder:"Assign to role",className:"inquiry-rounded-input"})}),(0,j.jsx)(mt.A.Item,{name:"subject",label:(0,j.jsxs)("span",{children:["Subject ",(0,j.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,j.jsx)(y.A,{title:"Enter a short subject line.",children:(0,j.jsx)(Lt.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),rules:[{required:!0,message:"Please enter a subject"},{min:5,message:"Subject must be at least 5 characters"},{max:S,message:"Subject must be at most ".concat(S," characters")}],children:(0,j.jsxs)("div",{children:[(0,j.jsx)(c.A,{placeholder:"Enter subject",className:"inquiry-rounded-input",maxLength:120,onChange:e=>b(e.target.value.length)}),(0,j.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:6},children:(0,j.jsxs)("small",{style:{color:v>S?"red":"#8c8c8c"},children:[v,"/",S]})})]})})]}),(0,j.jsxs)(o.A,{xs:24,sm:12,children:[(0,j.jsx)(mt.A.Item,{name:"message",label:(0,j.jsxs)("span",{children:["Message ",(0,j.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,j.jsx)(y.A,{title:"Provide details about your inquiry.",children:(0,j.jsx)(Lt.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),rules:[{required:!0,message:"Please enter your message"},{min:10,message:"Message must be at least 10 characters"},{max:k,message:"Message must be at most ".concat(k," characters")}],children:(0,j.jsxs)("div",{children:[(0,j.jsx)(Ca,{rows:4,placeholder:"Enter your message",className:"inquiry-rounded-input inquiry-large-textarea",maxLength:550,onChange:e=>I(e.target.value.length)}),(0,j.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:6},children:(0,j.jsxs)("small",{style:{color:w>k?"red":"#8c8c8c"},children:[w,"/",k]})})]})}),(0,j.jsxs)(mt.A.Item,{name:"attachment",label:(0,j.jsxs)("span",{children:["Attachments"," ",(0,j.jsx)(y.A,{title:"Attach supporting documents (PDF, JPG, PNG).",children:(0,j.jsx)(Lt.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:e&&e.fileList,extra:"Allowed: PDF, JPG, PNG. Max 5MB each.",children:[(0,j.jsxs)(Z.A.Dragger,{multiple:!0,accept:".pdf,.jpg,.jpeg,.png",fileList:D,beforeUpload:()=>!1,onChange:e=>{const t=e.fileList||[],n=[];t.forEach(e=>{const t=e.originFileObj||e,a=["application/pdf","image/jpeg","image/png"].includes(t.type)||t.name&&/\.(pdf|jpe?g|png)$/i.test(t.name),s=(t.size||0)/1024/1024<5;if(a)if(s){if(t.type&&t.type.startsWith("image/")&&!e.url&&!e.preview)try{const n=URL.createObjectURL(t);e.preview=n}catch(r){}n.push(e)}else i.Ay.error("".concat(t.name," must be smaller than 5MB"));else i.Ay.error("".concat(t.name," is not a supported file type"))}),P(n),x.setFieldsValue({attachment:n})},onPreview:async e=>{const t=e,n=t.url||t.preview||t.originFileObj&&URL.createObjectURL(t.originFileObj);n&&window.open(n,"_blank")},showUploadList:!1,children:[(0,j.jsx)("p",{className:"ant-upload-drag-icon",children:(0,j.jsx)(ee.A,{})}),(0,j.jsx)("p",{className:"ant-upload-text",children:"Drag files here or click to upload"}),(0,j.jsx)("p",{className:"ant-upload-hint",children:"Support for multiple files. Each must be PDF, JPG, or PNG, and under 5MB."})]}),D&&D.length>0&&(0,j.jsx)("div",{style:{marginTop:12},children:D.map(e=>{const t=e.name||e.originFileObj&&e.originFileObj.name||"file",n=e.size||e.originFileObj&&e.originFileObj.size||0,a=e.type&&e.type.startsWith("image/")||/\.(jpe?g|png)$/i.test(t),s="application/pdf"===e.type||/\.pdf$/i.test(t);return(0,j.jsxs)("div",{className:"inquiry-file-item",style:{display:"flex",alignItems:"center",gap:12,padding:"8px 12px",border:"1px solid #f0f0f0",borderRadius:8,marginBottom:8},children:[(0,j.jsx)("div",{className:"inquiry-file-thumb",style:{width:48,height:48,display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa",borderRadius:6},children:a?(0,j.jsx)("img",{src:e.preview||e.originFileObj&&URL.createObjectURL(e.originFileObj),alt:t,style:{maxWidth:44,maxHeight:44,borderRadius:4}}):s?(0,j.jsx)("div",{style:{fontSize:20,color:"#ff4d4f"},children:"PDF"}):(0,j.jsx)("div",{style:{fontSize:20},children:"FILE"})}),(0,j.jsxs)("div",{style:{flex:1},children:[(0,j.jsx)("div",{style:{fontWeight:600},children:t}),(0,j.jsx)("div",{style:{color:"#8c8c8c",fontSize:12},children:$(n)})]}),(0,j.jsxs)("div",{className:"inquiry-file-actions",style:{display:"flex",gap:8},children:[(0,j.jsx)(u.Ay,{type:"link",onClick:()=>{const t=e.url||e.preview||e.originFileObj&&URL.createObjectURL(e.originFileObj);t&&window.open(t,"_blank")},children:"Preview"}),(0,j.jsx)(u.Ay,{type:"link",danger:!0,onClick:()=>{const t=D.filter(t=>t.uid!==e.uid&&t.name!==e.name);P(t),x.setFieldsValue({attachment:t})},children:"Remove"})]})]},e.uid||e.name)})})]})]})]}),L&&(0,j.jsx)("div",{style:{marginTop:12,marginBottom:12},children:(0,j.jsxs)(r.A,{style:{borderRadius:12,marginBottom:12,boxShadow:"0 8px 20px rgba(31, 41, 55, 0.06)"},children:[(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 12px"},children:[(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,j.jsx)(h.A.Title,{level:5,style:{margin:0},children:"Appointment Scheduling"}),(0,j.jsx)("div",{style:{color:"#6c757d",fontSize:13}})]}),(0,j.jsx)("div",{children:(0,j.jsx)(d.A,{value:z.format("YYYY-MM"),onChange:e=>{const[t,n]=e.split("-").map(e=>parseInt(e,10));isNaN(t)||isNaN(n)||M(Bn()().year(t).month(n-1).date(1))},className:"af-month-year-select",style:{minWidth:160},children:Array.from({length:12}).map((e,t)=>{const n=W.startOf("month").add(t,"month");return(0,j.jsx)(d.A.Option,{value:n.format("YYYY-MM"),children:n.format("MMMM YYYY")},n.format("YYYY-MM"))})})})]}),(0,j.jsx)("div",{style:{padding:"6px 12px 12px 12px",color:"#6c757d",fontSize:13},children:"Choose up to 3 preferred weekdays. Past dates and weekends are disabled."}),(0,j.jsxs)("div",{className:"af-main-calendar-area",style:{display:"flex",gap:20,alignItems:"stretch"},children:[(0,j.jsx)("div",{style:{flex:1,minWidth:420},children:(0,j.jsx)("div",{ref:f,className:"af-calendar-container",children:(0,j.jsx)(Ia.A,{fullscreen:!1,value:z,onChange:e=>{e&&M(e)},onSelect:e=>(e=>{if(!e)return;const t=V(e);if(!t)return;try{if(Bn()(t).isBefore(Bn()().startOf("day")))return void i.Ay.info("Cannot select past dates.")}catch(a){}const n="function"===typeof e.day?e.day():new Date(t).getDay();0!==n&&6!==n?J.has(t)?E(e=>e.includes(t)?e.filter(e=>e!==t):e.length>=3?(i.Ay.warning("You can select up to 3 appointment dates."),e):[...e,t].sort()):i.Ay.info("Only future weekdays within the next 30 available days can be selected."):i.Ay.info("Weekends (Saturday/Sunday) are not allowed.")})(e),headerRender:()=>null,dateFullCellRender:e=>{const t=V(e),n=J.has(t),a=F.includes(t),s=F.length>=3,i=Bn()(t).isSame(Bn()(),"day"),r="function"===typeof e.date?e.date():new Date(e).getDate();let l="af-date-unavailable";return a?l="af-date-selected":n&&(l="af-date-available"),(0,j.jsxs)("div",{className:"af-date-cell ".concat(l," ").concat(i?"af-today":""," ").concat(!n||s&&!a?"af-disabled":""),title:n?a?"Selected":s?"Selection limit reached":"Available":"Unavailable",children:[(0,j.jsx)("div",{className:"af-date-number",children:r}),i&&(0,j.jsx)(y.A,{title:"Today \u2014 not selectable",children:(0,j.jsx)("div",{className:"af-today-label",children:"Today"})})]})}})})}),(0,j.jsxs)("div",{className:"af-action-panel",style:{width:320,borderLeft:"1px solid #f0f0f0",paddingLeft:16,display:"flex",flexDirection:"column",justifyContent:"space-between"},children:[(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:12},children:[(0,j.jsxs)("strong",{children:["Selected Dates (",F.length,"/3)"]}),(0,j.jsxs)("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[(0,j.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,j.jsx)("span",{className:"af-legend af-legend-available"})," ",(0,j.jsx)("small",{children:"Available"})]}),(0,j.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,j.jsx)("span",{className:"af-legend af-legend-selected"})," ",(0,j.jsx)("small",{children:"Selected"})]}),(0,j.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,j.jsx)("span",{className:"af-legend af-legend-unavailable"})," ",(0,j.jsx)("small",{children:"Unavailable"})]})]})]}),(0,j.jsxs)("div",{className:"af-selected-panel",style:{marginBottom:12},children:[0===F.length&&(0,j.jsx)("div",{style:{color:"#8c8c8c"},children:"No dates selected"}),F.map(e=>(0,j.jsxs)("div",{className:"af-chip",children:[(0,j.jsx)("span",{style:{marginRight:8},children:Bn()(e).format("MMM DD, YYYY")}),(0,j.jsx)(u.Ay,{type:"link",size:"small",onClick:()=>E(t=>t.filter(t=>t!==e)),children:"\u2715"})]},e))]}),(0,j.jsxs)("div",{style:{display:"flex",gap:12,marginTop:8},children:[(0,j.jsx)(u.Ay,{type:"default",ghost:!0,onClick:()=>E([]),style:{borderRadius:8},children:"Clear"}),(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>{x.setFieldsValue({appointmentDates:F}),i.Ay.success("Appointment dates added to the inquiry")},disabled:0===F.length,style:{borderRadius:8},children:"Add Dates to Inquiry"})]})]})]})]})}),(0,j.jsx)(mt.A.Item,{children:(0,j.jsxs)(l.A,{justify:"end",gutter:[8,8],children:[(0,j.jsx)(o.A,{xs:24,sm:"auto",style:{display:"flex",justifyContent:"flex-end"},children:(0,j.jsx)(u.Ay,{type:"default",onClick:()=>{x.resetFields(),b(0),I(0),P([]),localStorage.removeItem(q)},block:!0,icon:(0,j.jsx)(_n.A,{}),style:{borderRadius:8,minWidth:120},children:"Reset"})}),(0,j.jsx)(o.A,{xs:24,sm:"auto",style:{display:"flex",justifyContent:"flex-end"},children:(0,j.jsx)(u.Ay,{type:"primary",loading:t,className:"inquiry-gradient-btn",block:!0,icon:(0,j.jsx)(C.A,{}),style:{borderRadius:8,fontWeight:600,fontSize:16,minWidth:160},onClick:async()=>{try{const e=await x.validateFields();B(e),R(!0)}catch(e){X()}},children:"Submit Inquiry"})})]})})]}),(0,j.jsx)(fe.A,{title:"Review your inquiry",open:_,onCancel:()=>R(!1),footer:[(0,j.jsx)(u.Ay,{onClick:()=>R(!1),children:"Edit"},"edit"),(0,j.jsx)(u.Ay,{type:"primary",onClick:async()=>{R(!1),await Q(U)},children:"Confirm & Submit"},"confirm")],children:U&&(0,j.jsxs)(Sa.A,{column:1,bordered:!0,children:[(0,j.jsx)(Sa.A.Item,{label:"Inquiry Type",children:U.type}),(0,j.jsx)(Sa.A.Item,{label:"Assign to Role",children:U.assignedRole}),(0,j.jsx)(Sa.A.Item,{label:"Subject",children:U.subject}),(0,j.jsx)(Sa.A.Item,{label:"Message",children:U.message}),(0,j.jsx)(Sa.A.Item,{label:"Attachments",children:(D||[]).map(e=>e.name||e.originFileObj&&e.originFileObj.name).join(", ")}),("SCHEDULE_APPOINTMENT"===U.type||U.appointmentDates&&U.appointmentDates.length)&&(0,j.jsx)(Sa.A.Item,{label:"Appointment Dates",children:(U.appointmentDates&&U.appointmentDates.length?U.appointmentDates:F).map((e,t)=>(0,j.jsx)("div",{style:{marginBottom:6},children:Bn()(e).format("MMM DD, YYYY")},e))})]})})]})})},Ta=()=>{const e=(0,xe.Zp)();return(0,j.jsxs)("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#f4f6fa"},children:[(0,j.jsx)("h1",{style:{color:"#722ed1",fontWeight:700,fontSize:32},children:"You have been logged out"}),(0,j.jsx)("p",{style:{fontSize:18,margin:"16px 0 32px"},children:"Thank you for using the Barangay Information System."}),(0,j.jsx)(u.Ay,{type:"primary",size:"large",onClick:()=>e("/login",{replace:!0}),children:"Log In Again"})]})},Da=()=>{const{logout:e}=_e(),t=(0,xe.Zp)();return(0,s.useEffect)(()=>{e(),t("/login",{replace:!0})},[e,t]),null};var Pa=n(69522);const _a=()=>{const[e,t]=(0,s.useState)(!1),[n,a]=(0,s.useState)([]),[i,r]=(0,s.useState)(null),[l,o]=(0,s.useState)(null),[c,m]=(0,s.useState)(null),x=(0,xe.Zp)();(0,s.useEffect)(()=>{(async()=>{t(!0);try{const e=await A.contactAPI.getAllInquiries();a(Array.isArray(e)?e:e&&e.items?e.items:[])}catch(e){console.error("Failed to load inquiries",e),nn.Ay.error({message:"Failed to load inquiries"}),a([])}finally{t(!1)}})()},[]);const g=(0,s.useMemo)(()=>Array.from(new Set(n.map(e=>e.type||"General"))),[n]),y=(0,s.useMemo)(()=>(n||[]).filter(e=>{if(i&&(!e.status||e.status.toString().toLowerCase()!==i.toLowerCase()))return!1;const t=e.type||"General";if(l&&t.toString().toLowerCase()!==l.toString().toLowerCase())return!1;if(c&&c[0]&&c[1]&&e.createdAt)try{const t=c[0].toDate?c[0].toDate():new Date(c[0]),n=c[1].toDate?c[1].toDate():new Date(c[1]),a=new Date(e.createdAt);if(a<t||a>n)return!1}catch(n){}return!0}),[n,i,l,c]);return(0,j.jsxs)("div",{children:[(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[(0,j.jsx)(h.A.Title,{level:4,style:{margin:0},children:"Inquiry Tracker"}),(0,j.jsxs)(h.A.Text,{type:"secondary",children:["Showing ",n.length," records"]})]}),(0,j.jsxs)(p.A,{spinning:e,children:[(0,j.jsx)("div",{style:{marginBottom:12,display:"flex",justifyContent:"flex-end"},children:(0,j.jsxs)(Oe.A,{children:[(0,j.jsxs)(d.A,{allowClear:!0,placeholder:"Status",style:{width:160},value:null!==i&&void 0!==i?i:void 0,onChange:e=>r(e||null),children:[(0,j.jsx)(d.A.Option,{value:"open",children:"Open"}),(0,j.jsx)(d.A.Option,{value:"in-progress",children:"In Progress"}),(0,j.jsx)(d.A.Option,{value:"resolved",children:"Resolved"})]}),(0,j.jsx)(d.A,{allowClear:!0,placeholder:"Type",style:{width:180},value:null!==l&&void 0!==l?l:void 0,onChange:e=>o(e||null),children:g.map(e=>(0,j.jsx)(d.A.Option,{value:e,children:e},e))}),(0,j.jsx)(Tn.A.RangePicker,{onChange:e=>m(e?e.filter(Boolean):null)}),(0,j.jsx)(u.Ay,{onClick:()=>{r(null),o(null),m(null)},children:"Reset"})]})}),0!==y.length||e?(0,j.jsxs)(Jt.A,{dataSource:y.slice().sort((e,t)=>(new Date(t.createdAt).getTime()||0)-(new Date(e.createdAt).getTime()||0)),rowKey:e=>e._id,pagination:{pageSize:12},onRow:e=>({onClick:()=>{x("/staff/inbox",{state:{openInquiryId:e._id}})}}),children:[(0,j.jsx)(Jt.A.Column,{title:"Name",dataIndex:"username",render:(e,t)=>e||t.residentName||t.subject||"Unknown"},"username"),(0,j.jsx)(Jt.A.Column,{title:"Type of Inquiry",dataIndex:"type",render:e=>e?String(e):"General"},"type"),(0,j.jsx)(Jt.A.Column,{title:"Status",dataIndex:"status",render:e=>(e=>{const t=(e||"").toString().toLowerCase();return(0,j.jsx)(f.A,{color:{pending:"gold",open:"gold",approved:"success",resolved:"green",rejected:"error"}[t]||"default",children:(e||"").toUpperCase()||"UNKNOWN"})})(e)},"status"),(0,j.jsx)(Jt.A.Column,{title:"Date Inquired",dataIndex:"createdAt",render:e=>(0,Pa.Y)(e)},"createdAt"),(0,j.jsx)(Jt.A.Column,{title:"Date Resolved",dataIndex:"updatedAt",render:(e,t)=>t.status&&"resolved"===t.status.toString().toLowerCase()?(0,Pa.Y)(e):""},"updatedAt")]}):(0,j.jsx)(rn.A,{description:"No inquiries"})]})]})};var Ra=n(67818),Ua=n(59949);const Ba=e=>{let{visible:t,onClose:n,onCreated:a,defaultBarangayID:r,defaultUsername:l,defaultEmail:o}=e;const[d]=mt.A.useForm(),[u,h]=s.useState(!1);s.useEffect(()=>{t?d.setFieldsValue({barangayID:r||void 0,username:l||void 0,email:o||void 0}):d.resetFields()},[t,r,l,o,d]);return(0,j.jsx)(fe.A,{title:"Create Resident Info",open:t,onOk:async()=>{try{const e=await d.validateFields();h(!0);const t={firstName:e.firstName,lastName:e.lastName,barangayID:r||e.barangayID||"",username:l||e.username||"",email:o||e.email||""},s=await A.axiosInstance.put("/resident/personal-info",t);i.Ay.success("Resident container created"),a(s.data),d.resetFields(),n()}catch(s){var e,t;console.error("Failed to create resident container",s),null!==s&&void 0!==s&&null!==(e=s.response)&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.message?i.Ay.error(s.response.data.message):i.Ay.error("Failed to create resident container")}finally{h(!1)}},onCancel:()=>{d.resetFields(),n()},confirmLoading:u,children:(0,j.jsxs)(mt.A,{form:d,layout:"vertical",children:[(0,j.jsx)(mt.A.Item,{name:"firstName",label:"First name",rules:[{required:!0,message:"First name is required"}],children:(0,j.jsx)(c.A,{})}),(0,j.jsx)(mt.A.Item,{name:"lastName",label:"Last name",rules:[{required:!0,message:"Last name is required"}],children:(0,j.jsx)(c.A,{})}),(0,j.jsx)(mt.A.Item,{name:"barangayID",label:"Barangay ID",children:(0,j.jsx)(c.A,{disabled:!0})}),(0,j.jsx)(mt.A.Item,{name:"username",label:"Username",children:(0,j.jsx)(c.A,{disabled:!0})}),(0,j.jsx)(mt.A.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Invalid email"}],children:(0,j.jsx)(c.A,{disabled:!0})})]})})};function qa(){const[e,t]=(0,s.useState)(null),[n,m]=(0,s.useState)(!1),[p,x]=(0,s.useState)(!1),[g,f]=(0,s.useState)(null),[b,w]=(0,s.useState)(null),[I,S]=(0,s.useState)(null),[C,k]=(0,s.useState)([]),[N,T]=(0,s.useState)([]),[D,P]=(0,s.useState)([]),[_,R]=(0,s.useState)(!1),[U,B]=(0,s.useState)(0),q=(0,s.useRef)(new Set),{setUser:L}=_e(),O=async()=>{try{const n=await A.axiosInstance.get("/resident/profile");if(n&&n.data){const a=n.data&&(n.data.user||n.data.profile)?n.data.user||n.data.profile:n.data;if(z(a),Y(a),null!==a&&void 0!==a&&a.profileImage){const e=a.profileImage.startsWith("http")?a.profileImage:"".concat(window.location.origin).concat(a.profileImage);t(e)}try{"function"===typeof L&&L(a)}catch(e){}i.Ay.success("Profile synchronized")}}catch(n){console.warn("Failed to refresh profile",n),i.Ay.error("Failed to refresh profile")}},{t:F}=(0,Ra.Bd)(),[E,z]=(0,s.useState)(null),[,M]=(0,s.useState)([]),[W,Y]=(0,s.useState)(null),[V,H]=(0,s.useState)(!1),[G,K]=(0,s.useState)(!1),[J,$]=(0,s.useState)(!1),[Q,X]=(0,s.useState)(!1),[te,ne]=(0,s.useState)(null),[ae,se]=(0,s.useState)(null),[ie,re]=(0,s.useState)("");(0,s.useEffect)(()=>{A.axiosInstance.get("/resident/profile").then(e=>{var n;if(z(e.data),Y(e.data),null!==(n=e.data)&&void 0!==n&&n.profileImage){const n=e.data.profileImage.startsWith("http")?e.data.profileImage:"".concat(window.location.origin).concat(e.data.profileImage);t(n)}}),A.residentPersonalInfoAPI.getPersonalInfo().then(e=>{if(ne(e),se(e),null!==e&&void 0!==e&&e.profileImage){const n=e.profileImage.startsWith("http")?e.profileImage:"".concat(window.location.origin).concat(e.profileImage);t(n)}}).catch(e=>{e.response&&404===e.response.status&&(m(!0),ne(null),se({firstName:"",lastName:"",age:void 0,birthDate:"",dateOfResidency:"",sex:"",civilStatus:"",facebook:"",email:"",contactNumber:"",emergencyContact:"",landlineNumber:"",spouseName:"",spouseAge:void 0,spouseBirthDate:"",spouseOccupation:"",spouseStatus:"",motherName:"",motherAge:void 0,motherBirthDate:"",motherOccupation:"",motherStatus:"",fatherName:"",fatherAge:void 0,fatherBirthDate:"",fatherOccupation:"",fatherStatus:""}))});try{A.axiosInstance.get("/resident/requests").then(e=>M(e.data)).catch(e=>{e&&e.response&&401===e.response.status||console.warn("Failed to load resident requests",e)})}catch(e){}(async()=>{try{const e=await A.verificationAPI.getMyRequests();if(Array.isArray(e)&&e.length>0){const t=e.find(e=>"pending"===e.status)||e[0];if(t){const e=t.filesMeta||[],n=(e,t)=>{if(!e||!e.gridFileId)return null;const n=A.verificationAPI.getFileUrl(e.gridFileId);return{uid:"remote-".concat(t,"-").concat(e.gridFileId),name:e.filename||"file-".concat(t+1),status:"done",url:n,thumbUrl:e.filename&&/\.(png|jpe?g|gif|webp)$/i.test(e.filename)?n:void 0}};k(e[0]?[n(e[0],0)].filter(Boolean):[]),T(e[1]?[n(e[1],1)].filter(Boolean):[]),P(e[2]?[n(e[2],2)].filter(Boolean):[])}}}catch(e){}})();try{jn();const t=e=>{try{const t=(null===e||void 0===e?void 0:e.data)||e,n=t&&(t.user||t.profile)?t.user||t.profile:t;if(!n)return;z(e=>{const t=(0,a.A)((0,a.A)({},e||{}),n);try{"function"===typeof L&&L(t)}catch(s){}return t})}catch(t){}};vn("profile",t),vn("verification-request-deleted",t),window.__residentPortalSocketCleanup=()=>{try{bn("profile",t)}catch(e){}try{bn("verification-request-deleted",t)}catch(e){}}}catch(n){}},[]),(0,s.useEffect)(()=>{const e=q.current;return()=>{try{e.forEach(e=>{try{URL.revokeObjectURL(e)}catch(t){}})}catch(t){}try{e.clear()}catch(n){}}},[]),(0,s.useEffect)(()=>()=>{try{const t=window.__residentPortalSocketCleanup;"function"===typeof t&&t();try{delete window.__residentPortalSocketCleanup}catch(e){}}catch(t){}},[]);(0,s.useEffect)(()=>{const e=()=>{const e=(new Date).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/,/g,"");re(e)};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[]);const le=e=>{W&&Y((0,a.A)((0,a.A)({},W),{},{[e.target.name]:e.target.value}))},oe=e=>{ae&&se((0,a.A)((0,a.A)({},ae),{},{[e.target.name]:e.target.value}))};return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{className:"max-w-3xl mx-auto p-6",children:[(0,j.jsx)(r.A,{style:{background:"linear-gradient(90deg, #f7f8fa 0%, #e0e7ff 100%)",borderRadius:16,boxShadow:"0 4px 24px #40c9ff22",marginBottom:32,border:"none",padding:0},bodyStyle:{padding:"24px 32px",display:"flex",alignItems:"center",justifyContent:"space-between"},bordered:!1,children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:18},children:[(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:8},children:[(0,j.jsx)(Z.A,{showUploadList:!1,accept:"image/*",customRequest:async e=>{const{file:n,onSuccess:a,onError:s}=e||{};try{await(async e=>{if(!e)return;const n=new FileReader;n.onload=e=>{var n;return t(null===(n=e.target)||void 0===n?void 0:n.result)},n.readAsDataURL(e);const a=new FormData;a.append("avatar",e);try{var s,r;const e=await A.axiosInstance.post("/resident/personal-info/avatar",a,{headers:{"Content-Type":"multipart/form-data"}}),n=null===(s=e.data)||void 0===s?void 0:s.resident,o=null===(r=e.data)||void 0===r?void 0:r.user;if(n){if(ne(n),se(n),n.profileImage){const e=n.profileImage.startsWith("http")?n.profileImage:"".concat(window.location.origin).concat(n.profileImage);t(e)}m(!1),i.Ay.success("Profile image updated")}else i.Ay.success("Profile image updated");if(o){try{"function"===typeof L?L(o):localStorage.setItem("userProfile",JSON.stringify(o))}catch(l){}try{const e=new CustomEvent("userProfileUpdated",{detail:o});window.dispatchEvent(e)}catch(l){}}}catch(l){i.Ay.error("Failed to upload avatar")}})(n),"function"===typeof a&&a("ok")}catch(r){"function"===typeof s&&s(r)}},children:(0,j.jsx)("div",{className:"resident-banner-avatar clickable",role:"button",tabIndex:0,"aria-label":"Upload profile picture",title:"Upload profile picture",onKeyDown:e=>{const t=e&&e.key||"";"Enter"!==t&&" "!==t||e.target.click()},children:e?(0,j.jsx)("img",{src:e,alt:"avatar",className:"resident-banner-avatar__img"}):(0,j.jsx)(v,{user:(()=>{let e=E;if(!e)try{const t=localStorage.getItem("userProfile");t&&(e=JSON.parse(t))}catch(t){}return e})(),size:96,className:"resident-banner-avatar__img"})})}),(0,j.jsx)("div",{style:{marginTop:4},children:(0,j.jsx)(h.A.Text,{type:"secondary",children:ie})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Title,{level:3,style:{margin:0,fontWeight:800},children:(null===E||void 0===E?void 0:E.username)||(null===E||void 0===E?void 0:E.email)||"Resident"}),(0,j.jsxs)(h.A.Text,{type:"secondary",children:["Barangay ID: ",(null===E||void 0===E?void 0:E.barangayID)||"N/A"]})]})]})}),(0,j.jsx)(r.A,{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e3e6f3 40%, #f6f1f7 100%)",borderRadius:20,boxShadow:"0 8px 32px #bfc7d6cc",marginBottom:32,border:"none",backdropFilter:"blur(2px)"},bodyStyle:{padding:40},bordered:!1,children:(0,j.jsxs)("div",{style:{maxWidth:900,margin:"0 auto"},children:[(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:16},children:(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",gap:12},children:(0,j.jsx)(h.A.Title,{level:3,style:{fontWeight:900,margin:0,letterSpacing:1,textAlign:"left",fontSize:28,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Verification Documents"})})}),(0,j.jsxs)(mt.A,{layout:"vertical",children:[(0,j.jsxs)(l.A,{gutter:24,children:[(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:["Proof of Residency",(0,j.jsx)(y.A,{title:"Upload a document showing your address (e.g., utility bill, lease, or bank statement).",children:(0,j.jsx)(Lt.A,{style:{color:"#888"}})})]}),children:(0,j.jsx)(Z.A,{accept:"image/*,application/pdf",fileList:C,beforeUpload:e=>!1,onChange:e=>{const t=(null===e||void 0===e?void 0:e.fileList)||[];C.forEach(e=>{if(e&&e.thumbUrl){try{URL.revokeObjectURL(String(e.thumbUrl))}catch(t){}q.current.delete(String(e.thumbUrl))}});const n=(t||[]).slice(-1);n.forEach(e=>{if(e.originFileObj&&!e.thumbUrl&&e.type&&e.type.startsWith("image/")){const t=URL.createObjectURL(e.originFileObj);e.thumbUrl=t,q.current.add(t)}}),k(n),f(n[0]&&n[0].originFileObj||null)},listType:"picture-card",showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0},maxCount:1,children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,j.jsx)(ee.A,{})," ",(0,j.jsx)("span",{style:{fontWeight:600},children:"Select Proof"})]})})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:["Government-issued ID",(0,j.jsx)(y.A,{title:"Upload a government-issued ID such as passport, driver's license, or national ID.",children:(0,j.jsx)(Lt.A,{style:{color:"#888"}})})]}),children:(0,j.jsx)(Z.A,{accept:"image/*,application/pdf",fileList:N,beforeUpload:e=>!1,onChange:e=>{const t=(null===e||void 0===e?void 0:e.fileList)||[];N.forEach(e=>{if(e&&e.thumbUrl){try{URL.revokeObjectURL(String(e.thumbUrl))}catch(t){}q.current.delete(String(e.thumbUrl))}});const n=(t||[]).slice(-1);n.forEach(e=>{if(e.originFileObj&&!e.thumbUrl&&e.type&&e.type.startsWith("image/")){const t=URL.createObjectURL(e.originFileObj);e.thumbUrl=t,q.current.add(t)}}),T(n),w(n[0]&&n[0].originFileObj||null)},listType:"picture-card",showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0},maxCount:1,children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,j.jsx)(ee.A,{})," ",(0,j.jsx)("span",{style:{fontWeight:600},children:"Select ID"})]})})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:["Selfie with ID",(0,j.jsx)(y.A,{title:"Take a clear photo of yourself holding your government ID next to your face.",children:(0,j.jsx)(Lt.A,{style:{color:"#888"}})})]}),children:(0,j.jsx)(Z.A,{accept:"image/*",fileList:D,beforeUpload:e=>!1,onChange:e=>{const t=(null===e||void 0===e?void 0:e.fileList)||[];D.forEach(e=>{if(e&&e.thumbUrl){try{URL.revokeObjectURL(String(e.thumbUrl))}catch(t){}q.current.delete(String(e.thumbUrl))}});const n=(t||[]).slice(-1);n.forEach(e=>{if(e.originFileObj&&!e.thumbUrl&&e.type&&e.type.startsWith("image/")){const t=URL.createObjectURL(e.originFileObj);e.thumbUrl=t,q.current.add(t)}}),P(n),S(n[0]&&n[0].originFileObj||null)},listType:"picture-card",showUploadList:{showPreviewIcon:!0,showRemoveIcon:!0},maxCount:1,children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,j.jsx)(ee.A,{})," ",(0,j.jsx)("span",{style:{fontWeight:600},children:"Select Selfie"})]})})})})]}),(0,j.jsx)(l.A,{gutter:24,style:{marginTop:16},children:(0,j.jsxs)(o.A,{span:24,style:{display:"flex",justifyContent:"flex-start",gap:12},children:[(0,j.jsx)(u.Ay,{type:"dashed",onClick:()=>{[...C,...N,...D].forEach(e=>{if(e&&e.thumbUrl){try{URL.revokeObjectURL(String(e.thumbUrl))}catch(t){}q.current.delete(String(e.thumbUrl))}}),f(null),w(null),S(null),k([]),T([]),P([])},children:"Clear"}),(0,j.jsx)(u.Ay,{type:"primary",loading:_,disabled:!(g&&b&&I),onClick:async()=>{if(g||b||I)if(E&&E.verified)i.Ay.info("Your account is already verified; no need to upload verification documents.");else{try{const e=await A.axiosInstance.get("/resident/profile"),t=null===e||void 0===e?void 0:e.data,n=t&&(t.user||t.profile)?t.user||t.profile:t;if(n&&n.verified)return void i.Ay.info("Your account is already verified; no need to upload verification documents.")}catch(n){if(null!==n&&void 0!==n&&n.response&&401===n.response.status)return void i.Ay.error("Authentication required. Please login and try again.")}R(!0),B(0);try{const e=new FormData;g&&e.append("ids",g,g.name),b&&e.append("ids",b,b.name),I&&e.append("ids",I,I.name),g&&e.append("fileTypes","proof"),b&&e.append("fileTypes","govid"),I&&e.append("fileTypes","selfie");const t=(null===W||void 0===W?void 0:W.barangayID)||(null===E||void 0===E?void 0:E.barangayID)||"";t&&e.append("barangayID",t),await A.axiosInstance.post("/verification/upload",e,{headers:{"Content-Type":"multipart/form-data"},onUploadProgress:e=>{const t="number"===typeof(null===e||void 0===e?void 0:e.loaded)?e.loaded:0,n="number"===typeof(null===e||void 0===e?void 0:e.total)?e.total:0;if(n>0){const e=Math.min(100,Math.round(t/n*100));B(e)}}}),i.Ay.success("Verification documents uploaded");try{await O()}catch(a){}try{const e=await A.verificationAPI.getMyRequests();if(Array.isArray(e)&&e.length>0){const t=(e.find(e=>"pending"===e.status)||e[0]).filesMeta||[],n=(e,t)=>{if(!e||!e.gridFileId)return null;const n=A.verificationAPI.getFileUrl(e.gridFileId);return{uid:"remote-".concat(t,"-").concat(e.gridFileId),name:e.filename||"file-".concat(t+1),status:"done",url:n,thumbUrl:e.filename&&/\.(png|jpe?g|gif|webp)$/i.test(e.filename)?n:void 0}};k(t[0]?[n(t[0],0)].filter(Boolean):[]),T(t[1]?[n(t[1],1)].filter(Boolean):[]),P(t[2]?[n(t[2],2)].filter(Boolean):[]),f(null),w(null),S(null)}}catch(a){}B(100)}catch(n){var e,t;console.error("Verification upload failed",n);const a=(null===n||void 0===n||null===(e=n.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||(null===n||void 0===n?void 0:n.message);null!==n&&void 0!==n&&n.response&&400===n.response.status&&a?i.Ay.error(String(a)):null!==n&&void 0!==n&&n.response&&401===n.response.status?i.Ay.error("Authentication required. Please login and try again."):i.Ay.error("Failed to upload verification documents")}finally{R(!1)}}else i.Ay.warning("Please select at least one document to upload")},children:"Upload Verification Documents"})]})}),(_||U>0)&&(0,j.jsx)(l.A,{gutter:24,style:{marginTop:12},children:(0,j.jsx)(o.A,{span:24,children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,j.jsx)("div",{style:{flex:1},children:(0,j.jsx)(qt.A,{percent:U,status:U<100?"active":"success",strokeColor:{"0%":"#e81cff","100%":"#40c9ff"}})}),(0,j.jsx)("div",{style:{minWidth:110},children:(0,j.jsx)(h.A.Text,{type:"secondary",children:_?"Uploading (".concat(U,"%)"):100===U?"Upload complete":""})})]})})})]})]})}),n&&(0,j.jsx)("div",{style:{marginBottom:16},children:(0,j.jsx)(Mn.A,{message:"Your resident profile is incomplete",description:(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{children:"We couldn't find your resident information. Please create your resident profile so you can upload documents and profile pictures."}),(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>x(!0),children:"Create Resident Info"})]}),showIcon:!0})}),(0,j.jsx)(Ba,{visible:p,onClose:()=>x(!1),onCreated:e=>{ne(e),se(e),m(!1)},defaultBarangayID:(null===E||void 0===E?void 0:E.barangayID)||"",defaultUsername:(null===E||void 0===E?void 0:E.username)||"",defaultEmail:(null===E||void 0===E?void 0:E.email)||""}),(0,j.jsx)(r.A,{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e3e6f3 40%, #f6f1f7 100%)",borderRadius:20,boxShadow:"0 8px 32px #bfc7d6cc",marginBottom:32,border:"none",backdropFilter:"blur(2px)"},bodyStyle:{padding:40},bordered:!1,children:(0,j.jsxs)("div",{style:{maxWidth:900,margin:"0 auto"},children:[(0,j.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:24,letterSpacing:1,textAlign:"left",fontSize:28,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:F("userInformation")}),W&&(0,j.jsxs)(mt.A,{layout:"vertical",children:[(0,j.jsxs)(l.A,{gutter:24,children:[(0,j.jsx)(o.A,{xs:24,sm:12,children:(0,j.jsx)(mt.A.Item,{label:F("username"),children:(0,j.jsx)(c.A,{name:"username",value:(null===W||void 0===W?void 0:W.username)||"",onChange:le,disabled:!J})})}),(0,j.jsx)(o.A,{xs:24,sm:12,children:(0,j.jsx)(mt.A.Item,{label:F("email"),children:(0,j.jsx)(c.A,{name:"email",value:(null===W||void 0===W?void 0:W.email)||"",onChange:le,disabled:!J})})})]}),(0,j.jsxs)(l.A,{gutter:24,children:[(0,j.jsx)(o.A,{xs:24,sm:12,children:(0,j.jsx)(mt.A.Item,{label:F("address"),children:(0,j.jsx)(c.A,{name:"address",value:(null===W||void 0===W?void 0:W.address)||"",onChange:le,disabled:!J})})}),(0,j.jsx)(o.A,{xs:24,sm:12,children:(0,j.jsx)(mt.A.Item,{label:F("contactNumber"),children:(0,j.jsx)(c.A,{name:"contactNumber",value:(null===W||void 0===W?void 0:W.contactNumber)||"",onChange:le,disabled:!J})})})]}),(0,j.jsxs)(l.A,{gutter:24,children:[(0,j.jsx)(o.A,{xs:24,sm:12,children:(0,j.jsx)(mt.A.Item,{label:F("barangayID")||"Barangay ID",children:(0,j.jsx)(c.A,{name:"barangayID",value:(null===W||void 0===W?void 0:W.barangayID)||"",disabled:!0})})}),(0,j.jsx)(o.A,{xs:24,sm:12,children:(0,j.jsx)(mt.A.Item,{label:F("role")||"Role",children:(0,j.jsx)(c.A,{name:"role",value:(null===W||void 0===W?void 0:W.role)||"",disabled:!0})})})]}),(0,j.jsxs)(Oe.A,{style:{marginTop:24},children:[J?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(u.Ay,{type:"primary",onClick:async()=>{if(W)try{const e=(()=>{let e=W.firstName||"",t=W.lastName||"";if((!e||!t)&&E&&E.fullName){const n=E.fullName.trim().split(" ");e=e||n[0]||"",t=t||(n.length>1?n.slice(1).join(" "):"")}return e=e||(null===E||void 0===E?void 0:E.username)||(null===E||void 0===E?void 0:E.email)||"Resident",t=t||"User",{first:e,last:t}})(),t={firstName:e.first,lastName:e.last,barangayID:(null===W||void 0===W?void 0:W.barangayID)||(null===E||void 0===E?void 0:E.barangayID)||"",email:(null===W||void 0===W?void 0:W.email)||(null===E||void 0===E?void 0:E.email)||"",contactNumber:(null===W||void 0===W?void 0:W.contactNumber)||(null===E||void 0===E?void 0:E.contactNumber)||"",address:(null===W||void 0===W?void 0:W.address)||(null===E||void 0===E?void 0:E.address)||""},n=await A.axiosInstance.put("/resident/personal-info",t);n&&n.data?z((0,a.A)((0,a.A)({},E),n.data)):z((0,a.A)((0,a.A)({},E),t)),$(!1),i.Ay.success("Profile saved")}catch(e){if(console.error("Failed to save user info:",e),null!==e&&void 0!==e&&e.response&&e.response.data){const t=e.response.data;if(t.errors){const e=Object.values(t.errors).map(e=>e.toString()).join("; ");i.Ay.error(e||t.message||"Validation error")}else i.Ay.error(t.message||"Failed to save")}else i.Ay.error("Failed to save user info")}},style:{background:"linear-gradient(90deg, #43e97b 0%, #38f9d7 100%)",border:"none",fontWeight:600},children:"Save"}),(0,j.jsx)(u.Ay,{onClick:()=>{$(!1),Y(E)},children:"Cancel"})]}):(0,j.jsx)(u.Ay,{onClick:()=>$(!0),style:{fontWeight:600},children:"Edit"}),(0,j.jsx)(u.Ay,{type:"dashed",onClick:async()=>{K(!0);try{var e;const t=await A.axiosInstance.post("/resident/request-staff-access"),n=(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.message)||"Request sent to admin for staff access";!t||200!==t.status&&201!==t.status?i.Ay.info(n):(i.Ay.success(n),H(!0))}catch(a){var t,n;console.error("Request staff access failed:",a);const e=a,s=(null===e||void 0===e||null===(t=e.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||(null===e||void 0===e?void 0:e.message)||"Failed to send staff access request";i.Ay.error(s)}finally{K(!1)}},disabled:V||G,style:{color:"#341f97",borderColor:"#341f97",fontWeight:600},children:V?"Request Sent":"Request Staff Access"})]})]})]})}),ae&&(0,j.jsx)(r.A,{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e3e6f3 40%, #f6f1f7 100%)",borderRadius:20,boxShadow:"0 8px 32px #bfc7d6cc",marginBottom:32,border:"none",backdropFilter:"blur(2px)"},bodyStyle:{padding:40},bordered:!1,children:(0,j.jsxs)(mt.A,{layout:"vertical",style:{maxWidth:900,margin:"0 auto"},children:[(0,j.jsx)(h.A.Title,{level:2,style:{fontWeight:900,marginBottom:24,letterSpacing:1,textAlign:"left",fontSize:34,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Resident Information"}),(0,j.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Personal Information"}),(0,j.jsxs)(l.A,{gutter:24,children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"First Name",children:(0,j.jsx)(c.A,{name:"firstName",value:(null===ae||void 0===ae?void 0:ae.firstName)||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Middle Name",children:(0,j.jsx)(c.A,{name:"middleName",value:(null===ae||void 0===ae?void 0:ae.middleName)||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Last Name",children:(0,j.jsx)(c.A,{name:"lastName",value:(null===ae||void 0===ae?void 0:ae.lastName)||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Age",children:(0,j.jsx)(c.A,{name:"age",type:"number",value:(null===ae||void 0===ae?void 0:ae.age)||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Birth Date",children:(0,j.jsx)(c.A,{name:"birthDate",type:"date",value:ae.birthDate||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Place of Birth",children:(0,j.jsx)(c.A,{name:"placeOfBirth",value:ae.placeOfBirth||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Nationality",children:(0,j.jsx)(c.A,{name:"nationality",value:ae.nationality||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Religion",children:(0,j.jsx)(c.A,{name:"religion",value:ae.religion||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Date of Residency",children:(0,j.jsx)(c.A,{name:"dateOfResidency",type:"date",value:ae.dateOfResidency||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Sex",children:(0,j.jsxs)(d.A,{value:ae.sex||"",onChange:e=>se(t=>t?(0,a.A)((0,a.A)({},t),{},{sex:e}):t),disabled:!Q,children:[(0,j.jsx)(d.A.Option,{value:"",children:"Select"}),(0,j.jsx)(d.A.Option,{value:"Male",children:"Male"}),(0,j.jsx)(d.A.Option,{value:"Female",children:"Female"}),(0,j.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Blood Type",children:(0,j.jsx)(c.A,{name:"bloodType",value:ae.bloodType||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Disability Status",children:(0,j.jsx)(c.A,{name:"disabilityStatus",value:ae.disabilityStatus||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Passport Number",children:(0,j.jsx)(c.A,{name:"passportNumber",value:ae.passportNumber||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Government ID Number",children:(0,j.jsx)(c.A,{name:"governmentIdNumber",value:ae.governmentIdNumber||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Occupation",children:(0,j.jsx)(c.A,{name:"occupation",value:ae.occupation||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Educational Attainment",children:(0,j.jsx)(c.A,{name:"educationalAttainment",value:ae.educationalAttainment||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsx)(l.A,{gutter:16,children:(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Civil Status",children:(0,j.jsxs)(d.A,{value:ae.civilStatus||"",onChange:e=>se(t=>t?(0,a.A)((0,a.A)({},t),{},{civilStatus:e}):t),disabled:!Q,children:[(0,j.jsx)(d.A.Option,{value:"",children:"Select"}),(0,j.jsx)(d.A.Option,{value:"Single",children:"Single"}),(0,j.jsx)(d.A.Option,{value:"Married",children:"Married"}),(0,j.jsx)(d.A.Option,{value:"Widowed",children:"Widowed"}),(0,j.jsx)(d.A.Option,{value:"Divorced",children:"Divorced"}),(0,j.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,j.jsx)(d.A.Option,{value:"Annulled",children:"Annulled"}),(0,j.jsx)(d.A.Option,{value:"Domestic Partnership",children:"Domestic Partnership"}),(0,j.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})})}),(0,j.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Social Media Information"}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:24,md:24,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Facebook",children:(0,j.jsx)(c.A,{name:"facebook",value:ae.facebook||"",onChange:oe,disabled:!Q,placeholder:"Facebook profile/link"})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:24,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Valid Email",children:(0,j.jsx)(c.A,{name:"email",type:"email",value:ae.email||"",onChange:oe,disabled:!Q,placeholder:"Email address"})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:24,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Contact Number",children:(0,j.jsx)(c.A,{name:"contactNumber",type:"number",value:ae.contactNumber||"",onChange:oe,disabled:!Q,placeholder:"Contact No."})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:24,md:24,lg:12,children:(0,j.jsx)(mt.A.Item,{label:"Emergency Contact",children:(0,j.jsx)(c.A,{name:"emergencyContact",type:"number",value:ae.emergencyContact||"",onChange:oe,disabled:!Q,placeholder:"Emergency contact number"})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:24,lg:12,children:(0,j.jsx)(mt.A.Item,{label:"Landline Number",children:(0,j.jsx)(c.A,{name:"landlineNumber",type:"number",value:ae.landlineNumber||"",onChange:oe,disabled:!Q,placeholder:"Landline number"})})})]}),(0,j.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Family Information"}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Spouse Name",children:(0,j.jsx)(c.A,{name:"spouseName",value:ae.spouseName||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Spouse Middle Name",children:(0,j.jsx)(c.A,{name:"spouseMiddleName",value:ae.spouseMiddleName||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Spouse Last Name",children:(0,j.jsx)(c.A,{name:"spouseLastName",value:ae.spouseLastName||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Spouse Age",children:(0,j.jsx)(c.A,{name:"spouseAge",type:"number",value:ae.spouseAge||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Spouse Birthdate",children:(0,j.jsx)(c.A,{name:"spouseBirthDate",type:"date",value:ae.spouseBirthDate||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Spouse Nationality",children:(0,j.jsx)(c.A,{name:"spouseNationality",value:ae.spouseNationality||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Spouse Occupation",children:(0,j.jsx)(c.A,{name:"spouseOccupation",value:ae.spouseOccupation||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Spouse Contact Number",children:(0,j.jsx)(c.A,{name:"spouseContactNumber",value:ae.spouseContactNumber||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Spouse Status",children:(0,j.jsxs)(d.A,{value:ae.spouseStatus||"",onChange:e=>se(t=>t?(0,a.A)((0,a.A)({},t),{},{spouseStatus:e}):t),disabled:!Q,children:[(0,j.jsx)(d.A.Option,{value:"",children:"Select status"}),(0,j.jsx)(d.A.Option,{value:"Alive",children:"Alive"}),(0,j.jsx)(d.A.Option,{value:"Deceased",children:"Deceased"}),(0,j.jsx)(d.A.Option,{value:"Unknown",children:"Unknown"}),(0,j.jsx)(d.A.Option,{value:"Missing",children:"Missing"}),(0,j.jsx)(d.A.Option,{value:"Abroad",children:"Abroad"}),(0,j.jsx)(d.A.Option,{value:"With Family",children:"With Family"}),(0,j.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,j.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Number of Children",children:(0,j.jsx)(c.A,{name:"numberOfChildren",type:"number",value:ae.numberOfChildren||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Children's Names",children:(0,j.jsx)(c.A,{name:"childrenNames",value:ae.childrenNames||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Children's Ages",children:(0,j.jsx)(c.A,{name:"childrenAges",value:ae.childrenAges||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Emergency Contact Name",children:(0,j.jsx)(c.A,{name:"emergencyContactName",value:ae.emergencyContactName||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(mt.A.Item,{label:"Emergency Contact Relationship",children:(0,j.jsx)(c.A,{name:"emergencyContactRelationship",value:ae.emergencyContactRelationship||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Mother's Name",children:(0,j.jsx)(c.A,{name:"motherName",value:ae.motherName||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Mother's Age",children:(0,j.jsx)(c.A,{name:"motherAge",type:"number",value:ae.motherAge||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Mother's Birthdate",children:(0,j.jsx)(c.A,{name:"motherBirthDate",type:"date",value:ae.motherBirthDate||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Mother's Occupation",children:(0,j.jsx)(c.A,{name:"motherOccupation",value:ae.motherOccupation||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Mother's Status",children:(0,j.jsxs)(d.A,{value:ae.motherStatus||"",onChange:e=>se(t=>t?(0,a.A)((0,a.A)({},t),{},{motherStatus:e}):t),disabled:!Q,children:[(0,j.jsx)(d.A.Option,{value:"",children:"Select status"}),(0,j.jsx)(d.A.Option,{value:"Alive",children:"Alive"}),(0,j.jsx)(d.A.Option,{value:"Deceased",children:"Deceased"}),(0,j.jsx)(d.A.Option,{value:"Unknown",children:"Unknown"}),(0,j.jsx)(d.A.Option,{value:"Missing",children:"Missing"}),(0,j.jsx)(d.A.Option,{value:"Abroad",children:"Abroad"}),(0,j.jsx)(d.A.Option,{value:"With Family",children:"With Family"}),(0,j.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,j.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Father's Name",children:(0,j.jsx)(c.A,{name:"fatherName",value:ae.fatherName||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Father's Age",children:(0,j.jsx)(c.A,{name:"fatherAge",type:"number",value:ae.fatherAge||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Father's Birthdate",children:(0,j.jsx)(c.A,{name:"fatherBirthDate",type:"date",value:ae.fatherBirthDate||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Father's Occupation",children:(0,j.jsx)(c.A,{name:"fatherOccupation",value:ae.fatherOccupation||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Father's Status",children:(0,j.jsxs)(d.A,{value:ae.fatherStatus||"",onChange:e=>se(t=>t?(0,a.A)((0,a.A)({},t),{},{fatherStatus:e}):t),disabled:!Q,children:[(0,j.jsx)(d.A.Option,{value:"",children:"Select status"}),(0,j.jsx)(d.A.Option,{value:"Alive",children:"Alive"}),(0,j.jsx)(d.A.Option,{value:"Deceased",children:"Deceased"}),(0,j.jsx)(d.A.Option,{value:"Unknown",children:"Unknown"}),(0,j.jsx)(d.A.Option,{value:"Missing",children:"Missing"}),(0,j.jsx)(d.A.Option,{value:"Abroad",children:"Abroad"}),(0,j.jsx)(d.A.Option,{value:"With Family",children:"With Family"}),(0,j.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,j.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})})]}),(0,j.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Business Information"}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Business Name",children:(0,j.jsx)(c.A,{name:"businessName",value:ae.businessName||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Business Type",children:(0,j.jsxs)(d.A,{value:ae.businessType||"",onChange:e=>se(t=>t?(0,a.A)((0,a.A)({},t),{},{businessType:e}):t),disabled:!Q,children:[(0,j.jsx)(d.A.Option,{value:"",children:"Select"}),(0,j.jsx)(d.A.Option,{value:"Sole Proprietorship",children:"Sole Proprietorship"}),(0,j.jsx)(d.A.Option,{value:"Partnership",children:"Partnership"}),(0,j.jsx)(d.A.Option,{value:"Corporation",children:"Corporation"}),(0,j.jsx)(d.A.Option,{value:"Cooperative",children:"Cooperative"}),(0,j.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Nature of Business",children:(0,j.jsx)(c.A,{name:"natureOfBusiness",value:ae.natureOfBusiness||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Business Address",children:(0,j.jsx)(c.A,{name:"businessAddress",value:ae.businessAddress||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Date Established",children:(0,j.jsx)(c.A,{name:"dateEstablished",type:"date",value:ae.dateEstablished||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"TIN",children:(0,j.jsx)(c.A,{name:"tin",value:ae.tin||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"DTI/SEC/CDA Registration No.",children:(0,j.jsx)(c.A,{name:"registrationNumber",value:ae.registrationNumber||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Business Permit No.",children:(0,j.jsx)(c.A,{name:"businessPermitNumber",value:ae.businessPermitNumber||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Barangay Clearance No.",children:(0,j.jsx)(c.A,{name:"barangayClearanceNumber",value:ae.barangayClearanceNumber||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Number of Employees",children:(0,j.jsx)(c.A,{name:"numberOfEmployees",type:"number",value:ae.numberOfEmployees||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Capital Investment",children:(0,j.jsx)(c.A,{name:"capitalInvestment",type:"number",value:ae.capitalInvestment||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Annual Gross Income",children:(0,j.jsx)(c.A,{name:"annualGrossIncome",type:"number",value:ae.annualGrossIncome||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Contact Person",children:(0,j.jsx)(c.A,{name:"businessContactPerson",value:ae.businessContactPerson||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Contact Number",children:(0,j.jsx)(c.A,{name:"businessContactNumber",value:ae.businessContactNumber||"",onChange:oe,disabled:!Q})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:12,lg:8,children:(0,j.jsx)(mt.A.Item,{label:"Email Address",children:(0,j.jsx)(c.A,{name:"businessEmail",type:"email",value:ae.businessEmail||"",onChange:oe,disabled:!Q})})})]}),(0,j.jsx)("div",{style:{display:"flex",gap:8,marginTop:16},children:Q?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(u.Ay,{type:"primary",onClick:async()=>{ae&&null!==E&&void 0!==E&&E._id&&(await A.residentPersonalInfoAPI.updatePersonalInfo((0,a.A)((0,a.A)({},ae),{},{userId:E._id})),ne(ae),X(!1))},style:{fontWeight:600},children:"Save"}),(0,j.jsx)(u.Ay,{onClick:()=>{X(!1),se(te)},children:"Cancel"})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(u.Ay,{onClick:()=>X(!0),style:{fontWeight:600,marginRight:8},children:"Edit"}),te&&te.barangayID?(0,j.jsx)(u.Ay,{type:"primary",disabled:!0,style:{fontWeight:600,background:"#b2bec3",border:"none"},children:"Registered"}):(0,j.jsx)(u.Ay,{type:"primary",style:{fontWeight:600},onClick:async()=>{try{const e=(0,a.A)({barangayID:(null===W||void 0===W?void 0:W.barangayID)||"",username:(null===W||void 0===W?void 0:W.username)||""},ae);await A.axiosInstance.post("/resident",e),alert("Resident registered successfully!")}catch(e){alert("Failed to register resident.")}},children:"Register"})]})})]})})]}),(0,j.jsx)("div",{style:{position:"fixed",left:16,bottom:16,zIndex:1200},children:(0,j.jsx)(u.Ay,{type:"primary",shape:"circle",size:"large",icon:(0,j.jsx)(Ua.A,{}),onClick:O,"aria-label":"Refresh profile"})})]})}const La=()=>(0,j.jsx)("div",{className:"landing-bg",style:{minHeight:"100vh",background:"linear-gradient(135deg, #40c9ff 0%, #e81cff 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif"},children:(0,j.jsxs)("div",{className:"floating-box",style:{background:"rgba(255,255,255,0.95)",boxShadow:"0 8px 32px 0 rgba(64,201,255,0.15)",borderRadius:24,padding:"48px 32px",textAlign:"center",maxWidth:420,width:"100%",animation:"float 2s infinite ease-in-out alternate",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,j.jsx)("img",{src:"".concat("","/logo-parian2.png"),alt:"Barangay Logo",style:{width:80,marginBottom:24}}),(0,j.jsxs)("h1",{className:"responsive-system-title",style:{fontSize:"1.7rem",marginBottom:24,fontWeight:800,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",letterSpacing:1,maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"pre-line",wordBreak:"break-word",textAlign:"center"},children:["Welcome to",(0,j.jsx)("br",{}),"Barangay Information Management System",(0,j.jsx)("br",{}),"Parian"]}),(0,j.jsx)("button",{className:"get-started-btn",style:{background:"linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",color:"#fff",border:"none",borderRadius:8,padding:"14px 40px",fontSize:"1.15rem",fontWeight:700,cursor:"pointer",boxShadow:"0 2px 8px #e81cff44",marginTop:8,transition:"background 0.2s"},onClick:()=>window.location.href="/login",onMouseOver:e=>e.currentTarget.style.background="linear-gradient(90deg, #40c9ff 0%, #e81cff 100%)",onMouseOut:e=>e.currentTarget.style.background="linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",children:"Get Started"})]})});var Oa=n(24893);const Fa=()=>{const[e,t]=(0,s.useState)(!1),[n,a]=(0,s.useState)(!1),[i,l]=(0,s.useState)("link"),[o,d]=(0,s.useState)(null),[m,p]=(0,s.useState)(""),[x,g]=(0,s.useState)(!1),f=(0,xe.Zp)();return(0,j.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:24},children:(0,j.jsxs)(r.A,{style:{width:420,borderRadius:12},children:[(0,j.jsx)(h.A.Title,{level:3,style:{textAlign:"center"},children:"Forgot Password"}),n?(0,j.jsx)("div",{children:"otp"===i?(0,j.jsxs)("div",{children:[(0,j.jsxs)(h.A.Paragraph,{children:["Enter the 6-digit code sent to ",(0,j.jsx)("strong",{children:o})]}),(0,j.jsx)("div",{style:{display:"flex",justifyContent:"center",marginBottom:12},children:Array.from({length:6}).map((e,t)=>(0,j.jsx)("div",{style:{width:40,height:48,margin:4,border:"1px solid #ddd",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18},children:m[t]||""},t))}),(0,j.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:8,maxWidth:300,margin:"0 auto 12px"},children:[["1","2","3","4","5","6","7","8","9","0"].map(e=>(0,j.jsx)(u.Ay,{onClick:()=>(e=>{m.length>=6||p(t=>t+e)})(e),disabled:x,children:e},e)),(0,j.jsx)(u.Ay,{onClick:()=>p(e=>e.slice(0,-1)),disabled:x,children:"\u232b"}),(0,j.jsx)(u.Ay,{onClick:()=>p(""),disabled:x,children:"Clear"}),(0,j.jsx)(u.Ay,{type:"primary",onClick:async()=>{if(6===m.length){g(!0);try{var e;const t={token:m};o&&(t.email=o);const n=await A.axiosPublic.post("/auth/verify-otp",t);nn.Ay.success({message:"If valid",description:(null===(e=n.data)||void 0===e?void 0:e.message)||"Check your email for the new temporary password."}),p(""),a(!1),d(null),f("/login")}catch(s){var t,n;const e=(null===s||void 0===s||null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||s.message||"Failed to verify code";nn.Ay.error({message:"Error",description:e})}finally{g(!1)}}else nn.Ay.error({message:"Enter code",description:"Please enter the 6-digit code."})},loading:x,disabled:x,children:"Verify"})]}),(0,j.jsx)(u.Ay,{type:"link",block:!0,onClick:()=>{a(!1),d(null)},children:"Back"})]}):(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Paragraph,{children:"Check your email for password reset instructions."}),(0,j.jsx)(u.Ay,{type:"primary",block:!0,onClick:()=>f("/login"),children:"Back to login"})]})}):(0,j.jsxs)(mt.A,{layout:"vertical",onFinish:async e=>{t(!0);try{var n;const t=await A.axiosPublic.post("/auth/forgot-password",{email:e.email,mode:i});nn.Ay.success({message:"Request sent",description:(null===(n=t.data)||void 0===n?void 0:n.message)||"Check your email for instructions."}),a(!0),d(e.email)}catch(l){var s,r;const e=(null===l||void 0===l||null===(s=l.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||l.message||"Failed to send reset email";nn.Ay.error({message:"Error",description:e})}finally{t(!1)}},requiredMark:!1,children:[(0,j.jsx)(mt.A.Item,{label:"Choose how to receive reset instructions",children:(0,j.jsxs)(Oa.Ay.Group,{value:i,onChange:e=>l(e.target.value),children:[(0,j.jsx)(Oa.Ay,{value:"link",children:"Send reset link (email)"}),(0,j.jsx)(Oa.Ay,{value:"otp",children:"Send 6-digit code (email)"})]})}),(0,j.jsx)(mt.A.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Please input your email"},{type:"email",message:"Please enter a valid email"}],children:(0,j.jsx)(c.A,{placeholder:"you@example.com",size:"large"})}),(0,j.jsx)(mt.A.Item,{children:(0,j.jsx)(u.Ay,{type:"primary",htmlType:"submit",block:!0,loading:e,children:e?"Sending...":"otp"===i?"Send code":"Send reset link"})}),(0,j.jsx)(u.Ay,{type:"link",block:!0,onClick:()=>f("/login"),children:"Back to login"})]})]})})},Ea=()=>{const{token:e}=(0,xe.g)(),t=(0,xe.Zp)(),n=(0,xe.zy)(),a=new URLSearchParams(n.search).get("mode"),[i,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null),[m,p]=(0,s.useState)("");return(0,j.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:24},children:(0,j.jsxs)(r.A,{style:{width:420,borderRadius:12},children:[(0,j.jsx)(h.A.Title,{level:3,style:{textAlign:"center"},children:"Reset Password"}),(0,j.jsxs)(mt.A,{layout:"vertical",onFinish:async n=>{if(n.password!==n.confirm)return void nn.Ay.error({message:"Passwords do not match"});if(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}$/.test(n.password)){l(!0);try{var s;let i;if(e)i=await A.axiosPublic.post("/auth/reset-password/".concat(e),{password:n.password});else if("otp"===a){if(!n.code)return nn.Ay.error({message:"Please enter the 6-digit code sent to your email"}),void l(!1);i=await A.axiosPublic.post("/auth/reset-password",{token:n.code,password:n.password})}else i=await A.axiosPublic.post("/auth/reset-password",{token:n.code||"",password:n.password});nn.Ay.success({message:"Password reset",description:(null===(s=i.data)||void 0===s?void 0:s.message)||"Your password has been reset. Please log in."}),t("/login")}catch(o){var i,r;const e=(null===o||void 0===o||null===(i=o.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.message)||o.message||"Failed to reset password";nn.Ay.error({message:"Error",description:e})}finally{l(!1)}}else nn.Ay.error({message:"Password does not meet complexity requirements. Use 8+ chars, mixed case, numbers and symbols."})},requiredMark:!1,children:["otp"===a&&!e&&(0,j.jsx)(mt.A.Item,{label:"6-digit code",name:"code",rules:[{required:!0,message:"Please input the 6-digit code sent to your email"},{len:6,message:"Code must be 6 digits"}],children:(0,j.jsx)(c.A,{placeholder:"123456",size:"large"})}),(0,j.jsx)(mt.A.Item,{label:"New password",name:"password",rules:[{required:!0,message:"Please input your new password"},{min:6,message:"Password must be at least 6 characters"}],children:(0,j.jsx)(c.A.Password,{size:"large",onChange:e=>(e=>{if(!e)return d(null),void p("");let t=0;e.length>=8&&(t+=2),/[A-Z]/.test(e)&&(t+=1),/[a-z]/.test(e)&&(t+=1),/\d/.test(e)&&(t+=1),/[^A-Za-z0-9]/.test(e)&&(t+=1);const n=Math.min(4,Math.floor(t/6*5));d(20*n),p(["Very weak","Weak","Fair","Good","Strong"][n]||"")})(e.target.value)})}),null!==o&&(0,j.jsxs)("div",{style:{marginBottom:12},children:[(0,j.jsx)(qt.A,{percent:o,size:"small",status:o<40?"exception":"normal"}),(0,j.jsx)("div",{style:{textAlign:"right",fontSize:12,color:"#666"},children:m})]}),(0,j.jsx)(mt.A.Item,{label:"Confirm password",name:"confirm",rules:[{required:!0,message:"Please confirm your new password"}],children:(0,j.jsx)(c.A.Password,{size:"large"})}),(0,j.jsx)(mt.A.Item,{children:(0,j.jsx)(u.Ay,{type:"primary",htmlType:"submit",block:!0,loading:i,children:i?"Resetting...":"Reset password"})})]})]})})},{Text:za}=h.A,Ma=()=>{const[e,t]=(0,s.useState)(!1),[n,a]=(0,s.useState)([]),l=(0,xe.Zp)(),o=async()=>{t(!0);try{const e=await A.notificationAPI.getNotifications();a(Array.isArray(e)?e:[])}catch(e){console.error("Failed to load notifications",e),a([])}finally{t(!1)}};(0,s.useEffect)(()=>{o()},[]);return(0,j.jsxs)(r.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(Ke.A,{})," Notifications"]}),style:{minHeight:240},children:[e?(0,j.jsx)("div",{style:{textAlign:"center",padding:24},children:(0,j.jsx)(p.A,{})}):n&&n.length>0?(0,j.jsx)(g.A,{dataSource:n,renderItem:e=>(0,j.jsx)(g.A.Item,{actions:[(e.type||"").toString().toLowerCase().includes("staff")&&(0,j.jsx)(u.Ay,{type:"primary",size:"small",icon:(0,j.jsx)(Ie.A,{}),onClick:()=>(async e=>{if(e._id){t(!0);try{var n;(e.type||"").toString().toLowerCase().includes("staff")&&null!==(n=e.data)&&void 0!==n&&n.userId?(await A.notificationAPI.approveStaff(e.data.userId,e._id),i.Ay.success("Staff applicant approved")):await A.notificationAPI.markAsRead(e._id),await o()}catch(a){console.error("Approve failed",a),i.Ay.error("Action failed")}finally{t(!1)}}})(e),children:"Approve"}),(0,j.jsx)(u.Ay,{size:"small",onClick:()=>(async e=>{if(e._id){t(!0);try{(e.type||"").toString().toLowerCase().includes("staff")?(await A.notificationAPI.rejectStaff(e._id,"Rejected by admin"),i.Ay.info("Staff applicant rejected")):await A.notificationAPI.markAsRead(e._id),await o()}catch(n){console.error("Reject failed",n),i.Ay.error("Action failed")}finally{t(!1)}}})(e),children:"Dismiss"})].filter(Boolean),children:(0,j.jsx)(g.A.Item.Meta,{avatar:(0,j.jsx)(b,{icon:(e.type||"").toString().toLowerCase().includes("staff")?(0,j.jsx)(Ye.A,{}):(0,j.jsx)(Ke.A,{})}),title:(0,j.jsx)(za,{strong:!0,children:e.title||e.message}),description:(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{style:{color:"#888",marginBottom:6},children:new Date(e.createdAt).toLocaleString()}),(0,j.jsx)("div",{children:e.message}),e.data&&(0,j.jsx)("div",{style:{marginTop:8},children:(0,j.jsx)(za,{type:"secondary",children:JSON.stringify(e.data)})})]})})})}):(0,j.jsx)(rn.A,{description:"No notifications"}),(0,j.jsx)("div",{style:{marginTop:12,textAlign:"right"},children:(0,j.jsx)(u.Ay,{type:"link",onClick:()=>l("/admin/notifications"),children:"View all"})})]})},Wa="DocumentHistory_wrapper__KIqBy",Ya="DocumentHistory_title__UmSIq",Va="DocumentHistory_cardList__yg+X2",Ha="DocumentHistory_card__XzJRq",Ga="DocumentHistory_cardRow__guh8i",Ka="DocumentHistory_cardCol__Pu-Rr",Ja="DocumentHistory_cardLabel__525-6",Za="DocumentHistory_cardValue__sdvX8",$a="DocumentHistory_rejected__tS2s+",Qa="DocumentHistory_completed__7G7DO",Xa=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!0),[i,l]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{const e=()=>l(window.innerWidth<=720);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{let e=!0;return(async()=>{a(!0);try{const n=await A.documentsAPI.getDocumentRecords();e&&t(Array.isArray(n)?n:[])}catch(n){console.error("Failed to load document history",n),e&&t([])}finally{e&&a(!1)}})(),()=>{e=!1}},[]),(0,j.jsxs)("div",{className:Wa,children:[(0,j.jsx)(h.A.Title,{level:3,className:Ya,children:"Document History"}),n?(0,j.jsx)(p.A,{}):i?(0,j.jsx)("div",{className:Va,children:e.map(e=>(0,j.jsxs)(r.A,{className:Ha,children:[(0,j.jsxs)("div",{className:Ga,children:[(0,j.jsxs)("div",{className:Ka,children:[(0,j.jsx)("div",{className:Ja,children:"Requester"}),(0,j.jsx)("div",{className:Za,children:e.username||"Unknown"})]}),(0,j.jsxs)("div",{className:Ka,children:[(0,j.jsx)("div",{className:Ja,children:"Type"}),(0,j.jsx)("div",{className:Za,children:e.type||"Unknown"})]})]}),(0,j.jsxs)("div",{className:Ga,children:[(0,j.jsxs)("div",{className:Ka,children:[(0,j.jsx)("div",{className:Ja,children:"Txn ID"}),(0,j.jsx)("div",{className:Za,children:e.transactionCode||"\u2014"})]}),(0,j.jsxs)("div",{className:Ka,children:[(0,j.jsx)("div",{className:Ja,children:"Date Approved"}),(0,j.jsx)("div",{className:Za,children:e.completedAt||e.dateApproved||e.approvedAt?(0,Pa.Y)(e.completedAt||e.dateApproved||e.approvedAt):"\u2014"})]})]}),(0,j.jsx)("div",{style:{marginTop:8},children:e.status&&"rejected"===e.status.toString().toLowerCase()?(0,j.jsx)("div",{className:$a,children:"Rejected"}):(0,j.jsx)("div",{className:Qa,children:"Completed"})})]},e._id))}):(0,j.jsx)(Jt.A,{dataSource:e,rowKey:"_id",pagination:{pageSize:8},columns:[{title:"Requester Name",dataIndex:"username",key:"username",render:e=>e||"Unknown"},{title:"Transactional ID",dataIndex:"transactionCode",key:"transactionCode",render:e=>e||"\u2014"},{title:"Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Date Approved",dataIndex:"completedAt",key:"completedAt",render:(e,t)=>{const n=e||t.dateApproved||t.completedAt||t.approvedAt||null;if(!n)return"\u2014";try{return(0,Pa.Y)(n)}catch(a){return String(n)}}},{title:"Status",dataIndex:"status",key:"status",render:(e,t)=>{var n,a,s;const i=(null===(n=t.processedBy)||void 0===n?void 0:n.fullName)||(null===(a=t.processedBy)||void 0===a?void 0:a.username)||"Unknown",r=(null===(s=t.processedBy)||void 0===s?void 0:s.barangayID)||"Unknown";return e&&"rejected"===e.toLowerCase()?(0,j.jsxs)("span",{style:{color:"#FF3B3B",fontWeight:600},children:["Rejected by: ",i," (",r,")"]}):!e||"completed"!==e.toLowerCase()&&"approved"!==e.toLowerCase()?(0,j.jsx)("span",{children:e}):(0,j.jsxs)("span",{style:{color:"#43D96B",fontWeight:600},children:["Completed by: ",i," (",r,")"]})}}]})]})};var es=n(22429),ts=n(15672);const{TextArea:ns}=c.A,as=()=>{const[e,t]=(0,s.useState)(""),[n,a]=(0,s.useState)(null),[l,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)([]),[m,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(null),[v,b]=(0,s.useState)(null),[w,I]=(0,s.useState)(""),[S,C]=(0,s.useState)(null),{user:k}=_e(),N=s.useCallback(async()=>{if(!k||"admin"!==k.role)return;if(localStorage.getItem("token")){p(!0);try{const e=await A.adminAPI.listAdminAnnouncements();c(Array.isArray(e)?e:[])}catch(t){var e;401===(null===t||void 0===t||null===(e=t.response)||void 0===e?void 0:e.status)?i.Ay.error("Not authorized. Please sign in as an admin."):(console.error("Failed to load announcements",t),i.Ay.error("Failed to load announcements"))}finally{p(!1)}}},[k]);(0,s.useEffect)(()=>{"admin"===(null===k||void 0===k?void 0:k.role)&&N()},[N,null===k||void 0===k?void 0:k.role]);const T=()=>a(null);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(r.A,{title:(0,j.jsx)(h.A.Title,{level:4,style:{margin:0},children:"admin"===(null===k||void 0===k?void 0:k.role)?"Post Announcement":"Announcements"}),children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:["admin"===(null===k||void 0===k?void 0:k.role)&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(ns,{value:e,onChange:e=>t(e.target.value),rows:6,placeholder:"Write your announcement here"}),(0,j.jsx)(Z.A,{beforeUpload:e=>e.type.startsWith("image/")?(a(e),Z.A.LIST_IGNORE):(i.Ay.error("Only image files are allowed"),Z.A.LIST_IGNORE),onRemove:T,accept:"image/*",maxCount:1,showUploadList:{showPreviewIcon:!1},children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(ee.A,{}),children:"Upload Image (optional)"})}),n&&(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,color:"#237804"},children:[(0,j.jsx)(pn.A,{style:{color:"#52c41a"}}),(0,j.jsx)("span",{style:{fontWeight:600},children:"Image uploaded:"}),(0,j.jsx)("span",{style:{marginLeft:6},children:n.name}),(0,j.jsx)(u.Ay,{type:"text",icon:(0,j.jsx)(ts.A,{}),onClick:T,style:{marginLeft:8}})]}),(0,j.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,j.jsx)(u.Ay,{type:"primary",onClick:async()=>{if(!e||""===e.trim())return i.Ay.warning("Announcement text cannot be empty");o(!0);try{const s=new FormData;s.append("text",e.trim()),n&&s.append("image",n,n.name),await A.adminAPI.createAnnouncement(s),i.Ay.success("Announcement posted"),t(""),a(null)}catch(l){var s,r;console.error("Failed to post announcement",l),i.Ay.error((null===l||void 0===l||null===(s=l.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||"Failed to post announcement")}finally{o(!1)}},loading:l,disabled:!e.trim(),children:"Post Announcement"})})]}),(0,j.jsxs)("div",{style:{marginTop:12},children:[(0,j.jsx)(h.A.Title,{level:5,style:{marginBottom:8},children:"Existing Announcements"}),(0,j.jsx)(g.A,{loading:m,dataSource:d,renderItem:e=>(0,j.jsxs)(g.A.Item,{actions:[(0,j.jsx)(y.A,{title:"View",placement:"top",children:(0,j.jsx)(u.Ay,{shape:"circle",size:"small",icon:(0,j.jsx)($.A,{}),onClick:()=>(e=>f(e))(e),"aria-label":"View announcement ".concat(e._id)})},"view"),"admin"===(null===k||void 0===k?void 0:k.role)?(0,j.jsx)(y.A,{title:"Edit",placement:"top",children:(0,j.jsx)(u.Ay,{shape:"circle",size:"small",icon:(0,j.jsx)(Dn.A,{}),onClick:()=>(e=>{b(e),I(e.text||""),C(null)})(e),"aria-label":"Edit announcement ".concat(e._id)})},"edit"):null,"admin"===(null===k||void 0===k?void 0:k.role)?(0,j.jsx)(kn.A,{title:"Delete announcement?",onConfirm:async()=>{try{await A.adminAPI.deleteAnnouncement(e._id),i.Ay.success("Deleted"),N()}catch(t){console.error(t),i.Ay.error("Delete failed")}},children:(0,j.jsx)(y.A,{title:"Delete",placement:"top",children:(0,j.jsx)(u.Ay,{danger:!0,shape:"circle",size:"small",icon:(0,j.jsx)(X.A,{}),"aria-label":"Delete announcement ".concat(e._id)})})},"del"):null].filter(Boolean),children:[(0,j.jsx)(g.A.Item.Meta,{title:new Date(e.createdAt).toLocaleString(),description:e.text}),e.imagePath&&(0,j.jsx)(es.A,{className:"rounded-img",width:80,src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image"))})]})})]})]})}),(0,j.jsx)(fe.A,{title:x?"Announcement - ".concat(new Date(x.createdAt).toLocaleString()):"Announcement",open:!!x,onCancel:()=>f(null),footer:[(0,j.jsx)(u.Ay,{onClick:()=>f(null),children:"Close"},"close")],children:x&&(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{children:x.text}),x.imagePath&&(0,j.jsx)(es.A,{className:"rounded-img rounded-img-lg",src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(x._id,"/image")),width:320})]})}),(0,j.jsx)(fe.A,{title:"Edit Announcement",open:!!v,onCancel:()=>{b(null),C(null),I("")},onOk:async()=>{if(v)try{const e=new FormData;e.append("text",w.trim()),S&&e.append("image",S,S.name),await A.adminAPI.updateAnnouncement(v._id,e),i.Ay.success("Updated"),b(null),C(null),I(""),N()}catch(e){console.error(e),i.Ay.error("Update failed")}},okText:"Save",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,j.jsx)(ns,{value:w,onChange:e=>I(e.target.value),rows:6}),(0,j.jsx)(Z.A,{beforeUpload:e=>e.type.startsWith("image/")?(C(e),Z.A.LIST_IGNORE):(i.Ay.error("Only image files are allowed"),Z.A.LIST_IGNORE),onRemove:()=>C(null),accept:"image/*",maxCount:1,showUploadList:{showPreviewIcon:!1},children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(ee.A,{}),children:"Replace Image"})}),S&&(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,color:"#237804"},children:[(0,j.jsx)(pn.A,{style:{color:"#52c41a"}}),(0,j.jsx)("span",{style:{fontWeight:600},children:"New image selected:"}),(0,j.jsx)("span",{style:{marginLeft:6},children:null===S||void 0===S?void 0:S.name}),(0,j.jsx)(u.Ay,{type:"text",icon:(0,j.jsx)(ts.A,{}),onClick:()=>C(null),style:{marginLeft:8}})]})]})})]})},{Title:ss,Paragraph:is}=h.A,rs=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!1),[i,l]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async()=>{a(!0);try{const e=await A.contactAPI.getAnnouncements();t(Array.isArray(e)?e:[])}catch(e){console.error("Failed to load announcements",e)}finally{a(!1)}})()},[]),(0,j.jsxs)(r.A,{title:(0,j.jsx)(ss,{level:4,style:{margin:0},children:"Announcements"}),children:[0===e.length?(0,j.jsx)(rn.A,{description:"No announcements"}):(0,j.jsx)(g.A,{loading:n,dataSource:e,renderItem:e=>(0,j.jsxs)(g.A.Item,{style:{cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},onClick:()=>l(e),children:[(0,j.jsx)("div",{style:{flex:1,minWidth:0},children:(0,j.jsx)(g.A.Item.Meta,{title:(0,j.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,j.jsx)("span",{children:new Date(e.createdAt).toLocaleString()})}),description:(0,j.jsx)(is,{ellipsis:{rows:2},children:e.text})})}),e.imagePath&&(0,j.jsx)("div",{style:{marginLeft:12,width:80,display:"flex",justifyContent:"flex-end"},children:(0,j.jsx)(es.A,{className:"rounded-img",width:72,height:48,src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image")),alt:"announcement",preview:!1})})]})}),(0,j.jsx)(fe.A,{open:!!i,onCancel:()=>l(null),footer:null,title:"Announcement",children:i&&(0,j.jsxs)("div",{children:[(0,j.jsx)(is,{children:i.text}),i.imagePath&&(0,j.jsx)(es.A,{className:"rounded-img rounded-img-lg",src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(i._id,"/image")),alt:"announcement"})]})})]})},ls=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!1),[r,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null),c=async()=>{a(!0);try{const e=await A.verificationAPI.getRequests();t(Array.isArray(e)?e:[])}catch(e){console.error(e),i.Ay.error("Failed to load verification requests")}finally{a(!1)}};(0,s.useEffect)(()=>{c()},[]);const h=[{title:"Resident",dataIndex:"userId",key:"user",render:e=>e?e.fullName||e.username||e.email:"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>(0,j.jsx)(f.A,{color:"pending"===e?"orange":"approved"===e?"green":"red",children:e||"pending"})},{title:"Submitted",dataIndex:"createdAt",key:"createdAt",render:e=>e?new Date(e).toLocaleString():"-"},{title:"Verified",dataIndex:"approvedAt",key:"approvedAt",render:e=>e?new Date(e).toLocaleString():"-"},{title:"Files",key:"files",render:(e,t)=>{const n=Array.isArray(t.filesMeta)&&t.filesMeta.length?t.filesMeta:Array.isArray(t.gridFileIds)&&t.gridFileIds.length?t.gridFileIds.map(e=>({filename:e,gridFileId:e})):[];return(0,j.jsxs)(Oe.A,{children:[n.map((e,t)=>(0,j.jsx)(u.Ay,{type:"link",href:(0,A.getAbsoluteApiUrl)("/verification/file/".concat(e.gridFileId||e.filename)),target:"_blank",children:e.fileType?e.fileType.charAt(0).toUpperCase()+e.fileType.slice(1):"Open"},t)),(0,j.jsx)(u.Ay,{type:"link",onClick:()=>(e=>{d(e),l(!0)})(t),children:"Check ID"})]})}},{title:"Action",key:"action",render:(e,t)=>(0,j.jsx)(Oe.A,{children:"approved"===t.status?(0,j.jsx)(u.Ay,{size:"small",onClick:()=>(async e=>{a(!0);try{var t;if(e&&e._id)try{await A.verificationAPI.unapproveRequest(e._id)}catch(n){}const a=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;a&&await A.verificationAPI.verifyUser(a,!1),i.Ay.success("User unverified"),await c()}catch(s){console.error(s),i.Ay.error("Failed to unverify user")}finally{a(!1)}})(t),children:"Unverify"}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(u.Ay,{size:"small",type:"primary",onClick:()=>(async e=>{a(!0);try{await A.verificationAPI.verifyUser(e,!0),i.Ay.success("User verified"),await c()}catch(t){console.error(t),i.Ay.error("Failed to verify user")}finally{a(!1)}})(t.userId._id||t.userId),children:"Verify"}),(0,j.jsx)(u.Ay,{danger:!0,size:"small",onClick:()=>(async e=>{a(!0);try{var t;if(e&&e._id)try{await A.verificationAPI.rejectRequest(e._id)}catch(n){}const a=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;a&&await A.verificationAPI.verifyUser(a,!1),i.Ay.success("Verification request rejected"),await c()}catch(s){console.error(s),i.Ay.error("Failed to reject verification")}finally{a(!1)}})(t),children:"Reject"})]})})}];return(0,j.jsxs)("div",{style:{padding:24},children:[(0,j.jsx)("h2",{children:"Verification Requests"}),(0,j.jsx)(p.A,{spinning:n,children:e&&0!==e.length?(0,j.jsx)(Jt.A,{rowKey:"_id",loading:n,dataSource:e,columns:h,pagination:{pageSize:10}}):(0,j.jsx)(rn.A,{description:"No verification requests"})}),(0,j.jsx)(fe.A,{title:"Verification Files",open:r,onCancel:()=>{d(null),l(!1)},footer:null,width:840,children:o?(0,j.jsxs)("div",{children:[(0,j.jsxs)("p",{children:[(0,j.jsx)("strong",{children:"Resident:"})," ",o.userId&&(o.userId.fullName||o.userId.username)||"Unknown"]}),(0,j.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(220px, 1fr))",gap:12},children:(o.filesMeta&&o.filesMeta.length?o.filesMeta:(o.gridFileIds||[]).map(e=>({filename:e,gridFileId:e}))).map((e,t)=>{const n=e.gridFileId||e.filename,a=(0,A.getAbsoluteApiUrl)("/verification/file/".concat(n)),s=e.fileType?e.fileType.charAt(0).toUpperCase()+e.fileType.slice(1):e.filename||"File";return(0,j.jsxs)("div",{style:{border:"1px solid #f0f0f0",padding:12,borderRadius:8,background:"#fff"},children:[(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:8},children:[(0,j.jsx)("div",{style:{fontWeight:600},children:s}),(0,j.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,j.jsx)("a",{href:a,target:"_blank",rel:"noreferrer",children:"Open"}),(0,j.jsx)("a",{href:a,download:!0,children:"Download"})]})]}),(0,j.jsxs)("div",{style:{textAlign:"center"},children:[(0,j.jsx)("img",{src:a,alt:s,style:{maxWidth:"100%",maxHeight:360},onError:e=>{e.currentTarget.style.display="none"}}),(0,j.jsx)("div",{style:{marginTop:8,color:"#666",fontSize:13},children:e.filename||n})]})]},t)})})]}):(0,j.jsx)(rn.A,{description:"No files"})})]})};const os=(0,n(19746).A)({palette:{primary:{main:"#1976d2",light:"#42a5f5",dark:"#1565c0"},secondary:{main:"#9c27b0",light:"#ba68c8",dark:"#7b1fa2"}},typography:{fontFamily:["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif"].join(",")},components:{MuiButton:{styleOverrides:{root:{textTransform:"none"}}},MuiPaper:{styleOverrides:{root:{borderRadius:8}}}}}),ds=()=>{const{user:e}=_e();return e?"admin"===e.role?(0,j.jsx)(xe.C5,{to:"/admin/dashboard",replace:!0}):"staff"===e.role?(0,j.jsx)(xe.C5,{to:"/staff-dashboard",replace:!0}):(0,j.jsx)(xe.C5,{to:"/dashboard",replace:!0}):(0,j.jsx)(xe.C5,{to:"/login",replace:!0})},cs=()=>(0,j.jsxs)(Ce.A,{theme:os,children:[(0,j.jsx)(ke.Ay,{}),(0,j.jsx)(Ne.Ay,{children:(0,j.jsx)(xe.Kd,{children:(0,j.jsx)(Be,{children:(0,j.jsxs)(xe.BV,{children:[(0,j.jsx)(xe.qh,{path:"/",element:(0,j.jsx)(La,{})}),(0,j.jsx)(xe.qh,{path:"/redirect",element:(0,j.jsx)(ds,{})}),(0,j.jsx)(xe.qh,{path:"/login",element:(0,j.jsx)(vt,{})}),(0,j.jsx)(xe.qh,{path:"/forgot-password",element:(0,j.jsx)(Fa,{})}),(0,j.jsx)(xe.qh,{path:"/reset-password/:token",element:(0,j.jsx)(Ea,{})}),(0,j.jsx)(xe.qh,{path:"/register",element:(0,j.jsx)(Gt,{})}),(0,j.jsx)(xe.qh,{path:"/goodbye",element:(0,j.jsx)(Ta,{})}),(0,j.jsx)(xe.qh,{path:"/logout",element:(0,j.jsx)(Da,{})}),(0,j.jsxs)(xe.qh,{element:(0,j.jsx)(ot,{}),children:[(0,j.jsx)(xe.qh,{path:"/home",element:(0,j.jsx)(dt,{children:(0,j.jsx)(en,{})})}),(0,j.jsx)(xe.qh,{path:"/request",element:(0,j.jsx)(ht,{children:(0,j.jsx)(wa,{})})}),(0,j.jsx)(xe.qh,{path:"/dashboard",element:(0,j.jsx)(dt,{children:(0,j.jsx)(en,{})})}),(0,j.jsx)(xe.qh,{path:"/guest/dashboard",element:(0,j.jsx)(dt,{children:(0,j.jsx)(tn,{})})}),(0,j.jsx)(xe.qh,{path:"/request-document",element:(0,j.jsx)(ht,{children:(0,j.jsx)(wa,{})})}),(0,j.jsx)(xe.qh,{path:"/contact",element:(0,j.jsx)(dt,{children:(0,j.jsx)(Na,{})})}),(0,j.jsx)(xe.qh,{path:"/inquiries",element:(0,j.jsx)(dt,{children:(0,j.jsx)(Na,{})})}),(0,j.jsx)(xe.qh,{path:"/inquiry-tracker",element:(0,j.jsx)(ct,{children:(0,j.jsx)(_a,{})})}),(0,j.jsx)(xe.qh,{path:"/staff-dashboard",element:(0,j.jsx)(ct,{children:(0,j.jsx)(fn,{})})}),(0,j.jsx)(xe.qh,{path:"/staff/appointments",element:(0,j.jsx)(ct,{children:s.createElement(n(57290).A)})}),(0,j.jsx)(xe.qh,{path:"/document-processing",element:(0,j.jsx)(ct,{children:s.createElement(n(97009).A)})}),(0,j.jsx)(xe.qh,{path:"/templates-manager",element:(0,j.jsx)(ct,{children:(0,j.jsx)(pe,{})})}),(0,j.jsx)(xe.qh,{path:"/staff/inbox",element:(0,j.jsx)(ct,{children:(0,j.jsx)(Se,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/dashboard",element:(0,j.jsx)(ut,{children:(0,j.jsx)(Cn,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/messages",element:(0,j.jsx)(ut,{children:(0,j.jsx)(Ma,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/notifications",element:(0,j.jsx)(ut,{children:(0,j.jsx)(Ma,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/verification-requests",element:(0,j.jsx)(ut,{children:(0,j.jsx)(ls,{})})}),(0,j.jsx)(xe.qh,{path:"/announcements",element:(0,j.jsx)(dt,{children:(0,j.jsx)(rs,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/announcements",element:(0,j.jsx)(ut,{children:(0,j.jsx)(as,{})})}),(0,j.jsx)(xe.qh,{path:"/admin",element:(0,j.jsx)(xe.C5,{to:"/admin/dashboard",replace:!0})}),(0,j.jsx)(xe.qh,{path:"/admin/users",element:(0,j.jsx)(ut,{children:(0,j.jsx)(On,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/activity",element:(0,j.jsx)(ut,{children:(0,j.jsx)(Fn,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/statistics",element:(0,j.jsx)(ut,{children:(0,j.jsx)(sa,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/settings",element:(0,j.jsx)(ut,{children:(0,j.jsx)(ya,{})})}),(0,j.jsx)(xe.qh,{path:"/profile",element:(0,j.jsx)(dt,{children:(0,j.jsx)(qa,{})})}),(0,j.jsx)(xe.qh,{path:"/document-history",element:(0,j.jsx)(dt,{children:(0,j.jsx)(Xa,{})})}),(0,j.jsx)(xe.qh,{path:"/inbox",element:(0,j.jsx)(dt,{children:(0,j.jsx)(J,{})})})]})]})})})})]})},51496:(e,t,n)=>{n.r(t),n.d(t,{API_URL:()=>p,adminAPI:()=>S,authAPI:()=>k,authService:()=>y,axiosInstance:()=>x,axiosPublic:()=>g,contactAPI:()=>w,default:()=>x,documentsAPI:()=>b,getAbsoluteApiUrl:()=>f,getInbox:()=>A,getTemplateText:()=>c,notificationAPI:()=>u,requestsAPI:()=>I,residentPersonalInfoAPI:()=>C,staffRegister:()=>h,verificationAPI:()=>j});var a=n(89379),s=n(90287),i=n(44272);class r{constructor(){this.db=null}static getInstance(){return r.instance||(r.instance=new r),r.instance}async initialize(){this.db=await(0,i.P2)("barangay-system",1,{upgrade(e){if(!e.objectStoreNames.contains("users")){e.createObjectStore("users",{keyPath:"_id"}).createIndex("by-email","email")}if(!e.objectStoreNames.contains("documents")){e.createObjectStore("documents",{keyPath:"_id"}).createIndex("by-user","userId")}e.objectStoreNames.contains("syncQueue")||e.createObjectStore("syncQueue",{keyPath:"_id",autoIncrement:!0})}})}async addToSyncQueue(e,t,n){this.db||await this.initialize(),await this.db.add("syncQueue",{operation:e,collection:t,data:n,timestamp:Date.now()})}async getAllFromSyncQueue(){return this.db||await this.initialize(),this.db.getAll("syncQueue")}async clearSyncQueue(){this.db||await this.initialize();const e=this.db.transaction("syncQueue","readwrite");await e.objectStore("syncQueue").clear()}async saveUser(e){this.db||await this.initialize(),await this.db.put("users",e)}async getUser(e){return this.db||await this.initialize(),this.db.get("users",e)}async getAllUsers(){return this.db||await this.initialize(),this.db.getAll("users")}async deleteUser(e){this.db||await this.initialize(),await this.db.delete("users",e)}async saveDocument(e){this.db||await this.initialize(),await this.db.put("documents",e)}async getDocument(e){return this.db||await this.initialize(),this.db.get("documents",e)}async getAllDocuments(){return this.db||await this.initialize(),this.db.getAll("documents")}async deleteDocument(e){this.db||await this.initialize(),await this.db.delete("documents",e)}async saveSettings(e){this.db||await this.initialize(),await this.db.put("users",(0,a.A)({_id:"settings"},e))}async getSettings(){return this.db||await this.initialize(),this.db.get("users","settings")}}r.instance=void 0;const l=r.getInstance();class o{constructor(){this.isOnline=navigator.onLine,this.syncInterval=null,this.handleOnline=async()=>{this.isOnline=!0,console.log("Connection restored. Starting sync..."),await this.syncWithServer()},this.handleOffline=()=>{this.isOnline=!1,console.log("Connection lost. Operating in offline mode...")},this.setupEventListeners(),this.startSyncInterval()}static getInstance(){return o.instance||(o.instance=new o),o.instance}setupEventListeners(){window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline)}startSyncInterval(){this.syncInterval||(this.syncInterval=setInterval(async()=>{this.isOnline&&await this.syncWithServer()},3e5))}async syncWithServer(){try{const t=await l.getAllFromSyncQueue();if(0===t.length)return;console.log("Syncing ".concat(t.length," pending changes..."));for(const n of t)try{await this.processSyncItem(n)}catch(e){if(e&&"object"===typeof e&&"message"in e&&"string"===typeof e.message){if(console.error("Failed to sync item:",n,e),"Network Error"===e.message){this.isOnline=!1;break}}else console.error("Failed to sync item:",n,e)}await l.clearSyncQueue()}catch(e){e&&"object"===typeof e&&"message"in e&&"string"===typeof e.message?console.error("Sync failed:",e.message):console.error("Sync failed:",e)}}async processSyncItem(e){const{operation:t,collection:n,data:a}=e;switch(t){case"create":await x.post("/".concat(n),a);break;case"update":await x.put("/".concat(n,"/").concat(a._id),a);break;case"delete":await x.delete("/".concat(n,"/").concat(a._id))}}async performOperation(e,t,n){switch(e){case"create":case"update":await l.saveUser(n);break;case"delete":await l.deleteUser(n._id)}await l.addToSyncQueue(e,t,n),this.isOnline&&await this.syncWithServer()}cleanup(){this.syncInterval&&clearInterval(this.syncInterval),window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline)}}o.instance=void 0;const d=o.getInstance(),c=e=>x.get("/templates/".concat(e)).then(e=>e.data.text),u={getNotifications:async()=>{try{const e=await x.get("/notifications");return Array.isArray(e.data)?e.data:e.data&&e.data.data?e.data.data:[]}catch(e){try{const e=await x.get("/notifications/fallback");return Array.isArray(e.data)?e.data:e.data&&e.data.data?e.data.data:[]}catch(t){return console.error("notificationAPI.getNotifications failed:",e),[]}}},approveStaff:async(e,t)=>(await x.post("/notifications/approve",{userId:e,notificationId:t})).data,rejectStaff:async(e,t)=>(await x.post("/notifications/reject",{notificationId:e,reason:t})).data,markAsRead:async e=>(await x.post("/notifications/read",{notificationId:e})).data},h=async e=>(await x.post("/auth/register/staff",e)).data,m=globalThis.__APP_CONFIG__,p=m&&m.API_BASE||"https://my-backend.onrender.com/api",x=s.A.create({baseURL:p,headers:{"Content-Type":"application/json"},withCredentials:!0}),g=s.A.create({baseURL:p,headers:{"Content-Type":"application/json"},withCredentials:!1});function f(e){const t=globalThis.__APP_CONFIG__,n=t&&t.API_BASE||"https://my-backend.onrender.com/api";let a=String(n).replace(/\/$/,"");a.endsWith("/api")&&(a=a.replace(/\/api$/,""));const s=e.startsWith("/")?e:"/".concat(e);return s.startsWith("/api")?"".concat(a).concat(s):"".concat(a,"/api").concat(s)}const y={login:async(e,t)=>(await x.post("/auth/login",{email:e,password:t})).data,register:async e=>(await x.post("/auth/register",e)).data,logout:async()=>{await x.post("/auth/logout")},getCurrentUser:async()=>(await x.get("/auth/me")).data};x.interceptors.request.use(e=>{const t=localStorage.getItem("token")||localStorage.getItem("guestSessionToken");return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e}),x.interceptors.response.use(e=>e,e=>{try{var t;if(401===(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status)&&"undefined"!==typeof window){const t=window.location.pathname||"",s=(null===e||void 0===e?void 0:e.config)&&(e.config.url||"")||(null===e||void 0===e?void 0:e.request)&&e.request.responseURL||"",i=s.includes("/auth/login")||s.includes("/auth/me");if("/login"===t||t.startsWith("/login")||i)try{localStorage.removeItem("guestSessionToken")}catch(n){}else{console.warn("API responded 401 Unauthorized \u2014 clearing auth and redirecting to login");try{localStorage.removeItem("token"),localStorage.removeItem("guestSessionToken")}catch(n){}try{sessionStorage.getItem("redirectingToLogin")||(sessionStorage.setItem("redirectingToLogin","1"),setTimeout(()=>{window.location.href="/login"},100))}catch(n){try{window.location.href="/login"}catch(a){}}}}}catch(n){}return Promise.reject(e)});const A=async()=>x.get("/messages/inbox"),j={getRequests:async()=>x.get("/verification/admin/requests").then(e=>e.data),verifyUser:async(e,t)=>x.post("/verification/admin/verify-user/".concat(e),{verified:t}).then(e=>e.data),getFileUrl:e=>"".concat(p.replace(/\/$/,""),"/verification/file/").concat(e),approveRequest:async e=>x.post("/verification/admin/requests/".concat(e,"/approve")).then(e=>e.data),unapproveRequest:async e=>x.post("/verification/admin/requests/".concat(e,"/unapprove")).then(e=>e.data),rejectRequest:async(e,t)=>x.post("/verification/admin/requests/".concat(e,"/reject"),{reason:t}).then(e=>e.data),cancelRequest:async e=>x.delete("/verification/requests/".concat(e)).then(e=>e.data),getMyRequests:async()=>x.get("/verification/requests/my").then(e=>e.data),getRequestById:async e=>x.get("/verification/requests/".concat(e)).then(e=>e.data)},v={login:e=>x.post("/auth/login",e).then(e=>e.data),register:e=>x.post("/auth/register",e).then(e=>e.data)},b={getMyDocuments:()=>x.get("/document-requests/my-requests").then(e=>e.data),requestDocument:e=>x.post("/document-requests",e).then(e=>e.data),getDocumentById:e=>x.get("/document-requests/".concat(e)).then(e=>e.data),getAllDocuments:()=>x.get("/document-requests/all").then(e=>e.data).catch(e=>{var t;if(401===(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status))return[];throw e}),getDocumentRecords:()=>x.get("/document-requests/all").then(e=>e.data),updateDocumentStatus:(e,t)=>x.patch("/document-requests/".concat(e,"/process"),t).then(e=>e.data),processDocument:e=>x.patch("/document-requests/".concat(e,"/process")).then(e=>e.data),listFiles:()=>x.get("/documents/list").then(e=>e.data),deleteFile:e=>x.delete("/documents/file/".concat(e)).then(e=>e.data),updateFileStatus:(e,t)=>x.patch("/documents/file/".concat(e,"/status"),t).then(e=>e.data),getFilledDocument:e=>x.get("/document-requests/".concat(e,"/filled")).then(e=>e.data),previewFilledDocument:e=>x.post("/document-requests/preview-filled",e).then(e=>e.data)},w={submitInquiry:e=>"undefined"!==typeof FormData&&e instanceof FormData?x.post("/inquiries",e,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>e.data):x.post("/inquiries",e).then(e=>e.data),getMyInquiries:(e,t)=>x.get("/inquiries/my-inquiries",{params:e&&t?{username:e,barangayID:t}:void 0}).then(e=>e.data),getInquiryById:e=>x.get("/inquiries/".concat(e)).then(e=>e.data),getAllInquiries:()=>x.get("/inquiries").then(e=>e.data),respondToInquiry:(e,t)=>x.post("/inquiries/".concat(e,"/responses"),t).then(e=>e.data),resolveInquiry:e=>x.patch("/inquiries/".concat(e),{status:"resolved"}).then(e=>e.data),getAnnouncements:()=>x.get("/announcements").then(e=>e.data),getAnnouncementById:e=>x.get("/announcements/".concat(e)).then(e=>e.data)},I={getAllRequests:async()=>x.get("/requests").then(e=>e.data),getRequestById:async e=>x.get("/requests/".concat(e)).then(e=>e.data),getStaffAccessRequests:async()=>{const e=await x.get("/requests").then(e=>e.data);return Array.isArray(e)?e.filter(e=>"staff_access"===(e.type||"").toString().toLowerCase()&&"pending"===(e.status||"").toString().toLowerCase()):[]},approveRequest:async e=>(await x.post("/requests/".concat(e,"/approve"))).data},S={createUser:async e=>{try{const n=await x.post("/admin/users",e);if(n.data){await l.saveUser(n.data);try{const e=new CustomEvent("userProfileUpdated",{detail:n.data});window.dispatchEvent(e)}catch(t){}}}catch(n){throw navigator.onLine||await d.performOperation("create","users",e),n}},updateUser:async(e,t)=>{try{const a=await x.put("/admin/users/".concat(e),t);if(a.data){await l.saveUser(a.data);try{const e=new CustomEvent("userProfileUpdated",{detail:a.data});window.dispatchEvent(e)}catch(n){}}}catch(s){throw navigator.onLine||await d.performOperation("update","users",(0,a.A)((0,a.A)({},t),{},{_id:e})),s}},demoteUser:async e=>{try{return(await x.put("/admin/users/".concat(e),{role:"resident"})).data}catch(t){if(!navigator.onLine)return void await d.performOperation("update","users",{_id:e,role:"resident"});throw t}},getSystemSettings:async()=>{try{return(await x.get("/admin/settings")).data}catch(e){if(!navigator.onLine){const e=await l.getSettings();if(e)return e}try{return(await x.get("/settings")).data}catch(t){try{return(await x.get("/admin/settings")).data}catch(n){try{return(await x.get("/settings")).data}catch(a){try{return(await x.get("/settings/public")).data}catch(s){try{const e=await l.getSettings();if(e)return e}catch(i){}console.warn("getSystemSettings: all fallbacks failed; returning empty defaults. Original error:",e);return{siteName:"Barangay Information System",contactEmail:"",smtp:{passwordSet:!1}}}}}}}},updateSystemSettings:async e=>{try{const t=await x.patch("/admin/settings",e);return await l.saveSettings(e),t.data}catch(t){if(!navigator.onLine)return void await d.performOperation("update","settings",e);try{const t=await x.patch("/admin/settings",e,{withCredentials:!0});try{await l.saveSettings(e)}catch(n){}return t.data}catch(a){throw t}}},testSmtp:async e=>(await x.post("/admin/settings/test-smtp",{to:e})).data,getUsers:async()=>{try{const e=(await x.get("/auth/users")).data;for(const t of e)await l.saveUser(t);return e}catch(e){if(!navigator.onLine)return l.getAllUsers();throw e}},updateUserStatus:async(e,t)=>{try{const a=await x.put("/admin/users/".concat(e,"/status"),{status:t}),s=await l.getUser(e);if(s){s.status=t,await l.saveUser(s);try{const e=new CustomEvent("userProfileUpdated",{detail:s});window.dispatchEvent(e)}catch(n){}}return a.data}catch(a){if(!navigator.onLine){const n=await l.getUser(e);return void(n&&(n.status=t,await d.performOperation("update","users",n)))}throw a}},deleteUser:async e=>{try{await x.delete("/admin/users/".concat(e)),await l.deleteUser(e);try{const t=new CustomEvent("userProfileUpdated",{detail:{_id:e,deleted:!0}});window.dispatchEvent(t)}catch(t){}}catch(n){if(!navigator.onLine)return void await d.performOperation("delete","users",{_id:e});throw n}},getActivityLogs:e=>x.get("/admin/logs",{params:e}).then(e=>e.data),getSystemStatistics:()=>x.get("/admin/statistics").then(e=>e.data),getStaffApplicants:async()=>(await x.get("/admin/staff-applications")).data,getUserWithResident:async e=>(await x.get("/admin/users/".concat(e,"/with-resident"))).data,getResidentByBarangayID:async e=>(await x.get("/admin/resident/".concat(encodeURIComponent(e)))).data,getResident:async e=>(await x.get("/admin/resident/id/".concat(e))).data,updateResident:async(e,t)=>(await x.put("/admin/resident/".concat(e),t)).data,uploadResidentAvatar:async(e,t)=>{const n=new FormData;n.append("avatar",t);return(await x.post("/admin/resident/".concat(e,"/avatar"),n,{})).data},getOfficials:async()=>{try{return(await x.get("/admin/officials")).data}catch(e){console.warn("getOfficials: primary request failed; attempting public backend fallback. Error:",e);try{const e=await g.get("/officials");return Array.isArray(e.data)?e.data:[]}catch(t){return[]}}},createOfficial:async e=>{try{return(await x.post("/admin/officials",e)).data}catch(t){throw t}},updateOfficial:async(e,t)=>{try{return(await x.put("/admin/officials/".concat(e),t)).data}catch(n){if(!navigator.onLine)return void await d.performOperation("update","officials",(0,a.A)((0,a.A)({},t),{},{_id:e}));throw n}},deleteOfficial:async e=>(await x.delete("/admin/officials/".concat(e))).data,disableUser:async(e,t)=>(await x.patch("/admin/users/".concat(e,"/disable"),t||{})).data,enableUser:async e=>(await x.patch("/admin/users/".concat(e,"/enable"))).data,uploadOfficialPhoto:async(e,t)=>{const n=new FormData;n.append("photo",t);try{return(await x.post("/admin/officials/".concat(e,"/photo"),n,{headers:{}})).data}catch(a){try{a&&a.response&&a.response.data?console.error("uploadOfficialPhoto axios error response:",a.response.data):console.error("uploadOfficialPhoto axios error",a)}catch(s){}try{const t="".concat(p,"/admin/officials/").concat(e,"/photo"),a=await fetch(t,{method:"POST",body:n,credentials:"include"}),s=await a.json().catch(()=>({}));if(!a.ok){const e=s&&s.message?s.message:"Upload failed with status ".concat(a.status),t=new Error(e);throw t.response={status:a.status,data:s},t}return s}catch(i){throw i}}},approveStaffApplicant:async e=>(await x.post("/admin/staff-applications/".concat(e,"/approve"))).data,createAnnouncement:async e=>(await x.post("/admin/announcements",e,{headers:{"Content-Type":"multipart/form-data"}})).data,listAdminAnnouncements:async()=>(await x.get("/admin/announcements/list")).data,deleteAnnouncement:async e=>(await x.delete("/admin/announcements/".concat(e))).data,updateAnnouncement:async(e,t)=>(await x.put("/admin/announcements/".concat(e),t,{headers:{"Content-Type":"multipart/form-data"}})).data},C={getPersonalInfo:async()=>{const e=["/resident/my-info","/resident/personal-info","/resident/profile"];for(const a of e)try{const e=await x.get(a);if(e&&e.data)return e.data}catch(n){}try{const e=await x.get("/resident/personal-info");if(e&&e.data)return e.data}catch(n){}const t=new Error("Resident personal info not found");throw t.response={status:404},t},updatePersonalInfo:async e=>(await x.put("/resident/my-info",e)).data},k=(0,a.A)((0,a.A)({},v),{},{getUsers:async()=>{try{return(await x.get("/auth/users")).data}catch(e){throw console.error("authAPI.getUsers failed",e),e}}})},57290:(e,t,n)=>{n.d(t,{A:()=>N});var a=n(9950),s=n(43850),i=n(32858),r=n(35621),l=n(46004),o=n(65369),d=n(82056),c=n(15429),u=n(51496),h=n(4159),m=n.n(h),p=n(89379),x=n(89790),g=n(9762),f=n(10495),y=n(23072),A=n(87094),j=n(41988),v=n(57796),b=n(44414);const{Text:w}=s.A,I=e=>{const[t,n]=String(e||"").split(":").map(e=>parseInt(e,10));return Number.isNaN(t)||Number.isNaN(n)?NaN:60*t+n},S=e=>{let{date:t,existingRanges:n=[],onChange:s}=e;const[i,r]=(0,a.useState)(null),[l,o]=(0,a.useState)(null),d=(0,a.useMemo)(()=>n.map(e=>{const t=I(e.start),n=I(e.end);return Number.isNaN(t)||Number.isNaN(n)?null:{start:t,end:n}}).filter(Boolean),[n]),c=480,u=1020,h=()=>{const e=[];for(let t=0;t<24;t++){const n=60*t;(n+59<c||n>=u)&&e.push(t)}return e},m=e=>{const t=[];for(let n=0;n<60;n++){const a=60*e+n;if(a<c||a>=u)t.push(n);else if(a>=720&&a<780)t.push(n);else for(const e of d)if(a>=e.start&&a<e.end){t.push(n);break}}return t},p=(0,a.useMemo)(()=>d.map(e=>({left:Math.max(0,(e.start-c)/540*100),width:Math.max(0,(Math.min(e.end,u)-Math.max(e.start,c))/540*100),start:e.start,end:e.end})),[d]);return(0,b.jsxs)("div",{children:[(0,b.jsxs)(A.A,{gutter:12,align:"middle",children:[(0,b.jsxs)(j.A,{children:[(0,b.jsx)(w,{strong:!0,children:"Start"}),(0,b.jsx)("div",{children:(0,b.jsx)(v.A,{value:i,onChange:e=>{r(e||null);const t=e?e.format("HH:mm"):void 0,n=l?l.format("HH:mm"):void 0;s(t,n)},format:"HH:mm",disabledHours:h,disabledMinutes:e=>m(e),minuteStep:5})})]}),(0,b.jsxs)(j.A,{children:[(0,b.jsx)(w,{strong:!0,children:"End"}),(0,b.jsx)("div",{children:(0,b.jsx)(v.A,{value:l,onChange:e=>{o(e||null);const t=i?i.format("HH:mm"):void 0,n=e?e.format("HH:mm"):void 0;s(t,n)},format:"HH:mm",disabledHours:h,disabledMinutes:e=>m(e),minuteStep:5})})]})]}),(0,b.jsxs)("div",{style:{marginTop:8},children:[(0,b.jsx)("div",{style:{height:10,background:"#f0f0f0",position:"relative",borderRadius:4},children:p.map((e,t)=>(0,b.jsx)("div",{title:"".concat(Math.floor(e.start/60).toString().padStart(2,"0"),":").concat((e.start%60).toString().padStart(2,"0")," - ").concat(Math.floor(e.end/60).toString().padStart(2,"0"),":").concat((e.end%60).toString().padStart(2,"0")),style:{position:"absolute",left:"".concat(e.left,"%"),width:"".concat(e.width,"%"),top:0,bottom:0,background:"rgba(220,53,69,0.85)",borderRadius:4}},t))}),(0,b.jsxs)("div",{style:{marginTop:6,fontSize:12,color:"#666"},children:[(0,b.jsx)("span",{style:{marginRight:12},children:"Office hours: 08:00\u201317:00"}),(0,b.jsx)("span",{style:{marginRight:12},children:"Lunch: 12:00\u201313:00"}),(0,b.jsx)("span",{children:"Blocked intervals shown in red"})]})]})]})},C=e=>{var t;let{visible:n,record:s,onClose:r}=e;const[d,c]=(0,a.useState)([]),[h,A]=(0,a.useState)({}),[j,v]=(0,a.useState)(!1),[w,I]=(0,a.useState)({});(0,a.useEffect)(()=>{n&&(c([]),A({}),(async()=>{try{const e=await u.contactAPI.getAllInquiries(),t={};(e||[]).forEach(e=>{e.scheduledDates&&Array.isArray(e.scheduledDates)&&e.scheduledDates.forEach(e=>{const n=e.date;n&&(t[n]=t[n]||[],t[n].push({start:e.startTime,end:e.endTime}))})}),I(t)}catch(e){console.warn("Failed to fetch scheduled appointments",e)}})())},[n]);const C=(0,a.useMemo)(()=>s&&s.appointmentDates?s.appointmentDates:[],[s]);return(0,b.jsxs)(x.A,{open:n,onCancel:r,footer:null,width:780,title:"Appointment Details",children:[(0,b.jsxs)(g.A,{column:1,bordered:!0,children:[(0,b.jsx)(g.A.Item,{label:"Resident",children:(null===(t=s.createdBy)||void 0===t?void 0:t.fullName)||s.username}),(0,b.jsx)(g.A.Item,{label:"Message",children:s.message}),(0,b.jsxs)(g.A.Item,{label:"Requested Dates",children:[0===C.length&&(0,b.jsx)("div",{children:"No dates requested"}),C.map(e=>(0,b.jsxs)("div",{style:{marginBottom:8},children:[(0,b.jsx)(f.A,{onChange:t=>{return n=e,void(t.target.checked?c(e=>[...e,n]):(c(e=>e.filter(e=>e!==n)),A(e=>{const t=(0,p.A)({},e);return delete t[n],t})));var n},children:m()(e).format("MMM DD, YYYY")}),d.includes(e)&&(0,b.jsx)("div",{style:{marginTop:8,marginLeft:24},children:(0,b.jsx)(S,{date:e,existingRanges:w[e]||[],onChange:(t,n)=>{return a=e,s=t,i=n,void A(e=>(0,p.A)((0,p.A)({},e),{},{[a]:{start:s,end:i}}));var a,s,i}})})]},e))]})]}),(0,b.jsx)(y.A,{}),(0,b.jsxs)(l.A,{style:{display:"flex",justifyContent:"flex-end"},children:[(0,b.jsx)(o.Ay,{onClick:r,children:"Close"}),(0,b.jsx)(o.Ay,{type:"primary",onClick:async()=>{const e=(()=>{for(const e of d){const t=h[e];if(!t||!t.start||!t.end)return{ok:!1,msg:"Please supply time range for ".concat(e)};const n=t.start,a=t.end,s=w[e]||[];for(const i of s)if(n<i.end&&a>i.start)return{ok:!1,msg:"Selected time ".concat(n,"-").concat(a," overlaps existing appointment ").concat(i.start,"-").concat(i.end," on ").concat(e)}}return{ok:!0}})();if(!e.ok)return void i.Ay.error(e.msg);const t=d.map(e=>({date:e,startTime:h[e].start,endTime:h[e].end}));v(!0);try{await u.contactAPI.resolveInquiry(s._id),await u.contactAPI.getInquiryById(s._id);const e="/api/inquiries/".concat(s._id),n=JSON.stringify({scheduledDates:t,status:"scheduled"}),a=await fetch(e,{method:"POST",headers:{"Content-Type":"application/json"},body:n}),l=await a.json().catch(()=>null);if(!a.ok){const e=l&&l.message?l.message:"Request failed";throw new Error(e)}i.Ay.success("Appointment scheduled"),r()}catch(n){console.error(n),i.Ay.error("Failed to schedule appointment")}finally{v(!1)}},loading:j,disabled:0===d.length,children:"Confirm Appointment"})]})]})},{Text:k}=s.A,N=()=>{const[e,t]=(0,a.useState)(!1),[n,s]=(0,a.useState)([]),[h,p]=(0,a.useState)(null),[x,g]=(0,a.useState)(!1),f=async()=>{t(!0);try{const e=await u.contactAPI.getAllInquiries(),t=Array.isArray(e)?e.filter(e=>"SCHEDULE_APPOINTMENT"===e.type):[];s(t)}catch(e){console.error(e),i.Ay.error("Failed to fetch appointments")}finally{t(!1)}};(0,a.useEffect)(()=>{f()},[]);const y=(0,a.useMemo)(()=>[{title:"Resident Name",dataIndex:["createdBy","fullName"],key:"resident",render:(e,t)=>{var n;return(null===(n=t.createdBy)||void 0===n?void 0:n.fullName)||t.username}},{title:"Inquiry ID",dataIndex:"_id",key:"_id",render:e=>(0,b.jsx)(k,{copyable:!0,children:e})},{title:"Submitted On",dataIndex:"createdAt",key:"createdAt",render:e=>m()(e).format("MMM DD, YYYY hh:mm A")},{title:"Requested Dates",dataIndex:"appointmentDates",key:"appointmentDates",render:e=>(e||[]).map(e=>(0,b.jsx)("div",{children:m()(e).format("MMM DD, YYYY")},e))},{title:"Status",dataIndex:"status",key:"status",render:e=>{const t="scheduled"===e?"green":"resolved"===e?"gray":"orange";return(0,b.jsx)(r.A,{color:t,style:{textTransform:"capitalize"},children:e||"open"})}},{title:"Actions",key:"actions",render:(e,t)=>(0,b.jsxs)(l.A,{children:[(0,b.jsx)(o.Ay,{onClick:()=>{p(t),g(!0)},children:"View"}),(0,b.jsx)(o.Ay,{type:"primary",onClick:()=>{p(t),g(!0)},children:"Schedule"})]})}],[]);return(0,b.jsxs)(d.A,{title:"Staff \u2014 Appointments",style:{borderRadius:12},children:[(0,b.jsx)(c.A,{rowKey:e=>e._id,dataSource:n,columns:y,loading:e}),h&&(0,b.jsx)(C,{visible:x,record:h,onClose:()=>{g(!1),p(null),f()}})]})}},69522:(e,t,n)=>{n.d(t,{Y:()=>i});var a=n(4159),s=n.n(a);function i(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"";try{const n=s()(e);return n.isValid()?t?n.format("MM/DD/YYYY h:mm:ss A"):n.format("MM/DD/YYYY"):String(e)}catch(n){return String(e)}}},97009:(e,t,n)=>{n.d(t,{A:()=>ee});var a=n(89379),s=n(9950);const i="DocumentProcessing_wrapper__mgdlQ",r="DocumentProcessing_pageTitle__6x0cP",l="DocumentProcessing_loadingWrap__6rGYa",o="DocumentProcessing_controls__oQbzN",d="DocumentProcessing_controlInput__WD8hf",c="DocumentProcessing_controlSelect__-KBnD",u="DocumentProcessing_controlDate__vbgUi",h="DocumentProcessing_mobileList__fzS+Q",m="DocumentProcessing_mobileCard__teinV",p="DocumentProcessing_mobileCardRow__ffMTN",x="DocumentProcessing_mobileMeta__0G75s",g="DocumentProcessing_iconWrap__AgQnd",f="DocumentProcessing_mobileTitleWrap__tkYpI",y="DocumentProcessing_mobileTitle__-0V-d",A="DocumentProcessing_mobileSubtitle__Z5HFo",j="DocumentProcessing_mobileActions__UKz34",v="DocumentProcessing_statusTag__xF-xu",b="DocumentProcessing_actionButtons__JVicD",w="DocumentProcessing_uploadDate__AiEGx",I="DocumentProcessing_modalContent__ZldTP",S="DocumentProcessing_previewWrapper__mLLdQ",C="DocumentProcessing_previewPane__ckBOK",k="DocumentProcessing_requestPane__EIwR2",N="DocumentProcessing_previewHtml__3X+05",T="DocumentProcessing_previewFooter__8KQ9W",D="DocumentProcessing_generateButton__hWg5N";var P=n(10827),_=n(75376),R=n(43850),U=n(82056),B=n(78401),q=n(89096),L=n(68689),O=n(96172),F=n(35621),E=n(65369),z=n(15429),M=n(46004),W=n(89790),Y=n(24893),V=n(89485),H=n(52786),G=n(49600),K=n(90008),J=n(32207),Z=n(54021),$=n(51496),Q=n(69522);var X=n(44414);const ee=()=>{var e,t,ee,te;const[ne,ae]=(0,s.useState)([]),[se,ie]=(0,s.useState)(!0),[re,le]=(0,s.useState)(!1),[oe,de]=(0,s.useState)(null),[ce,ue]=(0,s.useState)([]),[he,me]=(0,s.useState)({}),[pe,xe]=(0,s.useState)(!1),[ge,fe]=(0,s.useState)(""),[ye,Ae]=(0,s.useState)(!1),[je,ve]=(0,s.useState)([]),[be,we]=(0,s.useState)(""),[Ie,Se]=(0,s.useState)(null),[Ce,ke]=(0,s.useState)(!0),Ne=(0,s.useRef)({}),[Te,De]=(0,s.useState)(!1),[Pe]=(0,s.useState)([]),[_e,Re]=(0,s.useState)(null),[Ue,Be]=(0,s.useState)(null),[qe,Le]=(0,s.useState)(null),[Oe,Fe]=(0,s.useState)(!1),[Ee,ze]=(0,s.useState)(null),[Me,We]=(0,s.useState)(!1),[Ye,Ve]=(0,s.useState)(""),[He,Ge]=(0,s.useState)(null),[Ke,Je]=(0,s.useState)(null),[Ze,$e]=(0,s.useState)(null),Qe=(0,P.zy)(),Xe=(0,P.Zp)(),et=Qe&&Qe.state&&Qe.state.openRequestId?Qe.state.openRequestId:null,tt=s.useCallback(e=>{const t=he[e];return t?Array.isArray(t)?t:[t]:[]},[he]),nt=e=>{const t=tt(e);return t.length?t[0]:null},at=s.useCallback(e=>{const t=tt(e);if(!t||!t.length)return null;return t.find(e=>e.notes&&e.notes.toString().toLowerCase().includes("priority")||!0===e.priority)||t[0]},[tt]),st=(0,s.useRef)(null),it=(0,s.useRef)(null),rt=async()=>{ie(!0);try{const e=await $.documentsAPI.listFiles(),t=await $.documentsAPI.getDocumentRecords(),n=Array.from(new Set((t||[]).map(e=>(e.type||"").toLowerCase()).filter(Boolean)));ue(n);const a={},s=e=>(e||"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase();e.forEach(e=>{if(!e||!e.filename)return;const n=s(e.filename),i=(t||[]).filter(e=>e.type&&n.includes(s(e.type)));i&&i.length&&(a[e._id]=i)});const i=e.filter(e=>{if(!e||!e.filename)return!1;if(0===n.length)return!0;const t=e.filename.replace(/[_\s]/g,"").toLowerCase();return n.some(e=>t.includes(e.replace(/[_\s]/g,"")))});ae(i),me(a)}catch(e){me({})}finally{ie(!1)}};(0,s.useEffect)(()=>{rt();const e=()=>We(window.innerWidth<=720);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{if(!et)return;const e=Object.keys(he).find(e=>(Array.isArray(he[e])?he[e]:he[e]?[he[e]]:[]).some(e=>(e._id||e.requestId)===et));if(e){const t=ne.find(t=>t._id===e);t&&(de(t),(async()=>{try{var e,n;await(null===(e=st.current)||void 0===e?void 0:e.call(st,t)),Se(et),await(null===(n=it.current)||void 0===n?void 0:n.call(it,et)),xe(!0)}catch(a){}})())}else(async()=>{try{if($.documentsAPI.getDocumentById){const t=await $.documentsAPI.getDocumentById(et);if(t){ve([t]),Se(et);try{const e=t.fieldValues||{},n=Object.keys(e);if(n.length){const t="\n                    <table style=\"width:100%;border-collapse:collapse;\">\n                      <thead>\n                        <tr>\n                          <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Field</th>\n                          <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Submitted Value</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        ".concat(n.map(t=>"<tr><td style='border:1px solid #ccc;padding:8px;'>".concat(t,"</td><td style='border:1px solid #ccc;padding:8px;'>").concat(e[t]||"","</td></tr>")).join(""),"\n                      </tbody>\n                    </table>\n                    // when we open a preview for a request that wasn't tied to a specific file in mapping,\n                    // attempt to scroll to and highlight the request's entry if present in the UI\n                    setTimeout(() => {\n                      try {\n                        const el = rowRefs.current[openRequestIdFromNav];\n                        if (el && el.scrollIntoView) {\n                          el.scrollIntoView({ behavior: 'smooth', block: 'center' });\n                          el.classList.add('cv-highlight');\n                          if (highlightTimeoutRef.current) window.clearTimeout(highlightTimeoutRef.current);\n                          // remove highlight after 2s\n                          // @ts-ignore - window.setTimeout returns number in browser\n                          highlightTimeoutRef.current = window.setTimeout(() => el.classList.remove('cv-highlight'), 2000);\n                        }\n                      } catch (e) {}\n                    }, 120);\n                  ");fe(t)}else fe('<div style="color:#666">No submitted field values available.</div>')}catch(e){fe('<div style="color:red">Failed to build preview.</div>')}xe(!0)}}}catch(e){}})();try{Xe(Qe.pathname,{replace:!0,state:{}})}catch(t){}},[he,ne,Xe,Qe.pathname,et]);const lt=s.useCallback(async e=>{xe(!0),Ae(!0),fe("");try{var t;const a=(tt(e._id)||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase());ve(a);const s=at(e._id),i=a[0]||null,r=s&&"pending"===(s.status||"").toString().toLowerCase()?s:null;Se(r?r._id||r.requestId:(null===i||void 0===i?void 0:i._id)||(null===i||void 0===i?void 0:i.requestId)||null);const l=await(await Promise.resolve().then(n.bind(n,51496))).axiosPublic.get("/documents/preview/".concat(e._id),{params:{format:"html"},responseType:"text"}),o=l&&l.data?l.data:"";we(o);const d=r?r._id||r.requestId:(null===i||void 0===i?void 0:i._id)||(null===i||void 0===i?void 0:i.requestId)||null;d&&await(null===(t=it.current)||void 0===t?void 0:t.call(it,d))}catch(a){fe('<div style="color:red">Failed to load preview.</div>')}Ae(!1)},[tt,at]);st.current=lt;const ot=s.useCallback(async e=>{try{const t=Object.values(he).flat().find(t=>(t._id||t.requestId)===e)||null,n=(null===t||void 0===t?void 0:t.fieldValues)||{},a=be||"",s=/\{(.*?)\}/g;let i;const r=[];for(;null!==(i=s.exec(a));)r.push(i[1].trim());if(r.length>0){const e="\n          <table style=\"width:100%;border-collapse:collapse;\">\n            <thead>\n              <tr>\n                <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Field</th>\n                <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Submitted Value</th>\n              </tr>\n            </thead>\n            <tbody>\n              ".concat(r.map(e=>{const t=n[e]||"";return"<tr><td style='border:1px solid #ccc;padding:8px;'>".concat(e,"</td><td style='border:1px solid #ccc;padding:8px;'>").concat(t,"</td></tr>")}).join(""),"\n            </tbody>\n          </table>\n        ");fe(e)}else fe('<div style="color:red">No { ... } content found.</div>')}catch(t){fe('<div style="color:red">Failed to load preview.</div>')}},[he,be]);it.current=ot;const dt=async e=>{de(e),await lt(e)};return se?(0,X.jsx)("div",{className:l,children:(0,X.jsx)(_.A,{size:"large"})}):(0,X.jsxs)("div",{className:i,children:[(0,X.jsx)(R.A.Title,{level:3,className:r}),(0,X.jsx)(U.A,{title:"Document Processing",extra:(0,X.jsxs)("div",{className:o,children:[(0,X.jsx)(B.A,{prefix:(0,X.jsx)(H.A,{}),placeholder:"Search documents",className:d,value:Ye,onChange:e=>Ve(e.target.value),onPressEnter:()=>{}}),(0,X.jsx)(q.A,{allowClear:!0,placeholder:"Document Type",className:c,value:He,onChange:e=>Ge(e),children:ce.map(e=>(0,X.jsx)(q.A.Option,{value:e,children:e},e))}),(0,X.jsxs)(q.A,{allowClear:!0,placeholder:"Status",className:c,value:Ke,onChange:e=>Je(e),children:[(0,X.jsx)(q.A.Option,{value:"pending",children:"Pending"}),(0,X.jsx)(q.A.Option,{value:"approved",children:"Approved"}),(0,X.jsx)(q.A.Option,{value:"rejected",children:"Rejected"})]}),(0,X.jsx)(L.A.RangePicker,{className:u,onChange:e=>$e(e)})]}),children:Me?(0,X.jsx)("div",{className:h,children:ne.filter(e=>{if(Ye&&!(e.filename||"").toLowerCase().includes(Ye.toLowerCase()))return!1;if(He&&(e.type||"").toLowerCase()!==He.toLowerCase())return!1;const t=nt(e._id),n=(null===t||void 0===t?void 0:t.status)||"";if(Ke&&n.toLowerCase()!==Ke.toLowerCase())return!1;if(Ze&&Ze[0]&&Ze[1]&&e.uploadDate){const t=new Date(e.uploadDate),n=Ze[0].toDate(),a=Ze[1].toDate();if(t<n||t>a)return!1}return!0}).map(e=>{const t=e.filename||"",n=(t.split(".").pop()||"").toLowerCase();let a=(0,X.jsx)(G.A,{style:{color:"#2B6CB0",fontSize:20}});"pdf"===n&&(a=(0,X.jsx)(K.A,{style:{color:"#E53E3E",fontSize:20}})),["png","jpg","jpeg","gif","svg","bmp"].includes(n)&&(a=(0,X.jsx)(J.A,{style:{color:"#319795",fontSize:20}}));const s=nt(e._id),i=(null===s||void 0===s?void 0:s.status)||"";return(0,X.jsx)(U.A,{size:"small",className:m,ref:t=>{const n=nt(e._id),a=n&&(n._id||n.requestId);a&&(Ne.current[a]=t)},children:(0,X.jsxs)("div",{className:p,children:[(0,X.jsxs)("div",{className:x,children:[(0,X.jsx)("div",{className:g,children:a}),(0,X.jsxs)("div",{className:f,children:[(0,X.jsx)(O.A,{title:t,children:(0,X.jsx)("div",{className:y,children:t.replace(/\.docx$/i,"")})}),(0,X.jsx)("div",{className:A,children:e.type||"Unknown"})]})]}),(0,X.jsxs)("div",{className:j,children:[(0,X.jsx)(F.A,{className:v,color:"pending"===i?"orange":"approved"===i?"green":"rejected"===i?"red":"default",children:(i||"").toUpperCase()}),(0,X.jsx)("div",{className:b,children:(0,X.jsx)(E.Ay,{size:"small",icon:(0,X.jsx)(Z.A,{}),onClick:()=>dt(e),children:Me?null:"Preview"})}),(0,X.jsx)("div",{className:w,children:e.uploadDate?(0,Q.Y)(e.uploadDate):""})]})]})},e._id)})}):(0,X.jsx)(z.A,{rowKey:e=>e._id,dataSource:ne.filter(e=>{if(Ye&&!(e.filename||"").toLowerCase().includes(Ye.toLowerCase()))return!1;if(He&&(e.type||"").toLowerCase()!==He.toLowerCase())return!1;const t=nt(e._id),n=(null===t||void 0===t?void 0:t.status)||"";if(Ke&&n.toLowerCase()!==Ke.toLowerCase())return!1;if(Ze&&Ze[0]&&Ze[1]&&e.uploadDate){const t=new Date(e.uploadDate),n=Ze[0].toDate(),a=Ze[1].toDate();if(t<n||t>a)return!1}return!0}),pagination:{pageSize:10},columns:[{title:"File",dataIndex:"filename",key:"filename",sorter:(e,t)=>(e.filename||"").localeCompare(t.filename||""),render:(e,t)=>{const n=e||"",a=(n.split(".").pop()||"").toLowerCase();let s=(0,X.jsx)(G.A,{style:{color:"#2B6CB0"}});return"pdf"===a&&(s=(0,X.jsx)(K.A,{style:{color:"#E53E3E"}})),["png","jpg","jpeg","gif","svg","bmp"].includes(a)&&(s=(0,X.jsx)(J.A,{style:{color:"#319795"}})),(0,X.jsx)(O.A,{title:n,children:(0,X.jsx)("span",{style:{maxWidth:280,display:"inline-block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:(0,X.jsxs)(M.A,{align:"center",children:[s,(0,X.jsx)("span",{children:n.replace(/\.docx$/i,"")})]})})})}},{title:"Status",dataIndex:"status",key:"status",render:(e,t)=>{const n=t||{},a=n.metadata&&!0===n.metadata.online||("number"===typeof n.length?n.length>0:Boolean(n.contentType)),s=a?"ONLINE":"OFFLINE",i=a?"green":"red";return(0,X.jsx)(F.A,{color:i,children:s})}},{title:"Uploaded On",dataIndex:"uploadDate",key:"uploadDate",sorter:(e,t)=>new Date(e.uploadDate).getTime()-new Date(t.uploadDate).getTime(),render:e=>e?(0,Q.Y)(e):""},{title:"Actions",key:"actions",render:(e,t)=>(0,X.jsx)(M.A,{children:(0,X.jsx)(E.Ay,{size:"small",icon:(0,X.jsx)(Z.A,{}),onClick:()=>dt(t),children:"Preview"})})}],rowClassName:e=>"",onRow:e=>{const t=nt(e._id),n=t&&(t._id||t.requestId);return{ref:e=>{n&&(Ne.current[n]=e)}}}})}),(0,X.jsx)(W.A,{title:oe?oe.filename.replace(/\.docx$/i,""):"",open:re,onCancel:()=>le(!1),footer:null,width:800,children:oe?(0,X.jsx)("div",{className:I,children:(0,X.jsx)(z.A,{dataSource:[(0,a.A)((0,a.A)({},oe),{},{requesterName:(null===(e=nt(oe._id))||void 0===e?void 0:e.username)||(null===(t=nt(oe._id))||void 0===t?void 0:t.requesterName)||"Unknown",barangayID:(null===(ee=nt(oe._id))||void 0===ee?void 0:ee.barangayID)||"Unknown",status:(null===(te=nt(oe._id))||void 0===te?void 0:te.status)||"Unknown"})],pagination:!1,rowKey:"_id",columns:[{title:"Requester Name",dataIndex:"requesterName",key:"requesterName",render:e=>e||"Unknown"},{title:"Barangay ID",dataIndex:"barangayID",key:"barangayID",render:e=>e||"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>e||"Unknown"},{title:"Actions",key:"actions",render:(e,t)=>(0,X.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,X.jsx)("button",{style:{background:"#2196F3",color:"#fff",border:"none",borderRadius:6,padding:"4px 12px",cursor:"pointer",fontWeight:600},onClick:()=>lt(t),children:"Process"}),(0,X.jsx)("button",{style:{background:"#43D96B",color:"#fff",border:"none",borderRadius:6,padding:"4px 12px",cursor:"pointer",fontWeight:600},children:"Complete"}),(0,X.jsx)("button",{style:{background:"#FF3B3B",color:"#fff",border:"none",borderRadius:6,padding:"4px 12px",cursor:"pointer",fontWeight:600},children:"Reject"})]})}]})}):(0,X.jsx)(_.A,{})}),(0,X.jsx)(W.A,{title:"Generated / Processed Copy Saved",open:Oe,onCancel:()=>Fe(!1),footer:[(0,X.jsx)(E.Ay,{onClick:()=>Fe(!1),children:"Close"},"close")],children:(0,X.jsxs)("div",{children:[(0,X.jsx)("div",{style:{marginBottom:8},children:"A copy of the generated document was saved."}),qe&&!Ee?(0,X.jsxs)("div",{style:{marginBottom:10},children:[(0,X.jsxs)("div",{style:{marginBottom:6},children:[(0,X.jsx)("strong",{children:"Generated metadata ID:"})," ",(0,X.jsx)("code",{children:qe})]}),(0,X.jsx)("div",{children:(0,X.jsx)("a",{href:"".concat($.API_URL.replace(/\/$/,""),"/generated-documents/").concat(qe,"/raw"),target:"_blank",rel:"noreferrer",children:"Open generated copy (generated_documents)"})})]}):null,Ee?(0,X.jsxs)("div",{children:[(0,X.jsxs)("div",{style:{marginBottom:6},children:[(0,X.jsx)("strong",{children:"Processed document ID:"})," ",(0,X.jsx)("code",{children:Ee})]}),(0,X.jsx)("div",{children:(0,X.jsx)("a",{href:"".concat($.API_URL.replace(/\/$/,""),"/processed-documents/").concat(Ee,"/raw"),target:"_blank",rel:"noreferrer",children:"Open processed copy (processed_documents)"})})]}):null,qe||Ee?null:(0,X.jsx)("div",{children:"No saved copy id available."})]})}),(0,X.jsx)(W.A,{title:"Prioritize Request",open:Te,onCancel:()=>De(!1),onOk:async()=>{if(_e)try{if($.documentsAPI.prioritize)await $.documentsAPI.prioritize(_e);else if($.documentsAPI.updateDocumentStatus){var e;let t=null;for(const e of Object.values(he)){const n=(Array.isArray(e)?e:[e]).find(e=>(e._id||e.requestId)===_e);if(n){t=n;break}}const n=(null===(e=t)||void 0===e?void 0:e.status)||"pending";await $.documentsAPI.updateDocumentStatus(_e,{status:n,notes:"PRIORITY"})}if(De(!1),await rt(),Ue)try{const e=tt(Ue);let n=e.find(e=>(e._id||e.requestId)===_e)||null;if(!n&&$.documentsAPI.getDocumentById)try{n=await $.documentsAPI.getDocumentById(_e)}catch(t){n=null}me(n?t=>{const n=(0,a.A)({},t);return n[Ue]=Array.isArray(e)?e:e?[e]:[],n}:e=>{try{const t=(0,a.A)({},e),n=t[Ue],s=Array.isArray(n)?n.slice():n?[n]:[],i=s.findIndex(e=>(e._id||e.requestId)===_e);return-1!==i&&(s[i]=(0,a.A)((0,a.A)({},s[i]),{},{priority:!0,notes:(s[i].notes||"")+" PRIORITY"})),t[Ue]=s,t}catch(t){return e}})}catch(t){}if(oe&&Ue&&oe._id===Ue){const e=tt(Ue);ve(e),Se(_e),_e&&await ot(_e)}alert("Prioritization saved"),Be(null)}catch(n){console.error(n),alert("Failed to prioritize")}else alert("Select a request to prioritize")},okText:"Save Priority",cancelText:"Cancel",okButtonProps:{disabled:0===Pe.length||!_e},children:0===Pe.length?(0,X.jsx)("div",{children:"No other requests found for this document type."}):(0,X.jsx)(Y.Ay.Group,{onChange:e=>Re(e.target.value),value:_e,style:{display:"flex",flexDirection:"column",gap:8},children:Pe.map(e=>(0,X.jsxs)(Y.Ay,{value:e.requestId||e.fileId,style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,X.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,X.jsx)("strong",{children:e.requesterName}),(0,X.jsx)("small",{style:{color:"#666"},children:e.createdAt?(0,Q.Y)(e.createdAt):""})]}),(0,X.jsx)("div",{style:{marginLeft:12},children:_e===(e.requestId||e.fileId)?(0,X.jsx)(F.A,{color:"red",children:"Selected"}):null})]},e.requestId||e.fileId))})}),(0,X.jsx)(W.A,{title:oe?"Preview: ".concat(oe.filename.replace(/\.docx$/i,"")):"Preview",open:pe,onCancel:()=>xe(!1),footer:null,width:Me?"100%":900,styles:{body:{padding:Me?10:void 0}},children:ye?(0,X.jsx)(_.A,{}):(0,X.jsxs)(X.Fragment,{children:[Me?(0,X.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:8},children:(0,X.jsx)(E.Ay,{size:"small",onClick:()=>ke(e=>!e),children:Ce?"Hide Requests":"Show Requests"})}):null,(0,X.jsxs)("div",{className:S,children:[(0,X.jsx)("div",{className:C,children:(0,X.jsx)("div",{className:N,dangerouslySetInnerHTML:{__html:ge}})}),Ce?(0,X.jsx)("div",{className:k,children:(0,X.jsxs)("div",{style:{marginTop:Me?6:12,padding:8,border:"1px solid #eee",borderRadius:6},children:[(0,X.jsx)("div",{style:{marginBottom:8,fontWeight:600},children:"Select Request to Preview"}),(0,X.jsx)("div",{style:{maxHeight:300,overflowY:"auto",paddingRight:6},children:(0,X.jsx)(Y.Ay.Group,{value:Ie,onChange:async e=>{const t=e.target.value;Se(t),await ot(t)},style:{display:"flex",flexDirection:"column",gap:8},children:je&&je.length?je.map(e=>(0,X.jsx)(Y.Ay,{value:e._id||e.requestId,children:(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,X.jsxs)("div",{children:[(0,X.jsx)("div",{style:{fontWeight:600},children:e.username||e.requesterName||"Unknown"}),(0,X.jsx)("div",{style:{fontSize:12,color:"#666"},children:e.createdAt?(0,Q.Y)(e.createdAt):""})]}),(0,X.jsx)("div",{style:{alignSelf:"center"},children:e.notes&&e.notes.toString().toLowerCase().includes("priority")||e.priority?(0,X.jsx)(F.A,{color:"red",children:"PRIORITY"}):null})]})},e._id||e.requestId)):(0,X.jsx)("div",{style:{color:"#666"},children:"No pending requests available for this file."})})})]})}):null]}),(0,X.jsx)("div",{className:T,children:(0,X.jsx)("button",{className:D,onClick:async()=>{if(oe){try{var e;let i=null;if(Ie){i=tt(oe._id).find(e=>(e._id||e.requestId)===Ie)||null}if(i||(i=at(oe._id)||nt(oe._id)),!i||!i.fieldValues)return void alert("No document request or field values found for this file.");const r=await async function(e,t,n){const a={fieldValues:t};n&&(a.requestId=n);const s=await $.axiosInstance.post("/documents/".concat(e,"/generate-filled"),a,{responseType:"blob"}),i=s.headers["content-disposition"]||s.headers["Content-Disposition"];let r="";if(i){const e=i.match(/filename\*=(?:UTF-8'')?([^;\n\r]+)/i),t=i.match(/filename="?([^";]+)"?/i);if(e&&e[1])try{r=decodeURIComponent(e[1].replace(/^UTF-8''/,""))}catch(m){r=e[1]}else t&&t[1]&&(r=t[1])}const l=s.headers["x-filled-file-id"]||s.headers["X-Filled-File-Id"]||null,o=s.headers["x-processed-gridfs-id"]||s.headers["X-Processed-GridFS-Id"]||null,d=o||l,c=s.headers["x-generated-doc-id"]||s.headers["X-Generated-Doc-Id"]||null,u=s.headers["x-processed-doc-id"]||s.headers["X-Processed-Doc-Id"]||null,h=s.headers["x-transaction-code"]||s.headers["X-Transaction-Code"]||null;return console.log("[generateFilledDocx] transactionCode=",h,"content-disposition filename=",r),{blob:s.data,filename:r,savedId:d,generatedCopyId:c,processedDocId:u,processedGridFsId:o,transactionCode:h}}(oe._id,i.fieldValues,i._id||i.requestId),l=r.blob,o=i&&(i.transactionCode||i.transactionId||i.txId||i.transaction_id||i._id||i.requestId)||r.transactionCode||r.generatedCopyId||r.processedDocId||null,d=o?String(o).replace(/[^a-zA-Z0-9-_.]/g,"_"):null,c=r.transactionCode||i&&i.transactionCode||d||null,u=c?"".concat(String(c).replace(/[^a-zA-Z0-9-_.]/g,"_"),".docx"):r.filename||"filled_".concat(oe.filename||"document",".docx"),h=window.URL.createObjectURL(new Blob([l],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"})),m=document.createElement("a");m.href=h,m.setAttribute("download",u),document.body.appendChild(m),m.click(),null===(e=m.parentNode)||void 0===e||e.removeChild(m),window.URL.revokeObjectURL(h);if(r.savedId||null){await rt();const e=r.processedDocId||null;e?(V.Ay.open({message:"Generated copy saved",description:(0,X.jsxs)("div",{children:["Saved to processed documents. ",(0,X.jsx)("a",{href:"".concat($.API_URL.replace(/\/$/,""),"/processed-documents/").concat(e,"/raw"),target:"_blank",rel:"noreferrer",children:"Open processed copy"})]}),duration:8}),ze(e),Fe(!0)):V.Ay.open({message:"Generated document saved",description:"Saved to server processed documents.",duration:6}),r.generatedCopyId&&(Le(r.generatedCopyId),Fe(!0))}else try{const e=new FormData;e.append("file",new Blob([l],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),u),e.append("sourceTemplateId",oe._id||""),e.append("requestId",i._id||i.requestId||"");const n=$.API_URL.replace(/\/$/,"");let a=!1;const s=["".concat(n,"/processed-documents/upload"),"".concat(n,"/documents/upload-inline"),"".concat(n,"/documents/upload"),"".concat(n,"/documents"),"".concat(n,"/admin/documents/upload")];for(const i of s)try{if((await fetch(i,{method:"POST",body:e,credentials:"include"})).ok){a=!0;break}}catch(t){}if(a){await rt();const e=r.processedDocId||null;e?(V.Ay.open({message:"Generated copy saved",description:(0,X.jsxs)("div",{children:["Saved to processed documents. ",(0,X.jsx)("a",{href:"".concat($.API_URL.replace(/\/$/,""),"/processed-documents/").concat(e,"/raw"),target:"_blank",rel:"noreferrer",children:"Open processed copy"})]}),duration:8}),ze(e),Fe(!0)):V.Ay.open({message:"Generated document uploaded",description:"Uploaded to server processed documents.",duration:6})}else console.warn("Upload fallback failed; generated file was downloaded but not uploaded to documents collection."),alert("Generated document downloaded. Server-side save not confirmed.")}catch(a){console.error("Upload fallback error",a),alert("Generated document downloaded but upload to server failed.")}try{let e=Ie;if(!e){const t=at(oe._id)||nt(oe._id);e=t&&(t._id||t.requestId)||null}e&&($.documentsAPI.updateDocumentStatus?await $.documentsAPI.updateDocumentStatus(e,{status:"approved"}):await(await Promise.resolve().then(n.bind(n,51496))).axiosInstance.patch("/document-requests/".concat(e,"/process")),await rt(),xe(!1),alert("Request marked as completed."))}catch(s){console.warn("Failed to mark request complete after generation",(null===s||void 0===s?void 0:s.message)||s)}}catch(i){console.error("Generation error",i),alert("Failed to generate filled document.")}xe(!1)}},children:"Generate"})})]})})]})}}}]);