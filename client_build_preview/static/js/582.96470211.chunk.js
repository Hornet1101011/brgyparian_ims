"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[582],{31694:(e,t,n)=>{n.r(t),n.d(t,{API_URL:()=>p,adminAPI:()=>S,authAPI:()=>k,authService:()=>y,axiosInstance:()=>x,axiosPublic:()=>g,contactAPI:()=>w,default:()=>x,documentsAPI:()=>b,getAbsoluteApiUrl:()=>f,getInbox:()=>A,getTemplateText:()=>c,notificationAPI:()=>u,requestsAPI:()=>I,residentPersonalInfoAPI:()=>C,staffRegister:()=>h,verificationAPI:()=>j});var a=n(89379),s=n(56403),i=n(72799);class r{constructor(){this.db=null}static getInstance(){return r.instance||(r.instance=new r),r.instance}async initialize(){this.db=await(0,i.P2)("barangay-system",1,{upgrade(e){if(!e.objectStoreNames.contains("users")){e.createObjectStore("users",{keyPath:"_id"}).createIndex("by-email","email")}if(!e.objectStoreNames.contains("documents")){e.createObjectStore("documents",{keyPath:"_id"}).createIndex("by-user","userId")}e.objectStoreNames.contains("syncQueue")||e.createObjectStore("syncQueue",{keyPath:"_id",autoIncrement:!0})}})}async addToSyncQueue(e,t,n){this.db||await this.initialize(),await this.db.add("syncQueue",{operation:e,collection:t,data:n,timestamp:Date.now()})}async getAllFromSyncQueue(){return this.db||await this.initialize(),this.db.getAll("syncQueue")}async clearSyncQueue(){this.db||await this.initialize();const e=this.db.transaction("syncQueue","readwrite");await e.objectStore("syncQueue").clear()}async saveUser(e){this.db||await this.initialize(),await this.db.put("users",e)}async getUser(e){return this.db||await this.initialize(),this.db.get("users",e)}async getAllUsers(){return this.db||await this.initialize(),this.db.getAll("users")}async deleteUser(e){this.db||await this.initialize(),await this.db.delete("users",e)}async saveDocument(e){this.db||await this.initialize(),await this.db.put("documents",e)}async getDocument(e){return this.db||await this.initialize(),this.db.get("documents",e)}async getAllDocuments(){return this.db||await this.initialize(),this.db.getAll("documents")}async deleteDocument(e){this.db||await this.initialize(),await this.db.delete("documents",e)}async saveSettings(e){this.db||await this.initialize(),await this.db.put("users",(0,a.A)({_id:"settings"},e))}async getSettings(){return this.db||await this.initialize(),this.db.get("users","settings")}}r.instance=void 0;const l=r.getInstance();class o{constructor(){this.isOnline=navigator.onLine,this.syncInterval=null,this.handleOnline=async()=>{this.isOnline=!0,console.log("Connection restored. Starting sync..."),await this.syncWithServer()},this.handleOffline=()=>{this.isOnline=!1,console.log("Connection lost. Operating in offline mode...")},this.setupEventListeners(),this.startSyncInterval()}static getInstance(){return o.instance||(o.instance=new o),o.instance}setupEventListeners(){window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline)}startSyncInterval(){this.syncInterval||(this.syncInterval=setInterval(async()=>{this.isOnline&&await this.syncWithServer()},3e5))}async syncWithServer(){try{const t=await l.getAllFromSyncQueue();if(0===t.length)return;console.log("Syncing ".concat(t.length," pending changes..."));for(const n of t)try{await this.processSyncItem(n)}catch(e){if(e&&"object"===typeof e&&"message"in e&&"string"===typeof e.message){if(console.error("Failed to sync item:",n,e),"Network Error"===e.message){this.isOnline=!1;break}}else console.error("Failed to sync item:",n,e)}await l.clearSyncQueue()}catch(e){e&&"object"===typeof e&&"message"in e&&"string"===typeof e.message?console.error("Sync failed:",e.message):console.error("Sync failed:",e)}}async processSyncItem(e){const{operation:t,collection:n,data:a}=e;switch(t){case"create":await x.post("/".concat(n),a);break;case"update":await x.put("/".concat(n,"/").concat(a._id),a);break;case"delete":await x.delete("/".concat(n,"/").concat(a._id))}}async performOperation(e,t,n){switch(e){case"create":case"update":await l.saveUser(n);break;case"delete":await l.deleteUser(n._id)}await l.addToSyncQueue(e,t,n),this.isOnline&&await this.syncWithServer()}cleanup(){this.syncInterval&&clearInterval(this.syncInterval),window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline)}}o.instance=void 0;const d=o.getInstance(),c=e=>x.get("/templates/".concat(e)).then(e=>e.data.text),u={getNotifications:async()=>{try{const e=await x.get("/notifications");return Array.isArray(e.data)?e.data:e.data&&e.data.data?e.data.data:[]}catch(e){try{const e=await x.get("/notifications/fallback");return Array.isArray(e.data)?e.data:e.data&&e.data.data?e.data.data:[]}catch(t){return console.error("notificationAPI.getNotifications failed:",e),[]}}},approveStaff:async(e,t)=>(await x.post("/notifications/approve",{userId:e,notificationId:t})).data,rejectStaff:async(e,t)=>(await x.post("/notifications/reject",{notificationId:e,reason:t})).data,markAsRead:async e=>(await x.post("/notifications/read",{notificationId:e})).data},h=async e=>(await x.post("/auth/register/staff",e)).data,m=globalThis.__APP_CONFIG__,p=m&&m.API_BASE||"https://my-backend.onrender.com/api",x=s.A.create({baseURL:p,headers:{"Content-Type":"application/json"},withCredentials:!0}),g=s.A.create({baseURL:p,headers:{"Content-Type":"application/json"},withCredentials:!1});function f(e){const t=globalThis.__APP_CONFIG__,n=t&&t.API_BASE||"https://my-backend.onrender.com/api";let a=String(n).replace(/\/$/,"");a.endsWith("/api")&&(a=a.replace(/\/api$/,""));const s=e.startsWith("/")?e:"/".concat(e);return s.startsWith("/api")?"".concat(a).concat(s):"".concat(a,"/api").concat(s)}const y={login:async(e,t)=>(await x.post("/auth/login",{email:e,password:t})).data,register:async e=>(await x.post("/auth/register",e)).data,logout:async()=>{await x.post("/auth/logout")},getCurrentUser:async()=>(await x.get("/auth/me")).data};x.interceptors.request.use(e=>{const t=localStorage.getItem("token")||localStorage.getItem("guestSessionToken");return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e}),x.interceptors.response.use(e=>e,e=>{try{var t;if(401===(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status)&&"undefined"!==typeof window){const t=window.location.pathname||"",s=(null===e||void 0===e?void 0:e.config)&&(e.config.url||"")||(null===e||void 0===e?void 0:e.request)&&e.request.responseURL||"",i=s.includes("/auth/login")||s.includes("/auth/me");if("/login"===t||t.startsWith("/login")||i)try{localStorage.removeItem("guestSessionToken")}catch(n){}else{console.warn("API responded 401 Unauthorized \u2014 clearing auth and redirecting to login");try{localStorage.removeItem("token"),localStorage.removeItem("guestSessionToken")}catch(n){}try{sessionStorage.getItem("redirectingToLogin")||(sessionStorage.setItem("redirectingToLogin","1"),setTimeout(()=>{window.location.href="/login"},100))}catch(n){try{window.location.href="/login"}catch(a){}}}}}catch(n){}return Promise.reject(e)});const A=async()=>x.get("/messages/inbox"),j={getRequests:async()=>x.get("/verification/admin/requests").then(e=>e.data),verifyUser:async(e,t)=>x.post("/verification/admin/verify-user/".concat(e),{verified:t}).then(e=>e.data),getFileUrl:e=>"".concat(p.replace(/\/$/,""),"/verification/file/").concat(e),approveRequest:async e=>x.post("/verification/admin/requests/".concat(e,"/approve")).then(e=>e.data),rejectRequest:async(e,t)=>x.post("/verification/admin/requests/".concat(e,"/reject"),{reason:t}).then(e=>e.data),cancelRequest:async e=>x.delete("/verification/requests/".concat(e)).then(e=>e.data),getMyRequests:async()=>x.get("/verification/requests/my").then(e=>e.data),getRequestById:async e=>x.get("/verification/requests/".concat(e)).then(e=>e.data)},v={login:e=>x.post("/auth/login",e).then(e=>e.data),register:e=>x.post("/auth/register",e).then(e=>e.data)},b={getMyDocuments:()=>x.get("/document-requests/my-requests").then(e=>e.data),requestDocument:e=>x.post("/document-requests",e).then(e=>e.data),getDocumentById:e=>x.get("/document-requests/".concat(e)).then(e=>e.data),getAllDocuments:()=>x.get("/document-requests/all").then(e=>e.data).catch(e=>{var t;if(401===(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status))return[];throw e}),getDocumentRecords:()=>x.get("/document-requests/all").then(e=>e.data),updateDocumentStatus:(e,t)=>x.patch("/document-requests/".concat(e,"/process"),t).then(e=>e.data),processDocument:e=>x.patch("/document-requests/".concat(e,"/process")).then(e=>e.data),listFiles:()=>x.get("/documents/list").then(e=>e.data),deleteFile:e=>x.delete("/documents/file/".concat(e)).then(e=>e.data),updateFileStatus:(e,t)=>x.patch("/documents/file/".concat(e,"/status"),t).then(e=>e.data),getFilledDocument:e=>x.get("/document-requests/".concat(e,"/filled")).then(e=>e.data),previewFilledDocument:e=>x.post("/document-requests/preview-filled",e).then(e=>e.data)},w={submitInquiry:e=>"undefined"!==typeof FormData&&e instanceof FormData?x.post("/inquiries",e,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>e.data):x.post("/inquiries",e).then(e=>e.data),getMyInquiries:(e,t)=>x.get("/inquiries/my-inquiries",{params:e&&t?{username:e,barangayID:t}:void 0}).then(e=>e.data),getInquiryById:e=>x.get("/inquiries/".concat(e)).then(e=>e.data),getAllInquiries:()=>x.get("/inquiries").then(e=>e.data),respondToInquiry:(e,t)=>x.post("/inquiries/".concat(e,"/responses"),t).then(e=>e.data),resolveInquiry:e=>x.patch("/inquiries/".concat(e),{status:"resolved"}).then(e=>e.data),getAnnouncements:()=>x.get("/announcements").then(e=>e.data),getAnnouncementById:e=>x.get("/announcements/".concat(e)).then(e=>e.data)},I={getAllRequests:async()=>x.get("/requests").then(e=>e.data),getRequestById:async e=>x.get("/requests/".concat(e)).then(e=>e.data),getStaffAccessRequests:async()=>{const e=await x.get("/requests").then(e=>e.data);return Array.isArray(e)?e.filter(e=>"staff_access"===(e.type||"").toString().toLowerCase()&&"pending"===(e.status||"").toString().toLowerCase()):[]},approveRequest:async e=>(await x.post("/requests/".concat(e,"/approve"))).data},S={createUser:async e=>{try{const n=await x.post("/admin/users",e);if(n.data){await l.saveUser(n.data);try{const e=new CustomEvent("userProfileUpdated",{detail:n.data});window.dispatchEvent(e)}catch(t){}}}catch(n){throw navigator.onLine||await d.performOperation("create","users",e),n}},updateUser:async(e,t)=>{try{const a=await x.put("/admin/users/".concat(e),t);if(a.data){await l.saveUser(a.data);try{const e=new CustomEvent("userProfileUpdated",{detail:a.data});window.dispatchEvent(e)}catch(n){}}}catch(s){throw navigator.onLine||await d.performOperation("update","users",(0,a.A)((0,a.A)({},t),{},{_id:e})),s}},demoteUser:async e=>{try{return(await x.put("/admin/users/".concat(e),{role:"resident"})).data}catch(t){if(!navigator.onLine)return void await d.performOperation("update","users",{_id:e,role:"resident"});throw t}},getSystemSettings:async()=>{try{return(await x.get("/admin/settings")).data}catch(e){if(!navigator.onLine){const e=await l.getSettings();if(e)return e}try{return(await x.get("/settings")).data}catch(t){try{return(await x.get("/admin/settings")).data}catch(n){try{return(await x.get("/settings")).data}catch(a){try{return(await x.get("/settings/public")).data}catch(s){try{const e=await l.getSettings();if(e)return e}catch(i){}console.warn("getSystemSettings: all fallbacks failed; returning empty defaults. Original error:",e);return{siteName:"Barangay Information System",contactEmail:"",smtp:{passwordSet:!1}}}}}}}},updateSystemSettings:async e=>{try{const t=await x.patch("/admin/settings",e);return await l.saveSettings(e),t.data}catch(t){if(!navigator.onLine)return void await d.performOperation("update","settings",e);try{const t=await x.patch("/admin/settings",e,{withCredentials:!0});try{await l.saveSettings(e)}catch(n){}return t.data}catch(a){throw t}}},testSmtp:async e=>(await x.post("/admin/settings/test-smtp",{to:e})).data,getUsers:async()=>{try{const e=(await x.get("/auth/users")).data;for(const t of e)await l.saveUser(t);return e}catch(e){if(!navigator.onLine)return l.getAllUsers();throw e}},updateUserStatus:async(e,t)=>{try{const a=await x.put("/admin/users/".concat(e,"/status"),{status:t}),s=await l.getUser(e);if(s){s.status=t,await l.saveUser(s);try{const e=new CustomEvent("userProfileUpdated",{detail:s});window.dispatchEvent(e)}catch(n){}}return a.data}catch(a){if(!navigator.onLine){const n=await l.getUser(e);return void(n&&(n.status=t,await d.performOperation("update","users",n)))}throw a}},deleteUser:async e=>{try{await x.delete("/admin/users/".concat(e)),await l.deleteUser(e);try{const t=new CustomEvent("userProfileUpdated",{detail:{_id:e,deleted:!0}});window.dispatchEvent(t)}catch(t){}}catch(n){if(!navigator.onLine)return void await d.performOperation("delete","users",{_id:e});throw n}},getActivityLogs:e=>x.get("/admin/logs",{params:e}).then(e=>e.data),getSystemStatistics:()=>x.get("/admin/statistics").then(e=>e.data),getStaffApplicants:async()=>(await x.get("/admin/staff-applications")).data,getUserWithResident:async e=>(await x.get("/admin/users/".concat(e,"/with-resident"))).data,getResidentByBarangayID:async e=>(await x.get("/admin/resident/".concat(encodeURIComponent(e)))).data,getResident:async e=>(await x.get("/admin/resident/id/".concat(e))).data,updateResident:async(e,t)=>(await x.put("/admin/resident/".concat(e),t)).data,uploadResidentAvatar:async(e,t)=>{const n=new FormData;n.append("avatar",t);return(await x.post("/admin/resident/".concat(e,"/avatar"),n,{})).data},getOfficials:async()=>{try{return(await x.get("/admin/officials")).data}catch(e){console.warn("getOfficials: primary request failed; attempting public backend fallback. Error:",e);try{const e=await g.get("/officials");return Array.isArray(e.data)?e.data:[]}catch(t){return[]}}},createOfficial:async e=>{try{return(await x.post("/admin/officials",e)).data}catch(t){throw t}},updateOfficial:async(e,t)=>{try{return(await x.put("/admin/officials/".concat(e),t)).data}catch(n){if(!navigator.onLine)return void await d.performOperation("update","officials",(0,a.A)((0,a.A)({},t),{},{_id:e}));throw n}},deleteOfficial:async e=>(await x.delete("/admin/officials/".concat(e))).data,disableUser:async(e,t)=>(await x.patch("/admin/users/".concat(e,"/disable"),t||{})).data,enableUser:async e=>(await x.patch("/admin/users/".concat(e,"/enable"))).data,uploadOfficialPhoto:async(e,t)=>{const n=new FormData;n.append("photo",t);try{return(await x.post("/admin/officials/".concat(e,"/photo"),n,{headers:{}})).data}catch(a){try{a&&a.response&&a.response.data?console.error("uploadOfficialPhoto axios error response:",a.response.data):console.error("uploadOfficialPhoto axios error",a)}catch(s){}try{const t="".concat(p,"/admin/officials/").concat(e,"/photo"),a=await fetch(t,{method:"POST",body:n,credentials:"include"}),s=await a.json().catch(()=>({}));if(!a.ok){const e=s&&s.message?s.message:"Upload failed with status ".concat(a.status),t=new Error(e);throw t.response={status:a.status,data:s},t}return s}catch(i){throw i}}},approveStaffApplicant:async e=>(await x.post("/admin/staff-applications/".concat(e,"/approve"))).data,createAnnouncement:async e=>(await x.post("/admin/announcements",e,{headers:{"Content-Type":"multipart/form-data"}})).data,listAdminAnnouncements:async()=>(await x.get("/admin/announcements/list")).data,deleteAnnouncement:async e=>(await x.delete("/admin/announcements/".concat(e))).data,updateAnnouncement:async(e,t)=>(await x.put("/admin/announcements/".concat(e),t,{headers:{"Content-Type":"multipart/form-data"}})).data},C={getPersonalInfo:async()=>{const e=["/resident/my-info","/resident/personal-info","/resident/profile"];for(const a of e)try{const e=await x.get(a);if(e&&e.data)return e.data}catch(n){}try{const e=await x.get("/resident/personal-info");if(e&&e.data)return e.data}catch(n){}const t=new Error("Resident personal info not found");throw t.response={status:404},t},updatePersonalInfo:async e=>(await x.put("/resident/my-info",e)).data},k=(0,a.A)((0,a.A)({},v),{},{getUsers:async()=>{try{return(await x.get("/auth/users")).data}catch(e){throw console.error("authAPI.getUsers failed",e),e}}})},59977:(e,t,n)=>{n.d(t,{Y:()=>i});var a=n(60446),s=n.n(a);function i(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"";try{const n=s()(e);return n.isValid()?t?n.format("MM/DD/YYYY h:mm:ss A"):n.format("MM/DD/YYYY"):String(e)}catch(n){return String(e)}}},68582:(e,t,n)=>{n.r(t),n.d(t,{default:()=>rs});var a=n(89379),s=n(65043),i=n(16569),r=n(89073),l=n(47419),o=n(11645),d=n(65512),c=n(36621),u=n(15492),h=n(79617),m=n(8354),p=n(91686),x=n(70644),g=n(54522),f=n(76399),y=n(70494),A=n(31694),j=n(70579);const v=e=>{let{user:t,src:n,profileImageId:s,size:i=40,alt:r="",className:l,style:o,cacheBust:d=!1,cacheToken:c}=e;const u=t,h=s||(null===u||void 0===u?void 0:u.profileImageId)||null;let m=n||(null===u||void 0===u?void 0:u.profileImage)||(null===u||void 0===u?void 0:u.profilePicture)||null;try{m&&"string"===typeof m&&!m.startsWith("http")&&(m=(0,A.getAbsoluteApiUrl)(m))}catch(g){}if(h){const e=(0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(h)),t=d?"".concat(e).concat(e.includes("?")?"&":"?","t=").concat(null!==c&&void 0!==c?c:Date.now()):e;return(0,j.jsx)("img",{src:t,alt:r||(null===u||void 0===u?void 0:u.fullName)||(null===u||void 0===u?void 0:u.username)||(null===u||void 0===u?void 0:u.email)||"avatar",width:i,height:i,style:(0,a.A)({width:i,height:i,borderRadius:"50%",objectFit:"cover"},o),className:l})}if(m){let e=m;try{d&&"string"===typeof e&&!e.startsWith("http")&&(e="".concat(e).concat(e.includes("?")?"&":"?","t=").concat(null!==c&&void 0!==c?c:Date.now()))}catch(g){}return(0,j.jsx)("img",{src:e,alt:r||(null===u||void 0===u?void 0:u.fullName)||(null===u||void 0===u?void 0:u.username)||(null===u||void 0===u?void 0:u.email)||"avatar",width:i,height:i,style:(0,a.A)({width:i,height:i,borderRadius:"50%",objectFit:"cover"},o),className:l})}const p=((null===u||void 0===u?void 0:u.fullName)||(null===u||void 0===u?void 0:u.username)||(null===u||void 0===u?void 0:u.email)||"").toString().trim()||"User",x="https://ui-avatars.com/api/?name=".concat(encodeURIComponent(p),"&background=2196F3&color=fff&size=").concat(Math.max(Math.min(i,256),32));return(0,j.jsx)("img",{src:x,alt:r||p||"avatar",width:i,height:i,style:(0,a.A)({width:i,height:i,borderRadius:"50%",objectFit:"cover"},o),className:l})},b=e=>{let{src:t,user:n,profileImageId:s,size:i="default",alt:r,className:l,style:o,children:d,icon:c,background:u="#1890ff",color:h="#fff"}=e;const m=(e=>{if("number"===typeof e)return e;switch(e){case"small":return 24;case"large":return 56;default:return 36}})(i);if(Boolean(t||s||n&&(n.profileImage||n.profileImageId||n.profilePicture||n.avatar)))return(0,j.jsx)(v,{src:t,user:n,profileImageId:s,size:m,alt:r,className:l,style:o});const p=c?(0,j.jsx)("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center"},children:c}):(0,j.jsx)("span",{style:{display:"inline-flex",alignItems:"center",justifyContent:"center",fontWeight:700},children:d||(n&&(n.fullName||n.username||n.email)?String((n.fullName||n.username||n.email)[0]).toUpperCase():"U")}),x=(0,a.A)({width:m,height:m,borderRadius:"50%",display:"inline-flex",alignItems:"center",justifyContent:"center",background:u,color:h,fontSize:Math.max(12,Math.floor(m/2.8))},o);return(0,j.jsx)("div",{className:l,style:x,"aria-hidden":!0,children:p})};var w=n(58288),I=n(28795),S=n(42971),C=n(68397);const k="inbox_message-container__rX6C-",N="inbox_chatImage__YoIVB",T="inbox_inboxPage__qLICz",_="inbox_conversationList__V8Qfk",P="inbox_conversationCard__0ZhMt",D="inbox_replyBarWrap__NrUXO",R="inbox_replyBar__qUVby",q="inbox_sendButton__10H5U",B="inbox_listItem__TZQpm",L="inbox_listItemInner__+Z2ab",U="inbox_listItemMain__R3uU0",O="inbox_listItemHeader__h-API",z="inbox_typeIcon__ANjkn",F="inbox_listItemName__IGuuH",E="inbox_listItemSubject__MISAk",M="inbox_listItemTime__ly-VI",W="inbox_listItemPreview__QUfIX",Y="inbox_listItemPreviewText__0W1MG",H="inbox_listItemResponses__BN1Uo",V="inbox_listItemAvatar__GZMLt",{Option:G}=d.A,K={status:"all",search:""},J=()=>{const[e,t]=(0,s.useState)(!0),[n,v]=(0,s.useState)([]),[G,J]=(0,s.useState)(K),[Z,$]=(0,s.useState)("All"),[Q,X]=(0,s.useState)({}),[ee,te]=(0,s.useState)({}),[ne,ae]=(0,s.useState)(null),[se,ie]=(0,s.useState)(!1),[re,le]=(0,s.useState)(!1),[oe,de]=(0,s.useState)(!0),[ce,ue]=(0,s.useState)("undefined"!==typeof window&&window.innerWidth<=720),[he,me]=(0,s.useState)(""),[pe,xe]=(0,s.useState)([]),[ge,fe]=(0,s.useState)(!1),ye=(0,s.useRef)(null);(0,s.useEffect)(()=>{ye.current&&ye.current.scrollIntoView({behavior:"smooth"})},[ne,ne&&ne.responses&&ne.responses.length]);const Ae=(()=>{try{return localStorage.getItem("userProfile")?JSON.parse(localStorage.getItem("userProfile")||"null"):null}catch(e){return null}})();(0,s.useEffect)(()=>{t(!0),A.contactAPI.getMyInquiries().then(e=>{v(e||[])}).catch(()=>{i.Ay.error("Failed to load inbox.")}).finally(()=>t(!1))},[]),(0,s.useEffect)(()=>{const e=()=>{try{ue(window.innerWidth<=720)}catch(e){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{ce?(le(!0),de(!1)):(le(!1),de(!0))},[ce]);const je=n.filter(e=>{let t=!0;"pending"===G.status&&(t=!e.responses||0===e.responses.length),"responded"===G.status&&(t="resolved"===e.status||e.responses&&e.responses.length>0),"closed"===G.status&&(t="closed"===e.status);let n=!0;Z&&"All"!==Z&&(n=e.category===Z);const a=G.search.toLowerCase(),s=!a||e.residentName&&e.residentName.toLowerCase().includes(a)||e.category&&e.category.toLowerCase().includes(a)||e.subject&&e.subject.toLowerCase().includes(a)||e.createdAt&&new Date(e.createdAt).toLocaleString().toLowerCase().includes(a);return t&&s&&n}),ve=e=>{fe(!0),de(!1),le(!0),setTimeout(()=>{ae(e),fe(!1),ie(!0)},250)},be=e=>{if(!e)return"";const t=Date.now()-new Date(e).getTime(),n=Math.floor(t/6e4);if(n<1)return"just now";if(n<60)return"".concat(n,"m");const a=Math.floor(n/60);if(a<24)return"".concat(a,"h");const s=Math.floor(a/24);return"".concat(s,"d")},we=e=>{let{author:t,avatar:n,content:a,datetime:s,align:i="left"}=e;return(0,j.jsx)("div",{style:{display:"flex",justifyContent:"left"===i?"flex-start":"flex-end"},children:(0,j.jsxs)("div",{className:k,children:["left"===i&&n,(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{style:{fontSize:13,fontWeight:600},children:t}),(0,j.jsx)("div",{style:{marginTop:6},children:a}),s&&(0,j.jsx)("div",{style:{marginTop:6,fontSize:12,color:"#777"},children:s})]}),"right"===i&&n]})})},Ie=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?";if(!e)return t;try{const n=String(e).trim();return n.length>0?n.charAt(0).toUpperCase():t}catch(n){return t}};return(0,j.jsx)("div",{className:T,style:{minHeight:"100vh",background:"#f0f4f8",padding:"24px",fontFamily:"Poppins, Arial, sans-serif",position:"relative"},children:(0,j.jsxs)(r.A,{style:{maxWidth:1200,margin:"0 auto",borderRadius:18,boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.08)",padding:0,background:"#fff"},bodyStyle:{padding:0,background:"#fff"},children:[(0,j.jsxs)("div",{style:{padding:"24px 32px 0 32px"},children:[(0,j.jsxs)(l.A,{gutter:[12,12],align:"middle",style:{marginBottom:12},children:[(0,j.jsx)(o.A,{xs:24,sm:6,children:(0,j.jsxs)(d.A,{value:Z,onChange:e=>$(e),style:{width:"100%"},children:[(0,j.jsx)(d.A.Option,{value:"All",children:"All"}),(0,j.jsx)(d.A.Option,{value:"Complaints",children:"Complaints"}),(0,j.jsx)(d.A.Option,{value:"Requests",children:"Requests"}),(0,j.jsx)(d.A.Option,{value:"Announcements",children:"Announcements"})]})}),(0,j.jsx)(o.A,{xs:24,sm:12,children:(0,j.jsx)(c.A.Search,{placeholder:"Search by date, name, or category",allowClear:!0,value:G.search,onChange:e=>J(t=>(0,a.A)((0,a.A)({},t),{},{search:e.target.value})),onSearch:e=>J(t=>(0,a.A)((0,a.A)({},t),{},{search:e}))})}),(0,j.jsxs)(o.A,{xs:24,sm:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:8},children:[(0,j.jsx)("div",{style:{flex:1}}),(0,j.jsx)(u.Ay,{type:"text",onClick:()=>le(e=>!e),style:{borderRadius:8},title:re?"Show conversation list":"Hide conversation list",icon:re?(0,j.jsx)(w.A,{}):(0,j.jsx)(I.A,{})})]})]}),(0,j.jsxs)(h.A.Title,{level:3,style:{marginBottom:0,color:"#1890ff",display:"flex",alignItems:"center",gap:8,fontFamily:"Poppins, Arial, sans-serif"},children:[(0,j.jsx)("span",{role:"img","aria-label":"inbox",children:"\ud83d\udce9"})," Inbox"]})]}),(0,j.jsx)(m.A,{style:{margin:"16px 0 0 0"}}),(0,j.jsx)("div",{style:{padding:"0 32px 32px 32px"},children:e?(0,j.jsx)(p.A,{}):0===je.length?(0,j.jsx)(x.Ay,{icon:(0,j.jsx)(S.A,{}),status:"info",title:"No messages yet",subTitle:"There are no messages in your inbox."}):(0,j.jsxs)("div",{style:{display:"flex",gap:16},children:[re?(0,j.jsxs)("div",{style:{width:72,maxHeight:500,overflowY:"auto",display:"flex",flexDirection:"column",alignItems:"center",gap:8,paddingTop:8},children:[(0,j.jsx)(u.Ay,{type:"text",onClick:()=>le(!1),style:{borderRadius:8,background:"#fff",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},title:"Show list",children:(0,j.jsx)(w.A,{})}),(0,j.jsx)("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:8,padding:8},children:je.map(e=>{const t=e.residentName||e.username||e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||e.subject||"Unknown",n=t&&"Unknown"!==t?Ie(t,"?"):"?",a=ne&&ne._id===e._id;return(0,j.jsx)(y.A,{title:"".concat(t," \u2014 ").concat(e.subject||"No subject"),placement:"right",children:(0,j.jsx)("button",{onClick:()=>ve(e),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",padding:6,borderRadius:8,border:a?"2px solid #1890ff":"1px solid transparent",background:a?"#e6f7ff":"transparent",cursor:"pointer"},"aria-label":t,children:(0,j.jsx)(b,{style:{background:"#1890ff",color:"#fff",fontWeight:700},size:36,children:n})})},e._id)})})]}):(0,j.jsxs)("div",{className:_,style:{flex:oe?1:"0 0 300px",maxHeight:oe?"calc(100vh - 220px)":500,overflowY:"auto",position:"relative"},children:[(0,j.jsx)(u.Ay,{type:"text",onClick:()=>le(!0),style:{position:"absolute",right:-12,top:-8,zIndex:10,borderRadius:8,background:"#fff",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},title:"Collapse list",children:(0,j.jsx)(I.A,{})}),(0,j.jsx)(g.A,{itemLayout:"vertical",dataSource:je,renderItem:e=>{const t="resolved"===e.status?(0,j.jsx)(f.A,{color:"green",children:"Resolved"}):Array.isArray(e.responses)&&e.responses.length>0?null:(0,j.jsx)(f.A,{color:"gold",children:"Pending"}),n=(()=>{switch((e.category||"").toLowerCase()){case"complaints":return"\ud83d\uded1";case"requests":return"\ud83d\udce8";case"announcements":return"\ud83d\udce3";default:return"\u2709\ufe0f"}})(),a=ne&&ne._id===e._id;return(0,j.jsx)(g.A.Item,{className:B,style:{marginBottom:8,background:a?"#f7fbff":"#fff",borderRadius:12,border:"1px solid #e6edf3",boxShadow:"0 1px 4px rgba(31,38,135,0.04)",cursor:"pointer"},onClick:()=>ve(e),children:(0,j.jsxs)("div",{className:L,children:[(0,j.jsxs)("div",{className:U,children:[(0,j.jsxs)("div",{className:O,children:[(0,j.jsx)("span",{className:z,"aria-hidden":!0,children:n}),(0,j.jsx)(h.A.Text,{strong:!0,className:F,children:e.residentName||e.username||e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||"Unknown"}),(0,j.jsxs)(h.A.Text,{type:"secondary",className:E,children:["\u2014 ",e.subject||"No subject"]}),(0,j.jsx)("span",{className:M,children:e.createdAt?be(e.createdAt):""}),t?s.cloneElement(t,{style:{fontSize:11,padding:"0 6px",marginLeft:8}}):null]}),(0,j.jsx)("div",{className:W,children:(0,j.jsx)(h.A.Text,{type:"secondary",className:Y,children:e.message})}),(0,j.jsx)("div",{className:H,children:Array.isArray(e.responses)&&e.responses.length>0?(0,j.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:12},children:[e.responses.length," response(s)"]}):(0,j.jsx)(h.A.Text,{type:"secondary",style:{fontSize:12},children:"No responses yet"})})]}),(0,j.jsx)("div",{className:V,children:(()=>{const t=e.residentName||e.username||e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||e.subject||"Unknown",n=t&&"Unknown"!==t?Ie(t,"?"):"?";return(0,j.jsx)(b,{style:{background:"#1890ff",color:"#fff",fontWeight:700},size:36,children:n})})()})]})})}})]}),!oe&&(0,j.jsxs)("div",{style:{flex:1},children:[")",(0,j.jsx)(r.A,{className:P,style:{borderRadius:12,height:"100%",background:"transparent",boxShadow:"none",border:"none"},bodyStyle:{display:"flex",flexDirection:"column",padding:0,gap:10,background:"transparent"},children:ne?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,j.jsx)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:"resolved"===ne.status?(0,j.jsx)(f.A,{color:"green",children:"Resolved"}):(0,j.jsx)(f.A,{color:"gold",children:"Pending"})}),(0,j.jsx)("div",{style:{flex:1},children:(()=>{const e=ne.residentName||ne.username||ne.subject||"Unknown";return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(h.A.Text,{strong:!0,style:{display:"block",textAlign:"right",fontSize:15},children:e}),(0,j.jsx)(h.A.Text,{type:"secondary",style:{fontSize:10,display:"block",textAlign:"right"},children:ne.createdAt?new Date(ne.createdAt).toLocaleString():""})]})})()}),(()=>{const e=ne.residentName||ne.username||ne.createdBy&&(ne.createdBy.fullName||ne.createdBy.username)||ne.subject||"Unknown",t=e&&"Unknown"!==e?Ie(e,"?"):"?";return(0,j.jsx)(b,{size:40,style:{background:"#1890ff"},children:t})})()]}),(0,j.jsx)(m.A,{}),(0,j.jsxs)("div",{style:{overflowY:"auto",flex:1,display:"flex",flexDirection:"column",gap:10,paddingRight:6,minHeight:0,maxHeight:220},children:[(0,j.jsx)("div",{style:{alignSelf:"flex-end",maxWidth:"100%"},children:(()=>{const e=ne.residentName||ne.username||ne.createdBy&&(ne.createdBy.fullName||ne.createdBy.username)||"Resident",t=e&&"Resident"!==e?Ie(e,"U"):"U";return(0,j.jsx)(we,{author:e,avatar:(0,j.jsx)(b,{style:{background:"#1890ff"},children:t}),content:(0,j.jsxs)("div",{style:{background:"#e6f7ff",padding:10,borderRadius:8},children:[(0,j.jsx)(h.A.Paragraph,{style:{margin:0},children:ne.message}),ne.attachments&&ne.attachments.length>0&&(0,j.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:ne.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,j.jsx)("div",{children:s?(0,j.jsx)("a",{href:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),target:"_blank",rel:"noreferrer",children:(0,j.jsx)("img",{src:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),alt:a,className:N})}):(0,j.jsxs)("div",{children:[(0,j.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,j.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),datetime:(0,j.jsx)("span",{style:{fontSize:12},children:ne.createdAt?new Date(ne.createdAt).toLocaleString():""}),align:"right"})})()}),Array.isArray(ne.responses)&&ne.responses.map((e,t)=>{let n=(e.role||e.authorRole||e.author_role||""||"").toString().toLowerCase();const a=e.author||e.authorName||e.author_name||e.createdByName||e.createdByFullName||e.userName||e.user||"",s=e.createdBy?String(e.createdBy):void 0,i=Ae&&(Ae._id||Ae.id)?String(Ae._id||Ae.id):void 0;if(!n)try{let t;ne&&(ne.createdBy&&"string"===typeof ne.createdBy?t=String(ne.createdBy):ne.createdBy&&"object"===typeof ne.createdBy&&(ne.createdBy._id||ne.createdBy.id)?t=String(ne.createdBy._id||ne.createdBy.id):ne.residentId&&(t=String(ne.residentId)));const i=ne&&(ne.residentName||ne.username)?String(ne.residentName||ne.username).toLowerCase():"",r=(a||e.authorName||"").toString().toLowerCase();(t&&s&&t===s||i&&r&&i===r)&&(n="resident")}catch(u){}let r;if(a&&""!==a.trim())r=a;else if(i&&s&&i===s)r="You";else if(e.authorName&&""!==e.authorName.trim())r=e.authorName;else if(e.createdBy&&"object"===typeof e.createdBy&&(e.createdBy.fullName||e.createdBy.username))r=e.createdBy.fullName||e.createdBy.username;else if(e.createdByName&&"string"===typeof e.createdByName&&""!==e.createdByName.trim())r=e.createdByName;else if(e.user&&"object"===typeof e.user&&(e.user.fullName||e.user.username))r=e.user.fullName||e.user.username;else if("resident"===n)r=ne&&(ne.residentName||ne.username)?ne.residentName||ne.username:"Resident";else{let t;try{if(s&&ne&&Array.isArray(ne.assignedTo)){const e=ne.assignedTo.find(e=>String(e._id)===String(s));e&&(t=e.fullName||e.username)}}catch(u){}r=e.staffName||e.staffFullName||e.createdBy&&"object"===typeof e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||t||"Staff"}const l="resident"===n||"user"===n,o=i&&s&&i===s,d=l||o?"right":"left",c=l||o?(0,j.jsx)(b,{style:{background:"#1890ff"},children:Ie(r,"U")}):(0,j.jsx)(b,{style:{background:"#666"},children:Ie(r,"B")});return(0,j.jsx)("div",{style:{alignSelf:l||o?"flex-end":"flex-start",maxWidth:"100%"},children:(0,j.jsx)(we,{author:o?"You":r,avatar:c,content:(0,j.jsxs)("div",{style:{background:l||o?"#e6f7ff":"#f6f6f6",padding:10,borderRadius:8},children:[(0,j.jsx)(h.A.Paragraph,{style:{margin:0},children:e.text}),e.attachments&&e.attachments.length>0&&(0,j.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:e.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,j.jsx)("div",{children:s?(0,j.jsx)("a",{href:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),target:"_blank",rel:"noreferrer",children:(0,j.jsx)("img",{src:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),alt:a,className:N})}):(0,j.jsxs)("div",{children:[(0,j.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,j.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),datetime:(0,j.jsx)("span",{style:{fontSize:12},children:e.createdAt?new Date(e.createdAt).toLocaleString():""}),align:d})},t)}),(0,j.jsx)("div",{ref:ye})]}),(0,j.jsx)("div",{style:{marginTop:0,flexShrink:0},className:D,children:(0,j.jsxs)("div",{className:R,style:{background:"#fff",paddingTop:4,paddingBottom:4,borderTop:"1px solid #f0f0f0",display:"flex",alignItems:"flex-end",gap:8},children:[(0,j.jsx)("textarea",{value:he,onChange:e=>{me(e.target.value);const t=e.target;t.style.height="auto",t.style.height=Math.min(200,t.scrollHeight)+"px"},onKeyDown:async e=>{if("Enter"===e.key&&!e.shiftKey){if(e.preventDefault(),!he||""===he.trim())return i.Ay.warning("Reply cannot be empty");if(!ne||!ne._id)return i.Ay.error("No inquiry selected");const n=ne._id;te(e=>(0,a.A)((0,a.A)({},e),{},{[n]:!0}));try{const e=await A.contactAPI.respondToInquiry(ne._id,{response:he.trim()});v(t=>t.map(t=>t._id===e._id?e:t)),ae(e),me(""),i.Ay.success("Reply sent")}catch(t){console.error("Failed to send reply",t),i.Ay.error("Failed to send reply")}finally{te(e=>(0,a.A)((0,a.A)({},e),{},{[n]:!1}))}}},placeholder:"Type your reply...",style:{width:"100%",minHeight:40,maxHeight:200,resize:"none",padding:"10px 12px",borderRadius:12,border:"1px solid #e6edf3",boxShadow:"0 1px 4px rgba(15, 23, 42, 0.04)",fontSize:14,outline:"none",fontFamily:"Poppins, Arial, sans-serif",color:"#222"}}),(0,j.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,j.jsx)("button",{onClick:async()=>{if(!he||""===he.trim())return i.Ay.warning("Reply cannot be empty");if(!ne||!ne._id)return i.Ay.error("No inquiry selected");const e=ne._id;te(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!0}));try{const e=await A.contactAPI.respondToInquiry(ne._id,{response:he.trim()});v(t=>t.map(t=>t._id===e._id?e:t)),ae(e),me(""),i.Ay.success("Reply sent")}catch(t){console.error("Failed to send reply",t),i.Ay.error("Failed to send reply")}finally{te(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!1}))}},className:q,style:{background:"#0ea5a3",color:"#fff",border:"none",padding:"8px 14px",borderRadius:10,cursor:"pointer",fontSize:18,fontWeight:600,boxShadow:"0 4px 10px rgba(14,165,163,0.12)",display:"flex",alignItems:"center",justifyContent:"center"},title:"Send Reply",onMouseOver:e=>e.currentTarget.style.opacity="0.95",onMouseOut:e=>e.currentTarget.style.opacity="1",disabled:!(!ne||!ee[ne._id]),children:(0,j.jsx)(C.A,{style:{fontSize:22,verticalAlign:"middle"}})})})]})})]}):(0,j.jsx)("div",{style:{textAlign:"center",padding:32},children:(0,j.jsx)(h.A.Text,{type:"secondary",children:"Select a message to view the conversation"})})})]})]})})]})})};var Z=n(27297),$=n(61118),Q=n(92003),X=n(9316),ee=n(75698);const te="TemplatesManager_wrapper__Ir6oJ",ne="TemplatesManager_heading__IOTUf",ae="TemplatesManager_grid__HGJY6",se="TemplatesManager_card__5oVoa",ie="TemplatesManager_icon__Ngf7T",re="TemplatesManager_cardBody__eAZm7",le="TemplatesManager_cardTitle__11PxV",oe="TemplatesManager_actions__0blV1",de="TemplatesManager_previewModal__MLCBR",ce="TemplatesManager_previewHeader__hgaku",ue="TemplatesManager_previewTitle__uRp0+",he="TemplatesManager_previewClose__uTvt8",me="TemplatesManager_uploadWrap__gDNYG",pe=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(null),[r,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(!1),[c,h]=(0,s.useState)(null),[m,p]=(0,s.useState)(null),[x,g]=(0,s.useState)(null),[f,v]=(0,s.useState)("");return s.useEffect(()=>{(async()=>{d(!0),h(null);try{const e=await A.axiosPublic.get("/documents/list");t(e.data||[])}catch(e){h("Could not load templates.")}d(!1)})()},[]),(0,j.jsxs)("div",{className:te,children:[(0,j.jsx)("h2",{className:ne,children:"\ud83d\udcc2 Templates Manager"}),(0,j.jsxs)("div",{style:{marginBottom:32},children:[(0,j.jsx)("h3",{style:{fontWeight:"bold",fontSize:"1.1rem",marginBottom:"0.5rem",color:"#374151"}}),o&&(0,j.jsx)("div",{children:"Loading templates..."}),c&&(0,j.jsx)("div",{style:{color:"red"},children:c}),(0,j.jsx)("div",{className:ae,children:e.filter(e=>e&&e.filename).map(e=>{return(0,j.jsxs)("div",{className:se,children:[(0,j.jsx)("img",{src:"/word.png",alt:"Word Icon",className:ie}),(0,j.jsxs)("div",{className:re,children:[(0,j.jsx)("span",{className:le,children:(s=e.filename,s?s.replace(/_/g," ").replace(/\.docx$/,""):"Untitled")}),(0,j.jsxs)("div",{className:oe,children:[(0,j.jsx)(y.A,{title:"Preview",children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)($.A,{}),onClick:async t=>{if(t.stopPropagation(),n===e._id)return a(null),void v("");a(e._id),v("");try{const t=await A.axiosPublic.get("/documents/preview/".concat(e._id,"?format=html"),{responseType:"text"});v(t.data||"")}catch(s){v('<div style="color:red">Failed to load preview.</div>')}},children:"Preview"})}),(0,j.jsx)(y.A,{title:"Download",children:(0,j.jsx)(u.Ay,{type:"primary",icon:(0,j.jsx)(Q.A,{}),onClick:async()=>{p(null);try{const t=(await A.axiosInstance.get("/documents/original/".concat(e._id),{responseType:"blob"})).data,n=window.URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=e.filename,document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(n)}catch(t){p("Failed to download ".concat(e.filename," from MongoDB."))}},children:"Download"})}),(0,j.jsx)(y.A,{title:"Remove",children:(0,j.jsx)(u.Ay,{danger:!0,icon:(0,j.jsx)(X.A,{}),onClick:async()=>{d(!0),h(null);try{const n=(await A.axiosInstance.delete("/documents/file/".concat(e._id))).data;if(n&&n.success){const e=await A.axiosPublic.get("/documents/list");t(e.data||[])}else h("Delete failed.")}catch(n){h("Delete failed.")}d(!1)},children:"Remove"})})]}),n===e._id&&f&&(0,j.jsxs)("div",{className:de,children:[(0,j.jsxs)("div",{className:ce,children:[(0,j.jsx)("span",{className:ue,children:"Preview"}),(0,j.jsx)("button",{className:he,onClick:()=>{a(null),v("")},children:"Close"})]}),(0,j.jsx)("div",{dangerouslySetInnerHTML:{__html:f}})]})]})]},e._id);var s})})]}),m&&(0,j.jsx)("div",{style:{color:"red",marginBottom:16},children:m}),(0,j.jsx)("div",{className:me,children:(0,j.jsx)(Z.A,{accept:".docx",showUploadList:!1,customRequest:async e=>{let{file:n,onSuccess:a,onError:s}=e;d(!0),h(null);const r=new FormData;r.append("file",n);try{const e=(await A.axiosInstance.post("/documents/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data;if(e&&e.success){const e=await A.axiosPublic.get("/documents/list");t(e.data||[]),i.Ay.success("Upload successful"),a&&a("ok")}else h("Upload failed."),i.Ay.error("Upload failed"),s&&s(new Error("Upload failed"))}catch(l){h("Upload failed."),i.Ay.error("Upload failed"),s&&s(new Error("Upload failed"))}d(!1)},children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(ee.A,{}),type:"primary",children:"Upload .docx"})})})]})};var xe=n(25352),ge=n(23811),fe=n(63942);const ye="staffInbox_container__KxE+f",Ae="staffInbox_listPanel__zpTLD",je="staffInbox_threadPanel__xFqlp",ve="staffInbox_replyBar__iIm26",be="staffInbox_replyTextarea__VFa9n";var we=n(73847),Ie=n(31219);const Se=()=>{const[e,t]=(0,s.useState)(!0),[n,f]=(0,s.useState)([]),[y,v]=(0,s.useState)({status:"all",search:""}),[w,I]=(0,s.useState)("All"),[k,N]=(0,s.useState)(null),[T,_]=(0,s.useState)(""),[P,D]=(0,s.useState)({}),[R,q]=(0,s.useState)(!1),[B,L]=(0,s.useState)(!1),[U,O]=(0,s.useState)([]),z=(0,xe.zy)(),F=(0,s.useRef)(null);(0,s.useEffect)(()=>{E();const e=z&&z.state||{};if(e&&e.openInquiryId){const t=e.openInquiryId,a=setInterval(()=>{const e=n.find(e=>e._id===t);e&&(N(e),clearInterval(a))},200);setTimeout(async()=>{if(!n.find(e=>e._id===t))try{const e=await A.contactAPI.getInquiryById(t);e&&N(e)}catch(e){}},3e3)}},[]);const E=async()=>{t(!0);try{const e=await A.contactAPI.getAllInquiries();f(e||[])}catch(e){console.error("Failed to load inquiries",e)}finally{t(!1)}};(0,s.useEffect)(()=>{F.current&&F.current.scrollIntoView({behavior:"smooth"})},[k,k&&k.responses&&k.responses.length]);const M=e=>{if(!e)return"";const t=Date.now()-new Date(e).getTime(),n=Math.floor(t/6e4);if(n<1)return"just now";if(n<60)return"".concat(n,"m");const a=Math.floor(n/60);if(a<24)return"".concat(a,"h");const s=Math.floor(a/24);return"".concat(s,"d")},W=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?";if(!e)return t;try{const n=String(e).trim();return n.length?n.charAt(0).toUpperCase():t}catch(n){return t}},Y=e=>{let{author:t,avatar:n,content:a,datetime:s,align:i="left"}=e;return(0,j.jsx)("div",{style:{display:"flex",justifyContent:"left"===i?"flex-start":"flex-end"},children:(0,j.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"flex-start",maxWidth:"80%"},children:["left"===i&&n,(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{style:{fontSize:13,fontWeight:600},children:t}),(0,j.jsx)("div",{style:{marginTop:6},children:a}),s&&(0,j.jsx)("div",{style:{marginTop:6,fontSize:12,color:"#888"},children:s})]}),"right"===i&&n]})})},H=async()=>{if(!T||!k||!k._id)return;const e=k._id;D(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!0}));try{if(k.isNewThread){let e=k.residentUsername||k.username||k.userName||k.author||k.createdBy&&(k.createdBy.username||k.createdBy.userName),t=k.residentBarangayID||k.barangayID||k.createdBy&&k.createdBy.barangayID;if(e&&""!==e||!k.createdBy||("string"===typeof k.createdBy?e=k.createdBy:(k.createdBy.username||k.createdBy.userName)&&(e=k.createdBy.username||k.createdBy.userName),!t&&k.createdBy&&k.createdBy.barangayID&&(t=k.createdBy.barangayID)),(!e||""===e)&&Array.isArray(U)&&k.residentName){const n=U.find(e=>e.label&&e.label.toString().toLowerCase()===(k.residentName||"").toString().toLowerCase());n&&(e=n.username||e,t=n.barangayID||t)}const n=(0,a.A)((0,a.A)({type:"staff_message",subject:"Message to ".concat(k.residentName),message:T.trim()},e?{username:e}:{}),t?{barangayID:t}:{});if(!n.username)return i.Ay.error("Please select a resident to send this message to."),void console.warn("Blocked staff-created inquiry without recipient",{selectedInquiry:k,residents:U});console.debug("Submitting staff-created inquiry payload",n,{selectedInquirySummary:{residentName:k.residentName,residentUsername:k.residentUsername,residentBarangayID:k.residentBarangayID}});const s=await A.contactAPI.submitInquiry(n);i.Ay.success("Message sent to ".concat(k.residentName||n.username)),f(e=>[s].concat(e)),N(s),_("")}else{const t=await A.contactAPI.respondToInquiry(e,{response:T.trim()});f(e=>e.map(e=>e._id===t._id?t:e)),N(t),_("")}}catch(t){console.error("reply failed",t)}finally{D(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!1}))}},V=n.filter(e=>{let t=!0;"pending"===y.status&&(t=!e.responses||0===e.responses.length),"responded"===y.status&&(t="resolved"===e.status||e.responses&&e.responses.length>0),"closed"===y.status&&(t="closed"===e.status);let n=!0;w&&"All"!==w&&(n=e.category===w);const a=(y.search||"").toLowerCase(),s=!a||e.residentName&&e.residentName.toLowerCase().includes(a)||e.subject&&e.subject.toLowerCase().includes(a);return t&&n&&s});return(0,j.jsx)("div",{style:{minHeight:"100vh",background:"#f7f9fb",padding:24},children:(0,j.jsxs)(r.A,{style:{maxWidth:1200,margin:"0 auto",borderRadius:12},bodyStyle:{padding:0},children:[(0,j.jsx)("div",{style:{padding:20},children:(0,j.jsxs)(l.A,{gutter:[12,12],align:"middle",children:[(0,j.jsx)(o.A,{xs:24,sm:6,children:(0,j.jsxs)(d.A,{value:w,onChange:e=>I(e),style:{width:"100%"},children:[(0,j.jsx)(d.A.Option,{value:"All",children:"All"}),(0,j.jsx)(d.A.Option,{value:"Complaints",children:"Complaints"}),(0,j.jsx)(d.A.Option,{value:"Requests",children:"Requests"}),(0,j.jsx)(d.A.Option,{value:"Announcements",children:"Announcements"})]})}),(0,j.jsx)(o.A,{xs:24,sm:12,children:(0,j.jsx)(c.A.Search,{placeholder:"Search by name or subject",allowClear:!0,value:y.search,onChange:e=>v(t=>(0,a.A)((0,a.A)({},t),{},{search:e.target.value})),onSearch:e=>v(t=>(0,a.A)((0,a.A)({},t),{},{search:e}))})}),(0,j.jsx)(o.A,{xs:24,sm:6,children:(0,j.jsxs)(ge.A,{activeKey:y.status||"all",onChange:e=>v(t=>(0,a.A)((0,a.A)({},t),{},{status:e})),children:[(0,j.jsx)(ge.A.TabPane,{tab:"All"},"all"),(0,j.jsx)(ge.A.TabPane,{tab:"Pending"},"pending"),(0,j.jsx)(ge.A.TabPane,{tab:(0,j.jsxs)("span",{children:["Responded"," ",(0,j.jsx)(u.Ay,{type:"link",size:"small",style:{marginLeft:20},icon:(0,j.jsx)(we.A,{}),onClick:e=>{e.stopPropagation(),(async()=>{q(!0),L(!0);try{const e=(await A.adminAPI.getUsers()||[]).filter(e=>{const t=(e.role||e.type||"").toString().toLowerCase();return t.includes("resident")||!t.includes("admin")&&!t.includes("staff")}).map(e=>({label:e.fullName||(e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):e.username||e.email||e.name),username:e.username||e.userName||e.email||e._id,barangayID:e.barangayID||e.brgy||e.barangay&&(e.barangay.id||e.barangayID)}));O(e.filter(e=>e&&e.label))}catch(e){O([])}finally{L(!1)}})()}})]})},"responded")]})})]})}),(0,j.jsx)(m.A,{style:{margin:0}}),(0,j.jsx)(fe.A,{title:"Residents",visible:R,onCancel:()=>q(!1),footer:null,children:B?(0,j.jsx)("div",{style:{textAlign:"center"},children:(0,j.jsx)(p.A,{})}):0===U.length?(0,j.jsx)(h.A.Text,{type:"secondary",children:"No residents found."}):(0,j.jsx)(g.A,{dataSource:U,renderItem:e=>(0,j.jsx)(g.A.Item,{style:{cursor:"pointer"},onClick:()=>{const t=e.label,a=e.username,s=e.barangayID,i=n.find(e=>{const n=(e.username||e.residentName||e.createdBy&&(e.createdBy.username||"")||"").toString().toLowerCase();return n&&(a?n===(a||"").toString().toLowerCase():n===(t||"").toString().toLowerCase())});if(i)N(i),q(!1);else{const e={_id:"new-".concat(Date.now()),residentName:t,residentUsername:a,residentBarangayID:s,message:"",responses:[],isNewThread:!0};N(e),console.debug("Resident selected for new thread",e),q(!1)}},children:(0,j.jsx)(g.A.Item.Meta,{avatar:(0,j.jsx)(b,{style:{background:"#1890ff"},children:W(e.label)}),title:e.label})})})}),(0,j.jsx)("div",{style:{padding:16},children:e?(0,j.jsx)(p.A,{}):0===V.length?(0,j.jsx)(x.Ay,{icon:(0,j.jsx)(S.A,{}),title:"No inquiries",subTitle:"There are no inquiries to show."}):(0,j.jsxs)("div",{className:ye,children:[(0,j.jsx)("div",{className:Ae,children:(0,j.jsx)(g.A,{dataSource:V,renderItem:e=>(0,j.jsx)(g.A.Item,{onClick:()=>(e=>{N(e)})(e),style:{cursor:"pointer",marginBottom:8,borderRadius:8,padding:8,border:k&&k._id===e._id?"1px solid #1890ff":"1px solid #eee"},children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,j.jsx)(b,{style:{background:"#1890ff"},children:W(e.residentName||e.username||e.subject,"?")}),(0,j.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,j.jsx)(h.A.Text,{strong:!0,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.residentName||e.username||"Unknown"}),(0,j.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:12},children:["\u2014 ",e.subject||"No subject"]}),(0,j.jsx)("span",{style:{marginLeft:"auto",fontSize:11},children:e.createdAt?M(e.createdAt):""})]}),(0,j.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:13,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.message})]})]})})})}),(0,j.jsx)("div",{className:je,children:(0,j.jsx)(r.A,{style:{borderRadius:8},bodyStyle:{display:"flex",flexDirection:"column",gap:12,padding:12},children:k?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,j.jsxs)("div",{style:{flex:1},children:[(0,j.jsx)(h.A.Text,{strong:!0,style:{display:"block"},children:k.residentName||k.username||"Unknown"}),(0,j.jsx)(h.A.Text,{type:"secondary",children:k.createdAt?new Date(k.createdAt).toLocaleString():""})]}),(0,j.jsx)(b,{size:48,style:{background:"#1890ff"},children:W(k.residentName||k.username)})]}),(0,j.jsx)(m.A,{}),(0,j.jsxs)("div",{style:{overflowY:"auto",maxHeight:340},children:[(0,j.jsxs)("div",{style:{marginBottom:8},children:[(0,j.jsx)(h.A.Paragraph,{style:{margin:0},children:k.message}),k.attachments&&k.attachments.length>0&&(0,j.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:k.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,j.jsx)("div",{children:s?(0,j.jsx)("a",{href:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),target:"_blank",rel:"noreferrer",children:(0,j.jsx)("img",{src:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),alt:a,style:{maxWidth:220,maxHeight:140,borderRadius:8,objectFit:"cover",border:"1px solid #f0f0f0"}})}):(0,j.jsxs)("div",{children:[(0,j.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,j.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),Array.isArray(k.responses)&&k.responses.map((e,t)=>{let n=(e.role||e.authorRole||e.author_role||""||"").toString().toLowerCase();const a=e.author||e.authorName||e.author_name||e.createdByName||e.createdByFullName||e.userName||e.user||"",s=e.createdBy?String(e.createdBy):void 0;if(!n)try{let t;k&&(k.createdBy&&"string"===typeof k.createdBy?t=String(k.createdBy):k.createdBy&&"object"===typeof k.createdBy&&(k.createdBy._id||k.createdBy.id)?t=String(k.createdBy._id||k.createdBy.id):k.residentId&&(t=String(k.residentId)));const i=k&&(k.residentName||k.username)?String(k.residentName||k.username).toLowerCase():"",r=(a||e.authorName||"").toString().toLowerCase();(t&&s&&t===s||i&&r&&i===r)&&(n="resident")}catch(d){}let i;i=a&&""!==a.trim()?a:e.authorName&&""!==e.authorName.trim()?e.authorName:e.createdBy&&"object"===typeof e.createdBy&&(e.createdBy.fullName||e.createdBy.username)?e.createdBy.fullName||e.createdBy.username:"resident"===n?k&&(k.residentName||k.username)?k.residentName||k.username:"Resident":"Staff";const r="resident"===n||"user"===n,l=r?"right":"left",o=r?(0,j.jsx)(b,{style:{background:"#1890ff"},children:W(i,"U")}):(0,j.jsx)(b,{style:{background:"#666"},children:W(i,"B")});return(0,j.jsx)("div",{style:{alignSelf:r?"flex-end":"flex-start",maxWidth:"100%"},children:(0,j.jsx)(Y,{author:i,avatar:o,content:(0,j.jsxs)("div",{style:{background:r?"#e6f7ff":"#f6f6f6",padding:10,borderRadius:8},children:[(0,j.jsx)(h.A.Paragraph,{style:{margin:0},children:e.text}),e.attachments&&e.attachments.length>0&&(0,j.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:e.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,j.jsx)("div",{children:s?(0,j.jsx)("a",{href:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),target:"_blank",rel:"noreferrer",children:(0,j.jsx)("img",{src:"string"!==typeof n||n.startsWith("http")?n:(0,A.getAbsoluteApiUrl)(n),alt:a,style:{maxWidth:220,maxHeight:140,borderRadius:8,objectFit:"cover",border:"1px solid #f0f0f0"}})}):(0,j.jsxs)("div",{children:[(0,j.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,j.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),datetime:(0,j.jsx)("span",{style:{fontSize:12},children:e.createdAt?new Date(e.createdAt).toLocaleString():""}),align:l})},t)}),(0,j.jsx)("div",{ref:F})]}),(0,j.jsxs)("div",{className:ve,children:[(0,j.jsx)("textarea",{value:T,onChange:e=>{_(e.target.value);const t=e.target;t.style.height="auto",t.style.height=Math.min(200,t.scrollHeight)+"px"},onKeyDown:async e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),await H())},placeholder:"Type your reply...",className:be}),(0,j.jsx)(u.Ay,{type:"primary",icon:(0,j.jsx)(C.A,{}),loading:!(!k||!P[k._id]),onClick:H}),(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(Ie.A,{}),onClick:async()=>{if(!k||!k._id)return;const e=k._id;try{const t=await A.contactAPI.resolveInquiry(e);f(e=>e.map(e=>e._id===t._id?t:e)),N(t)}catch(t){console.error("resolve failed",t)}},children:"Resolve"})]})]}):(0,j.jsx)("div",{style:{textAlign:"center",padding:32},children:(0,j.jsx)(h.A.Text,{type:"secondary",children:"Select an inquiry to view details"})})})})]})})]})})};var Ce=n(98086),ke=n(34943),Ne=n(50839),Te=n(54420);const _e={isAuthenticated:!1,user:null,token:null},Pe=(0,s.createContext)((0,a.A)((0,a.A)({},_e),{},{login:()=>{},logout:()=>{},isStaff:()=>!1,isAdmin:()=>!1,isResident:()=>!1,mode:"resident",switchMode:()=>{}})),De=()=>(0,s.useContext)(Pe);function Re(e){if(!e||"string"!==typeof e)return null;if(3!==e.split(".").length)return console.warn("safeDecodeJwt: token does not have 3 parts, skipping decode"),null;try{return(0,Te.s)(e)}catch(t){return console.warn("safeDecodeJwt: failed to decode token",t),null}}const qe=(e,t)=>{switch(t.type){case"LOGIN":case"RESTORE_TOKEN":{let e=null;return e=Re(t.payload),{isAuthenticated:!!e,token:e?t.payload:null,user:e}}case"LOGOUT":return _e;default:return e}},Be=e=>{let{children:t}=e;const[i,r]=(0,s.useReducer)(qe,_e);(0,s.useEffect)(()=>{try{const e=localStorage.getItem("userProfile");if(e){const t=JSON.parse(e);if(t&&t.username){const e=localStorage.getItem("token")||null,t=Re(e);e&&t&&r({type:"LOGIN",payload:e})}}}catch(e){}},[]);const[l,o]=s.useState("resident"),d=(0,xe.Zp)();(0,s.useEffect)(()=>{const e=localStorage.getItem("token");e&&function(e){try{const t=Re(e);if(!t)return!1;if(!t.exp)return!1;const n=Date.now()/1e3;return t.exp>n}catch(t){return!1}}(e)?(r({type:"RESTORE_TOKEN",payload:e}),(async()=>{try{const{authService:t}=await Promise.resolve().then(n.bind(n,31694)),a=await t.getCurrentUser();a&&(r({type:"LOGIN",payload:e}),localStorage.setItem("userProfile",JSON.stringify(a)))}catch(t){}})()):(localStorage.removeItem("token"),r({type:"LOGOUT"}))},[]),(0,s.useEffect)(()=>{const e=e=>{try{let t=null===e||void 0===e?void 0:e.detail;if(!t)return;t.user&&(t=t.user),t.data&&t.data.user&&(t=t.data.user);const n=i.user;if(!n)return;if(t.deleted&&t._id&&n._id&&t._id===n._id)return void c(null);(t._id&&n._id&&t._id===n._id||t.username&&n.username&&t.username===n.username)&&c(t)}catch(t){}};return window.addEventListener("userProfileUpdated",e),()=>window.removeEventListener("userProfileUpdated",e)},[i.user]);const c=e=>{if(e){localStorage.setItem("userProfile",JSON.stringify(e));const t=localStorage.getItem("token");t&&r({type:"LOGIN",payload:t})}else localStorage.removeItem("userProfile"),r({type:"LOGOUT"})};return(0,j.jsx)(Pe.Provider,{value:(0,a.A)((0,a.A)({},i),{},{login:e=>{localStorage.setItem("token",e),document.cookie="token=".concat(e,"; path=/; max-age=86400; SameSite=Lax"),r({type:"LOGIN",payload:e}),(async()=>{try{const{authService:t}=await Promise.resolve().then(n.bind(n,31694)),a=await t.getCurrentUser();a&&(localStorage.setItem("userProfile",JSON.stringify(a)),r({type:"LOGIN",payload:e}))}catch(t){}})()},logout:()=>{A.authService.logout().catch(()=>{}),localStorage.removeItem("token"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT;",r({type:"LOGOUT"}),d("/login",{replace:!0})},isStaff:()=>{var e;return"staff"===(null===(e=i.user)||void 0===e?void 0:e.role)},isAdmin:()=>{var e;return"admin"===(null===(e=i.user)||void 0===e?void 0:e.role)},isResident:()=>{var e;return"resident"===(null===(e=i.user)||void 0===e?void 0:e.role)},mode:l,switchMode:e=>{o(e)},setUser:c}),children:t})};var Le=n(98964),Ue=n(79126),Oe=n(6051),ze=n(30326),Fe=n(45229),Ee=n(56580),Me=n(13486),We=n(8272),Ye=n(99214),He=n(94532),Ve=n(30703),Ge=n(58518),Ke=n(85825),Je=n(71923),Ze=n(45608),$e=n(38700),Qe=n(40905);const Xe=()=>{const[e,t]=(0,s.useState)(new Date);(0,s.useEffect)(()=>{const e=setInterval(()=>t(new Date),1e3);return()=>clearInterval(e)},[]);const n=e=>e.toString().padStart(2,"0"),a="".concat(n(e.getMonth()+1),"/").concat(n(e.getDate()),"/").concat(e.getFullYear()),i="".concat(n(e.getHours()),":").concat(n(e.getMinutes()),":").concat(n(e.getSeconds()));return(0,j.jsxs)("span",{style:{fontSize:13,color:"#888",fontWeight:500,letterSpacing:.5,marginRight:8},children:[(0,j.jsx)(Fe.A,{style:{marginRight:4}}),a," ",i]})},{Header:et,Content:tt,Sider:nt}=Le.A,at={resident:[{key:"/home",icon:(0,j.jsx)(Ee.A,{}),label:"Home"},{key:"/request",icon:(0,j.jsx)(Me.A,{}),label:"Request"},{key:"/inquiries",icon:(0,j.jsx)(We.A,{}),label:"Inquiries"},{key:"/inbox",icon:(0,j.jsx)(S.A,{}),label:"Inbox"}],admin:[{key:"/admin/dashboard",icon:(0,j.jsx)(Ee.A,{}),label:"Admin Dashboard"},{key:"/admin/users",icon:(0,j.jsx)(Ye.A,{}),label:"User Management"},{key:"/admin/statistics",icon:(0,j.jsx)(He.A,{}),label:"Statistics"},{key:"/admin/settings",icon:(0,j.jsx)(Ve.A,{}),label:"System Settings"},{key:"/admin/verification-requests",icon:(0,j.jsx)(Ge.A,{}),label:"Verification Requests"}],staff:[{key:"/staff-dashboard",icon:(0,j.jsx)(Ee.A,{}),label:"Staff Dashboard"},{key:"/staff/inbox",icon:(0,j.jsx)(S.A,{}),label:"Staff Inbox"},{key:"/templates-manager",icon:(0,j.jsx)(Ge.A,{}),label:"Templates Manager"},{key:"/document-processing",icon:(0,j.jsx)(Ke.A,{}),label:"Document Processing"},{key:"/document-history",icon:(0,j.jsx)(Je.A,{}),label:"Document History"}]},st=e=>{var t,i;let{children:r}=e;const l=(0,xe.zy)(),o=(0,xe.Zp)(),{user:d,setUser:c}=De();let h=d;if(!h)try{const e=localStorage.getItem("userProfile");e&&(h=JSON.parse(e))}catch(y){}const[m,p]=(0,s.useState)(null),[x,g]=(0,s.useState)(!0);(0,s.useEffect)(()=>{(async()=>{try{const e=await Promise.resolve().then(n.bind(n,31694));try{const t=await e.residentPersonalInfoAPI.getPersonalInfo();if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:"".concat(window.location.origin).concat(t.profileImage);return void p(e)}if(null!==t&&void 0!==t&&t.profileImageId)return void p((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(t.profileImageId)))}catch(y){}try{const t=(await e.default.get("/resident/profile")).data;if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:"".concat(window.location.origin).concat(t.profileImage);p(e)}else null!==t&&void 0!==t&&t.profileImageId&&p((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(t.profileImageId)))}catch(y){}}catch(y){}})();const e=e=>{try{const t=null===e||void 0===e?void 0:e.detail;if(!t)return;if(t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:"".concat(window.location.origin).concat(t.profileImage);p(e)}else t.profileImageId&&p((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(t.profileImageId)))}catch(y){}};return window.addEventListener("userProfileUpdated",e),()=>{window.removeEventListener("userProfileUpdated",e);try{clearInterval(window.__verifPollId)}catch(t){}}},[]);const f=(()=>{try{if(m)return m;const e=h;if(!e)return null;if(e.profileImage)return e.profileImage.startsWith("http")?e.profileImage:"".concat(window.location.origin).concat(e.profileImage);if(e.profilePicture)return e.profilePicture.startsWith("http")?e.profilePicture:"".concat(window.location.origin).concat(e.profilePicture);if(e.profileImageId)return(0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.profileImageId));if(e.avatar)return e.avatar.startsWith("http")?e.avatar:"".concat(window.location.origin).concat(e.avatar)}catch(y){}return null})();return(0,j.jsxs)(Le.A,{style:{minHeight:"100vh",background:"#000"},children:[d&&(0,j.jsx)(nt,{width:240,collapsed:x,collapsedWidth:64,style:{height:"100vh",position:"fixed",left:0,top:0,background:"linear-gradient(180deg, #40c9ff 0%, #e81cff 100%)",display:"flex",flexDirection:"column",padding:0,zIndex:100,boxShadow:"2px 0 16px 0 rgba(64,201,255,0.10)",borderRight:"none",overflowX:"hidden"},children:(0,j.jsx)("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"24px 0 0 0",display:"flex",flexDirection:"column"},children:(0,j.jsx)(Ue.A,{theme:"light",mode:"inline",selectedKeys:[l.pathname],style:{background:"transparent",fontWeight:600,fontSize:17,border:"none"},inlineCollapsed:x,items:at["admin"===(null===d||void 0===d?void 0:d.role)?"admin":"staff"===(null===d||void 0===d?void 0:d.role)?"staff":"resident"].map(e=>(0,a.A)((0,a.A)({},e),{},{className:l.pathname===e.key?"ant-menu-item-active-custom":void 0})),onClick:e=>{let{key:t}=e;l.pathname!==t&&o(t)}})})}),(0,j.jsxs)(Le.A,{style:{marginLeft:d?x?64:240:0},children:[(0,j.jsxs)(et,{className:"app-header",style:{height:64,background:"#fff",display:"flex",flexWrap:"nowrap",alignItems:"center",justifyContent:"space-between",padding:"0 32px",position:"fixed",left:d?x?64:240:0,right:0,top:0,zIndex:101,boxShadow:"0 2px 8px #e3e6f3"},children:[(0,j.jsxs)("div",{className:"responsive-system-title",style:{display:"flex",alignItems:"center",gap:12,maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[d&&(0,j.jsx)(u.Ay,{type:"text",onClick:()=>g(e=>!e),style:{marginRight:6},icon:x?(0,j.jsx)(w.A,{}):(0,j.jsx)(I.A,{})}),(0,j.jsx)("img",{src:"".concat("","/logo-parian2.png"),alt:"Logo",style:{width:36,height:36,marginRight:4}}),(0,j.jsxs)("span",{style:{fontSize:26,fontWeight:400,letterSpacing:1,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",display:"inline-block",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["Barangay Information ",(0,j.jsx)("span",{style:{fontWeight:800},children:"Management System"})]})]}),(0,j.jsxs)("div",{className:"header-controls",style:{display:"flex",alignItems:"center",gap:16,position:"relative",marginRight:8},children:[(0,j.jsx)("span",{style:{marginRight:8},children:(0,j.jsx)(Xe,{})}),(0,j.jsx)(Oe.A,{size:12,children:h&&(0,j.jsx)(u.Ay,{size:"small",onClick:()=>{var e;return o("admin"===(null===(e=h)||void 0===e?void 0:e.role)?"/admin/announcements":"/announcements")},icon:(0,j.jsx)(Ze.A,{})})}),(0,j.jsx)(ze.A,{popupRender:()=>(0,j.jsxs)(Ue.A,{children:[(0,j.jsx)(Ue.A.Item,{icon:(0,j.jsx)($e.A,{}),onClick:()=>o("/profile"),children:"Profile"},"profile"),(0,j.jsx)(Ue.A.Item,{icon:(0,j.jsx)(Ve.A,{}),onClick:()=>o("/admin/settings"),children:"Settings"},"settings"),(0,j.jsx)(Ue.A.Divider,{}),(0,j.jsx)(Ue.A.Item,{icon:(0,j.jsx)(Qe.A,{}),onClick:()=>o("/logout"),children:"Logout"},"logout")]}),placement:"bottomRight",trigger:["click"],children:(0,j.jsx)("div",{style:{cursor:"pointer",display:"inline-flex",alignItems:"center"},children:(0,j.jsx)(v,{size:36,src:null!==f&&void 0!==f?f:void 0,alt:(null===(t=h)||void 0===t?void 0:t.fullName)||(null===(i=h)||void 0===i?void 0:i.username)||"User"})})})]})]}),(0,j.jsx)("div",{style:{height:1,background:"#f0f0f0",width:"100%",margin:0,boxShadow:"none"}}),(0,j.jsx)(tt,{style:{marginTop:64,padding:32,background:"linear-gradient(135deg, #e3f6fd 0%, #b3e0ff 60%,  #b3e0ff 100%)",minHeight:"calc(100vh - ".concat(64,"px)")},children:r})]})]})},it=e=>{let{children:t}=e;return(0,j.jsx)(st,{children:t||(0,j.jsx)(xe.sv,{})})},rt=e=>{let{children:t}=e;const{isAuthenticated:n,user:a}=De();return n||a&&"guest"===a.role?(0,j.jsx)(j.Fragment,{children:t}):(0,j.jsx)(xe.C5,{to:"/login",replace:!0})},lt=e=>{let{children:t}=e;const{isAuthenticated:n,user:a}=De();return n?"staff"!==(null===a||void 0===a?void 0:a.role)&&"admin"!==(null===a||void 0===a?void 0:a.role)?(0,j.jsx)(xe.C5,{to:"/dashboard",replace:!0}):(0,j.jsx)(j.Fragment,{children:t}):(0,j.jsx)(xe.C5,{to:"/login",replace:!0})},ot=e=>{let{children:t}=e;const n=De(),a=(0,xe.Zp)(),s=null===n||void 0===n?void 0:n.user,i="function"===typeof(null===n||void 0===n?void 0:n.isAdmin)?n.isAdmin():"admin"===(null===s||void 0===s?void 0:s.role)||!0===(null===s||void 0===s?void 0:s.isAdmin),r="undefined"!==typeof window?localStorage.getItem("token"):null;return!s&&r?(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:(0,j.jsx)(p.A,{size:"large"})}):s?i?t:(0,j.jsx)(x.Ay,{status:"403",title:"403",subTitle:"Sorry, you are not authorized to access this page.",extra:(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>a("/dashboard"),children:"Go to Dashboard"})}):(0,j.jsx)(xe.C5,{to:"/login",replace:!0})};var dt=n(95645),ct=n(88820);const ut=function(e){const t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=";return e?e.previewUrl?e.previewUrl:e.photo&&e._id?(0,A.getAbsoluteApiUrl)("/admin/officials/".concat(e._id,"/photo")):e.hasPhoto&&e._id?(0,A.getAbsoluteApiUrl)("/officials/".concat(e._id,"/photo")):e.photoUrl?e.photoUrl:e.photoPath?(0,A.getAbsoluteApiUrl)("/".concat(e.photoPath.replace(/^\//,""))):t:t};var ht=n(26612),mt=n(74044);const pt=()=>{var e,t,n,i,d,c,u,m,x;const[g,f]=(0,s.useState)(null),[y,v]=(0,s.useState)(!0);if((0,s.useEffect)(()=>{let e=!0;return(async()=>{try{const[n,s,i]=await Promise.all([A.documentsAPI.listFiles().catch(()=>[]),A.documentsAPI.getAllDocuments().catch(()=>[]),A.contactAPI.getAnnouncements().catch(()=>[])]);let r=null;try{r=await A.adminAPI.getSystemStatistics()}catch(t){console.warn("Could not fetch admin statistics (likely unauthenticated):",String(t)),r=null}if(e){const e=Array.isArray(n)?n.length:n&&n.length||0,t=Array.isArray(s)?s.length:s&&s.length||0,l=Array.isArray(i)?i.length:i&&i.length||0;f((0,a.A)((0,a.A)({},r||{}),{},{filesCount:e,docRequestsCount:t,announcementsCount:l}))}}catch(n){console.error("Failed to load system statistics",n)}finally{e&&v(!1)}})(),()=>{e=!1}},[]),y)return(0,j.jsx)("div",{style:{width:"100%",textAlign:"center"},children:(0,j.jsx)(p.A,{})});if(!g)return(0,j.jsx)("div",{style:{textAlign:"center"},children:(0,j.jsx)(h.A.Text,{type:"secondary",children:"No statistics available"})});const b=g.users||{},w=(g.documents,null!==(e=g.filesCount)&&void 0!==e?e:0),I=[{key:"users",title:"Total Users",value:null!==(t=b.total)&&void 0!==t?t:0,icon:(0,j.jsx)($e.A,{style:{color:"#9254de",fontSize:20}})},{key:"admins",title:"Admins",value:null!==(n=null===(i=b.byRole)||void 0===i?void 0:i.admin)&&void 0!==n?n:0,icon:(0,j.jsx)(mt.A,{style:{color:"#f5a623",fontSize:20}})},{key:"staff",title:"Staff",value:null!==(d=null===(c=b.byRole)||void 0===c?void 0:c.staff)&&void 0!==d?d:0,icon:(0,j.jsx)(Ye.A,{style:{color:"#1677ff",fontSize:20}})},{key:"residents",title:"Residents",value:null!==(u=null===(m=b.byRole)||void 0===m?void 0:m.resident)&&void 0!==u?u:0,icon:(0,j.jsx)(Ee.A,{style:{color:"#22c55e",fontSize:20}})},{key:"announcements",title:"Announcements",value:null!==(x=g.announcementsCount)&&void 0!==x?x:0,icon:(0,j.jsx)(Ze.A,{style:{color:"#faad14",fontSize:20}})},{key:"docFiles",title:"Documents Available",value:w,icon:(0,j.jsx)(Me.A,{style:{color:"#0ea5e9",fontSize:20}})}];return(0,j.jsxs)(r.A,{className:"glass-card stats-card",bordered:!1,style:{width:"100%"},children:[(0,j.jsx)(h.A.Title,{level:4,children:"Quick Stats"}),(0,j.jsx)("div",{style:{height:6,background:"linear-gradient(90deg, rgba(22,119,255,0.08), rgba(146,84,222,0.08))",borderRadius:4,marginBottom:12}}),(0,j.jsx)(l.A,{gutter:[12,12],style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:I.map(e=>(0,j.jsx)(o.A,{xs:12,sm:8,md:8,lg:8,style:{display:"flex"},children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,width:"100%"},children:[(0,j.jsx)("div",{style:{width:44,height:44,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.9)",borderRadius:8,boxShadow:"0 6px 14px rgba(2,6,23,0.06)"},children:e.icon}),(0,j.jsx)("div",{style:{flex:1},children:(0,j.jsx)(ht.A,{title:e.title,value:e.value})})]})},e.key))})]})};var xt=n(98058),gt=n(77725);const ft=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)("loading");(0,s.useEffect)(()=>{let e=!0;return(async()=>{a("loading");try{let n=(await A.axiosPublic.get("/residents/with-avatars?limit=5")).data;n&&Array.isArray(n.data)&&(n=n.data),Array.isArray(n)||(n=[]);const s=n.filter(e=>e.profileImageId);e&&(t(s),a(s.length>0?"ok":"empty"))}catch(n){a("error")}})(),()=>{e=!1}},[]);const{login:d,isAuthenticated:m,user:p,setUser:x}=De(),[g,f]=(0,s.useState)(!1),[y,b]=(0,s.useState)(!1),[w]=dt.A.useForm(),I=(0,xe.Zp)(),[S,C]=(0,s.useState)(!1),[k,N]=(0,s.useState)([]),[T,_]=(0,s.useState)("loading"),P=(0,s.useRef)(null);(0,s.useEffect)(()=>{m&&p&&("admin"===p.role?I("/admin/dashboard"):"staff"===p.role?I("/staff-dashboard"):"guest"===p.role?I("/guest/dashboard"):I("/dashboard"))},[m,p,I]),(0,s.useEffect)(()=>{let e=!0;return(async()=>{try{_("fetching public");const n=await async function(){try{let e=(await A.axiosPublic.get("/officials")).data;return e&&Array.isArray(e.data)&&(e=e.data),e&&Array.isArray(e.officials)&&(e=e.officials),Array.isArray(e)?(0===e.length&&console.info("fetchPublicOfficials: server returned empty list"),e):(console.warn("fetchPublicOfficials: unexpected payload shape",e),[])}catch(e){return console.error("fetchPublicOfficials error",e),[]}}();if(e&&Array.isArray(n)&&n.length>0)N(n),_("public:".concat(n.length));else if(m){_("trying-admin-fallback");try{const t=await A.adminAPI.getOfficials();if(e&&Array.isArray(t)&&t.length>0){const e=t.map(e=>({_id:e._id,name:e.name,title:e.title,term:e.term,hasPhoto:!!e.photo||!!e.photoPath}));N(e),_("admin:".concat(e.length))}else _("no-officials")}catch(t){console.warn("Admin fallback failed",t),_("error")}}else _("no-officials")}catch(t){console.warn("Failed to fetch public officials for login preview",t),_("error")}})(),()=>{e=!1}},[]);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)("div",{className:"login-page",children:(0,j.jsx)("div",{className:"login-container two-pane",children:(0,j.jsxs)(l.A,{gutter:24,align:"stretch",justify:"center",className:"two-pane-row",children:[(0,j.jsx)(o.A,{xs:24,md:12,className:"pane left-pane combined-pane",children:(0,j.jsx)("div",{className:"pane-inner left-inner",children:(0,j.jsxs)("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:18},children:[(0,j.jsx)(pt,{}),(0,j.jsxs)(r.A,{className:"glass-card preview-card invisible",variant:"outlined",children:[(0,j.jsx)(h.A.Title,{level:4,style:{marginBottom:8},children:"Barangay Officials"}),(0,j.jsx)("div",{style:{height:6,background:"linear-gradient(90deg, rgba(22,119,255,0.12), rgba(146,84,222,0.12))",borderRadius:4,marginBottom:12}}),(0,j.jsxs)("div",{className:"carousel-wrap",children:[(0,j.jsx)(u.Ay,{className:"carousel-arrow left",icon:(0,j.jsx)(xt.A,{}),onClick:()=>{P.current&&P.current.scrollBy({left:-240,behavior:"smooth"})}}),(0,j.jsx)("div",{ref:P,className:"carousel-scroll",children:0===k.length?(0,j.jsx)(h.A.Text,{type:"secondary",children:"No officials to preview"}):k.map(e=>(0,j.jsxs)("div",{className:"official-card",children:[(0,j.jsx)("div",{className:"official-avatar",children:(0,j.jsx)("img",{alt:e.name,src:ut(e),style:{width:"100%",height:"100%",objectFit:"cover"},onError:e=>{try{const t=e.currentTarget;t.onerror=null,t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII="}catch(t){}}})}),(0,j.jsx)("div",{style:{fontWeight:700},children:e.name}),(0,j.jsx)("div",{style:{color:"#666",fontSize:13},children:e.title}),(0,j.jsx)("div",{style:{color:"#999",fontSize:12},children:e.term})]},e._id))}),(0,j.jsx)(u.Ay,{className:"carousel-arrow right",icon:(0,j.jsx)(gt.A,{}),onClick:()=>{P.current&&P.current.scrollBy({left:240,behavior:"smooth"})}})]}),(0,j.jsxs)("div",{style:{marginTop:32},children:[(0,j.jsx)(h.A.Title,{level:4,style:{marginBottom:8},children:"Resident Avatars"}),(0,j.jsx)("div",{style:{height:6,background:"linear-gradient(90deg, rgba(146,84,222,0.12), rgba(22,119,255,0.12))",borderRadius:4,marginBottom:12}}),(0,j.jsxs)("div",{style:{display:"flex",gap:18,flexWrap:"wrap",minHeight:60},children:["loading"===n&&(0,j.jsx)(h.A.Text,{type:"secondary",children:"Loading avatars..."}),"error"===n&&(0,j.jsx)(h.A.Text,{type:"danger",children:"Failed to load avatars"}),"empty"===n&&(0,j.jsx)(h.A.Text,{type:"secondary",children:"No resident avatars to preview"}),"ok"===n&&e.map(e=>(0,j.jsxs)("div",{style:{textAlign:"center"},children:[(0,j.jsx)(v,{user:e,size:56}),(0,j.jsx)("div",{style:{fontSize:13,color:"#666",marginTop:4},children:e.fullName||e.username||"Resident"})]},e._id))]})]})]})]})})}),(0,j.jsx)(o.A,{xs:24,md:12,className:"pane center-pane login-pane",children:(0,j.jsx)("div",{className:"pane-inner center-inner",children:(0,j.jsxs)(r.A,{className:"glass-card login-card",variant:"outlined",children:[(0,j.jsx)(h.A.Title,{level:2,className:"title-blue",style:{textAlign:"center",marginBottom:6},children:"Barangay Information System"}),(0,j.jsx)(h.A.Text,{style:{display:"block",textAlign:"center",color:"#9254de",fontWeight:500,marginBottom:18},children:"Sign In"}),(0,j.jsxs)(dt.A,{name:"login",layout:"vertical",onFinish:async e=>{C(!0);try{const t=(e.username||"").toString().trim(),n=t.includes("@")?{email:t,password:e.password}:{identifier:t,password:e.password},a=await A.axiosInstance.post("/auth/login",n),s=a&&a.data?a.data:{};if(!a||a.status>=400)throw console.error("Login response not OK:",{status:null===a||void 0===a?void 0:a.status,data:s}),new Error(s.message||"Login failed");if(!s.token)throw console.error("No token in response:",s),new Error("Login failed - No token received");d(s.token),i.Ay.success(s.message||"Login successful!")}catch(t){i.Ay.error(t.message||"Error logging in"),console.error("Login error:",t)}finally{C(!1)}},autoComplete:"off",requiredMark:!1,children:[(0,j.jsx)(dt.A.Item,{label:"Email or Username",name:"username",rules:[{required:!0,message:"Please input your email or username!"}],children:(0,j.jsx)(c.A,{prefix:(0,j.jsx)($e.A,{style:{color:"#40a9ff"}}),placeholder:"Enter your email or username",size:"large"})}),(0,j.jsx)(dt.A.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"},{min:6,message:"Password must be at least 6 characters"}],children:(0,j.jsx)(c.A.Password,{autoComplete:"current-password",prefix:(0,j.jsx)(ct.A,{style:{color:"#40a9ff"}}),placeholder:"Enter your password",size:"large"})}),(0,j.jsx)(dt.A.Item,{children:(0,j.jsx)(u.Ay,{htmlType:"submit",size:"large",loading:S,className:"signin-btn",children:S?"Signing In...":"Sign In"})}),(0,j.jsx)(dt.A.Item,{children:(0,j.jsx)(u.Ay,{onClick:()=>f(!0),size:"large",className:"guest-warm-btn",block:!0,children:"Continue as Guest"})}),(0,j.jsxs)("div",{className:"links-row",children:[(0,j.jsx)(xe.N_,{to:"/forgot-password",children:(0,j.jsx)(h.A.Text,{type:"secondary",children:"Forgot Password?"})}),(0,j.jsx)(xe.N_,{to:"/register",children:(0,j.jsx)(h.A.Text,{type:"secondary",children:"Sign Up"})})]}),(0,j.jsx)("div",{style:{marginTop:8,textAlign:"center"},children:(0,j.jsx)(u.Ay,{type:"link",onClick:()=>b(!0),children:(0,j.jsx)(h.A.Text,{type:"danger",children:"Emergency Hotline"})})})]})]})})})]})})}),(0,j.jsx)(fe.A,{title:"Continue as Guest",open:g,onCancel:()=>{f(!1),w.resetFields()},onOk:async()=>{try{const n=await w.validateFields();try{const t=await A.axiosPublic.post("/auth/guest",{name:n.name,contactNumber:n.contactNumber,email:n.email,intent:n.intent}),a=t&&t.data?t.data:{};if(!t||t.status>=400)return void i.Ay.error(a.message||"Failed to create guest");const s={_id:a._id,username:(n.name||"guest").toString().toLowerCase().replace(/\s+/g,"_"),firstName:n.name||"Guest",contactNumber:n.contactNumber||"",email:n.email||"",intent:n.intent||"",sessionToken:a.sessionToken,expiresAt:a.expiresAt,role:"guest"};if("function"===typeof x&&x(s),localStorage.setItem("guestInfo",JSON.stringify(s)),localStorage.setItem("guestSessionToken",a.sessionToken),a.token&&"function"===typeof d)try{await d(a.token)}catch(e){console.warn("Guest token login failed",e)}f(!1),w.resetFields(),I("/guest/dashboard")}catch(t){console.error("Failed to persist guest",t),i.Ay.error("Failed to create guest account")}}catch(t){}},children:(0,j.jsxs)(dt.A,{layout:"vertical",form:w,children:[(0,j.jsx)(dt.A.Item,{name:"name",label:"Full name",rules:[{required:!0,message:"Please enter your name"}],children:(0,j.jsx)(c.A,{placeholder:"Your full name"})}),(0,j.jsx)(dt.A.Item,{name:"contactNumber",label:"Contact number",rules:[{required:!0,message:"Please enter a contact number"}],children:(0,j.jsx)(c.A,{placeholder:"0917..."})}),(0,j.jsx)(dt.A.Item,{name:"email",label:"Email (optional)",rules:[{type:"email",message:"Enter a valid email"}],children:(0,j.jsx)(c.A,{placeholder:"you@example.com"})}),(0,j.jsx)(dt.A.Item,{name:"intent",label:"Purpose / Intent",rules:[{required:!0,message:"Please tell us your intent"}],children:(0,j.jsx)(c.A.TextArea,{placeholder:"Why are you visiting (e.g., check documents, request info)",rows:3})})]})}),(0,j.jsx)(fe.A,{title:"Emergency Hotlines",open:y,onCancel:()=>b(!1),footer:null,children:(0,j.jsxs)("div",{style:{lineHeight:1.6},children:[(0,j.jsxs)(h.A.Paragraph,{children:["For general emergencies: ",(0,j.jsx)("strong",{children:"911"})]}),(0,j.jsxs)(h.A.Paragraph,{children:["National Center for Mental Health (Crisis): ",(0,j.jsx)("strong",{children:"0917-899-8727"})]}),(0,j.jsxs)(h.A.Paragraph,{children:["Philippine National Police (Emergency Hotline): ",(0,j.jsx)("strong",{children:"9-1-1"})," / ",(0,j.jsx)("strong",{children:"8723-0401"})," / ",(0,j.jsx)("strong",{children:"8537-4500"})]})]})})]})};var yt=n(63516),At=n(80899),jt=n(53969),vt=n(65535),bt=n(94799),wt=n(25438),It=n(33699),St=n(12097),Ct=n(58560),kt=n(59024),Nt=n(31202),Tt=n(90160),_t=n(4573),Pt=n(97250),Dt=n(22632),Rt=n(3665),qt=n(32306),Bt=n(23241);const Lt=At.Ik({username:At.Yj().matches(/^[a-zA-Z0-9]{4,20}$/,"Username must be 4-20 characters and contain only letters and numbers").required("Username is required"),email:At.Yj().email("Invalid email address").required("Email is required"),password:At.Yj().matches(/^(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{6,}$/,"Password must be at least 6 characters long and contain at least one number, one uppercase letter, and one special character").required("Password is required"),confirmPassword:At.Yj().oneOf([At.KR("password"),void 0],"Passwords must match").required("Confirm Password is required"),address:At.Yj().required("Address is required"),contactNumber:At.Yj().required("Contact Number is required"),barangayID:At.Yj().required("Barangay ID is required")}),Ut=()=>{const e=(0,xe.Zp)(),[t,n]=s.useState(""),[a,i]=s.useState(""),[r,l]=s.useState(""),[o,d]=s.useState(!1),[c,u]=s.useState(!1),[h,m]=s.useState(!1),[p,x]=s.useState({});const g=(0,yt.Wx)({initialValues:{firstName:"",middleName:"",lastName:"",username:"",email:"",password:"",confirmPassword:"",address:"",contactNumber:"",barangayID:function(){const e=(new Date).getFullYear(),t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let a=0;a<6;a++)n+=t.charAt(Math.floor(62*Math.random()));return"brgyparian-".concat(e,"-").concat(n)}(),role:"resident"},validationSchema:Lt.shape({firstName:At.Yj().required("First name is required"),lastName:At.Yj().required("Last name is required"),role:At.Yj().oneOf(["resident"]).required("Role is required")}),onSubmit:async(t,a)=>{let{setSubmitting:s,resetForm:r}=a;n(""),x({});const l=await g.validateForm();if(Object.keys(l).length>0)return n("Please correct the highlighted errors before submitting."),void s(!1);try{const a=[t.firstName,t.middleName,t.lastName].filter(Boolean).join(" "),l=await A.axiosInstance.post("/auth/register",{fullName:a,firstName:t.firstName,middleName:t.middleName,lastName:t.lastName,username:t.username,email:t.email,password:t.password,address:t.address,contactNumber:t.contactNumber,barangayID:t.barangayID,role:t.role});let d={};try{d=l&&l.data?l.data:{}}catch(o){return void n("Server error: Could not parse response")}if(l&&l.status>=200&&l.status<300)i("Registration successful! You may now log in."),r(),setTimeout(()=>e("/login"),1500);else{if(d.errors&&"object"===typeof d.errors)return x(d.errors),n("Please correct the highlighted errors before submitting."),void s(!1);d.message?n(d.message):d.error?n(d.error):n("Registration failed")}}catch(d){n("Network or server error. Please try again later.")}finally{s(!1)}}});return(0,j.jsx)(jt.A,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #40c9ff 0%, #e81cff 100%)",display:"flex",alignItems:"center",justifyContent:"center",py:6},children:(0,j.jsx)(vt.A,{maxWidth:"sm",children:(0,j.jsxs)(bt.A,{elevation:6,sx:{borderRadius:5,p:4,background:"rgba(255,255,255,0.95)",boxShadow:"0 8px 32px 0 rgba(64,201,255,0.15)"},children:[(0,j.jsx)(jt.A,{sx:{textAlign:"center",mb:3},children:(0,j.jsx)(jt.A,{sx:{fontWeight:800,fontSize:32,letterSpacing:1,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",display:"inline-block"},children:"Create Account"})}),(0,j.jsxs)("form",{onSubmit:g.handleSubmit,children:[(0,j.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"First Name",name:"firstName",value:g.values.firstName,onChange:g.handleChange,error:g.touched.firstName&&Boolean(g.errors.firstName),helperText:g.touched.firstName&&g.errors.firstName,sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Middle Name (optional)",name:"middleName",value:g.values.middleName,onChange:g.handleChange,error:g.touched.middleName&&Boolean(g.errors.middleName),helperText:g.touched.middleName&&g.errors.middleName,sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Last Name",name:"lastName",value:g.values.lastName,onChange:g.handleChange,error:g.touched.lastName&&Boolean(g.errors.lastName),helperText:g.touched.lastName&&g.errors.lastName,sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Username",name:"username",value:g.values.username,onChange:g.handleChange,error:g.touched.username&&Boolean(g.errors.username)||Boolean(p.username),helperText:g.touched.username&&g.errors.username||p.username||"Username must be at least 4 characters long and contain only letters and numbers.",InputProps:{startAdornment:(0,j.jsx)(It.A,{position:"start",children:(0,j.jsx)(Tt.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Email",name:"email",value:g.values.email,onChange:g.handleChange,error:g.touched.email&&Boolean(g.errors.email)||Boolean(p.email),helperText:g.touched.email&&g.errors.email||p.email,InputProps:{startAdornment:(0,j.jsx)(It.A,{position:"start",children:(0,j.jsx)(_t.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Password",name:"password",type:c?"text":"password",value:g.values.password,onChange:g.handleChange,error:g.touched.password&&Boolean(g.errors.password),helperText:g.touched.password&&g.errors.password||p.password||"Password must be at least 6 characters long and contain at least one number, one uppercase letter, and one special character.",InputProps:{startAdornment:(0,j.jsx)(It.A,{position:"start",children:(0,j.jsx)(Pt.A,{color:"primary"})}),endAdornment:(0,j.jsx)(It.A,{position:"end",children:(0,j.jsx)(St.A,{onClick:()=>u(e=>!e),tabIndex:-1,sx:{minWidth:0,p:0,color:"inherit"},children:c?(0,j.jsx)(Dt.A,{}):(0,j.jsx)(Rt.A,{})})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Confirm Password",name:"confirmPassword",type:h?"text":"password",value:g.values.confirmPassword,onChange:g.handleChange,error:g.touched.confirmPassword&&Boolean(g.errors.confirmPassword),helperText:g.touched.confirmPassword&&g.errors.confirmPassword,InputProps:{startAdornment:(0,j.jsx)(It.A,{position:"start",children:(0,j.jsx)(Pt.A,{color:"primary"})}),endAdornment:(0,j.jsx)(It.A,{position:"end",children:(0,j.jsx)(St.A,{onClick:()=>m(e=>!e),tabIndex:-1,sx:{minWidth:0,p:0,color:"inherit"},children:h?(0,j.jsx)(Dt.A,{}):(0,j.jsx)(Rt.A,{})})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Address",name:"address",value:g.values.address,onChange:g.handleChange,error:g.touched.address&&Boolean(g.errors.address),helperText:g.touched.address&&g.errors.address,InputProps:{startAdornment:(0,j.jsx)(It.A,{position:"start",children:(0,j.jsx)(qt.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Contact Number",name:"contactNumber",value:g.values.contactNumber,onChange:g.handleChange,error:g.touched.contactNumber&&Boolean(g.errors.contactNumber),helperText:g.touched.contactNumber&&g.errors.contactNumber,InputProps:{startAdornment:(0,j.jsx)(It.A,{position:"start",children:(0,j.jsx)(Bt.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,j.jsx)("input",{type:"hidden",name:"barangayID",value:g.values.barangayID}),(0,j.jsx)(jt.A,{sx:{mb:2},children:(0,j.jsx)(wt.A,{select:!0,fullWidth:!0,label:"Role",name:"role",value:g.values.role,onChange:e=>{g.handleChange(e),"admin"!==e.target.value&&l("")},error:g.touched.role&&Boolean(g.errors.role),helperText:g.touched.role&&g.errors.role?g.errors.role:"",sx:{borderRadius:3,background:"#f4f6fa"},children:(0,j.jsx)(Ct.A,{value:"resident",children:"Resident"})})}),(0,j.jsx)(St.A,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,borderRadius:3,fontWeight:700,fontSize:"1.1rem",background:"linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",color:"#fff",boxShadow:"0 2px 8px #e81cff44",transition:"background 0.3s","&:hover":{background:"linear-gradient(90deg, #40c9ff 0%, #e81cff 100%)"}},disabled:g.isSubmitting,children:"Register"}),t&&(0,j.jsx)(kt.A,{severity:"error",sx:{mt:2},children:t}),Object.keys(p).length>0&&!t&&(0,j.jsx)(kt.A,{severity:"error",sx:{mt:2},children:Object.entries(p).map(e=>{let[t,n]=e;return(0,j.jsx)("div",{children:n},t)})}),o&&(0,j.jsx)(kt.A,{severity:"info",sx:{mt:2},children:"Admin access is now unlocked! Redirecting to admin dashboard..."}),(0,j.jsx)(jt.A,{sx:{textAlign:"center",mt:2},children:(0,j.jsxs)(Nt.A,{component:xe.N_,to:"/login",variant:"body2",sx:{color:"#e81cff",fontWeight:600},children:["Already have an account? ",(0,j.jsx)("span",{style:{textDecoration:"underline"},children:"Sign In"})]})})]})]})})})};var Ot=n(37490),zt=n(42524),Ft=n(32513),Et=n(80312),Mt=n(69123);const Wt="dashboard_residentCard__VNJkM",Yt="dashboard_heroRow__quuQi",Ht=()=>{var e,t,a,i;const{user:d,setUser:c}=De(),m=(null!==d&&void 0!==d||(()=>{try{const e=localStorage.getItem("userProfile");return e?JSON.parse(e):null}catch(e){return null}})(),(0,xe.Zp)()),[p,x]=(0,s.useState)(null),[g,f]=(0,s.useState)(()=>(new Date).toLocaleString()),[b,w]=(0,s.useState)([]),[I,S]=(0,s.useState)(!0),[C,k]=(0,s.useState)(0),[N,T]=(0,s.useState)(0),[_,P]=(0,s.useState)(!1),[D,R]=(0,s.useState)(0),[q,B]=(0,s.useState)(!1),[L,U]=(0,s.useState)([]),[O,z]=(0,s.useState)(!1),[F,E]=(0,s.useState)(!1),[M,W]=(0,s.useState)([]),[Y,H]=(0,s.useState)(!1),[V,G]=(0,s.useState)(!1),[K,J]=(0,s.useState)(()=>{try{return"true"===localStorage.getItem("residentTips.hide")}catch(e){return!1}}),[Z,$]=(0,s.useState)(!1),Q=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch(t){return String(e)}};(0,s.useEffect)(()=>{(async()=>{try{let e;e="admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?await A.documentsAPI.getAllDocuments():await A.documentsAPI.getMyDocuments(),w(e)}catch(e){console.error("Error fetching documents:",e)}finally{S(!1)}})(),(async()=>{try{try{const e=await(await Promise.resolve().then(n.bind(n,31694))).residentPersonalInfoAPI.getPersonalInfo();if(null!==e&&void 0!==e&&e.profileImage){const t=e.profileImage.startsWith("http")?e.profileImage:(0,A.getAbsoluteApiUrl)(e.profileImage);return void x(t)}if(null!==e&&void 0!==e&&e.profileImageId)return void x((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.profileImageId)))}catch(e){}try{const e=await Promise.resolve().then(n.bind(n,31694)),t=(await e.default.get("/resident/profile")).data;if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:(0,A.getAbsoluteApiUrl)(t.profileImage);x(e)}else null!==t&&void 0!==t&&t.profileImageId&&x((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(t.profileImageId)))}catch(e){}}catch(e){}})();const e=setInterval(()=>f((new Date).toLocaleString()),1e3);return()=>clearInterval(e)},[d]),(0,s.useEffect)(()=>{(async()=>{try{let e;e="admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?await A.contactAPI.getAllInquiries():await A.contactAPI.getMyInquiries(),Array.isArray(e)?R(e.length):e&&"number"===typeof e.count?R(e.count):R(e&&e.length||0)}catch(e){console.error("Failed to load inquiries:",e),R(0)}})();(async()=>{P(!0);try{const e=await A.contactAPI.getAnnouncements();Array.isArray(e)?T(e.length):e&&"number"===typeof e.count?T(e.count):T(e&&e.length||0)}catch(e){console.error("Failed to fetch announcements:",e),T(0)}finally{P(!1)}})()},[d]);const X=b.filter(e=>"pending"===(e.status||"").toString().toLowerCase()).length,ee=b.filter(e=>"approved"===(e.status||"").toString().toLowerCase()).length;return(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("div",{style:{maxWidth:1200,margin:"40px auto",padding:"0 16px",position:"relative"},children:[(0,j.jsx)("div",{style:{marginBottom:18},children:(0,j.jsx)(l.A,{align:"middle",children:(0,j.jsx)(o.A,{children:(0,j.jsx)(h.A.Text,{style:{fontSize:16,color:"#888"},children:(0,j.jsxs)("span",{style:{marginRight:8},children:[(0,j.jsx)("span",{style:{color:"#1890ff",fontWeight:600},children:"Dashboard"})," ",">"," Home"]})})})})}),"resident"===(null===d||void 0===d?void 0:d.role)&&(0,j.jsxs)(r.A,{className:Wt,style:{width:"100%",margin:"0 auto 32px",borderRadius:32,boxShadow:"0 8px 32px #bfc7d6cc",background:"linear-gradient(120deg, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",border:"none",padding:0,position:"relative",overflow:"hidden",minHeight:170},bodyStyle:{padding:0},children:[(0,j.jsx)("div",{style:{position:"absolute",top:0,left:0,height:"100%",background:"radial-gradient(circle at 80% 20%, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",opacity:.18,zIndex:0}}),(0,j.jsx)(l.A,{align:"middle",className:Yt,style:{minHeight:170,padding:"32px 32px",position:"relative",zIndex:1},justify:"space-between",children:(0,j.jsx)(o.A,{xs:24,md:14,style:{display:"flex",alignItems:"center",gap:24},children:(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",gap:18,width:"100%",justifyContent:"space-between"},children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:18},children:[(0,j.jsxs)("div",{className:"avatarContainer",children:[p?(0,j.jsx)("img",{src:p,alt:(null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||"avatar"}):(0,j.jsx)(v,{user:(()=>{let e=d;if(!e)try{const t=localStorage.getItem("userProfile");t&&(e=JSON.parse(t))}catch(t){}return e})(),size:96}),(0,j.jsx)("button",{onClick:()=>m("/profile"),title:"Edit profile",className:"editButton",children:(0,j.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,j.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z",fill:"#595959"}),(0,j.jsx)("path",{d:"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#595959"})]})})]}),(0,j.jsxs)("div",{className:"userInfo",children:[(0,j.jsx)(h.A.Title,{level:3,className:"userName",style:{marginBottom:0,fontWeight:800},children:null!==(e=null!==(t=null!==(a=null===d||void 0===d?void 0:d.fullName)&&void 0!==a?a:null===d||void 0===d?void 0:d.username)&&void 0!==t?t:null===d||void 0===d?void 0:d.email)&&void 0!==e?e:""}),(0,j.jsxs)(h.A.Text,{type:"secondary",className:"userMeta",children:["Barangay ID: ",null!==(i=null===d||void 0===d?void 0:d.barangayID)&&void 0!==i?i:(()=>{try{const e=localStorage.getItem("userProfile");if(e){const t=JSON.parse(e);return(null===t||void 0===t?void 0:t.barangayID)||"N/A"}}catch(e){}return"N/A"})()]}),(0,j.jsx)("div",{style:{marginTop:8},children:(0,j.jsx)(h.A.Text,{type:"secondary",className:"userMeta",children:(new Date).toLocaleString()})})]})]})})})})]}),(0,j.jsxs)(l.A,{gutter:[32,32],justify:"center",style:{marginBottom:40},children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(r.A,{hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #faad1444",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},onClick:async()=>{B(!0),z(!0);try{let e;"admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?(e=await A.documentsAPI.getAllDocuments(),e=(e||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase())):(e=await A.documentsAPI.getMyDocuments(),e=(e||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase())),U(e||[])}catch(e){U([])}finally{z(!1)}},bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,j.jsx)("div",{style:{background:"#faad14",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,j.jsx)(Et.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,j.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:X}),(0,j.jsx)(h.A.Text,{style:{fontSize:18,color:"#faad14",fontWeight:700},children:"Pending Requests"})]})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(r.A,{hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #52c41a44",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},bodyStyle:{padding:24},onClick:async()=>{E(!0),H(!0);try{let e;"admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?(e=await A.documentsAPI.getAllDocuments(),e=(e||[]).filter(e=>"approved"===(e.status||"").toString().toLowerCase())):(e=await A.documentsAPI.getMyDocuments(),e=(e||[]).filter(e=>"approved"===(e.status||"").toString().toLowerCase())),W(e||[])}catch(e){W([])}finally{H(!1)}},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,j.jsx)("div",{style:{background:"#52c41a",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,j.jsx)(Me.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,j.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:ee}),(0,j.jsx)(h.A.Text,{style:{fontSize:18,color:"#52c41a",fontWeight:700},children:"Approved Documents"})]})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(r.A,{hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #1890ff44",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},onClick:()=>m("/inbox"),bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,j.jsx)("div",{style:{background:"#1890ff",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,j.jsx)(Et.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,j.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:D}),(0,j.jsx)(h.A.Text,{style:{fontSize:18,color:"#1890ff",fontWeight:700},children:"Active Inquiries"})]})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(r.A,{onClick:()=>m("/announcements"),hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #eb2f9644",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,j.jsx)("div",{style:{background:"#eb2f96",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,j.jsx)(Ot.A,{count:N,offset:[8,0],children:(0,j.jsx)(Ze.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})})}),(0,j.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:N}),(0,j.jsx)(h.A.Text,{style:{fontSize:18,color:"#eb2f96",fontWeight:700},children:"Announcements"})]})})})]}),(0,j.jsx)(fe.A,{title:"Pending Requests",visible:q,onCancel:()=>B(!1),footer:null,width:800,children:(0,j.jsx)(zt.A,{dataSource:L,loading:O,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,j.jsx)(fe.A,{title:"Approved Documents",visible:F,onCancel:()=>E(!1),footer:null,width:1e3,children:(0,j.jsx)(zt.A,{dataSource:M,loading:Y,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Date Requested",dataIndex:"dateRequested",key:"dateRequested",render:(e,t)=>Q(t.dateRequested||t.requestedAt||t.createdAt)},{title:"Date Approved",dataIndex:"dateApproved",key:"dateApproved",render:(e,t)=>Q(t.dateApproved||t.approvedAt||t.approvedOn||t.updatedAt)},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,j.jsx)(fe.A,{title:"Resident Tool Tips",visible:V,onCancel:()=>G(!1),footer:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,j.jsx)(Ft.A,{checked:K,onChange:e=>{const t=e.target.checked;J(t);try{localStorage.setItem("residentTips.hide",t?"true":"false")}catch(n){}},children:"Don't show again"}),(0,j.jsxs)("div",{children:[(0,j.jsx)(u.Ay,{onClick:()=>G(!1),style:{marginRight:8},children:"Cancel"}),(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>{G(!1)},children:"Got it"})]})]}),width:720,children:(0,j.jsxs)("ul",{style:{paddingLeft:20},children:[(0,j.jsx)("li",{children:"Use the Request Document button to apply for barangay certificates and permits."}),(0,j.jsx)("li",{children:"Check your profile information regularly to ensure accuracy."}),(0,j.jsx)("li",{children:"Contact barangay staff for assistance with business registration or solo parent certification."}),(0,j.jsx)("li",{children:"For lost documents, use the Inquiry form to request help."}),(0,j.jsx)("li",{children:"All document requests are processed during office hours only."})]})}),(0,j.jsx)("div",{style:{position:"fixed",right:20,bottom:24,zIndex:1050},children:(0,j.jsx)(y.A,{title:K?"Tips hidden (will remain hidden if checked)":"Resident Tool Tips",children:(0,j.jsx)(u.Ay,{type:"primary",shape:"circle",size:"large",onClick:()=>G(!0),onMouseEnter:()=>$(!0),onMouseLeave:()=>$(!1),icon:(0,j.jsx)(Mt.A,{style:{color:"#fff",fontSize:20}}),style:{width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:Z?"0 10px 30px rgba(24,144,255,0.22)":"0 6px 18px rgba(0,0,0,0.12)",transform:Z?"translateY(-4px) scale(1.03)":"none",transition:"transform 160ms cubic-bezier(.2,.8,.2,1), box-shadow 160ms"}})})})]})})},Vt=()=>{var e,t,a,i;const{user:d,setUser:c}=De(),m=(null!==d&&void 0!==d||(()=>{try{const e=localStorage.getItem("userProfile");return e?JSON.parse(e):null}catch(e){return null}})(),(0,xe.Zp)()),[p,x]=(0,s.useState)(null),[g,f]=(0,s.useState)(()=>(new Date).toLocaleString()),[b,w]=(0,s.useState)([]),[I,S]=(0,s.useState)(!0),[C,k]=(0,s.useState)(0),[N,T]=(0,s.useState)(0),[_,P]=(0,s.useState)(!1),[D,R]=(0,s.useState)(!1),[q,B]=(0,s.useState)([]),[L,U]=(0,s.useState)(!1),[O,z]=(0,s.useState)(!1),[F,E]=(0,s.useState)([]),[M,W]=(0,s.useState)(!1),[Y,H]=(0,s.useState)(!1),[V,G]=(0,s.useState)(()=>{try{return"true"===localStorage.getItem("residentTips.hide")}catch(e){return!1}}),[K,J]=(0,s.useState)(!1),Z=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch(t){return String(e)}};(0,s.useEffect)(()=>{(async()=>{try{let e;e="admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?await A.documentsAPI.getAllDocuments():await A.documentsAPI.getMyDocuments(),w(e)}catch(e){console.error("Error fetching documents:",e)}finally{S(!1)}})(),(async()=>{try{try{const e=await(await Promise.resolve().then(n.bind(n,31694))).residentPersonalInfoAPI.getPersonalInfo();if(null!==e&&void 0!==e&&e.profileImage){const t=e.profileImage.startsWith("http")?e.profileImage:(0,A.getAbsoluteApiUrl)(e.profileImage);return void x(t)}if(null!==e&&void 0!==e&&e.profileImageId)return void x((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.profileImageId)))}catch(e){}try{const e=await Promise.resolve().then(n.bind(n,31694)),t=(await e.default.get("/resident/profile")).data;if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:(0,A.getAbsoluteApiUrl)(t.profileImage);x(e)}else null!==t&&void 0!==t&&t.profileImageId&&x((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(t.profileImageId)))}catch(e){}}catch(e){}})();const e=setInterval(()=>f((new Date).toLocaleString()),1e3);return()=>clearInterval(e)},[d]),(0,s.useEffect)(()=>{(async()=>{P(!0);try{const e=await A.contactAPI.getAnnouncements();Array.isArray(e)?T(e.length):e&&"number"===typeof e.count?T(e.count):T(e&&e.length||0)}catch(e){console.error("Failed to fetch announcements:",e),T(0)}finally{P(!1)}})()},[d]);b.filter(e=>"pending"===(e.status||"").toString().toLowerCase()).length,b.filter(e=>"approved"===(e.status||"").toString().toLowerCase()).length;return(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)("div",{style:{maxWidth:1200,margin:"40px auto",padding:"0 16px",position:"relative"},children:[(0,j.jsx)("div",{style:{marginBottom:18},children:(0,j.jsx)(l.A,{align:"middle",children:(0,j.jsx)(o.A,{children:(0,j.jsx)(h.A.Text,{style:{fontSize:16,color:"#888"},children:(0,j.jsxs)("span",{style:{marginRight:8},children:[(0,j.jsx)("span",{style:{color:"#1890ff",fontWeight:600},children:"Dashboard"})," ",">"," Home"]})})})})}),"resident"===(null===d||void 0===d?void 0:d.role)&&(0,j.jsxs)(r.A,{style:{width:"100%",margin:"0 auto 32px",borderRadius:32,boxShadow:"0 8px 32px #bfc7d6cc",background:"linear-gradient(120deg, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",border:"none",padding:0,position:"relative",overflow:"hidden",minHeight:170},bodyStyle:{padding:0},children:[(0,j.jsx)("div",{style:{position:"absolute",top:0,left:0,height:"100%",background:"radial-gradient(circle at 80% 20%, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",opacity:.18,zIndex:0}}),(0,j.jsx)(l.A,{align:"middle",style:{minHeight:170,padding:"32px 32px",position:"relative",zIndex:1},justify:"space-between",children:(0,j.jsx)(o.A,{xs:24,md:14,style:{display:"flex",alignItems:"center",gap:24},children:(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",gap:18,width:"100%",justifyContent:"space-between"},children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:18},children:[(0,j.jsxs)("div",{style:{width:96,height:96,borderRadius:12,overflow:"hidden",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[p?(0,j.jsx)("img",{src:p,alt:(null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||"avatar",style:{width:96,height:96,objectFit:"cover",borderRadius:12}}):(0,j.jsx)(v,{user:(()=>{let e=d;if(!e)try{const t=localStorage.getItem("userProfile");t&&(e=JSON.parse(t))}catch(t){}return e})(),size:96}),(0,j.jsx)("button",{onClick:()=>m("/profile"),title:"Edit profile",style:{position:"absolute",right:6,bottom:6,width:28,height:28,borderRadius:14,background:"#fff",border:"1px solid #e8e8e8",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 4px rgba(0,0,0,0.08)",cursor:"pointer"},children:(0,j.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,j.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z",fill:"#595959"}),(0,j.jsx)("path",{d:"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#595959"})]})})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Title,{level:3,style:{marginBottom:0,fontWeight:800},children:null!==(e=null!==(t=null!==(a=null===d||void 0===d?void 0:d.fullName)&&void 0!==a?a:null===d||void 0===d?void 0:d.username)&&void 0!==t?t:null===d||void 0===d?void 0:d.email)&&void 0!==e?e:""}),(0,j.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:18},children:["Barangay ID: ",null!==(i=null===d||void 0===d?void 0:d.barangayID)&&void 0!==i?i:(()=>{try{const e=localStorage.getItem("userProfile");if(e){const t=JSON.parse(e);return(null===t||void 0===t?void 0:t.barangayID)||"N/A"}}catch(e){}return"N/A"})()]}),(0,j.jsx)("div",{style:{marginTop:8},children:(0,j.jsx)(h.A.Text,{type:"secondary",children:(new Date).toLocaleString()})})]})]})})})})]}),(0,j.jsxs)(l.A,{gutter:[32,32],justify:"center",style:{marginBottom:40},children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(r.A,{onClick:()=>m("/request"),hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #1890ff44",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,j.jsx)("div",{style:{background:"#1890ff",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,j.jsx)(ee.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,j.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:"Request"}),(0,j.jsx)(h.A.Text,{style:{fontSize:18,color:"#1890ff",fontWeight:700},children:"Request Document"})]})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsx)(r.A,{onClick:()=>m("/announcements"),hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #eb2f9644",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,j.jsx)("div",{style:{background:"#eb2f96",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,j.jsx)(Ot.A,{count:N,offset:[8,0],children:(0,j.jsx)(Ze.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})})}),(0,j.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:N}),(0,j.jsx)(h.A.Text,{style:{fontSize:18,color:"#eb2f96",fontWeight:700},children:"Announcements"})]})})})]}),(0,j.jsx)(fe.A,{title:"Pending Requests",visible:D,onCancel:()=>R(!1),footer:null,width:800,children:(0,j.jsx)(zt.A,{dataSource:q,loading:L,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,j.jsx)(fe.A,{title:"Approved Documents",visible:O,onCancel:()=>z(!1),footer:null,width:1e3,children:(0,j.jsx)(zt.A,{dataSource:F,loading:M,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Date Requested",dataIndex:"dateRequested",key:"dateRequested",render:(e,t)=>Z(t.dateRequested||t.requestedAt||t.createdAt)},{title:"Date Approved",dataIndex:"dateApproved",key:"dateApproved",render:(e,t)=>Z(t.dateApproved||t.approvedAt||t.approvedOn||t.updatedAt)},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,j.jsx)(fe.A,{title:"Resident Tool Tips",visible:Y,onCancel:()=>H(!1),footer:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,j.jsx)(Ft.A,{checked:V,onChange:e=>{const t=e.target.checked;G(t);try{localStorage.setItem("residentTips.hide",t?"true":"false")}catch(n){}},children:"Don't show again"}),(0,j.jsxs)("div",{children:[(0,j.jsx)(u.Ay,{onClick:()=>H(!1),style:{marginRight:8},children:"Cancel"}),(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>{H(!1)},children:"Got it"})]})]}),width:720,children:(0,j.jsxs)("ul",{style:{paddingLeft:20},children:[(0,j.jsx)("li",{children:"Use the Request Document button to apply for barangay certificates and permits."}),(0,j.jsx)("li",{children:"Check your profile information regularly to ensure accuracy."}),(0,j.jsx)("li",{children:"Contact barangay staff for assistance with business registration or solo parent certification."}),(0,j.jsx)("li",{children:"For lost documents, contact barangay staff or visit the office for assistance."}),(0,j.jsx)("li",{children:"All document requests are processed during office hours only."})]})}),(0,j.jsx)("div",{style:{position:"fixed",right:20,bottom:24,zIndex:1050},children:(0,j.jsx)(y.A,{title:V?"Tips hidden (will remain hidden if checked)":"Resident Tool Tips",children:(0,j.jsx)(u.Ay,{type:"primary",shape:"circle",size:"large",onClick:()=>H(!0),onMouseEnter:()=>J(!0),onMouseLeave:()=>J(!1),icon:(0,j.jsx)(Mt.A,{style:{color:"#fff",fontSize:20}}),style:{width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:K?"0 10px 30px rgba(24,144,255,0.22)":"0 6px 18px rgba(0,0,0,0.12)",transform:K?"translateY(-4px) scale(1.03)":"none",transition:"transform 160ms cubic-bezier(.2,.8,.2,1), box-shadow 160ms"}})})})]})})};var Gt=n(80349),Kt=n(18205),Jt=n(97326),Zt=n(99472),$t=n(48677),Qt=n(99098),Xt=n(33498),en=(n(96292),n(57305)),tn=n(89157),nn=n(57179),an=n(82282),sn=n(41739),rn=n(81877),ln=n(25870);const on=()=>{const{user:e}=De(),t=(0,xe.Zp)(),[i,d]=(0,s.useState)(!1),[m,x]=(0,s.useState)([]),[y,v]=(0,s.useState)([]),[w,I]=(0,s.useState)([]),[C,k]=(0,s.useState)(()=>{try{const e=localStorage.getItem("viewedInquiries"),t=e?JSON.parse(e):[];return new Set(t||[])}catch(e){return new Set}}),N=e=>{e&&k(t=>{const n=new Set(Array.from(t));n.add(String(e));try{localStorage.setItem("viewedInquiries",JSON.stringify(Array.from(n)))}catch(a){}return n})},[T,_]=(0,s.useState)([]),[P,D]=(0,s.useState)([]),[R,q]=(0,s.useState)(!1),[B,L]=(0,s.useState)(null),[U,O]=(0,s.useState)(!1),[z,F]=(0,s.useState)(null),[E,M]=(0,s.useState)(null),[W,Y]=(0,s.useState)(!1),[H,V]=(0,s.useState)(null),[G,K]=(0,s.useState)(""),[J,Z]=(0,s.useState)(""),[$,Q]=(0,s.useState)(!1),[X,ee]=(0,s.useState)(!1),[te,ne]=(0,s.useState)(!1),[ae,se]=(0,s.useState)([]),[ie,re]=(0,s.useState)(!1),[le,oe]=(0,s.useState)(!1),[de,ce]=(0,s.useState)(null),[ue,he]=(0,s.useState)(""),me=Kt.Ay.useBreakpoint(),pe={};m.forEach(e=>{const t=e.type||"Unknown";pe[t]||(pe[t]=[]),pe[t].push(e)});const[ge,ye]=(0,s.useState)({pendingRequests:0,totalDocuments:0,completedRequests:0}),Ae=async e=>{try{const a=e=>{if(!e&&0!==e)return null;if("string"===typeof e)return e;if("object"===typeof e){if("string"===typeof e.$oid)return e.$oid;try{const t=e.toString();if(t&&"[object Object]"!==t)return t}catch(t){}return null}return String(e)},s=[],i=a(e&&e._id),r=a(e&&e.gridFsFileId);i&&s.push(i),r&&s.push(r);const l=Array.from(new Set(s));let o=null,d=null;console.debug("[handleDownloadProcessed] record:",e,"candidateIds:",l);let c=null,u=null;for(const e of l)try{console.debug("[handleDownloadProcessed] attempting id=",e);const t=await(await Promise.resolve().then(n.bind(n,31694))).axiosInstance.get("/processed-documents/".concat(e,"/raw"),{responseType:"blob"});if(t&&t.status>=200&&t.status<300){c=t.data,u=t.headers||{},o=e;break}}catch(t){const e=t&&t.response&&t.response.status?t.response.status:null;if(404===e){d={status:404,body:t.response&&t.response.data?t.response.data:null};continue}return void Gt.Ay.error({message:"Download failed",description:e?"Server returned ".concat(e):String(t)})}if(!c){const e=d&&d.body&&d.body.message?d.body.message:d&&d.message?d.message:"File not found";return void Gt.Ay.error({message:"Download failed",description:e})}const h=c;let m=null;const p=u&&(u["content-disposition"]||u["Content-Disposition"])||null;if(p){const e=p.match(/filename\*=UTF-8''([^;\n\r]+)/i);if(e&&e[1])m=decodeURIComponent(e[1]);else{const e=p.match(/filename="?([^";]+)"?/i);e&&e[1]&&(m=e[1])}}m||(m=u&&(u["x-processed-transactioncode"]||u["X-Processed-TransactionCode"])||e.filename||e.name||"document_".concat(o||e._id,".docx"));const x=window.URL.createObjectURL(h),g=document.createElement("a");g.href=x;const f=m||"document_".concat(o||e._id,".docx");g.download=f,document.body.appendChild(g),g.click(),g.remove(),window.URL.revokeObjectURL(x)}catch(t){console.error("Download error",t),Gt.Ay.error({message:"Download error",description:String(t)})}},je=e=>(0,j.jsx)(f.A,{color:{pending:"gold",approved:"success",rejected:"error",processing:"processing"}[(null===e||void 0===e?void 0:e.toLowerCase())||"default"],children:(null===e||void 0===e?void 0:e.toUpperCase())||"UNKNOWN"});(0,s.useEffect)(()=>{(async()=>{d(!0);try{const[n,a]=await Promise.all([A.documentsAPI.getDocumentRecords(),A.contactAPI.getAllInquiries()]);x(n),v(a);const s=a.filter(t=>t.assignedRole&&e&&t.assignedRole===e.role||t.assignedTo&&Array.isArray(t.assignedTo)&&e&&t.assignedTo.includes(e._id));I(s);let i=n.length;try{const e=await A.axiosInstance.get("/processed-documents",{params:{page:1,limit:1}}),t=e&&e.data?e.data:null;t&&"number"===typeof t.total&&(i=t.total)}catch(t){}ye({pendingRequests:n.filter(e=>"pending"===e.status).length,totalDocuments:i,completedRequests:n.filter(e=>"approved"===e.status).length})}catch(n){console.error("Error fetching data:",n)}finally{d(!1)}})(),ve()},[]);const ve=async()=>{q(!0);try{const e=await A.contactAPI.getAnnouncements();D(Array.isArray(e)?e.slice(0,6):[])}catch(e){console.error("Failed to load mini announcements",e),D([])}finally{q(!1)}};function be(e){if(!e)return"Unknown";let t=e;return t=t.replace(/^Other\s*/i,"").trim(),t.split("_").map(e=>{const t=e||"";return t.length>0?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():""}).filter(Boolean).join(" ")}function we(e){if(!e)return"";return new Date(e).toLocaleString()}const Se=function(){return((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])||[]).slice().sort((e,t)=>{const n=e&&e.createdAt?new Date(e.createdAt).getTime():0;return(t&&t.createdAt?new Date(t.createdAt).getTime():0)-n})},Ce=(e,n)=>{t(e,{state:n})},ke=e=>{try{t(e)}catch(n){window.location.href=e}};return(0,j.jsx)(p.A,{spinning:i,tip:"Loading...",children:(0,j.jsxs)("div",{children:[(0,j.jsxs)(l.A,{gutter:[16,16],style:{marginBottom:24},children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>{const e=m.find(e=>"pending"===e.status);e&&e._id?Ce("/document-processing",{openRequestId:e._id}):Ce("/document-processing")},style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,j.jsx)(ht.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(b,{size:"small",background:"#fff7e6",color:"#faad14",icon:(0,j.jsx)(en.A,{style:{fontSize:"14px"}})}),(0,j.jsx)("span",{children:"Pending Requests"})]}),value:ge.pendingRequests,valueStyle:{color:"#faad14",fontSize:"28px",marginBottom:"4px"},prefix:(0,j.jsx)(tn.A,{style:{fontSize:"16px"}})}),(0,j.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#faad14"},children:["View Pending Requests",(0,j.jsx)(gt.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>(async()=>{re(!0);try{let n=[];try{const e=await A.axiosInstance.get("/processed-documents",{params:{page:1,limit:200}}),t=e&&e.data?e.data:null;t&&Array.isArray(t.items)?n=t.items:Array.isArray(t)&&(n=t)}catch(e){try{const e=await A.documentsAPI.listFiles();n=(Array.isArray(e)?e:e&&e.data?e.data:[]).filter(e=>{const t=(e.status||"").toString().toLowerCase();return["processed","approved","completed"].includes(t)||!0===e.processed})}catch(t){n=[]}}se(n||[])}catch(n){console.error("Failed to fetch documents for modal",n),se([])}finally{re(!1),ne(!0)}})(),style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,j.jsx)(ht.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(b,{size:"small",background:"#e6f7ff",color:"#1890ff",icon:(0,j.jsx)(nn.A,{style:{fontSize:"14px"}})}),(0,j.jsx)("span",{children:"Total Documents"})]}),value:ge.totalDocuments,valueStyle:{color:"#1890ff",fontSize:"28px",marginBottom:"4px"},prefix:(0,j.jsx)(an.A,{style:{fontSize:"16px"}})}),(0,j.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#1890ff"},children:["Browse Documents",(0,j.jsx)(gt.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>ee(!0),style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,j.jsx)(ht.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(b,{size:"small",background:"#f6ffed",color:"#52c41a",icon:(0,j.jsx)(sn.A,{style:{fontSize:"14px"}})}),(0,j.jsx)("span",{children:"Completed Requests"})]}),value:ge.completedRequests,valueStyle:{color:"#52c41a",fontSize:"28px",marginBottom:"4px"},prefix:(0,j.jsx)(Ie.A,{style:{fontSize:"16px"}})}),(0,j.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#52c41a"},children:["View Completed",(0,j.jsx)(gt.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>ke("/staff/inbox"),style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,j.jsx)(ht.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(b,{size:"small",background:"#f9f0ff",color:"#722ed1",icon:(0,j.jsx)(S.A,{style:{fontSize:"14px"}})}),(0,j.jsx)("span",{children:"Staff Inbox"})]}),value:w.length,valueStyle:{color:"#722ed1",fontSize:"28px",marginBottom:"4px"},prefix:(0,j.jsx)(We.A,{style:{fontSize:"16px"}})}),(0,j.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#722ed1"},children:["Open Inbox",(0,j.jsx)(gt.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})})]}),(0,j.jsxs)(l.A,{gutter:[16,16],children:[(0,j.jsx)(o.A,{xs:24,lg:8,children:(0,j.jsx)(r.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(rn.A,{})," Document Categories"]}),hoverable:!0,bordered:!1,size:"small",className:"dashboard-card",style:{transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},bodyStyle:{padding:"0",height:"400px",maxHeight:"400px",overflow:"hidden"},children:(0,j.jsx)(Jt.A,{defaultActiveKey:["Certificates"],expandIcon:e=>{let{isActive:t}=e;return(0,j.jsx)(gt.A,{rotate:t?90:0})},style:{background:"white",height:"400px",overflowY:"auto"},children:Object.entries((e=>{const t={Certificates:{icon:(0,j.jsx)(Qt.A,{style:{fontSize:"18px",color:"#1890ff"}}),items:[],color:"#1890ff",description:"Birth, Death, Residency Certificates and more"},Permits:{icon:(0,j.jsx)(Xt.A,{style:{fontSize:"18px",color:"#52c41a"}}),items:[],color:"#52c41a",description:"Building, Business, and Special Event Permits"},Complete:{icon:(0,j.jsx)(Ke.A,{style:{fontSize:"18px",color:"#52c41a"}}),items:[],color:"#52c41a",description:"All completed and approved document requests"}};return e.forEach(e=>{const n=(e.type||"").toLowerCase(),a=(e.status||"").toLowerCase();n.includes("certificate")||n.includes("certification")?t.Certificates.items.push(e):n.includes("permit")&&t.Permits.items.push(e),"approved"!==a&&"completed"!==a||t.Complete.items.push(e)}),t})(m)).map(e=>{let[n,a]=e;const s=a.items.filter(e=>{var t;return"pending"===(null===(t=e.status)||void 0===t?void 0:t.toLowerCase())}).length;return(0,j.jsxs)(Jt.A.Panel,{header:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[(0,j.jsxs)(Oe.A,{align:"center",children:[(0,j.jsx)(b,{size:"small",background:a.color+"15",color:a.color,icon:a.icon}),(0,j.jsx)("span",{style:{fontWeight:500,fontSize:"14px"},children:n})]}),(0,j.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:"8px",alignItems:"center"},children:[s>0&&(0,j.jsxs)(f.A,{color:"gold",style:{marginRight:0},children:[s," pending"]}),(0,j.jsx)(Ot.A,{count:a.items.length,style:{backgroundColor:a.color},size:"small"})]})]}),children:[(0,j.jsx)("div",{style:{marginBottom:"16px"},children:(0,j.jsx)(h.A.Text,{type:"secondary",style:{fontSize:"13px"},children:a.description})}),(0,j.jsx)(g.A,{size:"small",dataSource:a.items.slice(0,5),split:!0,renderItem:e=>{var n;const a={PENDING:{color:"#faad14",bg:"#fff7e6"},APPROVED:{color:"#52c41a",bg:"#f6ffed"},REJECTED:{color:"#ff4d4f",bg:"#fff1f0"},DEFAULT:{color:"#8c8c8c",bg:"#f5f5f5"}},s=(null===(n=e.status)||void 0===n?void 0:n.toUpperCase())||"DEFAULT",i=a[s]||a.DEFAULT;return(0,j.jsx)(g.A.Item,{onClick:()=>t("/document-processing",{state:{openRequestId:e._id}}),actions:["PENDING"===e.status&&(0,j.jsxs)(Oe.A,{size:4,children:[(0,j.jsx)(u.Ay,{type:"text",size:"small",icon:(0,j.jsx)(Ie.A,{style:{color:"#52c41a"}}),onClick:t=>{t.stopPropagation(),F(e),Z("APPROVED")}}),(0,j.jsx)(u.Ay,{type:"text",size:"small",icon:(0,j.jsx)(ln.A,{style:{color:"#ff4d4f"}}),onClick:t=>{t.stopPropagation(),F(e),Z("REJECTED")}})]})].filter(Boolean),style:{padding:"12px 0"},children:(0,j.jsx)(g.A.Item.Meta,{avatar:(0,j.jsx)(b,{size:36,background:i.bg,color:i.color,icon:(0,j.jsx)(Me.A,{})}),title:(0,j.jsxs)(Oe.A,{size:8,style:{marginBottom:4},children:[(0,j.jsx)(h.A.Text,{strong:!0,style:{fontSize:"14px"},children:be(e.type||e.title)}),(0,j.jsx)(f.A,{color:i.color,style:{margin:0,padding:"0 6px",fontSize:"12px",lineHeight:"18px"},children:s})]}),description:(0,j.jsxs)(Oe.A,{direction:"vertical",size:0,children:[(0,j.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:"13px"},children:["Requested by: ",e.username||"Unknown"]}),(0,j.jsx)(h.A.Text,{type:"secondary",style:{fontSize:"12px"},children:we(e.dateRequested||"")})]})})})},locale:{emptyText:(0,j.jsx)(Zt.A,{image:Zt.A.PRESENTED_IMAGE_SIMPLE,description:(0,j.jsxs)(h.A.Text,{type:"secondary",children:["No ",n.toLowerCase()," requests"]})})}}),a.items.length>0&&(0,j.jsx)("div",{style:{textAlign:"center",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #f0f0f0"},children:(0,j.jsxs)(u.Ay,{type:"link",size:"small",icon:a.icon,onClick:()=>ke("/documents"),children:["View All ",n]})})]},n)})})})}),(0,j.jsx)(o.A,{xs:24,lg:8,children:(0,j.jsx)(r.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(Et.A,{}),(0,j.jsx)("span",{children:"Inquiries Inbox"}),(0,j.jsx)(Ot.A,{count:w.filter(e=>"open"===e.status||"PENDING"===e.status).length,style:{backgroundColor:"#722ed1"}})]}),extra:(0,j.jsx)(Oe.A,{children:(0,j.jsx)(ht.A,{value:w.length,suffix:"total",valueStyle:{fontSize:"14px",color:"#8c8c8c"}})}),hoverable:!0,bordered:!1,size:"small",className:"dashboard-card",style:{transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",position:"relative"},bodyStyle:{height:"400px",maxHeight:"400px",padding:0,overflow:"hidden"},children:(0,j.jsxs)("div",{style:{padding:"0 12px"},children:[(0,j.jsxs)(Jt.A,{accordion:!1,defaultActiveKey:["open"],expandIcon:e=>{let{isActive:t}=e;return(0,j.jsx)(gt.A,{rotate:t?90:0})},style:{background:"white"},children:[(0,j.jsx)(Jt.A.Panel,{header:(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:(0,j.jsxs)(Oe.A,{align:"center",children:[(0,j.jsx)(Et.A,{style:{color:"#722ed1",fontSize:"16px"}}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Open Inquiries"}),(0,j.jsx)(Ot.A,{count:w.filter(e=>"PENDING"===e.status||"open"===e.status).length,style:{backgroundColor:"#722ed1"}})]})}),children:(0,j.jsx)("div",{style:{maxHeight:300,overflowY:"auto",paddingRight:8},children:0===w.filter(e=>"PENDING"===e.status||"open"===e.status).length?(0,j.jsx)(Zt.A,{image:Zt.A.PRESENTED_IMAGE_SIMPLE,description:(0,j.jsx)(h.A.Text,{type:"secondary",children:"No open inquiries"})}):(0,j.jsx)(g.A,{size:"large",dataSource:Se(w.filter(e=>"PENDING"===e.status||"open"===e.status)),renderItem:e=>{const n="PENDING"===e.status||"open"===e.status,a=n?"#722ed1":"#8c8c8c",s=n?"#f9f0ff":"#f5f5f5",i=e._id&&C.has(String(e._id)),r=e.username||e.residentName||e.subject||"Unknown",l=r&&"Unknown"!==r&&r.length>0?r.charAt(0).toUpperCase():"?";return(0,j.jsx)(g.A.Item,{style:{padding:"18px 20px",minHeight:72,borderBottom:"1px solid #f0f0f0",transition:"all 0.3s ease",cursor:"pointer",backgroundColor:"white"},onClick:()=>{e._id&&N(String(e._id)),t("/staff/inbox",{state:{openInquiryId:e._id}})},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#fafafa"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="white"},children:(0,j.jsx)(g.A.Item.Meta,{avatar:(0,j.jsx)(Ot.A,{dot:n,color:n&&!i?"#faad14":"#722ed1",offset:[-6,6],children:(0,j.jsx)(b,{size:40,style:{backgroundColor:s,color:a,fontSize:"15px",fontWeight:600},children:l})}),title:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:0},children:[(0,j.jsx)("div",{style:{fontSize:"14px",fontWeight:600,color:"rgba(0, 0, 0, 0.85)"},children:e.username||"Unknown User"}),(0,j.jsx)(f.A,{color:n?"gold":"success",style:{margin:0,fontSize:"12px",lineHeight:"20px",height:"22px",padding:"0 10px",fontWeight:"normal",borderRadius:"4px"},children:n?"PENDING":"RESOLVED"}),n&&!i&&(0,j.jsx)(f.A,{color:"default",onClick:t=>{t.stopPropagation(),e._id&&N(String(e._id))},style:{marginLeft:8,cursor:"pointer",background:"#fff7e6",color:"#d48806",border:"1px solid #ffd591"},children:"UNREAD"})]}),description:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",width:"100%"},children:[(0,j.jsx)(h.A.Text,{style:{fontSize:"13px",color:"rgba(0, 0, 0, 0.65)",flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.5"},children:e.message}),(0,j.jsx)(h.A.Text,{type:"secondary",style:{fontSize:"12px",flexShrink:0,color:"#8c8c8c"},children:we(e.createdAt)})]})})})}})})},"open"),(0,j.jsx)(Jt.A.Panel,{header:(0,j.jsx)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:(0,j.jsxs)(Oe.A,{align:"center",children:[(0,j.jsx)(Et.A,{style:{color:"#52c41a",fontSize:"16px"}}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Resolved Inquiries"}),(0,j.jsx)(Ot.A,{count:w.filter(e=>!("PENDING"===e.status||"open"===e.status)).length,style:{backgroundColor:"#52c41a"}})]})}),children:(0,j.jsx)("div",{style:{maxHeight:220,overflowY:"auto",paddingRight:8},children:0===w.filter(e=>!("PENDING"===e.status||"open"===e.status)).length?(0,j.jsx)(Zt.A,{image:Zt.A.PRESENTED_IMAGE_SIMPLE,description:(0,j.jsx)(h.A.Text,{type:"secondary",children:"No resolved inquiries"})}):(0,j.jsx)(g.A,{size:"small",dataSource:Se(w.filter(e=>!("PENDING"===e.status||"open"===e.status))),renderItem:e=>(0,j.jsx)(g.A.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},onClick:()=>{e._id&&N(String(e._id)),M(e)},children:(0,j.jsx)(g.A.Item.Meta,{avatar:(0,j.jsx)(b,{size:40,style:{backgroundColor:"#f5f5f5",color:"#8c8c8c",fontSize:14},children:(e.username||"Unknown").charAt(0).toUpperCase()}),title:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,j.jsx)("div",{style:{fontSize:13,fontWeight:600},children:e.username||"Unknown User"}),(0,j.jsx)(f.A,{color:"success",style:{margin:0,fontSize:12},children:"RESOLVED"})]}),description:(0,j.jsx)("div",{style:{fontSize:12,color:"#888"},children:e.message})})})})})},"resolved")]}),(0,j.jsx)("div",{style:{position:"absolute",right:12,bottom:12,zIndex:40},children:(0,j.jsx)(u.Ay,{type:"link",style:{position:"absolute",right:16,bottom:0,fontSize:13,color:"#1890ff",zIndex:50,pointerEvents:"auto"},onClick:e=>{try{e.stopPropagation()}catch(n){}t("/inquiry-tracker")},children:"Expand"})})]})})}),(0,j.jsx)(o.A,{xs:24,lg:8,children:(0,j.jsxs)(r.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(Me.A,{})," Announcements"]}),style:{marginTop:0,background:"#fafbfc",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0",position:"relative"},styles:{body:{padding:12}},size:"small",hoverable:!1,children:[0===P.length?(0,j.jsx)(Zt.A,{image:(0,j.jsx)(Me.A,{style:{fontSize:42,color:"#d9d9d9"}}),description:(0,j.jsx)("span",{style:{color:"#888"},children:"No announcements"})}):(0,j.jsx)("div",{style:{maxHeight:320,overflowY:"auto",paddingRight:6},children:(0,j.jsx)(g.A,{loading:R,dataSource:P,renderItem:e=>(0,j.jsxs)(g.A.Item,{style:{cursor:"pointer",padding:"10px 8px",alignItems:"center"},onClick:()=>{L(e),O(!0)},children:[(0,j.jsx)(g.A.Item.Meta,{title:(0,j.jsx)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:(0,j.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,j.jsx)("div",{style:{fontWeight:600,fontSize:13,display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.2em"},children:e.text||"Untitled"}),(0,j.jsx)("div",{style:{fontSize:12,color:"#888",marginTop:6},children:new Date(e.createdAt).toLocaleString()})]})}),description:null}),e.imagePath&&(0,j.jsx)("div",{style:{marginLeft:12,width:92,display:"flex",justifyContent:"flex-end",flexShrink:0},children:(0,j.jsx)("img",{loading:"lazy",className:"rounded-img",src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image")),alt:"ann",style:{width:92,height:60,objectFit:"cover",borderRadius:6,background:"#f0f0f0"}})})]}),size:"small"})}),(0,j.jsx)(u.Ay,{type:"link",style:{position:"absolute",right:16,bottom:0,fontSize:13,color:"#1890ff"},onClick:()=>t("/admin/announcements"),children:"Manage"}),(0,j.jsx)($t.A,{open:U,onClose:()=>{O(!1),L(null)},title:"Announcement",width:720,placement:"right",children:B&&(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Text,{style:{display:"block",marginBottom:12,whiteSpace:"pre-wrap"},children:B.text}),B.imagePath&&(0,j.jsx)("img",{loading:"lazy",className:"rounded-img rounded-img-lg",src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(B._id,"/image")),alt:"announcement",style:{width:"100%",height:"auto",borderRadius:8,background:"#f6f6f6"}}),(0,j.jsx)("div",{style:{marginTop:8,color:"#888"},children:new Date(B.createdAt).toLocaleString()})]})})]})})]}),(0,j.jsxs)(fe.A,{open:te,title:"Processed Documents (".concat(ae.length,")"),onCancel:()=>{ne(!1)},footer:null,width:me.xs?"95%":me.md?1e3:1200,bodyStyle:{padding:"12px 18px"},children:[(0,j.jsxs)(p.A,{spinning:ie,children:[(0,j.jsxs)("div",{style:{display:"flex",gap:12,marginBottom:12,flexDirection:me.xs?"column":"row",alignItems:me.xs?"stretch":"center"},children:[(0,j.jsx)(c.A.Search,{placeholder:"Search by title, filename, transaction code or uploader",allowClear:!0,enterButton:!1,onSearch:e=>he(String(e||"").trim()),onChange:e=>he(e.target.value),style:{maxWidth:420,flex:1},value:ue}),(0,j.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:8},children:[(0,j.jsx)(u.Ay,{onClick:()=>{he("")},children:"Clear"}),(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>{se(ae.slice().sort((e,t)=>new Date(t.createdAt||0).getTime()-new Date(e.createdAt||0).getTime()))},children:"Sort Newest"})]})]}),(0,j.jsx)(zt.A,{dataSource:ae.filter(e=>{if(!ue)return!0;const t=ue.toLowerCase();return[e.title,e.filename,e.name,e.transactionCode,e.transactioncode,e.uploadedBy&&(e.uploadedBy.username||e.uploadedBy.name)||e.uploadedBy||""].some(e=>e&&String(e).toLowerCase().includes(t))}),rowKey:e=>e._id||e.id||e.filename,pagination:{pageSize:10},scroll:{x:"max-content"},columns:[{title:"Title",dataIndex:"title",key:"title",render:(e,t)=>(0,j.jsxs)("div",{style:{display:"flex",gap:10,alignItems:"center"},children:[(0,j.jsx)(b,{size:36,icon:(0,j.jsx)(Me.A,{})}),(0,j.jsxs)("div",{style:{minWidth:0},children:[(0,j.jsx)("div",{style:{fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:e||t.filename||t.name||"Untitled"}),(0,j.jsx)("div",{style:{fontSize:12,color:"#888"},children:t.sourceTemplateName||t.templateName||""})]})]})},{title:"Transaction",dataIndex:"transactionCode",key:"transactionCode",responsive:["sm"],render:e=>e||"-"},{title:"Uploaded By",dataIndex:"uploadedBy",key:"uploadedBy",responsive:["md"],render:e=>e&&(e.username||e.name)||("string"===typeof e?e:"-")},{title:"Date",dataIndex:"createdAt",key:"createdAt",responsive:["sm"],render:e=>we(e)},{title:"Actions",key:"action",width:220,render:(e,t)=>(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(u.Ay,{size:"small",onClick:()=>Ae(t),children:"Download"}),(0,j.jsx)(u.Ay,{size:"small",onClick:()=>{ce(t),oe(!0)},children:"Preview"}),(t.transactionCode||t.transactioncode)&&(0,j.jsx)(u.Ay,{size:"small",onClick:()=>{var e;null===(e=navigator.clipboard)||void 0===e||e.writeText(t.transactionCode||t.transactioncode||""),Gt.Ay.success({message:"Copied",description:"Transaction code copied to clipboard"})},children:"Copy TX"})]})}]})]}),(0,j.jsx)($t.A,{title:de&&(de.title||de.filename)||"Document",placement:"right",onClose:()=>{oe(!1),ce(null)},open:le,width:me.xs?"95%":560,children:de?(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,j.jsxs)("div",{children:[(0,j.jsx)("div",{style:{fontWeight:700},children:de.title||de.filename||"Untitled"}),(0,j.jsx)("div",{style:{fontSize:12,color:"#888"},children:de.sourceTemplateName||de.templateName||""})]}),(0,j.jsx)("div",{children:(0,j.jsx)(u.Ay,{onClick:()=>Ae(de),type:"primary",children:"Download"})})]}),(0,j.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap"},children:[(0,j.jsxs)(f.A,{color:"blue",children:["Created: ",we(de.createdAt)]}),de.transactionCode&&(0,j.jsxs)(f.A,{color:"purple",children:["TX: ",de.transactionCode]}),de.uploadedBy&&(0,j.jsxs)(f.A,{children:["By: ",de.uploadedBy.username||de.uploadedBy.name||de.uploadedBy]})]}),(0,j.jsxs)("div",{style:{color:"#444",fontSize:13},children:[(0,j.jsx)("div",{style:{marginBottom:8},children:de.description||de.notes||""}),(0,j.jsx)("div",{style:{marginTop:8},children:(0,j.jsx)(u.Ay,{type:"link",onClick:()=>{var e;null===(e=navigator.clipboard)||void 0===e||e.writeText(de.transactionCode||""),Gt.Ay.success({message:"Copied",description:"Transaction code copied"})},children:"Copy Transaction Code"})})]})]}):(0,j.jsx)("div",{children:"No document selected"})}),(0,j.jsx)(fe.A,{title:"Manage Inquiries",open:W,onCancel:()=>{Y(!1),V(null)},footer:null,width:900,children:(0,j.jsxs)(zt.A,{dataSource:null!==H?H:Se(y),rowKey:e=>e._id,pagination:{pageSize:10},onRow:e=>({onClick:()=>{e&&e._id&&N(String(e._id)),Y(!1),t("/staff/inbox",{state:{openInquiryId:e._id}})}}),children:[(0,j.jsx)(zt.A.Column,{title:"Name",dataIndex:"username",render:(e,t)=>e||t.residentName||t.subject||"Unknown"},"username"),(0,j.jsx)(zt.A.Column,{title:"Type of Inquiry",dataIndex:"type",render:e=>e?String(e):"General"},"type"),(0,j.jsx)(zt.A.Column,{title:"Status",dataIndex:"status",render:e=>je(e)},"status"),(0,j.jsx)(zt.A.Column,{title:"Date Inquired",dataIndex:"createdAt",render:e=>we(e)},"createdAt")]})})]}),(0,j.jsx)(fe.A,{open:!!z,title:z?"".concat(J," Document Request"):"",onCancel:()=>{F(null),K(""),Z("")},footer:z?[(0,j.jsx)(c.A.TextArea,{rows:4,value:G,onChange:e=>K(e.target.value),placeholder:"Type notes..."},"notes"),(0,j.jsx)(u.Ay,{type:"primary",disabled:!G.trim(),onClick:async()=>{if(!z)return;const e=z._id||z.id;if(e)try{const t={status:(J||"").toString().toLowerCase(),notes:G};Gt.Ay.info({message:"Processing",description:"Updating document status to ".concat(t.status,"..."),duration:1.2}),await A.documentsAPI.updateDocumentStatus(e,t),x(n=>(n||[]).map(n=>!n||n._id!==e&&n.id!==e?n:(0,a.A)((0,a.A)({},n),{},{status:t.status}))),Gt.Ay.success({message:"Success",description:"Document marked ".concat(t.status)}),F(null),K(""),Z("")}catch(s){var t,n;console.error("Failed to update document status",s);const e=(null===s||void 0===s||null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||(null===s||void 0===s?void 0:s.message)||"Failed to update document";Gt.Ay.error({message:"Error",description:e})}},children:"Submit"},"submit")]:null,children:z&&(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Type:"})," ",be(z.type||z.title),(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Description:"})," ",z.description||"",(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Requested by:"})," ",z.username||"Unknown",(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Barangay ID:"})," ",z.barangayID||"Unknown",(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Date:"})," ",we(z.dateRequested||""),(0,j.jsx)("br",{})]})}),(0,j.jsx)(fe.A,{open:!!E,title:E?"Respond to Inquiry: ".concat(E.subject):"",onCancel:()=>{M(null),K("")},footer:E?[(0,j.jsx)(c.A.TextArea,{rows:4,value:G,onChange:e=>K(e.target.value),placeholder:"Type your response...",disabled:$},"response"),(0,j.jsx)(u.Ay,{type:"primary",loading:$,disabled:!G.trim(),onClick:async()=>{if(!E)return;const e=E._id||E.id;if(e)try{Gt.Ay.info({message:"Sending response",description:"Posting your reply...",duration:1.2}),await A.contactAPI.respondToInquiry(e,{response:G}),v(t=>(t||[]).map(t=>!t||t._id!==e&&t.id!==e?t:(0,a.A)((0,a.A)({},t),{},{status:"resolved"}))),Gt.Ay.success({message:"Response sent",description:"Inquiry has been updated"}),M(null),K("")}catch(s){var t,n;console.error("Failed to send inquiry response",s);const e=(null===s||void 0===s||null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||(null===s||void 0===s?void 0:s.message)||"Failed to send response";Gt.Ay.error({message:"Error",description:e})}},children:"Send Response"},"send")]:null,children:E&&(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Type:"})," ",E.type,(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Message:"})," ",E.message,(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"From:"})," ",E.username?"".concat(E.username," (Barangay ID: ").concat(E.barangayID||"Unknown",")"):"Unknown",(0,j.jsx)("br",{}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Date:"})," ",we(E.createdAt),(0,j.jsx)("br",{})]})}),(0,j.jsx)(fe.A,{open:X,title:"Completed Requests (".concat(ge.completedRequests||0,")"),onCancel:()=>ee(!1),footer:null,width:1100,bodyStyle:{padding:12},children:(0,j.jsx)("div",{style:{overflowX:"auto"},children:(0,j.jsx)(zt.A,{dataSource:m.filter(e=>"approved"===(e.status||"").toLowerCase()||"completed"===(e.status||"").toLowerCase()),rowKey:e=>e._id,pagination:{pageSize:10},scroll:{x:1e3},columns:[{title:"Requester",dataIndex:"username",key:"username",width:200,render:(e,t)=>{var n;return e||(null===(n=t.requesterId)||void 0===n?void 0:n.fullName)||"Unknown"}},{title:"Document",dataIndex:"type",key:"type",width:220,render:(e,t)=>be(e||t.title)},{title:"Description",dataIndex:"description",key:"description",width:300,render:e=>e||"-"},{title:"Date Requested",dataIndex:"dateRequested",key:"dateRequested",width:180,render:e=>we(e)},{title:"Status",dataIndex:"status",key:"status",width:120,render:e=>je(e)},{title:"Action",key:"action",width:120,render:(e,t)=>(0,j.jsx)(u.Ay,{type:"link",onClick:()=>{F(t),ee(!1),Z("")},children:"View"})}]})})})]})})};var dn=n(87674),cn=n(42104);let un=null;function hn(e,t){un&&un.on(e,t)}function mn(e,t){un&&un.off(e,t)}const pn=["#6366F1","#22C55E","#F59E42","#EF4444","#3B82F6","#FBBF24","#A21CAF","#14B8A6"],{Title:xn,Text:gn}=h.A,fn=()=>{const e=(0,xe.Zp)(),{user:t}=De(),[n,i]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!1),[h,m]=(0,s.useState)([]),[x,f]=(0,s.useState)({totalUsers:0,activeUsers:0,pendingRequests:0,totalDocuments:0,completedRequests:0,unreadMessages:0}),[y,v]=(0,s.useState)([]),[w,I]=(0,s.useState)([]),[S,C]=(0,s.useState)([]),[k,N]=(0,s.useState)([]),[T,_]=(0,s.useState)([]),[P,D]=(0,s.useState)(!1),[R,q]=(0,s.useState)(!1),[B,L]=(0,s.useState)(null),[U,O]=(0,s.useState)(null),[z,F]=(0,s.useState)(""),[E,M]=(0,s.useState)(!1),[W,Y]=(0,s.useState)([]),[H,V]=(0,s.useState)([]),G=[3,5,4,6,7,8,10],K=[{type:"Clearance",value:12},{type:"Certificate",value:8},{type:"Permit",value:5},{type:"Other",value:3}],J=[{type:"Clearance",value:27},{type:"Certificate",value:18},{type:"Permit",value:12},{type:"Other",value:8}];const Z=async()=>{try{var e,n,a,s,r;i(!0);const d=await A.adminAPI.getSystemStatistics();try{const e=await A.documentsAPI.getDocumentRecords();m(e)}catch(l){m([])}const c=(await A.notificationAPI.getNotifications()).filter(e=>!e.read);v(c.slice(0,10));const u=c.filter(e=>(e.type||"").toString().toLowerCase().includes("staff"));I(u);try{const e=await A.requestsAPI.getStaffAccessRequests();C(e||[])}catch(l){C([])}const h=((null===(e=d.documents)||void 0===e?void 0:e.pending)||0)+u.length,p=(null===(n=d.documents)||void 0===n?void 0:n.total)||0;let x=0;try{const e=await A.documentsAPI.getDocumentRecords();x=((Array.isArray(e)?e:e&&e.data?e.data:[])||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase()).length}catch(o){x=h}const g=x+(u?u.length:0);f({totalUsers:(null===(a=d.users)||void 0===a?void 0:a.total)||0,activeUsers:(null===(s=d.users)||void 0===s?void 0:s.active)||0,pendingRequests:g,totalDocuments:p,completedRequests:(null===(r=d.documents)||void 0===r?void 0:r.completed)||0,unreadMessages:0});const y=await A.contactAPI.getAllInquiries();Y(y);const j=y.filter(e=>e.assignedRole&&t&&e.assignedRole===t.role||e.assignedTo&&Array.isArray(e.assignedTo)&&t&&e.assignedTo.includes(t._id));V(j);const b=await A.adminAPI.getActivityLogs({});N(b.map(e=>({id:e.id,type:e.module||"system",description:e.description||e.action,timestamp:e.timestamp,user:e.userName||e.userId})))}catch(d){console.error("Error fetching dashboard data:",d)}finally{i(!1)}};(0,s.useEffect)(()=>{Z();try{!function(e){if(un)return un;const t=globalThis.__APP_CONFIG__||{};let n=t.SOCKET_URL||t.API_BASE||"https://my-backend.onrender.com/api",a=String(n).replace(/\/$/,"");a.endsWith("/api")&&(a=a.replace(/\/api$/,"")),"/api"===a&&(a=""),un=(0,cn.Ay)(a||"/",{path:"/socket.io",transports:["websocket"],auth:e?{token:e}:void 0,autoConnect:!0})}();const e=e=>{console.log("Received document socket event, refreshing dashboard",e),Z()};hn("documentStatusUpdate",e),hn("documentCreated",e),hn("documentDeleted",e),hn("documents-updated",e);const t=setInterval(()=>{Z()},3e4);return()=>{mn("documentStatusUpdate",e),mn("documentCreated",e),mn("documentDeleted",e),mn("documents-updated",e),clearInterval(t)}}catch(e){const t=setInterval(()=>{Z()},3e4);return()=>clearInterval(t)}},[]);const $=async()=>{D(!0);try{const e=await A.verificationAPI.getRequests();_(Array.isArray(e)?e:[])}catch(e){console.error("Failed to load verification requests",e),_([])}finally{D(!1)}};(0,s.useEffect)(()=>{$()},[]);const Q=async()=>{try{const e=await A.adminAPI.getUsers(),t=Array.isArray(e)||e&&"number"===typeof e.length?e.length:0;f(e=>(0,a.A)((0,a.A)({},e),{},{totalUsers:t}))}catch(e){console.error("Failed to fetch users list for count:",e)}};(0,s.useEffect)(()=>{Q();const e=setInterval(Q,3e4);return()=>clearInterval(e)},[]);const X=async e=>{var t;if(null!==(t=e.data)&&void 0!==t&&t.userId&&e._id)try{i(!0),await A.notificationAPI.approveStaff(e.data.userId,e._id),await Z()}catch(n){console.error("Failed to approve staff:",n)}finally{i(!1)}},ee=()=>(0,j.jsx)("span",{style:{display:"inline-block",width:8,height:8,borderRadius:"50%",background:"#ff4d4f",marginLeft:6,verticalAlign:"middle"},"aria-label":"Unread"}),te=[{label:"Users",value:x.totalUsers,icon:"\ud83d\udc64",bg:"linear-gradient(90deg, #1890ff 0%, #40a9ff 100%)",color:"#1890ff",labelColor:"#e6f7ff",onClick:void 0,chart:(0,j.jsx)("div",{style:{width:"100%",marginTop:8,height:32},children:(0,j.jsx)("svg",{width:"100%",height:"40",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:(0,j.jsx)("polyline",{fill:"none",stroke:"#4F46E5",strokeWidth:"2",points:G.map((e,t)=>"".concat(t*(100/(G.length-1)),",").concat(40-e/Math.max(...G)*35)).join(" ")})})})},{label:"Pending Requests",value:x.pendingRequests,icon:"\u23f3",bg:"linear-gradient(90deg, #faad14 0%, #ffe58f 100%)",color:"#faad14",labelColor:"#fffbe6",onClick:void 0,chart:(0,j.jsx)("div",{style:{width:"100%",marginTop:8,height:32},children:(0,j.jsx)("svg",{width:"100%",height:"40",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:K.map((e,t)=>{const n=100/K.length-2,a=e.value/Math.max(...K.map(e=>e.value))*35;return(0,j.jsx)("rect",{x:t*(100/K.length)+1,y:40-a,width:n,height:a,fill:"#22C55E",rx:"2"},t)})})})},{label:"Documents",value:x.totalDocuments,icon:"\ud83d\udcc4",bg:"linear-gradient(90deg, #52c41a 0%, #b7eb8f 100%)",color:"#52c41a",labelColor:"#f6ffed",onClick:void 0,chart:(0,j.jsx)("div",{style:{width:"100%",marginTop:8,height:32,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,j.jsx)("svg",{width:"40",height:"40",viewBox:"0 0 40 40",children:(()=>{const e=J.reduce((e,t)=>e+t.value,0);let t=0;return J.map((n,a)=>{const s=n.value/e*360,i=t+s,r=s>180?1:0,l=20+18*Math.cos(Math.PI*(t-90)/180),o=20+18*Math.sin(Math.PI*(t-90)/180),d=20+18*Math.cos(Math.PI*(i-90)/180),c=20+18*Math.sin(Math.PI*(i-90)/180),u="M20,20 L".concat(l,",").concat(o," A18,18 0 ").concat(r," 1 ").concat(d,",").concat(c," Z");return t+=s,(0,j.jsx)("path",{d:u,fill:pn[a%pn.length]},a)})})()})})},{label:(0,j.jsxs)("span",{children:["Messages ",(0,j.jsx)(ee,{})]}),value:x.unreadMessages,icon:"\u2709\ufe0f",bg:"linear-gradient(90deg, #722ed1 0%, #b37feb 100%)",color:"#722ed1",labelColor:"#f9f0ff",onClick:()=>e("/admin/messages"),chart:null}],ne=["Total Users","Pending Requests","Total Documents","Unread Messages"],[ae,se]=(0,s.useState)([]),[ie,re]=(0,s.useState)(!1),[le,oe]=(0,s.useState)(null),[de,ce]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{re(!0);try{const e=await A.contactAPI.getAnnouncements();se(Array.isArray(e)?e.slice(0,6):[])}catch(e){console.error("Failed to load mini announcements",e),se([])}finally{re(!1)}})()},[]);const ue=e=>{if(!e)return"";const t=new Date(e),n=Math.floor((Date.now()-t.getTime())/1e3);return n<60?"".concat(n,"s ago"):n<3600?"".concat(Math.floor(n/60),"m ago"):n<86400?"".concat(Math.floor(n/3600),"h ago"):n<604800?"".concat(Math.floor(n/86400),"d ago"):t.toLocaleDateString()};return(0,j.jsx)(p.A,{spinning:n,children:(0,j.jsxs)("div",{style:{padding:24,backgroundColor:"#f0f2f5",minHeight:"100vh"},children:[(0,j.jsx)(xn,{level:4,style:{marginBottom:24},children:"Admin Dashboard"}),(0,j.jsx)(l.A,{gutter:[24,24],style:{marginBottom:32},children:te.map((e,t)=>(0,j.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,j.jsxs)(r.A,{hoverable:!0,onClick:e.onClick,style:{background:e.bg,color:"#fff",borderRadius:20,minHeight:170,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:e.onClick?"pointer":"default",transition:"box-shadow 0.2s, transform 0.2s",position:"relative",marginBottom:8,padding:24},styles:{body:{width:"100%",padding:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"transparent"}},onMouseEnter:e=>{e.currentTarget.style.boxShadow="0 8px 32px 0 rgba(0,0,0,0.18)",e.currentTarget.style.transform="translateY(-4px)"},onMouseLeave:e=>{e.currentTarget.style.boxShadow="0 2px 8px 0 rgba(0,0,0,0.08)",e.currentTarget.style.transform="none"},children:[(0,j.jsx)("span",{style:{fontSize:40,marginBottom:8,opacity:.92},children:e.icon}),(0,j.jsx)("span",{style:{fontSize:38,fontWeight:700,lineHeight:1},children:e.value}),(0,j.jsx)("span",{style:{fontSize:15,color:e.labelColor,fontWeight:500,marginTop:2,letterSpacing:.5},children:e.label}),(0,j.jsx)("span",{style:{fontSize:13,color:"rgba(255,255,255,0.7)",marginTop:2,fontWeight:400},children:ne[t]}),e.chart]})},"string"===typeof e.label?e.label:String(t)))}),(0,j.jsxs)(l.A,{gutter:[24,24],style:{marginTop:0},children:[(0,j.jsx)(o.A,{xs:24,lg:12,children:(0,j.jsxs)(r.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(dn.A,{})," Staff Access Approval"]}),style:{marginTop:0,background:"#fafbfc",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0",position:"relative"},styles:{body:{padding:16}},size:"small",hoverable:!1,children:[S&&S.length>0?(0,j.jsx)(zt.A,{size:"small",pagination:{pageSize:5},dataSource:S,rowKey:e=>e._id||String(e.createdAt),columns:[{title:"Name",dataIndex:"requestedBy",key:"requestedBy",render:(e,t)=>{var n;const a=null===t||void 0===t||null===(n=t.data)||void 0===n?void 0:n.fullName,s=null===t||void 0===t?void 0:t.requestedByName;let i=null;null!==t&&void 0!==t&&t.requestedBy&&("string"===typeof t.requestedBy?i=t.requestedBy:"object"===typeof t.requestedBy&&(i=t.requestedBy.fullName||t.requestedBy.username||t.requestedBy._id));const r=a||s||i||"Unknown";return(0,j.jsx)("span",{style:{fontWeight:600},children:r})}},{title:"Requested At",dataIndex:"createdAt",key:"createdAt",render:e=>(0,j.jsx)("span",{style:{fontSize:12,color:"#888"},children:new Date(e).toLocaleString()})},{title:"Actions",key:"actions",render:(e,t)=>(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(u.Ay,{type:"primary",size:"small",onClick:async()=>{try{i(!0),t&&"staff_access"===t.type&&t._id?await A.requestsAPI.approveRequest(t._id):await X(t),await Z()}catch(e){console.error("Approve action failed",e)}finally{i(!1)}},icon:(0,j.jsx)(Ie.A,{}),children:"Approve"}),(0,j.jsx)(u.Ay,{danger:!0,size:"small",onClick:()=>(async e=>{if(!e._id)return;const t=window.prompt("Enter a brief reason for rejection (optional):");try{i(!0),await A.notificationAPI.rejectStaff(e._id,t||void 0),await Z()}catch(n){console.error("Failed to reject staff request:",n)}finally{i(!1)}})(t),icon:(0,j.jsx)(ln.A,{}),children:"Reject"})]})}]}):0===y.length?(0,j.jsx)(Zt.A,{image:(0,j.jsx)(dn.A,{style:{fontSize:48,color:"#d9d9d9"}}),description:(0,j.jsx)("span",{style:{color:"#888"},children:"No notifications"})}):(0,j.jsx)(g.A,{dataSource:y,renderItem:e=>(0,j.jsx)(g.A.Item,{actions:[(e.type||"").toString().toLowerCase().includes("staff")&&!e.read&&(0,j.jsx)(u.Ay,{type:"primary",size:"small",icon:(0,j.jsx)(Ie.A,{}),onClick:()=>X(e),children:"Approve"})].filter(Boolean),children:(0,j.jsx)(g.A.Item.Meta,{avatar:(0,j.jsx)(b,{icon:(e.type||"").toString().toLowerCase().includes("staff")?(0,j.jsx)(Ye.A,{}):(0,j.jsx)(dn.A,{}),style:{backgroundColor:e.read?"#8c8c8c":(e.type||"").toString().toLowerCase().includes("staff")?"#faad14":"#1890ff"}}),title:(0,j.jsx)(gn,{strong:(e.type||"").toString().toLowerCase().includes("staff"),children:e.message}),description:(0,j.jsxs)("div",{children:[(0,j.jsx)(gn,{type:"secondary",children:new Date(e.createdAt).toLocaleString()}),(e.type||"").toString().toLowerCase().includes("staff")&&e.data&&(0,j.jsxs)("div",{style:{marginTop:8},children:[(0,j.jsx)(gn,{strong:!0,children:"Full Name:"})," ",e.data.fullName||"N/A",(0,j.jsx)("br",{}),(0,j.jsx)(gn,{strong:!0,children:"Email:"})," ",e.data.email||"N/A",(0,j.jsx)("br",{}),(0,j.jsx)(gn,{strong:!0,children:"Username:"})," ",e.data.username||"N/A"]})]})})}),size:"small"}),(0,j.jsx)(u.Ay,{type:"link",style:{position:"absolute",right:16,bottom:8,fontSize:13,color:"#1890ff"},onClick:()=>e("/admin/notifications"),children:"View all"})]})}),(0,j.jsx)(o.A,{xs:24,lg:12,children:(0,j.jsxs)(r.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(Me.A,{})," Announcements"]}),style:{marginTop:0,background:"#fafbfc",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0",position:"relative"},styles:{body:{padding:12}},size:"small",hoverable:!1,children:[0===ae.length?(0,j.jsx)(Zt.A,{image:(0,j.jsx)(Me.A,{style:{fontSize:42,color:"#d9d9d9"}}),description:(0,j.jsx)("span",{style:{color:"#888"},children:"No announcements"})}):(0,j.jsx)("div",{style:{maxHeight:320,overflowY:"auto",paddingRight:6,paddingBottom:48},children:(0,j.jsx)(g.A,{loading:ie,dataSource:ae,renderItem:e=>(0,j.jsxs)(g.A.Item,{style:{cursor:"pointer",padding:"10px 8px",alignItems:"center"},onClick:()=>{oe(e),ce(!0)},children:[(0,j.jsx)(g.A.Item.Meta,{title:(0,j.jsx)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:(0,j.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,j.jsx)("div",{style:{fontWeight:600,fontSize:13,display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.2em"},children:e.text||"Untitled"}),(0,j.jsx)("div",{style:{fontSize:12,color:"#888",marginTop:6},children:ue(e.createdAt)})]})}),description:null}),e.imagePath&&(0,j.jsx)("div",{style:{marginLeft:12,width:92,display:"flex",justifyContent:"flex-end",flexShrink:0},children:(0,j.jsx)("img",{loading:"lazy",className:"rounded-img",src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image")),alt:"ann",style:{width:92,height:60,objectFit:"cover",borderRadius:6,background:"#f0f0f0"}})})]}),size:"small"})}),(0,j.jsx)("div",{style:{marginTop:8,display:"flex",justifyContent:"flex-end"},children:(0,j.jsx)(u.Ay,{type:"link",style:{fontSize:13,color:"#1890ff"},onClick:()=>e("/admin/announcements"),children:"Manage"})}),(0,j.jsx)($t.A,{open:de,onClose:()=>{ce(!1),oe(null)},title:"Announcement",width:720,placement:"right",children:le&&(0,j.jsxs)("div",{children:[(0,j.jsx)(gn,{style:{display:"block",marginBottom:12,whiteSpace:"pre-wrap"},children:le.text}),le.imagePath&&(0,j.jsx)("img",{loading:"lazy",className:"rounded-img rounded-img-lg",src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(le._id,"/image")),alt:"announcement",style:{width:"100%",height:"auto",borderRadius:8,background:"#f6f6f6"}}),(0,j.jsx)("div",{style:{marginTop:8,color:"#888"},children:ue(le.createdAt)})]})})]})})]}),(0,j.jsx)(l.A,{gutter:[24,24],style:{marginTop:24},children:(0,j.jsx)(o.A,{xs:24,children:(0,j.jsxs)(r.A,{title:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)($e.A,{})," Verification Requests"]}),style:{marginTop:0,background:"#fff",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0"},size:"small",hoverable:!1,children:[P?(0,j.jsx)("div",{style:{textAlign:"center",padding:24},children:(0,j.jsx)(p.A,{})}):T&&0!==T.length?(0,j.jsx)(g.A,{dataSource:T.slice(0,6),renderItem:e=>(0,j.jsx)(g.A.Item,{actions:[(0,j.jsx)(u.Ay,{size:"small",onClick:()=>(L(e),void q(!0)),children:"Check ID"},"view"),(0,j.jsx)(u.Ay,{type:"primary",size:"small",onClick:()=>{var t;return(async e=>{try{if(D(!0),e&&"object"===typeof e){var t;const a=e._id,s=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;try{await A.verificationAPI.approveRequest(a)}catch(n){}s&&await A.verificationAPI.verifyUser(s,!0)}else"string"===typeof e&&await A.verificationAPI.verifyUser(e,!0);await $()}catch(a){console.error("Failed to verify user",a)}finally{D(!1)}})((null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId)},children:"Verify"},"verify"),(0,j.jsx)(u.Ay,{danger:!0,size:"small",onClick:()=>{var t;return(async e=>{try{if(D(!0),e&&"object"===typeof e){var t;const a=e._id,s=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;try{await A.verificationAPI.rejectRequest(a)}catch(n){}s&&await A.verificationAPI.verifyUser(s,!1)}else"string"===typeof e&&await A.verificationAPI.verifyUser(e,!1);await $()}catch(a){console.error("Failed to reject verification",a)}finally{D(!1)}})((null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId)},children:"Reject"},"reject")],children:(0,j.jsx)(g.A.Item.Meta,{title:(0,j.jsx)("span",{style:{fontWeight:600},children:e.userId&&(e.userId.fullName||e.userId.username)||"Unknown Resident"}),description:(0,j.jsxs)("span",{style:{color:"#888"},children:[e.status||"pending"," \xb7 ",new Date(e.createdAt).toLocaleString()]})})}),size:"small"}):(0,j.jsx)(Zt.A,{description:"No verification requests"}),(0,j.jsx)(u.Ay,{type:"link",style:{marginTop:12},onClick:()=>e("/admin/verification-requests"),children:"View all"}),(0,j.jsx)(fe.A,{title:"Verification Files",open:R,onCancel:()=>q(!1),footer:null,width:720,children:B?(0,j.jsxs)("div",{children:[(0,j.jsxs)("p",{children:[(0,j.jsx)("strong",{children:"Resident:"})," ",B.userId&&(B.userId.fullName||B.userId.username)||"Unknown"]}),(0,j.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:(B.gridFileIds||[]).map(e=>(0,j.jsxs)("div",{style:{border:"1px solid #f0f0f0",padding:8,borderRadius:6},children:[(0,j.jsx)("div",{style:{marginBottom:8},children:(0,j.jsx)("a",{href:(0,A.getAbsoluteApiUrl)("/verification/file/".concat(e)),target:"_blank",rel:"noreferrer",children:"Open file in new tab"})}),(0,j.jsx)("div",{children:(0,j.jsx)("img",{src:(0,A.getAbsoluteApiUrl)("/verification/file/".concat(e)),alt:"id",style:{maxWidth:"100%",maxHeight:400},onError:()=>{}})})]},e))})]}):(0,j.jsx)(Zt.A,{description:"No files"})})]})})})]})})};var yn=n(40322),An=n(18125),jn=n(59772),vn=n(33359),bn=n(94763),wn=n(91522),In=n(26086),Sn=n(60446),Cn=n.n(Sn);const kn=[{text:"Admin",value:"admin"},{text:"Staff",value:"staff"},{text:"Resident",value:"resident"}],Nn=[{text:"Active",value:!0},{text:"Inactive",value:!1}],Tn=()=>{const[e,t]=(0,s.useState)([]),[m,x]=(0,s.useState)(""),[g,y]=(0,s.useState)(void 0),[v,w]=(0,s.useState)(void 0),[I,S]=(0,s.useState)(null),[C,k]=(0,s.useState)(1),[N,T]=(0,s.useState)(10),[_,P]=(0,s.useState)([]),[D,R]=(0,s.useState)(!1),[q,B]=(0,s.useState)(null),[L,U]=(0,s.useState)(null),[O,z]=(0,s.useState)(!1),[F,E]=(0,s.useState)(!1),[M,W]=(0,s.useState)(!1),[Y,H]=(0,s.useState)(!1),[V,G]=(0,s.useState)({}),[K,J]=(0,s.useState)(!1),[Q,ee]=(0,s.useState)(0),[te,ne]=(0,s.useState)(null),ae=s.useRef(null),[se,ie]=(0,s.useState)(!0),[re,le]=(0,s.useState)({});const oe=()=>{ie(!0),A.adminAPI.getUsers().then(e=>{t(e.map((e,t)=>({key:e._id||t,_id:e._id||null,fullName:e.fullName||e.username||"",email:e.email,role:e.role,isActive:e.isActive,verified:!!e.verified,createdAt:e.createdAt,lastLogin:e.lastLogin,avatar:e.avatar||null,barangayId:e.barangayId||e.barangayID||e.barangay_id||null})))}).catch(()=>t([])).finally(()=>ie(!1))};(0,s.useEffect)(()=>{oe()},[]);const de=async(e,t)=>{if(e)try{i.Ay.loading({content:"Disabling user...",key:"disable"});const n=t?{suspendedUntil:t}:{},a=await A.adminAPI.disableUser(e,n);i.Ay.success({content:"User disabled",key:"disable",duration:2}),await oe(),q&&q._id===e&&B(a.user||a)}catch(n){console.error("Failed to disable user",n),i.Ay.error("Failed to disable user")}},ce=async e=>{if(e)try{i.Ay.loading({content:"Enabling user...",key:"enable"});const t=await A.adminAPI.enableUser(e);i.Ay.success({content:"User enabled",key:"enable",duration:2}),await oe(),q&&q._id===e&&B(t.user||t)}catch(t){console.error("Failed to enable user",t),i.Ay.error("Failed to enable user")}},ue=async e=>{if(e)try{i.Ay.loading({content:"Demoting user...",key:"demote"});const t=await A.adminAPI.demoteUser(e);i.Ay.success({content:"User demoted to resident",key:"demote",duration:2}),await oe(),q&&q._id===e&&B(t.user||t)}catch(t){console.error("Failed to demote user",t),i.Ay.error("Failed to demote user")}},he=e.filter(e=>{const t=e.fullName.toLowerCase().includes(m.toLowerCase())||e.email.toLowerCase().includes(m.toLowerCase()),n=!g||e.role===g,a=void 0===v||e.isActive===v,s=!I||2!==I.length||Cn()(e.createdAt).isAfter(I[0],"day")&&Cn()(e.createdAt).isBefore(I[1],"day");return t&&n&&a&&s}),me=[{title:"Name",dataIndex:"fullName",key:"fullName",render:(e,t)=>(0,j.jsxs)(Oe.A,{children:[(()=>{let n=t;try{const e=localStorage.getItem("userProfile");e&&(n=JSON.parse(e))}catch(a){}return(0,j.jsx)(b,{style:{backgroundColor:"#1890ff",verticalAlign:"middle"},src:t.avatar,user:n,size:36,children:e&&e.length>0?e.charAt(0).toUpperCase():"?"})})(),(0,j.jsx)("b",{children:e})]}),sorter:(e,t)=>e.fullName.localeCompare(t.fullName),sortDirections:["ascend","descend"],fixed:"left"},{title:"Barangay ID",dataIndex:"barangayId",key:"barangayId",render:e=>e||"\u2014",width:160},{title:"Email",dataIndex:"email",key:"email",sorter:(e,t)=>e.email.localeCompare(t.email),sortDirections:["ascend","descend"]},{title:"Role",dataIndex:"role",key:"role",render:e=>{const t=e||"";return(0,j.jsx)(f.A,{color:"admin"===t?"magenta":"staff"===t?"blue":"green",children:t?t.charAt(0).toUpperCase()+t.slice(1):""})},filters:kn,onFilter:(e,t)=>t.role===e},{title:"Status",dataIndex:"isActive",key:"isActive",render:e=>(0,j.jsx)(f.A,{color:e?"green":"red",children:e?"Active":"Inactive"}),filters:Nn,onFilter:(e,t)=>t.isActive===e},{title:"Created",dataIndex:"createdAt",key:"createdAt",render:e=>Cn()(e).format("YYYY-MM-DD"),sorter:(e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime(),sortDirections:["ascend","descend"]},{title:"Actions",key:"actions",fixed:"right",render:(e,t)=>(0,j.jsx)(ze.A,{popupRender:()=>(0,j.jsxs)(Ue.A,{children:[(0,j.jsx)(Ue.A.Item,{icon:(0,j.jsx)(vn.A,{}),onClick:()=>{B(t),R(!0)},children:"Edit"},"edit"),(0,j.jsx)(Ue.A.Item,{icon:(0,j.jsx)($.A,{}),onClick:()=>{},children:"View Logs"},"logs"),(0,j.jsx)(Ue.A.Item,{icon:(0,j.jsx)(bn.A,{}),onClick:()=>{},children:"Deactivate"},"deactivate"),(0,j.jsx)(Ue.A.Item,{icon:(0,j.jsx)(Ie.A,{}),onClick:async()=>{if(!t||!t._id)return void i.Ay.error("No user selected");const e=t.verified?"Mark ".concat(t.fullName||t.email," as unverified?"):"Mark ".concat(t.fullName||t.email," as verified?");fe.A.confirm({title:t.verified?"Unverify user":"Verify user",content:e,onOk:async()=>{await(async(e,t)=>{if(e)try{const s=t?"Unverify":"Mark as Verified";i.Ay.loading({content:"".concat(s,"..."),key:"verify"}),await(await Promise.resolve().then(n.bind(n,31694))).verificationAPI.verifyUser(e,!t),i.Ay.success({content:"".concat(s," succeeded"),key:"verify",duration:2}),await oe(),q&&q._id===e&&B(e=>e?(0,a.A)((0,a.A)({},e),{},{verified:!t}):e)}catch(s){console.error("Failed to toggle verified",s),i.Ay.error("Failed to update verification status")}})(t._id,!!t.verified)}})},children:t.verified?"Unverify":"Verify"},"toggleVerified"),(0,j.jsx)(Ue.A.Item,{icon:(0,j.jsx)(bn.A,{}),onClick:async()=>{t&&t._id?fe.A.confirm({title:"Disable user",content:"Are you sure you want to disable ".concat(t.fullName||t.email||t._id,"?"),onOk:async()=>{await de(t._id)}}):i.Ay.error("No user selected")},children:"Disable"},"disable_now"),"staff"===t.role&&(0,j.jsx)(Ue.A.Item,{icon:(0,j.jsx)(wn.A,{}),onClick:async()=>{t&&t._id?fe.A.confirm({title:"Demote user",content:"Are you sure you want to demote ".concat(t.fullName||t.email||t._id," to resident?"),onOk:async()=>{await ue(t._id)}}):i.Ay.error("No user selected")},children:"Demote to Resident"},"demote"),(0,j.jsx)(Ue.A.Item,{icon:(0,j.jsx)(Ie.A,{}),onClick:async()=>{t&&t._id?fe.A.confirm({title:"Enable user",content:"Are you sure you want to enable ".concat(t.fullName||t.email||t._id,"?"),onOk:async()=>{await ce(t._id)}}):i.Ay.error("No user selected")},children:"Enable"},"enable_now"),(0,j.jsx)(Ue.A.Item,{icon:(0,j.jsx)(X.A,{}),danger:!0,onClick:()=>{},children:"Delete"},"delete")]}),trigger:["click"],children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(In.A,{}),size:"small"})})}],pe=_.length>0&&(0,j.jsxs)(Oe.A,{style:{marginBottom:16},children:[(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(Ie.A,{}),onClick:()=>{},children:"Activate"}),(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(bn.A,{}),onClick:()=>{},children:"Deactivate"}),(0,j.jsx)(yn.A,{title:"Are you sure to delete selected users?",onConfirm:()=>{},okText:"Yes",cancelText:"No",children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(X.A,{}),danger:!0,children:"Delete"})}),(0,j.jsx)("span",{style:{marginLeft:8},children:"Selected ".concat(_.length," users")})]}),xe=(C-1)*N+1,ye=Math.min(C*N,he.length);return(0,j.jsxs)("div",{children:[(0,j.jsx)(r.A,{style:{marginBottom:16,borderRadius:8,background:"#fff"},bodyStyle:{padding:0},bordered:!1,title:(0,j.jsxs)(l.A,{align:"middle",justify:"space-between",children:[(0,j.jsxs)(o.A,{children:[(0,j.jsx)(h.A.Title,{level:4,style:{margin:0},children:"User Management"}),(0,j.jsxs)(An.A,{children:[(0,j.jsx)(An.A.Item,{children:"Admin"}),(0,j.jsx)(An.A.Item,{children:"User Management"})]})]}),(0,j.jsx)(o.A,{children:(0,j.jsx)(Oe.A,{})})]})}),(0,j.jsxs)(r.A,{style:{borderRadius:16,boxShadow:"0 2px 16px #40c9ff11"},children:[(0,j.jsxs)(l.A,{gutter:16,style:{marginBottom:16},align:"middle",children:[(0,j.jsx)(o.A,{children:(0,j.jsx)(c.A.Search,{placeholder:"Search by name or email",value:m,onChange:e=>x(e.target.value),allowClear:!0,style:{width:200}})}),(0,j.jsx)(o.A,{children:(0,j.jsx)(d.A,{placeholder:"Role",allowClear:!0,style:{width:120},value:g,onChange:y,options:kn})}),(0,j.jsx)(o.A,{children:(0,j.jsx)(d.A,{placeholder:"Status",allowClear:!0,style:{width:120},value:v,onChange:w,options:Nn})}),(0,j.jsx)(o.A,{children:(0,j.jsx)(jn.A.RangePicker,{value:I,onChange:S,style:{width:220},allowClear:!0})}),(0,j.jsx)(o.A,{children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(wn.A,{}),onClick:()=>{x(""),y(void 0),w(void 0),S(null)},children:"Reset Filters"})})]}),pe,se?(0,j.jsx)(p.A,{size:"large"}):(0,j.jsx)(zt.A,{columns:me,dataSource:he,rowSelection:{selectedRowKeys:_,onChange:P},pagination:{pageSize:N,current:C,onChange:k,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onShowSizeChange:(e,t)=>T(t),showTotal:e=>"Showing ".concat(xe,"\u2013").concat(ye," of ").concat(e," users")},onRow:e=>({onClick:()=>{B(e),R(!0),(async e=>{if(e){z(!0);try{const t=e.barangayId||e.barangayID||e.barangay_id;if(t){const e=await A.adminAPI.getResidentByBarangayID(t);U((null===e||void 0===e?void 0:e.resident)||null)}else if(e._id){const t=await A.adminAPI.getUserWithResident(e._id);U((null===t||void 0===t?void 0:t.resident)||null)}else U(null)}catch(t){console.error("Failed to fetch resident for user",t),U(null)}finally{z(!1)}}})(e)}}),style:{cursor:"pointer"},scroll:{x:"max-content"},sticky:!0})]}),(0,j.jsx)($t.A,{title:q?q.fullName:"User Profile",open:D,onClose:()=>R(!1),width:400,children:q&&(0,j.jsxs)(Oe.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,j.jsxs)(l.A,{align:"middle",gutter:16,children:[(0,j.jsx)(o.A,{children:(()=>{let e=q;try{const t=localStorage.getItem("userProfile");t&&(e=JSON.parse(t))}catch(n){}const t=L&&(L.profileImage||L.profileImageId)?L.profileImage?L.profileImage:(0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(L.profileImageId)):q.avatar||null;return(0,j.jsx)(b,{size:64,style:{backgroundColor:"#1890ff"},src:t,user:e,children:q.fullName&&q.fullName.length>0?q.fullName.charAt(0).toUpperCase():"?"})})()}),(0,j.jsxs)(o.A,{children:[(0,j.jsx)(h.A.Title,{level:5,style:{margin:0},children:q.fullName}),(0,j.jsxs)("div",{style:{marginTop:4},children:[(0,j.jsx)(f.A,{color:q.isActive?"green":"red",style:{marginRight:8},children:q.isActive?"Active":"Inactive"}),(0,j.jsx)(f.A,{color:q.verified?"green":"default",style:{marginRight:8},children:q.verified?"Verified":"Unverified"}),(0,j.jsx)(f.A,{color:"admin"===q.role?"magenta":"staff"===q.role?"blue":"green",children:q.role?q.role.charAt(0).toUpperCase()+q.role.slice(1):""})]}),q.barangayId&&(0,j.jsxs)("div",{style:{marginTop:8},children:[(0,j.jsx)(h.A.Text,{type:"secondary",children:"Barangay ID: "}),(0,j.jsx)(h.A.Text,{copyable:!0,children:q.barangayId})]})]})]}),(0,j.jsx)(h.A.Text,{strong:!0,children:"Email:"}),(0,j.jsx)(h.A.Text,{children:q.email}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Resident Information"}),O?(0,j.jsx)(p.A,{}):L?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(h.A.Title,{level:5,children:"Personal Information"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Full Name:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:"".concat(L.firstName||""," ").concat(L.middleName||""," ").concat(L.lastName||"").trim()||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Barangay ID:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.barangayID||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Username:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.username||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Email:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.email||q.email||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Phone:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.contactNumber||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Landline:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.landlineNumber||"N/A"})]}),(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Address:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.address||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"DOB:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.birthDate?Cn()(L.birthDate).format("YYYY-MM-DD"):L.birthDate||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Sex/Gender:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.sex||L.gender||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Civil/Marital Status:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.civilStatus||L.maritalStatus||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Nationality:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.nationality||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Occupation:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.occupation||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Education:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.educationalAttainment||"N/A"})]})]}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Identification"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Passport #:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.passportNumber||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Gov ID #:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.governmentIdNumber||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"TIN:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.tin||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Barangay Clearance #:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.barangayClearanceNumber||"N/A"})]})]}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Family"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Spouse:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.spouseName?"".concat(L.spouseName," ").concat(L.spouseLastName||""):"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Number of Children:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.numberOfChildren||0===L.numberOfChildren?L.numberOfChildren:"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Children Names/Ages:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.childrenNames?"".concat(L.childrenNames," (").concat(L.childrenAges||"",")"):"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Mother:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.motherName||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Father:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.fatherName||"N/A"})]})]}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Emergency Contact"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Contact Name:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.emergencyContactName||L.emergencyContact||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Relationship:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.emergencyContactRelationship||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Emergency Phone:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.emergencyContact||L.spouseContactNumber||"N/A"})]})]}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Business / Employment"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Business Name:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.businessName||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Business Type:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.businessType||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Business Contact:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.businessContactNumber||"N/A"})]}),(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Business Address:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.businessAddress||"N/A"})]})]}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Other"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Blood Type:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.bloodType||"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Disability Status:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.disabilityStatus||"N/A"})]})]}),(0,j.jsxs)(l.A,{style:{marginTop:12},gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Created At:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.createdAt?Cn()(L.createdAt).format("YYYY-MM-DD HH:mm"):"N/A"})]}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Last Login:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:q.lastLogin?Cn()(q.lastLogin).format("YYYY-MM-DD HH:mm"):"N/A"})]})]}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Social Media / Links"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Facebook:"}),L.facebook?(0,j.jsx)(h.A.Text,{style:{display:"block"},children:(0,j.jsx)("a",{href:L.facebook,target:"_blank",rel:"noreferrer",children:L.facebook})}):(0,j.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Instagram:"}),L.instagram?(0,j.jsx)(h.A.Text,{style:{display:"block"},children:(0,j.jsx)("a",{href:L.instagram,target:"_blank",rel:"noreferrer",children:L.instagram})}):(0,j.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Other Link:"}),(0,j.jsx)(h.A.Text,{style:{display:"block"},children:L.website||"N/A"})]})]})]}):(0,j.jsx)(h.A.Text,{type:"warning",children:"This resident doesn't have resident info yet."}),(0,j.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Social Media"}),(0,j.jsxs)(l.A,{gutter:[8,8],children:[(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Facebook:"}),q.facebook?(0,j.jsx)(h.A.Text,{style:{display:"block"},children:(0,j.jsx)("a",{href:q.facebook,target:"_blank",rel:"noreferrer",children:q.facebook})}):(0,j.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Twitter:"}),q.twitter?(0,j.jsx)(h.A.Text,{style:{display:"block"},children:(0,j.jsx)("a",{href:q.twitter,target:"_blank",rel:"noreferrer",children:q.twitter})}):(0,j.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,j.jsxs)(o.A,{span:24,children:[(0,j.jsx)(h.A.Text,{strong:!0,children:"Instagram:"}),q.instagram?(0,j.jsx)(h.A.Text,{style:{display:"block"},children:(0,j.jsx)("a",{href:q.instagram,target:"_blank",rel:"noreferrer",children:q.instagram})}):(0,j.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]})]}),(0,j.jsxs)("div",{style:{marginTop:16,display:"flex",flexDirection:"column",gap:8},children:[(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(vn.A,{}),onClick:()=>{G(q||{}),H(!0)},children:"Edit User"}),(0,j.jsx)(u.Ay,{onClick:()=>{L?(le(L||{}),W(!0)):i.Ay.warning("No resident data to edit")},children:"Edit Resident"})]}),(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(u.Ay,{icon:(0,j.jsx)($.A,{}),onClick:()=>{},children:"View Logs"}),q&&"staff"===q.role&&(0,j.jsx)(yn.A,{title:"Demote ".concat(q.fullName||q.email,"?"),onConfirm:async()=>{q&&await ue(q._id)},okText:"Yes",cancelText:"No",children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(wn.A,{}),children:"Demote"})}),q&&q.isActive?(0,j.jsx)(yn.A,{title:"Disable ".concat(q.fullName||q.email,"?"),onConfirm:async()=>{await de(q._id)},okText:"Yes",cancelText:"No",children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(bn.A,{}),danger:!0,children:"Deactivate"})}):(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(Ie.A,{}),onClick:async()=>{q&&await ce(q._id)},children:"Enable"})]})]})]})}),(0,j.jsx)(fe.A,{title:"Edit Resident",open:M,onCancel:()=>W(!1),onOk:async()=>{if(L)try{const e=(0,a.A)((0,a.A)({},L),re),t=await A.adminAPI.updateResident(L._id,e);i.Ay.success("Resident updated"),U((null===t||void 0===t?void 0:t.resident)||(0,a.A)((0,a.A)({},L),e)),W(!1)}catch(e){console.error("Failed to save resident",e),i.Ay.error("Failed to update resident.")}},width:900,children:(0,j.jsx)(dt.A,{layout:"vertical",initialValues:(0,a.A)((0,a.A)({},L||{}),{},{barangayID:(null===L||void 0===L?void 0:L.barangayID)||(null===q||void 0===q?void 0:q.barangayId)}),onValuesChange:(e,t)=>le(t),children:(0,j.jsxs)(ge.A,{defaultActiveKey:"personal",children:[(0,j.jsxs)(ge.A.TabPane,{tab:"Personal",children:[(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"firstName",label:"First Name",rules:[{required:!0,message:"First name is required"}],children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"middleName",label:"Middle Name",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"lastName",label:"Last Name",rules:[{required:!0,message:"Last name is required"}],children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"username",label:"Username",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"barangayID",label:"Barangay ID",rules:[{required:!0,message:"Barangay ID is required"}],children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Enter a valid email"}],children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"contactNumber",label:"Contact Number",rules:[{pattern:/^[0-9+\-() ]{6,20}$/,message:"Enter a valid phone number"}],children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"landlineNumber",label:"Landline",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"address",label:"Address",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"birthDate",label:"Birth Date",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"placeOfBirth",label:"Place of Birth",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"age",label:"Age",children:(0,j.jsx)(c.A,{type:"number"})})})]})]},"personal"),(0,j.jsxs)(ge.A.TabPane,{tab:"IDs",children:[(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"passportNumber",label:"Passport #",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"governmentIdNumber",label:"Government ID #",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"tin",label:"TIN",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"bloodType",label:"Blood Type",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"disabilityStatus",label:"Disability Status",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"educationalAttainment",label:"Education",children:(0,j.jsx)(c.A,{})})})]})]},"ids"),(0,j.jsxs)(ge.A.TabPane,{tab:"Family",children:[(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"spouseName",label:"Spouse Name",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"spouseMiddleName",label:"Spouse Middle",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"spouseLastName",label:"Spouse Last",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"spouseAge",label:"Spouse Age",children:(0,j.jsx)(c.A,{type:"number"})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"spouseBirthDate",label:"Spouse DOB",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"spouseOccupation",label:"Spouse Occupation",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"numberOfChildren",label:"# Children",children:(0,j.jsx)(c.A,{type:"number"})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"childrenNames",label:"Children Names",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"childrenAges",label:"Children Ages",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{name:"motherName",label:"Mother's Name",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{name:"fatherName",label:"Father's Name",children:(0,j.jsx)(c.A,{})})})]})]},"family"),(0,j.jsxs)(ge.A.TabPane,{tab:"Business",children:[(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{name:"businessName",label:"Business Name",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{name:"businessType",label:"Business Type",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{name:"businessContactNumber",label:"Business Contact",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{name:"businessEmail",label:"Business Email",children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsx)(l.A,{gutter:8,children:(0,j.jsx)(o.A,{span:24,children:(0,j.jsx)(dt.A.Item,{name:"businessAddress",label:"Business Address",children:(0,j.jsx)(c.A,{})})})}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"registrationNumber",label:"Registration #",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"businessPermitNumber",label:"Business Permit #",children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{name:"barangayClearanceNumber",label:"Barangay Clearance #",children:(0,j.jsx)(c.A,{})})})]})]},"business"),(0,j.jsx)(ge.A.TabPane,{tab:"Avatar / Media",children:(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsxs)(dt.A.Item,{label:"Upload Profile Image",children:[(0,j.jsx)(Z.A,{accept:"image/*",showUploadList:!1,beforeUpload:()=>!1,customRequest:e=>{if(!L)return;const t=e.file;J(!0),ee(10);const n=(async()=>{try{ee(30);const e=await A.adminAPI.uploadResidentAvatar(L._id,t);return ee(80),null!==e&&void 0!==e&&e.resident?(U(e.resident),le(t=>(0,a.A)((0,a.A)({},t),{},{profileImage:e.resident.profileImage,profileImageId:e.resident.profileImageId})),ne(e.resident.profileImage||"".concat((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.fileId)),"?t=").concat(Date.now()))):null!==e&&void 0!==e&&e.fileId&&(le(t=>(0,a.A)((0,a.A)({},t),{},{profileImage:(0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.fileId)),profileImageId:e.fileId})),ne("".concat((0,A.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.fileId)),"?t=").concat(Date.now()))),ee(100),i.Ay.success("Avatar uploaded"),e}catch(e){throw console.error("Avatar upload failed",e),i.Ay.error((null===e||void 0===e?void 0:e.message)||"Avatar upload failed"),e}finally{J(!1)}})();return ae.current=n,n},children:(0,j.jsx)(u.Ay,{type:"default",children:"Choose Image"})}),K&&(0,j.jsxs)("div",{style:{marginTop:8},children:["Uploading: ",Q,"%"]}),te&&(0,j.jsx)("div",{style:{marginTop:8},children:(0,j.jsx)("img",{src:"string"!==typeof te||te.startsWith("http")?te:(0,A.getAbsoluteApiUrl)(te),alt:"preview",style:{maxWidth:120,maxHeight:120,borderRadius:6}})})]})}),(0,j.jsxs)(o.A,{span:12,children:[(0,j.jsx)(dt.A.Item,{name:"profileImage",label:"Profile Image URL",children:(0,j.jsx)(c.A,{})}),(0,j.jsx)(dt.A.Item,{name:"profileImageId",label:"Profile Image ID",children:(0,j.jsx)(c.A,{})})]})]})},"media")]})})}),(0,j.jsx)(fe.A,{title:"Edit User",open:Y,onCancel:()=>H(!1),onOk:async()=>{try{const n=(0,a.A)({},V);delete n.barangayId,delete n.role,await A.adminAPI.updateUser(q._id,n),i.Ay.success("User updated");const s=e.map(e=>e._id===q._id?(0,a.A)((0,a.A)({},e),n):e);t(s),B(e=>e?(0,a.A)((0,a.A)({},e),n):e),H(!1)}catch(n){console.error("Failed to update user",n),i.Ay.error("Failed to update user")}},width:600,children:(0,j.jsxs)(dt.A,{layout:"vertical",initialValues:V,onValuesChange:(e,t)=>G(t),children:[(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{name:"fullName",label:"Full Name",rules:[{required:!0,message:"Full name required"}],children:(0,j.jsx)(c.A,{})})}),(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Enter a valid email"}],children:(0,j.jsx)(c.A,{})})})]}),(0,j.jsxs)(l.A,{gutter:8,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{name:"isActive",label:"Active",children:(0,j.jsx)(d.A,{options:[{label:"Active",value:!0},{label:"Inactive",value:!1}]})})}),(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{label:"Role",children:(0,j.jsx)(c.A,{value:null===q||void 0===q?void 0:q.role,disabled:!0})})})]}),(0,j.jsx)(l.A,{gutter:8,children:(0,j.jsx)(o.A,{span:24,children:(0,j.jsx)(dt.A.Item,{label:"Barangay ID",children:(0,j.jsx)(c.A,{value:(null===q||void 0===q?void 0:q.barangayId)||(null===q||void 0===q?void 0:q.barangayID)||"",disabled:!0})})})})]})})]})},_n=()=>(0,j.jsxs)("div",{style:{padding:20},children:[(0,j.jsx)("h3",{children:"Activity Logs Disabled"}),(0,j.jsx)("p",{children:"The Activity Logs feature has been temporarily disabled in the system."})]});var Pn=n(7650),Dn=n(12624),Rn=n(40426),qn=n(44811),Bn=n(45725),Ln=n(16026),Un=n(63248),On=n(62370),zn=n(94913),Fn=n(21218),En=n(31693),Mn=n(6396);const{RangePicker:Wn}=jn.A,{Option:Yn}=d.A,Hn={gender:{title:"Sex Distribution",chartType:"pie",endpoint:"/analytics/gender",colors:["#1890ff","#00bcd4","#888888"]},age:{title:"Age Groups",chartType:"bar",endpoint:"/analytics/age",colors:["#1890ff"]},"civil-status":{title:"Civil Status",chartType:"bar",endpoint:"/analytics/civil-status",colors:["#1890ff"]},education:{title:"Education",chartType:"bar",endpoint:"/analytics/education",colors:["#13c2c2"]},"documents-monthly":{title:"Monthly Document Requests",chartType:"line",endpoint:"/analytics/documents-monthly",colors:["#722ed1"]}},Vn=Object.keys(Hn),Gn=new Bn.E({defaultOptions:{queries:{retry:2,staleTime:6e4,refetchOnWindowFocus:!1}}}),Kn=()=>{var e,t,c,p,x;const[g,f]=(0,s.useState)(!0),[y,v]=(0,s.useState)(null),[b,w]=(0,s.useState)({}),[I,S]=(0,s.useState)({}),[C,k]=(0,s.useState)({dateRange:[],residentType:""}),[N,T]=(0,s.useState)(["gender","age","occupation","education","civil-status"]),[_,P]=(0,s.useState)(!1),D=(0,s.useRef)(null),[R,q]=(0,s.useState)(!1),[B,L]=(0,s.useState)(()=>{try{const e=localStorage.getItem("statsChartSettings");return e?JSON.parse(e):{}}catch(e){return{}}}),[U,O]=(0,s.useState)("gender"),[z,F]=(0,s.useState)(!1),[E,M]=(0,s.useState)(N),W=(0,s.useCallback)(async()=>{f(!0);try{var e,t,n,a,s,i;const r=await A.axiosInstance.get("/analytics/summary",{params:{startDate:null===(e=C.dateRange)||void 0===e||null===(t=e[0])||void 0===t||null===(n=t.format)||void 0===n?void 0:n.call(t,"YYYY-MM-DD"),endDate:null===(a=C.dateRange)||void 0===a||null===(s=a[1])||void 0===s||null===(i=s.format)||void 0===i?void 0:i.call(s,"YYYY-MM-DD"),residentType:C.residentType}});v(r.data||null)}catch(r){v(null)}finally{f(!1)}},[C]);(0,s.useEffect)(()=>{W()},[W]);const Y=(0,s.useCallback)(async e=>{const t=Hn[e];if(t){S(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!0}));try{var n,s,i,r,l,o,d,c,u,h,m,p,x;const g=B[e]||{},f=(null===(n=g.dateRange)||void 0===n||null===(s=n[0])||void 0===s||null===(i=s.format)||void 0===i?void 0:i.call(s,"YYYY-MM-DD"))||(null===(r=C.dateRange)||void 0===r||null===(l=r[0])||void 0===l||null===(o=l.format)||void 0===o?void 0:o.call(l,"YYYY-MM-DD")),y=(null===(d=g.dateRange)||void 0===d||null===(c=d[1])||void 0===c||null===(u=c.format)||void 0===u?void 0:u.call(c,"YYYY-MM-DD"))||(null===(h=C.dateRange)||void 0===h||null===(m=h[1])||void 0===m||null===(p=m.format)||void 0===p?void 0:p.call(m,"YYYY-MM-DD"));let j=(null===(x=(await A.axiosInstance.get(t.endpoint,{params:{startDate:f,endDate:y}})).data)||void 0===x?void 0:x.data)||[];"gender"===e&&(j=j.map(e=>{var t,n,a;return{type:null!==(t=null!==(n=e.name)&&void 0!==n?n:e.type)&&void 0!==t?t:"N/A",value:null!==(a=e.value)&&void 0!==a?a:0}})),w(t=>(0,a.A)((0,a.A)({},t),{},{[e]:j}))}catch(g){console.error("Error fetching chart",e,g),w(t=>(0,a.A)((0,a.A)({},t),{},{[e]:[]}))}finally{S(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!1}))}}},[C,B]);(0,s.useEffect)(()=>{try{localStorage.setItem("statsChartSettings",JSON.stringify(B))}catch(e){}},[B]);const H=null!==(e=null===y||void 0===y?void 0:y.totalResidents)&&void 0!==e?e:0,V=null!==(t=null===y||void 0===y?void 0:y.totalDocumentRequests)&&void 0!==t?t:0,G=b.age||[],K=G&&G.length?Math.max(...G.map(e=>Number(e.value)||0)):0,J=5*Math.ceil(K/5)||5,Z=b["documents-monthly"]||[],$=e=>{var t,n,a;let{id:s,title:i,chartType:l,data:o=[],loading:d,colors:c}=e;const u=Array.isArray(o)&&o.length>0,h=s&&B[s]||{},m=h.chartType||l,p=null===(t=h.showLabels)||void 0===t||t,x=null===(n=h.showTooltips)||void 0===n||n,g=null===(a=h.showLegend)||void 0===a||a;return(0,j.jsx)(r.A,{title:i,style:{borderRadius:12,boxShadow:"0 8px 24px rgba(15,15,15,0.06)"},styles:{body:{padding:16}},children:d?(0,j.jsx)(Pn.A,{active:!0}):u?"pie"===m?(0,j.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(()=>{const e=(o||[]).map(e=>{var t,n,a,s,i,r;return{label:(null!==(t=null!==(n=null!==(a=null!==(s=null===e||void 0===e?void 0:e.type)&&void 0!==s?s:null===e||void 0===e?void 0:e.name)&&void 0!==a?a:null===e||void 0===e?void 0:e.group)&&void 0!==n?n:null===e||void 0===e?void 0:e._id)&&void 0!==t?t:"Unknown").toString().trim(),valueNumber:Number(null!==(i=null!==(r=null===e||void 0===e?void 0:e.value)&&void 0!==r?r:null===e||void 0===e?void 0:e.count)&&void 0!==i?i:0)}});return(0,j.jsx)(On.A,{data:e,angleField:"valueNumber",colorField:"label",radius:.9,label:!!p&&{formatter:e=>{var t,n,a,s,i;const r=(null===e||void 0===e?void 0:e.data)||e||{},l=null!==(t=null!==(n=null===r||void 0===r?void 0:r.label)&&void 0!==n?n:null===r||void 0===r?void 0:r.type)&&void 0!==t?t:"Unknown",o=Number(null!==(a=null!==(s=null!==(i=null===r||void 0===r?void 0:r.valueNumber)&&void 0!==i?i:null===r||void 0===r?void 0:r.value)&&void 0!==s?s:null===r||void 0===r?void 0:r.count)&&void 0!==a?a:0)||0;return"".concat(l," (").concat(o,")")}},tooltip:!!x&&{formatter:e=>{var t,n,a,s,i;const r=(null===e||void 0===e?void 0:e.data)||e||{};return{name:null!==(t=null!==(n=null===r||void 0===r?void 0:r.label)&&void 0!==n?n:null===r||void 0===r?void 0:r.type)&&void 0!==t?t:"Unknown",value:Number(null!==(a=null!==(s=null!==(i=null===r||void 0===r?void 0:r.valueNumber)&&void 0!==i?i:null===r||void 0===r?void 0:r.value)&&void 0!==s?s:null===r||void 0===r?void 0:r.count)&&void 0!==a?a:0)||0}}},color:c,statistic:{title:{formatter:()=>i},content:{formatter:()=>"".concat((e||[]).reduce((e,t)=>e+(Number(t.valueNumber)||0),0)," total")}},legend:!!g&&{position:"bottom",formatter:t=>{const n=(e||[]).find(e=>e.label===t),a=n?Number(n.valueNumber||0):0;return"".concat(t," (").concat(a,")")}},height:220})})()}):"bar"===m?(0,j.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(0,j.jsx)(zn.A,{data:o,xField:"type",yField:"value",color:c&&c[0],label:!!p&&void 0,legend:!!g&&void 0,tooltip:!!x&&void 0,yAxis:{min:0,max:J,tickInterval:5},height:220})}):"line"===m?(0,j.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(0,j.jsx)(Fn.A,{data:o,xField:"type",yField:"value",legend:!!g&&void 0,tooltip:!!x&&void 0,height:220})}):(0,j.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(0,j.jsx)(En.A,{data:o,xField:"type",yField:"value",legend:!!g&&void 0,tooltip:!!x&&void 0,height:220})}):(0,j.jsx)(Zt.A,{description:"No data"})})},Q=(0,s.useRef)({}),X=(0,s.useRef)(null),ee=Object.keys(Hn),te=(0,Ln.E)({queries:ee.map(e=>{var t,n,a,s,i,r,l,o,d,c,u,h,m,p;return{queryKey:["chart",e,(null===(t=C.dateRange)||void 0===t||null===(n=t[0])||void 0===n||null===(a=n.format)||void 0===a?void 0:a.call(n,"YYYY-MM-DD"))||null,(null===(s=C.dateRange)||void 0===s||null===(i=s[1])||void 0===i||null===(r=i.format)||void 0===r?void 0:r.call(i,"YYYY-MM-DD"))||null,(null===(l=B[e])||void 0===l||null===(o=l.dateRange)||void 0===o||null===(d=o[0])||void 0===d||null===(c=d.format)||void 0===c?void 0:c.call(d,"YYYY-MM-DD"))||null,(null===(u=B[e])||void 0===u||null===(h=u.dateRange)||void 0===h||null===(m=h[1])||void 0===m||null===(p=m.format)||void 0===p?void 0:p.call(m,"YYYY-MM-DD"))||null,C.residentType||null],queryFn:async()=>{var t,n,a,s,i,r,l,o,d,c,u,h,m;const p=B[e]||{},x=(null===(t=p.dateRange)||void 0===t||null===(n=t[0])||void 0===n||null===(a=n.format)||void 0===a?void 0:a.call(n,"YYYY-MM-DD"))||(null===(s=C.dateRange)||void 0===s||null===(i=s[0])||void 0===i||null===(r=i.format)||void 0===r?void 0:r.call(i,"YYYY-MM-DD")),g=(null===(l=p.dateRange)||void 0===l||null===(o=l[1])||void 0===o||null===(d=o.format)||void 0===d?void 0:d.call(o,"YYYY-MM-DD"))||(null===(c=C.dateRange)||void 0===c||null===(u=c[1])||void 0===u||null===(h=u.format)||void 0===h?void 0:h.call(u,"YYYY-MM-DD"));return(null===(m=(await A.axiosInstance.get(Hn[e].endpoint,{params:{startDate:x,endDate:g,residentType:C.residentType}})).data)||void 0===m?void 0:m.data)||[]},retry:2}})}),ne=te.map(e=>JSON.stringify((null===e||void 0===e?void 0:e.data)||"")).join("|"),ae=(0,s.useMemo)(()=>{const e={};return Vn.forEach((t,n)=>{e[t]=te[n]}),e},[ne]);(0,s.useEffect)(()=>{const e={},t={};ee.forEach(n=>{const s=ae[n];"gender"===n&&console.debug("chart query gender raw data:",null===s||void 0===s?void 0:s.data),e[n]="gender"===n?((null===s||void 0===s?void 0:s.data)||[]).map(e=>{var t,n,a,s,i;const r=((null!==(t=null!==(n=null!==(a=null===e||void 0===e?void 0:e.name)&&void 0!==a?a:null===e||void 0===e?void 0:e.type)&&void 0!==n?n:null===e||void 0===e?void 0:e._id)&&void 0!==t?t:"").toString().trim()||"").toLowerCase();let l="Other";return/^m/.test(r)?l="Male":/^f/.test(r)&&(l="Female"),{type:l,value:Number(null!==(s=null!==(i=null===e||void 0===e?void 0:e.value)&&void 0!==i?i:null===e||void 0===e?void 0:e.count)&&void 0!==s?s:0)}}).reduce((e,t)=>{const n=e.find(e=>e.type===t.type);return n?n.value+=t.value:e.push((0,a.A)({},t)),e},[]):(null===s||void 0===s?void 0:s.data)||[],t[n]=(null===s||void 0===s?void 0:s.isFetching)||(null===s||void 0===s?void 0:s.isLoading)||!1}),w(e),S(t)},[ne,ae]),(0,s.useEffect)(()=>{N&&N.length&&N.forEach(e=>{var t;return(null===(t=ae[e])||void 0===t?void 0:t.refetch)&&ae[e].refetch()})},[N,ae]);const se=(0,s.useMemo)(()=>{const e=Object.keys(b||{}).filter(e=>Array.isArray(b[e])&&b[e].length>0);return new Set(e)},[b]);(0,s.useEffect)(()=>{if(_){D.current=N;const e=Array.from(se),t=Vn.filter(t=>e.includes(t)).slice(0,6);t.length&&T(t)}else D.current&&(T(D.current),D.current=null)},[_,se]);const[ie,re]=(0,s.useState)(!1),[le,oe]=(0,s.useState)(""),[de,ce]=(0,s.useState)(()=>"undefined"!==typeof window&&window.innerWidth<700);(0,s.useEffect)(()=>{const e=()=>ce(window.innerWidth<700);try{window.addEventListener("resize",e)}catch(t){}return()=>{try{window.removeEventListener("resize",e)}catch(t){}}},[]);return(0,j.jsx)(r.A,{title:(0,j.jsx)(h.A.Title,{level:4,style:{margin:0},children:"Statistics & Analytics"}),style:{borderRadius:16,boxShadow:"0 2px 16px #40c9ff11"},styles:{body:{padding:24}},children:(0,j.jsxs)("div",{ref:X,style:{background:"#ffffff",padding:8},children:[(0,j.jsxs)(dt.A,{layout:de?"vertical":"inline",style:{marginBottom:24,width:"100%",boxSizing:"border-box"},children:[(0,j.jsx)(dt.A.Item,{label:"Date Range",children:(0,j.jsx)(Wn,{value:C.dateRange,onChange:e=>k(t=>(0,a.A)((0,a.A)({},t),{},{dateRange:e?e.filter(Boolean):[]})),allowClear:!0})}),(0,j.jsx)(dt.A.Item,{label:"Resident Type",children:(0,j.jsxs)(d.A,{value:C.residentType,onChange:e=>k(t=>(0,a.A)((0,a.A)({},t),{},{residentType:e})),style:{minWidth:140},allowClear:!0,placeholder:"All Types",children:[(0,j.jsx)(Yn,{value:"",children:"All"}),(0,j.jsx)(Yn,{value:"active",children:"Active"}),(0,j.jsx)(Yn,{value:"inactive",children:"Inactive"})]})}),(0,j.jsx)(dt.A.Item,{label:"Charts",children:(0,j.jsx)(ze.A,{open:z,onOpenChange:e=>{M(N.slice()),F(e)},popupRender:()=>(0,j.jsxs)("div",{style:{padding:12,background:"#fff",borderRadius:8,boxShadow:"0 6px 20px rgba(0,0,0,0.08)",minWidth:340},children:[(0,j.jsx)("div",{style:{maxHeight:260,overflowY:"auto",paddingRight:8},onWheel:e=>{},children:(0,j.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Object.keys(Hn).map(e=>{const t=(E||[]).includes(e);return(0,j.jsx)(Ft.A,{checked:t,onChange:t=>{const n=new Set(E||[]);t.target.checked?n.add(e):n.delete(e),M(Array.from(n))},children:(0,j.jsx)("span",{style:{fontSize:13},children:Hn[e].title})},e)})})}),(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[(0,j.jsx)(u.Ay,{size:"small",onClick:()=>{M(N.slice()),F(!1)},children:"Cancel"}),(0,j.jsx)(u.Ay,{size:"small",type:"primary",onClick:()=>{T(E.slice()),F(!1)},children:"Apply"})]})]}),trigger:["click"],children:(0,j.jsxs)(u.Ay,{children:["Charts ",(0,j.jsx)(qn.A,{})]})})}),(0,j.jsx)(dt.A.Item,{style:{width:"100%",boxSizing:"border-box"},children:(0,j.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center",width:"100%",boxSizing:"border-box"},children:[(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:200},children:[(0,j.jsx)(Dn.A,{checked:_,onChange:e=>P(!!e)}),(0,j.jsx)("span",{style:{fontSize:13},children:"Enable when data exists"})]}),(0,j.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",flex:de?"0 0 100%":"0 1 auto",alignItems:"center",width:de?"100%":void 0,boxSizing:"border-box",paddingRight:8},children:[(0,j.jsx)(u.Ay,{onClick:()=>{q(!0),O(N[0]||"gender")},block:de,style:de?{width:"100%",marginBottom:8}:void 0,children:"Chart Settings"}),(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>{const e=(e=>{var t,n,a;const s=e.summary||y||{},i=e.charts||b||{},r=Number(null!==(t=s.totalResidents)&&void 0!==t?t:0),l=i.gender||[],o=i.age||[],d=i["civil-status"]||[],c=i.education||[],u=i["documents-monthly"]||[],h=i.occupation||[],m=i.nationality||[],p=i.bloodType||[],x=i.disability||[],g=i.children||[],f=i.businessType||[],A=i.businessSize||[],j=i.incomeBrackets||[],v=Number((null===(n=l.find(e=>(e.type||"").toLowerCase().startsWith("m")))||void 0===n?void 0:n.value)||0),w=Number((null===(a=l.find(e=>(e.type||"").toLowerCase().startsWith("f")))||void 0===a?void 0:a.value)||0),I=Math.max(0,(l||[]).reduce((e,t)=>e+(Number(t.value)||0),0)-v-w);let S="";if(o.length){var C,k;const e=[...o].sort((e,t)=>(Number(t.value)||0)-(Number(e.value)||0));S=(null===(C=e[0])||void 0===C?void 0:C.type)||(null===(k=e[0])||void 0===k?void 0:k.group)||""}const N=d.length?d.slice(0,3).map(e=>"".concat(e.type," (").concat(e.value,")")).join(", "):"",T=c.length?c.slice(0,3).map(e=>"".concat(e.type," (").concat(e.value,")")).join(", "):"",_=u.length?u.reduce((e,t)=>e+(Number(t.value)||0),0):0;let P="",D=0;if(u.length){const e=u.reduce((e,t)=>(Number(t.value)||0)>(Number(e.value)||0)?t:e,u[0]);P=(null===e||void 0===e?void 0:e.type)||"",D=Number((null===e||void 0===e?void 0:e.value)||0)}const R=[];if(r>0){const e=v||w||I?"There are currently ".concat(r," residents, with ").concat(v," males, ").concat(w," females").concat(I?", and ".concat(I," identifying as other"):"","."):"There are currently ".concat(r," residents.");R.push(e)}else R.push("Resident count is not available.");if(S?R.push("The most common age group is ".concat(S,".")):o.length?R.push("Age distribution is available but no dominant age group could be determined."):R.push("Age distribution data is not available."),h.length){const e=h.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0)).slice(0,3).map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");R.push("Top occupations: ".concat(e,"."))}else R.push("Occupation distribution is not available.");if(m.length){const e=m.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0)).slice(0,3).map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");R.push("Nationality distribution (top): ".concat(e,"."))}if(N?R.push("Civil status (top): ".concat(N,".")):R.push("Civil status breakdown is not available."),p.length){const e=p.map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");R.push("Blood type breakdown: ".concat(e,"."))}if(x.length){const e=x.reduce((e,t)=>e+(Number(t.value)||0),0);R.push("Disability reported for ".concat(e," residents."))}if(T?R.push("Educational attainment (top): ".concat(T,".")):R.push("Educational attainment data is not available."),g.length){const e=g.reduce((e,t,n)=>e+(Number(t.value)||0)*(Number(t.type)||n),0)/Math.max(1,g.reduce((e,t)=>e+(Number(t.value)||0),0));R.push("Average reported children per household (approx): ".concat(Number(e).toFixed(2),"."))}if(u.length?R.push("During the selected period there were ".concat(_," document requests. The busiest month was ").concat(P," with ").concat(D," requests.")):R.push("Document request trends are not available for the selected period."),f.length){const e=f.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0)).slice(0,3).map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");R.push("Top business types: ".concat(e,"."))}if(A.length){const e=A.reduce((e,t)=>e+(Number(t.value)||0),0);R.push("Business size distribution available for ".concat(e," businesses."))}if(j.length){const e=j.reduce((e,t)=>e+(Number(t.value)||0),0),t=j.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0))[0];t&&R.push("Most residents fall into the ".concat(t.type||t.name," income bracket (").concat(t.value,"). Total reported incomes: ").concat(e,"."))}return R.join(" ")})({summary:y,charts:b});oe(e),re(!0)},block:de,style:de?{width:"100%",marginBottom:8}:void 0,children:"Generate Report"}),(0,j.jsx)(u.Ay,{onClick:async()=>{await(async()=>{if(X.current){i.Ay.loading({content:"Preparing full report...",key:"report"});try{const e=(await n.e(239).then(n.t.bind(n,65239,23))).default,t=X.current,a=(await e(t,{background:"#ffffff"})).toDataURL("image/png"),s=new Mn.Ay({unit:"pt",format:"a4",orientation:"portrait"}),r="Barangay Analytics Report";s.setFontSize(24),s.text(r,40,80),s.setFontSize(12),s.text("Generated: ".concat((new Date).toLocaleString()),40,110),s.addPage();const l=s.internal.pageSize.getWidth(),o=s.internal.pageSize.getHeight(),d=40,c=l-2*d,u=new Image;u.src=a,await new Promise(e=>u.onload=e);const h=c,m=u.height*h/u.width,p=u.height/m,x=o-2*d,g=Math.floor(x*p),f=document.createElement("canvas");f.width=u.width,f.height=u.height;const y=f.getContext("2d");if(!y)throw new Error("Canvas not supported");y.fillStyle="#ffffff",y.fillRect(0,0,f.width,f.height),y.drawImage(u,0,0);let A=0;for(;A<f.height;){const e=document.createElement("canvas");e.width=f.width,e.height=Math.min(g,f.height-A);const t=e.getContext("2d");if(!t)break;t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height),t.drawImage(f,0,A,e.width,e.height,0,0,e.width,e.height);const n=e.toDataURL("image/png"),a=e.height/p;s.addImage(n,"PNG",d,d,h,a),A+=g,A<f.height&&s.addPage()}s.save("barangay-analytics-report.pdf"),i.Ay.success({content:"Report ready",key:"report"})}catch(e){console.error("Full report export failed",e),i.Ay.error({content:"Failed to export full report (see console).",key:"report"})}}else i.Ay.error("Dashboard not available for capture")})()},block:de,style:de?{width:"100%"}:void 0,children:"Download Full Analytics"})]})]})})]}),(0,j.jsx)($t.A,{title:"Chart Settings",placement:"right",onClose:()=>q(!1),open:R,width:420,children:(0,j.jsxs)(dt.A,{layout:"vertical",children:[(0,j.jsx)(dt.A.Item,{label:"Select chart",children:(0,j.jsx)(d.A,{value:U,onChange:e=>O(e),children:Object.keys(Hn).map(e=>(0,j.jsx)(d.A.Option,{value:e,children:Hn[e].title},e))})}),(0,j.jsx)(dt.A.Item,{label:"Chart type",children:(0,j.jsxs)(d.A,{value:B[U]&&B[U].chartType||Hn[U].chartType,onChange:e=>L(t=>(0,a.A)((0,a.A)({},t),{},{[U]:(0,a.A)((0,a.A)({},t[U]||{}),{},{chartType:e})})),children:[(0,j.jsx)(d.A.Option,{value:"pie",children:"Pie"}),(0,j.jsx)(d.A.Option,{value:"bar",children:"Bar"}),(0,j.jsx)(d.A.Option,{value:"line",children:"Line"}),(0,j.jsx)(d.A.Option,{value:"area",children:"Area"})]})}),(0,j.jsx)(dt.A.Item,{label:"Date range for this chart",children:(0,j.jsx)(Wn,{value:B[U]&&B[U].dateRange||C.dateRange,onChange:e=>L(t=>(0,a.A)((0,a.A)({},t),{},{[U]:(0,a.A)((0,a.A)({},t[U]||{}),{},{dateRange:e?e.filter(Boolean):[]})})),allowClear:!0})}),(0,j.jsx)(dt.A.Item,{label:"Show labels",children:(0,j.jsx)(Dn.A,{checked:null===(c=B[U]&&B[U].showLabels)||void 0===c||c,onChange:e=>L(t=>(0,a.A)((0,a.A)({},t),{},{[U]:(0,a.A)((0,a.A)({},t[U]||{}),{},{showLabels:e})}))})}),(0,j.jsx)(dt.A.Item,{label:"Show tooltips",children:(0,j.jsx)(Dn.A,{checked:null===(p=B[U]&&B[U].showTooltips)||void 0===p||p,onChange:e=>L(t=>(0,a.A)((0,a.A)({},t),{},{[U]:(0,a.A)((0,a.A)({},t[U]||{}),{},{showTooltips:e})}))})}),(0,j.jsx)(dt.A.Item,{label:"Show legend",children:(0,j.jsx)(Dn.A,{checked:null===(x=B[U]&&B[U].showLegend)||void 0===x||x,onChange:e=>L(t=>(0,a.A)((0,a.A)({},t),{},{[U]:(0,a.A)((0,a.A)({},t[U]||{}),{},{showLegend:e})}))})}),(0,j.jsx)(dt.A.Item,{children:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>{q(!1),Y(U)},children:"Apply"}),(0,j.jsx)(u.Ay,{onClick:()=>{L(e=>(0,a.A)((0,a.A)({},e),{},{[U]:{}}))},children:"Reset"})]})})]})}),(0,j.jsx)(fe.A,{title:"Analytics Report",open:ie,onCancel:()=>re(!1),footer:[(0,j.jsx)(u.Ay,{onClick:async()=>{try{await navigator.clipboard.writeText(le),i.Ay.success("Report copied to clipboard")}catch(e){i.Ay.error("Failed to copy")}},children:"Copy"},"copy"),(0,j.jsx)(u.Ay,{type:"primary",onClick:async()=>{const e=new Mn.Ay({orientation:"portrait"});e.setFontSize(16),e.text("Analytics Report",14,20),e.setFontSize(11);const t=e.splitTextToSize(le,180);e.text(t,14,30);try{const a=(await n.e(239).then(n.t.bind(n,65239,23))).default;let s=40+6*t.length;for(const t of N){const n=Q.current[t];if(!n)continue;const i=await a(n,{background:"#ffffff"}),r=i.toDataURL("image/png"),l=i.width,o=i.height,d=e.internal.pageSize.getWidth()-28,c=o*d/l;s+c>e.internal.pageSize.getHeight()-20&&(e.addPage(),s=20),e.addImage(r,"PNG",14,s,d,c),s+=c+8}}catch(a){console.warn("html2canvas not available or capture failed, exporting text only",a),i.Ay.warning("Chart capture failed; exporting text-only PDF. To include images, install html2canvas.")}e.save("analytics-report.pdf")},children:"Download as PDF"},"download")],children:(0,j.jsx)(h.A.Paragraph,{children:le||"No data available for report."})}),(0,j.jsxs)(l.A,{gutter:[24,24],style:{marginBottom:24},children:[(0,j.jsx)(o.A,{xs:24,sm:12,md:8,children:(0,j.jsx)(r.A,{variant:"borderless",style:{borderRadius:12,boxShadow:"0 8px 20px rgba(15,15,15,0.04)",textAlign:"left"},styles:{body:{padding:16}},children:g?(0,j.jsx)(Pn.A,{active:!0,paragraph:!1}):(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12},children:"Total Residents"}),(0,j.jsx)(h.A.Title,{level:3,style:{margin:0},children:H})]})})}),(0,j.jsx)(o.A,{xs:24,sm:12,md:8,children:(0,j.jsx)(r.A,{variant:"borderless",style:{borderRadius:12,boxShadow:"0 8px 20px rgba(15,15,15,0.04)",textAlign:"left"},styles:{body:{padding:16}},children:g?(0,j.jsx)(Pn.A,{active:!0,paragraph:!1}):(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12},children:"Total Documents"}),(0,j.jsx)(h.A.Title,{level:3,style:{margin:0},children:V})]})})}),(0,j.jsx)(o.A,{xs:24,sm:24,md:8,children:(0,j.jsx)(r.A,{style:{borderRadius:12,boxShadow:"0 8px 20px rgba(15,15,15,0.04)",textAlign:"left"},styles:{body:{padding:16}},children:g?(0,j.jsx)(Pn.A,{active:!0,paragraph:!1}):(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12},children:"Requests (selected period)"}),(0,j.jsx)(h.A.Title,{level:3,style:{margin:0},children:Z?Z.reduce((e,t)=>e+(Number(t.value)||0),0):0}),(0,j.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12,marginTop:6},children:Z&&Z.length?"Latest: ".concat(Z[Z.length-1].type," (").concat(Z[Z.length-1].value,")"):""})]})})})]}),(0,j.jsx)(m.A,{}),ee.map(e=>{const t=ae[e];var n;return null!==t&&void 0!==t&&t.isError?(0,j.jsx)(Rn.A,{message:"Failed to load ".concat(Hn[e].title),description:(0,j.jsxs)("div",{children:[String((null===(n=t.error)||void 0===n?void 0:n.message)||t.error)," ",(0,j.jsx)(u.Ay,{size:"small",onClick:()=>t.refetch(),children:"Retry"})]}),type:"error",showIcon:!0,style:{marginBottom:12}},"alert-".concat(e)):null}),(0,j.jsxs)(l.A,{gutter:[24,24],children:[N.includes("gender")&&(0,j.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,j.jsx)($,{id:"gender",title:Hn.gender.title,chartType:Hn.gender.chartType,data:b.gender,loading:I.gender,colors:Hn.gender.colors})}),N.includes("age")&&(0,j.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,j.jsx)($,{id:"age",title:Hn.age.title,chartType:Hn.age.chartType,data:b.age,loading:I.age,colors:Hn.age.colors})}),N.includes("documents-monthly")&&(0,j.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,j.jsx)($,{id:"documents-monthly",title:Hn["documents-monthly"].title,chartType:Hn["documents-monthly"].chartType,data:b["documents-monthly"],loading:I["documents-monthly"],colors:Hn["documents-monthly"].colors})}),N.includes("civil-status")&&(0,j.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,j.jsx)($,{id:"civil-status",title:Hn["civil-status"].title,chartType:Hn["civil-status"].chartType,data:b["civil-status"],loading:I["civil-status"],colors:Hn["civil-status"].colors})}),N.includes("education")&&(0,j.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,j.jsx)($,{id:"education",title:Hn.education.title,chartType:Hn.education.chartType,data:b.education,loading:I.education,colors:Hn.education.colors})})]})]})})},Jn=()=>(0,j.jsx)(Un.Ht,{client:Gn,children:(0,j.jsx)(Kn,{})});var Zn=n(94842),$n=n(94527),Qn=n(1725),Xn=n(76384),ea=n(80172),ta=n(33023),na=n(81911),aa=n(78776),sa=n(85877),ia=n(83325),ra=n(70916);const la=e=>{let{open:t,onClose:n,contactEmail:a}=e;const[i,r]=(0,s.useState)(a||""),[l,o]=(0,s.useState)(!1);(0,s.useEffect)(()=>{r(a||"")},[a,t]);const[d,c]=(0,s.useState)(!1),[u,h]=(0,s.useState)(""),[m,p]=(0,s.useState)("success");return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(ia.A,{open:t,onClose:()=>{l||n()},children:(0,j.jsxs)(jt.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:420,bgcolor:"background.paper",boxShadow:24,p:3},children:[(0,j.jsx)("h3",{children:"Send Test Email"}),(0,j.jsx)(wt.A,{label:"Recipient Email",type:"email",value:i,onChange:e=>r(e.target.value),fullWidth:!0,margin:"normal"}),(0,j.jsxs)(jt.A,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[(0,j.jsx)(St.A,{onClick:n,disabled:l,children:"Cancel"}),(0,j.jsx)(St.A,{variant:"contained",onClick:async()=>{try{o(!0);try{const e=await A.adminAPI.getSystemSettings();if(!e||!e.smtp||!e.smtp.host)return h("SMTP is not configured. Please configure SMTP settings before sending a test email."),p("error"),c(!0),void o(!1)}catch(r){}const e=await A.adminAPI.testSmtp(i),t=e&&e.message?e.message:"Test email sent successfully";h(t),p("success"),c(!0),o(!1),setTimeout(()=>{c(!1),n()},900)}catch(l){var e,t,a,s;o(!1);const n=(null===l||void 0===l||null===(e=l.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||(null===l||void 0===l||null===(a=l.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.error)||(null===l||void 0===l?void 0:l.message)||"Failed to send test email";h(n),p("error"),c(!0)}},disabled:l||!i,children:l?(0,j.jsx)(ea.A,{size:20}):"Send Test Email"})]})]})}),(0,j.jsx)(ra.A,{open:d,autoHideDuration:4e3,onClose:()=>c(!1),children:(0,j.jsx)(kt.A,{onClose:()=>c(!1),severity:m,sx:{width:"100%"},children:u})})]})};var oa=n(56403),da=n(78354);const ca={siteName:"Barangay Portal",barangayName:"Barangay Uno",barangayAddress:"123 Main St, City, Province",contactEmail:"info@barangayuno.local",contactPhone:"+63 912 345 6789",maintainanceMode:!1,allowNewRegistrations:!0,requireEmailVerification:!0,enableVerifications:!1,maxDocumentRequests:5,documentProcessingDays:3,allowMultipleAccountsPerIP:!1,maxAccountsPerIP:1,systemNotice:"",smtp:{host:"",port:587,user:"",password:""}},ua=()=>{var e,t,n,r,l;const[o,d]=(0,s.useState)(()=>(0,a.A)({},ca)),[c,u]=(0,s.useState)(!0),[h,m]=(0,s.useState)(!1),[p,x]=(0,s.useState)(!1),[g,f]=(0,s.useState)(!1),[y,v]=(0,s.useState)(null),[w,I]=(0,s.useState)(!1),[S,C]=(0,s.useState)([]),[k,N]=(0,s.useState)(!1),[T,_]=(0,s.useState)(!1),[P,D]=(0,s.useState)(null),R=(0,s.useRef)({}),[q,B]=(0,s.useState)({}),L=(0,s.useRef)({}),U=(0,s.useRef)(null),O=(0,s.useRef)(0),[z,F]=(0,s.useState)([]),E=(0,s.useRef)({}),M=(0,s.useRef)(null),[W,Y]=(0,s.useState)(!1);(0,s.useEffect)(()=>{const e=new AbortController;return H(e.signal),()=>{try{e.abort()}catch(t){}try{Object.values(L.current).forEach(e=>{try{URL.revokeObjectURL(e)}catch(t){}})}catch(t){}}},[]),(0,s.useEffect)(()=>{try{const e=U.current;if(!e)return;S.length>O.current&&e.scrollTo({left:e.scrollWidth,behavior:"smooth"}),O.current=S.length}catch(e){}},[S.length]),(0,s.useEffect)(()=>{try{S.filter(e=>e._id&&e._id.toString().startsWith("new-")).map(e=>e._id).forEach(e=>{if(!z.includes(e)){F(t=>[...t,e]);const t=window.setTimeout(()=>{F(t=>t.filter(t=>t!==e)),delete E.current[e]},2500);E.current[e]=t}})}catch(e){}return()=>{Object.values(E.current).forEach(t=>{try{clearTimeout(t)}catch(e){}}),E.current={}}},[S,z]);const H=async e=>{u(!0);try{let a=null;try{a=await A.adminAPI.getSystemSettings()}catch(t){try{const t=await oa.A.get("".concat(A.API_URL,"/admin/settings"),{withCredentials:!0,signal:e});null!==t&&void 0!==t&&t.data&&(a=t.data)}catch(n){console.warn("Failed to load system settings via adminAPI and API_URL fallback",t,n)}}a&&(d(a),M.current=a),N(!0);try{const t=await A.adminAPI.getOfficials();if(Array.isArray(t))C(t);else{const t=await oa.A.get("".concat(A.API_URL,"/admin/officials"),{withCredentials:!0,signal:e});null!==t&&void 0!==t&&t.data&&C(t.data)}}catch(t){try{const t=await oa.A.get("".concat(A.API_URL,"/admin/officials"),{withCredentials:!0,signal:e});null!==t&&void 0!==t&&t.data&&C(t.data)}catch(n){console.warn("Failed to load officials via adminAPI and API_URL fallback",t,n)}}finally{N(!1)}}catch(t){if("CanceledError"===(null===t||void 0===t?void 0:t.name)||"AbortError"===(null===t||void 0===t?void 0:t.name))return;console.error("Unexpected error in fetchSettings",t),i.Ay.error("Unexpected error while loading settings")}finally{u(!1)}},V=async()=>{try{m(!0),v(null);const e=(0,a.A)((0,a.A)({},o),{},{maintenanceMode:o.maintainanceMode,allowRegistrations:o.allowNewRegistrations,maxDocumentRequestsPerUser:Number(o.maxDocumentRequests)||1,documentProcessingDays:Number(o.documentProcessingDays)||1},"undefined"!==typeof o.maxAccountsPerIP?{maxAccountsPerIP:Number(o.maxAccountsPerIP)||1}:{});await A.adminAPI.updateSystemSettings(e),M.current=e,Y(!1),f(!0),i.Ay.success("Settings saved")}catch(e){console.error("Failed to save settings",e),v("Failed to save settings"),i.Ay.error("Failed to save settings")}finally{m(!1),window.setTimeout(()=>f(!1),2e3)}},G=async()=>{try{await(async()=>{try{const e=M.current,t=!e||Boolean(e.enableVerifications),n=Boolean(o.enableVerifications);if(t&&!1===n)return void x(!0);await V()}catch(e){console.error("handleSave error",e)}})()}catch(e){}try{await(async()=>{if(S&&0!==S.length){_(!0),D(null);try{const t=[];for(const n of S)if(!n._id||n._id.toString().startsWith("new-")){const e=await A.adminAPI.createOfficial({name:n.name,title:n.title,term:n.term});t.push(e)}else try{const e=await A.adminAPI.updateOfficial(n._id,{name:n.name,title:n.title,term:n.term});t.push(e)}catch(e){t.push(n)}try{const e=await A.adminAPI.getOfficials();Array.isArray(e)?C(e):C(t)}catch(e){C(t)}i.Ay.success("Officials saved")}catch(t){console.error("Manual save officials failed",t),D("Manual save failed"),i.Ay.error("Manual save failed")}finally{_(!1)}}})()}catch(e){}};(0,s.useEffect)(()=>{try{if(!M.current)return void Y(!1);Y(JSON.stringify(M.current)!==JSON.stringify(o))}catch(e){Y(!1)}},[o]);return(0,j.jsxs)(jt.A,{sx:{pt:"calc(var(--app-header-height, 64px) + 24px)",px:3,pb:3},children:[(0,j.jsxs)(bt.A,{sx:{p:3},children:[(0,j.jsx)(Zn.A,{variant:"subtitle1",gutterBottom:!0,children:"Barangay Information"}),(0,j.jsxs)(jt.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,j.jsx)(wt.A,{label:"Site Name",value:o.siteName,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{siteName:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,j.jsx)(wt.A,{label:"Barangay Name",value:o.barangayName,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{barangayName:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,j.jsx)(wt.A,{label:"Barangay Address",value:o.barangayAddress,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{barangayAddress:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0,multiline:!0,rows:2})]}),(0,j.jsx)($n.A,{sx:{my:3}}),(0,j.jsx)(Zn.A,{variant:"subtitle1",gutterBottom:!0,children:"SMTP / Email Settings"}),(0,j.jsxs)(jt.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,j.jsx)(wt.A,{label:"SMTP Host",value:(null===(e=o.smtp)||void 0===e?void 0:e.host)||"",onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{smtp:(0,a.A)((0,a.A)({},t.smtp),{},{host:e.target.value})})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,j.jsx)(wt.A,{label:"SMTP Port",type:"number",value:(null===(t=o.smtp)||void 0===t?void 0:t.port)||"",onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{smtp:(0,a.A)((0,a.A)({},t.smtp),{},{port:parseInt(e.target.value||"0")})})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,j.jsx)(wt.A,{label:"SMTP User",value:(null===(n=o.smtp)||void 0===n?void 0:n.user)||"",onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{smtp:(0,a.A)((0,a.A)({},t.smtp),{},{user:e.target.value})})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,j.jsxs)(jt.A,{sx:{display:"flex",gap:2},children:[(0,j.jsx)(St.A,{variant:"outlined",onClick:()=>I(!0),children:"Send Test Email"}),(0,j.jsx)(St.A,{variant:"text",onClick:()=>d(e=>(0,a.A)((0,a.A)({},e),{},{smtp:(0,a.A)((0,a.A)({},e.smtp),{},{password:""})})),children:"Clear SMTP Password"})]})]}),(0,j.jsx)(la,{open:w,onClose:()=>I(!1),contactEmail:o.contactEmail}),(0,j.jsx)($n.A,{sx:{my:3}}),(0,j.jsx)(Zn.A,{variant:"subtitle1",gutterBottom:!0,children:"Resident Verifications"}),(0,j.jsxs)(jt.A,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[(0,j.jsx)(Qn.A,{control:(0,j.jsx)(Xn.A,{checked:Boolean(o.enableVerifications),onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{enableVerifications:e.target.checked}))}),label:"Enable Resident Verifications"}),(0,j.jsx)(St.A,{variant:"text",onClick:()=>i.Ay.info("When disabled, all pending verification requests will be deleted on the server."),children:"More info"})]}),!1===o.enableVerifications&&(0,j.jsxs)(jt.A,{sx:{display:"flex",flexDirection:"column",gap:1},children:[(0,j.jsx)(kt.A,{severity:"warning",children:"Disabling verifications will permanently delete pending verification requests and uploaded files when you save changes."}),!c&&!M.current&&(0,j.jsx)(kt.A,{severity:"info",children:"Resident verifications are currently disabled by default. Enable them to allow residents to submit verification requests."})]}),(0,j.jsx)($n.A,{sx:{my:3}}),(0,j.jsx)(Zn.A,{variant:"subtitle1",gutterBottom:!0,children:"Barangay Officials"}),(0,j.jsxs)(jt.A,{sx:{display:"flex",gap:3,alignItems:"flex-start",mb:3,flexDirection:{xs:"column",md:"row"}},children:[(0,j.jsxs)(jt.A,{sx:{flex:1,width:"100%"},children:[(0,j.jsxs)(jt.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[(0,j.jsx)(Zn.A,{variant:"body1",children:"Manage officials (auto-saves changes)"}),(0,j.jsx)(St.A,{onClick:()=>{const e={_id:"new-".concat(Date.now()),name:"",title:"",term:""};C(t=>[...t,e])},startIcon:(0,j.jsx)(da.A,{}),children:"Add Official"})]}),(0,j.jsx)(jt.A,{sx:{maxHeight:420,overflowY:"auto",pr:1,border:"1px solid rgba(0,0,0,0.04)",borderRadius:1,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.6)"},children:k?(0,j.jsx)(ea.A,{size:24}):(0,j.jsx)(jt.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:S.map((e,t)=>(0,j.jsxs)(bt.A,{sx:{p:2,display:"flex",gap:2,alignItems:"center"},children:[(0,j.jsx)(jt.A,{sx:{width:72,height:72,borderRadius:"50%",overflow:"hidden",flexShrink:0,border:"3px solid rgba(0,0,0,0.04)",boxShadow:"0 1px 6px rgba(0,0,0,0.06)"},children:(0,j.jsx)("img",{src:ut(e),alt:e.name||"photo",style:{width:"100%",height:"100%",objectFit:"cover",transition:"transform .2s",display:"block"}})}),(0,j.jsxs)(jt.A,{sx:{flex:1},children:[(0,j.jsx)(wt.A,{label:"Full name",value:e.name,onChange:t=>{const n=t.target.value;C(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{name:n}):t)),R.current[e._id||""]&&clearTimeout(R.current[e._id||""]),R.current[e._id||""]=window.setTimeout(async()=>{try{if(_(!0),e._id&&!e._id.toString().startsWith("new-"))await A.adminAPI.updateOfficial(e._id,(0,a.A)((0,a.A)({},e),{},{name:n}));else{const t=await A.adminAPI.createOfficial((0,a.A)((0,a.A)({},e),{},{name:n}));C(n=>n.map(n=>n._id===e._id?t:n))}D(null)}catch(t){console.error("auto-save failed",t),D("Auto-save failed")}finally{_(!1)}},900)},fullWidth:!0,size:"small",sx:{mb:1},variant:"outlined",InputLabelProps:{shrink:!0}}),(0,j.jsx)(wt.A,{label:"Title/Position",value:e.title,onChange:t=>{const n=t.target.value;C(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{title:n}):t)),R.current[e._id||""]&&clearTimeout(R.current[e._id||""]),R.current[e._id||""]=window.setTimeout(async()=>{try{if(_(!0),e._id&&!e._id.toString().startsWith("new-"))await A.adminAPI.updateOfficial(e._id,(0,a.A)((0,a.A)({},e),{},{title:n}));else{const t=await A.adminAPI.createOfficial((0,a.A)((0,a.A)({},e),{},{title:n}));C(n=>n.map(n=>n._id===e._id?t:n))}D(null)}catch(t){console.error("auto-save failed",t),D("Auto-save failed")}finally{_(!1)}},900)},fullWidth:!0,size:"small",sx:{mb:1},variant:"outlined",InputLabelProps:{shrink:!0}}),(0,j.jsx)(wt.A,{label:"Term",value:e.term,onChange:t=>{const n=t.target.value;C(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{term:n}):t)),R.current[e._id||""]&&clearTimeout(R.current[e._id||""]),R.current[e._id||""]=window.setTimeout(async()=>{try{if(_(!0),e._id&&!e._id.toString().startsWith("new-"))await A.adminAPI.updateOfficial(e._id,(0,a.A)((0,a.A)({},e),{},{term:n}));else{const t=await A.adminAPI.createOfficial((0,a.A)((0,a.A)({},e),{},{term:n}));C(n=>n.map(n=>n._id===e._id?t:n))}D(null)}catch(t){console.error("auto-save failed",t),D("Auto-save failed")}finally{_(!1)}},900)},fullWidth:!0,size:"small",variant:"outlined",InputLabelProps:{shrink:!0}}),(0,j.jsxs)(jt.A,{sx:{display:"flex",gap:1,mt:1},children:[(0,j.jsx)(Z.A,{showUploadList:!1,beforeUpload:t=>{if(t.size>2097152)return i.Ay.warning("File is too large. Maximum allowed size is 2 MB."),!1;try{const n=URL.createObjectURL(t);L.current[e._id||"temp-".concat(Date.now())]=n,C(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{previewUrl:n}):t))}catch(n){}return(async()=>{try{if(!e._id||e._id.toString().startsWith("new-"))return void i.Ay.warning("Please save official first by entering name/title/term");await A.adminAPI.uploadOfficialPhoto(e._id,t);const a=await A.adminAPI.getOfficials();C(Array.isArray(a)?a:S),i.Ay.success("Photo uploaded");try{const t=e._id||"",n=L.current[t];n&&(URL.revokeObjectURL(n),delete L.current[t])}catch(n){}}catch(a){console.error("upload failed",a),i.Ay.error("Upload failed")}})(),!1},children:(0,j.jsx)(St.A,{startIcon:(0,j.jsx)(ee.A,{}),children:"Upload Photo"})}),(0,j.jsx)(St.A,{color:"error",startIcon:(0,j.jsx)(X.A,{}),onClick:()=>{e._id&&!e._id.toString().startsWith("new-")?(async e=>{if(e){_(!0);try{await A.adminAPI.deleteOfficial(e),C(t=>t.filter(t=>t._id!==e)),i.Ay.success("Official deleted")}catch(t){console.error("Delete official failed",t),i.Ay.error("Failed to delete official")}finally{_(!1)}}})(e._id):C(t=>t.filter(t=>t._id!==e._id))},children:"Delete"})]})]})]},e._id||t))})})]}),(0,j.jsxs)(jt.A,{sx:{width:{xs:"100%",md:360},position:{xs:"relative",md:"sticky"},top:{md:24},alignSelf:"flex-start",mt:{xs:2,md:0}},children:[(0,j.jsx)(Zn.A,{variant:"body2",sx:{mb:1},children:"Officials Preview"}),(0,j.jsx)(jt.A,{sx:{background:"white",borderRadius:2,p:2},children:0===S.length?(0,j.jsx)(Zn.A,{variant:"body2",color:"text.secondary",children:"No officials to preview"}):(()=>{const e=[...S.filter(e=>!(e._id&&e._id.toString().startsWith("new-"))),...S.filter(e=>e._id&&e._id.toString().startsWith("new-"))];return(0,j.jsx)("div",{ref:U,style:{display:"flex",gap:12,overflowX:"auto",padding:"6px 4px",scrollSnapType:"x mandatory"},"aria-label":"Officials preview",children:e.map(e=>{const t=e._id||"",n=z.includes(t);return(0,j.jsxs)("div",{style:{minWidth:140,textAlign:"center",padding:8,scrollSnapAlign:"center",transition:"box-shadow .25s, transform .18s",boxShadow:n?"0 10px 30px rgba(25,118,210,0.18)":void 0,transform:n?"translateY(-4px)":void 0,borderRadius:8,background:n?"linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,255,0.98))":void 0,flex:"0 0 auto"},children:[(0,j.jsx)(b,{size:80,src:ut(e),style:{margin:"0 auto",boxShadow:"0 6px 18px rgba(0,0,0,0.06)"}}),(0,j.jsxs)("div",{style:{marginTop:8},children:[(0,j.jsx)("div",{style:{fontWeight:600,fontSize:14},children:e.name||"\u2014"}),(0,j.jsx)("div",{style:{color:"#888",fontSize:12},children:e.title}),(0,j.jsx)("div",{style:{color:"#888",fontSize:12},children:e.term})]})]},t||Math.random())})})})()})]})]}),P&&(0,j.jsx)(Zn.A,{color:"error",sx:{mt:1},children:P}),(0,j.jsx)(Zn.A,{variant:"subtitle1",gutterBottom:!0,children:"Contact Information"}),(0,j.jsxs)(jt.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,j.jsx)(wt.A,{label:"Contact Email",type:"email",value:o.contactEmail,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{contactEmail:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,j.jsx)(wt.A,{label:"Contact Phone",value:o.contactPhone,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{contactPhone:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0})]}),(0,j.jsx)($n.A,{sx:{my:3}}),(0,j.jsx)(Zn.A,{variant:"subtitle1",gutterBottom:!0,children:"System Configuration"}),(0,j.jsxs)(jt.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,j.jsx)(Qn.A,{control:(0,j.jsx)(Xn.A,{checked:o.maintainanceMode,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{maintainanceMode:e.target.checked}))}),label:"Maintenance Mode"}),(0,j.jsx)(Qn.A,{control:(0,j.jsx)(Xn.A,{checked:o.allowNewRegistrations,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{allowNewRegistrations:e.target.checked}))}),label:"Allow New Registrations"}),(0,j.jsxs)(jt.A,{children:[(0,j.jsx)(Qn.A,{control:(0,j.jsx)(Xn.A,{checked:o.allowMultipleAccountsPerIP,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{allowMultipleAccountsPerIP:e.target.checked}))}),label:"Allow multiple accounts per IP"}),(0,j.jsxs)(jt.A,{sx:{mt:1,ml:4,display:"flex",alignItems:"center",gap:2},children:[(0,j.jsx)(wt.A,{label:"Max accounts per IP",type:"number",size:"small",value:null!==(r=o.maxAccountsPerIP)&&void 0!==r?r:1,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{maxAccountsPerIP:parseInt(e.target.value||"1")})),variant:"outlined",InputLabelProps:{shrink:!0},inputProps:{min:1,max:100},sx:{width:140}}),(0,j.jsxs)(Zn.A,{variant:"caption",color:"text.secondary",children:["Current limit: ",null!==(l=o.maxAccountsPerIP)&&void 0!==l?l:1]})]})]}),(0,j.jsx)(Qn.A,{control:(0,j.jsx)(Xn.A,{checked:o.requireEmailVerification,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{requireEmailVerification:e.target.checked}))}),label:"Require Email Verification"}),(0,j.jsx)(wt.A,{label:"Maximum Document Requests per User",type:"number",value:o.maxDocumentRequests,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{maxDocumentRequests:parseInt(e.target.value)})),variant:"outlined",InputLabelProps:{shrink:!0},inputProps:{min:1,max:20}}),(0,j.jsx)(wt.A,{label:"Document Processing Days",type:"number",value:o.documentProcessingDays,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{documentProcessingDays:parseInt(e.target.value)})),variant:"outlined",InputLabelProps:{shrink:!0},inputProps:{min:1,max:30},helperText:"Standard number of days to process document requests"})]}),(0,j.jsx)($n.A,{sx:{my:3}}),(0,j.jsx)(Zn.A,{variant:"subtitle1",gutterBottom:!0,children:"System Notice"}),(0,j.jsx)(jt.A,{sx:{mb:3},children:(0,j.jsx)(wt.A,{label:"System-wide Notice",value:o.systemNotice,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{systemNotice:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0,multiline:!0,rows:3,helperText:"This notice will be displayed to all users"})}),(0,j.jsx)(jt.A,{sx:{position:"fixed",right:24,bottom:24,zIndex:1300},children:(0,j.jsx)(St.A,{variant:"contained",onClick:()=>G(),disabled:h||T,sx:{width:64,height:64,borderRadius:"50%",minWidth:64,boxShadow:"0 8px 24px rgba(25,118,210,0.24)",backgroundColor:"#1976d2",color:"#fff","&:hover":{boxShadow:"0 12px 32px rgba(25,118,210,0.32)",backgroundColor:"#1565c0"},display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600},"aria-label":"Save Settings and Officials",children:h||T?"...":"Save"})})]}),(0,j.jsxs)(ta.A,{open:p,onClose:()=>x(!1),children:[(0,j.jsx)(na.A,{children:"Disable Resident Verifications?"}),(0,j.jsx)(aa.A,{children:(0,j.jsx)(Zn.A,{children:"Disabling resident verifications will permanently delete all pending verification requests and their uploaded files on the server. This action cannot be undone. Are you sure you want to proceed?"})}),(0,j.jsxs)(sa.A,{children:[(0,j.jsx)(St.A,{onClick:()=>x(!1),disabled:h,children:"Cancel"}),(0,j.jsx)(St.A,{onClick:()=>(async()=>{x(!1),await V()})(),color:"error",disabled:h,children:"Yes, disable and save"})]})]})]})};var ha=n(48745);const{Title:ma,Text:pa}=h.A,{Search:xa}=c.A,ga=()=>{const[e,t]=(0,s.useState)([]),[h,m]=(0,s.useState)([]),[p,x]=(0,s.useState)(!1),[g,f]=(0,s.useState)(""),[y,v]=(0,s.useState)({}),[b,w]=(0,s.useState)(""),[I,S]=(0,s.useState)(""),[C,k]=(0,s.useState)("all"),[N,T]=(0,s.useState)("name"),[_,P]=(0,s.useState)(!1),[D,R]=(0,s.useState)(!1),[q,B]=(0,s.useState)(null),{user:L,setUser:U}=De(),O=L||(()=>{try{const e=localStorage.getItem("userProfile");return e?JSON.parse(e):null}catch(e){return null}})();(0,s.useEffect)(()=>{(async()=>{P(!0);try{const e=await A.documentsAPI.listFiles();t(e)}catch(e){i.Ay.error("Failed to fetch document templates"),t([])}finally{P(!1)}})()},[]);const z=e.filter(e=>{const t=e.filename||"";if(/^filled_/i.test(t))return!1;if(/^\d{4}-/.test(t))return!1;const n=t.toLowerCase(),a=I.toLowerCase(),s="all"===C||e.category===C;return n.includes(a)&&s}).sort((e,t)=>{var n;switch(N){case"date":return new Date(t.uploadDate).getTime()-new Date(e.uploadDate).getTime();case"type":return(null===(n=e.filename.split(".").pop())||void 0===n?void 0:n.localeCompare(t.filename.split(".").pop()||""))||0;default:return e.filename.localeCompare(t.filename)}});return(0,j.jsxs)("div",{style:{padding:"24px",minHeight:"80vh",background:"#f0f2f5"},children:[(0,j.jsx)(l.A,{justify:"start",align:"middle",style:{marginBottom:24},children:(0,j.jsxs)(o.A,{style:{textAlign:"left"},children:[(0,j.jsxs)(An.A,{style:{marginBottom:8},children:[(0,j.jsx)(An.A.Item,{children:"Home"}),(0,j.jsx)(An.A.Item,{children:"Documents"}),(0,j.jsx)(An.A.Item,{children:"Request"})]}),(0,j.jsx)(ma,{level:2,style:{margin:0,textAlign:"left"},children:"Request Document"})]})}),(0,j.jsxs)(l.A,{gutter:16,justify:"center",style:{marginBottom:24},children:[(0,j.jsx)(o.A,{xs:24,sm:16,md:10,lg:8,children:(0,j.jsx)(xa,{placeholder:"Search documents...",value:I,onChange:e=>S(e.target.value),style:{width:"100%"}})}),(0,j.jsx)(o.A,{xs:24,sm:16,md:10,lg:8,children:(0,j.jsxs)("div",{className:"filter-controls",children:[(0,j.jsxs)(d.A,{defaultValue:"all",className:"filter-select category-select",style:{width:220},onChange:e=>k(e),children:[(0,j.jsx)(d.A.Option,{value:"all",children:"All Categories"}),(0,j.jsx)(d.A.Option,{value:"personal",children:"Personal Documents"}),(0,j.jsx)(d.A.Option,{value:"business",children:"Business Documents"}),(0,j.jsx)(d.A.Option,{value:"certificates",children:"Certificates"})]}),(0,j.jsxs)(d.A,{defaultValue:"name",className:"filter-select sort-select",style:{width:160},onChange:e=>T(e),children:[(0,j.jsx)(d.A.Option,{value:"name",children:"Sort by Name"}),(0,j.jsx)(d.A.Option,{value:"date",children:"Sort by Date"}),(0,j.jsx)(d.A.Option,{value:"type",children:"Sort by Type"})]})]})})]}),(0,j.jsx)(l.A,{gutter:[16,16],children:_?(0,j.jsx)(o.A,{span:24,style:{textAlign:"center",padding:"40px"},children:"Loading documents..."}):0===z.length?(0,j.jsx)(o.A,{span:24,style:{textAlign:"center",padding:"40px"},children:"No documents found"}):z.map(e=>(0,j.jsx)(o.A,{xs:24,sm:12,md:8,lg:6,children:(0,j.jsx)(r.A,{hoverable:!0,style:{transition:"all 0.3s ease",borderRadius:8},bodyStyle:{padding:16},onClick:()=>(async e=>{L||(()=>{try{const e=localStorage.getItem("userProfile");return e?JSON.parse(e):null}catch(e){return null}})(),f(e.filename.replace(/\.docx$/i,""));try{const t=await Promise.resolve().then(n.bind(n,31694)),a=await t.axiosPublic.get("/documents/preview/".concat(e._id),{params:{format:"html"},responseType:"text"}),s=a&&a.data?a.data:"",i=/\{(.*?)\}/g,r=[];let l;for(;null!==(l=i.exec(s));)r.push(l[1].trim());const o=r.filter(e=>e&&"qr"!==e.toLowerCase());m(o);const d={},c=new Date,u=c.getDate(),h=c.getMonth()+1,p=c.toLocaleString(void 0,{month:"long"}),g=c.getFullYear(),f=String(h).padStart(2,"0"),y=String(u).padStart(2,"0"),A="".concat(f,"/").concat(y,"/").concat(g);o.forEach(e=>{d[e]="",/^current(day|dayof)?$/i.test(e)||/currentday/i.test(e)?d[e]=String(u):/current(month)?$/i.test(e)||/currentmonth/i.test(e)?d[e]=p:/current(year)?$/i.test(e)||/currentyear/i.test(e)?d[e]=String(g):/currentdate|current_date|current date|dateofrequest|requesteddate/i.test(e)&&(d[e]=A)}),v(d),x(!0)}catch(t){i.Ay.error("Failed to load document preview"),m([]),v({})}})(e),children:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",marginBottom:12},children:[(0,j.jsx)(ha.A,{style:{fontSize:24,color:"#1890ff",marginRight:12,marginTop:4}}),(0,j.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,j.jsx)(pa,{strong:!0,style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.filename.replace(/\.docx$/i,"")}),(0,j.jsxs)(pa,{type:"secondary",style:{fontSize:12},children:[new Date(e.uploadDate).toLocaleDateString()," \xb7 ",Math.round(e.length/1024)," KB"]})]}),(0,j.jsx)(ze.A,{menu:{items:[{key:"view",icon:(0,j.jsx)($.A,{}),label:"View"},{key:"download",icon:(0,j.jsx)(Q.A,{}),label:"Download"}]},trigger:["click"],children:(0,j.jsx)(u.Ay,{type:"text",icon:(0,j.jsx)(In.A,{}),onClick:e=>e.stopPropagation()})})]})})},e._id))}),(0,j.jsx)(fe.A,{open:p,onCancel:()=>x(!1),width:800,footer:null,children:0===h.length?(0,j.jsx)(Zt.A,{description:"No fields found in this template"}):(0,j.jsx)(dt.A,{layout:"vertical",initialValues:{fields:y},onFinish:async t=>{R(!0);try{var n,s;const r=(0,a.A)({},t.fields);Object.entries(r).forEach(e=>{let[t,n]=e;if(n&&"function"===typeof n.format)try{r[t]=n.format("MM/DD/YYYY")}catch(a){r[t]=String(n)}});const l={type:g,documentType:g,purpose:t.purpose,fileId:null===(n=e.find(e=>e.filename.replace(/\.docx$/i,"")===g))||void 0===n?void 0:n._id,fieldValues:r,username:L&&L.username||O&&O.username||void 0,barangayID:L&&L.barangayID||O&&O.barangayID||void 0},o=await A.documentsAPI.requestDocument(l);i.Ay.success("Request submitted successfully!"),B((null===o||void 0===o||null===(s=o.documentRequest)||void 0===s?void 0:s._id)||(null===o||void 0===o?void 0:o._id)||null),x(!1)}catch(r){i.Ay.error("Failed to submit request.")}finally{R(!1)}},children:(0,j.jsxs)(l.A,{gutter:[16,16],children:[(0,j.jsx)(o.A,{span:24,children:(0,j.jsx)(dt.A.Item,{name:"purpose",label:"Purpose",rules:[{required:!0,message:"Please enter the purpose"}],children:(0,j.jsx)(c.A.TextArea,{rows:4,placeholder:"Enter the purpose of your request"})})}),h.map((e,t)=>(0,j.jsx)(o.A,{xs:24,sm:12,children:(0,j.jsx)(dt.A.Item,{name:["fields",e],label:e,rules:[{required:!0,message:"Please enter ".concat(e)}],children:/date|dob|birth|issued/i.test(e)?(0,j.jsx)(jn.A,{style:{width:"100%"},format:"MM/DD/YYYY"}):(0,j.jsx)(c.A,{placeholder:"Enter ".concat(e)})})},t)),(0,j.jsx)(o.A,{span:24,style:{textAlign:"right"},children:(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(u.Ay,{onClick:()=>x(!1),children:"Cancel"}),(0,j.jsx)(u.Ay,{type:"primary",htmlType:"submit",loading:D,children:"Submit Request"})]})})]})})})]})};var fa=n(64376),ya=n(20691),Aa=n(93795);const{TextArea:ja}=c.A,va=[{label:"Requests",options:[{value:"DOCUMENT_REQUEST",label:"Document Request"},{value:"SCHEDULE_APPOINTMENT",label:"Schedule Appointment"},{value:"CERTIFICATE_REQUEST",label:"Certificate Request"}]},{label:"Concerns",options:[{value:"COMPLAINT",label:"Complaint"},{value:"ASSISTANCE",label:"Assistance"}]}],ba=()=>{const{user:e}=De(),[t,n]=(0,s.useState)(!1),[a,m]=(0,s.useState)(!1),[p]=dt.A.useForm(),[x,g]=s.useState(0),[f,v]=s.useState(0),b=100,w=500,[I,S]=s.useState(0),[k,N]=s.useState([]),[T,_]=s.useState(!1),[P,D]=s.useState(null),R="inquiryFormDraft_v1";s.useEffect(()=>{try{const e=localStorage.getItem(R);if(e){const t=JSON.parse(e);if(t){const{type:e,assignedRole:n,subject:a,message:s,attachments:i}=t;if(p.setFieldsValue({type:e,assignedRole:n,subject:a,message:s}),a&&g(a.length),s&&v(s.length),i&&Array.isArray(i)&&i.length){const e=i.map((e,t)=>({uid:"restored-".concat(t),name:e}));N(e),p.setFieldsValue({attachment:e})}a&&s&&(n||e)?S(2):i&&i.length?S(1):S(0)}}}catch(e){console.warn("Failed to load inquiry draft",e)}},[]),s.useEffect(()=>{const e=()=>{try{const e=p.getFieldsValue(!0),t={type:e.type||null,assignedRole:e.assignedRole||null,subject:e.subject||"",message:e.message||"",attachments:(k||[]).map(e=>e.name||e.originFileObj&&e.originFileObj.name||""),updatedAt:(new Date).toISOString()};localStorage.setItem(R,JSON.stringify(t))}catch(e){console.warn("Failed to save draft",e)}},t=setInterval(e,5e3),n=()=>e();return window.addEventListener("beforeunload",n),()=>{clearInterval(t),window.removeEventListener("beforeunload",n);try{const e=p.getFieldsValue(!0),t={type:e.type||null,assignedRole:e.assignedRole||null,subject:e.subject||"",message:e.message||"",attachments:(k||[]).map(e=>e.name||e.originFileObj&&e.originFileObj.name||""),updatedAt:(new Date).toISOString()};localStorage.setItem(R,JSON.stringify(t))}catch(e){}}},[k]);const q=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},B=async t=>{n(!0),m(!1);try{let n=[];t.attachment&&(Array.isArray(t.attachment)?n=t.attachment:t.attachment.fileList&&Array.isArray(t.attachment.fileList)&&(n=t.attachment.fileList));const a=new FormData;if(a.append("type",t.type||""),a.append("subject",t.subject||""),a.append("message",t.message||""),a.append("assignedRole",t.assignedRole||"staff"),a.append("username",(null===e||void 0===e?void 0:e.username)||""),a.append("barangayID",(null===e||void 0===e?void 0:e.barangayID)||""),t.assignedTo&&Array.isArray(t.assignedTo))for(const e of t.assignedTo)a.append("assignedTo[]",e);for(const e of n)e.originFileObj&&a.append("attachments",e.originFileObj,e.name||e.originFileObj&&e.originFileObj.name);await A.contactAPI.submitInquiry(a),m(!0),p.resetFields(),N([]),localStorage.removeItem(R),i.Ay.success("Your inquiry has been submitted!")}catch(a){console.error(a),i.Ay.error("Failed to submit inquiry.")}finally{n(!1)}},L=e=>{i.Ay.error("Please complete all required fields")};return(0,j.jsx)("div",{style:{maxWidth:900,margin:"32px auto",padding:"0 12px"},children:(0,j.jsxs)(r.A,{style:{borderRadius:18,boxShadow:"0 4px 24px 0 rgba(64,201,255,0.10)",padding:0,background:"#fff"},headStyle:{borderRadius:"18px 18px 0 0",background:"linear-gradient(90deg, rgba(64,169,255,0.08) 0%, rgba(146,84,222,0.06) 100%)",padding:"16px 24px"},bodyStyle:{padding:24},bordered:!1,title:(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,j.jsx)(Et.A,{style:{fontSize:28,color:"#1890ff"}}),(0,j.jsxs)("div",{style:{lineHeight:1},children:[(0,j.jsx)(h.A.Title,{level:4,style:{margin:0,color:"#1890ff",fontWeight:700,fontFamily:"Poppins, Arial, sans-serif"},children:"Submit an Inquiry"}),(0,j.jsx)("div",{style:{fontSize:12,color:"#6c757d",marginTop:4},children:"Fill out the form below and our staff will get back to you."})]})]}),children:[a&&(0,j.jsx)(Rn.A,{type:"success",showIcon:!0,message:(0,j.jsxs)("span",{style:{fontWeight:600},children:[(0,j.jsx)("span",{role:"img","aria-label":"success",children:"\u2705"})," Your inquiry has been submitted!"]}),style:{marginBottom:16,borderRadius:8},banner:!0}),(0,j.jsxs)(dt.A,{form:p,layout:"vertical",onFinish:B,onFinishFailed:L,autoComplete:"off",onFieldsChange:()=>a&&m(!1),onValuesChange:(e,t)=>{t&&t.attachment&&t.attachment.length>0?S(1):t&&t.message&&t.message.length>0&&S(0),t&&t.subject&&t.message&&(t.assignedRole||t.type)&&S(2)},children:[(0,j.jsx)("div",{style:{marginBottom:16},children:(0,j.jsxs)(fa.A,{current:I,size:"small",children:[(0,j.jsx)(fa.A.Step,{title:"Details"}),(0,j.jsx)(fa.A.Step,{title:"Attachments"}),(0,j.jsx)(fa.A.Step,{title:"Review & Submit"})]})}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsxs)(o.A,{xs:24,sm:12,children:[(0,j.jsx)(dt.A.Item,{name:"type",label:(0,j.jsxs)("span",{children:["Inquiry Type ",(0,j.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,j.jsx)(y.A,{title:"Choose the category that best describes your issue.",children:(0,j.jsx)(Aa.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),rules:[{required:!0,message:"Please select an inquiry type"}],children:(0,j.jsx)(d.A,{placeholder:"Select inquiry type",className:"inquiry-rounded-input",children:va.map(e=>(0,j.jsx)(d.A.OptGroup,{label:e.label,children:e.options.map(e=>(0,j.jsx)(d.A.Option,{value:e.value,children:e.label},e.value))},e.label))})}),(0,j.jsx)(dt.A.Item,{name:"assignedRole",label:(0,j.jsxs)("span",{children:["Assign to Role ",(0,j.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,j.jsx)(y.A,{title:"Select which role should handle your inquiry.",children:(0,j.jsx)(Aa.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),initialValue:"staff",rules:[{required:!0,message:"Please select a role to assign"}],children:(0,j.jsx)(d.A,{options:[{value:"staff",label:"Staff"},{value:"admin",label:"Admin"}],placeholder:"Assign to role",className:"inquiry-rounded-input"})}),(0,j.jsx)(dt.A.Item,{name:"subject",label:(0,j.jsxs)("span",{children:["Subject ",(0,j.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,j.jsx)(y.A,{title:"Enter a short subject line.",children:(0,j.jsx)(Aa.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),rules:[{required:!0,message:"Please enter a subject"},{min:5,message:"Subject must be at least 5 characters"},{max:b,message:"Subject must be at most ".concat(b," characters")}],children:(0,j.jsxs)("div",{children:[(0,j.jsx)(c.A,{placeholder:"Enter subject",className:"inquiry-rounded-input",maxLength:120,onChange:e=>g(e.target.value.length)}),(0,j.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:6},children:(0,j.jsxs)("small",{style:{color:x>b?"red":"#8c8c8c"},children:[x,"/",b]})})]})})]}),(0,j.jsxs)(o.A,{xs:24,sm:12,children:[(0,j.jsx)(dt.A.Item,{name:"message",label:(0,j.jsxs)("span",{children:["Message ",(0,j.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,j.jsx)(y.A,{title:"Provide details about your inquiry.",children:(0,j.jsx)(Aa.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),rules:[{required:!0,message:"Please enter your message"},{min:10,message:"Message must be at least 10 characters"},{max:w,message:"Message must be at most ".concat(w," characters")}],children:(0,j.jsxs)("div",{children:[(0,j.jsx)(ja,{rows:4,placeholder:"Enter your message",className:"inquiry-rounded-input inquiry-large-textarea",maxLength:550,onChange:e=>v(e.target.value.length)}),(0,j.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:6},children:(0,j.jsxs)("small",{style:{color:f>w?"red":"#8c8c8c"},children:[f,"/",w]})})]})}),(0,j.jsxs)(dt.A.Item,{name:"attachment",label:(0,j.jsxs)("span",{children:["Attachments"," ",(0,j.jsx)(y.A,{title:"Attach supporting documents (PDF, JPG, PNG).",children:(0,j.jsx)(Aa.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:e&&e.fileList,extra:"Allowed: PDF, JPG, PNG. Max 5MB each.",children:[(0,j.jsxs)(Z.A.Dragger,{multiple:!0,accept:".pdf,.jpg,.jpeg,.png",fileList:k,beforeUpload:()=>!1,onChange:e=>{const t=e.fileList||[],n=[];t.forEach(e=>{const t=e.originFileObj||e,a=["application/pdf","image/jpeg","image/png"].includes(t.type)||t.name&&/\.(pdf|jpe?g|png)$/i.test(t.name),s=(t.size||0)/1024/1024<5;if(a)if(s){if(t.type&&t.type.startsWith("image/")&&!e.url&&!e.preview)try{const n=URL.createObjectURL(t);e.preview=n}catch(r){}n.push(e)}else i.Ay.error("".concat(t.name," must be smaller than 5MB"));else i.Ay.error("".concat(t.name," is not a supported file type"))}),N(n),p.setFieldsValue({attachment:n})},onPreview:async e=>{const t=e,n=t.url||t.preview||t.originFileObj&&URL.createObjectURL(t.originFileObj);n&&window.open(n,"_blank")},showUploadList:!1,children:[(0,j.jsx)("p",{className:"ant-upload-drag-icon",children:(0,j.jsx)(ee.A,{})}),(0,j.jsx)("p",{className:"ant-upload-text",children:"Drag files here or click to upload"}),(0,j.jsx)("p",{className:"ant-upload-hint",children:"Support for multiple files. Each must be PDF, JPG, or PNG, and under 5MB."})]}),k&&k.length>0&&(0,j.jsx)("div",{style:{marginTop:12},children:k.map(e=>{const t=e.name||e.originFileObj&&e.originFileObj.name||"file",n=e.size||e.originFileObj&&e.originFileObj.size||0,a=e.type&&e.type.startsWith("image/")||/\.(jpe?g|png)$/i.test(t),s="application/pdf"===e.type||/\.pdf$/i.test(t);return(0,j.jsxs)("div",{className:"inquiry-file-item",style:{display:"flex",alignItems:"center",gap:12,padding:"8px 12px",border:"1px solid #f0f0f0",borderRadius:8,marginBottom:8},children:[(0,j.jsx)("div",{className:"inquiry-file-thumb",style:{width:48,height:48,display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa",borderRadius:6},children:a?(0,j.jsx)("img",{src:e.preview||e.originFileObj&&URL.createObjectURL(e.originFileObj),alt:t,style:{maxWidth:44,maxHeight:44,borderRadius:4}}):s?(0,j.jsx)("div",{style:{fontSize:20,color:"#ff4d4f"},children:"PDF"}):(0,j.jsx)("div",{style:{fontSize:20},children:"FILE"})}),(0,j.jsxs)("div",{style:{flex:1},children:[(0,j.jsx)("div",{style:{fontWeight:600},children:t}),(0,j.jsx)("div",{style:{color:"#8c8c8c",fontSize:12},children:q(n)})]}),(0,j.jsxs)("div",{className:"inquiry-file-actions",style:{display:"flex",gap:8},children:[(0,j.jsx)(u.Ay,{type:"link",onClick:()=>{const t=e.url||e.preview||e.originFileObj&&URL.createObjectURL(e.originFileObj);t&&window.open(t,"_blank")},children:"Preview"}),(0,j.jsx)(u.Ay,{type:"link",danger:!0,onClick:()=>{const t=k.filter(t=>t.uid!==e.uid&&t.name!==e.name);N(t),p.setFieldsValue({attachment:t})},children:"Remove"})]})]},e.uid||e.name)})})]})]})]}),(0,j.jsx)(dt.A.Item,{children:(0,j.jsxs)(l.A,{justify:"end",gutter:[8,8],children:[(0,j.jsx)(o.A,{xs:24,sm:"auto",style:{display:"flex",justifyContent:"flex-end"},children:(0,j.jsx)(u.Ay,{type:"default",onClick:()=>{p.resetFields(),g(0),v(0),N([]),localStorage.removeItem(R)},block:!0,icon:(0,j.jsx)(wn.A,{}),style:{borderRadius:8,minWidth:120},children:"Reset"})}),(0,j.jsx)(o.A,{xs:24,sm:"auto",style:{display:"flex",justifyContent:"flex-end"},children:(0,j.jsx)(u.Ay,{type:"primary",loading:t,className:"inquiry-gradient-btn",block:!0,icon:(0,j.jsx)(C.A,{}),style:{borderRadius:8,fontWeight:600,fontSize:16,minWidth:160},onClick:async()=>{try{const e=await p.validateFields();D(e),_(!0)}catch(e){L()}},children:"Submit Inquiry"})})]})})]}),(0,j.jsx)(fe.A,{title:"Review your inquiry",open:T,onCancel:()=>_(!1),footer:[(0,j.jsx)(u.Ay,{onClick:()=>_(!1),children:"Edit"},"edit"),(0,j.jsx)(u.Ay,{type:"primary",onClick:async()=>{_(!1),await B(P)},children:"Confirm & Submit"},"confirm")],children:P&&(0,j.jsxs)(ya.A,{column:1,bordered:!0,children:[(0,j.jsx)(ya.A.Item,{label:"Inquiry Type",children:P.type}),(0,j.jsx)(ya.A.Item,{label:"Assign to Role",children:P.assignedRole}),(0,j.jsx)(ya.A.Item,{label:"Subject",children:P.subject}),(0,j.jsx)(ya.A.Item,{label:"Message",children:P.message}),(0,j.jsx)(ya.A.Item,{label:"Attachments",children:(k||[]).map(e=>e.name||e.originFileObj&&e.originFileObj.name).join(", ")})]})})]})})},wa=()=>{const e=(0,xe.Zp)();return(0,j.jsxs)("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#f4f6fa"},children:[(0,j.jsx)("h1",{style:{color:"#722ed1",fontWeight:700,fontSize:32},children:"You have been logged out"}),(0,j.jsx)("p",{style:{fontSize:18,margin:"16px 0 32px"},children:"Thank you for using the Barangay Information System."}),(0,j.jsx)(u.Ay,{type:"primary",size:"large",onClick:()=>e("/login",{replace:!0}),children:"Log In Again"})]})},Ia=()=>{const{logout:e}=De(),t=(0,xe.Zp)();return(0,s.useEffect)(()=>{e(),t("/login",{replace:!0})},[e,t]),null};var Sa=n(59977);const Ca=()=>{const[e,t]=(0,s.useState)(!1),[n,a]=(0,s.useState)([]),[i,r]=(0,s.useState)(null),[l,o]=(0,s.useState)(null),[c,m]=(0,s.useState)(null),x=(0,xe.Zp)();(0,s.useEffect)(()=>{(async()=>{t(!0);try{const e=await A.contactAPI.getAllInquiries();a(Array.isArray(e)?e:e&&e.items?e.items:[])}catch(e){console.error("Failed to load inquiries",e),Gt.Ay.error({message:"Failed to load inquiries"}),a([])}finally{t(!1)}})()},[]);const g=(0,s.useMemo)(()=>Array.from(new Set(n.map(e=>e.type||"General"))),[n]),y=(0,s.useMemo)(()=>(n||[]).filter(e=>{if(i&&(!e.status||e.status.toString().toLowerCase()!==i.toLowerCase()))return!1;const t=e.type||"General";if(l&&t.toString().toLowerCase()!==l.toString().toLowerCase())return!1;if(c&&c[0]&&c[1]&&e.createdAt)try{const t=c[0].toDate?c[0].toDate():new Date(c[0]),n=c[1].toDate?c[1].toDate():new Date(c[1]),a=new Date(e.createdAt);if(a<t||a>n)return!1}catch(n){}return!0}),[n,i,l,c]);return(0,j.jsxs)("div",{children:[(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[(0,j.jsx)(h.A.Title,{level:4,style:{margin:0},children:"Inquiry Tracker"}),(0,j.jsxs)(h.A.Text,{type:"secondary",children:["Showing ",n.length," records"]})]}),(0,j.jsxs)(p.A,{spinning:e,children:[(0,j.jsx)("div",{style:{marginBottom:12,display:"flex",justifyContent:"flex-end"},children:(0,j.jsxs)(Oe.A,{children:[(0,j.jsxs)(d.A,{allowClear:!0,placeholder:"Status",style:{width:160},value:null!==i&&void 0!==i?i:void 0,onChange:e=>r(e||null),children:[(0,j.jsx)(d.A.Option,{value:"open",children:"Open"}),(0,j.jsx)(d.A.Option,{value:"in-progress",children:"In Progress"}),(0,j.jsx)(d.A.Option,{value:"resolved",children:"Resolved"})]}),(0,j.jsx)(d.A,{allowClear:!0,placeholder:"Type",style:{width:180},value:null!==l&&void 0!==l?l:void 0,onChange:e=>o(e||null),children:g.map(e=>(0,j.jsx)(d.A.Option,{value:e,children:e},e))}),(0,j.jsx)(jn.A.RangePicker,{onChange:e=>m(e?e.filter(Boolean):null)}),(0,j.jsx)(u.Ay,{onClick:()=>{r(null),o(null),m(null)},children:"Reset"})]})}),0!==y.length||e?(0,j.jsxs)(zt.A,{dataSource:y.slice().sort((e,t)=>(new Date(t.createdAt).getTime()||0)-(new Date(e.createdAt).getTime()||0)),rowKey:e=>e._id,pagination:{pageSize:12},onRow:e=>({onClick:()=>{x("/staff/inbox",{state:{openInquiryId:e._id}})}}),children:[(0,j.jsx)(zt.A.Column,{title:"Name",dataIndex:"username",render:(e,t)=>e||t.residentName||t.subject||"Unknown"},"username"),(0,j.jsx)(zt.A.Column,{title:"Type of Inquiry",dataIndex:"type",render:e=>e?String(e):"General"},"type"),(0,j.jsx)(zt.A.Column,{title:"Status",dataIndex:"status",render:e=>(e=>{const t=(e||"").toString().toLowerCase();return(0,j.jsx)(f.A,{color:{pending:"gold",open:"gold",approved:"success",resolved:"green",rejected:"error"}[t]||"default",children:(e||"").toUpperCase()||"UNKNOWN"})})(e)},"status"),(0,j.jsx)(zt.A.Column,{title:"Date Inquired",dataIndex:"createdAt",render:e=>(0,Sa.Y)(e)},"createdAt"),(0,j.jsx)(zt.A.Column,{title:"Date Resolved",dataIndex:"updatedAt",render:(e,t)=>t.status&&"resolved"===t.status.toString().toLowerCase()?(0,Sa.Y)(e):""},"updatedAt")]}):(0,j.jsx)(Zt.A,{description:"No inquiries"})]})]})};var ka=n(74117);const Na=e=>{let{visible:t,onClose:n,onCreated:a,defaultBarangayID:r,defaultUsername:l,defaultEmail:o}=e;const[d]=dt.A.useForm(),[u,h]=s.useState(!1);s.useEffect(()=>{t?d.setFieldsValue({barangayID:r||void 0,username:l||void 0,email:o||void 0}):d.resetFields()},[t,r,l,o,d]);return(0,j.jsx)(fe.A,{title:"Create Resident Info",visible:t,onOk:async()=>{try{const e=await d.validateFields();h(!0);const t={firstName:e.firstName,lastName:e.lastName,barangayID:r||e.barangayID||"",username:l||e.username||"",email:o||e.email||""},s=await A.axiosInstance.put("/resident/personal-info",t);i.Ay.success("Resident container created"),a(s.data),d.resetFields(),n()}catch(s){var e,t;console.error("Failed to create resident container",s),null!==s&&void 0!==s&&null!==(e=s.response)&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.message?i.Ay.error(s.response.data.message):i.Ay.error("Failed to create resident container")}finally{h(!1)}},onCancel:()=>{d.resetFields(),n()},confirmLoading:u,children:(0,j.jsxs)(dt.A,{form:d,layout:"vertical",children:[(0,j.jsx)(dt.A.Item,{name:"firstName",label:"First name",rules:[{required:!0,message:"First name is required"}],children:(0,j.jsx)(c.A,{})}),(0,j.jsx)(dt.A.Item,{name:"lastName",label:"Last name",rules:[{required:!0,message:"Last name is required"}],children:(0,j.jsx)(c.A,{})}),(0,j.jsx)(dt.A.Item,{name:"barangayID",label:"Barangay ID",children:(0,j.jsx)(c.A,{disabled:!0})}),(0,j.jsx)(dt.A.Item,{name:"username",label:"Username",children:(0,j.jsx)(c.A,{disabled:!0})}),(0,j.jsx)(dt.A.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Invalid email"}],children:(0,j.jsx)(c.A,{disabled:!0})})]})})};function Ta(){const[e,t]=(0,s.useState)(null),[n,m]=(0,s.useState)(!1),[p,x]=(0,s.useState)(!1),{setUser:g}=De(),{t:f,i18n:y}=(0,ka.Bd)(),[b,w]=(0,s.useState)(null),[I,S]=(0,s.useState)([]),[C,k]=(0,s.useState)(!1),[N,T]=(0,s.useState)(null),[_,P]=(0,s.useState)(!1),[D,R]=(0,s.useState)(!1),[q,B]=(0,s.useState)(!1),[L,U]=(0,s.useState)(!1),[O,z]=(0,s.useState)(null),[F,E]=(0,s.useState)(null),[M,W]=(0,s.useState)("");(0,s.useEffect)(()=>{A.axiosInstance.get("/resident/profile").then(e=>{var n;if(w(e.data),T(e.data),null!==(n=e.data)&&void 0!==n&&n.profileImage){const n=e.data.profileImage.startsWith("http")?e.data.profileImage:"".concat(window.location.origin).concat(e.data.profileImage);t(n)}}),A.residentPersonalInfoAPI.getPersonalInfo().then(e=>{if(z(e),E(e),null!==e&&void 0!==e&&e.profileImage){const n=e.profileImage.startsWith("http")?e.profileImage:"".concat(window.location.origin).concat(e.profileImage);t(n)}}).catch(e=>{e.response&&404===e.response.status&&(m(!0),z(null),E({firstName:"",lastName:"",age:void 0,birthDate:"",dateOfResidency:"",sex:"",civilStatus:"",facebook:"",email:"",contactNumber:"",emergencyContact:"",landlineNumber:"",spouseName:"",spouseAge:void 0,spouseBirthDate:"",spouseOccupation:"",spouseStatus:"",motherName:"",motherAge:void 0,motherBirthDate:"",motherOccupation:"",motherStatus:"",fatherName:"",fatherAge:void 0,fatherBirthDate:"",fatherOccupation:"",fatherStatus:""}))}),A.axiosInstance.get("/resident/requests").then(e=>{S(e.data)})},[]),(0,s.useEffect)(()=>{const e=()=>{const e=(new Date).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/,/g,"");W(e)};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[]);const Y=e=>{N&&T((0,a.A)((0,a.A)({},N),{},{[e.target.name]:e.target.value}))},H=e=>{F&&E((0,a.A)((0,a.A)({},F),{},{[e.target.name]:e.target.value}))};return(0,j.jsxs)("div",{className:"max-w-3xl mx-auto p-6",children:[(0,j.jsxs)(r.A,{style:{background:"linear-gradient(90deg, #f7f8fa 0%, #e0e7ff 100%)",borderRadius:16,boxShadow:"0 4px 24px #40c9ff22",marginBottom:32,border:"none",padding:0},styles:{body:{padding:"24px 32px",display:"flex",alignItems:"center",justifyContent:"space-between"}},variant:"outlined",children:[(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:18},children:[(0,j.jsx)("div",{style:{width:96,height:96,borderRadius:12,overflow:"hidden",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},children:e?(0,j.jsx)("img",{src:e,alt:"avatar",style:{width:96,height:96,objectFit:"cover"}}):(0,j.jsx)(v,{user:(()=>{let e=b;if(!e)try{const t=localStorage.getItem("userProfile");t&&(e=JSON.parse(t))}catch(t){}return e})(),size:96})}),(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Title,{level:3,style:{margin:0,fontWeight:800},children:(null===b||void 0===b?void 0:b.username)||(null===b||void 0===b?void 0:b.email)||"Resident"}),(0,j.jsxs)(h.A.Text,{type:"secondary",children:["Barangay ID: ",(null===b||void 0===b?void 0:b.barangayID)||"N/A"]}),(0,j.jsx)("div",{style:{marginTop:8},children:(0,j.jsx)(h.A.Text,{type:"secondary",children:M})})]})]}),(0,j.jsx)("div",{children:(0,j.jsx)(Z.A,{showUploadList:!1,accept:"image/*",customRequest:async e=>{let{file:n,onSuccess:a,onError:s}=e;try{await(async e=>{if(!e)return;const n=new FileReader;n.onload=e=>{var n;return t(null===(n=e.target)||void 0===n?void 0:n.result)},n.readAsDataURL(e);const a=new FormData;a.append("avatar",e);try{var s,r;const e=await A.axiosInstance.post("/resident/personal-info/avatar",a,{headers:{"Content-Type":"multipart/form-data"}}),n=null===(s=e.data)||void 0===s?void 0:s.resident,o=null===(r=e.data)||void 0===r?void 0:r.user;if(n){if(z(n),E(n),n.profileImage){const e=n.profileImage.startsWith("http")?n.profileImage:"".concat(window.location.origin).concat(n.profileImage);t(e)}m(!1),i.Ay.success("Profile image updated")}else i.Ay.success("Profile image updated");if(o){try{"function"===typeof g?g(o):localStorage.setItem("userProfile",JSON.stringify(o))}catch(l){}try{const e=new CustomEvent("userProfileUpdated",{detail:o});window.dispatchEvent(e)}catch(l){}}}catch(l){i.Ay.error("Failed to upload avatar")}})(n),"function"===typeof a&&a("ok")}catch(r){"function"===typeof s&&s(r)}},children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(ee.A,{}),children:"Replace / Upload Profile Picture"})})})]}),n&&(0,j.jsx)("div",{style:{marginBottom:16},children:(0,j.jsx)(Rn.A,{message:"Your resident profile is incomplete",description:(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{children:"We couldn't find your resident information. Please create your resident profile so you can upload documents and profile pictures."}),(0,j.jsx)(u.Ay,{type:"primary",onClick:()=>x(!0),children:"Create Resident Info"})]}),showIcon:!0})}),(0,j.jsx)(Na,{visible:p,onClose:()=>x(!1),onCreated:e=>{z(e),E(e),m(!1)},defaultBarangayID:(null===b||void 0===b?void 0:b.barangayID)||"",defaultUsername:(null===b||void 0===b?void 0:b.username)||"",defaultEmail:(null===b||void 0===b?void 0:b.email)||""}),(0,j.jsx)(r.A,{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e3e6f3 40%, #f6f1f7 100%)",borderRadius:20,boxShadow:"0 8px 32px #bfc7d6cc",marginBottom:32,border:"none",backdropFilter:"blur(2px)"},styles:{body:{padding:40}},variant:"outlined",children:(0,j.jsxs)("div",{style:{maxWidth:900,margin:"0 auto"},children:[(0,j.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:24,letterSpacing:1,textAlign:"left",fontSize:28,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:f("userInformation")}),N&&(0,j.jsxs)(dt.A,{layout:"vertical",children:[(0,j.jsxs)(l.A,{gutter:24,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{label:f("username"),children:(0,j.jsx)(c.A,{name:"username",value:N.username,onChange:Y,disabled:!q})})}),(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{label:f("email"),children:(0,j.jsx)(c.A,{name:"email",value:N.email,onChange:Y,disabled:!q})})})]}),(0,j.jsxs)(l.A,{gutter:24,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{label:f("address"),children:(0,j.jsx)(c.A,{name:"address",value:N.address,onChange:Y,disabled:!q})})}),(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{label:f("contactNumber"),children:(0,j.jsx)(c.A,{name:"contactNumber",value:N.contactNumber,onChange:Y,disabled:!q})})})]}),(0,j.jsxs)(l.A,{gutter:24,children:[(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{label:f("barangayID")||"Barangay ID",children:(0,j.jsx)(c.A,{name:"barangayID",value:N.barangayID,disabled:!0})})}),(0,j.jsx)(o.A,{span:12,children:(0,j.jsx)(dt.A.Item,{label:f("role")||"Role",children:(0,j.jsx)(c.A,{name:"role",value:N.role,disabled:!0})})})]}),(0,j.jsxs)(Oe.A,{style:{marginTop:24},children:[q?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(u.Ay,{type:"primary",onClick:async()=>{if(N)try{const e=(()=>{let e=N.firstName||"",t=N.lastName||"";if((!e||!t)&&b&&b.fullName){const n=b.fullName.trim().split(" ");e=e||n[0]||"",t=t||(n.length>1?n.slice(1).join(" "):"")}return e=e||(null===b||void 0===b?void 0:b.username)||(null===b||void 0===b?void 0:b.email)||"Resident",t=t||"User",{first:e,last:t}})(),t={firstName:e.first,lastName:e.last,barangayID:(null===N||void 0===N?void 0:N.barangayID)||(null===b||void 0===b?void 0:b.barangayID)||"",email:(null===N||void 0===N?void 0:N.email)||(null===b||void 0===b?void 0:b.email)||"",contactNumber:(null===N||void 0===N?void 0:N.contactNumber)||(null===b||void 0===b?void 0:b.contactNumber)||"",address:(null===N||void 0===N?void 0:N.address)||(null===b||void 0===b?void 0:b.address)||""},n=await A.axiosInstance.put("/resident/personal-info",t);n&&n.data?w((0,a.A)((0,a.A)({},b),n.data)):w((0,a.A)((0,a.A)({},b),t)),B(!1),i.Ay.success("Profile saved")}catch(e){if(console.error("Failed to save user info:",e),null!==e&&void 0!==e&&e.response&&e.response.data){const t=e.response.data;if(t.errors){const e=Object.values(t.errors).map(e=>e.toString()).join("; ");i.Ay.error(e||t.message||"Validation error")}else i.Ay.error(t.message||"Failed to save")}else i.Ay.error("Failed to save user info")}},style:{background:"linear-gradient(90deg, #43e97b 0%, #38f9d7 100%)",border:"none",fontWeight:600},children:"Save"}),(0,j.jsx)(u.Ay,{onClick:()=>{B(!1),T(b)},children:"Cancel"})]}):(0,j.jsx)(u.Ay,{onClick:()=>B(!0),style:{fontWeight:600},children:"Edit"}),(0,j.jsx)(u.Ay,{type:"dashed",onClick:async()=>{R(!0);try{var e;const t=await A.axiosInstance.post("/resident/request-staff-access"),n=(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.message)||"Request sent to admin for staff access";!t||200!==t.status&&201!==t.status?i.Ay.info(n):(i.Ay.success(n),P(!0))}catch(a){var t,n;console.error("Request staff access failed:",a);const e=a,s=(null===e||void 0===e||null===(t=e.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||(null===e||void 0===e?void 0:e.message)||"Failed to send staff access request";i.Ay.error(s)}finally{R(!1)}},disabled:_||D,style:{color:"#341f97",borderColor:"#341f97",fontWeight:600},children:_?"Request Sent":"Request Staff Access"})]})]})]})}),F&&(0,j.jsx)(r.A,{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e3e6f3 40%, #f6f1f7 100%)",borderRadius:20,boxShadow:"0 8px 32px #bfc7d6cc",marginBottom:32,border:"none",backdropFilter:"blur(2px)"},styles:{body:{padding:40}},variant:"outlined",children:(0,j.jsxs)(dt.A,{layout:"vertical",style:{maxWidth:900,margin:"0 auto"},children:[(0,j.jsx)(h.A.Title,{level:2,style:{fontWeight:900,marginBottom:24,letterSpacing:1,textAlign:"left",fontSize:34,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Resident Information"}),(0,j.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Personal Information"}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"First Name",children:(0,j.jsx)(c.A,{name:"firstName",value:F.firstName,onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Middle Name",children:(0,j.jsx)(c.A,{name:"middleName",value:F.middleName||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Last Name",children:(0,j.jsx)(c.A,{name:"lastName",value:F.lastName,onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Age",children:(0,j.jsx)(c.A,{name:"age",type:"number",value:F.age||"",onChange:H,disabled:!L})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Birth Date",children:(0,j.jsx)(c.A,{name:"birthDate",type:"date",value:F.birthDate||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Place of Birth",children:(0,j.jsx)(c.A,{name:"placeOfBirth",value:F.placeOfBirth||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Nationality",children:(0,j.jsx)(c.A,{name:"nationality",value:F.nationality||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Religion",children:(0,j.jsx)(c.A,{name:"religion",value:F.religion||"",onChange:H,disabled:!L})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Date of Residency",children:(0,j.jsx)(c.A,{name:"dateOfResidency",type:"date",value:F.dateOfResidency||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Sex",children:(0,j.jsxs)(d.A,{value:F.sex||"",onChange:e=>E(t=>t?(0,a.A)((0,a.A)({},t),{},{sex:e}):t),disabled:!L,children:[(0,j.jsx)(d.A.Option,{value:"",children:"Select"}),(0,j.jsx)(d.A.Option,{value:"Male",children:"Male"}),(0,j.jsx)(d.A.Option,{value:"Female",children:"Female"}),(0,j.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Blood Type",children:(0,j.jsx)(c.A,{name:"bloodType",value:F.bloodType||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Disability Status",children:(0,j.jsx)(c.A,{name:"disabilityStatus",value:F.disabilityStatus||"",onChange:H,disabled:!L})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Passport Number",children:(0,j.jsx)(c.A,{name:"passportNumber",value:F.passportNumber||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Government ID Number",children:(0,j.jsx)(c.A,{name:"governmentIdNumber",value:F.governmentIdNumber||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Occupation",children:(0,j.jsx)(c.A,{name:"occupation",value:F.occupation||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Educational Attainment",children:(0,j.jsx)(c.A,{name:"educationalAttainment",value:F.educationalAttainment||"",onChange:H,disabled:!L})})})]}),(0,j.jsx)(l.A,{gutter:16,children:(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Civil Status",children:(0,j.jsxs)(d.A,{value:F.civilStatus||"",onChange:e=>E(t=>t?(0,a.A)((0,a.A)({},t),{},{civilStatus:e}):t),disabled:!L,children:[(0,j.jsx)(d.A.Option,{value:"",children:"Select"}),(0,j.jsx)(d.A.Option,{value:"Single",children:"Single"}),(0,j.jsx)(d.A.Option,{value:"Married",children:"Married"}),(0,j.jsx)(d.A.Option,{value:"Widowed",children:"Widowed"}),(0,j.jsx)(d.A.Option,{value:"Divorced",children:"Divorced"}),(0,j.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,j.jsx)(d.A.Option,{value:"Annulled",children:"Annulled"}),(0,j.jsx)(d.A.Option,{value:"Domestic Partnership",children:"Domestic Partnership"}),(0,j.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})})}),(0,j.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Social Media Information"}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Facebook",children:(0,j.jsx)(c.A,{name:"facebook",value:F.facebook||"",onChange:H,disabled:!L,placeholder:"Facebook profile/link"})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Valid Email",children:(0,j.jsx)(c.A,{name:"email",type:"email",value:F.email||"",onChange:H,disabled:!L,placeholder:"Email address"})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Contact Number",children:(0,j.jsx)(c.A,{name:"contactNumber",type:"number",value:F.contactNumber||"",onChange:H,disabled:!L,placeholder:"Contact No."})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Emergency Contact",children:(0,j.jsx)(c.A,{name:"emergencyContact",type:"number",value:F.emergencyContact||"",onChange:H,disabled:!L,placeholder:"Emergency contact number"})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Landline Number",children:(0,j.jsx)(c.A,{name:"landlineNumber",type:"number",value:F.landlineNumber||"",onChange:H,disabled:!L,placeholder:"Landline number"})})})]}),(0,j.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Family Information"}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Spouse Name",children:(0,j.jsx)(c.A,{name:"spouseName",value:F.spouseName||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Spouse Middle Name",children:(0,j.jsx)(c.A,{name:"spouseMiddleName",value:F.spouseMiddleName||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Spouse Last Name",children:(0,j.jsx)(c.A,{name:"spouseLastName",value:F.spouseLastName||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Spouse Age",children:(0,j.jsx)(c.A,{name:"spouseAge",type:"number",value:F.spouseAge||"",onChange:H,disabled:!L})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Spouse Birthdate",children:(0,j.jsx)(c.A,{name:"spouseBirthDate",type:"date",value:F.spouseBirthDate||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Spouse Nationality",children:(0,j.jsx)(c.A,{name:"spouseNationality",value:F.spouseNationality||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Spouse Occupation",children:(0,j.jsx)(c.A,{name:"spouseOccupation",value:F.spouseOccupation||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Spouse Contact Number",children:(0,j.jsx)(c.A,{name:"spouseContactNumber",value:F.spouseContactNumber||"",onChange:H,disabled:!L})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Spouse Status",children:(0,j.jsxs)(d.A,{value:F.spouseStatus||"",onChange:e=>E(t=>t?(0,a.A)((0,a.A)({},t),{},{spouseStatus:e}):t),disabled:!L,children:[(0,j.jsx)(d.A.Option,{value:"",children:"Select status"}),(0,j.jsx)(d.A.Option,{value:"Alive",children:"Alive"}),(0,j.jsx)(d.A.Option,{value:"Deceased",children:"Deceased"}),(0,j.jsx)(d.A.Option,{value:"Unknown",children:"Unknown"}),(0,j.jsx)(d.A.Option,{value:"Missing",children:"Missing"}),(0,j.jsx)(d.A.Option,{value:"Abroad",children:"Abroad"}),(0,j.jsx)(d.A.Option,{value:"With Family",children:"With Family"}),(0,j.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,j.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Number of Children",children:(0,j.jsx)(c.A,{name:"numberOfChildren",type:"number",value:F.numberOfChildren||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Children's Names",children:(0,j.jsx)(c.A,{name:"childrenNames",value:F.childrenNames||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Children's Ages",children:(0,j.jsx)(c.A,{name:"childrenAges",value:F.childrenAges||"",onChange:H,disabled:!L})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Emergency Contact Name",children:(0,j.jsx)(c.A,{name:"emergencyContactName",value:F.emergencyContactName||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:6,children:(0,j.jsx)(dt.A.Item,{label:"Emergency Contact Relationship",children:(0,j.jsx)(c.A,{name:"emergencyContactRelationship",value:F.emergencyContactRelationship||"",onChange:H,disabled:!L})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Mother's Name",children:(0,j.jsx)(c.A,{name:"motherName",value:F.motherName||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Mother's Age",children:(0,j.jsx)(c.A,{name:"motherAge",type:"number",value:F.motherAge||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Mother's Birthdate",children:(0,j.jsx)(c.A,{name:"motherBirthDate",type:"date",value:F.motherBirthDate||"",onChange:H,disabled:!L})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Mother's Occupation",children:(0,j.jsx)(c.A,{name:"motherOccupation",value:F.motherOccupation||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Mother's Status",children:(0,j.jsxs)(d.A,{value:F.motherStatus||"",onChange:e=>E(t=>t?(0,a.A)((0,a.A)({},t),{},{motherStatus:e}):t),disabled:!L,children:[(0,j.jsx)(d.A.Option,{value:"",children:"Select status"}),(0,j.jsx)(d.A.Option,{value:"Alive",children:"Alive"}),(0,j.jsx)(d.A.Option,{value:"Deceased",children:"Deceased"}),(0,j.jsx)(d.A.Option,{value:"Unknown",children:"Unknown"}),(0,j.jsx)(d.A.Option,{value:"Missing",children:"Missing"}),(0,j.jsx)(d.A.Option,{value:"Abroad",children:"Abroad"}),(0,j.jsx)(d.A.Option,{value:"With Family",children:"With Family"}),(0,j.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,j.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Father's Name",children:(0,j.jsx)(c.A,{name:"fatherName",value:F.fatherName||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Father's Age",children:(0,j.jsx)(c.A,{name:"fatherAge",type:"number",value:F.fatherAge||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Father's Birthdate",children:(0,j.jsx)(c.A,{name:"fatherBirthDate",type:"date",value:F.fatherBirthDate||"",onChange:H,disabled:!L})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Father's Occupation",children:(0,j.jsx)(c.A,{name:"fatherOccupation",value:F.fatherOccupation||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Father's Status",children:(0,j.jsxs)(d.A,{value:F.fatherStatus||"",onChange:e=>E(t=>t?(0,a.A)((0,a.A)({},t),{},{fatherStatus:e}):t),disabled:!L,children:[(0,j.jsx)(d.A.Option,{value:"",children:"Select status"}),(0,j.jsx)(d.A.Option,{value:"Alive",children:"Alive"}),(0,j.jsx)(d.A.Option,{value:"Deceased",children:"Deceased"}),(0,j.jsx)(d.A.Option,{value:"Unknown",children:"Unknown"}),(0,j.jsx)(d.A.Option,{value:"Missing",children:"Missing"}),(0,j.jsx)(d.A.Option,{value:"Abroad",children:"Abroad"}),(0,j.jsx)(d.A.Option,{value:"With Family",children:"With Family"}),(0,j.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,j.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})})]}),(0,j.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Business Information"}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Business Name",children:(0,j.jsx)(c.A,{name:"businessName",value:F.businessName||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Business Type",children:(0,j.jsxs)(d.A,{value:F.businessType||"",onChange:e=>E(t=>t?(0,a.A)((0,a.A)({},t),{},{businessType:e}):t),disabled:!L,children:[(0,j.jsx)(d.A.Option,{value:"",children:"Select"}),(0,j.jsx)(d.A.Option,{value:"Sole Proprietorship",children:"Sole Proprietorship"}),(0,j.jsx)(d.A.Option,{value:"Partnership",children:"Partnership"}),(0,j.jsx)(d.A.Option,{value:"Corporation",children:"Corporation"}),(0,j.jsx)(d.A.Option,{value:"Cooperative",children:"Cooperative"}),(0,j.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Nature of Business",children:(0,j.jsx)(c.A,{name:"natureOfBusiness",value:F.natureOfBusiness||"",onChange:H,disabled:!L})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Business Address",children:(0,j.jsx)(c.A,{name:"businessAddress",value:F.businessAddress||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Date Established",children:(0,j.jsx)(c.A,{name:"dateEstablished",type:"date",value:F.dateEstablished||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"TIN",children:(0,j.jsx)(c.A,{name:"tin",value:F.tin||"",onChange:H,disabled:!L})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"DTI/SEC/CDA Registration No.",children:(0,j.jsx)(c.A,{name:"registrationNumber",value:F.registrationNumber||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Business Permit No.",children:(0,j.jsx)(c.A,{name:"businessPermitNumber",value:F.businessPermitNumber||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Barangay Clearance No.",children:(0,j.jsx)(c.A,{name:"barangayClearanceNumber",value:F.barangayClearanceNumber||"",onChange:H,disabled:!L})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Number of Employees",children:(0,j.jsx)(c.A,{name:"numberOfEmployees",type:"number",value:F.numberOfEmployees||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Capital Investment",children:(0,j.jsx)(c.A,{name:"capitalInvestment",type:"number",value:F.capitalInvestment||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Annual Gross Income",children:(0,j.jsx)(c.A,{name:"annualGrossIncome",type:"number",value:F.annualGrossIncome||"",onChange:H,disabled:!L})})})]}),(0,j.jsxs)(l.A,{gutter:16,children:[(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Contact Person",children:(0,j.jsx)(c.A,{name:"businessContactPerson",value:F.businessContactPerson||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Contact Number",children:(0,j.jsx)(c.A,{name:"businessContactNumber",value:F.businessContactNumber||"",onChange:H,disabled:!L})})}),(0,j.jsx)(o.A,{span:8,children:(0,j.jsx)(dt.A.Item,{label:"Email Address",children:(0,j.jsx)(c.A,{name:"businessEmail",type:"email",value:F.businessEmail||"",onChange:H,disabled:!L})})})]}),(0,j.jsx)("div",{style:{display:"flex",gap:8,marginTop:16},children:L?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(u.Ay,{type:"primary",onClick:async()=>{F&&null!==b&&void 0!==b&&b._id&&(await A.residentPersonalInfoAPI.updatePersonalInfo((0,a.A)((0,a.A)({},F),{},{userId:b._id})),z(F),U(!1))},style:{fontWeight:600},children:"Save"}),(0,j.jsx)(u.Ay,{onClick:()=>{U(!1),E(O)},children:"Cancel"})]}):(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(u.Ay,{onClick:()=>U(!0),style:{fontWeight:600,marginRight:8},children:"Edit"}),O&&O.barangayID?(0,j.jsx)(u.Ay,{type:"primary",disabled:!0,style:{fontWeight:600,background:"#b2bec3",border:"none"},children:"Registered"}):(0,j.jsx)(u.Ay,{type:"primary",style:{fontWeight:600},onClick:async()=>{try{const e=(0,a.A)({barangayID:(null===N||void 0===N?void 0:N.barangayID)||"",username:(null===N||void 0===N?void 0:N.username)||""},F);await A.axiosInstance.post("/resident",e),alert("Resident registered successfully!")}catch(e){alert("Failed to register resident.")}},children:"Register"})]})})]})})]})}const _a=()=>(0,j.jsx)("div",{className:"landing-bg",style:{minHeight:"100vh",background:"linear-gradient(135deg, #40c9ff 0%, #e81cff 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif"},children:(0,j.jsxs)("div",{className:"floating-box",style:{background:"rgba(255,255,255,0.95)",boxShadow:"0 8px 32px 0 rgba(64,201,255,0.15)",borderRadius:24,padding:"48px 32px",textAlign:"center",maxWidth:420,width:"100%",animation:"float 2s infinite ease-in-out alternate",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,j.jsx)("img",{src:"".concat("","/logo-parian2.png"),alt:"Barangay Logo",style:{width:80,marginBottom:24}}),(0,j.jsxs)("h1",{className:"responsive-system-title",style:{fontSize:"1.7rem",marginBottom:24,fontWeight:800,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",letterSpacing:1,maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"pre-line",wordBreak:"break-word",textAlign:"center"},children:["Welcome to",(0,j.jsx)("br",{}),"Barangay Information Management System",(0,j.jsx)("br",{}),"Parian"]}),(0,j.jsx)("button",{className:"get-started-btn",style:{background:"linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",color:"#fff",border:"none",borderRadius:8,padding:"14px 40px",fontSize:"1.15rem",fontWeight:700,cursor:"pointer",boxShadow:"0 2px 8px #e81cff44",marginTop:8,transition:"background 0.2s"},onClick:()=>window.location.href="/login",onMouseOver:e=>e.currentTarget.style.background="linear-gradient(90deg, #40c9ff 0%, #e81cff 100%)",onMouseOut:e=>e.currentTarget.style.background="linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",children:"Get Started"})]})});var Pa=n(96603);const Da=()=>{const[e,t]=(0,s.useState)(!1),[n,a]=(0,s.useState)(!1),[i,l]=(0,s.useState)("link"),[o,d]=(0,s.useState)(null),[m,p]=(0,s.useState)(""),[x,g]=(0,s.useState)(!1),f=(0,xe.Zp)();return(0,j.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:24},children:(0,j.jsxs)(r.A,{style:{width:420,borderRadius:12},children:[(0,j.jsx)(h.A.Title,{level:3,style:{textAlign:"center"},children:"Forgot Password"}),n?(0,j.jsx)("div",{children:"otp"===i?(0,j.jsxs)("div",{children:[(0,j.jsxs)(h.A.Paragraph,{children:["Enter the 6-digit code sent to ",(0,j.jsx)("strong",{children:o})]}),(0,j.jsx)("div",{style:{display:"flex",justifyContent:"center",marginBottom:12},children:Array.from({length:6}).map((e,t)=>(0,j.jsx)("div",{style:{width:40,height:48,margin:4,border:"1px solid #ddd",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18},children:m[t]||""},t))}),(0,j.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:8,maxWidth:300,margin:"0 auto 12px"},children:[["1","2","3","4","5","6","7","8","9","0"].map(e=>(0,j.jsx)(u.Ay,{onClick:()=>(e=>{m.length>=6||p(t=>t+e)})(e),disabled:x,children:e},e)),(0,j.jsx)(u.Ay,{onClick:()=>p(e=>e.slice(0,-1)),disabled:x,children:"\u232b"}),(0,j.jsx)(u.Ay,{onClick:()=>p(""),disabled:x,children:"Clear"}),(0,j.jsx)(u.Ay,{type:"primary",onClick:async()=>{if(6===m.length){g(!0);try{var e;const t={token:m};o&&(t.email=o);const n=await A.axiosPublic.post("/auth/verify-otp",t);Gt.Ay.success({message:"If valid",description:(null===(e=n.data)||void 0===e?void 0:e.message)||"Check your email for the new temporary password."}),p(""),a(!1),d(null),f("/login")}catch(s){var t,n;const e=(null===s||void 0===s||null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||s.message||"Failed to verify code";Gt.Ay.error({message:"Error",description:e})}finally{g(!1)}}else Gt.Ay.error({message:"Enter code",description:"Please enter the 6-digit code."})},loading:x,disabled:x,children:"Verify"})]}),(0,j.jsx)(u.Ay,{type:"link",block:!0,onClick:()=>{a(!1),d(null)},children:"Back"})]}):(0,j.jsxs)("div",{children:[(0,j.jsx)(h.A.Paragraph,{children:"Check your email for password reset instructions."}),(0,j.jsx)(u.Ay,{type:"primary",block:!0,onClick:()=>f("/login"),children:"Back to login"})]})}):(0,j.jsxs)(dt.A,{layout:"vertical",onFinish:async e=>{t(!0);try{var n;const t=await A.axiosPublic.post("/auth/forgot-password",{email:e.email,mode:i});Gt.Ay.success({message:"Request sent",description:(null===(n=t.data)||void 0===n?void 0:n.message)||"Check your email for instructions."}),a(!0),d(e.email)}catch(l){var s,r;const e=(null===l||void 0===l||null===(s=l.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||l.message||"Failed to send reset email";Gt.Ay.error({message:"Error",description:e})}finally{t(!1)}},requiredMark:!1,children:[(0,j.jsx)(dt.A.Item,{label:"Choose how to receive reset instructions",children:(0,j.jsxs)(Pa.Ay.Group,{value:i,onChange:e=>l(e.target.value),children:[(0,j.jsx)(Pa.Ay,{value:"link",children:"Send reset link (email)"}),(0,j.jsx)(Pa.Ay,{value:"otp",children:"Send 6-digit code (email)"})]})}),(0,j.jsx)(dt.A.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Please input your email"},{type:"email",message:"Please enter a valid email"}],children:(0,j.jsx)(c.A,{placeholder:"you@example.com",size:"large"})}),(0,j.jsx)(dt.A.Item,{children:(0,j.jsx)(u.Ay,{type:"primary",htmlType:"submit",block:!0,loading:e,children:e?"Sending...":"otp"===i?"Send code":"Send reset link"})}),(0,j.jsx)(u.Ay,{type:"link",block:!0,onClick:()=>f("/login"),children:"Back to login"})]})]})})};var Ra=n(57692);const qa=()=>{const{token:e}=(0,xe.g)(),t=(0,xe.Zp)(),n=(0,xe.zy)(),a=new URLSearchParams(n.search).get("mode"),[i,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null),[m,p]=(0,s.useState)("");return(0,j.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:24},children:(0,j.jsxs)(r.A,{style:{width:420,borderRadius:12},children:[(0,j.jsx)(h.A.Title,{level:3,style:{textAlign:"center"},children:"Reset Password"}),(0,j.jsxs)(dt.A,{layout:"vertical",onFinish:async n=>{if(n.password!==n.confirm)return void Gt.Ay.error({message:"Passwords do not match"});if(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}$/.test(n.password)){l(!0);try{var s;let i;if(e)i=await A.axiosPublic.post("/auth/reset-password/".concat(e),{password:n.password});else if("otp"===a){if(!n.code)return Gt.Ay.error({message:"Please enter the 6-digit code sent to your email"}),void l(!1);i=await A.axiosPublic.post("/auth/reset-password",{token:n.code,password:n.password})}else i=await A.axiosPublic.post("/auth/reset-password",{token:n.code||"",password:n.password});Gt.Ay.success({message:"Password reset",description:(null===(s=i.data)||void 0===s?void 0:s.message)||"Your password has been reset. Please log in."}),t("/login")}catch(o){var i,r;const e=(null===o||void 0===o||null===(i=o.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.message)||o.message||"Failed to reset password";Gt.Ay.error({message:"Error",description:e})}finally{l(!1)}}else Gt.Ay.error({message:"Password does not meet complexity requirements. Use 8+ chars, mixed case, numbers and symbols."})},requiredMark:!1,children:["otp"===a&&!e&&(0,j.jsx)(dt.A.Item,{label:"6-digit code",name:"code",rules:[{required:!0,message:"Please input the 6-digit code sent to your email"},{len:6,message:"Code must be 6 digits"}],children:(0,j.jsx)(c.A,{placeholder:"123456",size:"large"})}),(0,j.jsx)(dt.A.Item,{label:"New password",name:"password",rules:[{required:!0,message:"Please input your new password"},{min:6,message:"Password must be at least 6 characters"}],children:(0,j.jsx)(c.A.Password,{size:"large",onChange:e=>(e=>{if(!e)return d(null),void p("");let t=0;e.length>=8&&(t+=2),/[A-Z]/.test(e)&&(t+=1),/[a-z]/.test(e)&&(t+=1),/\d/.test(e)&&(t+=1),/[^A-Za-z0-9]/.test(e)&&(t+=1);const n=Math.min(4,Math.floor(t/6*5));d(20*n),p(["Very weak","Weak","Fair","Good","Strong"][n]||"")})(e.target.value)})}),null!==o&&(0,j.jsxs)("div",{style:{marginBottom:12},children:[(0,j.jsx)(Ra.A,{percent:o,size:"small",status:o<40?"exception":"normal"}),(0,j.jsx)("div",{style:{textAlign:"right",fontSize:12,color:"#666"},children:m})]}),(0,j.jsx)(dt.A.Item,{label:"Confirm password",name:"confirm",rules:[{required:!0,message:"Please confirm your new password"}],children:(0,j.jsx)(c.A.Password,{size:"large"})}),(0,j.jsx)(dt.A.Item,{children:(0,j.jsx)(u.Ay,{type:"primary",htmlType:"submit",block:!0,loading:i,children:i?"Resetting...":"Reset password"})})]})]})})};var Ba=n(8295);const{Title:La,Text:Ua}=h.A,Oa=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!1),i=(0,xe.Zp)(),l=async()=>{a(!0);try{const e=await(0,A.getInbox)(),n=e&&e.data?e.data:[];t(Array.isArray(n)?n:[])}catch(e){console.error("Failed to fetch inbox messages",e),t([])}finally{a(!1)}};(0,s.useEffect)(()=>{l()},[]);return(0,j.jsx)(p.A,{spinning:n,children:(0,j.jsxs)("div",{style:{padding:24,backgroundColor:"#f0f2f5",minHeight:"100vh"},children:[(0,j.jsxs)(Oe.A,{style:{marginBottom:24},children:[(0,j.jsx)(u.Ay,{type:"default",icon:(0,j.jsx)(Ba.A,{}),onClick:()=>i("/admin/dashboard"),children:"Back to Dashboard"}),(0,j.jsx)(La,{level:4,style:{marginBottom:0},children:"Message Inbox"})]}),(0,j.jsx)(r.A,{children:(0,j.jsx)(g.A,{dataSource:Array.isArray(e)?e:[],renderItem:e=>(0,j.jsx)(g.A.Item,{actions:["unread"===e.status&&(0,j.jsx)(u.Ay,{size:"small",icon:(0,j.jsx)(sn.A,{}),onClick:()=>(async e=>{if(e._id&&"read"!==e.status){a(!0);try{await A.axiosInstance.patch("/messages/".concat(e._id,"/read")),await l()}catch(t){}finally{a(!1)}}})(e),children:"Mark Read"})].filter(Boolean),children:(0,j.jsx)(g.A.Item.Meta,{avatar:(0,j.jsx)(b,{icon:(0,j.jsx)(dn.A,{}),style:{backgroundColor:"read"===e.status?"#8c8c8c":"#1890ff"}}),title:(0,j.jsx)(Ua,{strong:!0,children:e.subject}),description:(0,j.jsxs)("div",{children:[(0,j.jsx)(Ua,{type:"secondary",children:new Date(e.createdAt).toLocaleString()}),"New Verification Request"===e.subject&&(0,j.jsxs)("div",{style:{marginTop:8},children:[(0,j.jsx)(Ua,{strong:!0,children:"Verification request submitted."}),(0,j.jsx)("div",{children:e.body})]})]})})}),locale:{emptyText:"No notifications"}})})]})})},za="DocumentHistory_wrapper__KIqBy",Fa="DocumentHistory_title__UmSIq",Ea="DocumentHistory_cardList__yg+X2",Ma="DocumentHistory_card__XzJRq",Wa="DocumentHistory_cardRow__guh8i",Ya="DocumentHistory_cardCol__Pu-Rr",Ha="DocumentHistory_cardLabel__525-6",Va="DocumentHistory_cardValue__sdvX8",Ga="DocumentHistory_rejected__tS2s+",Ka="DocumentHistory_completed__7G7DO",Ja=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!0),[i,l]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{const e=()=>l(window.innerWidth<=720);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{let e=!0;return(async()=>{a(!0);try{const n=await A.documentsAPI.getDocumentRecords();e&&t(Array.isArray(n)?n:[])}catch(n){console.error("Failed to load document history",n),e&&t([])}finally{e&&a(!1)}})(),()=>{e=!1}},[]),(0,j.jsxs)("div",{className:za,children:[(0,j.jsx)(h.A.Title,{level:3,className:Fa,children:"Document History"}),n?(0,j.jsx)(p.A,{}):i?(0,j.jsx)("div",{className:Ea,children:e.map(e=>(0,j.jsxs)(r.A,{className:Ma,children:[(0,j.jsxs)("div",{className:Wa,children:[(0,j.jsxs)("div",{className:Ya,children:[(0,j.jsx)("div",{className:Ha,children:"Requester"}),(0,j.jsx)("div",{className:Va,children:e.username||"Unknown"})]}),(0,j.jsxs)("div",{className:Ya,children:[(0,j.jsx)("div",{className:Ha,children:"Type"}),(0,j.jsx)("div",{className:Va,children:e.type||"Unknown"})]})]}),(0,j.jsxs)("div",{className:Wa,children:[(0,j.jsxs)("div",{className:Ya,children:[(0,j.jsx)("div",{className:Ha,children:"Txn ID"}),(0,j.jsx)("div",{className:Va,children:e.transactionCode||"\u2014"})]}),(0,j.jsxs)("div",{className:Ya,children:[(0,j.jsx)("div",{className:Ha,children:"Date Approved"}),(0,j.jsx)("div",{className:Va,children:e.completedAt||e.dateApproved||e.approvedAt?(0,Sa.Y)(e.completedAt||e.dateApproved||e.approvedAt):"\u2014"})]})]}),(0,j.jsx)("div",{style:{marginTop:8},children:e.status&&"rejected"===e.status.toString().toLowerCase()?(0,j.jsx)("div",{className:Ga,children:"Rejected"}):(0,j.jsx)("div",{className:Ka,children:"Completed"})})]},e._id))}):(0,j.jsx)(zt.A,{dataSource:e,rowKey:"_id",pagination:{pageSize:8},columns:[{title:"Requester Name",dataIndex:"username",key:"username",render:e=>e||"Unknown"},{title:"Transactional ID",dataIndex:"transactionCode",key:"transactionCode",render:e=>e||"\u2014"},{title:"Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Date Approved",dataIndex:"completedAt",key:"completedAt",render:(e,t)=>{const n=e||t.dateApproved||t.completedAt||t.approvedAt||null;if(!n)return"\u2014";try{return(0,Sa.Y)(n)}catch(a){return String(n)}}},{title:"Status",dataIndex:"status",key:"status",render:(e,t)=>{var n,a,s;const i=(null===(n=t.processedBy)||void 0===n?void 0:n.fullName)||(null===(a=t.processedBy)||void 0===a?void 0:a.username)||"Unknown",r=(null===(s=t.processedBy)||void 0===s?void 0:s.barangayID)||"Unknown";return e&&"rejected"===e.toLowerCase()?(0,j.jsxs)("span",{style:{color:"#FF3B3B",fontWeight:600},children:["Rejected by: ",i," (",r,")"]}):!e||"completed"!==e.toLowerCase()&&"approved"!==e.toLowerCase()?(0,j.jsx)("span",{children:e}):(0,j.jsxs)("span",{style:{color:"#43D96B",fontWeight:600},children:["Completed by: ",i," (",r,")"]})}}]})]})};var Za=n(27783),$a=n(75207);const{TextArea:Qa}=c.A,Xa=()=>{const[e,t]=(0,s.useState)(""),[n,a]=(0,s.useState)(null),[l,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)([]),[m,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(null),[v,b]=(0,s.useState)(null),[w,I]=(0,s.useState)(""),[S,C]=(0,s.useState)(null),{user:k}=De(),N=async()=>{if(!k||"admin"!==k.role)return;if(localStorage.getItem("token")){p(!0);try{const e=await A.adminAPI.listAdminAnnouncements();c(Array.isArray(e)?e:[])}catch(t){var e;401===(null===t||void 0===t||null===(e=t.response)||void 0===e?void 0:e.status)?i.Ay.error("Not authorized. Please sign in as an admin."):(console.error("Failed to load announcements",t),i.Ay.error("Failed to load announcements"))}finally{p(!1)}}};(0,s.useEffect)(()=>{"admin"===(null===k||void 0===k?void 0:k.role)&&N()},[k]);const T=()=>a(null);return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(r.A,{title:(0,j.jsx)(h.A.Title,{level:4,style:{margin:0},children:"admin"===(null===k||void 0===k?void 0:k.role)?"Post Announcement":"Announcements"}),children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:["admin"===(null===k||void 0===k?void 0:k.role)&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(Qa,{value:e,onChange:e=>t(e.target.value),rows:6,placeholder:"Write your announcement here"}),(0,j.jsx)(Z.A,{beforeUpload:e=>e.type.startsWith("image/")?(a(e),Z.A.LIST_IGNORE):(i.Ay.error("Only image files are allowed"),Z.A.LIST_IGNORE),onRemove:T,accept:"image/*",maxCount:1,showUploadList:{showPreviewIcon:!1},children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(ee.A,{}),children:"Upload Image (optional)"})}),n&&(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,color:"#237804"},children:[(0,j.jsx)(sn.A,{style:{color:"#52c41a"}}),(0,j.jsx)("span",{style:{fontWeight:600},children:"Image uploaded:"}),(0,j.jsx)("span",{style:{marginLeft:6},children:n.name}),(0,j.jsx)(u.Ay,{type:"text",icon:(0,j.jsx)($a.A,{}),onClick:T,style:{marginLeft:8}})]}),(0,j.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,j.jsx)(u.Ay,{type:"primary",onClick:async()=>{if(!e||""===e.trim())return i.Ay.warning("Announcement text cannot be empty");o(!0);try{const s=new FormData;s.append("text",e.trim()),n&&s.append("image",n,n.name),await A.adminAPI.createAnnouncement(s),i.Ay.success("Announcement posted"),t(""),a(null)}catch(l){var s,r;console.error("Failed to post announcement",l),i.Ay.error((null===l||void 0===l||null===(s=l.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||"Failed to post announcement")}finally{o(!1)}},loading:l,disabled:!e.trim(),children:"Post Announcement"})})]}),(0,j.jsxs)("div",{style:{marginTop:12},children:[(0,j.jsx)(h.A.Title,{level:5,style:{marginBottom:8},children:"Existing Announcements"}),(0,j.jsx)(g.A,{loading:m,dataSource:d,renderItem:e=>(0,j.jsxs)(g.A.Item,{actions:[(0,j.jsx)(y.A,{title:"View",placement:"top",children:(0,j.jsx)(u.Ay,{shape:"circle",size:"small",icon:(0,j.jsx)($.A,{}),onClick:()=>(e=>f(e))(e),"aria-label":"View announcement ".concat(e._id)})},"view"),"admin"===(null===k||void 0===k?void 0:k.role)?(0,j.jsx)(y.A,{title:"Edit",placement:"top",children:(0,j.jsx)(u.Ay,{shape:"circle",size:"small",icon:(0,j.jsx)(vn.A,{}),onClick:()=>(e=>{b(e),I(e.text||""),C(null)})(e),"aria-label":"Edit announcement ".concat(e._id)})},"edit"):null,"admin"===(null===k||void 0===k?void 0:k.role)?(0,j.jsx)(yn.A,{title:"Delete announcement?",onConfirm:async()=>{try{await A.adminAPI.deleteAnnouncement(e._id),i.Ay.success("Deleted"),N()}catch(t){console.error(t),i.Ay.error("Delete failed")}},children:(0,j.jsx)(y.A,{title:"Delete",placement:"top",children:(0,j.jsx)(u.Ay,{danger:!0,shape:"circle",size:"small",icon:(0,j.jsx)(X.A,{}),"aria-label":"Delete announcement ".concat(e._id)})})},"del"):null].filter(Boolean),children:[(0,j.jsx)(g.A.Item.Meta,{title:new Date(e.createdAt).toLocaleString(),description:e.text}),e.imagePath&&(0,j.jsx)(Za.A,{className:"rounded-img",width:80,src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image"))})]})})]})]})}),(0,j.jsx)(fe.A,{title:x?"Announcement - ".concat(new Date(x.createdAt).toLocaleString()):"Announcement",open:!!x,onCancel:()=>f(null),footer:[(0,j.jsx)(u.Ay,{onClick:()=>f(null),children:"Close"},"close")],children:x&&(0,j.jsxs)("div",{children:[(0,j.jsx)("p",{children:x.text}),x.imagePath&&(0,j.jsx)(Za.A,{className:"rounded-img rounded-img-lg",src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(x._id,"/image")),width:320})]})}),(0,j.jsx)(fe.A,{title:"Edit Announcement",open:!!v,onCancel:()=>{b(null),C(null),I("")},onOk:async()=>{if(v)try{const e=new FormData;e.append("text",w.trim()),S&&e.append("image",S,S.name),await A.adminAPI.updateAnnouncement(v._id,e),i.Ay.success("Updated"),b(null),C(null),I(""),N()}catch(e){console.error(e),i.Ay.error("Update failed")}},okText:"Save",children:(0,j.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,j.jsx)(Qa,{value:w,onChange:e=>I(e.target.value),rows:6}),(0,j.jsx)(Z.A,{beforeUpload:e=>e.type.startsWith("image/")?(C(e),Z.A.LIST_IGNORE):(i.Ay.error("Only image files are allowed"),Z.A.LIST_IGNORE),onRemove:()=>C(null),accept:"image/*",maxCount:1,showUploadList:{showPreviewIcon:!1},children:(0,j.jsx)(u.Ay,{icon:(0,j.jsx)(ee.A,{}),children:"Replace Image"})}),S&&(0,j.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,color:"#237804"},children:[(0,j.jsx)(sn.A,{style:{color:"#52c41a"}}),(0,j.jsx)("span",{style:{fontWeight:600},children:"New image selected:"}),(0,j.jsx)("span",{style:{marginLeft:6},children:null===S||void 0===S?void 0:S.name}),(0,j.jsx)(u.Ay,{type:"text",icon:(0,j.jsx)($a.A,{}),onClick:()=>C(null),style:{marginLeft:8}})]})]})})]})},{Title:es,Paragraph:ts}=h.A,ns=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!1),[i,l]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async()=>{a(!0);try{const e=await A.contactAPI.getAnnouncements();t(Array.isArray(e)?e:[])}catch(e){console.error("Failed to load announcements",e)}finally{a(!1)}})()},[]),(0,j.jsxs)(r.A,{title:(0,j.jsx)(es,{level:4,style:{margin:0},children:"Announcements"}),children:[0===e.length?(0,j.jsx)(Zt.A,{description:"No announcements"}):(0,j.jsx)(g.A,{loading:n,dataSource:e,renderItem:e=>(0,j.jsxs)(g.A.Item,{style:{cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},onClick:()=>l(e),children:[(0,j.jsx)("div",{style:{flex:1,minWidth:0},children:(0,j.jsx)(g.A.Item.Meta,{title:(0,j.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,j.jsx)("span",{children:new Date(e.createdAt).toLocaleString()})}),description:(0,j.jsx)(ts,{ellipsis:{rows:2},children:e.text})})}),e.imagePath&&(0,j.jsx)("div",{style:{marginLeft:12,width:80,display:"flex",justifyContent:"flex-end"},children:(0,j.jsx)(Za.A,{className:"rounded-img",width:72,height:48,src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image")),alt:"announcement",preview:!1})})]})}),(0,j.jsx)(fe.A,{open:!!i,onCancel:()=>l(null),footer:null,title:"Announcement",children:i&&(0,j.jsxs)("div",{children:[(0,j.jsx)(ts,{children:i.text}),i.imagePath&&(0,j.jsx)(Za.A,{className:"rounded-img rounded-img-lg",src:(0,A.getAbsoluteApiUrl)("/announcements/".concat(i._id,"/image")),alt:"announcement"})]})})]})},as=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!1),r=async()=>{a(!0);try{const e=await A.verificationAPI.getRequests();t(Array.isArray(e)?e:[])}catch(e){console.error(e),i.Ay.error("Failed to load verification requests")}finally{a(!1)}};(0,s.useEffect)(()=>{r()},[]);const l=[{title:"Resident",dataIndex:"userId",key:"user",render:e=>e?e.fullName||e.username||e.email:"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>(0,j.jsx)(f.A,{color:"pending"===e?"orange":"approved"===e?"green":"red",children:e})},{title:"Submitted",dataIndex:"createdAt",key:"createdAt",render:e=>new Date(e).toLocaleString()},{title:"Files",dataIndex:"gridFileIds",key:"files",render:e=>(0,j.jsx)(Oe.A,{children:e&&e.map(e=>(0,j.jsx)(u.Ay,{type:"link",href:(0,A.getAbsoluteApiUrl)("/verification/file/".concat(e)),target:"_blank",children:"Open"},e))})},{title:"Action",key:"action",render:(e,t)=>(0,j.jsxs)(Oe.A,{children:[(0,j.jsx)(u.Ay,{onClick:()=>(async e=>{a(!0);try{await A.verificationAPI.verifyUser(e,!0),i.Ay.success("User verified"),await r()}catch(t){console.error(t),i.Ay.error("Failed to verify user")}finally{a(!1)}})(t.userId._id||t.userId),type:"primary",children:"Verify"}),(0,j.jsx)(u.Ay,{danger:!0,onClick:()=>(async e=>{a(!0);try{var t;if(e&&e._id)try{await A.verificationAPI.rejectRequest(e._id)}catch(n){}const a=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;a&&await A.verificationAPI.verifyUser(a,!1),i.Ay.success("Verification request rejected"),await r()}catch(s){console.error(s),i.Ay.error("Failed to reject verification")}finally{a(!1)}})(t),children:"Reject"}),(0,j.jsx)(u.Ay,{type:"link",href:(0,A.getAbsoluteApiUrl)("/verification/file/".concat(t.gridFileIds&&t.gridFileIds[0]||"")),target:"_blank",children:"Check ID"})]})}];return(0,j.jsxs)("div",{style:{padding:24},children:[(0,j.jsx)("h2",{children:"Verification Requests"}),(0,j.jsx)(p.A,{spinning:n,children:(0,j.jsx)(zt.A,{rowKey:"_id",loading:n,dataSource:e,columns:l})})]})};const ss=(0,n(77990).A)({palette:{primary:{main:"#1976d2",light:"#42a5f5",dark:"#1565c0"},secondary:{main:"#9c27b0",light:"#ba68c8",dark:"#7b1fa2"}},typography:{fontFamily:["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif"].join(",")},components:{MuiButton:{styleOverrides:{root:{textTransform:"none"}}},MuiPaper:{styleOverrides:{root:{borderRadius:8}}}}}),is=()=>{const{user:e}=De();return e?"admin"===e.role?(0,j.jsx)(xe.C5,{to:"/admin/dashboard",replace:!0}):"staff"===e.role?(0,j.jsx)(xe.C5,{to:"/staff-dashboard",replace:!0}):(0,j.jsx)(xe.C5,{to:"/dashboard",replace:!0}):(0,j.jsx)(xe.C5,{to:"/login",replace:!0})},rs=()=>(0,j.jsxs)(Ce.A,{theme:ss,children:[(0,j.jsx)(ke.Ay,{}),(0,j.jsx)(Ne.Ay,{children:(0,j.jsx)(xe.Kd,{children:(0,j.jsx)(Be,{children:(0,j.jsxs)(xe.BV,{children:[(0,j.jsx)(xe.qh,{path:"/",element:(0,j.jsx)(_a,{})}),(0,j.jsx)(xe.qh,{path:"/redirect",element:(0,j.jsx)(is,{})}),(0,j.jsx)(xe.qh,{path:"/login",element:(0,j.jsx)(ft,{})}),(0,j.jsx)(xe.qh,{path:"/forgot-password",element:(0,j.jsx)(Da,{})}),(0,j.jsx)(xe.qh,{path:"/reset-password/:token",element:(0,j.jsx)(qa,{})}),(0,j.jsx)(xe.qh,{path:"/register",element:(0,j.jsx)(Ut,{})}),(0,j.jsx)(xe.qh,{path:"/goodbye",element:(0,j.jsx)(wa,{})}),(0,j.jsx)(xe.qh,{path:"/logout",element:(0,j.jsx)(Ia,{})}),(0,j.jsxs)(xe.qh,{element:(0,j.jsx)(it,{}),children:[(0,j.jsx)(xe.qh,{path:"/home",element:(0,j.jsx)(rt,{children:(0,j.jsx)(Ht,{})})}),(0,j.jsx)(xe.qh,{path:"/request",element:(0,j.jsx)(rt,{children:(0,j.jsx)(ga,{})})}),(0,j.jsx)(xe.qh,{path:"/dashboard",element:(0,j.jsx)(rt,{children:(0,j.jsx)(Ht,{})})}),(0,j.jsx)(xe.qh,{path:"/guest/dashboard",element:(0,j.jsx)(rt,{children:(0,j.jsx)(Vt,{})})}),(0,j.jsx)(xe.qh,{path:"/request-document",element:(0,j.jsx)(rt,{children:(0,j.jsx)(ga,{})})}),(0,j.jsx)(xe.qh,{path:"/contact",element:(0,j.jsx)(rt,{children:(0,j.jsx)(ba,{})})}),(0,j.jsx)(xe.qh,{path:"/inquiries",element:(0,j.jsx)(rt,{children:(0,j.jsx)(ba,{})})}),(0,j.jsx)(xe.qh,{path:"/inquiry-tracker",element:(0,j.jsx)(lt,{children:(0,j.jsx)(Ca,{})})}),(0,j.jsx)(xe.qh,{path:"/staff-dashboard",element:(0,j.jsx)(lt,{children:(0,j.jsx)(on,{})})}),(0,j.jsx)(xe.qh,{path:"/document-processing",element:(0,j.jsx)(lt,{children:s.createElement(n(81190).A)})}),(0,j.jsx)(xe.qh,{path:"/templates-manager",element:(0,j.jsx)(lt,{children:(0,j.jsx)(pe,{})})}),(0,j.jsx)(xe.qh,{path:"/staff/inbox",element:(0,j.jsx)(lt,{children:(0,j.jsx)(Se,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/dashboard",element:(0,j.jsx)(ot,{children:(0,j.jsx)(fn,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/messages",element:(0,j.jsx)(ot,{children:(0,j.jsx)(Oa,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/verification-requests",element:(0,j.jsx)(ot,{children:(0,j.jsx)(as,{})})}),(0,j.jsx)(xe.qh,{path:"/announcements",element:(0,j.jsx)(rt,{children:(0,j.jsx)(ns,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/announcements",element:(0,j.jsx)(ot,{children:(0,j.jsx)(Xa,{})})}),(0,j.jsx)(xe.qh,{path:"/admin",element:(0,j.jsx)(xe.C5,{to:"/admin/dashboard",replace:!0})}),(0,j.jsx)(xe.qh,{path:"/admin/users",element:(0,j.jsx)(ot,{children:(0,j.jsx)(Tn,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/activity",element:(0,j.jsx)(ot,{children:(0,j.jsx)(_n,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/statistics",element:(0,j.jsx)(ot,{children:(0,j.jsx)(Jn,{})})}),(0,j.jsx)(xe.qh,{path:"/admin/settings",element:(0,j.jsx)(ot,{children:(0,j.jsx)(ua,{})})}),(0,j.jsx)(xe.qh,{path:"/profile",element:(0,j.jsx)(rt,{children:(0,j.jsx)(Ta,{})})}),(0,j.jsx)(xe.qh,{path:"/document-history",element:(0,j.jsx)(rt,{children:(0,j.jsx)(Ja,{})})}),(0,j.jsx)(xe.qh,{path:"/inbox",element:(0,j.jsx)(rt,{children:(0,j.jsx)(J,{})})})]})]})})})})]})},81190:(e,t,n)=>{n.d(t,{A:()=>ee});var a=n(89379),s=n(65043);const i="DocumentProcessing_wrapper__mgdlQ",r="DocumentProcessing_pageTitle__6x0cP",l="DocumentProcessing_loadingWrap__6rGYa",o="DocumentProcessing_controls__oQbzN",d="DocumentProcessing_controlInput__WD8hf",c="DocumentProcessing_controlSelect__-KBnD",u="DocumentProcessing_controlDate__vbgUi",h="DocumentProcessing_mobileList__fzS+Q",m="DocumentProcessing_mobileCard__teinV",p="DocumentProcessing_mobileCardRow__ffMTN",x="DocumentProcessing_mobileMeta__0G75s",g="DocumentProcessing_iconWrap__AgQnd",f="DocumentProcessing_mobileTitleWrap__tkYpI",y="DocumentProcessing_mobileTitle__-0V-d",A="DocumentProcessing_mobileSubtitle__Z5HFo",j="DocumentProcessing_mobileActions__UKz34",v="DocumentProcessing_statusTag__xF-xu",b="DocumentProcessing_actionButtons__JVicD",w="DocumentProcessing_uploadDate__AiEGx",I="DocumentProcessing_modalContent__ZldTP",S="DocumentProcessing_previewWrapper__mLLdQ",C="DocumentProcessing_previewPane__ckBOK",k="DocumentProcessing_requestPane__EIwR2",N="DocumentProcessing_previewHtml__3X+05",T="DocumentProcessing_previewFooter__8KQ9W",_="DocumentProcessing_generateButton__hWg5N";var P=n(25352),D=n(91686),R=n(79617),q=n(89073),B=n(36621),L=n(65512),U=n(59772),O=n(70494),z=n(76399),F=n(15492),E=n(42524),M=n(6051),W=n(63942),Y=n(96603),H=n(80349),V=n(72411),G=n(48745),K=n(96891),J=n(49400),Z=n(61118),$=n(31694),Q=n(59977);var X=n(70579);const ee=()=>{var e,t,ee,te;const[ne,ae]=(0,s.useState)([]),[se,ie]=(0,s.useState)(!0),[re,le]=(0,s.useState)(!1),[oe,de]=(0,s.useState)(null),[ce,ue]=(0,s.useState)([]),[he,me]=(0,s.useState)({}),[pe,xe]=(0,s.useState)(!1),[ge,fe]=(0,s.useState)(""),[ye,Ae]=(0,s.useState)(!1),[je,ve]=(0,s.useState)([]),[be,we]=(0,s.useState)(""),[Ie,Se]=(0,s.useState)(null),[Ce,ke]=(0,s.useState)(!0),Ne=(0,s.useRef)({}),[Te,_e]=((0,s.useRef)(null),(0,s.useState)(null)),[Pe,De]=(0,s.useState)({}),[Re,qe]=(0,s.useState)(!1),[Be,Le]=(0,s.useState)([]),[Ue,Oe]=(0,s.useState)(null),[ze,Fe]=(0,s.useState)(null),[Ee,Me]=(0,s.useState)(null),[We,Ye]=(0,s.useState)(!1),[He,Ve]=(0,s.useState)(null),[Ge,Ke]=(0,s.useState)(!1),[Je,Ze]=(0,s.useState)(""),[$e,Qe]=(0,s.useState)(null),[Xe,et]=(0,s.useState)(null),[tt,nt]=(0,s.useState)(null),at=(0,P.zy)(),st=(0,P.Zp)(),it=at&&at.state&&at.state.openRequestId?at.state.openRequestId:null,rt=e=>{const t=he[e];return t?Array.isArray(t)?t:[t]:[]},lt=e=>{const t=rt(e);return t.length?t[0]:null},ot=e=>{const t=rt(e);if(!t||!t.length)return null;return t.find(e=>e.notes&&e.notes.toString().toLowerCase().includes("priority")||!0===e.priority)||t[0]},dt=async()=>{ie(!0);try{const e=await $.documentsAPI.listFiles(),t=await $.documentsAPI.getDocumentRecords(),n=Array.from(new Set((t||[]).map(e=>(e.type||"").toLowerCase()).filter(Boolean)));ue(n);const a={},s=e=>(e||"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase();e.forEach(e=>{if(!e||!e.filename)return;const n=s(e.filename),i=(t||[]).filter(e=>e.type&&n.includes(s(e.type)));i&&i.length&&(a[e._id]=i)});const i=e.filter(e=>{if(!e||!e.filename)return!1;if(0===n.length)return!0;const t=e.filename.replace(/[_\s]/g,"").toLowerCase();return n.some(e=>t.includes(e.replace(/[_\s]/g,"")))});ae(i),me(a)}catch(e){me({})}finally{ie(!1)}};(0,s.useEffect)(()=>{dt();const e=()=>Ke(window.innerWidth<=720);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{if(!it)return;const e=Object.keys(he).find(e=>(Array.isArray(he[e])?he[e]:he[e]?[he[e]]:[]).some(e=>(e._id||e.requestId)===it));if(e){const t=ne.find(t=>t._id===e);t&&(de(t),ct(t).then(()=>{Se(it),ut(it),xe(!0)}).catch(()=>{}))}else(async()=>{try{if($.documentsAPI.getDocumentById){const t=await $.documentsAPI.getDocumentById(it);if(t){ve([t]),Se(it);try{const e=t.fieldValues||{},n=Object.keys(e);if(n.length){const t="\n                    <table style=\"width:100%;border-collapse:collapse;\">\n                      <thead>\n                        <tr>\n                          <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Field</th>\n                          <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Submitted Value</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        ".concat(n.map(t=>"<tr><td style='border:1px solid #ccc;padding:8px;'>".concat(t,"</td><td style='border:1px solid #ccc;padding:8px;'>").concat(e[t]||"","</td></tr>")).join(""),"\n                      </tbody>\n                    </table>\n                    // when we open a preview for a request that wasn't tied to a specific file in mapping,\n                    // attempt to scroll to and highlight the request's entry if present in the UI\n                    setTimeout(() => {\n                      try {\n                        const el = rowRefs.current[openRequestIdFromNav];\n                        if (el && el.scrollIntoView) {\n                          el.scrollIntoView({ behavior: 'smooth', block: 'center' });\n                          el.classList.add('cv-highlight');\n                          if (highlightTimeoutRef.current) window.clearTimeout(highlightTimeoutRef.current);\n                          // remove highlight after 2s\n                          // @ts-ignore - window.setTimeout returns number in browser\n                          highlightTimeoutRef.current = window.setTimeout(() => el.classList.remove('cv-highlight'), 2000);\n                        }\n                      } catch (e) {}\n                    }, 120);\n                  ");fe(t)}else fe('<div style="color:#666">No submitted field values available.</div>')}catch(e){fe('<div style="color:red">Failed to build preview.</div>')}xe(!0)}}}catch(e){}})();try{st(at.pathname,{replace:!0,state:{}})}catch(t){}},[he,ne]);const ct=async e=>{xe(!0),Ae(!0),fe("");try{const t=(rt(e._id)||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase());ve(t);const a=ot(e._id),s=t[0]||null,i=a&&"pending"===(a.status||"").toString().toLowerCase()?a:null;Se(i?i._id||i.requestId:(null===s||void 0===s?void 0:s._id)||(null===s||void 0===s?void 0:s.requestId)||null);const r=await(await Promise.resolve().then(n.bind(n,31694))).axiosPublic.get("/documents/preview/".concat(e._id),{params:{format:"html"},responseType:"text"}),l=r&&r.data?r.data:"";we(l);const o=i?i._id||i.requestId:(null===s||void 0===s?void 0:s._id)||(null===s||void 0===s?void 0:s.requestId)||null;o&&await ut(o)}catch(t){fe('<div style="color:red">Failed to load preview.</div>')}Ae(!1)},ut=async e=>{try{const t=Object.values(he).flat().find(t=>(t._id||t.requestId)===e)||null,n=(null===t||void 0===t?void 0:t.fieldValues)||{},a=be||"",s=/\{(.*?)\}/g;let i;const r=[];for(;null!==(i=s.exec(a));)r.push(i[1].trim());if(r.length>0){const e="\n          <table style=\"width:100%;border-collapse:collapse;\">\n            <thead>\n              <tr>\n                <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Field</th>\n                <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Submitted Value</th>\n              </tr>\n            </thead>\n            <tbody>\n              ".concat(r.map(e=>{const t=n[e]||"";return"<tr><td style='border:1px solid #ccc;padding:8px;'>".concat(e,"</td><td style='border:1px solid #ccc;padding:8px;'>").concat(t,"</td></tr>")}).join(""),"\n            </tbody>\n          </table>\n        ");fe(e)}else fe('<div style="color:red">No { ... } content found.</div>')}catch(t){fe('<div style="color:red">Failed to load preview.</div>')}},ht=async e=>{de(e),await ct(e)};return se?(0,X.jsx)("div",{className:l,children:(0,X.jsx)(D.A,{size:"large"})}):(0,X.jsxs)("div",{className:i,children:[(0,X.jsx)(R.A.Title,{level:3,className:r}),(0,X.jsx)(q.A,{title:"Document Processing",extra:(0,X.jsxs)("div",{className:o,children:[(0,X.jsx)(B.A,{prefix:(0,X.jsx)(V.A,{}),placeholder:"Search documents",className:d,value:Je,onChange:e=>Ze(e.target.value),onPressEnter:()=>{}}),(0,X.jsx)(L.A,{allowClear:!0,placeholder:"Document Type",className:c,value:$e,onChange:e=>Qe(e),children:ce.map(e=>(0,X.jsx)(L.A.Option,{value:e,children:e},e))}),(0,X.jsxs)(L.A,{allowClear:!0,placeholder:"Status",className:c,value:Xe,onChange:e=>et(e),children:[(0,X.jsx)(L.A.Option,{value:"pending",children:"Pending"}),(0,X.jsx)(L.A.Option,{value:"approved",children:"Approved"}),(0,X.jsx)(L.A.Option,{value:"rejected",children:"Rejected"})]}),(0,X.jsx)(U.A.RangePicker,{className:u,onChange:e=>nt(e)})]}),children:Ge?(0,X.jsx)("div",{className:h,children:ne.filter(e=>{if(Je&&!(e.filename||"").toLowerCase().includes(Je.toLowerCase()))return!1;if($e&&(e.type||"").toLowerCase()!==$e.toLowerCase())return!1;const t=lt(e._id),n=(null===t||void 0===t?void 0:t.status)||"";if(Xe&&n.toLowerCase()!==Xe.toLowerCase())return!1;if(tt&&tt[0]&&tt[1]&&e.uploadDate){const t=new Date(e.uploadDate),n=tt[0].toDate(),a=tt[1].toDate();if(t<n||t>a)return!1}return!0}).map(e=>{const t=e.filename||"",n=(t.split(".").pop()||"").toLowerCase();let a=(0,X.jsx)(G.A,{style:{color:"#2B6CB0",fontSize:20}});"pdf"===n&&(a=(0,X.jsx)(K.A,{style:{color:"#E53E3E",fontSize:20}})),["png","jpg","jpeg","gif","svg","bmp"].includes(n)&&(a=(0,X.jsx)(J.A,{style:{color:"#319795",fontSize:20}}));const s=lt(e._id),i=(null===s||void 0===s?void 0:s.status)||"";return(0,X.jsx)(q.A,{size:"small",className:m,ref:t=>{const n=lt(e._id),a=n&&(n._id||n.requestId);a&&(Ne.current[a]=t)},children:(0,X.jsxs)("div",{className:p,children:[(0,X.jsxs)("div",{className:x,children:[(0,X.jsx)("div",{className:g,children:a}),(0,X.jsxs)("div",{className:f,children:[(0,X.jsx)(O.A,{title:t,children:(0,X.jsx)("div",{className:y,children:t.replace(/\.docx$/i,"")})}),(0,X.jsx)("div",{className:A,children:e.type||"Unknown"})]})]}),(0,X.jsxs)("div",{className:j,children:[(0,X.jsx)(z.A,{className:v,color:"pending"===i?"orange":"approved"===i?"green":"rejected"===i?"red":"default",children:(i||"").toUpperCase()}),(0,X.jsx)("div",{className:b,children:(0,X.jsx)(F.Ay,{size:"small",icon:(0,X.jsx)(Z.A,{}),onClick:()=>ht(e),children:Ge?null:"Preview"})}),(0,X.jsx)("div",{className:w,children:e.uploadDate?(0,Q.Y)(e.uploadDate):""})]})]})},e._id)})}):(0,X.jsx)(E.A,{rowKey:e=>e._id,dataSource:ne.filter(e=>{if(Je&&!(e.filename||"").toLowerCase().includes(Je.toLowerCase()))return!1;if($e&&(e.type||"").toLowerCase()!==$e.toLowerCase())return!1;const t=lt(e._id),n=(null===t||void 0===t?void 0:t.status)||"";if(Xe&&n.toLowerCase()!==Xe.toLowerCase())return!1;if(tt&&tt[0]&&tt[1]&&e.uploadDate){const t=new Date(e.uploadDate),n=tt[0].toDate(),a=tt[1].toDate();if(t<n||t>a)return!1}return!0}),pagination:{pageSize:10},columns:[{title:"File",dataIndex:"filename",key:"filename",sorter:(e,t)=>(e.filename||"").localeCompare(t.filename||""),render:(e,t)=>{const n=e||"",a=(n.split(".").pop()||"").toLowerCase();let s=(0,X.jsx)(G.A,{style:{color:"#2B6CB0"}});return"pdf"===a&&(s=(0,X.jsx)(K.A,{style:{color:"#E53E3E"}})),["png","jpg","jpeg","gif","svg","bmp"].includes(a)&&(s=(0,X.jsx)(J.A,{style:{color:"#319795"}})),(0,X.jsx)(O.A,{title:n,children:(0,X.jsx)("span",{style:{maxWidth:280,display:"inline-block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:(0,X.jsxs)(M.A,{align:"center",children:[s,(0,X.jsx)("span",{children:n.replace(/\.docx$/i,"")})]})})})}},{title:"Status",dataIndex:"status",key:"status",render:(e,t)=>{const n=t||{},a=n.metadata&&!0===n.metadata.online||("number"===typeof n.length?n.length>0:Boolean(n.contentType)),s=a?"ONLINE":"OFFLINE",i=a?"green":"red";return(0,X.jsx)(z.A,{color:i,children:s})}},{title:"Uploaded On",dataIndex:"uploadDate",key:"uploadDate",sorter:(e,t)=>new Date(e.uploadDate).getTime()-new Date(t.uploadDate).getTime(),render:e=>e?(0,Q.Y)(e):""},{title:"Actions",key:"actions",render:(e,t)=>(0,X.jsx)(M.A,{children:(0,X.jsx)(F.Ay,{size:"small",icon:(0,X.jsx)(Z.A,{}),onClick:()=>ht(t),children:"Preview"})})}],rowClassName:e=>"",onRow:e=>{const t=lt(e._id),n=t&&(t._id||t.requestId);return{ref:e=>{n&&(Ne.current[n]=e)}}}})}),(0,X.jsx)(W.A,{title:oe?oe.filename.replace(/\.docx$/i,""):"",open:re,onCancel:()=>le(!1),footer:null,width:800,children:oe?(0,X.jsx)("div",{className:I,children:(0,X.jsx)(E.A,{dataSource:[(0,a.A)((0,a.A)({},oe),{},{requesterName:(null===(e=lt(oe._id))||void 0===e?void 0:e.username)||(null===(t=lt(oe._id))||void 0===t?void 0:t.requesterName)||"Unknown",barangayID:(null===(ee=lt(oe._id))||void 0===ee?void 0:ee.barangayID)||"Unknown",status:(null===(te=lt(oe._id))||void 0===te?void 0:te.status)||"Unknown"})],pagination:!1,rowKey:"_id",columns:[{title:"Requester Name",dataIndex:"requesterName",key:"requesterName",render:e=>e||"Unknown"},{title:"Barangay ID",dataIndex:"barangayID",key:"barangayID",render:e=>e||"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>e||"Unknown"},{title:"Actions",key:"actions",render:(e,t)=>(0,X.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,X.jsx)("button",{style:{background:"#2196F3",color:"#fff",border:"none",borderRadius:6,padding:"4px 12px",cursor:"pointer",fontWeight:600},onClick:()=>ct(t),children:"Process"}),(0,X.jsx)("button",{style:{background:"#43D96B",color:"#fff",border:"none",borderRadius:6,padding:"4px 12px",cursor:"pointer",fontWeight:600},children:"Complete"}),(0,X.jsx)("button",{style:{background:"#FF3B3B",color:"#fff",border:"none",borderRadius:6,padding:"4px 12px",cursor:"pointer",fontWeight:600},children:"Reject"})]})}]})}):(0,X.jsx)(D.A,{})}),(0,X.jsx)(W.A,{title:"Generated / Processed Copy Saved",open:We,onCancel:()=>Ye(!1),footer:[(0,X.jsx)(F.Ay,{onClick:()=>Ye(!1),children:"Close"},"close")],children:(0,X.jsxs)("div",{children:[(0,X.jsx)("div",{style:{marginBottom:8},children:"A copy of the generated document was saved."}),Ee&&!He?(0,X.jsxs)("div",{style:{marginBottom:10},children:[(0,X.jsxs)("div",{style:{marginBottom:6},children:[(0,X.jsx)("strong",{children:"Generated metadata ID:"})," ",(0,X.jsx)("code",{children:Ee})]}),(0,X.jsx)("div",{children:(0,X.jsx)("a",{href:"".concat($.API_URL.replace(/\/$/,""),"/generated-documents/").concat(Ee,"/raw"),target:"_blank",rel:"noreferrer",children:"Open generated copy (generated_documents)"})})]}):null,He?(0,X.jsxs)("div",{children:[(0,X.jsxs)("div",{style:{marginBottom:6},children:[(0,X.jsx)("strong",{children:"Processed document ID:"})," ",(0,X.jsx)("code",{children:He})]}),(0,X.jsx)("div",{children:(0,X.jsx)("a",{href:"".concat($.API_URL.replace(/\/$/,""),"/processed-documents/").concat(He,"/raw"),target:"_blank",rel:"noreferrer",children:"Open processed copy (processed_documents)"})})]}):null,Ee||He?null:(0,X.jsx)("div",{children:"No saved copy id available."})]})}),(0,X.jsx)(W.A,{title:"Prioritize Request",open:Re,onCancel:()=>qe(!1),onOk:async()=>{if(Ue)try{if($.documentsAPI.prioritize)await $.documentsAPI.prioritize(Ue);else if($.documentsAPI.updateDocumentStatus){var e;let t=null;for(const e of Object.values(he)){const n=(Array.isArray(e)?e:[e]).find(e=>(e._id||e.requestId)===Ue);if(n){t=n;break}}const n=(null===(e=t)||void 0===e?void 0:e.status)||"pending";await $.documentsAPI.updateDocumentStatus(Ue,{status:n,notes:"PRIORITY"})}if(qe(!1),await dt(),ze)try{const e=rt(ze);let n=e.find(e=>(e._id||e.requestId)===Ue)||null;if(!n&&$.documentsAPI.getDocumentById)try{n=await $.documentsAPI.getDocumentById(Ue)}catch(t){n=null}me(n?t=>{const n=(0,a.A)({},t);return n[ze]=Array.isArray(e)?e:e?[e]:[],n}:e=>{try{const t=(0,a.A)({},e),n=t[ze],s=Array.isArray(n)?n.slice():n?[n]:[],i=s.findIndex(e=>(e._id||e.requestId)===Ue);return-1!==i&&(s[i]=(0,a.A)((0,a.A)({},s[i]),{},{priority:!0,notes:(s[i].notes||"")+" PRIORITY"})),t[ze]=s,t}catch(t){return e}})}catch(t){}if(oe&&ze&&oe._id===ze){const e=rt(ze);ve(e),Se(Ue),Ue&&await ut(Ue)}alert("Prioritization saved"),Fe(null)}catch(n){console.error(n),alert("Failed to prioritize")}else alert("Select a request to prioritize")},okText:"Save Priority",cancelText:"Cancel",okButtonProps:{disabled:0===Be.length||!Ue},children:0===Be.length?(0,X.jsx)("div",{children:"No other requests found for this document type."}):(0,X.jsx)(Y.Ay.Group,{onChange:e=>Oe(e.target.value),value:Ue,style:{display:"flex",flexDirection:"column",gap:8},children:Be.map(e=>(0,X.jsxs)(Y.Ay,{value:e.requestId||e.fileId,style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,X.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,X.jsx)("strong",{children:e.requesterName}),(0,X.jsx)("small",{style:{color:"#666"},children:e.createdAt?(0,Q.Y)(e.createdAt):""})]}),(0,X.jsx)("div",{style:{marginLeft:12},children:Ue===(e.requestId||e.fileId)?(0,X.jsx)(z.A,{color:"red",children:"Selected"}):null})]},e.requestId||e.fileId))})}),(0,X.jsx)(W.A,{title:oe?"Preview: ".concat(oe.filename.replace(/\.docx$/i,"")):"Preview",open:pe,onCancel:()=>xe(!1),footer:null,width:Ge?"100%":900,bodyStyle:{padding:Ge?10:void 0},children:ye?(0,X.jsx)(D.A,{}):(0,X.jsxs)(X.Fragment,{children:[Ge?(0,X.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:8},children:(0,X.jsx)(F.Ay,{size:"small",onClick:()=>ke(e=>!e),children:Ce?"Hide Requests":"Show Requests"})}):null,(0,X.jsxs)("div",{className:S,children:[(0,X.jsx)("div",{className:C,children:(0,X.jsx)("div",{className:N,dangerouslySetInnerHTML:{__html:ge}})}),Ce?(0,X.jsx)("div",{className:k,children:(0,X.jsxs)("div",{style:{marginTop:Ge?6:12,padding:8,border:"1px solid #eee",borderRadius:6},children:[(0,X.jsx)("div",{style:{marginBottom:8,fontWeight:600},children:"Select Request to Preview"}),(0,X.jsx)("div",{style:{maxHeight:300,overflowY:"auto",paddingRight:6},children:(0,X.jsx)(Y.Ay.Group,{value:Ie,onChange:async e=>{const t=e.target.value;Se(t),await ut(t)},style:{display:"flex",flexDirection:"column",gap:8},children:je&&je.length?je.map(e=>(0,X.jsx)(Y.Ay,{value:e._id||e.requestId,children:(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,X.jsxs)("div",{children:[(0,X.jsx)("div",{style:{fontWeight:600},children:e.username||e.requesterName||"Unknown"}),(0,X.jsx)("div",{style:{fontSize:12,color:"#666"},children:e.createdAt?(0,Q.Y)(e.createdAt):""})]}),(0,X.jsx)("div",{style:{alignSelf:"center"},children:e.notes&&e.notes.toString().toLowerCase().includes("priority")||e.priority?(0,X.jsx)(z.A,{color:"red",children:"PRIORITY"}):null})]})},e._id||e.requestId)):(0,X.jsx)("div",{style:{color:"#666"},children:"No pending requests available for this file."})})})]})}):null]}),(0,X.jsx)("div",{className:T,children:(0,X.jsx)("button",{className:_,onClick:async()=>{if(oe){try{var e;let i=null;if(Ie){i=rt(oe._id).find(e=>(e._id||e.requestId)===Ie)||null}if(i||(i=ot(oe._id)||lt(oe._id)),!i||!i.fieldValues)return void alert("No document request or field values found for this file.");const r=await async function(e,t,n){const a={fieldValues:t};n&&(a.requestId=n);const s=await $.axiosInstance.post("/documents/".concat(e,"/generate-filled"),a,{responseType:"blob"}),i=s.headers["content-disposition"]||s.headers["Content-Disposition"];let r="";if(i){const e=i.match(/filename\*=(?:UTF-8'')?([^;\n\r]+)/i),t=i.match(/filename="?([^";]+)"?/i);if(e&&e[1])try{r=decodeURIComponent(e[1].replace(/^UTF-8''/,""))}catch(m){r=e[1]}else t&&t[1]&&(r=t[1])}const l=s.headers["x-filled-file-id"]||s.headers["X-Filled-File-Id"]||null,o=s.headers["x-processed-gridfs-id"]||s.headers["X-Processed-GridFS-Id"]||null,d=o||l,c=s.headers["x-generated-doc-id"]||s.headers["X-Generated-Doc-Id"]||null,u=s.headers["x-processed-doc-id"]||s.headers["X-Processed-Doc-Id"]||null,h=s.headers["x-transaction-code"]||s.headers["X-Transaction-Code"]||null;return console.log("[generateFilledDocx] transactionCode=",h,"content-disposition filename=",r),{blob:s.data,filename:r,savedId:d,generatedCopyId:c,processedDocId:u,processedGridFsId:o,transactionCode:h}}(oe._id,i.fieldValues,i._id||i.requestId),l=r.blob,o=i&&(i.transactionCode||i.transactionId||i.txId||i.transaction_id||i._id||i.requestId)||r.transactionCode||r.generatedCopyId||r.processedDocId||null,d=o?String(o).replace(/[^a-zA-Z0-9-_.]/g,"_"):null,c=r.transactionCode||i&&i.transactionCode||d||null,u=c?"".concat(String(c).replace(/[^a-zA-Z0-9-_.]/g,"_"),".docx"):r.filename||"filled_".concat(oe.filename||"document",".docx"),h=window.URL.createObjectURL(new Blob([l],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"})),m=document.createElement("a");m.href=h,m.setAttribute("download",u),document.body.appendChild(m),m.click(),null===(e=m.parentNode)||void 0===e||e.removeChild(m),window.URL.revokeObjectURL(h);if(r.savedId||null){await dt();const e=r.processedDocId||null;e?(H.Ay.open({message:"Generated copy saved",description:(0,X.jsxs)("div",{children:["Saved to processed documents. ",(0,X.jsx)("a",{href:"".concat($.API_URL.replace(/\/$/,""),"/processed-documents/").concat(e,"/raw"),target:"_blank",rel:"noreferrer",children:"Open processed copy"})]}),duration:8}),Ve(e),Ye(!0)):H.Ay.open({message:"Generated document saved",description:"Saved to server processed documents.",duration:6}),r.generatedCopyId&&(Me(r.generatedCopyId),Ye(!0))}else try{const e=new FormData;e.append("file",new Blob([l],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),u),e.append("sourceTemplateId",oe._id||""),e.append("requestId",i._id||i.requestId||"");const n=$.API_URL.replace(/\/$/,"");let a=!1;const s=["".concat(n,"/processed-documents/upload"),"".concat(n,"/documents/upload-inline"),"".concat(n,"/documents/upload"),"".concat(n,"/documents"),"".concat(n,"/admin/documents/upload")];for(const i of s)try{if((await fetch(i,{method:"POST",body:e,credentials:"include"})).ok){a=!0;break}}catch(t){}if(a){await dt();const e=r.processedDocId||null;e?(H.Ay.open({message:"Generated copy saved",description:(0,X.jsxs)("div",{children:["Saved to processed documents. ",(0,X.jsx)("a",{href:"".concat($.API_URL.replace(/\/$/,""),"/processed-documents/").concat(e,"/raw"),target:"_blank",rel:"noreferrer",children:"Open processed copy"})]}),duration:8}),Ve(e),Ye(!0)):H.Ay.open({message:"Generated document uploaded",description:"Uploaded to server processed documents.",duration:6})}else console.warn("Upload fallback failed; generated file was downloaded but not uploaded to documents collection."),alert("Generated document downloaded. Server-side save not confirmed.")}catch(a){console.error("Upload fallback error",a),alert("Generated document downloaded but upload to server failed.")}try{let e=Ie;if(!e){const t=ot(oe._id)||lt(oe._id);e=t&&(t._id||t.requestId)||null}e&&($.documentsAPI.updateDocumentStatus?await $.documentsAPI.updateDocumentStatus(e,{status:"approved"}):await(await Promise.resolve().then(n.bind(n,31694))).axiosInstance.patch("/document-requests/".concat(e,"/process")),await dt(),xe(!1),alert("Request marked as completed."))}catch(s){console.warn("Failed to mark request complete after generation",(null===s||void 0===s?void 0:s.message)||s)}}catch(i){console.error("Generation error",i),alert("Failed to generate filled document.")}xe(!1)}},children:"Generate"})})]})})]})}}}]);
//# sourceMappingURL=582.96470211.chunk.js.map