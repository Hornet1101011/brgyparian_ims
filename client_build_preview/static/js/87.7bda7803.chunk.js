"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[87],{19087:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ts});var a=n(89379),s=n(65043),i=n(16569),r=n(89073),l=n(47419),o=n(11645),d=n(65512),c=n(36621),u=n(15492),h=n(79617),m=n(8354),p=n(91686),x=n(70644),g=n(54522),f=n(76399),y=n(45964),A=n(70494),j=n(58288),v=n(28795),b=n(42971),w=n(68397);const I="inbox_message-container__rX6C-",S="inbox_chatImage__YoIVB",C="inbox_inboxPage__qLICz",k="inbox_conversationList__V8Qfk",N="inbox_conversationCard__0ZhMt",T="inbox_replyBarWrap__NrUXO",_="inbox_replyBar__qUVby",P="inbox_sendButton__10H5U",D="inbox_listItem__TZQpm",R="inbox_listItemInner__+Z2ab",q="inbox_listItemMain__R3uU0",B="inbox_listItemHeader__h-API",L="inbox_typeIcon__ANjkn",O="inbox_listItemName__IGuuH",U="inbox_listItemSubject__MISAk",z="inbox_listItemTime__ly-VI",F="inbox_listItemPreview__QUfIX",E="inbox_listItemPreviewText__0W1MG",M="inbox_listItemResponses__BN1Uo",W="inbox_listItemAvatar__GZMLt";var Y=n(70579);const{Option:H}=d.A,V={status:"all",search:""};var G=n(31694);const K=()=>{const[e,t]=(0,s.useState)(!0),[n,H]=(0,s.useState)([]),[K,J]=(0,s.useState)(V),[Z,$]=(0,s.useState)("All"),[Q,X]=(0,s.useState)({}),[ee,te]=(0,s.useState)({}),[ne,ae]=(0,s.useState)(null),[se,ie]=(0,s.useState)(!1),[re,le]=(0,s.useState)(!1),[oe,de]=(0,s.useState)(!0),[ce,ue]=(0,s.useState)("undefined"!==typeof window&&window.innerWidth<=720),[he,me]=(0,s.useState)(""),[pe,xe]=(0,s.useState)([]),[ge,fe]=(0,s.useState)(!1),ye=(0,s.useRef)(null);(0,s.useEffect)(()=>{ye.current&&ye.current.scrollIntoView({behavior:"smooth"})},[ne,ne&&ne.responses&&ne.responses.length]);const Ae=(()=>{try{return localStorage.getItem("userProfile")?JSON.parse(localStorage.getItem("userProfile")||"null"):null}catch(e){return null}})();(0,s.useEffect)(()=>{t(!0),G.contactAPI.getMyInquiries().then(e=>{H(e||[])}).catch(()=>{i.Ay.error("Failed to load inbox.")}).finally(()=>t(!1))},[]),(0,s.useEffect)(()=>{const e=()=>{try{ue(window.innerWidth<=720)}catch(e){}};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{ce?(le(!0),de(!1)):(le(!1),de(!0))},[ce]);const je=n.filter(e=>{let t=!0;"pending"===K.status&&(t=!e.responses||0===e.responses.length),"responded"===K.status&&(t="resolved"===e.status||e.responses&&e.responses.length>0),"closed"===K.status&&(t="closed"===e.status);let n=!0;Z&&"All"!==Z&&(n=e.category===Z);const a=K.search.toLowerCase(),s=!a||e.residentName&&e.residentName.toLowerCase().includes(a)||e.category&&e.category.toLowerCase().includes(a)||e.subject&&e.subject.toLowerCase().includes(a)||e.createdAt&&new Date(e.createdAt).toLocaleString().toLowerCase().includes(a);return t&&s&&n}),ve=e=>{fe(!0),de(!1),le(!0),setTimeout(()=>{ae(e),fe(!1),ie(!0)},250)},be=e=>{if(!e)return"";const t=Date.now()-new Date(e).getTime(),n=Math.floor(t/6e4);if(n<1)return"just now";if(n<60)return"".concat(n,"m");const a=Math.floor(n/60);if(a<24)return"".concat(a,"h");const s=Math.floor(a/24);return"".concat(s,"d")},we=e=>{let{author:t,avatar:n,content:a,datetime:s,align:i="left"}=e;return(0,Y.jsx)("div",{style:{display:"flex",justifyContent:"left"===i?"flex-start":"flex-end"},children:(0,Y.jsxs)("div",{className:I,children:["left"===i&&n,(0,Y.jsxs)("div",{children:[(0,Y.jsx)("div",{style:{fontSize:13,fontWeight:600},children:t}),(0,Y.jsx)("div",{style:{marginTop:6},children:a}),s&&(0,Y.jsx)("div",{style:{marginTop:6,fontSize:12,color:"#777"},children:s})]}),"right"===i&&n]})})},Ie=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?";if(!e)return t;try{const n=String(e).trim();return n.length>0?n.charAt(0).toUpperCase():t}catch(n){return t}};return(0,Y.jsx)("div",{className:C,style:{minHeight:"100vh",background:"#f0f4f8",padding:"24px",fontFamily:"Poppins, Arial, sans-serif",position:"relative"},children:(0,Y.jsxs)(r.A,{style:{maxWidth:1200,margin:"0 auto",borderRadius:18,boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.08)",padding:0,background:"#fff"},bodyStyle:{padding:0,background:"#fff"},children:[(0,Y.jsxs)("div",{style:{padding:"24px 32px 0 32px"},children:[(0,Y.jsxs)(l.A,{gutter:[12,12],align:"middle",style:{marginBottom:12},children:[(0,Y.jsx)(o.A,{xs:24,sm:6,children:(0,Y.jsxs)(d.A,{value:Z,onChange:e=>$(e),style:{width:"100%"},children:[(0,Y.jsx)(d.A.Option,{value:"All",children:"All"}),(0,Y.jsx)(d.A.Option,{value:"Complaints",children:"Complaints"}),(0,Y.jsx)(d.A.Option,{value:"Requests",children:"Requests"}),(0,Y.jsx)(d.A.Option,{value:"Announcements",children:"Announcements"})]})}),(0,Y.jsx)(o.A,{xs:24,sm:12,children:(0,Y.jsx)(c.A.Search,{placeholder:"Search by date, name, or category",allowClear:!0,value:K.search,onChange:e=>J(t=>(0,a.A)((0,a.A)({},t),{},{search:e.target.value})),onSearch:e=>J(t=>(0,a.A)((0,a.A)({},t),{},{search:e}))})}),(0,Y.jsxs)(o.A,{xs:24,sm:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:8},children:[(0,Y.jsx)("div",{style:{flex:1}}),(0,Y.jsx)(u.Ay,{type:"text",onClick:()=>le(e=>!e),style:{borderRadius:8},title:re?"Show conversation list":"Hide conversation list",icon:re?(0,Y.jsx)(j.A,{}):(0,Y.jsx)(v.A,{})})]})]}),(0,Y.jsxs)(h.A.Title,{level:3,style:{marginBottom:0,color:"#1890ff",display:"flex",alignItems:"center",gap:8,fontFamily:"Poppins, Arial, sans-serif"},children:[(0,Y.jsx)("span",{role:"img","aria-label":"inbox",children:"\ud83d\udce9"})," Inbox"]})]}),(0,Y.jsx)(m.A,{style:{margin:"16px 0 0 0"}}),(0,Y.jsx)("div",{style:{padding:"0 32px 32px 32px"},children:e?(0,Y.jsx)(p.A,{}):0===je.length?(0,Y.jsx)(x.Ay,{icon:(0,Y.jsx)(b.A,{}),status:"info",title:"No messages yet",subTitle:"There are no messages in your inbox."}):(0,Y.jsxs)("div",{style:{display:"flex",gap:16},children:[re?(0,Y.jsxs)("div",{style:{width:72,maxHeight:500,overflowY:"auto",display:"flex",flexDirection:"column",alignItems:"center",gap:8,paddingTop:8},children:[(0,Y.jsx)(u.Ay,{type:"text",onClick:()=>le(!1),style:{borderRadius:8,background:"#fff",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},title:"Show list",children:(0,Y.jsx)(j.A,{})}),(0,Y.jsx)("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:8,padding:8},children:je.map(e=>{const t=e.residentName||e.username||e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||e.subject||"Unknown",n=t&&"Unknown"!==t?Ie(t,"?"):"?",a=ne&&ne._id===e._id;return(0,Y.jsx)(A.A,{title:"".concat(t," \u2014 ").concat(e.subject||"No subject"),placement:"right",children:(0,Y.jsx)("button",{onClick:()=>ve(e),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",padding:6,borderRadius:8,border:a?"2px solid #1890ff":"1px solid transparent",background:a?"#e6f7ff":"transparent",cursor:"pointer"},"aria-label":t,children:(0,Y.jsx)(y.A,{style:{background:"#1890ff",color:"#fff",fontWeight:700},size:36,children:n})})},e._id)})})]}):(0,Y.jsxs)("div",{className:k,style:{flex:oe?1:"0 0 300px",maxHeight:oe?"calc(100vh - 220px)":500,overflowY:"auto",position:"relative"},children:[(0,Y.jsx)(u.Ay,{type:"text",onClick:()=>le(!0),style:{position:"absolute",right:-12,top:-8,zIndex:10,borderRadius:8,background:"#fff",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},title:"Collapse list",children:(0,Y.jsx)(v.A,{})}),(0,Y.jsx)(g.A,{itemLayout:"vertical",dataSource:je,renderItem:e=>{const t="resolved"===e.status?(0,Y.jsx)(f.A,{color:"green",children:"Resolved"}):Array.isArray(e.responses)&&e.responses.length>0?null:(0,Y.jsx)(f.A,{color:"gold",children:"Pending"}),n=(()=>{switch((e.category||"").toLowerCase()){case"complaints":return"\ud83d\uded1";case"requests":return"\ud83d\udce8";case"announcements":return"\ud83d\udce3";default:return"\u2709\ufe0f"}})(),a=ne&&ne._id===e._id;return(0,Y.jsx)(g.A.Item,{className:D,style:{marginBottom:8,background:a?"#f7fbff":"#fff",borderRadius:12,border:"1px solid #e6edf3",boxShadow:"0 1px 4px rgba(31,38,135,0.04)",cursor:"pointer"},onClick:()=>ve(e),children:(0,Y.jsxs)("div",{className:R,children:[(0,Y.jsxs)("div",{className:q,children:[(0,Y.jsxs)("div",{className:B,children:[(0,Y.jsx)("span",{className:L,"aria-hidden":!0,children:n}),(0,Y.jsx)(h.A.Text,{strong:!0,className:O,children:e.residentName||e.username||e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||"Unknown"}),(0,Y.jsxs)(h.A.Text,{type:"secondary",className:U,children:["\u2014 ",e.subject||"No subject"]}),(0,Y.jsx)("span",{className:z,children:e.createdAt?be(e.createdAt):""}),t?s.cloneElement(t,{style:{fontSize:11,padding:"0 6px",marginLeft:8}}):null]}),(0,Y.jsx)("div",{className:F,children:(0,Y.jsx)(h.A.Text,{type:"secondary",className:E,children:e.message})}),(0,Y.jsx)("div",{className:M,children:Array.isArray(e.responses)&&e.responses.length>0?(0,Y.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:12},children:[e.responses.length," response(s)"]}):(0,Y.jsx)(h.A.Text,{type:"secondary",style:{fontSize:12},children:"No responses yet"})})]}),(0,Y.jsx)("div",{className:W,children:(()=>{const t=e.residentName||e.username||e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||e.subject||"Unknown",n=t&&"Unknown"!==t?Ie(t,"?"):"?";return(0,Y.jsx)(y.A,{style:{background:"#1890ff",color:"#fff",fontWeight:700},size:36,children:n})})()})]})})}})]}),!oe&&(0,Y.jsxs)("div",{style:{flex:1},children:[")",(0,Y.jsx)(r.A,{className:N,style:{borderRadius:12,height:"100%",background:"transparent",boxShadow:"none",border:"none"},bodyStyle:{display:"flex",flexDirection:"column",padding:0,gap:10,background:"transparent"},children:ne?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,Y.jsx)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:"resolved"===ne.status?(0,Y.jsx)(f.A,{color:"green",children:"Resolved"}):(0,Y.jsx)(f.A,{color:"gold",children:"Pending"})}),(0,Y.jsx)("div",{style:{flex:1},children:(()=>{const e=ne.residentName||ne.username||ne.subject||"Unknown";return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(h.A.Text,{strong:!0,style:{display:"block",textAlign:"right",fontSize:15},children:e}),(0,Y.jsx)(h.A.Text,{type:"secondary",style:{fontSize:10,display:"block",textAlign:"right"},children:ne.createdAt?new Date(ne.createdAt).toLocaleString():""})]})})()}),(()=>{const e=ne.residentName||ne.username||ne.createdBy&&(ne.createdBy.fullName||ne.createdBy.username)||ne.subject||"Unknown",t=e&&"Unknown"!==e?Ie(e,"?"):"?";return(0,Y.jsx)(y.A,{size:40,style:{background:"#1890ff"},children:t})})()]}),(0,Y.jsx)(m.A,{}),(0,Y.jsxs)("div",{style:{overflowY:"auto",flex:1,display:"flex",flexDirection:"column",gap:10,paddingRight:6,minHeight:0,maxHeight:220},children:[(0,Y.jsx)("div",{style:{alignSelf:"flex-end",maxWidth:"100%"},children:(()=>{const e=ne.residentName||ne.username||ne.createdBy&&(ne.createdBy.fullName||ne.createdBy.username)||"Resident",t=e&&"Resident"!==e?Ie(e,"U"):"U";return(0,Y.jsx)(we,{author:e,avatar:(0,Y.jsx)(y.A,{style:{background:"#1890ff"},children:t}),content:(0,Y.jsxs)("div",{style:{background:"#e6f7ff",padding:10,borderRadius:8},children:[(0,Y.jsx)(h.A.Paragraph,{style:{margin:0},children:ne.message}),ne.attachments&&ne.attachments.length>0&&(0,Y.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:ne.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,Y.jsx)("div",{children:s?(0,Y.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:(0,Y.jsx)("img",{src:n,alt:a,className:S})}):(0,Y.jsxs)("div",{children:[(0,Y.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,Y.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),datetime:(0,Y.jsx)("span",{style:{fontSize:12},children:ne.createdAt?new Date(ne.createdAt).toLocaleString():""}),align:"right"})})()}),Array.isArray(ne.responses)&&ne.responses.map((e,t)=>{let n=(e.role||e.authorRole||e.author_role||""||"").toString().toLowerCase();const a=e.author||e.authorName||e.author_name||e.createdByName||e.createdByFullName||e.userName||e.user||"",s=e.createdBy?String(e.createdBy):void 0,i=Ae&&(Ae._id||Ae.id)?String(Ae._id||Ae.id):void 0;if(!n)try{let t;ne&&(ne.createdBy&&"string"===typeof ne.createdBy?t=String(ne.createdBy):ne.createdBy&&"object"===typeof ne.createdBy&&(ne.createdBy._id||ne.createdBy.id)?t=String(ne.createdBy._id||ne.createdBy.id):ne.residentId&&(t=String(ne.residentId)));const i=ne&&(ne.residentName||ne.username)?String(ne.residentName||ne.username).toLowerCase():"",r=(a||e.authorName||"").toString().toLowerCase();(t&&s&&t===s||i&&r&&i===r)&&(n="resident")}catch(u){}let r;if(a&&""!==a.trim())r=a;else if(i&&s&&i===s)r="You";else if(e.authorName&&""!==e.authorName.trim())r=e.authorName;else if(e.createdBy&&"object"===typeof e.createdBy&&(e.createdBy.fullName||e.createdBy.username))r=e.createdBy.fullName||e.createdBy.username;else if(e.createdByName&&"string"===typeof e.createdByName&&""!==e.createdByName.trim())r=e.createdByName;else if(e.user&&"object"===typeof e.user&&(e.user.fullName||e.user.username))r=e.user.fullName||e.user.username;else if("resident"===n)r=ne&&(ne.residentName||ne.username)?ne.residentName||ne.username:"Resident";else{let t;try{if(s&&ne&&Array.isArray(ne.assignedTo)){const e=ne.assignedTo.find(e=>String(e._id)===String(s));e&&(t=e.fullName||e.username)}}catch(u){}r=e.staffName||e.staffFullName||e.createdBy&&"object"===typeof e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||t||"Staff"}const l="resident"===n||"user"===n,o=i&&s&&i===s,d=l||o?"right":"left",c=l||o?(0,Y.jsx)(y.A,{style:{background:"#1890ff"},children:Ie(r,"U")}):(0,Y.jsx)(y.A,{style:{background:"#666"},children:Ie(r,"B")});return(0,Y.jsx)("div",{style:{alignSelf:l||o?"flex-end":"flex-start",maxWidth:"100%"},children:(0,Y.jsx)(we,{author:o?"You":r,avatar:c,content:(0,Y.jsxs)("div",{style:{background:l||o?"#e6f7ff":"#f6f6f6",padding:10,borderRadius:8},children:[(0,Y.jsx)(h.A.Paragraph,{style:{margin:0},children:e.text}),e.attachments&&e.attachments.length>0&&(0,Y.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:e.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,Y.jsx)("div",{children:s?(0,Y.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:(0,Y.jsx)("img",{src:n,alt:a,className:S})}):(0,Y.jsxs)("div",{children:[(0,Y.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,Y.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),datetime:(0,Y.jsx)("span",{style:{fontSize:12},children:e.createdAt?new Date(e.createdAt).toLocaleString():""}),align:d})},t)}),(0,Y.jsx)("div",{ref:ye})]}),(0,Y.jsx)("div",{style:{marginTop:0,flexShrink:0},className:T,children:(0,Y.jsxs)("div",{className:_,style:{background:"#fff",paddingTop:4,paddingBottom:4,borderTop:"1px solid #f0f0f0",display:"flex",alignItems:"flex-end",gap:8},children:[(0,Y.jsx)("textarea",{value:he,onChange:e=>{me(e.target.value);const t=e.target;t.style.height="auto",t.style.height=Math.min(200,t.scrollHeight)+"px"},onKeyDown:async e=>{if("Enter"===e.key&&!e.shiftKey){if(e.preventDefault(),!he||""===he.trim())return i.Ay.warning("Reply cannot be empty");if(!ne||!ne._id)return i.Ay.error("No inquiry selected");const n=ne._id;te(e=>(0,a.A)((0,a.A)({},e),{},{[n]:!0}));try{const e=await G.contactAPI.respondToInquiry(ne._id,{response:he.trim()});H(t=>t.map(t=>t._id===e._id?e:t)),ae(e),me(""),i.Ay.success("Reply sent")}catch(t){console.error("Failed to send reply",t),i.Ay.error("Failed to send reply")}finally{te(e=>(0,a.A)((0,a.A)({},e),{},{[n]:!1}))}}},placeholder:"Type your reply...",style:{width:"100%",minHeight:40,maxHeight:200,resize:"none",padding:"10px 12px",borderRadius:12,border:"1px solid #e6edf3",boxShadow:"0 1px 4px rgba(15, 23, 42, 0.04)",fontSize:14,outline:"none",fontFamily:"Poppins, Arial, sans-serif",color:"#222"}}),(0,Y.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,Y.jsx)("button",{onClick:async()=>{if(!he||""===he.trim())return i.Ay.warning("Reply cannot be empty");if(!ne||!ne._id)return i.Ay.error("No inquiry selected");const e=ne._id;te(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!0}));try{const e=await G.contactAPI.respondToInquiry(ne._id,{response:he.trim()});H(t=>t.map(t=>t._id===e._id?e:t)),ae(e),me(""),i.Ay.success("Reply sent")}catch(t){console.error("Failed to send reply",t),i.Ay.error("Failed to send reply")}finally{te(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!1}))}},className:P,style:{background:"#0ea5a3",color:"#fff",border:"none",padding:"8px 14px",borderRadius:10,cursor:"pointer",fontSize:18,fontWeight:600,boxShadow:"0 4px 10px rgba(14,165,163,0.12)",display:"flex",alignItems:"center",justifyContent:"center"},title:"Send Reply",onMouseOver:e=>e.currentTarget.style.opacity="0.95",onMouseOut:e=>e.currentTarget.style.opacity="1",disabled:!(!ne||!ee[ne._id]),children:(0,Y.jsx)(w.A,{style:{fontSize:22,verticalAlign:"middle"}})})})]})})]}):(0,Y.jsx)("div",{style:{textAlign:"center",padding:32},children:(0,Y.jsx)(h.A.Text,{type:"secondary",children:"Select a message to view the conversation"})})})]})]})})]})})};var J=n(27297),Z=n(61118),$=n(92003),Q=n(9316),X=n(75698);const ee="TemplatesManager_wrapper__Ir6oJ",te="TemplatesManager_heading__IOTUf",ne="TemplatesManager_grid__HGJY6",ae="TemplatesManager_card__5oVoa",se="TemplatesManager_icon__Ngf7T",ie="TemplatesManager_cardBody__eAZm7",re="TemplatesManager_cardTitle__11PxV",le="TemplatesManager_actions__0blV1",oe="TemplatesManager_previewModal__MLCBR",de="TemplatesManager_previewHeader__hgaku",ce="TemplatesManager_previewTitle__uRp0+",ue="TemplatesManager_previewClose__uTvt8",he="TemplatesManager_uploadWrap__gDNYG",me=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(null),[r,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(!1),[c,h]=(0,s.useState)(null),[m,p]=(0,s.useState)(null),[x,g]=(0,s.useState)(null),[f,y]=(0,s.useState)("");return s.useEffect(()=>{(async()=>{d(!0),h(null);try{const e=await G.axiosPublic.get("/documents/list");t(e.data||[])}catch(e){h("Could not load templates.")}d(!1)})()},[]),(0,Y.jsxs)("div",{className:ee,children:[(0,Y.jsx)("h2",{className:te,children:"\ud83d\udcc2 Templates Manager"}),(0,Y.jsxs)("div",{style:{marginBottom:32},children:[(0,Y.jsx)("h3",{style:{fontWeight:"bold",fontSize:"1.1rem",marginBottom:"0.5rem",color:"#374151"}}),o&&(0,Y.jsx)("div",{children:"Loading templates..."}),c&&(0,Y.jsx)("div",{style:{color:"red"},children:c}),(0,Y.jsx)("div",{className:ne,children:e.filter(e=>e&&e.filename).map(e=>{return(0,Y.jsxs)("div",{className:ae,children:[(0,Y.jsx)("img",{src:"/word.png",alt:"Word Icon",className:se}),(0,Y.jsxs)("div",{className:ie,children:[(0,Y.jsx)("span",{className:re,children:(s=e.filename,s?s.replace(/_/g," ").replace(/\.docx$/,""):"Untitled")}),(0,Y.jsxs)("div",{className:le,children:[(0,Y.jsx)(A.A,{title:"Preview",children:(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(Z.A,{}),onClick:async t=>{if(t.stopPropagation(),n===e._id)return a(null),void y("");a(e._id),y("");try{const t=await G.axiosPublic.get("/documents/preview/".concat(e._id,"?format=html"),{responseType:"text"});y(t.data||"")}catch(s){y('<div style="color:red">Failed to load preview.</div>')}},children:"Preview"})}),(0,Y.jsx)(A.A,{title:"Download",children:(0,Y.jsx)(u.Ay,{type:"primary",icon:(0,Y.jsx)($.A,{}),onClick:async()=>{p(null);try{const t=(await G.axiosInstance.get("/documents/original/".concat(e._id),{responseType:"blob"})).data,n=window.URL.createObjectURL(t),a=document.createElement("a");a.href=n,a.download=e.filename,document.body.appendChild(a),a.click(),a.remove(),window.URL.revokeObjectURL(n)}catch(t){p("Failed to download ".concat(e.filename," from MongoDB."))}},children:"Download"})}),(0,Y.jsx)(A.A,{title:"Remove",children:(0,Y.jsx)(u.Ay,{danger:!0,icon:(0,Y.jsx)(Q.A,{}),onClick:async()=>{d(!0),h(null);try{const n=(await G.axiosInstance.delete("/documents/file/".concat(e._id))).data;if(n&&n.success){const e=await G.axiosPublic.get("/documents/list");t(e.data||[])}else h("Delete failed.")}catch(n){h("Delete failed.")}d(!1)},children:"Remove"})})]}),n===e._id&&f&&(0,Y.jsxs)("div",{className:oe,children:[(0,Y.jsxs)("div",{className:de,children:[(0,Y.jsx)("span",{className:ce,children:"Preview"}),(0,Y.jsx)("button",{className:ue,onClick:()=>{a(null),y("")},children:"Close"})]}),(0,Y.jsx)("div",{dangerouslySetInnerHTML:{__html:f}})]})]})]},e._id);var s})})]}),m&&(0,Y.jsx)("div",{style:{color:"red",marginBottom:16},children:m}),(0,Y.jsx)("div",{className:he,children:(0,Y.jsx)(J.A,{accept:".docx",showUploadList:!1,customRequest:async e=>{let{file:n,onSuccess:a,onError:s}=e;d(!0),h(null);const r=new FormData;r.append("file",n);try{const e=(await G.axiosInstance.post("/documents/upload",r,{headers:{"Content-Type":"multipart/form-data"}})).data;if(e&&e.success){const e=await G.axiosPublic.get("/documents/list");t(e.data||[]),i.Ay.success("Upload successful"),a&&a("ok")}else h("Upload failed."),i.Ay.error("Upload failed"),s&&s(new Error("Upload failed"))}catch(l){h("Upload failed."),i.Ay.error("Upload failed"),s&&s(new Error("Upload failed"))}d(!1)},children:(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(X.A,{}),type:"primary",children:"Upload .docx"})})})]})};var pe=n(25352),xe=n(23811),ge=n(63942);const fe="staffInbox_container__KxE+f",ye="staffInbox_listPanel__zpTLD",Ae="staffInbox_threadPanel__xFqlp",je="staffInbox_replyBar__iIm26",ve="staffInbox_replyTextarea__VFa9n";var be=n(73847),we=n(31219);const Ie=()=>{const[e,t]=(0,s.useState)(!0),[n,f]=(0,s.useState)([]),[A,j]=(0,s.useState)({status:"all",search:""}),[v,I]=(0,s.useState)("All"),[S,C]=(0,s.useState)(null),[k,N]=(0,s.useState)(""),[T,_]=(0,s.useState)({}),[P,D]=(0,s.useState)(!1),[R,q]=(0,s.useState)(!1),[B,L]=(0,s.useState)([]),O=(0,pe.zy)(),U=(0,s.useRef)(null);(0,s.useEffect)(()=>{z();const e=O&&O.state||{};if(e&&e.openInquiryId){const t=e.openInquiryId,a=setInterval(()=>{const e=n.find(e=>e._id===t);e&&(C(e),clearInterval(a))},200);setTimeout(async()=>{if(!n.find(e=>e._id===t))try{const e=await G.contactAPI.getInquiryById(t);e&&C(e)}catch(e){}},3e3)}},[]);const z=async()=>{t(!0);try{const e=await G.contactAPI.getAllInquiries();f(e||[])}catch(e){console.error("Failed to load inquiries",e)}finally{t(!1)}};(0,s.useEffect)(()=>{U.current&&U.current.scrollIntoView({behavior:"smooth"})},[S,S&&S.responses&&S.responses.length]);const F=e=>{if(!e)return"";const t=Date.now()-new Date(e).getTime(),n=Math.floor(t/6e4);if(n<1)return"just now";if(n<60)return"".concat(n,"m");const a=Math.floor(n/60);if(a<24)return"".concat(a,"h");const s=Math.floor(a/24);return"".concat(s,"d")},E=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?";if(!e)return t;try{const n=String(e).trim();return n.length?n.charAt(0).toUpperCase():t}catch(n){return t}},M=e=>{let{author:t,avatar:n,content:a,datetime:s,align:i="left"}=e;return(0,Y.jsx)("div",{style:{display:"flex",justifyContent:"left"===i?"flex-start":"flex-end"},children:(0,Y.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"flex-start",maxWidth:"80%"},children:["left"===i&&n,(0,Y.jsxs)("div",{children:[(0,Y.jsx)("div",{style:{fontSize:13,fontWeight:600},children:t}),(0,Y.jsx)("div",{style:{marginTop:6},children:a}),s&&(0,Y.jsx)("div",{style:{marginTop:6,fontSize:12,color:"#888"},children:s})]}),"right"===i&&n]})})},W=async()=>{if(!k||!S||!S._id)return;const e=S._id;_(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!0}));try{if(S.isNewThread){let e=S.residentUsername||S.username||S.userName||S.author||S.createdBy&&(S.createdBy.username||S.createdBy.userName),t=S.residentBarangayID||S.barangayID||S.createdBy&&S.createdBy.barangayID;if(e&&""!==e||!S.createdBy||("string"===typeof S.createdBy?e=S.createdBy:(S.createdBy.username||S.createdBy.userName)&&(e=S.createdBy.username||S.createdBy.userName),!t&&S.createdBy&&S.createdBy.barangayID&&(t=S.createdBy.barangayID)),(!e||""===e)&&Array.isArray(B)&&S.residentName){const n=B.find(e=>e.label&&e.label.toString().toLowerCase()===(S.residentName||"").toString().toLowerCase());n&&(e=n.username||e,t=n.barangayID||t)}const n=(0,a.A)((0,a.A)({type:"staff_message",subject:"Message to ".concat(S.residentName),message:k.trim()},e?{username:e}:{}),t?{barangayID:t}:{});if(!n.username)return i.Ay.error("Please select a resident to send this message to."),void console.warn("Blocked staff-created inquiry without recipient",{selectedInquiry:S,residents:B});console.debug("Submitting staff-created inquiry payload",n,{selectedInquirySummary:{residentName:S.residentName,residentUsername:S.residentUsername,residentBarangayID:S.residentBarangayID}});const s=await G.contactAPI.submitInquiry(n);i.Ay.success("Message sent to ".concat(S.residentName||n.username)),f(e=>[s].concat(e)),C(s),N("")}else{const t=await G.contactAPI.respondToInquiry(e,{response:k.trim()});f(e=>e.map(e=>e._id===t._id?t:e)),C(t),N("")}}catch(t){console.error("reply failed",t)}finally{_(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!1}))}},H=n.filter(e=>{let t=!0;"pending"===A.status&&(t=!e.responses||0===e.responses.length),"responded"===A.status&&(t="resolved"===e.status||e.responses&&e.responses.length>0),"closed"===A.status&&(t="closed"===e.status);let n=!0;v&&"All"!==v&&(n=e.category===v);const a=(A.search||"").toLowerCase(),s=!a||e.residentName&&e.residentName.toLowerCase().includes(a)||e.subject&&e.subject.toLowerCase().includes(a);return t&&n&&s});return(0,Y.jsx)("div",{style:{minHeight:"100vh",background:"#f7f9fb",padding:24},children:(0,Y.jsxs)(r.A,{style:{maxWidth:1200,margin:"0 auto",borderRadius:12},bodyStyle:{padding:0},children:[(0,Y.jsx)("div",{style:{padding:20},children:(0,Y.jsxs)(l.A,{gutter:[12,12],align:"middle",children:[(0,Y.jsx)(o.A,{xs:24,sm:6,children:(0,Y.jsxs)(d.A,{value:v,onChange:e=>I(e),style:{width:"100%"},children:[(0,Y.jsx)(d.A.Option,{value:"All",children:"All"}),(0,Y.jsx)(d.A.Option,{value:"Complaints",children:"Complaints"}),(0,Y.jsx)(d.A.Option,{value:"Requests",children:"Requests"}),(0,Y.jsx)(d.A.Option,{value:"Announcements",children:"Announcements"})]})}),(0,Y.jsx)(o.A,{xs:24,sm:12,children:(0,Y.jsx)(c.A.Search,{placeholder:"Search by name or subject",allowClear:!0,value:A.search,onChange:e=>j(t=>(0,a.A)((0,a.A)({},t),{},{search:e.target.value})),onSearch:e=>j(t=>(0,a.A)((0,a.A)({},t),{},{search:e}))})}),(0,Y.jsx)(o.A,{xs:24,sm:6,children:(0,Y.jsxs)(xe.A,{activeKey:A.status||"all",onChange:e=>j(t=>(0,a.A)((0,a.A)({},t),{},{status:e})),children:[(0,Y.jsx)(xe.A.TabPane,{tab:"All"},"all"),(0,Y.jsx)(xe.A.TabPane,{tab:"Pending"},"pending"),(0,Y.jsx)(xe.A.TabPane,{tab:(0,Y.jsxs)("span",{children:["Responded"," ",(0,Y.jsx)(u.Ay,{type:"link",size:"small",style:{marginLeft:20},icon:(0,Y.jsx)(be.A,{}),onClick:e=>{e.stopPropagation(),(async()=>{D(!0),q(!0);try{const e=(await G.adminAPI.getUsers()||[]).filter(e=>{const t=(e.role||e.type||"").toString().toLowerCase();return t.includes("resident")||!t.includes("admin")&&!t.includes("staff")}).map(e=>({label:e.fullName||(e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):e.username||e.email||e.name),username:e.username||e.userName||e.email||e._id,barangayID:e.barangayID||e.brgy||e.barangay&&(e.barangay.id||e.barangayID)}));L(e.filter(e=>e&&e.label))}catch(e){L([])}finally{q(!1)}})()}})]})},"responded")]})})]})}),(0,Y.jsx)(m.A,{style:{margin:0}}),(0,Y.jsx)(ge.A,{title:"Residents",visible:P,onCancel:()=>D(!1),footer:null,children:R?(0,Y.jsx)("div",{style:{textAlign:"center"},children:(0,Y.jsx)(p.A,{})}):0===B.length?(0,Y.jsx)(h.A.Text,{type:"secondary",children:"No residents found."}):(0,Y.jsx)(g.A,{dataSource:B,renderItem:e=>(0,Y.jsx)(g.A.Item,{style:{cursor:"pointer"},onClick:()=>{const t=e.label,a=e.username,s=e.barangayID,i=n.find(e=>{const n=(e.username||e.residentName||e.createdBy&&(e.createdBy.username||"")||"").toString().toLowerCase();return n&&(a?n===(a||"").toString().toLowerCase():n===(t||"").toString().toLowerCase())});if(i)C(i),D(!1);else{const e={_id:"new-".concat(Date.now()),residentName:t,residentUsername:a,residentBarangayID:s,message:"",responses:[],isNewThread:!0};C(e),console.debug("Resident selected for new thread",e),D(!1)}},children:(0,Y.jsx)(g.A.Item.Meta,{avatar:(0,Y.jsx)(y.A,{style:{background:"#1890ff"},children:E(e.label)}),title:e.label})})})}),(0,Y.jsx)("div",{style:{padding:16},children:e?(0,Y.jsx)(p.A,{}):0===H.length?(0,Y.jsx)(x.Ay,{icon:(0,Y.jsx)(b.A,{}),title:"No inquiries",subTitle:"There are no inquiries to show."}):(0,Y.jsxs)("div",{className:fe,children:[(0,Y.jsx)("div",{className:ye,children:(0,Y.jsx)(g.A,{dataSource:H,renderItem:e=>(0,Y.jsx)(g.A.Item,{onClick:()=>(e=>{C(e)})(e),style:{cursor:"pointer",marginBottom:8,borderRadius:8,padding:8,border:S&&S._id===e._id?"1px solid #1890ff":"1px solid #eee"},children:(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,Y.jsx)(y.A,{style:{background:"#1890ff"},children:E(e.residentName||e.username||e.subject,"?")}),(0,Y.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,Y.jsx)(h.A.Text,{strong:!0,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.residentName||e.username||"Unknown"}),(0,Y.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:12},children:["\u2014 ",e.subject||"No subject"]}),(0,Y.jsx)("span",{style:{marginLeft:"auto",fontSize:11},children:e.createdAt?F(e.createdAt):""})]}),(0,Y.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:13,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.message})]})]})})})}),(0,Y.jsx)("div",{className:Ae,children:(0,Y.jsx)(r.A,{style:{borderRadius:8},bodyStyle:{display:"flex",flexDirection:"column",gap:12,padding:12},children:S?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,Y.jsxs)("div",{style:{flex:1},children:[(0,Y.jsx)(h.A.Text,{strong:!0,style:{display:"block"},children:S.residentName||S.username||"Unknown"}),(0,Y.jsx)(h.A.Text,{type:"secondary",children:S.createdAt?new Date(S.createdAt).toLocaleString():""})]}),(0,Y.jsx)(y.A,{size:48,style:{background:"#1890ff"},children:E(S.residentName||S.username)})]}),(0,Y.jsx)(m.A,{}),(0,Y.jsxs)("div",{style:{overflowY:"auto",maxHeight:340},children:[(0,Y.jsxs)("div",{style:{marginBottom:8},children:[(0,Y.jsx)(h.A.Paragraph,{style:{margin:0},children:S.message}),S.attachments&&S.attachments.length>0&&(0,Y.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:S.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,Y.jsx)("div",{children:s?(0,Y.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:(0,Y.jsx)("img",{src:n,alt:a,style:{maxWidth:220,maxHeight:140,borderRadius:8,objectFit:"cover",border:"1px solid #f0f0f0"}})}):(0,Y.jsxs)("div",{children:[(0,Y.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,Y.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),Array.isArray(S.responses)&&S.responses.map((e,t)=>{let n=(e.role||e.authorRole||e.author_role||""||"").toString().toLowerCase();const a=e.author||e.authorName||e.author_name||e.createdByName||e.createdByFullName||e.userName||e.user||"",s=e.createdBy?String(e.createdBy):void 0;if(!n)try{let t;S&&(S.createdBy&&"string"===typeof S.createdBy?t=String(S.createdBy):S.createdBy&&"object"===typeof S.createdBy&&(S.createdBy._id||S.createdBy.id)?t=String(S.createdBy._id||S.createdBy.id):S.residentId&&(t=String(S.residentId)));const i=S&&(S.residentName||S.username)?String(S.residentName||S.username).toLowerCase():"",r=(a||e.authorName||"").toString().toLowerCase();(t&&s&&t===s||i&&r&&i===r)&&(n="resident")}catch(d){}let i;i=a&&""!==a.trim()?a:e.authorName&&""!==e.authorName.trim()?e.authorName:e.createdBy&&"object"===typeof e.createdBy&&(e.createdBy.fullName||e.createdBy.username)?e.createdBy.fullName||e.createdBy.username:"resident"===n?S&&(S.residentName||S.username)?S.residentName||S.username:"Resident":"Staff";const r="resident"===n||"user"===n,l=r?"right":"left",o=r?(0,Y.jsx)(y.A,{style:{background:"#1890ff"},children:E(i,"U")}):(0,Y.jsx)(y.A,{style:{background:"#666"},children:E(i,"B")});return(0,Y.jsx)("div",{style:{alignSelf:r?"flex-end":"flex-start",maxWidth:"100%"},children:(0,Y.jsx)(M,{author:i,avatar:o,content:(0,Y.jsxs)("div",{style:{background:r?"#e6f7ff":"#f6f6f6",padding:10,borderRadius:8},children:[(0,Y.jsx)(h.A.Paragraph,{style:{margin:0},children:e.text}),e.attachments&&e.attachments.length>0&&(0,Y.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:e.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,Y.jsx)("div",{children:s?(0,Y.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:(0,Y.jsx)("img",{src:n,alt:a,style:{maxWidth:220,maxHeight:140,borderRadius:8,objectFit:"cover",border:"1px solid #f0f0f0"}})}):(0,Y.jsxs)("div",{children:[(0,Y.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,Y.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),datetime:(0,Y.jsx)("span",{style:{fontSize:12},children:e.createdAt?new Date(e.createdAt).toLocaleString():""}),align:l})},t)}),(0,Y.jsx)("div",{ref:U})]}),(0,Y.jsxs)("div",{className:je,children:[(0,Y.jsx)("textarea",{value:k,onChange:e=>{N(e.target.value);const t=e.target;t.style.height="auto",t.style.height=Math.min(200,t.scrollHeight)+"px"},onKeyDown:async e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),await W())},placeholder:"Type your reply...",className:ve}),(0,Y.jsx)(u.Ay,{type:"primary",icon:(0,Y.jsx)(w.A,{}),loading:!(!S||!T[S._id]),onClick:W}),(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(we.A,{}),onClick:async()=>{if(!S||!S._id)return;const e=S._id;try{const t=await G.contactAPI.resolveInquiry(e);f(e=>e.map(e=>e._id===t._id?t:e)),C(t)}catch(t){console.error("resolve failed",t)}},children:"Resolve"})]})]}):(0,Y.jsx)("div",{style:{textAlign:"center",padding:32},children:(0,Y.jsx)(h.A.Text,{type:"secondary",children:"Select an inquiry to view details"})})})})]})})]})})};var Se=n(98086),Ce=n(34943),ke=n(50839),Ne=n(54420);const Te={isAuthenticated:!1,user:null,token:null},_e=(0,s.createContext)((0,a.A)((0,a.A)({},Te),{},{login:()=>{},logout:()=>{},isStaff:()=>!1,isAdmin:()=>!1,isResident:()=>!1,mode:"resident",switchMode:()=>{}})),Pe=()=>(0,s.useContext)(_e);function De(e){if(!e||"string"!==typeof e)return null;if(3!==e.split(".").length)return console.warn("safeDecodeJwt: token does not have 3 parts, skipping decode"),null;try{return(0,Ne.s)(e)}catch(t){return console.warn("safeDecodeJwt: failed to decode token",t),null}}const Re=(e,t)=>{switch(t.type){case"LOGIN":case"RESTORE_TOKEN":{let e=null;return e=De(t.payload),{isAuthenticated:!!e,token:e?t.payload:null,user:e}}case"LOGOUT":return Te;default:return e}},qe=e=>{let{children:t}=e;const[i,r]=(0,s.useReducer)(Re,Te);(0,s.useEffect)(()=>{try{const e=localStorage.getItem("userProfile");if(e){const t=JSON.parse(e);if(t&&t.username){const e=localStorage.getItem("token")||null,t=De(e);e&&t&&r({type:"LOGIN",payload:e})}}}catch(e){}},[]);const[l,o]=s.useState("resident"),d=(0,pe.Zp)();(0,s.useEffect)(()=>{const e=localStorage.getItem("token");e&&function(e){try{const t=De(e);if(!t)return!1;if(!t.exp)return!1;const n=Date.now()/1e3;return t.exp>n}catch(t){return!1}}(e)?(r({type:"RESTORE_TOKEN",payload:e}),(async()=>{try{const{authService:t}=await Promise.resolve().then(n.bind(n,31694)),a=await t.getCurrentUser();a&&(r({type:"LOGIN",payload:e}),localStorage.setItem("userProfile",JSON.stringify(a)))}catch(t){}})()):(localStorage.removeItem("token"),r({type:"LOGOUT"}))},[]),(0,s.useEffect)(()=>{const e=e=>{try{let t=null===e||void 0===e?void 0:e.detail;if(!t)return;t.user&&(t=t.user),t.data&&t.data.user&&(t=t.data.user);const n=i.user;if(!n)return;if(t.deleted&&t._id&&n._id&&t._id===n._id)return void c(null);(t._id&&n._id&&t._id===n._id||t.username&&n.username&&t.username===n.username)&&c(t)}catch(t){}};return window.addEventListener("userProfileUpdated",e),()=>window.removeEventListener("userProfileUpdated",e)},[i.user]);const c=e=>{if(e){localStorage.setItem("userProfile",JSON.stringify(e));const t=localStorage.getItem("token");t&&r({type:"LOGIN",payload:t})}else localStorage.removeItem("userProfile"),r({type:"LOGOUT"})};return(0,Y.jsx)(_e.Provider,{value:(0,a.A)((0,a.A)({},i),{},{login:e=>{localStorage.setItem("token",e),document.cookie="token=".concat(e,"; path=/; max-age=86400; SameSite=Lax"),r({type:"LOGIN",payload:e}),(async()=>{try{const{authService:t}=await Promise.resolve().then(n.bind(n,31694)),a=await t.getCurrentUser();a&&(localStorage.setItem("userProfile",JSON.stringify(a)),r({type:"LOGIN",payload:e}))}catch(t){}})()},logout:()=>{G.authService.logout().catch(()=>{}),localStorage.removeItem("token"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT;",r({type:"LOGOUT"}),d("/login",{replace:!0})},isStaff:()=>{var e;return"staff"===(null===(e=i.user)||void 0===e?void 0:e.role)},isAdmin:()=>{var e;return"admin"===(null===(e=i.user)||void 0===e?void 0:e.role)},isResident:()=>{var e;return"resident"===(null===(e=i.user)||void 0===e?void 0:e.role)},mode:l,switchMode:e=>{o(e)},setUser:c}),children:t})};var Be=n(98964),Le=n(79126),Oe=n(6051),Ue=n(30326),ze=n(45229),Fe=n(56580),Ee=n(13486),Me=n(8272),We=n(99214),Ye=n(94532),He=n(30703),Ve=n(58518),Ge=n(85825),Ke=n(71923),Je=n(45608),Ze=n(38700),$e=n(40905);const Qe=e=>{let{user:t,src:n,profileImageId:s,size:i=40,alt:r="",className:l,style:o}=e;const d=t,c=s||(null===d||void 0===d?void 0:d.profileImageId)||null,u=n||(null===d||void 0===d?void 0:d.profileImage)||(null===d||void 0===d?void 0:d.profilePicture)||null;if(c)return(0,Y.jsx)("img",{src:(0,G.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(c)),alt:r||(null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||(null===d||void 0===d?void 0:d.email)||"avatar",width:i,height:i,style:(0,a.A)({width:i,height:i,borderRadius:"50%",objectFit:"cover"},o),className:l});if(u)return(0,Y.jsx)("img",{src:u,alt:r||(null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||(null===d||void 0===d?void 0:d.email)||"avatar",width:i,height:i,style:(0,a.A)({width:i,height:i,borderRadius:"50%",objectFit:"cover"},o),className:l});const h=((null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||(null===d||void 0===d?void 0:d.email)||"").toString(),m="https://ui-avatars.com/api/?name=".concat(encodeURIComponent(h),"&background=2196F3&color=fff&size=").concat(Math.max(Math.min(i,256),32));return(0,Y.jsx)("img",{src:m,alt:r||h||"avatar",width:i,height:i,style:(0,a.A)({width:i,height:i,borderRadius:"50%",objectFit:"cover"},o),className:l})},Xe=()=>{const[e,t]=(0,s.useState)(new Date);(0,s.useEffect)(()=>{const e=setInterval(()=>t(new Date),1e3);return()=>clearInterval(e)},[]);const n=e=>e.toString().padStart(2,"0"),a="".concat(n(e.getMonth()+1),"/").concat(n(e.getDate()),"/").concat(e.getFullYear()),i="".concat(n(e.getHours()),":").concat(n(e.getMinutes()),":").concat(n(e.getSeconds()));return(0,Y.jsxs)("span",{style:{fontSize:13,color:"#888",fontWeight:500,letterSpacing:.5,marginRight:8},children:[(0,Y.jsx)(ze.A,{style:{marginRight:4}}),a," ",i]})},{Header:et,Content:tt,Sider:nt}=Be.A,at={resident:[{key:"/home",icon:(0,Y.jsx)(Fe.A,{}),label:"Home"},{key:"/request",icon:(0,Y.jsx)(Ee.A,{}),label:"Request"},{key:"/inquiries",icon:(0,Y.jsx)(Me.A,{}),label:"Inquiries"},{key:"/inbox",icon:(0,Y.jsx)(b.A,{}),label:"Inbox"}],admin:[{key:"/admin/dashboard",icon:(0,Y.jsx)(Fe.A,{}),label:"Admin Dashboard"},{key:"/admin/users",icon:(0,Y.jsx)(We.A,{}),label:"User Management"},{key:"/admin/statistics",icon:(0,Y.jsx)(Ye.A,{}),label:"Statistics"},{key:"/admin/settings",icon:(0,Y.jsx)(He.A,{}),label:"System Settings"},{key:"/admin/verification-requests",icon:(0,Y.jsx)(Ve.A,{}),label:"Verification Requests"}],staff:[{key:"/staff-dashboard",icon:(0,Y.jsx)(Fe.A,{}),label:"Staff Dashboard"},{key:"/staff/inbox",icon:(0,Y.jsx)(b.A,{}),label:"Staff Inbox"},{key:"/templates-manager",icon:(0,Y.jsx)(Ve.A,{}),label:"Templates Manager"},{key:"/document-processing",icon:(0,Y.jsx)(Ge.A,{}),label:"Document Processing"},{key:"/document-history",icon:(0,Y.jsx)(Ke.A,{}),label:"Document History"}]},st=e=>{var t,r;let{children:l}=e;const o=(0,pe.zy)(),d=(0,pe.Zp)(),{user:c,setUser:h}=Pe();let m=c;if(!m)try{const e=localStorage.getItem("userProfile");e&&(m=JSON.parse(e))}catch(C){}const[p,x]=(0,s.useState)(null),[g,A]=(0,s.useState)(null),[b,w]=(0,s.useState)(!1),[I,S]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async()=>{try{const e=await Promise.resolve().then(n.bind(n,31694));try{const t=await e.residentPersonalInfoAPI.getPersonalInfo();if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:"".concat(window.location.origin).concat(t.profileImage);return void x(e)}if(null!==t&&void 0!==t&&t.profileImageId)return void x((0,G.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(t.profileImageId)))}catch(C){}try{const t=(await e.default.get("/resident/profile")).data;if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:"".concat(window.location.origin).concat(t.profileImage);x(e)}else null!==t&&void 0!==t&&t.profileImageId&&x((0,G.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(t.profileImageId)))}catch(C){}}catch(C){}try{var e;const t=await Promise.resolve().then(n.bind(n,31694)),a=await t.verificationAPI.getMyRequests(),s=Array.isArray(a)?a.find(e=>"pending"===e.status):null;A({verified:null===(e=m)||void 0===e?void 0:e.verified,pending:!!s,request:s||Array.isArray(a)&&a[0]})}catch(t){}(()=>{try{const e=setInterval(async()=>{try{var e,a,s;const i=await Promise.resolve().then(n.bind(n,31694)),r=await i.verificationAPI.getMyRequests(),l=Array.isArray(r)?r.find(e=>"pending"===e.status):null;let o=null;try{o=await i.authService.getCurrentUser()}catch(t){}A({verified:null!==(e=null===(a=o)||void 0===a?void 0:a.verified)&&void 0!==e?e:null===(s=m)||void 0===s?void 0:s.verified,pending:!!l,request:l||Array.isArray(r)&&r[0]}),o&&h&&h(o)}catch(t){}},1e4);try{window.__verifPollId=e}catch(t){}}catch(t){}})()})();const e=e=>{try{const t=null===e||void 0===e?void 0:e.detail;if(!t)return;if(t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:"".concat(window.location.origin).concat(t.profileImage);x(e)}else t.profileImageId&&x((0,G.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(t.profileImageId)))}catch(C){}};return window.addEventListener("userProfileUpdated",e),()=>{window.removeEventListener("userProfileUpdated",e);try{clearInterval(window.__verifPollId)}catch(t){}}},[]),(0,Y.jsxs)(Be.A,{style:{minHeight:"100vh",background:"#000"},children:[c&&(0,Y.jsx)(nt,{width:240,collapsed:I,collapsedWidth:64,style:{height:"100vh",position:"fixed",left:0,top:0,background:"linear-gradient(180deg, #40c9ff 0%, #e81cff 100%)",display:"flex",flexDirection:"column",padding:0,zIndex:100,boxShadow:"2px 0 16px 0 rgba(64,201,255,0.10)",borderRight:"none",overflowX:"hidden"},children:(0,Y.jsx)("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"24px 0 0 0",display:"flex",flexDirection:"column"},children:(0,Y.jsx)(Le.A,{theme:"light",mode:"inline",selectedKeys:[o.pathname],style:{background:"transparent",fontWeight:600,fontSize:17,border:"none"},inlineCollapsed:I,items:at["admin"===(null===c||void 0===c?void 0:c.role)?"admin":"staff"===(null===c||void 0===c?void 0:c.role)?"staff":"resident"].map(e=>(0,a.A)((0,a.A)({},e),{},{className:o.pathname===e.key?"ant-menu-item-active-custom":void 0})),onClick:e=>{let{key:t}=e;o.pathname!==t&&d(t)}})})}),(0,Y.jsxs)(Be.A,{style:{marginLeft:c?I?64:240:0},children:[(0,Y.jsxs)(et,{className:"app-header",style:{height:64,background:"#fff",display:"flex",flexWrap:"nowrap",alignItems:"center",justifyContent:"space-between",padding:"0 32px",position:"fixed",left:c?I?64:240:0,right:0,top:0,zIndex:101,boxShadow:"0 2px 8px #e3e6f3"},children:[(0,Y.jsxs)("div",{className:"responsive-system-title",style:{display:"flex",alignItems:"center",gap:12,maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[c&&(0,Y.jsx)(u.Ay,{type:"text",onClick:()=>S(e=>!e),style:{marginRight:6},icon:I?(0,Y.jsx)(j.A,{}):(0,Y.jsx)(v.A,{})}),(0,Y.jsx)("img",{src:"".concat("","/logo-parian2.png"),alt:"Logo",style:{width:36,height:36,marginRight:4}}),(0,Y.jsxs)("span",{style:{fontSize:26,fontWeight:400,letterSpacing:1,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",display:"inline-block",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["Barangay Information ",(0,Y.jsx)("span",{style:{fontWeight:800},children:"Management System"})]})]}),(0,Y.jsxs)("div",{className:"header-controls",style:{display:"flex",alignItems:"center",gap:16,position:"relative",marginRight:8},children:[(0,Y.jsx)("span",{style:{marginRight:8},children:(0,Y.jsx)(Xe,{})}),(0,Y.jsx)(Oe.A,{size:12,children:m&&(0,Y.jsx)(u.Ay,{size:"small",onClick:()=>{var e;return d("admin"===(null===(e=m)||void 0===e?void 0:e.role)?"/admin/announcements":"/announcements")},icon:(0,Y.jsx)(Je.A,{})})}),m&&(0,Y.jsx)("div",{style:{display:"flex",alignItems:"center",gap:8},children:(0,Y.jsx)("div",{style:{cursor:"pointer"},onClick:()=>w(!0),children:null!==g&&void 0!==g&&g.verified?(0,Y.jsx)(f.A,{color:"green",children:"Verified"}):null!==g&&void 0!==g&&g.pending?(0,Y.jsx)(f.A,{color:"orange",children:"Verification Pending"}):(0,Y.jsx)(f.A,{color:"default",children:"Unverified"})})}),(0,Y.jsx)(Ue.A,{popupRender:()=>(0,Y.jsxs)(Le.A,{children:[(0,Y.jsx)(Le.A.Item,{icon:(0,Y.jsx)(Ze.A,{}),onClick:()=>d("/profile"),children:"Profile"},"profile"),(0,Y.jsx)(Le.A.Item,{icon:(0,Y.jsx)(He.A,{}),onClick:()=>d("/admin/settings"),children:"Settings"},"settings"),(0,Y.jsx)(Le.A.Divider,{}),(0,Y.jsx)(Le.A.Item,{icon:(0,Y.jsx)($e.A,{}),onClick:()=>d("/logout"),children:"Logout"},"logout")]}),placement:"bottomRight",trigger:["click"],children:(0,Y.jsx)(y.A,{size:36,shape:"circle",children:p?(0,Y.jsx)("img",{src:p,alt:(null===(t=m)||void 0===t?void 0:t.fullName)||(null===(r=m)||void 0===r?void 0:r.username)||"avatar",width:36,height:36,style:{width:36,height:36,borderRadius:"50%",objectFit:"cover"}}):m&&(m.profileImage||m.profilePicture||m.profileImageId)?(0,Y.jsx)(Qe,{user:m,size:36}):(0,Y.jsx)(Ze.A,{})})}),(0,Y.jsx)(ge.A,{title:"Verification Status",open:b,onCancel:()=>w(!1),footer:null,children:null!==g&&void 0!==g&&g.request?(0,Y.jsxs)("div",{children:[(0,Y.jsxs)("p",{children:["Status: ",g.request.status]}),(0,Y.jsxs)("p",{children:["Submitted: ",new Date(g.request.createdAt).toLocaleString()]}),Array.isArray(g.request.files)&&g.request.files.length>0&&(0,Y.jsxs)("div",{children:[(0,Y.jsx)("p",{children:"Uploaded files:"}),(0,Y.jsx)("ul",{children:g.request.files.map((e,t)=>(0,Y.jsx)("li",{children:e},t))})]}),(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8},children:[(0,Y.jsx)(u.Ay,{onClick:()=>w(!1),children:"Close"}),(0,Y.jsx)(u.Ay,{danger:!0,onClick:async()=>{try{const t=await Promise.resolve().then(n.bind(n,31694));await t.verificationAPI.cancelRequest(g.request._id),i.Ay.success("Verification request cancelled"),w(!1);try{const e=await Promise.resolve().then(n.bind(n,31694)),t=await e.authService.getCurrentUser();t&&h&&h(t);const a=await e.verificationAPI.getMyRequests(),s=Array.isArray(a)?a.find(e=>"pending"===e.status):null;A({verified:null===t||void 0===t?void 0:t.verified,pending:!!s,request:s||Array.isArray(a)&&a[0]})}catch(e){}}catch(e){console.error("Failed to cancel verification",e),i.Ay.error("Failed to cancel verification")}},children:"Cancel Verification"})]})]}):(0,Y.jsx)("div",{children:(0,Y.jsx)("p",{children:null!==g&&void 0!==g&&g.verified?"Your account is verified.":"No pending verification request."})})})]})]}),(0,Y.jsx)("div",{style:{height:1,background:"#f0f0f0",width:"100%",margin:0,boxShadow:"none"}}),(0,Y.jsx)(tt,{style:{marginTop:64,padding:32,background:"linear-gradient(135deg, #e3f6fd 0%, #b3e0ff 60%,  #b3e0ff 100%)",minHeight:"calc(100vh - ".concat(64,"px)")},children:l})]})]})},it=e=>{let{children:t}=e;return(0,Y.jsx)(st,{children:t||(0,Y.jsx)(pe.sv,{})})},rt=e=>{let{children:t}=e;const{isAuthenticated:n,user:a}=Pe();return n||a&&"guest"===a.role?(0,Y.jsx)(Y.Fragment,{children:t}):(0,Y.jsx)(pe.C5,{to:"/login",replace:!0})},lt=e=>{let{children:t}=e;const{isAuthenticated:n,user:a}=Pe();return n?"staff"!==(null===a||void 0===a?void 0:a.role)&&"admin"!==(null===a||void 0===a?void 0:a.role)?(0,Y.jsx)(pe.C5,{to:"/dashboard",replace:!0}):(0,Y.jsx)(Y.Fragment,{children:t}):(0,Y.jsx)(pe.C5,{to:"/login",replace:!0})},ot=e=>{let{children:t}=e;const n=Pe(),a=(0,pe.Zp)(),s=null===n||void 0===n?void 0:n.user,i="function"===typeof(null===n||void 0===n?void 0:n.isAdmin)?n.isAdmin():"admin"===(null===s||void 0===s?void 0:s.role)||!0===(null===s||void 0===s?void 0:s.isAdmin),r="undefined"!==typeof window?localStorage.getItem("token"):null;return!s&&r?(0,Y.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:(0,Y.jsx)(p.A,{size:"large"})}):s?i?t:(0,Y.jsx)(x.Ay,{status:"403",title:"403",subTitle:"Sorry, you are not authorized to access this page.",extra:(0,Y.jsx)(u.Ay,{type:"primary",onClick:()=>a("/dashboard"),children:"Go to Dashboard"})}):(0,Y.jsx)(pe.C5,{to:"/login",replace:!0})};var dt=n(95645),ct=n(88820);const ut=function(e){const t="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII=";return e?e.previewUrl?e.previewUrl:e.photo&&e._id?(0,G.getAbsoluteApiUrl)("/admin/officials/".concat(e._id,"/photo")):e.hasPhoto&&e._id?(0,G.getAbsoluteApiUrl)("/officials/".concat(e._id,"/photo")):e.photoUrl?e.photoUrl:e.photoPath?(0,G.getAbsoluteApiUrl)("/".concat(e.photoPath.replace(/^\//,""))):t:t};var ht=n(26612),mt=n(74044);const pt=()=>{var e,t,n,i,d,c,u,m,x;const[g,f]=(0,s.useState)(null),[y,A]=(0,s.useState)(!0);if((0,s.useEffect)(()=>{let e=!0;return(async()=>{try{const[n,s,i]=await Promise.all([G.documentsAPI.listFiles().catch(()=>[]),G.documentsAPI.getAllDocuments().catch(()=>[]),G.contactAPI.getAnnouncements().catch(()=>[])]);let r=null;try{r=await G.adminAPI.getSystemStatistics()}catch(t){console.warn("Could not fetch admin statistics (likely unauthenticated):",String(t)),r=null}if(e){const e=Array.isArray(n)?n.length:n&&n.length||0,t=Array.isArray(s)?s.length:s&&s.length||0,l=Array.isArray(i)?i.length:i&&i.length||0;f((0,a.A)((0,a.A)({},r||{}),{},{filesCount:e,docRequestsCount:t,announcementsCount:l}))}}catch(n){console.error("Failed to load system statistics",n)}finally{e&&A(!1)}})(),()=>{e=!1}},[]),y)return(0,Y.jsx)("div",{style:{width:"100%",textAlign:"center"},children:(0,Y.jsx)(p.A,{})});if(!g)return(0,Y.jsx)("div",{style:{textAlign:"center"},children:(0,Y.jsx)(h.A.Text,{type:"secondary",children:"No statistics available"})});const j=g.users||{},v=(g.documents,null!==(e=g.filesCount)&&void 0!==e?e:0),b=[{key:"users",title:"Total Users",value:null!==(t=j.total)&&void 0!==t?t:0,icon:(0,Y.jsx)(Ze.A,{style:{color:"#9254de",fontSize:20}})},{key:"admins",title:"Admins",value:null!==(n=null===(i=j.byRole)||void 0===i?void 0:i.admin)&&void 0!==n?n:0,icon:(0,Y.jsx)(mt.A,{style:{color:"#f5a623",fontSize:20}})},{key:"staff",title:"Staff",value:null!==(d=null===(c=j.byRole)||void 0===c?void 0:c.staff)&&void 0!==d?d:0,icon:(0,Y.jsx)(We.A,{style:{color:"#1677ff",fontSize:20}})},{key:"residents",title:"Residents",value:null!==(u=null===(m=j.byRole)||void 0===m?void 0:m.resident)&&void 0!==u?u:0,icon:(0,Y.jsx)(Fe.A,{style:{color:"#22c55e",fontSize:20}})},{key:"announcements",title:"Announcements",value:null!==(x=g.announcementsCount)&&void 0!==x?x:0,icon:(0,Y.jsx)(Je.A,{style:{color:"#faad14",fontSize:20}})},{key:"docFiles",title:"Documents Available",value:v,icon:(0,Y.jsx)(Ee.A,{style:{color:"#0ea5e9",fontSize:20}})}];return(0,Y.jsxs)(r.A,{className:"glass-card stats-card",bordered:!1,style:{width:"100%"},children:[(0,Y.jsx)(h.A.Title,{level:4,children:"Quick Stats"}),(0,Y.jsx)("div",{style:{height:6,background:"linear-gradient(90deg, rgba(22,119,255,0.08), rgba(146,84,222,0.08))",borderRadius:4,marginBottom:12}}),(0,Y.jsx)(l.A,{gutter:[12,12],style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:b.map(e=>(0,Y.jsx)(o.A,{xs:12,sm:8,md:8,lg:8,style:{display:"flex"},children:(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,width:"100%"},children:[(0,Y.jsx)("div",{style:{width:44,height:44,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.9)",borderRadius:8,boxShadow:"0 6px 14px rgba(2,6,23,0.06)"},children:e.icon}),(0,Y.jsx)("div",{style:{flex:1},children:(0,Y.jsx)(ht.A,{title:e.title,value:e.value})})]})},e.key))})]})};var xt=n(98058),gt=n(77725);const ft=()=>{const{login:e,isAuthenticated:t,user:n,setUser:a}=Pe(),[d,m]=(0,s.useState)(!1),[p,x]=(0,s.useState)(!1),[g]=dt.A.useForm(),f=(0,pe.Zp)(),[y,A]=(0,s.useState)(!1),[j,v]=(0,s.useState)([]),[b,w]=(0,s.useState)("loading"),I=(0,s.useRef)(null);(0,s.useEffect)(()=>{t&&n&&("admin"===n.role?f("/admin/dashboard"):"staff"===n.role?f("/staff-dashboard"):"guest"===n.role?f("/guest/dashboard"):f("/dashboard"))},[t,n,f]),(0,s.useEffect)(()=>{let e=!0;return(async()=>{try{w("fetching public");const a=await async function(){try{let e=(await G.axiosPublic.get("/officials")).data;return e&&Array.isArray(e.data)&&(e=e.data),e&&Array.isArray(e.officials)&&(e=e.officials),Array.isArray(e)?(0===e.length&&console.info("fetchPublicOfficials: server returned empty list"),e):(console.warn("fetchPublicOfficials: unexpected payload shape",e),[])}catch(e){return console.error("fetchPublicOfficials error",e),[]}}();if(e&&Array.isArray(a)&&a.length>0)v(a),w("public:".concat(a.length));else if(t){w("trying-admin-fallback");try{const t=await G.adminAPI.getOfficials();if(e&&Array.isArray(t)&&t.length>0){const e=t.map(e=>({_id:e._id,name:e.name,title:e.title,term:e.term,hasPhoto:!!e.photo||!!e.photoPath}));v(e),w("admin:".concat(e.length))}else w("no-officials")}catch(n){console.warn("Admin fallback failed",n),w("error")}}else w("no-officials")}catch(n){console.warn("Failed to fetch public officials for login preview",n),w("error")}})(),()=>{e=!1}},[]);return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)("div",{className:"login-page",children:(0,Y.jsx)("div",{className:"login-container two-pane",children:(0,Y.jsxs)(l.A,{gutter:24,align:"stretch",justify:"center",className:"two-pane-row",children:[(0,Y.jsx)(o.A,{xs:24,md:12,className:"pane left-pane combined-pane",children:(0,Y.jsx)("div",{className:"pane-inner left-inner",children:(0,Y.jsxs)("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:18},children:[(0,Y.jsx)(pt,{}),(0,Y.jsxs)(r.A,{className:"glass-card preview-card invisible",variant:"outlined",children:[(0,Y.jsx)(h.A.Title,{level:4,style:{marginBottom:8},children:"Barangay Officials"}),(0,Y.jsx)("div",{style:{height:6,background:"linear-gradient(90deg, rgba(22,119,255,0.12), rgba(146,84,222,0.12))",borderRadius:4,marginBottom:12}}),(0,Y.jsxs)("div",{className:"carousel-wrap",children:[(0,Y.jsx)(u.Ay,{className:"carousel-arrow left",icon:(0,Y.jsx)(xt.A,{}),onClick:()=>{I.current&&I.current.scrollBy({left:-240,behavior:"smooth"})}}),(0,Y.jsx)("div",{ref:I,className:"carousel-scroll",children:0===j.length?(0,Y.jsx)(h.A.Text,{type:"secondary",children:"No officials to preview"}):j.map(e=>(0,Y.jsxs)("div",{className:"official-card",children:[(0,Y.jsx)("div",{className:"official-avatar",children:(0,Y.jsx)("img",{alt:e.name,src:ut(e),style:{width:"100%",height:"100%",objectFit:"cover"},onError:e=>{try{const t=e.currentTarget;t.onerror=null,t.src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAQAAAC1HAwCAAAAC0lEQVR4nGNgYAAAAAMAASsJTYQAAAAASUVORK5CYII="}catch(t){}}})}),(0,Y.jsx)("div",{style:{fontWeight:700},children:e.name}),(0,Y.jsx)("div",{style:{color:"#666",fontSize:13},children:e.title}),(0,Y.jsx)("div",{style:{color:"#999",fontSize:12},children:e.term})]},e._id))}),(0,Y.jsx)(u.Ay,{className:"carousel-arrow right",icon:(0,Y.jsx)(gt.A,{}),onClick:()=>{I.current&&I.current.scrollBy({left:240,behavior:"smooth"})}})]})]})]})})}),(0,Y.jsx)(o.A,{xs:24,md:12,className:"pane center-pane login-pane",children:(0,Y.jsx)("div",{className:"pane-inner center-inner",children:(0,Y.jsxs)(r.A,{className:"glass-card login-card",variant:"outlined",children:[(0,Y.jsx)(h.A.Title,{level:2,className:"title-blue",style:{textAlign:"center",marginBottom:6},children:"Barangay Information System"}),(0,Y.jsx)(h.A.Text,{style:{display:"block",textAlign:"center",color:"#9254de",fontWeight:500,marginBottom:18},children:"Sign In"}),(0,Y.jsxs)(dt.A,{name:"login",layout:"vertical",onFinish:async t=>{A(!0);try{const n=await G.axiosInstance.post("/auth/login",{identifier:t.username,password:t.password}),a=n&&n.data?n.data:{};if(!n||n.status>=400)throw console.error("Login response not OK:",{status:null===n||void 0===n?void 0:n.status,data:a}),new Error(a.message||"Login failed");if(!a.token)throw console.error("No token in response:",a),new Error("Login failed - No token received");e(a.token),i.Ay.success(a.message||"Login successful!")}catch(n){i.Ay.error(n.message||"Error logging in"),console.error("Login error:",n)}finally{A(!1)}},autoComplete:"off",requiredMark:!1,children:[(0,Y.jsx)(dt.A.Item,{label:"Email or Username",name:"username",rules:[{required:!0,message:"Please input your email or username!"}],children:(0,Y.jsx)(c.A,{prefix:(0,Y.jsx)(Ze.A,{style:{color:"#40a9ff"}}),placeholder:"Enter your email or username",size:"large"})}),(0,Y.jsx)(dt.A.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"},{min:6,message:"Password must be at least 6 characters"}],children:(0,Y.jsx)(c.A.Password,{autoComplete:"current-password",prefix:(0,Y.jsx)(ct.A,{style:{color:"#40a9ff"}}),placeholder:"Enter your password",size:"large"})}),(0,Y.jsx)(dt.A.Item,{children:(0,Y.jsx)(u.Ay,{htmlType:"submit",size:"large",loading:y,className:"signin-btn",children:y?"Signing In...":"Sign In"})}),(0,Y.jsx)(dt.A.Item,{children:(0,Y.jsx)(u.Ay,{onClick:()=>m(!0),size:"large",className:"guest-warm-btn",block:!0,children:"Continue as Guest"})}),(0,Y.jsxs)("div",{className:"links-row",children:[(0,Y.jsx)(pe.N_,{to:"/forgot-password",children:(0,Y.jsx)(h.A.Text,{type:"secondary",children:"Forgot Password?"})}),(0,Y.jsx)(pe.N_,{to:"/register",children:(0,Y.jsx)(h.A.Text,{type:"secondary",children:"Sign Up"})})]}),(0,Y.jsx)("div",{style:{marginTop:8,textAlign:"center"},children:(0,Y.jsx)(u.Ay,{type:"link",onClick:()=>x(!0),children:(0,Y.jsx)(h.A.Text,{type:"danger",children:"Emergency Hotline"})})})]})]})})})]})})}),(0,Y.jsx)(ge.A,{title:"Continue as Guest",open:d,onCancel:()=>{m(!1),g.resetFields()},onOk:async()=>{try{const s=await g.validateFields();try{const n=await G.axiosPublic.post("/auth/guest",{name:s.name,contactNumber:s.contactNumber,email:s.email,intent:s.intent}),r=n&&n.data?n.data:{};if(!n||n.status>=400)return void i.Ay.error(r.message||"Failed to create guest");const l={_id:r._id,username:(s.name||"guest").toString().toLowerCase().replace(/\s+/g,"_"),firstName:s.name||"Guest",contactNumber:s.contactNumber||"",email:s.email||"",intent:s.intent||"",sessionToken:r.sessionToken,expiresAt:r.expiresAt,role:"guest"};if("function"===typeof a&&a(l),localStorage.setItem("guestInfo",JSON.stringify(l)),localStorage.setItem("guestSessionToken",r.sessionToken),r.token&&"function"===typeof e)try{await e(r.token)}catch(t){console.warn("Guest token login failed",t)}m(!1),g.resetFields(),f("/guest/dashboard")}catch(n){console.error("Failed to persist guest",n),i.Ay.error("Failed to create guest account")}}catch(n){}},children:(0,Y.jsxs)(dt.A,{layout:"vertical",form:g,children:[(0,Y.jsx)(dt.A.Item,{name:"name",label:"Full name",rules:[{required:!0,message:"Please enter your name"}],children:(0,Y.jsx)(c.A,{placeholder:"Your full name"})}),(0,Y.jsx)(dt.A.Item,{name:"contactNumber",label:"Contact number",rules:[{required:!0,message:"Please enter a contact number"}],children:(0,Y.jsx)(c.A,{placeholder:"0917..."})}),(0,Y.jsx)(dt.A.Item,{name:"email",label:"Email (optional)",rules:[{type:"email",message:"Enter a valid email"}],children:(0,Y.jsx)(c.A,{placeholder:"you@example.com"})}),(0,Y.jsx)(dt.A.Item,{name:"intent",label:"Purpose / Intent",rules:[{required:!0,message:"Please tell us your intent"}],children:(0,Y.jsx)(c.A.TextArea,{placeholder:"Why are you visiting (e.g., check documents, request info)",rows:3})})]})}),(0,Y.jsx)(ge.A,{title:"Emergency Hotlines",open:p,onCancel:()=>x(!1),footer:null,children:(0,Y.jsxs)("div",{style:{lineHeight:1.6},children:[(0,Y.jsxs)(h.A.Paragraph,{children:["For general emergencies: ",(0,Y.jsx)("strong",{children:"911"})]}),(0,Y.jsxs)(h.A.Paragraph,{children:["National Center for Mental Health (Crisis): ",(0,Y.jsx)("strong",{children:"0917-899-8727"})]}),(0,Y.jsxs)(h.A.Paragraph,{children:["Philippine National Police (Emergency Hotline): ",(0,Y.jsx)("strong",{children:"9-1-1"})," / ",(0,Y.jsx)("strong",{children:"8723-0401"})," / ",(0,Y.jsx)("strong",{children:"8537-4500"})]})]})})]})};var yt=n(63516),At=n(80899),jt=n(53969),vt=n(65535),bt=n(94799),wt=n(25438),It=n(33699),St=n(12097),Ct=n(58560),kt=n(59024),Nt=n(31202),Tt=n(90160),_t=n(4573),Pt=n(97250),Dt=n(22632),Rt=n(3665),qt=n(32306),Bt=n(23241);const Lt=At.Ik({username:At.Yj().matches(/^[a-zA-Z0-9]{4,20}$/,"Username must be 4-20 characters and contain only letters and numbers").required("Username is required"),email:At.Yj().email("Invalid email address").required("Email is required"),password:At.Yj().matches(/^(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{6,}$/,"Password must be at least 6 characters long and contain at least one number, one uppercase letter, and one special character").required("Password is required"),confirmPassword:At.Yj().oneOf([At.KR("password"),void 0],"Passwords must match").required("Confirm Password is required"),address:At.Yj().required("Address is required"),contactNumber:At.Yj().required("Contact Number is required"),barangayID:At.Yj().required("Barangay ID is required")}),Ot=()=>{const e=(0,pe.Zp)(),[t,n]=s.useState(""),[a,i]=s.useState(""),[r,l]=s.useState(""),[o,d]=s.useState(!1),[c,u]=s.useState(!1),[h,m]=s.useState(!1),[p,x]=s.useState({});const g=(0,yt.Wx)({initialValues:{firstName:"",middleName:"",lastName:"",username:"",email:"",password:"",confirmPassword:"",address:"",contactNumber:"",barangayID:function(){const e=(new Date).getFullYear(),t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let a=0;a<6;a++)n+=t.charAt(Math.floor(62*Math.random()));return"brgyparian-".concat(e,"-").concat(n)}(),role:"resident"},validationSchema:Lt.shape({firstName:At.Yj().required("First name is required"),lastName:At.Yj().required("Last name is required"),role:At.Yj().oneOf(["resident"]).required("Role is required")}),onSubmit:async(t,a)=>{let{setSubmitting:s,resetForm:r}=a;n(""),x({});const l=await g.validateForm();if(Object.keys(l).length>0)return n("Please correct the highlighted errors before submitting."),void s(!1);try{const a=[t.firstName,t.middleName,t.lastName].filter(Boolean).join(" "),l=await G.axiosInstance.post("/auth/register",{fullName:a,firstName:t.firstName,middleName:t.middleName,lastName:t.lastName,username:t.username,email:t.email,password:t.password,address:t.address,contactNumber:t.contactNumber,barangayID:t.barangayID,role:t.role});let d={};try{d=l&&l.data?l.data:{}}catch(o){return void n("Server error: Could not parse response")}if(l&&l.status>=200&&l.status<300)i("Registration successful! You may now log in."),r(),setTimeout(()=>e("/login"),1500);else{if(d.errors&&"object"===typeof d.errors)return x(d.errors),n("Please correct the highlighted errors before submitting."),void s(!1);d.message?n(d.message):d.error?n(d.error):n("Registration failed")}}catch(d){n("Network or server error. Please try again later.")}finally{s(!1)}}});return(0,Y.jsx)(jt.A,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #40c9ff 0%, #e81cff 100%)",display:"flex",alignItems:"center",justifyContent:"center",py:6},children:(0,Y.jsx)(vt.A,{maxWidth:"sm",children:(0,Y.jsxs)(bt.A,{elevation:6,sx:{borderRadius:5,p:4,background:"rgba(255,255,255,0.95)",boxShadow:"0 8px 32px 0 rgba(64,201,255,0.15)"},children:[(0,Y.jsx)(jt.A,{sx:{textAlign:"center",mb:3},children:(0,Y.jsx)(jt.A,{sx:{fontWeight:800,fontSize:32,letterSpacing:1,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",display:"inline-block"},children:"Create Account"})}),(0,Y.jsxs)("form",{onSubmit:g.handleSubmit,children:[(0,Y.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"First Name",name:"firstName",value:g.values.firstName,onChange:g.handleChange,error:g.touched.firstName&&Boolean(g.errors.firstName),helperText:g.touched.firstName&&g.errors.firstName,sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,Y.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Middle Name (optional)",name:"middleName",value:g.values.middleName,onChange:g.handleChange,error:g.touched.middleName&&Boolean(g.errors.middleName),helperText:g.touched.middleName&&g.errors.middleName,sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,Y.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Last Name",name:"lastName",value:g.values.lastName,onChange:g.handleChange,error:g.touched.lastName&&Boolean(g.errors.lastName),helperText:g.touched.lastName&&g.errors.lastName,sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,Y.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Username",name:"username",value:g.values.username,onChange:g.handleChange,error:g.touched.username&&Boolean(g.errors.username)||Boolean(p.username),helperText:g.touched.username&&g.errors.username||p.username||"Username must be at least 4 characters long and contain only letters and numbers.",InputProps:{startAdornment:(0,Y.jsx)(It.A,{position:"start",children:(0,Y.jsx)(Tt.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,Y.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Email",name:"email",value:g.values.email,onChange:g.handleChange,error:g.touched.email&&Boolean(g.errors.email)||Boolean(p.email),helperText:g.touched.email&&g.errors.email||p.email,InputProps:{startAdornment:(0,Y.jsx)(It.A,{position:"start",children:(0,Y.jsx)(_t.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,Y.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Password",name:"password",type:c?"text":"password",value:g.values.password,onChange:g.handleChange,error:g.touched.password&&Boolean(g.errors.password),helperText:g.touched.password&&g.errors.password||p.password||"Password must be at least 6 characters long and contain at least one number, one uppercase letter, and one special character.",InputProps:{startAdornment:(0,Y.jsx)(It.A,{position:"start",children:(0,Y.jsx)(Pt.A,{color:"primary"})}),endAdornment:(0,Y.jsx)(It.A,{position:"end",children:(0,Y.jsx)(St.A,{onClick:()=>u(e=>!e),tabIndex:-1,sx:{minWidth:0,p:0,color:"inherit"},children:c?(0,Y.jsx)(Dt.A,{}):(0,Y.jsx)(Rt.A,{})})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,Y.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Confirm Password",name:"confirmPassword",type:h?"text":"password",value:g.values.confirmPassword,onChange:g.handleChange,error:g.touched.confirmPassword&&Boolean(g.errors.confirmPassword),helperText:g.touched.confirmPassword&&g.errors.confirmPassword,InputProps:{startAdornment:(0,Y.jsx)(It.A,{position:"start",children:(0,Y.jsx)(Pt.A,{color:"primary"})}),endAdornment:(0,Y.jsx)(It.A,{position:"end",children:(0,Y.jsx)(St.A,{onClick:()=>m(e=>!e),tabIndex:-1,sx:{minWidth:0,p:0,color:"inherit"},children:h?(0,Y.jsx)(Dt.A,{}):(0,Y.jsx)(Rt.A,{})})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,Y.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Address",name:"address",value:g.values.address,onChange:g.handleChange,error:g.touched.address&&Boolean(g.errors.address),helperText:g.touched.address&&g.errors.address,InputProps:{startAdornment:(0,Y.jsx)(It.A,{position:"start",children:(0,Y.jsx)(qt.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,Y.jsx)(wt.A,{fullWidth:!0,margin:"normal",label:"Contact Number",name:"contactNumber",value:g.values.contactNumber,onChange:g.handleChange,error:g.touched.contactNumber&&Boolean(g.errors.contactNumber),helperText:g.touched.contactNumber&&g.errors.contactNumber,InputProps:{startAdornment:(0,Y.jsx)(It.A,{position:"start",children:(0,Y.jsx)(Bt.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,Y.jsx)("input",{type:"hidden",name:"barangayID",value:g.values.barangayID}),(0,Y.jsx)(jt.A,{sx:{mb:2},children:(0,Y.jsx)(wt.A,{select:!0,fullWidth:!0,label:"Role",name:"role",value:g.values.role,onChange:e=>{g.handleChange(e),"admin"!==e.target.value&&l("")},error:g.touched.role&&Boolean(g.errors.role),helperText:g.touched.role&&g.errors.role?g.errors.role:"",sx:{borderRadius:3,background:"#f4f6fa"},children:(0,Y.jsx)(Ct.A,{value:"resident",children:"Resident"})})}),(0,Y.jsx)(St.A,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,borderRadius:3,fontWeight:700,fontSize:"1.1rem",background:"linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",color:"#fff",boxShadow:"0 2px 8px #e81cff44",transition:"background 0.3s","&:hover":{background:"linear-gradient(90deg, #40c9ff 0%, #e81cff 100%)"}},disabled:g.isSubmitting,children:"Register"}),t&&(0,Y.jsx)(kt.A,{severity:"error",sx:{mt:2},children:t}),Object.keys(p).length>0&&!t&&(0,Y.jsx)(kt.A,{severity:"error",sx:{mt:2},children:Object.entries(p).map(e=>{let[t,n]=e;return(0,Y.jsx)("div",{children:n},t)})}),o&&(0,Y.jsx)(kt.A,{severity:"info",sx:{mt:2},children:"Admin access is now unlocked! Redirecting to admin dashboard..."}),(0,Y.jsx)(jt.A,{sx:{textAlign:"center",mt:2},children:(0,Y.jsxs)(Nt.A,{component:pe.N_,to:"/login",variant:"body2",sx:{color:"#e81cff",fontWeight:600},children:["Already have an account? ",(0,Y.jsx)("span",{style:{textDecoration:"underline"},children:"Sign In"})]})})]})]})})})};var Ut=n(37490),zt=n(42524),Ft=n(32513),Et=n(80312),Mt=n(69123);const Wt="dashboard_residentCard__VNJkM",Yt="dashboard_heroRow__quuQi",Ht=()=>{var e,t,a,i;const{user:d,setUser:c}=Pe(),m=(null!==d&&void 0!==d||(()=>{try{const e=localStorage.getItem("userProfile");return e?JSON.parse(e):null}catch(e){return null}})(),(0,pe.Zp)()),[p,x]=(0,s.useState)(null),[g,f]=(0,s.useState)(()=>(new Date).toLocaleString()),[y,j]=(0,s.useState)([]),[v,b]=(0,s.useState)(!0),[w,I]=(0,s.useState)(0),[S,C]=(0,s.useState)(0),[k,N]=(0,s.useState)(!1),[T,_]=(0,s.useState)(0),[P,D]=(0,s.useState)(!1),[R,q]=(0,s.useState)([]),[B,L]=(0,s.useState)(!1),[O,U]=(0,s.useState)(!1),[z,F]=(0,s.useState)([]),[E,M]=(0,s.useState)(!1),[W,H]=(0,s.useState)(!1),[V,K]=(0,s.useState)(()=>{try{return"true"===localStorage.getItem("residentTips.hide")}catch(e){return!1}}),[J,Z]=(0,s.useState)(!1),$=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch(t){return String(e)}};(0,s.useEffect)(()=>{(async()=>{try{let e;e="admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?await G.documentsAPI.getAllDocuments():await G.documentsAPI.getMyDocuments(),j(e)}catch(e){console.error("Error fetching documents:",e)}finally{b(!1)}})(),(async()=>{try{try{const e=await(await Promise.resolve().then(n.bind(n,31694))).residentPersonalInfoAPI.getPersonalInfo();if(null!==e&&void 0!==e&&e.profileImage){const t=e.profileImage.startsWith("http")?e.profileImage:"".concat(window.location.origin).concat(e.profileImage);return void x(t)}if(null!==e&&void 0!==e&&e.profileImageId)return void x((0,G.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.profileImageId)))}catch(e){}try{const e=await Promise.resolve().then(n.bind(n,31694)),t=(await e.default.get("/resident/profile")).data;if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:"".concat(window.location.origin).concat(t.profileImage);x(e)}else null!==t&&void 0!==t&&t.profileImageId&&x((0,G.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(t.profileImageId)))}catch(e){}}catch(e){}})();const e=setInterval(()=>f((new Date).toLocaleString()),1e3);return()=>clearInterval(e)},[d]),(0,s.useEffect)(()=>{(async()=>{try{let e;e="admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?await G.contactAPI.getAllInquiries():await G.contactAPI.getMyInquiries(),Array.isArray(e)?_(e.length):e&&"number"===typeof e.count?_(e.count):_(e&&e.length||0)}catch(e){console.error("Failed to load inquiries:",e),_(0)}})();(async()=>{N(!0);try{const e=await G.contactAPI.getAnnouncements();Array.isArray(e)?C(e.length):e&&"number"===typeof e.count?C(e.count):C(e&&e.length||0)}catch(e){console.error("Failed to fetch announcements:",e),C(0)}finally{N(!1)}})()},[d]);const Q=y.filter(e=>"pending"===(e.status||"").toString().toLowerCase()).length,X=y.filter(e=>"approved"===(e.status||"").toString().toLowerCase()).length;return(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsxs)("div",{style:{maxWidth:1200,margin:"40px auto",padding:"0 16px",position:"relative"},children:[(0,Y.jsx)("div",{style:{marginBottom:18},children:(0,Y.jsx)(l.A,{align:"middle",children:(0,Y.jsx)(o.A,{children:(0,Y.jsx)(h.A.Text,{style:{fontSize:16,color:"#888"},children:(0,Y.jsxs)("span",{style:{marginRight:8},children:[(0,Y.jsx)("span",{style:{color:"#1890ff",fontWeight:600},children:"Dashboard"})," ",">"," Home"]})})})})}),"resident"===(null===d||void 0===d?void 0:d.role)&&(0,Y.jsxs)(r.A,{className:Wt,style:{width:"100%",margin:"0 auto 32px",borderRadius:32,boxShadow:"0 8px 32px #bfc7d6cc",background:"linear-gradient(120deg, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",border:"none",padding:0,position:"relative",overflow:"hidden",minHeight:170},bodyStyle:{padding:0},children:[(0,Y.jsx)("div",{style:{position:"absolute",top:0,left:0,height:"100%",background:"radial-gradient(circle at 80% 20%, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",opacity:.18,zIndex:0}}),(0,Y.jsx)(l.A,{align:"middle",className:Yt,style:{minHeight:170,padding:"32px 32px",position:"relative",zIndex:1},justify:"space-between",children:(0,Y.jsx)(o.A,{xs:24,md:14,style:{display:"flex",alignItems:"center",gap:24},children:(0,Y.jsx)("div",{style:{display:"flex",alignItems:"center",gap:18,width:"100%",justifyContent:"space-between"},children:(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:18},children:[(0,Y.jsxs)("div",{className:"avatarContainer",children:[p?(0,Y.jsx)("img",{src:p,alt:(null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||"avatar"}):(0,Y.jsx)(Qe,{user:(()=>{let e=d;if(!e)try{const t=localStorage.getItem("userProfile");t&&(e=JSON.parse(t))}catch(t){}return e})(),size:96}),(0,Y.jsx)("button",{onClick:()=>m("/profile"),title:"Edit profile",className:"editButton",children:(0,Y.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,Y.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z",fill:"#595959"}),(0,Y.jsx)("path",{d:"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#595959"})]})})]}),(0,Y.jsxs)("div",{className:"userInfo",children:[(0,Y.jsx)(h.A.Title,{level:3,className:"userName",style:{marginBottom:0,fontWeight:800},children:null!==(e=null!==(t=null!==(a=null===d||void 0===d?void 0:d.fullName)&&void 0!==a?a:null===d||void 0===d?void 0:d.username)&&void 0!==t?t:null===d||void 0===d?void 0:d.email)&&void 0!==e?e:""}),(0,Y.jsxs)(h.A.Text,{type:"secondary",className:"userMeta",children:["Barangay ID: ",null!==(i=null===d||void 0===d?void 0:d.barangayID)&&void 0!==i?i:(()=>{try{const e=localStorage.getItem("userProfile");if(e){const t=JSON.parse(e);return(null===t||void 0===t?void 0:t.barangayID)||"N/A"}}catch(e){}return"N/A"})()]}),(0,Y.jsx)("div",{style:{marginTop:8},children:(0,Y.jsx)(h.A.Text,{type:"secondary",className:"userMeta",children:(new Date).toLocaleString()})})]})]})})})})]}),(0,Y.jsxs)(l.A,{gutter:[32,32],justify:"center",style:{marginBottom:40},children:[(0,Y.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,Y.jsx)(r.A,{hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #faad1444",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},onClick:async()=>{D(!0),L(!0);try{let e;"admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?(e=await G.documentsAPI.getAllDocuments(),e=(e||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase())):(e=await G.documentsAPI.getMyDocuments(),e=(e||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase())),q(e||[])}catch(e){q([])}finally{L(!1)}},bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,Y.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,Y.jsx)("div",{style:{background:"#faad14",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,Y.jsx)(Et.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,Y.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:Q}),(0,Y.jsx)(h.A.Text,{style:{fontSize:18,color:"#faad14",fontWeight:700},children:"Pending Requests"})]})})}),(0,Y.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,Y.jsx)(r.A,{hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #52c41a44",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},bodyStyle:{padding:24},onClick:async()=>{U(!0),M(!0);try{let e;"admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?(e=await G.documentsAPI.getAllDocuments(),e=(e||[]).filter(e=>"approved"===(e.status||"").toString().toLowerCase())):(e=await G.documentsAPI.getMyDocuments(),e=(e||[]).filter(e=>"approved"===(e.status||"").toString().toLowerCase())),F(e||[])}catch(e){F([])}finally{M(!1)}},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,Y.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,Y.jsx)("div",{style:{background:"#52c41a",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,Y.jsx)(Ee.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,Y.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:X}),(0,Y.jsx)(h.A.Text,{style:{fontSize:18,color:"#52c41a",fontWeight:700},children:"Approved Documents"})]})})}),(0,Y.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,Y.jsx)(r.A,{hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #1890ff44",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},onClick:()=>m("/inbox"),bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,Y.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,Y.jsx)("div",{style:{background:"#1890ff",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,Y.jsx)(Et.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,Y.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:T}),(0,Y.jsx)(h.A.Text,{style:{fontSize:18,color:"#1890ff",fontWeight:700},children:"Active Inquiries"})]})})}),(0,Y.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,Y.jsx)(r.A,{onClick:()=>m("/announcements"),hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #eb2f9644",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,Y.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,Y.jsx)("div",{style:{background:"#eb2f96",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,Y.jsx)(Ut.A,{count:S,offset:[8,0],children:(0,Y.jsx)(Je.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})})}),(0,Y.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:S}),(0,Y.jsx)(h.A.Text,{style:{fontSize:18,color:"#eb2f96",fontWeight:700},children:"Announcements"})]})})})]}),(0,Y.jsx)(ge.A,{title:"Pending Requests",visible:P,onCancel:()=>D(!1),footer:null,width:800,children:(0,Y.jsx)(zt.A,{dataSource:R,loading:B,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,Y.jsx)(ge.A,{title:"Approved Documents",visible:O,onCancel:()=>U(!1),footer:null,width:1e3,children:(0,Y.jsx)(zt.A,{dataSource:z,loading:E,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Date Requested",dataIndex:"dateRequested",key:"dateRequested",render:(e,t)=>$(t.dateRequested||t.requestedAt||t.createdAt)},{title:"Date Approved",dataIndex:"dateApproved",key:"dateApproved",render:(e,t)=>$(t.dateApproved||t.approvedAt||t.approvedOn||t.updatedAt)},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,Y.jsx)(ge.A,{title:"Resident Tool Tips",visible:W,onCancel:()=>H(!1),footer:(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,Y.jsx)(Ft.A,{checked:V,onChange:e=>{const t=e.target.checked;K(t);try{localStorage.setItem("residentTips.hide",t?"true":"false")}catch(n){}},children:"Don't show again"}),(0,Y.jsxs)("div",{children:[(0,Y.jsx)(u.Ay,{onClick:()=>H(!1),style:{marginRight:8},children:"Cancel"}),(0,Y.jsx)(u.Ay,{type:"primary",onClick:()=>{H(!1)},children:"Got it"})]})]}),width:720,children:(0,Y.jsxs)("ul",{style:{paddingLeft:20},children:[(0,Y.jsx)("li",{children:"Use the Request Document button to apply for barangay certificates and permits."}),(0,Y.jsx)("li",{children:"Check your profile information regularly to ensure accuracy."}),(0,Y.jsx)("li",{children:"Contact barangay staff for assistance with business registration or solo parent certification."}),(0,Y.jsx)("li",{children:"For lost documents, use the Inquiry form to request help."}),(0,Y.jsx)("li",{children:"All document requests are processed during office hours only."})]})}),(0,Y.jsx)("div",{style:{position:"fixed",right:20,bottom:24,zIndex:1050},children:(0,Y.jsx)(A.A,{title:V?"Tips hidden (will remain hidden if checked)":"Resident Tool Tips",children:(0,Y.jsx)(u.Ay,{type:"primary",shape:"circle",size:"large",onClick:()=>H(!0),onMouseEnter:()=>Z(!0),onMouseLeave:()=>Z(!1),icon:(0,Y.jsx)(Mt.A,{style:{color:"#fff",fontSize:20}}),style:{width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:J?"0 10px 30px rgba(24,144,255,0.22)":"0 6px 18px rgba(0,0,0,0.12)",transform:J?"translateY(-4px) scale(1.03)":"none",transition:"transform 160ms cubic-bezier(.2,.8,.2,1), box-shadow 160ms"}})})})]})})},Vt=()=>{var e,t,a,i;const{user:d,setUser:c}=Pe(),m=(null!==d&&void 0!==d||(()=>{try{const e=localStorage.getItem("userProfile");return e?JSON.parse(e):null}catch(e){return null}})(),(0,pe.Zp)()),[p,x]=(0,s.useState)(null),[g,f]=(0,s.useState)(()=>(new Date).toLocaleString()),[y,j]=(0,s.useState)([]),[v,b]=(0,s.useState)(!0),[w,I]=(0,s.useState)(0),[S,C]=(0,s.useState)(0),[k,N]=(0,s.useState)(!1),[T,_]=(0,s.useState)(!1),[P,D]=(0,s.useState)([]),[R,q]=(0,s.useState)(!1),[B,L]=(0,s.useState)(!1),[O,U]=(0,s.useState)([]),[z,F]=(0,s.useState)(!1),[E,M]=(0,s.useState)(!1),[W,H]=(0,s.useState)(()=>{try{return"true"===localStorage.getItem("residentTips.hide")}catch(e){return!1}}),[V,K]=(0,s.useState)(!1),J=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch(t){return String(e)}};(0,s.useEffect)(()=>{(async()=>{try{let e;e="admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?await G.documentsAPI.getAllDocuments():await G.documentsAPI.getMyDocuments(),j(e)}catch(e){console.error("Error fetching documents:",e)}finally{b(!1)}})(),(async()=>{try{try{const e=await(await Promise.resolve().then(n.bind(n,31694))).residentPersonalInfoAPI.getPersonalInfo();if(null!==e&&void 0!==e&&e.profileImage){const t=e.profileImage.startsWith("http")?e.profileImage:"".concat(window.location.origin).concat(e.profileImage);return void x(t)}if(null!==e&&void 0!==e&&e.profileImageId)return void x((0,G.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.profileImageId)))}catch(e){}try{const e=await Promise.resolve().then(n.bind(n,31694)),t=(await e.default.get("/resident/profile")).data;if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:"".concat(window.location.origin).concat(t.profileImage);x(e)}else null!==t&&void 0!==t&&t.profileImageId&&x((0,G.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(t.profileImageId)))}catch(e){}}catch(e){}})();const e=setInterval(()=>f((new Date).toLocaleString()),1e3);return()=>clearInterval(e)},[d]),(0,s.useEffect)(()=>{(async()=>{N(!0);try{const e=await G.contactAPI.getAnnouncements();Array.isArray(e)?C(e.length):e&&"number"===typeof e.count?C(e.count):C(e&&e.length||0)}catch(e){console.error("Failed to fetch announcements:",e),C(0)}finally{N(!1)}})()},[d]);y.filter(e=>"pending"===(e.status||"").toString().toLowerCase()).length,y.filter(e=>"approved"===(e.status||"").toString().toLowerCase()).length;return(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsxs)("div",{style:{maxWidth:1200,margin:"40px auto",padding:"0 16px",position:"relative"},children:[(0,Y.jsx)("div",{style:{marginBottom:18},children:(0,Y.jsx)(l.A,{align:"middle",children:(0,Y.jsx)(o.A,{children:(0,Y.jsx)(h.A.Text,{style:{fontSize:16,color:"#888"},children:(0,Y.jsxs)("span",{style:{marginRight:8},children:[(0,Y.jsx)("span",{style:{color:"#1890ff",fontWeight:600},children:"Dashboard"})," ",">"," Home"]})})})})}),"resident"===(null===d||void 0===d?void 0:d.role)&&(0,Y.jsxs)(r.A,{style:{width:"100%",margin:"0 auto 32px",borderRadius:32,boxShadow:"0 8px 32px #bfc7d6cc",background:"linear-gradient(120deg, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",border:"none",padding:0,position:"relative",overflow:"hidden",minHeight:170},bodyStyle:{padding:0},children:[(0,Y.jsx)("div",{style:{position:"absolute",top:0,left:0,height:"100%",background:"radial-gradient(circle at 80% 20%, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",opacity:.18,zIndex:0}}),(0,Y.jsx)(l.A,{align:"middle",style:{minHeight:170,padding:"32px 32px",position:"relative",zIndex:1},justify:"space-between",children:(0,Y.jsx)(o.A,{xs:24,md:14,style:{display:"flex",alignItems:"center",gap:24},children:(0,Y.jsx)("div",{style:{display:"flex",alignItems:"center",gap:18,width:"100%",justifyContent:"space-between"},children:(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:18},children:[(0,Y.jsxs)("div",{style:{width:96,height:96,borderRadius:12,overflow:"hidden",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[p?(0,Y.jsx)("img",{src:p,alt:(null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||"avatar",style:{width:96,height:96,objectFit:"cover",borderRadius:12}}):(0,Y.jsx)(Qe,{user:(()=>{let e=d;if(!e)try{const t=localStorage.getItem("userProfile");t&&(e=JSON.parse(t))}catch(t){}return e})(),size:96}),(0,Y.jsx)("button",{onClick:()=>m("/profile"),title:"Edit profile",style:{position:"absolute",right:6,bottom:6,width:28,height:28,borderRadius:14,background:"#fff",border:"1px solid #e8e8e8",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 4px rgba(0,0,0,0.08)",cursor:"pointer"},children:(0,Y.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,Y.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z",fill:"#595959"}),(0,Y.jsx)("path",{d:"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#595959"})]})})]}),(0,Y.jsxs)("div",{children:[(0,Y.jsx)(h.A.Title,{level:3,style:{marginBottom:0,fontWeight:800},children:null!==(e=null!==(t=null!==(a=null===d||void 0===d?void 0:d.fullName)&&void 0!==a?a:null===d||void 0===d?void 0:d.username)&&void 0!==t?t:null===d||void 0===d?void 0:d.email)&&void 0!==e?e:""}),(0,Y.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:18},children:["Barangay ID: ",null!==(i=null===d||void 0===d?void 0:d.barangayID)&&void 0!==i?i:(()=>{try{const e=localStorage.getItem("userProfile");if(e){const t=JSON.parse(e);return(null===t||void 0===t?void 0:t.barangayID)||"N/A"}}catch(e){}return"N/A"})()]}),(0,Y.jsx)("div",{style:{marginTop:8},children:(0,Y.jsx)(h.A.Text,{type:"secondary",children:(new Date).toLocaleString()})})]})]})})})})]}),(0,Y.jsxs)(l.A,{gutter:[32,32],justify:"center",style:{marginBottom:40},children:[(0,Y.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,Y.jsx)(r.A,{onClick:()=>m("/request"),hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #1890ff44",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,Y.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,Y.jsx)("div",{style:{background:"#1890ff",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,Y.jsx)(X.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,Y.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:"Request"}),(0,Y.jsx)(h.A.Text,{style:{fontSize:18,color:"#1890ff",fontWeight:700},children:"Request Document"})]})})}),(0,Y.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,Y.jsx)(r.A,{onClick:()=>m("/announcements"),hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #eb2f9644",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,Y.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,Y.jsx)("div",{style:{background:"#eb2f96",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,Y.jsx)(Ut.A,{count:S,offset:[8,0],children:(0,Y.jsx)(Je.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})})}),(0,Y.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:S}),(0,Y.jsx)(h.A.Text,{style:{fontSize:18,color:"#eb2f96",fontWeight:700},children:"Announcements"})]})})})]}),(0,Y.jsx)(ge.A,{title:"Pending Requests",visible:T,onCancel:()=>_(!1),footer:null,width:800,children:(0,Y.jsx)(zt.A,{dataSource:P,loading:R,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,Y.jsx)(ge.A,{title:"Approved Documents",visible:B,onCancel:()=>L(!1),footer:null,width:1e3,children:(0,Y.jsx)(zt.A,{dataSource:O,loading:z,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Date Requested",dataIndex:"dateRequested",key:"dateRequested",render:(e,t)=>J(t.dateRequested||t.requestedAt||t.createdAt)},{title:"Date Approved",dataIndex:"dateApproved",key:"dateApproved",render:(e,t)=>J(t.dateApproved||t.approvedAt||t.approvedOn||t.updatedAt)},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,Y.jsx)(ge.A,{title:"Resident Tool Tips",visible:E,onCancel:()=>M(!1),footer:(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,Y.jsx)(Ft.A,{checked:W,onChange:e=>{const t=e.target.checked;H(t);try{localStorage.setItem("residentTips.hide",t?"true":"false")}catch(n){}},children:"Don't show again"}),(0,Y.jsxs)("div",{children:[(0,Y.jsx)(u.Ay,{onClick:()=>M(!1),style:{marginRight:8},children:"Cancel"}),(0,Y.jsx)(u.Ay,{type:"primary",onClick:()=>{M(!1)},children:"Got it"})]})]}),width:720,children:(0,Y.jsxs)("ul",{style:{paddingLeft:20},children:[(0,Y.jsx)("li",{children:"Use the Request Document button to apply for barangay certificates and permits."}),(0,Y.jsx)("li",{children:"Check your profile information regularly to ensure accuracy."}),(0,Y.jsx)("li",{children:"Contact barangay staff for assistance with business registration or solo parent certification."}),(0,Y.jsx)("li",{children:"For lost documents, contact barangay staff or visit the office for assistance."}),(0,Y.jsx)("li",{children:"All document requests are processed during office hours only."})]})}),(0,Y.jsx)("div",{style:{position:"fixed",right:20,bottom:24,zIndex:1050},children:(0,Y.jsx)(A.A,{title:W?"Tips hidden (will remain hidden if checked)":"Resident Tool Tips",children:(0,Y.jsx)(u.Ay,{type:"primary",shape:"circle",size:"large",onClick:()=>M(!0),onMouseEnter:()=>K(!0),onMouseLeave:()=>K(!1),icon:(0,Y.jsx)(Mt.A,{style:{color:"#fff",fontSize:20}}),style:{width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:V?"0 10px 30px rgba(24,144,255,0.22)":"0 6px 18px rgba(0,0,0,0.12)",transform:V?"translateY(-4px) scale(1.03)":"none",transition:"transform 160ms cubic-bezier(.2,.8,.2,1), box-shadow 160ms"}})})})]})})};var Gt=n(80349),Kt=n(97326),Jt=n(99472),Zt=n(48677),$t=n(99098),Qt=n(33498),Xt=(n(96292),n(57305)),en=n(89157),tn=n(57179),nn=n(82282),an=n(41739),sn=n(81877),rn=n(25870);const ln=()=>{const{user:e}=Pe(),t=(0,pe.Zp)(),[i,d]=(0,s.useState)(!1),[m,x]=(0,s.useState)([]),[A,j]=(0,s.useState)([]),[v,w]=(0,s.useState)([]),[I,S]=(0,s.useState)(()=>{try{const e=localStorage.getItem("viewedInquiries"),t=e?JSON.parse(e):[];return new Set(t||[])}catch(e){return new Set}}),C=e=>{e&&S(t=>{const n=new Set(Array.from(t));n.add(String(e));try{localStorage.setItem("viewedInquiries",JSON.stringify(Array.from(n)))}catch(a){}return n})},[k,N]=(0,s.useState)([]),[T,_]=(0,s.useState)([]),[P,D]=(0,s.useState)(!1),[R,q]=(0,s.useState)(null),[B,L]=(0,s.useState)(!1),[O,U]=(0,s.useState)(null),[z,F]=(0,s.useState)(null),[E,M]=(0,s.useState)(!1),[W,H]=(0,s.useState)(null),[V,K]=(0,s.useState)(""),[J,Z]=(0,s.useState)(""),[$,Q]=(0,s.useState)(!1),[X,ee]=(0,s.useState)(!1),[te,ne]=(0,s.useState)(!1),[ae,se]=(0,s.useState)([]),[ie,re]=(0,s.useState)(!1),le={};m.forEach(e=>{const t=e.type||"Unknown";le[t]||(le[t]=[]),le[t].push(e)});const[oe,de]=(0,s.useState)({pendingRequests:0,totalDocuments:0,completedRequests:0}),ce=e=>(0,Y.jsx)(f.A,{color:{pending:"gold",approved:"success",rejected:"error",processing:"processing"}[(null===e||void 0===e?void 0:e.toLowerCase())||"default"],children:(null===e||void 0===e?void 0:e.toUpperCase())||"UNKNOWN"});(0,s.useEffect)(()=>{(async()=>{d(!0);try{const[n,a]=await Promise.all([G.documentsAPI.getDocumentRecords(),G.contactAPI.getAllInquiries()]);x(n),j(a);const s=a.filter(t=>t.assignedRole&&e&&t.assignedRole===e.role||t.assignedTo&&Array.isArray(t.assignedTo)&&e&&t.assignedTo.includes(e._id));w(s);let i=n.length;try{const e=await G.axiosInstance.get("/processed-documents",{params:{page:1,limit:1}}),t=e&&e.data?e.data:null;t&&"number"===typeof t.total&&(i=t.total)}catch(t){}de({pendingRequests:n.filter(e=>"pending"===e.status).length,totalDocuments:i,completedRequests:n.filter(e=>"approved"===e.status).length})}catch(n){console.error("Error fetching data:",n)}finally{d(!1)}})(),ue()},[]);const ue=async()=>{D(!0);try{const e=await G.contactAPI.getAnnouncements();_(Array.isArray(e)?e.slice(0,6):[])}catch(e){console.error("Failed to load mini announcements",e),_([])}finally{D(!1)}};function he(e){if(!e)return"Unknown";let t=e;return t=t.replace(/^Other\s*/i,"").trim(),t.split("_").map(e=>{const t=e||"";return t.length>0?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():""}).filter(Boolean).join(" ")}function me(e){if(!e)return"";return new Date(e).toLocaleString()}const xe=function(){return((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])||[]).slice().sort((e,t)=>{const n=e&&e.createdAt?new Date(e.createdAt).getTime():0;return(t&&t.createdAt?new Date(t.createdAt).getTime():0)-n})},fe=(e,n)=>{t(e,{state:n})},ye=e=>{try{t(e)}catch(n){window.location.href=e}};return(0,Y.jsx)(p.A,{spinning:i,tip:"Loading...",children:(0,Y.jsxs)("div",{children:[(0,Y.jsxs)(l.A,{gutter:[16,16],style:{marginBottom:24},children:[(0,Y.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,Y.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>{const e=m.find(e=>"pending"===e.status);e&&e._id?fe("/document-processing",{openRequestId:e._id}):fe("/document-processing")},style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,Y.jsx)(ht.A,{title:(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(y.A,{size:"small",style:{backgroundColor:"#fff7e6",color:"#faad14"},children:(0,Y.jsx)(Xt.A,{style:{fontSize:"14px"}})}),(0,Y.jsx)("span",{children:"Pending Requests"})]}),value:oe.pendingRequests,valueStyle:{color:"#faad14",fontSize:"28px",marginBottom:"4px"},prefix:(0,Y.jsx)(en.A,{style:{fontSize:"16px"}})}),(0,Y.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#faad14"},children:["View Pending Requests",(0,Y.jsx)(gt.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})}),(0,Y.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,Y.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>(async()=>{re(!0);try{let n=[];try{const e=await G.axiosInstance.get("/processed-documents",{params:{page:1,limit:200}}),t=e&&e.data?e.data:null;t&&Array.isArray(t.items)?n=t.items:Array.isArray(t)&&(n=t)}catch(e){try{const e=await G.documentsAPI.listFiles();n=(Array.isArray(e)?e:e&&e.data?e.data:[]).filter(e=>{const t=(e.status||"").toString().toLowerCase();return["processed","approved","completed"].includes(t)||!0===e.processed})}catch(t){n=[]}}se(n||[])}catch(n){console.error("Failed to fetch documents for modal",n),se([])}finally{re(!1),ne(!0)}})(),style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,Y.jsx)(ht.A,{title:(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(y.A,{size:"small",style:{backgroundColor:"#e6f7ff",color:"#1890ff"},children:(0,Y.jsx)(tn.A,{style:{fontSize:"14px"}})}),(0,Y.jsx)("span",{children:"Total Documents"})]}),value:oe.totalDocuments,valueStyle:{color:"#1890ff",fontSize:"28px",marginBottom:"4px"},prefix:(0,Y.jsx)(nn.A,{style:{fontSize:"16px"}})}),(0,Y.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#1890ff"},children:["Browse Documents",(0,Y.jsx)(gt.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})}),(0,Y.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,Y.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>ee(!0),style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,Y.jsx)(ht.A,{title:(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(y.A,{size:"small",style:{backgroundColor:"#f6ffed",color:"#52c41a"},children:(0,Y.jsx)(an.A,{style:{fontSize:"14px"}})}),(0,Y.jsx)("span",{children:"Completed Requests"})]}),value:oe.completedRequests,valueStyle:{color:"#52c41a",fontSize:"28px",marginBottom:"4px"},prefix:(0,Y.jsx)(we.A,{style:{fontSize:"16px"}})}),(0,Y.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#52c41a"},children:["View Completed",(0,Y.jsx)(gt.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})}),(0,Y.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,Y.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>ye("/staff/inbox"),style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,Y.jsx)(ht.A,{title:(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(y.A,{size:"small",style:{backgroundColor:"#f9f0ff",color:"#722ed1"},children:(0,Y.jsx)(b.A,{style:{fontSize:"14px"}})}),(0,Y.jsx)("span",{children:"Staff Inbox"})]}),value:v.length,valueStyle:{color:"#722ed1",fontSize:"28px",marginBottom:"4px"},prefix:(0,Y.jsx)(Me.A,{style:{fontSize:"16px"}})}),(0,Y.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#722ed1"},children:["Open Inbox",(0,Y.jsx)(gt.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})})]}),(0,Y.jsxs)(l.A,{gutter:[16,16],children:[(0,Y.jsx)(o.A,{xs:24,lg:8,children:(0,Y.jsx)(r.A,{title:(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(sn.A,{})," Document Categories"]}),hoverable:!0,bordered:!1,size:"small",className:"dashboard-card",style:{transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},bodyStyle:{padding:"0",height:"400px",maxHeight:"400px",overflow:"hidden"},children:(0,Y.jsx)(Kt.A,{defaultActiveKey:["Certificates"],expandIcon:e=>{let{isActive:t}=e;return(0,Y.jsx)(gt.A,{rotate:t?90:0})},style:{background:"white",height:"400px",overflowY:"auto"},children:Object.entries((e=>{const t={Certificates:{icon:(0,Y.jsx)($t.A,{style:{fontSize:"18px",color:"#1890ff"}}),items:[],color:"#1890ff",description:"Birth, Death, Residency Certificates and more"},Permits:{icon:(0,Y.jsx)(Qt.A,{style:{fontSize:"18px",color:"#52c41a"}}),items:[],color:"#52c41a",description:"Building, Business, and Special Event Permits"},Complete:{icon:(0,Y.jsx)(Ge.A,{style:{fontSize:"18px",color:"#52c41a"}}),items:[],color:"#52c41a",description:"All completed and approved document requests"}};return e.forEach(e=>{const n=(e.type||"").toLowerCase(),a=(e.status||"").toLowerCase();n.includes("certificate")||n.includes("certification")?t.Certificates.items.push(e):n.includes("permit")&&t.Permits.items.push(e),"approved"!==a&&"completed"!==a||t.Complete.items.push(e)}),t})(m)).map(e=>{let[n,a]=e;const s=a.items.filter(e=>{var t;return"pending"===(null===(t=e.status)||void 0===t?void 0:t.toLowerCase())}).length;return(0,Y.jsxs)(Kt.A.Panel,{header:(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[(0,Y.jsxs)(Oe.A,{align:"center",children:[(0,Y.jsx)(y.A,{size:"small",style:{backgroundColor:a.color+"15",color:a.color},children:a.icon}),(0,Y.jsx)("span",{style:{fontWeight:500,fontSize:"14px"},children:n})]}),(0,Y.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:"8px",alignItems:"center"},children:[s>0&&(0,Y.jsxs)(f.A,{color:"gold",style:{marginRight:0},children:[s," pending"]}),(0,Y.jsx)(Ut.A,{count:a.items.length,style:{backgroundColor:a.color},size:"small"})]})]}),children:[(0,Y.jsx)("div",{style:{marginBottom:"16px"},children:(0,Y.jsx)(h.A.Text,{type:"secondary",style:{fontSize:"13px"},children:a.description})}),(0,Y.jsx)(g.A,{size:"small",dataSource:a.items.slice(0,5),split:!0,renderItem:e=>{var n;const a={PENDING:{color:"#faad14",bg:"#fff7e6"},APPROVED:{color:"#52c41a",bg:"#f6ffed"},REJECTED:{color:"#ff4d4f",bg:"#fff1f0"},DEFAULT:{color:"#8c8c8c",bg:"#f5f5f5"}},s=(null===(n=e.status)||void 0===n?void 0:n.toUpperCase())||"DEFAULT",i=a[s]||a.DEFAULT;return(0,Y.jsx)(g.A.Item,{onClick:()=>t("/document-processing",{state:{openRequestId:e._id}}),actions:["PENDING"===e.status&&(0,Y.jsxs)(Oe.A,{size:4,children:[(0,Y.jsx)(u.Ay,{type:"text",size:"small",icon:(0,Y.jsx)(we.A,{style:{color:"#52c41a"}}),onClick:t=>{t.stopPropagation(),U(e),Z("APPROVED")}}),(0,Y.jsx)(u.Ay,{type:"text",size:"small",icon:(0,Y.jsx)(rn.A,{style:{color:"#ff4d4f"}}),onClick:t=>{t.stopPropagation(),U(e),Z("REJECTED")}})]})].filter(Boolean),style:{padding:"12px 0"},children:(0,Y.jsx)(g.A.Item.Meta,{avatar:(0,Y.jsx)(y.A,{size:36,style:{backgroundColor:i.bg,color:i.color},icon:(0,Y.jsx)(Ee.A,{})}),title:(0,Y.jsxs)(Oe.A,{size:8,style:{marginBottom:4},children:[(0,Y.jsx)(h.A.Text,{strong:!0,style:{fontSize:"14px"},children:he(e.type||e.title)}),(0,Y.jsx)(f.A,{color:i.color,style:{margin:0,padding:"0 6px",fontSize:"12px",lineHeight:"18px"},children:s})]}),description:(0,Y.jsxs)(Oe.A,{direction:"vertical",size:0,children:[(0,Y.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:"13px"},children:["Requested by: ",e.username||"Unknown"]}),(0,Y.jsx)(h.A.Text,{type:"secondary",style:{fontSize:"12px"},children:me(e.dateRequested||"")})]})})})},locale:{emptyText:(0,Y.jsx)(Jt.A,{image:Jt.A.PRESENTED_IMAGE_SIMPLE,description:(0,Y.jsxs)(h.A.Text,{type:"secondary",children:["No ",n.toLowerCase()," requests"]})})}}),a.items.length>0&&(0,Y.jsx)("div",{style:{textAlign:"center",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #f0f0f0"},children:(0,Y.jsxs)(u.Ay,{type:"link",size:"small",icon:a.icon,onClick:()=>ye("/documents"),children:["View All ",n]})})]},n)})})})}),(0,Y.jsx)(o.A,{xs:24,lg:8,children:(0,Y.jsx)(r.A,{title:(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(Et.A,{}),(0,Y.jsx)("span",{children:"Inquiries Inbox"}),(0,Y.jsx)(Ut.A,{count:v.filter(e=>"open"===e.status||"PENDING"===e.status).length,style:{backgroundColor:"#722ed1"}})]}),extra:(0,Y.jsx)(Oe.A,{children:(0,Y.jsx)(ht.A,{value:v.length,suffix:"total",valueStyle:{fontSize:"14px",color:"#8c8c8c"}})}),hoverable:!0,bordered:!1,size:"small",className:"dashboard-card",style:{transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",position:"relative"},bodyStyle:{height:"400px",maxHeight:"400px",padding:0,overflow:"hidden"},children:(0,Y.jsxs)("div",{style:{padding:"0 12px"},children:[(0,Y.jsxs)(Kt.A,{accordion:!1,defaultActiveKey:["open"],expandIcon:e=>{let{isActive:t}=e;return(0,Y.jsx)(gt.A,{rotate:t?90:0})},style:{background:"white"},children:[(0,Y.jsx)(Kt.A.Panel,{header:(0,Y.jsx)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:(0,Y.jsxs)(Oe.A,{align:"center",children:[(0,Y.jsx)(Et.A,{style:{color:"#722ed1",fontSize:"16px"}}),(0,Y.jsx)(h.A.Text,{strong:!0,children:"Open Inquiries"}),(0,Y.jsx)(Ut.A,{count:v.filter(e=>"PENDING"===e.status||"open"===e.status).length,style:{backgroundColor:"#722ed1"}})]})}),children:(0,Y.jsx)("div",{style:{maxHeight:300,overflowY:"auto",paddingRight:8},children:0===v.filter(e=>"PENDING"===e.status||"open"===e.status).length?(0,Y.jsx)(Jt.A,{image:Jt.A.PRESENTED_IMAGE_SIMPLE,description:(0,Y.jsx)(h.A.Text,{type:"secondary",children:"No open inquiries"})}):(0,Y.jsx)(g.A,{size:"large",dataSource:xe(v.filter(e=>"PENDING"===e.status||"open"===e.status)),renderItem:e=>{const n="PENDING"===e.status||"open"===e.status,a=n?"#722ed1":"#8c8c8c",s=n?"#f9f0ff":"#f5f5f5",i=e._id&&I.has(String(e._id)),r=e.username||e.residentName||e.subject||"Unknown",l=r&&"Unknown"!==r&&r.length>0?r.charAt(0).toUpperCase():"?";return(0,Y.jsx)(g.A.Item,{style:{padding:"18px 20px",minHeight:72,borderBottom:"1px solid #f0f0f0",transition:"all 0.3s ease",cursor:"pointer",backgroundColor:"white"},onClick:()=>{e._id&&C(String(e._id)),t("/staff/inbox",{state:{openInquiryId:e._id}})},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#fafafa"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="white"},children:(0,Y.jsx)(g.A.Item.Meta,{avatar:(0,Y.jsx)(Ut.A,{dot:n,color:n&&!i?"#faad14":"#722ed1",offset:[-6,6],children:(0,Y.jsx)(y.A,{size:40,style:{backgroundColor:s,color:a,fontSize:"15px",fontWeight:600},children:l})}),title:(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:0},children:[(0,Y.jsx)("div",{style:{fontSize:"14px",fontWeight:600,color:"rgba(0, 0, 0, 0.85)"},children:e.username||"Unknown User"}),(0,Y.jsx)(f.A,{color:n?"gold":"success",style:{margin:0,fontSize:"12px",lineHeight:"20px",height:"22px",padding:"0 10px",fontWeight:"normal",borderRadius:"4px"},children:n?"PENDING":"RESOLVED"}),n&&!i&&(0,Y.jsx)(f.A,{color:"default",onClick:t=>{t.stopPropagation(),e._id&&C(String(e._id))},style:{marginLeft:8,cursor:"pointer",background:"#fff7e6",color:"#d48806",border:"1px solid #ffd591"},children:"UNREAD"})]}),description:(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",width:"100%"},children:[(0,Y.jsx)(h.A.Text,{style:{fontSize:"13px",color:"rgba(0, 0, 0, 0.65)",flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.5"},children:e.message}),(0,Y.jsx)(h.A.Text,{type:"secondary",style:{fontSize:"12px",flexShrink:0,color:"#8c8c8c"},children:me(e.createdAt)})]})})})}})})},"open"),(0,Y.jsx)(Kt.A.Panel,{header:(0,Y.jsx)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:(0,Y.jsxs)(Oe.A,{align:"center",children:[(0,Y.jsx)(Et.A,{style:{color:"#52c41a",fontSize:"16px"}}),(0,Y.jsx)(h.A.Text,{strong:!0,children:"Resolved Inquiries"}),(0,Y.jsx)(Ut.A,{count:v.filter(e=>!("PENDING"===e.status||"open"===e.status)).length,style:{backgroundColor:"#52c41a"}})]})}),children:(0,Y.jsx)("div",{style:{maxHeight:220,overflowY:"auto",paddingRight:8},children:0===v.filter(e=>!("PENDING"===e.status||"open"===e.status)).length?(0,Y.jsx)(Jt.A,{image:Jt.A.PRESENTED_IMAGE_SIMPLE,description:(0,Y.jsx)(h.A.Text,{type:"secondary",children:"No resolved inquiries"})}):(0,Y.jsx)(g.A,{size:"small",dataSource:xe(v.filter(e=>!("PENDING"===e.status||"open"===e.status))),renderItem:e=>(0,Y.jsx)(g.A.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},onClick:()=>{e._id&&C(String(e._id)),F(e)},children:(0,Y.jsx)(g.A.Item.Meta,{avatar:(0,Y.jsx)(y.A,{size:40,style:{backgroundColor:"#f5f5f5",color:"#8c8c8c",fontSize:14},children:(e.username||"Unknown").charAt(0).toUpperCase()}),title:(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,Y.jsx)("div",{style:{fontSize:13,fontWeight:600},children:e.username||"Unknown User"}),(0,Y.jsx)(f.A,{color:"success",style:{margin:0,fontSize:12},children:"RESOLVED"})]}),description:(0,Y.jsx)("div",{style:{fontSize:12,color:"#888"},children:e.message})})})})})},"resolved")]}),(0,Y.jsx)("div",{style:{position:"absolute",right:12,bottom:12,zIndex:40},children:(0,Y.jsx)(u.Ay,{type:"link",style:{position:"absolute",right:16,bottom:0,fontSize:13,color:"#1890ff",zIndex:50,pointerEvents:"auto"},onClick:e=>{try{e.stopPropagation()}catch(n){}t("/inquiry-tracker")},children:"Expand"})})]})})}),(0,Y.jsx)(o.A,{xs:24,lg:8,children:(0,Y.jsxs)(r.A,{title:(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(Ee.A,{})," Announcements"]}),style:{marginTop:0,background:"#fafbfc",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0",position:"relative"},styles:{body:{padding:12}},size:"small",hoverable:!1,children:[0===T.length?(0,Y.jsx)(Jt.A,{image:(0,Y.jsx)(Ee.A,{style:{fontSize:42,color:"#d9d9d9"}}),description:(0,Y.jsx)("span",{style:{color:"#888"},children:"No announcements"})}):(0,Y.jsx)("div",{style:{maxHeight:320,overflowY:"auto",paddingRight:6},children:(0,Y.jsx)(g.A,{loading:P,dataSource:T,renderItem:e=>(0,Y.jsxs)(g.A.Item,{style:{cursor:"pointer",padding:"10px 8px",alignItems:"center"},onClick:()=>{q(e),L(!0)},children:[(0,Y.jsx)(g.A.Item.Meta,{title:(0,Y.jsx)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:(0,Y.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,Y.jsx)("div",{style:{fontWeight:600,fontSize:13,display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.2em"},children:e.text||"Untitled"}),(0,Y.jsx)("div",{style:{fontSize:12,color:"#888",marginTop:6},children:new Date(e.createdAt).toLocaleString()})]})}),description:null}),e.imagePath&&(0,Y.jsx)("div",{style:{marginLeft:12,width:92,display:"flex",justifyContent:"flex-end",flexShrink:0},children:(0,Y.jsx)("img",{loading:"lazy",className:"rounded-img",src:(0,G.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image")),alt:"ann",style:{width:92,height:60,objectFit:"cover",borderRadius:6,background:"#f0f0f0"}})})]}),size:"small"})}),(0,Y.jsx)(u.Ay,{type:"link",style:{position:"absolute",right:16,bottom:0,fontSize:13,color:"#1890ff"},onClick:()=>t("/admin/announcements"),children:"Manage"}),(0,Y.jsx)(Zt.A,{open:B,onClose:()=>{L(!1),q(null)},title:"Announcement",width:720,placement:"right",children:R&&(0,Y.jsxs)("div",{children:[(0,Y.jsx)(h.A.Text,{style:{display:"block",marginBottom:12,whiteSpace:"pre-wrap"},children:R.text}),R.imagePath&&(0,Y.jsx)("img",{loading:"lazy",className:"rounded-img rounded-img-lg",src:(0,G.getAbsoluteApiUrl)("/announcements/".concat(R._id,"/image")),alt:"announcement",style:{width:"100%",height:"auto",borderRadius:8,background:"#f6f6f6"}}),(0,Y.jsx)("div",{style:{marginTop:8,color:"#888"},children:new Date(R.createdAt).toLocaleString()})]})})]})})]}),(0,Y.jsxs)(ge.A,{open:te,title:"Processed Documents (".concat(ae.length,")"),onCancel:()=>{ne(!1)},footer:null,width:900,children:[(0,Y.jsx)(p.A,{spinning:ie,children:(0,Y.jsx)(zt.A,{dataSource:ae,rowKey:e=>e._id||e.id||e.filename,pagination:{pageSize:10},columns:[{title:"Title",dataIndex:"title",key:"title",render:(e,t)=>e||t.filename||t.name||"Untitled"},{title:"Date",dataIndex:"createdAt",key:"createdAt",render:e=>me(e)},{title:"Action",key:"action",width:120,render:(e,t)=>(0,Y.jsx)(u.Ay,{type:"link",onClick:()=>(async e=>{try{const a=e=>{if(!e&&0!==e)return null;if("string"===typeof e)return e;if("object"===typeof e){if("string"===typeof e.$oid)return e.$oid;try{const t=e.toString();if(t&&"[object Object]"!==t)return t}catch(t){}return null}return String(e)},s=[],i=a(e&&e._id),r=a(e&&e.gridFsFileId);i&&s.push(i),r&&s.push(r);const l=Array.from(new Set(s));let o=null,d=null;console.debug("[handleDownloadProcessed] record:",e,"candidateIds:",l);let c=null,u=null;for(const e of l)try{console.debug("[handleDownloadProcessed] attempting id=",e);const t=await(await Promise.resolve().then(n.bind(n,31694))).axiosInstance.get("/processed-documents/".concat(e,"/raw"),{responseType:"blob"});if(t&&t.status>=200&&t.status<300){c=t.data,u=t.headers||{},o=e;break}}catch(t){const e=t&&t.response&&t.response.status?t.response.status:null;if(404===e){d={status:404,body:t.response&&t.response.data?t.response.data:null};continue}return void Gt.Ay.error({message:"Download failed",description:e?"Server returned ".concat(e):String(t)})}if(!c){const e=d&&d.body&&d.body.message?d.body.message:d&&d.message?d.message:"File not found";return void Gt.Ay.error({message:"Download failed",description:e})}const h=c;let m=null;const p=u&&(u["content-disposition"]||u["Content-Disposition"])||null;if(p){const e=p.match(/filename\*=UTF-8''([^;\n\r]+)/i);if(e&&e[1])m=decodeURIComponent(e[1]);else{const e=p.match(/filename="?([^";]+)"?/i);e&&e[1]&&(m=e[1])}}m||(m=u&&(u["x-processed-transactioncode"]||u["X-Processed-TransactionCode"])||e.filename||e.name||"document_".concat(o||e._id,".docx"));const x=window.URL.createObjectURL(h),g=document.createElement("a");g.href=x;const f=m||"document_".concat(o||e._id,".docx");g.download=f,document.body.appendChild(g),g.click(),g.remove(),window.URL.revokeObjectURL(x)}catch(t){console.error("Download error",t),Gt.Ay.error({message:"Download error",description:String(t)})}})(t),children:"Download"})}]})}),(0,Y.jsx)(ge.A,{title:"Manage Inquiries",open:E,onCancel:()=>{M(!1),H(null)},footer:null,width:900,children:(0,Y.jsxs)(zt.A,{dataSource:null!==W?W:xe(A),rowKey:e=>e._id,pagination:{pageSize:10},onRow:e=>({onClick:()=>{e&&e._id&&C(String(e._id)),M(!1),t("/staff/inbox",{state:{openInquiryId:e._id}})}}),children:[(0,Y.jsx)(zt.A.Column,{title:"Name",dataIndex:"username",render:(e,t)=>e||t.residentName||t.subject||"Unknown"},"username"),(0,Y.jsx)(zt.A.Column,{title:"Type of Inquiry",dataIndex:"type",render:e=>e?String(e):"General"},"type"),(0,Y.jsx)(zt.A.Column,{title:"Status",dataIndex:"status",render:e=>ce(e)},"status"),(0,Y.jsx)(zt.A.Column,{title:"Date Inquired",dataIndex:"createdAt",render:e=>me(e)},"createdAt")]})})]}),(0,Y.jsx)(ge.A,{open:!!O,title:O?"".concat(J," Document Request"):"",onCancel:()=>{U(null),K(""),Z("")},footer:O?[(0,Y.jsx)(c.A.TextArea,{rows:4,value:V,onChange:e=>K(e.target.value),placeholder:"Type notes..."},"notes"),(0,Y.jsx)(u.Ay,{type:"primary",disabled:!V.trim(),onClick:async()=>{if(!O)return;const e=O._id||O.id;if(e)try{const t={status:(J||"").toString().toLowerCase(),notes:V};Gt.Ay.info({message:"Processing",description:"Updating document status to ".concat(t.status,"..."),duration:1.2}),await G.documentsAPI.updateDocumentStatus(e,t),x(n=>(n||[]).map(n=>!n||n._id!==e&&n.id!==e?n:(0,a.A)((0,a.A)({},n),{},{status:t.status}))),Gt.Ay.success({message:"Success",description:"Document marked ".concat(t.status)}),U(null),K(""),Z("")}catch(s){var t,n;console.error("Failed to update document status",s);const e=(null===s||void 0===s||null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||(null===s||void 0===s?void 0:s.message)||"Failed to update document";Gt.Ay.error({message:"Error",description:e})}},children:"Submit"},"submit")]:null,children:O&&(0,Y.jsxs)("div",{children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Type:"})," ",he(O.type||O.title),(0,Y.jsx)("br",{}),(0,Y.jsx)(h.A.Text,{strong:!0,children:"Description:"})," ",O.description||"",(0,Y.jsx)("br",{}),(0,Y.jsx)(h.A.Text,{strong:!0,children:"Requested by:"})," ",O.username||"Unknown",(0,Y.jsx)("br",{}),(0,Y.jsx)(h.A.Text,{strong:!0,children:"Barangay ID:"})," ",O.barangayID||"Unknown",(0,Y.jsx)("br",{}),(0,Y.jsx)(h.A.Text,{strong:!0,children:"Date:"})," ",me(O.dateRequested||""),(0,Y.jsx)("br",{})]})}),(0,Y.jsx)(ge.A,{open:!!z,title:z?"Respond to Inquiry: ".concat(z.subject):"",onCancel:()=>{F(null),K("")},footer:z?[(0,Y.jsx)(c.A.TextArea,{rows:4,value:V,onChange:e=>K(e.target.value),placeholder:"Type your response...",disabled:$},"response"),(0,Y.jsx)(u.Ay,{type:"primary",loading:$,disabled:!V.trim(),onClick:async()=>{if(!z)return;const e=z._id||z.id;if(e)try{Gt.Ay.info({message:"Sending response",description:"Posting your reply...",duration:1.2}),await G.contactAPI.respondToInquiry(e,{response:V}),j(t=>(t||[]).map(t=>!t||t._id!==e&&t.id!==e?t:(0,a.A)((0,a.A)({},t),{},{status:"resolved"}))),Gt.Ay.success({message:"Response sent",description:"Inquiry has been updated"}),F(null),K("")}catch(s){var t,n;console.error("Failed to send inquiry response",s);const e=(null===s||void 0===s||null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||(null===s||void 0===s?void 0:s.message)||"Failed to send response";Gt.Ay.error({message:"Error",description:e})}},children:"Send Response"},"send")]:null,children:z&&(0,Y.jsxs)("div",{children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Type:"})," ",z.type,(0,Y.jsx)("br",{}),(0,Y.jsx)(h.A.Text,{strong:!0,children:"Message:"})," ",z.message,(0,Y.jsx)("br",{}),(0,Y.jsx)(h.A.Text,{strong:!0,children:"From:"})," ",z.username?"".concat(z.username," (Barangay ID: ").concat(z.barangayID||"Unknown",")"):"Unknown",(0,Y.jsx)("br",{}),(0,Y.jsx)(h.A.Text,{strong:!0,children:"Date:"})," ",me(z.createdAt),(0,Y.jsx)("br",{})]})}),(0,Y.jsx)(ge.A,{open:X,title:"Completed Requests (".concat(oe.completedRequests||0,")"),onCancel:()=>ee(!1),footer:null,width:1100,bodyStyle:{padding:12},children:(0,Y.jsx)("div",{style:{overflowX:"auto"},children:(0,Y.jsx)(zt.A,{dataSource:m.filter(e=>"approved"===(e.status||"").toLowerCase()||"completed"===(e.status||"").toLowerCase()),rowKey:e=>e._id,pagination:{pageSize:10},scroll:{x:1e3},columns:[{title:"Requester",dataIndex:"username",key:"username",width:200,render:(e,t)=>{var n;return e||(null===(n=t.requesterId)||void 0===n?void 0:n.fullName)||"Unknown"}},{title:"Document",dataIndex:"type",key:"type",width:220,render:(e,t)=>he(e||t.title)},{title:"Description",dataIndex:"description",key:"description",width:300,render:e=>e||"-"},{title:"Date Requested",dataIndex:"dateRequested",key:"dateRequested",width:180,render:e=>me(e)},{title:"Status",dataIndex:"status",key:"status",width:120,render:e=>ce(e)},{title:"Action",key:"action",width:120,render:(e,t)=>(0,Y.jsx)(u.Ay,{type:"link",onClick:()=>{U(t),ee(!1),Z("")},children:"View"})}]})})})]})})};var on=n(87674),dn=n(42104);let cn=null;function un(e,t){cn&&cn.on(e,t)}function hn(e,t){cn&&cn.off(e,t)}const mn=["#6366F1","#22C55E","#F59E42","#EF4444","#3B82F6","#FBBF24","#A21CAF","#14B8A6"],{Title:pn,Text:xn}=h.A,gn=()=>{const e=(0,pe.Zp)(),{user:t}=Pe(),[n,i]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!1),[h,m]=(0,s.useState)([]),[x,f]=(0,s.useState)({totalUsers:0,activeUsers:0,pendingRequests:0,totalDocuments:0,completedRequests:0,unreadMessages:0}),[A,j]=(0,s.useState)([]),[v,b]=(0,s.useState)([]),[w,I]=(0,s.useState)([]),[S,C]=(0,s.useState)([]),[k,N]=(0,s.useState)([]),[T,_]=(0,s.useState)(!1),[P,D]=(0,s.useState)(!1),[R,q]=(0,s.useState)(null),[B,L]=(0,s.useState)(null),[O,U]=(0,s.useState)(""),[z,F]=(0,s.useState)(!1),[E,M]=(0,s.useState)([]),[W,H]=(0,s.useState)([]),V=[3,5,4,6,7,8,10],K=[{type:"Clearance",value:12},{type:"Certificate",value:8},{type:"Permit",value:5},{type:"Other",value:3}],J=[{type:"Clearance",value:27},{type:"Certificate",value:18},{type:"Permit",value:12},{type:"Other",value:8}];const Z=async()=>{try{var e,n,a,s,r;i(!0);const d=await G.adminAPI.getSystemStatistics();try{const e=await G.documentsAPI.getDocumentRecords();m(e)}catch(l){m([])}const c=(await G.notificationAPI.getNotifications()).filter(e=>!e.read);j(c.slice(0,10));const u=c.filter(e=>(e.type||"").toString().toLowerCase().includes("staff"));b(u);try{const e=await G.requestsAPI.getStaffAccessRequests();I(e||[])}catch(l){I([])}const h=((null===(e=d.documents)||void 0===e?void 0:e.pending)||0)+u.length,p=(null===(n=d.documents)||void 0===n?void 0:n.total)||0;let x=0;try{const e=await G.documentsAPI.getDocumentRecords();x=((Array.isArray(e)?e:e&&e.data?e.data:[])||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase()).length}catch(o){x=h}const g=x+(u?u.length:0);f({totalUsers:(null===(a=d.users)||void 0===a?void 0:a.total)||0,activeUsers:(null===(s=d.users)||void 0===s?void 0:s.active)||0,pendingRequests:g,totalDocuments:p,completedRequests:(null===(r=d.documents)||void 0===r?void 0:r.completed)||0,unreadMessages:0});const y=await G.contactAPI.getAllInquiries();M(y);const A=y.filter(e=>e.assignedRole&&t&&e.assignedRole===t.role||e.assignedTo&&Array.isArray(e.assignedTo)&&t&&e.assignedTo.includes(t._id));H(A);const v=await G.adminAPI.getActivityLogs({});C(v.map(e=>({id:e.id,type:e.module||"system",description:e.description||e.action,timestamp:e.timestamp,user:e.userName||e.userId})))}catch(d){console.error("Error fetching dashboard data:",d)}finally{i(!1)}};(0,s.useEffect)(()=>{Z();try{!function(e){if(cn)return cn;const t=globalThis.__APP_CONFIG__||{};let n=t.SOCKET_URL||t.API_BASE||"https://my-backend.onrender.com/api",a=String(n).replace(/\/$/,"");a.endsWith("/api")&&(a=a.replace(/\/api$/,"")),"/api"===a&&(a=""),cn=(0,dn.Ay)(a||"/",{path:"/socket.io",transports:["websocket"],auth:e?{token:e}:void 0,autoConnect:!0})}();const e=e=>{console.log("Received document socket event, refreshing dashboard",e),Z()};un("documentStatusUpdate",e),un("documentCreated",e),un("documentDeleted",e),un("documents-updated",e);const t=setInterval(()=>{Z()},3e4);return()=>{hn("documentStatusUpdate",e),hn("documentCreated",e),hn("documentDeleted",e),hn("documents-updated",e),clearInterval(t)}}catch(e){const t=setInterval(()=>{Z()},3e4);return()=>clearInterval(t)}},[]);const $=async()=>{_(!0);try{const e=await G.verificationAPI.getRequests();N(Array.isArray(e)?e:[])}catch(e){console.error("Failed to load verification requests",e),N([])}finally{_(!1)}};(0,s.useEffect)(()=>{$()},[]);const Q=async()=>{try{const e=await G.adminAPI.getUsers(),t=Array.isArray(e)||e&&"number"===typeof e.length?e.length:0;f(e=>(0,a.A)((0,a.A)({},e),{},{totalUsers:t}))}catch(e){console.error("Failed to fetch users list for count:",e)}};(0,s.useEffect)(()=>{Q();const e=setInterval(Q,3e4);return()=>clearInterval(e)},[]);const X=async e=>{var t;if(null!==(t=e.data)&&void 0!==t&&t.userId&&e._id)try{i(!0),await G.notificationAPI.approveStaff(e.data.userId,e._id),await Z()}catch(n){console.error("Failed to approve staff:",n)}finally{i(!1)}},ee=()=>(0,Y.jsx)("span",{style:{display:"inline-block",width:8,height:8,borderRadius:"50%",background:"#ff4d4f",marginLeft:6,verticalAlign:"middle"},"aria-label":"Unread"}),te=[{label:"Users",value:x.totalUsers,icon:"\ud83d\udc64",bg:"linear-gradient(90deg, #1890ff 0%, #40a9ff 100%)",color:"#1890ff",labelColor:"#e6f7ff",onClick:void 0,chart:(0,Y.jsx)("div",{style:{width:"100%",marginTop:8,height:32},children:(0,Y.jsx)("svg",{width:"100%",height:"40",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:(0,Y.jsx)("polyline",{fill:"none",stroke:"#4F46E5",strokeWidth:"2",points:V.map((e,t)=>"".concat(t*(100/(V.length-1)),",").concat(40-e/Math.max(...V)*35)).join(" ")})})})},{label:"Pending Requests",value:x.pendingRequests,icon:"\u23f3",bg:"linear-gradient(90deg, #faad14 0%, #ffe58f 100%)",color:"#faad14",labelColor:"#fffbe6",onClick:void 0,chart:(0,Y.jsx)("div",{style:{width:"100%",marginTop:8,height:32},children:(0,Y.jsx)("svg",{width:"100%",height:"40",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:K.map((e,t)=>{const n=100/K.length-2,a=e.value/Math.max(...K.map(e=>e.value))*35;return(0,Y.jsx)("rect",{x:t*(100/K.length)+1,y:40-a,width:n,height:a,fill:"#22C55E",rx:"2"},t)})})})},{label:"Documents",value:x.totalDocuments,icon:"\ud83d\udcc4",bg:"linear-gradient(90deg, #52c41a 0%, #b7eb8f 100%)",color:"#52c41a",labelColor:"#f6ffed",onClick:void 0,chart:(0,Y.jsx)("div",{style:{width:"100%",marginTop:8,height:32,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,Y.jsx)("svg",{width:"40",height:"40",viewBox:"0 0 40 40",children:(()=>{const e=J.reduce((e,t)=>e+t.value,0);let t=0;return J.map((n,a)=>{const s=n.value/e*360,i=t+s,r=s>180?1:0,l=20+18*Math.cos(Math.PI*(t-90)/180),o=20+18*Math.sin(Math.PI*(t-90)/180),d=20+18*Math.cos(Math.PI*(i-90)/180),c=20+18*Math.sin(Math.PI*(i-90)/180),u="M20,20 L".concat(l,",").concat(o," A18,18 0 ").concat(r," 1 ").concat(d,",").concat(c," Z");return t+=s,(0,Y.jsx)("path",{d:u,fill:mn[a%mn.length]},a)})})()})})},{label:(0,Y.jsxs)("span",{children:["Messages ",(0,Y.jsx)(ee,{})]}),value:x.unreadMessages,icon:"\u2709\ufe0f",bg:"linear-gradient(90deg, #722ed1 0%, #b37feb 100%)",color:"#722ed1",labelColor:"#f9f0ff",onClick:()=>e("/admin/messages"),chart:null}],ne=["Total Users","Pending Requests","Total Documents","Unread Messages"],[ae,se]=(0,s.useState)([]),[ie,re]=(0,s.useState)(!1),[le,oe]=(0,s.useState)(null),[de,ce]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{re(!0);try{const e=await G.contactAPI.getAnnouncements();se(Array.isArray(e)?e.slice(0,6):[])}catch(e){console.error("Failed to load mini announcements",e),se([])}finally{re(!1)}})()},[]);const ue=e=>{if(!e)return"";const t=new Date(e),n=Math.floor((Date.now()-t.getTime())/1e3);return n<60?"".concat(n,"s ago"):n<3600?"".concat(Math.floor(n/60),"m ago"):n<86400?"".concat(Math.floor(n/3600),"h ago"):n<604800?"".concat(Math.floor(n/86400),"d ago"):t.toLocaleDateString()};return(0,Y.jsx)(p.A,{spinning:n,children:(0,Y.jsxs)("div",{style:{padding:24,backgroundColor:"#f0f2f5",minHeight:"100vh"},children:[(0,Y.jsx)(pn,{level:4,style:{marginBottom:24},children:"Admin Dashboard"}),(0,Y.jsx)(l.A,{gutter:[24,24],style:{marginBottom:32},children:te.map((e,t)=>(0,Y.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,Y.jsxs)(r.A,{hoverable:!0,onClick:e.onClick,style:{background:e.bg,color:"#fff",borderRadius:20,minHeight:170,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:e.onClick?"pointer":"default",transition:"box-shadow 0.2s, transform 0.2s",position:"relative",marginBottom:8,padding:24},styles:{body:{width:"100%",padding:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"transparent"}},onMouseEnter:e=>{e.currentTarget.style.boxShadow="0 8px 32px 0 rgba(0,0,0,0.18)",e.currentTarget.style.transform="translateY(-4px)"},onMouseLeave:e=>{e.currentTarget.style.boxShadow="0 2px 8px 0 rgba(0,0,0,0.08)",e.currentTarget.style.transform="none"},children:[(0,Y.jsx)("span",{style:{fontSize:40,marginBottom:8,opacity:.92},children:e.icon}),(0,Y.jsx)("span",{style:{fontSize:38,fontWeight:700,lineHeight:1},children:e.value}),(0,Y.jsx)("span",{style:{fontSize:15,color:e.labelColor,fontWeight:500,marginTop:2,letterSpacing:.5},children:e.label}),(0,Y.jsx)("span",{style:{fontSize:13,color:"rgba(255,255,255,0.7)",marginTop:2,fontWeight:400},children:ne[t]}),e.chart]})},"string"===typeof e.label?e.label:String(t)))}),(0,Y.jsxs)(l.A,{gutter:[24,24],style:{marginTop:0},children:[(0,Y.jsx)(o.A,{xs:24,lg:12,children:(0,Y.jsxs)(r.A,{title:(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(on.A,{})," Staff Access Approval"]}),style:{marginTop:0,background:"#fafbfc",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0",position:"relative"},styles:{body:{padding:16}},size:"small",hoverable:!1,children:[w&&w.length>0?(0,Y.jsx)(zt.A,{size:"small",pagination:{pageSize:5},dataSource:w,rowKey:e=>e._id||String(e.createdAt),columns:[{title:"Name",dataIndex:"requestedBy",key:"requestedBy",render:(e,t)=>{var n;const a=null===t||void 0===t||null===(n=t.data)||void 0===n?void 0:n.fullName,s=null===t||void 0===t?void 0:t.requestedByName;let i=null;null!==t&&void 0!==t&&t.requestedBy&&("string"===typeof t.requestedBy?i=t.requestedBy:"object"===typeof t.requestedBy&&(i=t.requestedBy.fullName||t.requestedBy.username||t.requestedBy._id));const r=a||s||i||"Unknown";return(0,Y.jsx)("span",{style:{fontWeight:600},children:r})}},{title:"Requested At",dataIndex:"createdAt",key:"createdAt",render:e=>(0,Y.jsx)("span",{style:{fontSize:12,color:"#888"},children:new Date(e).toLocaleString()})},{title:"Actions",key:"actions",render:(e,t)=>(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(u.Ay,{type:"primary",size:"small",onClick:async()=>{try{i(!0),t&&"staff_access"===t.type&&t._id?await G.requestsAPI.approveRequest(t._id):await X(t),await Z()}catch(e){console.error("Approve action failed",e)}finally{i(!1)}},icon:(0,Y.jsx)(we.A,{}),children:"Approve"}),(0,Y.jsx)(u.Ay,{danger:!0,size:"small",onClick:()=>(async e=>{if(!e._id)return;const t=window.prompt("Enter a brief reason for rejection (optional):");try{i(!0),await G.notificationAPI.rejectStaff(e._id,t||void 0),await Z()}catch(n){console.error("Failed to reject staff request:",n)}finally{i(!1)}})(t),icon:(0,Y.jsx)(rn.A,{}),children:"Reject"})]})}]}):0===A.length?(0,Y.jsx)(Jt.A,{image:(0,Y.jsx)(on.A,{style:{fontSize:48,color:"#d9d9d9"}}),description:(0,Y.jsx)("span",{style:{color:"#888"},children:"No notifications"})}):(0,Y.jsx)(g.A,{dataSource:A,renderItem:e=>(0,Y.jsx)(g.A.Item,{actions:[(e.type||"").toString().toLowerCase().includes("staff")&&!e.read&&(0,Y.jsx)(u.Ay,{type:"primary",size:"small",icon:(0,Y.jsx)(we.A,{}),onClick:()=>X(e),children:"Approve"})].filter(Boolean),children:(0,Y.jsx)(g.A.Item.Meta,{avatar:(0,Y.jsx)(y.A,{icon:(e.type||"").toString().toLowerCase().includes("staff")?(0,Y.jsx)(We.A,{}):(0,Y.jsx)(on.A,{}),style:{backgroundColor:e.read?"#8c8c8c":(e.type||"").toString().toLowerCase().includes("staff")?"#faad14":"#1890ff"}}),title:(0,Y.jsx)(xn,{strong:(e.type||"").toString().toLowerCase().includes("staff"),children:e.message}),description:(0,Y.jsxs)("div",{children:[(0,Y.jsx)(xn,{type:"secondary",children:new Date(e.createdAt).toLocaleString()}),(e.type||"").toString().toLowerCase().includes("staff")&&e.data&&(0,Y.jsxs)("div",{style:{marginTop:8},children:[(0,Y.jsx)(xn,{strong:!0,children:"Full Name:"})," ",e.data.fullName||"N/A",(0,Y.jsx)("br",{}),(0,Y.jsx)(xn,{strong:!0,children:"Email:"})," ",e.data.email||"N/A",(0,Y.jsx)("br",{}),(0,Y.jsx)(xn,{strong:!0,children:"Username:"})," ",e.data.username||"N/A"]})]})})}),size:"small"}),(0,Y.jsx)(u.Ay,{type:"link",style:{position:"absolute",right:16,bottom:8,fontSize:13,color:"#1890ff"},onClick:()=>e("/admin/notifications"),children:"View all"})]})}),(0,Y.jsx)(o.A,{xs:24,lg:12,children:(0,Y.jsxs)(r.A,{title:(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(Ee.A,{})," Announcements"]}),style:{marginTop:0,background:"#fafbfc",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0",position:"relative"},styles:{body:{padding:12}},size:"small",hoverable:!1,children:[0===ae.length?(0,Y.jsx)(Jt.A,{image:(0,Y.jsx)(Ee.A,{style:{fontSize:42,color:"#d9d9d9"}}),description:(0,Y.jsx)("span",{style:{color:"#888"},children:"No announcements"})}):(0,Y.jsx)("div",{style:{maxHeight:320,overflowY:"auto",paddingRight:6,paddingBottom:48},children:(0,Y.jsx)(g.A,{loading:ie,dataSource:ae,renderItem:e=>(0,Y.jsxs)(g.A.Item,{style:{cursor:"pointer",padding:"10px 8px",alignItems:"center"},onClick:()=>{oe(e),ce(!0)},children:[(0,Y.jsx)(g.A.Item.Meta,{title:(0,Y.jsx)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:(0,Y.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,Y.jsx)("div",{style:{fontWeight:600,fontSize:13,display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.2em"},children:e.text||"Untitled"}),(0,Y.jsx)("div",{style:{fontSize:12,color:"#888",marginTop:6},children:ue(e.createdAt)})]})}),description:null}),e.imagePath&&(0,Y.jsx)("div",{style:{marginLeft:12,width:92,display:"flex",justifyContent:"flex-end",flexShrink:0},children:(0,Y.jsx)("img",{loading:"lazy",className:"rounded-img",src:(0,G.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image")),alt:"ann",style:{width:92,height:60,objectFit:"cover",borderRadius:6,background:"#f0f0f0"}})})]}),size:"small"})}),(0,Y.jsx)("div",{style:{marginTop:8,display:"flex",justifyContent:"flex-end"},children:(0,Y.jsx)(u.Ay,{type:"link",style:{fontSize:13,color:"#1890ff"},onClick:()=>e("/admin/announcements"),children:"Manage"})}),(0,Y.jsx)(Zt.A,{open:de,onClose:()=>{ce(!1),oe(null)},title:"Announcement",width:720,placement:"right",children:le&&(0,Y.jsxs)("div",{children:[(0,Y.jsx)(xn,{style:{display:"block",marginBottom:12,whiteSpace:"pre-wrap"},children:le.text}),le.imagePath&&(0,Y.jsx)("img",{loading:"lazy",className:"rounded-img rounded-img-lg",src:(0,G.getAbsoluteApiUrl)("/announcements/".concat(le._id,"/image")),alt:"announcement",style:{width:"100%",height:"auto",borderRadius:8,background:"#f6f6f6"}}),(0,Y.jsx)("div",{style:{marginTop:8,color:"#888"},children:ue(le.createdAt)})]})})]})})]}),(0,Y.jsx)(l.A,{gutter:[24,24],style:{marginTop:24},children:(0,Y.jsx)(o.A,{xs:24,children:(0,Y.jsxs)(r.A,{title:(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(Ze.A,{})," Verification Requests"]}),style:{marginTop:0,background:"#fff",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0"},size:"small",hoverable:!1,children:[T?(0,Y.jsx)("div",{style:{textAlign:"center",padding:24},children:(0,Y.jsx)(p.A,{})}):k&&0!==k.length?(0,Y.jsx)(g.A,{dataSource:k.slice(0,6),renderItem:e=>(0,Y.jsx)(g.A.Item,{actions:[(0,Y.jsx)(u.Ay,{size:"small",onClick:()=>(q(e),void D(!0)),children:"Check ID"},"view"),(0,Y.jsx)(u.Ay,{type:"primary",size:"small",onClick:()=>{var t;return(async e=>{try{if(_(!0),e&&"object"===typeof e){var t;const a=e._id,s=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;try{await G.verificationAPI.approveRequest(a)}catch(n){}s&&await G.verificationAPI.verifyUser(s,!0)}else"string"===typeof e&&await G.verificationAPI.verifyUser(e,!0);await $()}catch(a){console.error("Failed to verify user",a)}finally{_(!1)}})((null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId)},children:"Verify"},"verify"),(0,Y.jsx)(u.Ay,{danger:!0,size:"small",onClick:()=>{var t;return(async e=>{try{if(_(!0),e&&"object"===typeof e){var t;const a=e._id,s=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;try{await G.verificationAPI.rejectRequest(a)}catch(n){}s&&await G.verificationAPI.verifyUser(s,!1)}else"string"===typeof e&&await G.verificationAPI.verifyUser(e,!1);await $()}catch(a){console.error("Failed to reject verification",a)}finally{_(!1)}})((null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId)},children:"Reject"},"reject")],children:(0,Y.jsx)(g.A.Item.Meta,{title:(0,Y.jsx)("span",{style:{fontWeight:600},children:e.userId&&(e.userId.fullName||e.userId.username)||"Unknown Resident"}),description:(0,Y.jsxs)("span",{style:{color:"#888"},children:[e.status||"pending"," \xb7 ",new Date(e.createdAt).toLocaleString()]})})}),size:"small"}):(0,Y.jsx)(Jt.A,{description:"No verification requests"}),(0,Y.jsx)(u.Ay,{type:"link",style:{marginTop:12},onClick:()=>e("/admin/verification-requests"),children:"View all"}),(0,Y.jsx)(ge.A,{title:"Verification Files",open:P,onCancel:()=>D(!1),footer:null,width:720,children:R?(0,Y.jsxs)("div",{children:[(0,Y.jsxs)("p",{children:[(0,Y.jsx)("strong",{children:"Resident:"})," ",R.userId&&(R.userId.fullName||R.userId.username)||"Unknown"]}),(0,Y.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:(R.gridFileIds||[]).map(e=>(0,Y.jsxs)("div",{style:{border:"1px solid #f0f0f0",padding:8,borderRadius:6},children:[(0,Y.jsx)("div",{style:{marginBottom:8},children:(0,Y.jsx)("a",{href:(0,G.getAbsoluteApiUrl)("/verification/file/".concat(e)),target:"_blank",rel:"noreferrer",children:"Open file in new tab"})}),(0,Y.jsx)("div",{children:(0,Y.jsx)("img",{src:(0,G.getAbsoluteApiUrl)("/verification/file/".concat(e)),alt:"id",style:{maxWidth:"100%",maxHeight:400},onError:()=>{}})})]},e))})]}):(0,Y.jsx)(Jt.A,{description:"No files"})})]})})})]})})};var fn=n(60647),yn=n(18125),An=n(59772),jn=n(33359),vn=n(94763),bn=n(91522),wn=n(26086),In=n(60446),Sn=n.n(In);const Cn=[{text:"Admin",value:"admin"},{text:"Staff",value:"staff"},{text:"Resident",value:"resident"}],kn=[{text:"Active",value:!0},{text:"Inactive",value:!1}],Nn=()=>{const[e,t]=(0,s.useState)([]),[n,m]=(0,s.useState)(""),[x,g]=(0,s.useState)(void 0),[A,j]=(0,s.useState)(void 0),[v,b]=(0,s.useState)(null),[w,I]=(0,s.useState)(1),[S,C]=(0,s.useState)(10),[k,N]=(0,s.useState)([]),[T,_]=(0,s.useState)(!1),[P,D]=(0,s.useState)(null),[R,q]=(0,s.useState)(null),[B,L]=(0,s.useState)(!1),[O,U]=(0,s.useState)(!1),[z,F]=(0,s.useState)(!1),[E,M]=(0,s.useState)(!1),[W,H]=(0,s.useState)({}),[V,K]=(0,s.useState)(!1),[$,X]=(0,s.useState)(0),[ee,te]=(0,s.useState)(null),ne=s.useRef(null),[ae,se]=(0,s.useState)(!0),[ie,re]=(0,s.useState)({});const le=()=>{se(!0),G.adminAPI.getUsers().then(e=>{t(e.map((e,t)=>({key:e._id||t,_id:e._id||null,fullName:e.fullName||e.username||"",email:e.email,role:e.role,isActive:e.isActive,createdAt:e.createdAt,lastLogin:e.lastLogin,avatar:e.avatar||null,barangayId:e.barangayId||e.barangayID||e.barangay_id||null})))}).catch(()=>t([])).finally(()=>se(!1))};(0,s.useEffect)(()=>{le()},[]);const oe=async(e,t)=>{if(e)try{i.Ay.loading({content:"Disabling user...",key:"disable"});const n=t?{suspendedUntil:t}:{},a=await G.adminAPI.disableUser(e,n);i.Ay.success({content:"User disabled",key:"disable",duration:2}),await le(),P&&P._id===e&&D(a.user||a)}catch(n){console.error("Failed to disable user",n),i.Ay.error("Failed to disable user")}},de=async e=>{if(e)try{i.Ay.loading({content:"Enabling user...",key:"enable"});const t=await G.adminAPI.enableUser(e);i.Ay.success({content:"User enabled",key:"enable",duration:2}),await le(),P&&P._id===e&&D(t.user||t)}catch(t){console.error("Failed to enable user",t),i.Ay.error("Failed to enable user")}},ce=async e=>{if(e)try{i.Ay.loading({content:"Demoting user...",key:"demote"});const t=await G.adminAPI.demoteUser(e);i.Ay.success({content:"User demoted to resident",key:"demote",duration:2}),await le(),P&&P._id===e&&D(t.user||t)}catch(t){console.error("Failed to demote user",t),i.Ay.error("Failed to demote user")}},ue=e.filter(e=>{const t=e.fullName.toLowerCase().includes(n.toLowerCase())||e.email.toLowerCase().includes(n.toLowerCase()),a=!x||e.role===x,s=void 0===A||e.isActive===A,i=!v||2!==v.length||Sn()(e.createdAt).isAfter(v[0],"day")&&Sn()(e.createdAt).isBefore(v[1],"day");return t&&a&&s&&i}),he=[{title:"Name",dataIndex:"fullName",key:"fullName",render:(e,t)=>(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(y.A,{style:{backgroundColor:"#1890ff",verticalAlign:"middle"},children:t.avatar?(0,Y.jsx)(Qe,{src:t.avatar,size:36}):((n,a)=>{let s=t;try{const e=localStorage.getItem("userProfile");e&&(s=JSON.parse(e))}catch(i){}return null!==(n=s)&&void 0!==n&&n.profileImage||null!==(a=s)&&void 0!==a&&a.profileImageId?(0,Y.jsx)(Qe,{user:s,size:36}):e&&e.length>0?e.charAt(0).toUpperCase():"?"})()}),(0,Y.jsx)("b",{children:e})]}),sorter:(e,t)=>e.fullName.localeCompare(t.fullName),sortDirections:["ascend","descend"],fixed:"left"},{title:"Barangay ID",dataIndex:"barangayId",key:"barangayId",render:e=>e||"\u2014",width:160},{title:"Email",dataIndex:"email",key:"email",sorter:(e,t)=>e.email.localeCompare(t.email),sortDirections:["ascend","descend"]},{title:"Role",dataIndex:"role",key:"role",render:e=>{const t=e||"";return(0,Y.jsx)(f.A,{color:"admin"===t?"magenta":"staff"===t?"blue":"green",children:t?t.charAt(0).toUpperCase()+t.slice(1):""})},filters:Cn,onFilter:(e,t)=>t.role===e},{title:"Status",dataIndex:"isActive",key:"isActive",render:e=>(0,Y.jsx)(f.A,{color:e?"green":"red",children:e?"Active":"Inactive"}),filters:kn,onFilter:(e,t)=>t.isActive===e},{title:"Created",dataIndex:"createdAt",key:"createdAt",render:e=>Sn()(e).format("YYYY-MM-DD"),sorter:(e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime(),sortDirections:["ascend","descend"]},{title:"Actions",key:"actions",fixed:"right",render:(e,t)=>(0,Y.jsx)(Ue.A,{popupRender:()=>(0,Y.jsxs)(Le.A,{children:[(0,Y.jsx)(Le.A.Item,{icon:(0,Y.jsx)(jn.A,{}),onClick:()=>{D(t),_(!0)},children:"Edit"},"edit"),(0,Y.jsx)(Le.A.Item,{icon:(0,Y.jsx)(Z.A,{}),onClick:()=>{},children:"View Logs"},"logs"),(0,Y.jsx)(Le.A.Item,{icon:(0,Y.jsx)(vn.A,{}),onClick:()=>{},children:"Deactivate"},"deactivate"),(0,Y.jsx)(Le.A.Item,{icon:(0,Y.jsx)(vn.A,{}),onClick:async()=>{t&&t._id?ge.A.confirm({title:"Disable user",content:"Are you sure you want to disable ".concat(t.fullName||t.email||t._id,"?"),onOk:async()=>{await oe(t._id)}}):i.Ay.error("No user selected")},children:"Disable"},"disable_now"),"staff"===t.role&&(0,Y.jsx)(Le.A.Item,{icon:(0,Y.jsx)(bn.A,{}),onClick:async()=>{t&&t._id?ge.A.confirm({title:"Demote user",content:"Are you sure you want to demote ".concat(t.fullName||t.email||t._id," to resident?"),onOk:async()=>{await ce(t._id)}}):i.Ay.error("No user selected")},children:"Demote to Resident"},"demote"),(0,Y.jsx)(Le.A.Item,{icon:(0,Y.jsx)(we.A,{}),onClick:async()=>{t&&t._id?ge.A.confirm({title:"Enable user",content:"Are you sure you want to enable ".concat(t.fullName||t.email||t._id,"?"),onOk:async()=>{await de(t._id)}}):i.Ay.error("No user selected")},children:"Enable"},"enable_now"),(0,Y.jsx)(Le.A.Item,{icon:(0,Y.jsx)(Q.A,{}),danger:!0,onClick:()=>{},children:"Delete"},"delete")]}),trigger:["click"],children:(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(wn.A,{}),size:"small"})})}],me=k.length>0&&(0,Y.jsxs)(Oe.A,{style:{marginBottom:16},children:[(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(we.A,{}),onClick:()=>{},children:"Activate"}),(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(vn.A,{}),onClick:()=>{},children:"Deactivate"}),(0,Y.jsx)(fn.A,{title:"Are you sure to delete selected users?",onConfirm:()=>{},okText:"Yes",cancelText:"No",children:(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(Q.A,{}),danger:!0,children:"Delete"})}),(0,Y.jsx)("span",{style:{marginLeft:8},children:"Selected ".concat(k.length," users")})]}),pe=(w-1)*S+1,fe=Math.min(w*S,ue.length);return(0,Y.jsxs)("div",{children:[(0,Y.jsx)(r.A,{style:{marginBottom:16,borderRadius:8,background:"#fff"},bodyStyle:{padding:0},bordered:!1,title:(0,Y.jsxs)(l.A,{align:"middle",justify:"space-between",children:[(0,Y.jsxs)(o.A,{children:[(0,Y.jsx)(h.A.Title,{level:4,style:{margin:0},children:"User Management"}),(0,Y.jsxs)(yn.A,{children:[(0,Y.jsx)(yn.A.Item,{children:"Admin"}),(0,Y.jsx)(yn.A.Item,{children:"User Management"})]})]}),(0,Y.jsx)(o.A,{children:(0,Y.jsx)(Oe.A,{})})]})}),(0,Y.jsxs)(r.A,{style:{borderRadius:16,boxShadow:"0 2px 16px #40c9ff11"},children:[(0,Y.jsxs)(l.A,{gutter:16,style:{marginBottom:16},align:"middle",children:[(0,Y.jsx)(o.A,{children:(0,Y.jsx)(c.A.Search,{placeholder:"Search by name or email",value:n,onChange:e=>m(e.target.value),allowClear:!0,style:{width:200}})}),(0,Y.jsx)(o.A,{children:(0,Y.jsx)(d.A,{placeholder:"Role",allowClear:!0,style:{width:120},value:x,onChange:g,options:Cn})}),(0,Y.jsx)(o.A,{children:(0,Y.jsx)(d.A,{placeholder:"Status",allowClear:!0,style:{width:120},value:A,onChange:j,options:kn})}),(0,Y.jsx)(o.A,{children:(0,Y.jsx)(An.A.RangePicker,{value:v,onChange:b,style:{width:220},allowClear:!0})}),(0,Y.jsx)(o.A,{children:(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(bn.A,{}),onClick:()=>{m(""),g(void 0),j(void 0),b(null)},children:"Reset Filters"})})]}),me,ae?(0,Y.jsx)(p.A,{size:"large"}):(0,Y.jsx)(zt.A,{columns:he,dataSource:ue,rowSelection:{selectedRowKeys:k,onChange:N},pagination:{pageSize:S,current:w,onChange:I,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onShowSizeChange:(e,t)=>C(t),showTotal:e=>"Showing ".concat(pe,"\u2013").concat(fe," of ").concat(e," users")},onRow:e=>({onClick:()=>{D(e),_(!0),(async e=>{if(e){L(!0);try{const t=e.barangayId||e.barangayID||e.barangay_id;if(t){const e=await G.adminAPI.getResidentByBarangayID(t);q((null===e||void 0===e?void 0:e.resident)||null)}else if(e._id){const t=await G.adminAPI.getUserWithResident(e._id);q((null===t||void 0===t?void 0:t.resident)||null)}else q(null)}catch(t){console.error("Failed to fetch resident for user",t),q(null)}finally{L(!1)}}})(e)}}),style:{cursor:"pointer"},scroll:{x:"max-content"},sticky:!0})]}),(0,Y.jsx)(Zt.A,{title:P?P.fullName:"User Profile",open:T,onClose:()=>_(!1),width:400,children:P&&(0,Y.jsxs)(Oe.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,Y.jsxs)(l.A,{align:"middle",gutter:16,children:[(0,Y.jsx)(o.A,{children:(0,Y.jsx)(y.A,{size:64,style:{backgroundColor:"#1890ff"},children:R&&(R.profileImage||R.profileImageId)?R.profileImage?(0,Y.jsx)(Qe,{src:R.profileImage,size:64}):(0,Y.jsx)(Qe,{src:(0,G.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(R.profileImageId)),size:64}):P.avatar?(0,Y.jsx)(Qe,{src:P.avatar,size:64}):((e,t)=>{let n=P;try{const e=localStorage.getItem("userProfile");e&&(n=JSON.parse(e))}catch(a){}return null!==(e=n)&&void 0!==e&&e.profileImage||null!==(t=n)&&void 0!==t&&t.profileImageId?(0,Y.jsx)(Qe,{user:n,size:64}):P.fullName&&P.fullName.length>0?P.fullName.charAt(0).toUpperCase():"?"})()})}),(0,Y.jsxs)(o.A,{children:[(0,Y.jsx)(h.A.Title,{level:5,style:{margin:0},children:P.fullName}),(0,Y.jsxs)("div",{style:{marginTop:4},children:[(0,Y.jsx)(f.A,{color:P.isActive?"green":"red",style:{marginRight:8},children:P.isActive?"Active":"Inactive"}),(0,Y.jsx)(f.A,{color:"admin"===P.role?"magenta":"staff"===P.role?"blue":"green",children:P.role?P.role.charAt(0).toUpperCase()+P.role.slice(1):""})]}),P.barangayId&&(0,Y.jsxs)("div",{style:{marginTop:8},children:[(0,Y.jsx)(h.A.Text,{type:"secondary",children:"Barangay ID: "}),(0,Y.jsx)(h.A.Text,{copyable:!0,children:P.barangayId})]})]})]}),(0,Y.jsx)(h.A.Text,{strong:!0,children:"Email:"}),(0,Y.jsx)(h.A.Text,{children:P.email}),(0,Y.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Resident Information"}),B?(0,Y.jsx)(p.A,{}):R?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(h.A.Title,{level:5,children:"Personal Information"}),(0,Y.jsxs)(l.A,{gutter:[8,8],children:[(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Full Name:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:"".concat(R.firstName||""," ").concat(R.middleName||""," ").concat(R.lastName||"").trim()||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Barangay ID:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.barangayID||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Username:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.username||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Email:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.email||P.email||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Phone:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.contactNumber||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Landline:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.landlineNumber||"N/A"})]}),(0,Y.jsxs)(o.A,{span:24,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Address:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.address||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"DOB:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.birthDate?Sn()(R.birthDate).format("YYYY-MM-DD"):R.birthDate||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Sex/Gender:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.sex||R.gender||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Civil/Marital Status:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.civilStatus||R.maritalStatus||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Nationality:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.nationality||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Occupation:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.occupation||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Education:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.educationalAttainment||"N/A"})]})]}),(0,Y.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Identification"}),(0,Y.jsxs)(l.A,{gutter:[8,8],children:[(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Passport #:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.passportNumber||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Gov ID #:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.governmentIdNumber||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"TIN:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.tin||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Barangay Clearance #:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.barangayClearanceNumber||"N/A"})]})]}),(0,Y.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Family"}),(0,Y.jsxs)(l.A,{gutter:[8,8],children:[(0,Y.jsxs)(o.A,{span:24,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Spouse:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.spouseName?"".concat(R.spouseName," ").concat(R.spouseLastName||""):"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Number of Children:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.numberOfChildren||0===R.numberOfChildren?R.numberOfChildren:"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Children Names/Ages:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.childrenNames?"".concat(R.childrenNames," (").concat(R.childrenAges||"",")"):"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Mother:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.motherName||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Father:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.fatherName||"N/A"})]})]}),(0,Y.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Emergency Contact"}),(0,Y.jsxs)(l.A,{gutter:[8,8],children:[(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Contact Name:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.emergencyContactName||R.emergencyContact||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Relationship:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.emergencyContactRelationship||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Emergency Phone:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.emergencyContact||R.spouseContactNumber||"N/A"})]})]}),(0,Y.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Business / Employment"}),(0,Y.jsxs)(l.A,{gutter:[8,8],children:[(0,Y.jsxs)(o.A,{span:24,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Business Name:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.businessName||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Business Type:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.businessType||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Business Contact:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.businessContactNumber||"N/A"})]}),(0,Y.jsxs)(o.A,{span:24,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Business Address:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.businessAddress||"N/A"})]})]}),(0,Y.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Other"}),(0,Y.jsxs)(l.A,{gutter:[8,8],children:[(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Blood Type:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.bloodType||"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Disability Status:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.disabilityStatus||"N/A"})]})]}),(0,Y.jsxs)(l.A,{style:{marginTop:12},gutter:[8,8],children:[(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Created At:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.createdAt?Sn()(R.createdAt).format("YYYY-MM-DD HH:mm"):"N/A"})]}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Last Login:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:P.lastLogin?Sn()(P.lastLogin).format("YYYY-MM-DD HH:mm"):"N/A"})]})]}),(0,Y.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Social Media / Links"}),(0,Y.jsxs)(l.A,{gutter:[8,8],children:[(0,Y.jsxs)(o.A,{span:24,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Facebook:"}),R.facebook?(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:(0,Y.jsx)("a",{href:R.facebook,target:"_blank",rel:"noreferrer",children:R.facebook})}):(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,Y.jsxs)(o.A,{span:24,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Instagram:"}),R.instagram?(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:(0,Y.jsx)("a",{href:R.instagram,target:"_blank",rel:"noreferrer",children:R.instagram})}):(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,Y.jsxs)(o.A,{span:24,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Other Link:"}),(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:R.website||"N/A"})]})]})]}):(0,Y.jsx)(h.A.Text,{type:"warning",children:"This resident doesn't have resident info yet."}),(0,Y.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Social Media"}),(0,Y.jsxs)(l.A,{gutter:[8,8],children:[(0,Y.jsxs)(o.A,{span:24,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Facebook:"}),P.facebook?(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:(0,Y.jsx)("a",{href:P.facebook,target:"_blank",rel:"noreferrer",children:P.facebook})}):(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,Y.jsxs)(o.A,{span:24,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Twitter:"}),P.twitter?(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:(0,Y.jsx)("a",{href:P.twitter,target:"_blank",rel:"noreferrer",children:P.twitter})}):(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,Y.jsxs)(o.A,{span:24,children:[(0,Y.jsx)(h.A.Text,{strong:!0,children:"Instagram:"}),P.instagram?(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:(0,Y.jsx)("a",{href:P.instagram,target:"_blank",rel:"noreferrer",children:P.instagram})}):(0,Y.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]})]}),(0,Y.jsxs)("div",{style:{marginTop:16,display:"flex",flexDirection:"column",gap:8},children:[(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(jn.A,{}),onClick:()=>{H(P||{}),M(!0)},children:"Edit User"}),(0,Y.jsx)(u.Ay,{onClick:()=>{R?(re(R||{}),F(!0)):i.Ay.warning("No resident data to edit")},children:"Edit Resident"})]}),(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(Z.A,{}),onClick:()=>{},children:"View Logs"}),P&&"staff"===P.role&&(0,Y.jsx)(fn.A,{title:"Demote ".concat(P.fullName||P.email,"?"),onConfirm:async()=>{P&&await ce(P._id)},okText:"Yes",cancelText:"No",children:(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(bn.A,{}),children:"Demote"})}),P&&P.isActive?(0,Y.jsx)(fn.A,{title:"Disable ".concat(P.fullName||P.email,"?"),onConfirm:async()=>{await oe(P._id)},okText:"Yes",cancelText:"No",children:(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(vn.A,{}),danger:!0,children:"Deactivate"})}):(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(we.A,{}),onClick:async()=>{P&&await de(P._id)},children:"Enable"})]})]})]})}),(0,Y.jsx)(ge.A,{title:"Edit Resident",open:z,onCancel:()=>F(!1),onOk:async()=>{if(R)try{const e=(0,a.A)((0,a.A)({},R),ie),t=await G.adminAPI.updateResident(R._id,e);i.Ay.success("Resident updated"),q((null===t||void 0===t?void 0:t.resident)||(0,a.A)((0,a.A)({},R),e)),F(!1)}catch(e){console.error("Failed to save resident",e),i.Ay.error("Failed to update resident.")}},width:900,children:(0,Y.jsx)(dt.A,{layout:"vertical",initialValues:(0,a.A)((0,a.A)({},R||{}),{},{barangayID:(null===R||void 0===R?void 0:R.barangayID)||(null===P||void 0===P?void 0:P.barangayId)}),onValuesChange:(e,t)=>re(t),children:(0,Y.jsxs)(xe.A,{defaultActiveKey:"personal",children:[(0,Y.jsxs)(xe.A.TabPane,{tab:"Personal",children:[(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"firstName",label:"First Name",rules:[{required:!0,message:"First name is required"}],children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"middleName",label:"Middle Name",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"lastName",label:"Last Name",rules:[{required:!0,message:"Last name is required"}],children:(0,Y.jsx)(c.A,{})})})]}),(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"username",label:"Username",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"barangayID",label:"Barangay ID",rules:[{required:!0,message:"Barangay ID is required"}],children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Enter a valid email"}],children:(0,Y.jsx)(c.A,{})})})]}),(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"contactNumber",label:"Contact Number",rules:[{pattern:/^[0-9+\-() ]{6,20}$/,message:"Enter a valid phone number"}],children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"landlineNumber",label:"Landline",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"address",label:"Address",children:(0,Y.jsx)(c.A,{})})})]}),(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"birthDate",label:"Birth Date",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"placeOfBirth",label:"Place of Birth",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"age",label:"Age",children:(0,Y.jsx)(c.A,{type:"number"})})})]})]},"personal"),(0,Y.jsxs)(xe.A.TabPane,{tab:"IDs",children:[(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"passportNumber",label:"Passport #",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"governmentIdNumber",label:"Government ID #",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"tin",label:"TIN",children:(0,Y.jsx)(c.A,{})})})]}),(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"bloodType",label:"Blood Type",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"disabilityStatus",label:"Disability Status",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"educationalAttainment",label:"Education",children:(0,Y.jsx)(c.A,{})})})]})]},"ids"),(0,Y.jsxs)(xe.A.TabPane,{tab:"Family",children:[(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"spouseName",label:"Spouse Name",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"spouseMiddleName",label:"Spouse Middle",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"spouseLastName",label:"Spouse Last",children:(0,Y.jsx)(c.A,{})})})]}),(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"spouseAge",label:"Spouse Age",children:(0,Y.jsx)(c.A,{type:"number"})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"spouseBirthDate",label:"Spouse DOB",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"spouseOccupation",label:"Spouse Occupation",children:(0,Y.jsx)(c.A,{})})})]}),(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"numberOfChildren",label:"# Children",children:(0,Y.jsx)(c.A,{type:"number"})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"childrenNames",label:"Children Names",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"childrenAges",label:"Children Ages",children:(0,Y.jsx)(c.A,{})})})]}),(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{name:"motherName",label:"Mother's Name",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{name:"fatherName",label:"Father's Name",children:(0,Y.jsx)(c.A,{})})})]})]},"family"),(0,Y.jsxs)(xe.A.TabPane,{tab:"Business",children:[(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{name:"businessName",label:"Business Name",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{name:"businessType",label:"Business Type",children:(0,Y.jsx)(c.A,{})})})]}),(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{name:"businessContactNumber",label:"Business Contact",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{name:"businessEmail",label:"Business Email",children:(0,Y.jsx)(c.A,{})})})]}),(0,Y.jsx)(l.A,{gutter:8,children:(0,Y.jsx)(o.A,{span:24,children:(0,Y.jsx)(dt.A.Item,{name:"businessAddress",label:"Business Address",children:(0,Y.jsx)(c.A,{})})})}),(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"registrationNumber",label:"Registration #",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"businessPermitNumber",label:"Business Permit #",children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{name:"barangayClearanceNumber",label:"Barangay Clearance #",children:(0,Y.jsx)(c.A,{})})})]})]},"business"),(0,Y.jsx)(xe.A.TabPane,{tab:"Avatar / Media",children:(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsxs)(dt.A.Item,{label:"Upload Profile Image",children:[(0,Y.jsx)(J.A,{accept:"image/*",showUploadList:!1,beforeUpload:()=>!1,customRequest:e=>{if(!R)return;const t=e.file;K(!0),X(10);const n=(async()=>{try{X(30);const e=await G.adminAPI.uploadResidentAvatar(R._id,t);return X(80),null!==e&&void 0!==e&&e.resident?(q(e.resident),re(t=>(0,a.A)((0,a.A)({},t),{},{profileImage:e.resident.profileImage,profileImageId:e.resident.profileImageId})),te(e.resident.profileImage||(0,G.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.fileId)))):null!==e&&void 0!==e&&e.fileId&&(re(t=>(0,a.A)((0,a.A)({},t),{},{profileImage:(0,G.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.fileId)),profileImageId:e.fileId})),te((0,G.getAbsoluteApiUrl)("/resident/personal-info/avatar/".concat(e.fileId)))),X(100),i.Ay.success("Avatar uploaded"),e}catch(e){throw console.error("Avatar upload failed",e),i.Ay.error((null===e||void 0===e?void 0:e.message)||"Avatar upload failed"),e}finally{K(!1)}})();return ne.current=n,n},children:(0,Y.jsx)(u.Ay,{type:"default",children:"Choose Image"})}),V&&(0,Y.jsxs)("div",{style:{marginTop:8},children:["Uploading: ",$,"%"]}),ee&&(0,Y.jsx)("div",{style:{marginTop:8},children:(0,Y.jsx)("img",{src:ee,alt:"preview",style:{maxWidth:120,maxHeight:120,borderRadius:6}})})]})}),(0,Y.jsxs)(o.A,{span:12,children:[(0,Y.jsx)(dt.A.Item,{name:"profileImage",label:"Profile Image URL",children:(0,Y.jsx)(c.A,{})}),(0,Y.jsx)(dt.A.Item,{name:"profileImageId",label:"Profile Image ID",children:(0,Y.jsx)(c.A,{})})]})]})},"media")]})})}),(0,Y.jsx)(ge.A,{title:"Edit User",open:E,onCancel:()=>M(!1),onOk:async()=>{try{const n=(0,a.A)({},W);delete n.barangayId,delete n.role,await G.adminAPI.updateUser(P._id,n),i.Ay.success("User updated");const s=e.map(e=>e._id===P._id?(0,a.A)((0,a.A)({},e),n):e);t(s),D(e=>e?(0,a.A)((0,a.A)({},e),n):e),M(!1)}catch(n){console.error("Failed to update user",n),i.Ay.error("Failed to update user")}},width:600,children:(0,Y.jsxs)(dt.A,{layout:"vertical",initialValues:W,onValuesChange:(e,t)=>H(t),children:[(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{name:"fullName",label:"Full Name",rules:[{required:!0,message:"Full name required"}],children:(0,Y.jsx)(c.A,{})})}),(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Enter a valid email"}],children:(0,Y.jsx)(c.A,{})})})]}),(0,Y.jsxs)(l.A,{gutter:8,children:[(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{name:"isActive",label:"Active",children:(0,Y.jsx)(d.A,{options:[{label:"Active",value:!0},{label:"Inactive",value:!1}]})})}),(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{label:"Role",children:(0,Y.jsx)(c.A,{value:null===P||void 0===P?void 0:P.role,disabled:!0})})})]}),(0,Y.jsx)(l.A,{gutter:8,children:(0,Y.jsx)(o.A,{span:24,children:(0,Y.jsx)(dt.A.Item,{label:"Barangay ID",children:(0,Y.jsx)(c.A,{value:(null===P||void 0===P?void 0:P.barangayId)||(null===P||void 0===P?void 0:P.barangayID)||"",disabled:!0})})})})]})})]})},Tn=()=>(0,Y.jsxs)("div",{style:{padding:20},children:[(0,Y.jsx)("h3",{children:"Activity Logs Disabled"}),(0,Y.jsx)("p",{children:"The Activity Logs feature has been temporarily disabled in the system."})]});var _n=n(7650),Pn=n(12624),Dn=n(40426),Rn=n(44811),qn=n(45725),Bn=n(16026),Ln=n(63248),On=n(62370),Un=n(94913),zn=n(21218),Fn=n(31693),En=n(6396);const{RangePicker:Mn}=An.A,{Option:Wn}=d.A,Yn={gender:{title:"Sex Distribution",chartType:"pie",endpoint:"/analytics/gender",colors:["#1890ff","#00bcd4","#888888"]},age:{title:"Age Groups",chartType:"bar",endpoint:"/analytics/age",colors:["#1890ff"]},"civil-status":{title:"Civil Status",chartType:"bar",endpoint:"/analytics/civil-status",colors:["#1890ff"]},education:{title:"Education",chartType:"bar",endpoint:"/analytics/education",colors:["#13c2c2"]},"documents-monthly":{title:"Monthly Document Requests",chartType:"line",endpoint:"/analytics/documents-monthly",colors:["#722ed1"]}},Hn=Object.keys(Yn),Vn=new qn.E({defaultOptions:{queries:{retry:2,staleTime:6e4,refetchOnWindowFocus:!1}}}),Gn=()=>{var e,t,c,p,x;const[g,f]=(0,s.useState)(!0),[y,A]=(0,s.useState)(null),[j,v]=(0,s.useState)({}),[b,w]=(0,s.useState)({}),[I,S]=(0,s.useState)({dateRange:[],residentType:""}),[C,k]=(0,s.useState)(["gender","age","occupation","education","civil-status"]),[N,T]=(0,s.useState)(!1),_=(0,s.useRef)(null),[P,D]=(0,s.useState)(!1),[R,q]=(0,s.useState)(()=>{try{const e=localStorage.getItem("statsChartSettings");return e?JSON.parse(e):{}}catch(e){return{}}}),[B,L]=(0,s.useState)("gender"),[O,U]=(0,s.useState)(!1),[z,F]=(0,s.useState)(C),E=(0,s.useCallback)(async()=>{f(!0);try{var e,t,n,a,s,i;const r=await G.axiosInstance.get("/analytics/summary",{params:{startDate:null===(e=I.dateRange)||void 0===e||null===(t=e[0])||void 0===t||null===(n=t.format)||void 0===n?void 0:n.call(t,"YYYY-MM-DD"),endDate:null===(a=I.dateRange)||void 0===a||null===(s=a[1])||void 0===s||null===(i=s.format)||void 0===i?void 0:i.call(s,"YYYY-MM-DD"),residentType:I.residentType}});A(r.data||null)}catch(r){A(null)}finally{f(!1)}},[I]);(0,s.useEffect)(()=>{E()},[E]);const M=(0,s.useCallback)(async e=>{const t=Yn[e];if(t){w(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!0}));try{var n,s,i,r,l,o,d,c,u,h,m,p,x;const g=R[e]||{},f=(null===(n=g.dateRange)||void 0===n||null===(s=n[0])||void 0===s||null===(i=s.format)||void 0===i?void 0:i.call(s,"YYYY-MM-DD"))||(null===(r=I.dateRange)||void 0===r||null===(l=r[0])||void 0===l||null===(o=l.format)||void 0===o?void 0:o.call(l,"YYYY-MM-DD")),y=(null===(d=g.dateRange)||void 0===d||null===(c=d[1])||void 0===c||null===(u=c.format)||void 0===u?void 0:u.call(c,"YYYY-MM-DD"))||(null===(h=I.dateRange)||void 0===h||null===(m=h[1])||void 0===m||null===(p=m.format)||void 0===p?void 0:p.call(m,"YYYY-MM-DD"));let A=(null===(x=(await G.axiosInstance.get(t.endpoint,{params:{startDate:f,endDate:y}})).data)||void 0===x?void 0:x.data)||[];"gender"===e&&(A=A.map(e=>{var t,n,a;return{type:null!==(t=null!==(n=e.name)&&void 0!==n?n:e.type)&&void 0!==t?t:"N/A",value:null!==(a=e.value)&&void 0!==a?a:0}})),v(t=>(0,a.A)((0,a.A)({},t),{},{[e]:A}))}catch(g){console.error("Error fetching chart",e,g),v(t=>(0,a.A)((0,a.A)({},t),{},{[e]:[]}))}finally{w(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!1}))}}},[I,R]);(0,s.useEffect)(()=>{try{localStorage.setItem("statsChartSettings",JSON.stringify(R))}catch(e){}},[R]);const W=null!==(e=null===y||void 0===y?void 0:y.totalResidents)&&void 0!==e?e:0,H=null!==(t=null===y||void 0===y?void 0:y.totalDocumentRequests)&&void 0!==t?t:0,V=j.age||[],K=V&&V.length?Math.max(...V.map(e=>Number(e.value)||0)):0,J=5*Math.ceil(K/5)||5,Z=j["documents-monthly"]||[],$=e=>{var t,n,a;let{id:s,title:i,chartType:l,data:o=[],loading:d,colors:c}=e;const u=Array.isArray(o)&&o.length>0,h=s&&R[s]||{},m=h.chartType||l,p=null===(t=h.showLabels)||void 0===t||t,x=null===(n=h.showTooltips)||void 0===n||n,g=null===(a=h.showLegend)||void 0===a||a;return(0,Y.jsx)(r.A,{title:i,style:{borderRadius:12,boxShadow:"0 8px 24px rgba(15,15,15,0.06)"},styles:{body:{padding:16}},children:d?(0,Y.jsx)(_n.A,{active:!0}):u?"pie"===m?(0,Y.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(()=>{const e=(o||[]).map(e=>{var t,n,a,s,i,r;return{label:(null!==(t=null!==(n=null!==(a=null!==(s=null===e||void 0===e?void 0:e.type)&&void 0!==s?s:null===e||void 0===e?void 0:e.name)&&void 0!==a?a:null===e||void 0===e?void 0:e.group)&&void 0!==n?n:null===e||void 0===e?void 0:e._id)&&void 0!==t?t:"Unknown").toString().trim(),valueNumber:Number(null!==(i=null!==(r=null===e||void 0===e?void 0:e.value)&&void 0!==r?r:null===e||void 0===e?void 0:e.count)&&void 0!==i?i:0)}});return(0,Y.jsx)(On.A,{data:e,angleField:"valueNumber",colorField:"label",radius:.9,label:!!p&&{formatter:e=>{var t,n,a,s,i;const r=(null===e||void 0===e?void 0:e.data)||e||{},l=null!==(t=null!==(n=null===r||void 0===r?void 0:r.label)&&void 0!==n?n:null===r||void 0===r?void 0:r.type)&&void 0!==t?t:"Unknown",o=Number(null!==(a=null!==(s=null!==(i=null===r||void 0===r?void 0:r.valueNumber)&&void 0!==i?i:null===r||void 0===r?void 0:r.value)&&void 0!==s?s:null===r||void 0===r?void 0:r.count)&&void 0!==a?a:0)||0;return"".concat(l," (").concat(o,")")}},tooltip:!!x&&{formatter:e=>{var t,n,a,s,i;const r=(null===e||void 0===e?void 0:e.data)||e||{};return{name:null!==(t=null!==(n=null===r||void 0===r?void 0:r.label)&&void 0!==n?n:null===r||void 0===r?void 0:r.type)&&void 0!==t?t:"Unknown",value:Number(null!==(a=null!==(s=null!==(i=null===r||void 0===r?void 0:r.valueNumber)&&void 0!==i?i:null===r||void 0===r?void 0:r.value)&&void 0!==s?s:null===r||void 0===r?void 0:r.count)&&void 0!==a?a:0)||0}}},color:c,statistic:{title:{formatter:()=>i},content:{formatter:()=>"".concat((e||[]).reduce((e,t)=>e+(Number(t.valueNumber)||0),0)," total")}},legend:!!g&&{position:"bottom",formatter:t=>{const n=(e||[]).find(e=>e.label===t),a=n?Number(n.valueNumber||0):0;return"".concat(t," (").concat(a,")")}},height:220})})()}):"bar"===m?(0,Y.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(0,Y.jsx)(Un.A,{data:o,xField:"type",yField:"value",color:c&&c[0],label:!!p&&void 0,legend:!!g&&void 0,tooltip:!!x&&void 0,yAxis:{min:0,max:J,tickInterval:5},height:220})}):"line"===m?(0,Y.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(0,Y.jsx)(zn.A,{data:o,xField:"type",yField:"value",legend:!!g&&void 0,tooltip:!!x&&void 0,height:220})}):(0,Y.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(0,Y.jsx)(Fn.A,{data:o,xField:"type",yField:"value",legend:!!g&&void 0,tooltip:!!x&&void 0,height:220})}):(0,Y.jsx)(Jt.A,{description:"No data"})})},Q=(0,s.useRef)({}),X=(0,s.useRef)(null),ee=Object.keys(Yn),te=(0,Bn.E)({queries:ee.map(e=>{var t,n,a,s,i,r,l,o,d,c,u,h,m,p;return{queryKey:["chart",e,(null===(t=I.dateRange)||void 0===t||null===(n=t[0])||void 0===n||null===(a=n.format)||void 0===a?void 0:a.call(n,"YYYY-MM-DD"))||null,(null===(s=I.dateRange)||void 0===s||null===(i=s[1])||void 0===i||null===(r=i.format)||void 0===r?void 0:r.call(i,"YYYY-MM-DD"))||null,(null===(l=R[e])||void 0===l||null===(o=l.dateRange)||void 0===o||null===(d=o[0])||void 0===d||null===(c=d.format)||void 0===c?void 0:c.call(d,"YYYY-MM-DD"))||null,(null===(u=R[e])||void 0===u||null===(h=u.dateRange)||void 0===h||null===(m=h[1])||void 0===m||null===(p=m.format)||void 0===p?void 0:p.call(m,"YYYY-MM-DD"))||null,I.residentType||null],queryFn:async()=>{var t,n,a,s,i,r,l,o,d,c,u,h,m;const p=R[e]||{},x=(null===(t=p.dateRange)||void 0===t||null===(n=t[0])||void 0===n||null===(a=n.format)||void 0===a?void 0:a.call(n,"YYYY-MM-DD"))||(null===(s=I.dateRange)||void 0===s||null===(i=s[0])||void 0===i||null===(r=i.format)||void 0===r?void 0:r.call(i,"YYYY-MM-DD")),g=(null===(l=p.dateRange)||void 0===l||null===(o=l[1])||void 0===o||null===(d=o.format)||void 0===d?void 0:d.call(o,"YYYY-MM-DD"))||(null===(c=I.dateRange)||void 0===c||null===(u=c[1])||void 0===u||null===(h=u.format)||void 0===h?void 0:h.call(u,"YYYY-MM-DD"));return(null===(m=(await G.axiosInstance.get(Yn[e].endpoint,{params:{startDate:x,endDate:g,residentType:I.residentType}})).data)||void 0===m?void 0:m.data)||[]},retry:2}})}),ne=te.map(e=>JSON.stringify((null===e||void 0===e?void 0:e.data)||"")).join("|"),ae=(0,s.useMemo)(()=>{const e={};return Hn.forEach((t,n)=>{e[t]=te[n]}),e},[ne]);(0,s.useEffect)(()=>{const e={},t={};ee.forEach(n=>{const s=ae[n];"gender"===n&&console.debug("chart query gender raw data:",null===s||void 0===s?void 0:s.data),e[n]="gender"===n?((null===s||void 0===s?void 0:s.data)||[]).map(e=>{var t,n,a,s,i;const r=((null!==(t=null!==(n=null!==(a=null===e||void 0===e?void 0:e.name)&&void 0!==a?a:null===e||void 0===e?void 0:e.type)&&void 0!==n?n:null===e||void 0===e?void 0:e._id)&&void 0!==t?t:"").toString().trim()||"").toLowerCase();let l="Other";return/^m/.test(r)?l="Male":/^f/.test(r)&&(l="Female"),{type:l,value:Number(null!==(s=null!==(i=null===e||void 0===e?void 0:e.value)&&void 0!==i?i:null===e||void 0===e?void 0:e.count)&&void 0!==s?s:0)}}).reduce((e,t)=>{const n=e.find(e=>e.type===t.type);return n?n.value+=t.value:e.push((0,a.A)({},t)),e},[]):(null===s||void 0===s?void 0:s.data)||[],t[n]=(null===s||void 0===s?void 0:s.isFetching)||(null===s||void 0===s?void 0:s.isLoading)||!1}),v(e),w(t)},[ne,ae]),(0,s.useEffect)(()=>{C&&C.length&&C.forEach(e=>{var t;return(null===(t=ae[e])||void 0===t?void 0:t.refetch)&&ae[e].refetch()})},[C,ae]);const se=(0,s.useMemo)(()=>{const e=Object.keys(j||{}).filter(e=>Array.isArray(j[e])&&j[e].length>0);return new Set(e)},[j]);(0,s.useEffect)(()=>{if(N){_.current=C;const e=Array.from(se),t=Hn.filter(t=>e.includes(t)).slice(0,6);t.length&&k(t)}else _.current&&(k(_.current),_.current=null)},[N,se]);const[ie,re]=(0,s.useState)(!1),[le,oe]=(0,s.useState)(""),[de,ce]=(0,s.useState)(()=>"undefined"!==typeof window&&window.innerWidth<700);(0,s.useEffect)(()=>{const e=()=>ce(window.innerWidth<700);try{window.addEventListener("resize",e)}catch(t){}return()=>{try{window.removeEventListener("resize",e)}catch(t){}}},[]);return(0,Y.jsx)(r.A,{title:(0,Y.jsx)(h.A.Title,{level:4,style:{margin:0},children:"Statistics & Analytics"}),style:{borderRadius:16,boxShadow:"0 2px 16px #40c9ff11"},styles:{body:{padding:24}},children:(0,Y.jsxs)("div",{ref:X,style:{background:"#ffffff",padding:8},children:[(0,Y.jsxs)(dt.A,{layout:de?"vertical":"inline",style:{marginBottom:24,width:"100%",boxSizing:"border-box"},children:[(0,Y.jsx)(dt.A.Item,{label:"Date Range",children:(0,Y.jsx)(Mn,{value:I.dateRange,onChange:e=>S(t=>(0,a.A)((0,a.A)({},t),{},{dateRange:e?e.filter(Boolean):[]})),allowClear:!0})}),(0,Y.jsx)(dt.A.Item,{label:"Resident Type",children:(0,Y.jsxs)(d.A,{value:I.residentType,onChange:e=>S(t=>(0,a.A)((0,a.A)({},t),{},{residentType:e})),style:{minWidth:140},allowClear:!0,placeholder:"All Types",children:[(0,Y.jsx)(Wn,{value:"",children:"All"}),(0,Y.jsx)(Wn,{value:"active",children:"Active"}),(0,Y.jsx)(Wn,{value:"inactive",children:"Inactive"})]})}),(0,Y.jsx)(dt.A.Item,{label:"Charts",children:(0,Y.jsx)(Ue.A,{open:O,onOpenChange:e=>{F(C.slice()),U(e)},popupRender:()=>(0,Y.jsxs)("div",{style:{padding:12,background:"#fff",borderRadius:8,boxShadow:"0 6px 20px rgba(0,0,0,0.08)",minWidth:340},children:[(0,Y.jsx)("div",{style:{maxHeight:260,overflowY:"auto",paddingRight:8},onWheel:e=>{},children:(0,Y.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Object.keys(Yn).map(e=>{const t=(z||[]).includes(e);return(0,Y.jsx)(Ft.A,{checked:t,onChange:t=>{const n=new Set(z||[]);t.target.checked?n.add(e):n.delete(e),F(Array.from(n))},children:(0,Y.jsx)("span",{style:{fontSize:13},children:Yn[e].title})},e)})})}),(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[(0,Y.jsx)(u.Ay,{size:"small",onClick:()=>{F(C.slice()),U(!1)},children:"Cancel"}),(0,Y.jsx)(u.Ay,{size:"small",type:"primary",onClick:()=>{k(z.slice()),U(!1)},children:"Apply"})]})]}),trigger:["click"],children:(0,Y.jsxs)(u.Ay,{children:["Charts ",(0,Y.jsx)(Rn.A,{})]})})}),(0,Y.jsx)(dt.A.Item,{style:{width:"100%",boxSizing:"border-box"},children:(0,Y.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center",width:"100%",boxSizing:"border-box"},children:[(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:200},children:[(0,Y.jsx)(Pn.A,{checked:N,onChange:e=>T(!!e)}),(0,Y.jsx)("span",{style:{fontSize:13},children:"Enable when data exists"})]}),(0,Y.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",flex:de?"0 0 100%":"0 1 auto",alignItems:"center",width:de?"100%":void 0,boxSizing:"border-box",paddingRight:8},children:[(0,Y.jsx)(u.Ay,{onClick:()=>{D(!0),L(C[0]||"gender")},block:de,style:de?{width:"100%",marginBottom:8}:void 0,children:"Chart Settings"}),(0,Y.jsx)(u.Ay,{type:"primary",onClick:()=>{const e=(e=>{var t,n,a;const s=e.summary||y||{},i=e.charts||j||{},r=Number(null!==(t=s.totalResidents)&&void 0!==t?t:0),l=i.gender||[],o=i.age||[],d=i["civil-status"]||[],c=i.education||[],u=i["documents-monthly"]||[],h=i.occupation||[],m=i.nationality||[],p=i.bloodType||[],x=i.disability||[],g=i.children||[],f=i.businessType||[],A=i.businessSize||[],v=i.incomeBrackets||[],b=Number((null===(n=l.find(e=>(e.type||"").toLowerCase().startsWith("m")))||void 0===n?void 0:n.value)||0),w=Number((null===(a=l.find(e=>(e.type||"").toLowerCase().startsWith("f")))||void 0===a?void 0:a.value)||0),I=Math.max(0,(l||[]).reduce((e,t)=>e+(Number(t.value)||0),0)-b-w);let S="";if(o.length){var C,k;const e=[...o].sort((e,t)=>(Number(t.value)||0)-(Number(e.value)||0));S=(null===(C=e[0])||void 0===C?void 0:C.type)||(null===(k=e[0])||void 0===k?void 0:k.group)||""}const N=d.length?d.slice(0,3).map(e=>"".concat(e.type," (").concat(e.value,")")).join(", "):"",T=c.length?c.slice(0,3).map(e=>"".concat(e.type," (").concat(e.value,")")).join(", "):"",_=u.length?u.reduce((e,t)=>e+(Number(t.value)||0),0):0;let P="",D=0;if(u.length){const e=u.reduce((e,t)=>(Number(t.value)||0)>(Number(e.value)||0)?t:e,u[0]);P=(null===e||void 0===e?void 0:e.type)||"",D=Number((null===e||void 0===e?void 0:e.value)||0)}const R=[];if(r>0){const e=b||w||I?"There are currently ".concat(r," residents, with ").concat(b," males, ").concat(w," females").concat(I?", and ".concat(I," identifying as other"):"","."):"There are currently ".concat(r," residents.");R.push(e)}else R.push("Resident count is not available.");if(S?R.push("The most common age group is ".concat(S,".")):o.length?R.push("Age distribution is available but no dominant age group could be determined."):R.push("Age distribution data is not available."),h.length){const e=h.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0)).slice(0,3).map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");R.push("Top occupations: ".concat(e,"."))}else R.push("Occupation distribution is not available.");if(m.length){const e=m.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0)).slice(0,3).map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");R.push("Nationality distribution (top): ".concat(e,"."))}if(N?R.push("Civil status (top): ".concat(N,".")):R.push("Civil status breakdown is not available."),p.length){const e=p.map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");R.push("Blood type breakdown: ".concat(e,"."))}if(x.length){const e=x.reduce((e,t)=>e+(Number(t.value)||0),0);R.push("Disability reported for ".concat(e," residents."))}if(T?R.push("Educational attainment (top): ".concat(T,".")):R.push("Educational attainment data is not available."),g.length){const e=g.reduce((e,t,n)=>e+(Number(t.value)||0)*(Number(t.type)||n),0)/Math.max(1,g.reduce((e,t)=>e+(Number(t.value)||0),0));R.push("Average reported children per household (approx): ".concat(Number(e).toFixed(2),"."))}if(u.length?R.push("During the selected period there were ".concat(_," document requests. The busiest month was ").concat(P," with ").concat(D," requests.")):R.push("Document request trends are not available for the selected period."),f.length){const e=f.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0)).slice(0,3).map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");R.push("Top business types: ".concat(e,"."))}if(A.length){const e=A.reduce((e,t)=>e+(Number(t.value)||0),0);R.push("Business size distribution available for ".concat(e," businesses."))}if(v.length){const e=v.reduce((e,t)=>e+(Number(t.value)||0),0),t=v.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0))[0];t&&R.push("Most residents fall into the ".concat(t.type||t.name," income bracket (").concat(t.value,"). Total reported incomes: ").concat(e,"."))}return R.join(" ")})({summary:y,charts:j});oe(e),re(!0)},block:de,style:de?{width:"100%",marginBottom:8}:void 0,children:"Generate Report"}),(0,Y.jsx)(u.Ay,{onClick:async()=>{await(async()=>{if(X.current){i.Ay.loading({content:"Preparing full report...",key:"report"});try{const e=(await n.e(239).then(n.t.bind(n,65239,23))).default,t=X.current,a=(await e(t,{background:"#ffffff"})).toDataURL("image/png"),s=new En.Ay({unit:"pt",format:"a4",orientation:"portrait"}),r="Barangay Analytics Report";s.setFontSize(24),s.text(r,40,80),s.setFontSize(12),s.text("Generated: ".concat((new Date).toLocaleString()),40,110),s.addPage();const l=s.internal.pageSize.getWidth(),o=s.internal.pageSize.getHeight(),d=40,c=l-2*d,u=new Image;u.src=a,await new Promise(e=>u.onload=e);const h=c,m=u.height*h/u.width,p=u.height/m,x=o-2*d,g=Math.floor(x*p),f=document.createElement("canvas");f.width=u.width,f.height=u.height;const y=f.getContext("2d");if(!y)throw new Error("Canvas not supported");y.fillStyle="#ffffff",y.fillRect(0,0,f.width,f.height),y.drawImage(u,0,0);let A=0;for(;A<f.height;){const e=document.createElement("canvas");e.width=f.width,e.height=Math.min(g,f.height-A);const t=e.getContext("2d");if(!t)break;t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height),t.drawImage(f,0,A,e.width,e.height,0,0,e.width,e.height);const n=e.toDataURL("image/png"),a=e.height/p;s.addImage(n,"PNG",d,d,h,a),A+=g,A<f.height&&s.addPage()}s.save("barangay-analytics-report.pdf"),i.Ay.success({content:"Report ready",key:"report"})}catch(e){console.error("Full report export failed",e),i.Ay.error({content:"Failed to export full report (see console).",key:"report"})}}else i.Ay.error("Dashboard not available for capture")})()},block:de,style:de?{width:"100%"}:void 0,children:"Download Full Analytics"})]})]})})]}),(0,Y.jsx)(Zt.A,{title:"Chart Settings",placement:"right",onClose:()=>D(!1),open:P,width:420,children:(0,Y.jsxs)(dt.A,{layout:"vertical",children:[(0,Y.jsx)(dt.A.Item,{label:"Select chart",children:(0,Y.jsx)(d.A,{value:B,onChange:e=>L(e),children:Object.keys(Yn).map(e=>(0,Y.jsx)(d.A.Option,{value:e,children:Yn[e].title},e))})}),(0,Y.jsx)(dt.A.Item,{label:"Chart type",children:(0,Y.jsxs)(d.A,{value:R[B]&&R[B].chartType||Yn[B].chartType,onChange:e=>q(t=>(0,a.A)((0,a.A)({},t),{},{[B]:(0,a.A)((0,a.A)({},t[B]||{}),{},{chartType:e})})),children:[(0,Y.jsx)(d.A.Option,{value:"pie",children:"Pie"}),(0,Y.jsx)(d.A.Option,{value:"bar",children:"Bar"}),(0,Y.jsx)(d.A.Option,{value:"line",children:"Line"}),(0,Y.jsx)(d.A.Option,{value:"area",children:"Area"})]})}),(0,Y.jsx)(dt.A.Item,{label:"Date range for this chart",children:(0,Y.jsx)(Mn,{value:R[B]&&R[B].dateRange||I.dateRange,onChange:e=>q(t=>(0,a.A)((0,a.A)({},t),{},{[B]:(0,a.A)((0,a.A)({},t[B]||{}),{},{dateRange:e?e.filter(Boolean):[]})})),allowClear:!0})}),(0,Y.jsx)(dt.A.Item,{label:"Show labels",children:(0,Y.jsx)(Pn.A,{checked:null===(c=R[B]&&R[B].showLabels)||void 0===c||c,onChange:e=>q(t=>(0,a.A)((0,a.A)({},t),{},{[B]:(0,a.A)((0,a.A)({},t[B]||{}),{},{showLabels:e})}))})}),(0,Y.jsx)(dt.A.Item,{label:"Show tooltips",children:(0,Y.jsx)(Pn.A,{checked:null===(p=R[B]&&R[B].showTooltips)||void 0===p||p,onChange:e=>q(t=>(0,a.A)((0,a.A)({},t),{},{[B]:(0,a.A)((0,a.A)({},t[B]||{}),{},{showTooltips:e})}))})}),(0,Y.jsx)(dt.A.Item,{label:"Show legend",children:(0,Y.jsx)(Pn.A,{checked:null===(x=R[B]&&R[B].showLegend)||void 0===x||x,onChange:e=>q(t=>(0,a.A)((0,a.A)({},t),{},{[B]:(0,a.A)((0,a.A)({},t[B]||{}),{},{showLegend:e})}))})}),(0,Y.jsx)(dt.A.Item,{children:(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(u.Ay,{type:"primary",onClick:()=>{D(!1),M(B)},children:"Apply"}),(0,Y.jsx)(u.Ay,{onClick:()=>{q(e=>(0,a.A)((0,a.A)({},e),{},{[B]:{}}))},children:"Reset"})]})})]})}),(0,Y.jsx)(ge.A,{title:"Analytics Report",open:ie,onCancel:()=>re(!1),footer:[(0,Y.jsx)(u.Ay,{onClick:async()=>{try{await navigator.clipboard.writeText(le),i.Ay.success("Report copied to clipboard")}catch(e){i.Ay.error("Failed to copy")}},children:"Copy"},"copy"),(0,Y.jsx)(u.Ay,{type:"primary",onClick:async()=>{const e=new En.Ay({orientation:"portrait"});e.setFontSize(16),e.text("Analytics Report",14,20),e.setFontSize(11);const t=e.splitTextToSize(le,180);e.text(t,14,30);try{const a=(await n.e(239).then(n.t.bind(n,65239,23))).default;let s=40+6*t.length;for(const t of C){const n=Q.current[t];if(!n)continue;const i=await a(n,{background:"#ffffff"}),r=i.toDataURL("image/png"),l=i.width,o=i.height,d=e.internal.pageSize.getWidth()-28,c=o*d/l;s+c>e.internal.pageSize.getHeight()-20&&(e.addPage(),s=20),e.addImage(r,"PNG",14,s,d,c),s+=c+8}}catch(a){console.warn("html2canvas not available or capture failed, exporting text only",a),i.Ay.warning("Chart capture failed; exporting text-only PDF. To include images, install html2canvas.")}e.save("analytics-report.pdf")},children:"Download as PDF"},"download")],children:(0,Y.jsx)(h.A.Paragraph,{children:le||"No data available for report."})}),(0,Y.jsxs)(l.A,{gutter:[24,24],style:{marginBottom:24},children:[(0,Y.jsx)(o.A,{xs:24,sm:12,md:8,children:(0,Y.jsx)(r.A,{variant:"borderless",style:{borderRadius:12,boxShadow:"0 8px 20px rgba(15,15,15,0.04)",textAlign:"left"},styles:{body:{padding:16}},children:g?(0,Y.jsx)(_n.A,{active:!0,paragraph:!1}):(0,Y.jsxs)("div",{children:[(0,Y.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12},children:"Total Residents"}),(0,Y.jsx)(h.A.Title,{level:3,style:{margin:0},children:W})]})})}),(0,Y.jsx)(o.A,{xs:24,sm:12,md:8,children:(0,Y.jsx)(r.A,{variant:"borderless",style:{borderRadius:12,boxShadow:"0 8px 20px rgba(15,15,15,0.04)",textAlign:"left"},styles:{body:{padding:16}},children:g?(0,Y.jsx)(_n.A,{active:!0,paragraph:!1}):(0,Y.jsxs)("div",{children:[(0,Y.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12},children:"Total Documents"}),(0,Y.jsx)(h.A.Title,{level:3,style:{margin:0},children:H})]})})}),(0,Y.jsx)(o.A,{xs:24,sm:24,md:8,children:(0,Y.jsx)(r.A,{style:{borderRadius:12,boxShadow:"0 8px 20px rgba(15,15,15,0.04)",textAlign:"left"},styles:{body:{padding:16}},children:g?(0,Y.jsx)(_n.A,{active:!0,paragraph:!1}):(0,Y.jsxs)("div",{children:[(0,Y.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12},children:"Requests (selected period)"}),(0,Y.jsx)(h.A.Title,{level:3,style:{margin:0},children:Z?Z.reduce((e,t)=>e+(Number(t.value)||0),0):0}),(0,Y.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12,marginTop:6},children:Z&&Z.length?"Latest: ".concat(Z[Z.length-1].type," (").concat(Z[Z.length-1].value,")"):""})]})})})]}),(0,Y.jsx)(m.A,{}),ee.map(e=>{const t=ae[e];var n;return null!==t&&void 0!==t&&t.isError?(0,Y.jsx)(Dn.A,{message:"Failed to load ".concat(Yn[e].title),description:(0,Y.jsxs)("div",{children:[String((null===(n=t.error)||void 0===n?void 0:n.message)||t.error)," ",(0,Y.jsx)(u.Ay,{size:"small",onClick:()=>t.refetch(),children:"Retry"})]}),type:"error",showIcon:!0,style:{marginBottom:12}},"alert-".concat(e)):null}),(0,Y.jsxs)(l.A,{gutter:[24,24],children:[C.includes("gender")&&(0,Y.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,Y.jsx)($,{id:"gender",title:Yn.gender.title,chartType:Yn.gender.chartType,data:j.gender,loading:b.gender,colors:Yn.gender.colors})}),C.includes("age")&&(0,Y.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,Y.jsx)($,{id:"age",title:Yn.age.title,chartType:Yn.age.chartType,data:j.age,loading:b.age,colors:Yn.age.colors})}),C.includes("documents-monthly")&&(0,Y.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,Y.jsx)($,{id:"documents-monthly",title:Yn["documents-monthly"].title,chartType:Yn["documents-monthly"].chartType,data:j["documents-monthly"],loading:b["documents-monthly"],colors:Yn["documents-monthly"].colors})}),C.includes("civil-status")&&(0,Y.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,Y.jsx)($,{id:"civil-status",title:Yn["civil-status"].title,chartType:Yn["civil-status"].chartType,data:j["civil-status"],loading:b["civil-status"],colors:Yn["civil-status"].colors})}),C.includes("education")&&(0,Y.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,Y.jsx)($,{id:"education",title:Yn.education.title,chartType:Yn.education.chartType,data:j.education,loading:b.education,colors:Yn.education.colors})})]})]})})},Kn=()=>(0,Y.jsx)(Ln.Ht,{client:Vn,children:(0,Y.jsx)(Gn,{})});var Jn=n(94842),Zn=n(94527),$n=n(80172),Qn=n(1725),Xn=n(76384),ea=n(61190),ta=n(70916);const na=e=>{let{open:t,onClose:n,contactEmail:a}=e;const[i,r]=(0,s.useState)(a||""),[l,o]=(0,s.useState)(!1);(0,s.useEffect)(()=>{r(a||"")},[a,t]);const[d,c]=(0,s.useState)(!1),[u,h]=(0,s.useState)(""),[m,p]=(0,s.useState)("success");return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(ea.A,{open:t,onClose:()=>{l||n()},children:(0,Y.jsxs)(jt.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:420,bgcolor:"background.paper",boxShadow:24,p:3},children:[(0,Y.jsx)("h3",{children:"Send Test Email"}),(0,Y.jsx)(wt.A,{label:"Recipient Email",type:"email",value:i,onChange:e=>r(e.target.value),fullWidth:!0,margin:"normal"}),(0,Y.jsxs)(jt.A,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[(0,Y.jsx)(St.A,{onClick:n,disabled:l,children:"Cancel"}),(0,Y.jsx)(St.A,{variant:"contained",onClick:async()=>{try{o(!0);try{const e=await G.adminAPI.getSystemSettings();if(!e||!e.smtp||!e.smtp.host)return h("SMTP is not configured. Please configure SMTP settings before sending a test email."),p("error"),c(!0),void o(!1)}catch(r){}const e=await G.adminAPI.testSmtp(i),t=e&&e.message?e.message:"Test email sent successfully";h(t),p("success"),c(!0),o(!1),setTimeout(()=>{c(!1),n()},900)}catch(l){var e,t,a,s;o(!1);const n=(null===l||void 0===l||null===(e=l.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||(null===l||void 0===l||null===(a=l.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.error)||(null===l||void 0===l?void 0:l.message)||"Failed to send test email";h(n),p("error"),c(!0)}},disabled:l||!i,children:l?(0,Y.jsx)($n.A,{size:20}):"Send Test Email"})]})]})}),(0,Y.jsx)(ta.A,{open:d,autoHideDuration:4e3,onClose:()=>c(!1),children:(0,Y.jsx)(kt.A,{onClose:()=>c(!1),severity:m,sx:{width:"100%"},children:u})})]})};var aa=n(56403),sa=n(78354);const ia={siteName:"Barangay Portal",barangayName:"Barangay Uno",barangayAddress:"123 Main St, City, Province",contactEmail:"info@barangayuno.local",contactPhone:"+63 912 345 6789",maintainanceMode:!1,allowNewRegistrations:!0,requireEmailVerification:!0,maxDocumentRequests:5,documentProcessingDays:3,allowMultipleAccountsPerIP:!1,maxAccountsPerIP:1,systemNotice:"",smtp:{host:"",port:587,user:"",password:""}},ra=()=>{var e,t,n,r,l;const[o,d]=(0,s.useState)(()=>(0,a.A)({},ia)),[c,u]=(0,s.useState)(!0),[h,m]=(0,s.useState)(!1),[p,x]=(0,s.useState)(!1),[g,f]=(0,s.useState)(null),[A,j]=(0,s.useState)(!1),[v,b]=(0,s.useState)([]),[w,I]=(0,s.useState)(!1),[S,C]=(0,s.useState)(!1),[k,N]=(0,s.useState)(null),T=(0,s.useRef)({}),[_,P]=(0,s.useState)({}),D=(0,s.useRef)({}),R=(0,s.useRef)(null),q=(0,s.useRef)(0),[B,L]=(0,s.useState)([]),O=(0,s.useRef)({}),U=(0,s.useRef)(null),[z,F]=(0,s.useState)(!1);(0,s.useEffect)(()=>{const e=new AbortController;return E(e.signal),()=>{try{e.abort()}catch(t){}try{Object.values(D.current).forEach(e=>{try{URL.revokeObjectURL(e)}catch(t){}})}catch(t){}}},[]),(0,s.useEffect)(()=>{try{const e=R.current;if(!e)return;v.length>q.current&&e.scrollTo({left:e.scrollWidth,behavior:"smooth"}),q.current=v.length}catch(e){}},[v.length]),(0,s.useEffect)(()=>{try{v.filter(e=>e._id&&e._id.toString().startsWith("new-")).map(e=>e._id).forEach(e=>{if(!B.includes(e)){L(t=>[...t,e]);const t=window.setTimeout(()=>{L(t=>t.filter(t=>t!==e)),delete O.current[e]},2500);O.current[e]=t}})}catch(e){}return()=>{Object.values(O.current).forEach(t=>{try{clearTimeout(t)}catch(e){}}),O.current={}}},[v,B]);const E=async e=>{u(!0);try{let a=null;try{a=await G.adminAPI.getSystemSettings()}catch(t){try{const t=await aa.A.get("".concat(G.API_URL,"/admin/settings"),{withCredentials:!0,signal:e});null!==t&&void 0!==t&&t.data&&(a=t.data)}catch(n){console.warn("Failed to load system settings via adminAPI and API_URL fallback",t,n)}}a&&(d(a),U.current=a),I(!0);try{const t=await G.adminAPI.getOfficials();if(Array.isArray(t))b(t);else{const t=await aa.A.get("".concat(G.API_URL,"/admin/officials"),{withCredentials:!0,signal:e});null!==t&&void 0!==t&&t.data&&b(t.data)}}catch(t){try{const t=await aa.A.get("".concat(G.API_URL,"/admin/officials"),{withCredentials:!0,signal:e});null!==t&&void 0!==t&&t.data&&b(t.data)}catch(n){console.warn("Failed to load officials via adminAPI and API_URL fallback",t,n)}}finally{I(!1)}}catch(t){if("CanceledError"===(null===t||void 0===t?void 0:t.name)||"AbortError"===(null===t||void 0===t?void 0:t.name))return;console.error("Unexpected error in fetchSettings",t),i.Ay.error("Unexpected error while loading settings")}finally{u(!1)}},M=async()=>{try{await(async()=>{try{m(!0),f(null);const e=(0,a.A)((0,a.A)({},o),{},{maintenanceMode:o.maintainanceMode,allowRegistrations:o.allowNewRegistrations,maxDocumentRequestsPerUser:Number(o.maxDocumentRequests)||1,documentProcessingDays:Number(o.documentProcessingDays)||1},"undefined"!==typeof o.maxAccountsPerIP?{maxAccountsPerIP:Number(o.maxAccountsPerIP)||1}:{});await G.adminAPI.updateSystemSettings(e),U.current=e,F(!1),x(!0),i.Ay.success("Settings saved")}catch(e){console.error("Failed to save settings",e),f("Failed to save settings"),i.Ay.error("Failed to save settings")}finally{m(!1),window.setTimeout(()=>x(!1),2e3)}})()}catch(e){}try{await(async()=>{if(v&&0!==v.length){C(!0),N(null);try{const t=[];for(const n of v)if(!n._id||n._id.toString().startsWith("new-")){const e=await G.adminAPI.createOfficial({name:n.name,title:n.title,term:n.term});t.push(e)}else try{const e=await G.adminAPI.updateOfficial(n._id,{name:n.name,title:n.title,term:n.term});t.push(e)}catch(e){t.push(n)}try{const e=await G.adminAPI.getOfficials();Array.isArray(e)?b(e):b(t)}catch(e){b(t)}i.Ay.success("Officials saved")}catch(t){console.error("Manual save officials failed",t),N("Manual save failed"),i.Ay.error("Manual save failed")}finally{C(!1)}}})()}catch(e){}};(0,s.useEffect)(()=>{try{if(!U.current)return void F(!1);F(JSON.stringify(U.current)!==JSON.stringify(o))}catch(e){F(!1)}},[o]);return(0,Y.jsx)(jt.A,{sx:{pt:"calc(var(--app-header-height, 64px) + 24px)",px:3,pb:3},children:(0,Y.jsxs)(bt.A,{sx:{p:3},children:[(0,Y.jsx)(Jn.A,{variant:"subtitle1",gutterBottom:!0,children:"Barangay Information"}),(0,Y.jsxs)(jt.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,Y.jsx)(wt.A,{label:"Site Name",value:o.siteName,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{siteName:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,Y.jsx)(wt.A,{label:"Barangay Name",value:o.barangayName,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{barangayName:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,Y.jsx)(wt.A,{label:"Barangay Address",value:o.barangayAddress,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{barangayAddress:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0,multiline:!0,rows:2})]}),(0,Y.jsx)(Zn.A,{sx:{my:3}}),(0,Y.jsx)(Jn.A,{variant:"subtitle1",gutterBottom:!0,children:"SMTP / Email Settings"}),(0,Y.jsxs)(jt.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,Y.jsx)(wt.A,{label:"SMTP Host",value:(null===(e=o.smtp)||void 0===e?void 0:e.host)||"",onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{smtp:(0,a.A)((0,a.A)({},t.smtp),{},{host:e.target.value})})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,Y.jsx)(wt.A,{label:"SMTP Port",type:"number",value:(null===(t=o.smtp)||void 0===t?void 0:t.port)||"",onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{smtp:(0,a.A)((0,a.A)({},t.smtp),{},{port:parseInt(e.target.value||"0")})})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,Y.jsx)(wt.A,{label:"SMTP User",value:(null===(n=o.smtp)||void 0===n?void 0:n.user)||"",onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{smtp:(0,a.A)((0,a.A)({},t.smtp),{},{user:e.target.value})})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,Y.jsxs)(jt.A,{sx:{display:"flex",gap:2},children:[(0,Y.jsx)(St.A,{variant:"outlined",onClick:()=>j(!0),children:"Send Test Email"}),(0,Y.jsx)(St.A,{variant:"text",onClick:()=>d(e=>(0,a.A)((0,a.A)({},e),{},{smtp:(0,a.A)((0,a.A)({},e.smtp),{},{password:""})})),children:"Clear SMTP Password"})]})]}),(0,Y.jsx)(na,{open:A,onClose:()=>j(!1),contactEmail:o.contactEmail}),(0,Y.jsx)(Zn.A,{sx:{my:3}}),(0,Y.jsx)(Jn.A,{variant:"subtitle1",gutterBottom:!0,children:"Barangay Officials"}),(0,Y.jsxs)(jt.A,{sx:{display:"flex",gap:3,alignItems:"flex-start",mb:3,flexDirection:{xs:"column",md:"row"}},children:[(0,Y.jsxs)(jt.A,{sx:{flex:1,width:"100%"},children:[(0,Y.jsxs)(jt.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[(0,Y.jsx)(Jn.A,{variant:"body1",children:"Manage officials (auto-saves changes)"}),(0,Y.jsx)(St.A,{onClick:()=>{const e={_id:"new-".concat(Date.now()),name:"",title:"",term:""};b(t=>[...t,e])},startIcon:(0,Y.jsx)(sa.A,{}),children:"Add Official"})]}),(0,Y.jsx)(jt.A,{sx:{maxHeight:420,overflowY:"auto",pr:1,border:"1px solid rgba(0,0,0,0.04)",borderRadius:1,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.6)"},children:w?(0,Y.jsx)($n.A,{size:24}):(0,Y.jsx)(jt.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:v.map((e,t)=>(0,Y.jsxs)(bt.A,{sx:{p:2,display:"flex",gap:2,alignItems:"center"},children:[(0,Y.jsx)(jt.A,{sx:{width:72,height:72,borderRadius:"50%",overflow:"hidden",flexShrink:0,border:"3px solid rgba(0,0,0,0.04)",boxShadow:"0 1px 6px rgba(0,0,0,0.06)"},children:(0,Y.jsx)("img",{src:ut(e),alt:e.name||"photo",style:{width:"100%",height:"100%",objectFit:"cover",transition:"transform .2s",display:"block"}})}),(0,Y.jsxs)(jt.A,{sx:{flex:1},children:[(0,Y.jsx)(wt.A,{label:"Full name",value:e.name,onChange:t=>{const n=t.target.value;b(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{name:n}):t)),T.current[e._id||""]&&clearTimeout(T.current[e._id||""]),T.current[e._id||""]=window.setTimeout(async()=>{try{if(C(!0),e._id&&!e._id.toString().startsWith("new-"))await G.adminAPI.updateOfficial(e._id,(0,a.A)((0,a.A)({},e),{},{name:n}));else{const t=await G.adminAPI.createOfficial((0,a.A)((0,a.A)({},e),{},{name:n}));b(n=>n.map(n=>n._id===e._id?t:n))}N(null)}catch(t){console.error("auto-save failed",t),N("Auto-save failed")}finally{C(!1)}},900)},fullWidth:!0,size:"small",sx:{mb:1},variant:"outlined",InputLabelProps:{shrink:!0}}),(0,Y.jsx)(wt.A,{label:"Title/Position",value:e.title,onChange:t=>{const n=t.target.value;b(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{title:n}):t)),T.current[e._id||""]&&clearTimeout(T.current[e._id||""]),T.current[e._id||""]=window.setTimeout(async()=>{try{if(C(!0),e._id&&!e._id.toString().startsWith("new-"))await G.adminAPI.updateOfficial(e._id,(0,a.A)((0,a.A)({},e),{},{title:n}));else{const t=await G.adminAPI.createOfficial((0,a.A)((0,a.A)({},e),{},{title:n}));b(n=>n.map(n=>n._id===e._id?t:n))}N(null)}catch(t){console.error("auto-save failed",t),N("Auto-save failed")}finally{C(!1)}},900)},fullWidth:!0,size:"small",sx:{mb:1},variant:"outlined",InputLabelProps:{shrink:!0}}),(0,Y.jsx)(wt.A,{label:"Term",value:e.term,onChange:t=>{const n=t.target.value;b(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{term:n}):t)),T.current[e._id||""]&&clearTimeout(T.current[e._id||""]),T.current[e._id||""]=window.setTimeout(async()=>{try{if(C(!0),e._id&&!e._id.toString().startsWith("new-"))await G.adminAPI.updateOfficial(e._id,(0,a.A)((0,a.A)({},e),{},{term:n}));else{const t=await G.adminAPI.createOfficial((0,a.A)((0,a.A)({},e),{},{term:n}));b(n=>n.map(n=>n._id===e._id?t:n))}N(null)}catch(t){console.error("auto-save failed",t),N("Auto-save failed")}finally{C(!1)}},900)},fullWidth:!0,size:"small",variant:"outlined",InputLabelProps:{shrink:!0}}),(0,Y.jsxs)(jt.A,{sx:{display:"flex",gap:1,mt:1},children:[(0,Y.jsx)(J.A,{showUploadList:!1,beforeUpload:t=>{if(t.size>2097152)return i.Ay.warning("File is too large. Maximum allowed size is 2 MB."),!1;try{const n=URL.createObjectURL(t);D.current[e._id||"temp-".concat(Date.now())]=n,b(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{previewUrl:n}):t))}catch(n){}return(async()=>{try{if(!e._id||e._id.toString().startsWith("new-"))return void i.Ay.warning("Please save official first by entering name/title/term");await G.adminAPI.uploadOfficialPhoto(e._id,t);const a=await G.adminAPI.getOfficials();b(Array.isArray(a)?a:v),i.Ay.success("Photo uploaded");try{const t=e._id||"",n=D.current[t];n&&(URL.revokeObjectURL(n),delete D.current[t])}catch(n){}}catch(a){console.error("upload failed",a),i.Ay.error("Upload failed")}})(),!1},children:(0,Y.jsx)(St.A,{startIcon:(0,Y.jsx)(X.A,{}),children:"Upload Photo"})}),(0,Y.jsx)(St.A,{color:"error",startIcon:(0,Y.jsx)(Q.A,{}),onClick:()=>{e._id&&!e._id.toString().startsWith("new-")?(async e=>{if(e){C(!0);try{await G.adminAPI.deleteOfficial(e),b(t=>t.filter(t=>t._id!==e)),i.Ay.success("Official deleted")}catch(t){console.error("Delete official failed",t),i.Ay.error("Failed to delete official")}finally{C(!1)}}})(e._id):b(t=>t.filter(t=>t._id!==e._id))},children:"Delete"})]})]})]},e._id||t))})})]}),(0,Y.jsxs)(jt.A,{sx:{width:{xs:"100%",md:360},position:{xs:"relative",md:"sticky"},top:{md:24},alignSelf:"flex-start",mt:{xs:2,md:0}},children:[(0,Y.jsx)(Jn.A,{variant:"body2",sx:{mb:1},children:"Officials Preview"}),(0,Y.jsx)(jt.A,{sx:{background:"white",borderRadius:2,p:2},children:0===v.length?(0,Y.jsx)(Jn.A,{variant:"body2",color:"text.secondary",children:"No officials to preview"}):(()=>{const e=[...v.filter(e=>!(e._id&&e._id.toString().startsWith("new-"))),...v.filter(e=>e._id&&e._id.toString().startsWith("new-"))];return(0,Y.jsx)("div",{ref:R,style:{display:"flex",gap:12,overflowX:"auto",padding:"6px 4px",scrollSnapType:"x mandatory"},"aria-label":"Officials preview",children:e.map(e=>{const t=e._id||"",n=B.includes(t);return(0,Y.jsxs)("div",{style:{minWidth:140,textAlign:"center",padding:8,scrollSnapAlign:"center",transition:"box-shadow .25s, transform .18s",boxShadow:n?"0 10px 30px rgba(25,118,210,0.18)":void 0,transform:n?"translateY(-4px)":void 0,borderRadius:8,background:n?"linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,255,0.98))":void 0,flex:"0 0 auto"},children:[(0,Y.jsx)(y.A,{size:80,src:ut(e),style:{margin:"0 auto",boxShadow:"0 6px 18px rgba(0,0,0,0.06)"}}),(0,Y.jsxs)("div",{style:{marginTop:8},children:[(0,Y.jsx)("div",{style:{fontWeight:600,fontSize:14},children:e.name||"\u2014"}),(0,Y.jsx)("div",{style:{color:"#888",fontSize:12},children:e.title}),(0,Y.jsx)("div",{style:{color:"#888",fontSize:12},children:e.term})]})]},t||Math.random())})})})()})]})]}),k&&(0,Y.jsx)(Jn.A,{color:"error",sx:{mt:1},children:k}),(0,Y.jsx)(Jn.A,{variant:"subtitle1",gutterBottom:!0,children:"Contact Information"}),(0,Y.jsxs)(jt.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,Y.jsx)(wt.A,{label:"Contact Email",type:"email",value:o.contactEmail,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{contactEmail:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,Y.jsx)(wt.A,{label:"Contact Phone",value:o.contactPhone,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{contactPhone:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0})]}),(0,Y.jsx)(Zn.A,{sx:{my:3}}),(0,Y.jsx)(Jn.A,{variant:"subtitle1",gutterBottom:!0,children:"System Configuration"}),(0,Y.jsxs)(jt.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,Y.jsx)(Qn.A,{control:(0,Y.jsx)(Xn.A,{checked:o.maintainanceMode,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{maintainanceMode:e.target.checked}))}),label:"Maintenance Mode"}),(0,Y.jsx)(Qn.A,{control:(0,Y.jsx)(Xn.A,{checked:o.allowNewRegistrations,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{allowNewRegistrations:e.target.checked}))}),label:"Allow New Registrations"}),(0,Y.jsxs)(jt.A,{children:[(0,Y.jsx)(Qn.A,{control:(0,Y.jsx)(Xn.A,{checked:o.allowMultipleAccountsPerIP,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{allowMultipleAccountsPerIP:e.target.checked}))}),label:"Allow multiple accounts per IP"}),(0,Y.jsxs)(jt.A,{sx:{mt:1,ml:4,display:"flex",alignItems:"center",gap:2},children:[(0,Y.jsx)(wt.A,{label:"Max accounts per IP",type:"number",size:"small",value:null!==(r=o.maxAccountsPerIP)&&void 0!==r?r:1,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{maxAccountsPerIP:parseInt(e.target.value||"1")})),variant:"outlined",InputLabelProps:{shrink:!0},inputProps:{min:1,max:100},sx:{width:140}}),(0,Y.jsxs)(Jn.A,{variant:"caption",color:"text.secondary",children:["Current limit: ",null!==(l=o.maxAccountsPerIP)&&void 0!==l?l:1]})]})]}),(0,Y.jsx)(Qn.A,{control:(0,Y.jsx)(Xn.A,{checked:o.requireEmailVerification,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{requireEmailVerification:e.target.checked}))}),label:"Require Email Verification"}),(0,Y.jsx)(wt.A,{label:"Maximum Document Requests per User",type:"number",value:o.maxDocumentRequests,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{maxDocumentRequests:parseInt(e.target.value)})),variant:"outlined",InputLabelProps:{shrink:!0},inputProps:{min:1,max:20}}),(0,Y.jsx)(wt.A,{label:"Document Processing Days",type:"number",value:o.documentProcessingDays,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{documentProcessingDays:parseInt(e.target.value)})),variant:"outlined",InputLabelProps:{shrink:!0},inputProps:{min:1,max:30},helperText:"Standard number of days to process document requests"})]}),(0,Y.jsx)(Zn.A,{sx:{my:3}}),(0,Y.jsx)(Jn.A,{variant:"subtitle1",gutterBottom:!0,children:"System Notice"}),(0,Y.jsx)(jt.A,{sx:{mb:3},children:(0,Y.jsx)(wt.A,{label:"System-wide Notice",value:o.systemNotice,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{systemNotice:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0,multiline:!0,rows:3,helperText:"This notice will be displayed to all users"})}),(0,Y.jsx)(jt.A,{sx:{position:"fixed",right:24,bottom:24,zIndex:1300},children:(0,Y.jsx)(St.A,{variant:"contained",onClick:()=>M(),disabled:h||S,sx:{width:64,height:64,borderRadius:"50%",minWidth:64,boxShadow:"0 8px 24px rgba(25,118,210,0.24)",backgroundColor:"#1976d2",color:"#fff","&:hover":{boxShadow:"0 12px 32px rgba(25,118,210,0.32)",backgroundColor:"#1565c0"},display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600},"aria-label":"Save Settings and Officials",children:h||S?"...":"Save"})})]})})};var la=n(48745);const{Title:oa,Text:da}=h.A,{Search:ca}=c.A,ua=()=>{const[e,t]=(0,s.useState)([]),[h,m]=(0,s.useState)([]),[p,x]=(0,s.useState)(!1),[g,f]=(0,s.useState)(""),[y,A]=(0,s.useState)({}),[j,v]=(0,s.useState)(""),[b,w]=(0,s.useState)(""),[I,S]=(0,s.useState)("all"),[C,k]=(0,s.useState)("name"),[N,T]=(0,s.useState)(!1),[_,P]=(0,s.useState)(!1),[D,R]=(0,s.useState)(null),[q,B]=(0,s.useState)(!1),[L,O]=(0,s.useState)([]),[U,z]=(0,s.useState)(null),[F,E]=(0,s.useState)(!1),{user:M,setUser:W}=Pe();(0,s.useEffect)(()=>{(async()=>{T(!0);try{const e=await G.documentsAPI.listFiles();t(e)}catch(e){i.Ay.error("Failed to fetch document templates"),t([])}finally{T(!1)}})(),(async()=>{try{const e=await Promise.resolve().then(n.bind(n,31694)),t=await e.verificationAPI.getMyRequests();if(Array.isArray(t)&&t.length>0){const e=t.find(e=>"pending"===e.status)||t[0];e&&(z(e),E(!0))}}catch(e){}})()},[]);const H=e.filter(e=>{const t=e.filename.toLowerCase(),n=b.toLowerCase(),a="all"===I||e.category===I;return t.includes(n)&&a}).sort((e,t)=>{var n;switch(C){case"date":return new Date(t.uploadDate).getTime()-new Date(e.uploadDate).getTime();case"type":return(null===(n=e.filename.split(".").pop())||void 0===n?void 0:n.localeCompare(t.filename.split(".").pop()||""))||0;default:return e.filename.localeCompare(t.filename)}});return(0,Y.jsxs)("div",{style:{padding:"24px",minHeight:"80vh",background:"#f0f2f5"},children:[(0,Y.jsx)(l.A,{justify:"start",align:"middle",style:{marginBottom:24},children:(0,Y.jsxs)(o.A,{style:{textAlign:"left"},children:[(0,Y.jsxs)(yn.A,{style:{marginBottom:8},children:[(0,Y.jsx)(yn.A.Item,{children:"Home"}),(0,Y.jsx)(yn.A.Item,{children:"Documents"}),(0,Y.jsx)(yn.A.Item,{children:"Request"})]}),(0,Y.jsx)(oa,{level:2,style:{margin:0,textAlign:"left"},children:"Request Document"})]})}),(0,Y.jsxs)(l.A,{gutter:16,justify:"center",style:{marginBottom:24},children:[(0,Y.jsx)(o.A,{xs:24,sm:16,md:10,lg:8,children:(0,Y.jsx)(ca,{placeholder:"Search documents...",value:b,onChange:e=>w(e.target.value),style:{width:"100%"}})}),(0,Y.jsx)(o.A,{xs:24,sm:16,md:10,lg:8,children:(0,Y.jsxs)("div",{className:"filter-controls",children:[(0,Y.jsxs)(d.A,{defaultValue:"all",className:"filter-select category-select",style:{width:220},onChange:e=>S(e),children:[(0,Y.jsx)(d.A.Option,{value:"all",children:"All Categories"}),(0,Y.jsx)(d.A.Option,{value:"personal",children:"Personal Documents"}),(0,Y.jsx)(d.A.Option,{value:"business",children:"Business Documents"}),(0,Y.jsx)(d.A.Option,{value:"certificates",children:"Certificates"})]}),(0,Y.jsxs)(d.A,{defaultValue:"name",className:"filter-select sort-select",style:{width:160},onChange:e=>k(e),children:[(0,Y.jsx)(d.A.Option,{value:"name",children:"Sort by Name"}),(0,Y.jsx)(d.A.Option,{value:"date",children:"Sort by Date"}),(0,Y.jsx)(d.A.Option,{value:"type",children:"Sort by Type"})]})]})})]}),(0,Y.jsx)(l.A,{gutter:[16,16],children:N?(0,Y.jsx)(o.A,{span:24,style:{textAlign:"center",padding:"40px"},children:"Loading documents..."}):0===H.length?(0,Y.jsx)(o.A,{span:24,style:{textAlign:"center",padding:"40px"},children:"No documents found"}):H.map(e=>(0,Y.jsx)(o.A,{xs:24,sm:12,md:8,lg:6,children:(0,Y.jsx)(r.A,{hoverable:!0,style:{transition:"all 0.3s ease",borderRadius:8},bodyStyle:{padding:16},onClick:()=>(async e=>{const t=M||(()=>{try{const e=localStorage.getItem("userProfile");return e?JSON.parse(e):null}catch(e){return null}})();if(!t||"resident"!==t.role||t.verified){f(e.filename.replace(/\.docx$/i,""));try{const t=await Promise.resolve().then(n.bind(n,31694)),a=await t.axiosPublic.get("/documents/preview/".concat(e._id),{params:{format:"html"},responseType:"text"}),s=a&&a.data?a.data:"",i=/\{(.*?)\}/g,r=[];let l;for(;null!==(l=i.exec(s));)r.push(l[1].trim());const o=r.filter(e=>e&&"qr"!==e.toLowerCase());m(o);const d={},c=new Date,u=c.getDate(),h=c.getMonth()+1,p=c.toLocaleString(void 0,{month:"long"}),g=c.getFullYear(),f=String(h).padStart(2,"0"),y=String(u).padStart(2,"0"),j="".concat(f,"/").concat(y,"/").concat(g);o.forEach(e=>{d[e]="",/^current(day|dayof)?$/i.test(e)||/currentday/i.test(e)?d[e]=String(u):/current(month)?$/i.test(e)||/currentmonth/i.test(e)?d[e]=p:/current(year)?$/i.test(e)||/currentyear/i.test(e)?d[e]=String(g):/currentdate|current_date|current date|dateofrequest|requesteddate/i.test(e)&&(d[e]=j)}),A(d),x(!0)}catch(a){i.Ay.error("Failed to load document preview"),m([]),A({})}}else B(!0)})(e),children:(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",marginBottom:12},children:[(0,Y.jsx)(la.A,{style:{fontSize:24,color:"#1890ff",marginRight:12,marginTop:4}}),(0,Y.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,Y.jsx)(da,{strong:!0,style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.filename.replace(/\.docx$/i,"")}),(0,Y.jsxs)(da,{type:"secondary",style:{fontSize:12},children:[new Date(e.uploadDate).toLocaleDateString()," \xb7 ",Math.round(e.length/1024)," KB"]})]}),(0,Y.jsx)(Ue.A,{menu:{items:[{key:"view",icon:(0,Y.jsx)(Z.A,{}),label:"View"},{key:"download",icon:(0,Y.jsx)($.A,{}),label:"Download"},{key:"delete",icon:(0,Y.jsx)(Q.A,{}),label:"Delete"}]},trigger:["click"],children:(0,Y.jsx)(u.Ay,{type:"text",icon:(0,Y.jsx)(wn.A,{}),onClick:e=>e.stopPropagation()})})]})})},e._id))}),(0,Y.jsx)(ge.A,{open:p,onCancel:()=>x(!1),width:800,footer:null,children:0===h.length?(0,Y.jsx)(Jt.A,{description:"No fields found in this template"}):(0,Y.jsx)(dt.A,{layout:"vertical",initialValues:{fields:y},onFinish:async t=>{P(!0);try{var n,s;const r=(0,a.A)({},t.fields);Object.entries(r).forEach(e=>{let[t,n]=e;if(n&&"function"===typeof n.format)try{r[t]=n.format("MM/DD/YYYY")}catch(a){r[t]=String(n)}});const l={type:g,documentType:g,purpose:t.purpose,fileId:null===(n=e.find(e=>e.filename.replace(/\.docx$/i,"")===g))||void 0===n?void 0:n._id,fieldValues:r},o=await G.documentsAPI.requestDocument(l);i.Ay.success("Request submitted successfully!"),R((null===o||void 0===o||null===(s=o.documentRequest)||void 0===s?void 0:s._id)||(null===o||void 0===o?void 0:o._id)||null),x(!1)}catch(r){i.Ay.error("Failed to submit request.")}finally{P(!1)}},children:(0,Y.jsxs)(l.A,{gutter:[16,16],children:[(0,Y.jsx)(o.A,{span:24,children:(0,Y.jsx)(dt.A.Item,{name:"purpose",label:"Purpose",rules:[{required:!0,message:"Please enter the purpose"}],children:(0,Y.jsx)(c.A.TextArea,{rows:4,placeholder:"Enter the purpose of your request"})})}),h.map((e,t)=>(0,Y.jsx)(o.A,{xs:24,sm:12,children:(0,Y.jsx)(dt.A.Item,{name:["fields",e],label:e,rules:[{required:!0,message:"Please enter ".concat(e)}],children:/date|dob|birth|issued/i.test(e)?(0,Y.jsx)(An.A,{style:{width:"100%"},format:"MM/DD/YYYY"}):(0,Y.jsx)(c.A,{placeholder:"Enter ".concat(e)})})},t)),(0,Y.jsx)(o.A,{span:24,style:{textAlign:"right"},children:(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(u.Ay,{onClick:()=>x(!1),children:"Cancel"}),(0,Y.jsx)(u.Ay,{type:"primary",htmlType:"submit",loading:_,children:"Submit Request"})]})})]})})}),(0,Y.jsxs)(ge.A,{title:"Account Verification",open:q,onCancel:()=>B(!1),onOk:async()=>{if(L.length<1)return void i.Ay.warning("Please select at least one ID to upload");const e=new FormData;L.slice(0,2).forEach((t,n)=>e.append("ids",t.originFileObj||t));try{const a=await Promise.resolve().then(n.bind(n,31694)),s=await a.axiosInstance.post("/verification/upload",e,{headers:{"Content-Type":"multipart/form-data"}}),r=s&&s.data?s.data:null;i.Ay.success("Verification documents uploaded. Admin will review shortly."),B(!1),r&&r.verificationRequest&&(z(r.verificationRequest),E(!0));try{const{authService:e}=await Promise.resolve().then(n.bind(n,31694)),t=await e.getCurrentUser();t&&W&&W(t)}catch(t){}}catch(a){console.error("Upload error",a),i.Ay.error("Upload failed")}},okText:"Upload",width:600,children:[(0,Y.jsx)("p",{children:"Please upload up to two valid government IDs to verify your account. Admin will review and approve."}),(0,Y.jsx)(J.A,{multiple:!0,accept:"image/*,application/pdf",beforeUpload:()=>!1,fileList:L,onChange:e=>{let{fileList:t}=e;return O(t)},maxCount:2,children:(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(X.A,{}),children:"Select ID files (max 2)"})})]}),(0,Y.jsx)(ge.A,{title:"Verification Pending",open:F,onCancel:()=>E(!1),footer:[(0,Y.jsx)(u.Ay,{onClick:()=>E(!1),children:"Close"},"close"),(0,Y.jsx)(u.Ay,{danger:!0,onClick:async()=>{if(U&&U._id)try{const t=await Promise.resolve().then(n.bind(n,31694));await t.verificationAPI.cancelRequest(U._id),i.Ay.success("Verification request cancelled"),z(null),E(!1);try{const{authService:e}=await Promise.resolve().then(n.bind(n,31694)),t=await e.getCurrentUser();t&&W&&W(t)}catch(e){}}catch(t){console.error("Failed to cancel verification",t),i.Ay.error("Failed to cancel verification")}},children:"Cancel Verification"},"cancel")],width:600,children:U?(0,Y.jsxs)("div",{children:[(0,Y.jsx)("p",{children:"Your verification request is pending review by an administrator."}),(0,Y.jsxs)("p",{children:["Submitted: ",new Date(U.createdAt).toLocaleString()]}),Array.isArray(U.files)&&U.files.length>0?(0,Y.jsxs)("div",{children:[(0,Y.jsx)("p",{children:"Uploaded files:"}),(0,Y.jsx)("ul",{children:U.files.map((e,t)=>(0,Y.jsx)("li",{children:e},t))})]}):null,(0,Y.jsx)("p",{children:"You can cancel this request while it's pending. Cancelling will remove the request and delete the uploaded files."})]}):(0,Y.jsx)("p",{children:"No pending verification."})})]})};var ha=n(64376),ma=n(20691),pa=n(93795);const{TextArea:xa}=c.A,ga=[{label:"Requests",options:[{value:"DOCUMENT_REQUEST",label:"Document Request"},{value:"SCHEDULE_APPOINTMENT",label:"Schedule Appointment"},{value:"CERTIFICATE_REQUEST",label:"Certificate Request"}]},{label:"Concerns",options:[{value:"COMPLAINT",label:"Complaint"},{value:"ASSISTANCE",label:"Assistance"}]}],fa=()=>{const{user:e}=Pe(),[t,n]=(0,s.useState)(!1),[a,m]=(0,s.useState)(!1),[p]=dt.A.useForm(),[x,g]=s.useState(0),[f,y]=s.useState(0),j=100,v=500,[b,I]=s.useState(0),[S,C]=s.useState([]),[k,N]=s.useState(!1),[T,_]=s.useState(null),P="inquiryFormDraft_v1";s.useEffect(()=>{try{const e=localStorage.getItem(P);if(e){const t=JSON.parse(e);if(t){const{type:e,assignedRole:n,subject:a,message:s,attachments:i}=t;if(p.setFieldsValue({type:e,assignedRole:n,subject:a,message:s}),a&&g(a.length),s&&y(s.length),i&&Array.isArray(i)&&i.length){const e=i.map((e,t)=>({uid:"restored-".concat(t),name:e}));C(e),p.setFieldsValue({attachment:e})}a&&s&&(n||e)?I(2):i&&i.length?I(1):I(0)}}}catch(e){console.warn("Failed to load inquiry draft",e)}},[]),s.useEffect(()=>{const e=()=>{try{const e=p.getFieldsValue(!0),t={type:e.type||null,assignedRole:e.assignedRole||null,subject:e.subject||"",message:e.message||"",attachments:(S||[]).map(e=>e.name||e.originFileObj&&e.originFileObj.name||""),updatedAt:(new Date).toISOString()};localStorage.setItem(P,JSON.stringify(t))}catch(e){console.warn("Failed to save draft",e)}},t=setInterval(e,5e3),n=()=>e();return window.addEventListener("beforeunload",n),()=>{clearInterval(t),window.removeEventListener("beforeunload",n);try{const e=p.getFieldsValue(!0),t={type:e.type||null,assignedRole:e.assignedRole||null,subject:e.subject||"",message:e.message||"",attachments:(S||[]).map(e=>e.name||e.originFileObj&&e.originFileObj.name||""),updatedAt:(new Date).toISOString()};localStorage.setItem(P,JSON.stringify(t))}catch(e){}}},[S]);const D=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},R=async t=>{n(!0),m(!1);try{let n=[];t.attachment&&(Array.isArray(t.attachment)?n=t.attachment:t.attachment.fileList&&Array.isArray(t.attachment.fileList)&&(n=t.attachment.fileList));const a=new FormData;if(a.append("type",t.type||""),a.append("subject",t.subject||""),a.append("message",t.message||""),a.append("assignedRole",t.assignedRole||"staff"),a.append("username",(null===e||void 0===e?void 0:e.username)||""),a.append("barangayID",(null===e||void 0===e?void 0:e.barangayID)||""),t.assignedTo&&Array.isArray(t.assignedTo))for(const e of t.assignedTo)a.append("assignedTo[]",e);for(const e of n)e.originFileObj&&a.append("attachments",e.originFileObj,e.name||e.originFileObj&&e.originFileObj.name);await G.contactAPI.submitInquiry(a),m(!0),p.resetFields(),C([]),localStorage.removeItem(P),i.Ay.success("Your inquiry has been submitted!")}catch(a){console.error(a),i.Ay.error("Failed to submit inquiry.")}finally{n(!1)}},q=e=>{i.Ay.error("Please complete all required fields")};return(0,Y.jsx)("div",{style:{maxWidth:900,margin:"32px auto",padding:"0 12px"},children:(0,Y.jsxs)(r.A,{style:{borderRadius:18,boxShadow:"0 4px 24px 0 rgba(64,201,255,0.10)",padding:0,background:"#fff"},headStyle:{borderRadius:"18px 18px 0 0",background:"linear-gradient(90deg, rgba(64,169,255,0.08) 0%, rgba(146,84,222,0.06) 100%)",padding:"16px 24px"},bodyStyle:{padding:24},bordered:!1,title:(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,Y.jsx)(Et.A,{style:{fontSize:28,color:"#1890ff"}}),(0,Y.jsxs)("div",{style:{lineHeight:1},children:[(0,Y.jsx)(h.A.Title,{level:4,style:{margin:0,color:"#1890ff",fontWeight:700,fontFamily:"Poppins, Arial, sans-serif"},children:"Submit an Inquiry"}),(0,Y.jsx)("div",{style:{fontSize:12,color:"#6c757d",marginTop:4},children:"Fill out the form below and our staff will get back to you."})]})]}),children:[a&&(0,Y.jsx)(Dn.A,{type:"success",showIcon:!0,message:(0,Y.jsxs)("span",{style:{fontWeight:600},children:[(0,Y.jsx)("span",{role:"img","aria-label":"success",children:"\u2705"})," Your inquiry has been submitted!"]}),style:{marginBottom:16,borderRadius:8},banner:!0}),(0,Y.jsxs)(dt.A,{form:p,layout:"vertical",onFinish:R,onFinishFailed:q,autoComplete:"off",onFieldsChange:()=>a&&m(!1),onValuesChange:(e,t)=>{t&&t.attachment&&t.attachment.length>0?I(1):t&&t.message&&t.message.length>0&&I(0),t&&t.subject&&t.message&&(t.assignedRole||t.type)&&I(2)},children:[(0,Y.jsx)("div",{style:{marginBottom:16},children:(0,Y.jsxs)(ha.A,{current:b,size:"small",children:[(0,Y.jsx)(ha.A.Step,{title:"Details"}),(0,Y.jsx)(ha.A.Step,{title:"Attachments"}),(0,Y.jsx)(ha.A.Step,{title:"Review & Submit"})]})}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsxs)(o.A,{xs:24,sm:12,children:[(0,Y.jsx)(dt.A.Item,{name:"type",label:(0,Y.jsxs)("span",{children:["Inquiry Type ",(0,Y.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,Y.jsx)(A.A,{title:"Choose the category that best describes your issue.",children:(0,Y.jsx)(pa.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),rules:[{required:!0,message:"Please select an inquiry type"}],children:(0,Y.jsx)(d.A,{placeholder:"Select inquiry type",className:"inquiry-rounded-input",children:ga.map(e=>(0,Y.jsx)(d.A.OptGroup,{label:e.label,children:e.options.map(e=>(0,Y.jsx)(d.A.Option,{value:e.value,children:e.label},e.value))},e.label))})}),(0,Y.jsx)(dt.A.Item,{name:"assignedRole",label:(0,Y.jsxs)("span",{children:["Assign to Role ",(0,Y.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,Y.jsx)(A.A,{title:"Select which role should handle your inquiry.",children:(0,Y.jsx)(pa.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),initialValue:"staff",rules:[{required:!0,message:"Please select a role to assign"}],children:(0,Y.jsx)(d.A,{options:[{value:"staff",label:"Staff"},{value:"admin",label:"Admin"}],placeholder:"Assign to role",className:"inquiry-rounded-input"})}),(0,Y.jsx)(dt.A.Item,{name:"subject",label:(0,Y.jsxs)("span",{children:["Subject ",(0,Y.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,Y.jsx)(A.A,{title:"Enter a short subject line.",children:(0,Y.jsx)(pa.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),rules:[{required:!0,message:"Please enter a subject"},{min:5,message:"Subject must be at least 5 characters"},{max:j,message:"Subject must be at most ".concat(j," characters")}],children:(0,Y.jsxs)("div",{children:[(0,Y.jsx)(c.A,{placeholder:"Enter subject",className:"inquiry-rounded-input",maxLength:120,onChange:e=>g(e.target.value.length)}),(0,Y.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:6},children:(0,Y.jsxs)("small",{style:{color:x>j?"red":"#8c8c8c"},children:[x,"/",j]})})]})})]}),(0,Y.jsxs)(o.A,{xs:24,sm:12,children:[(0,Y.jsx)(dt.A.Item,{name:"message",label:(0,Y.jsxs)("span",{children:["Message ",(0,Y.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,Y.jsx)(A.A,{title:"Provide details about your inquiry.",children:(0,Y.jsx)(pa.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),rules:[{required:!0,message:"Please enter your message"},{min:10,message:"Message must be at least 10 characters"},{max:v,message:"Message must be at most ".concat(v," characters")}],children:(0,Y.jsxs)("div",{children:[(0,Y.jsx)(xa,{rows:4,placeholder:"Enter your message",className:"inquiry-rounded-input inquiry-large-textarea",maxLength:550,onChange:e=>y(e.target.value.length)}),(0,Y.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:6},children:(0,Y.jsxs)("small",{style:{color:f>v?"red":"#8c8c8c"},children:[f,"/",v]})})]})}),(0,Y.jsxs)(dt.A.Item,{name:"attachment",label:(0,Y.jsxs)("span",{children:["Attachments"," ",(0,Y.jsx)(A.A,{title:"Attach supporting documents (PDF, JPG, PNG).",children:(0,Y.jsx)(pa.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:e&&e.fileList,extra:"Allowed: PDF, JPG, PNG. Max 5MB each.",children:[(0,Y.jsxs)(J.A.Dragger,{multiple:!0,accept:".pdf,.jpg,.jpeg,.png",fileList:S,beforeUpload:()=>!1,onChange:e=>{const t=e.fileList||[],n=[];t.forEach(e=>{const t=e.originFileObj||e,a=["application/pdf","image/jpeg","image/png"].includes(t.type)||t.name&&/\.(pdf|jpe?g|png)$/i.test(t.name),s=(t.size||0)/1024/1024<5;if(a)if(s){if(t.type&&t.type.startsWith("image/")&&!e.url&&!e.preview)try{const n=URL.createObjectURL(t);e.preview=n}catch(r){}n.push(e)}else i.Ay.error("".concat(t.name," must be smaller than 5MB"));else i.Ay.error("".concat(t.name," is not a supported file type"))}),C(n),p.setFieldsValue({attachment:n})},onPreview:async e=>{const t=e,n=t.url||t.preview||t.originFileObj&&URL.createObjectURL(t.originFileObj);n&&window.open(n,"_blank")},showUploadList:!1,children:[(0,Y.jsx)("p",{className:"ant-upload-drag-icon",children:(0,Y.jsx)(X.A,{})}),(0,Y.jsx)("p",{className:"ant-upload-text",children:"Drag files here or click to upload"}),(0,Y.jsx)("p",{className:"ant-upload-hint",children:"Support for multiple files. Each must be PDF, JPG, or PNG, and under 5MB."})]}),S&&S.length>0&&(0,Y.jsx)("div",{style:{marginTop:12},children:S.map(e=>{const t=e.name||e.originFileObj&&e.originFileObj.name||"file",n=e.size||e.originFileObj&&e.originFileObj.size||0,a=e.type&&e.type.startsWith("image/")||/\.(jpe?g|png)$/i.test(t),s="application/pdf"===e.type||/\.pdf$/i.test(t);return(0,Y.jsxs)("div",{className:"inquiry-file-item",style:{display:"flex",alignItems:"center",gap:12,padding:"8px 12px",border:"1px solid #f0f0f0",borderRadius:8,marginBottom:8},children:[(0,Y.jsx)("div",{className:"inquiry-file-thumb",style:{width:48,height:48,display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa",borderRadius:6},children:a?(0,Y.jsx)("img",{src:e.preview||e.originFileObj&&URL.createObjectURL(e.originFileObj),alt:t,style:{maxWidth:44,maxHeight:44,borderRadius:4}}):s?(0,Y.jsx)("div",{style:{fontSize:20,color:"#ff4d4f"},children:"PDF"}):(0,Y.jsx)("div",{style:{fontSize:20},children:"FILE"})}),(0,Y.jsxs)("div",{style:{flex:1},children:[(0,Y.jsx)("div",{style:{fontWeight:600},children:t}),(0,Y.jsx)("div",{style:{color:"#8c8c8c",fontSize:12},children:D(n)})]}),(0,Y.jsxs)("div",{className:"inquiry-file-actions",style:{display:"flex",gap:8},children:[(0,Y.jsx)(u.Ay,{type:"link",onClick:()=>{const t=e.url||e.preview||e.originFileObj&&URL.createObjectURL(e.originFileObj);t&&window.open(t,"_blank")},children:"Preview"}),(0,Y.jsx)(u.Ay,{type:"link",danger:!0,onClick:()=>{const t=S.filter(t=>t.uid!==e.uid&&t.name!==e.name);C(t),p.setFieldsValue({attachment:t})},children:"Remove"})]})]},e.uid||e.name)})})]})]})]}),(0,Y.jsx)(dt.A.Item,{children:(0,Y.jsxs)(l.A,{justify:"end",gutter:[8,8],children:[(0,Y.jsx)(o.A,{xs:24,sm:"auto",style:{display:"flex",justifyContent:"flex-end"},children:(0,Y.jsx)(u.Ay,{type:"default",onClick:()=>{p.resetFields(),g(0),y(0),C([]),localStorage.removeItem(P)},block:!0,icon:(0,Y.jsx)(bn.A,{}),style:{borderRadius:8,minWidth:120},children:"Reset"})}),(0,Y.jsx)(o.A,{xs:24,sm:"auto",style:{display:"flex",justifyContent:"flex-end"},children:(0,Y.jsx)(u.Ay,{type:"primary",loading:t,className:"inquiry-gradient-btn",block:!0,icon:(0,Y.jsx)(w.A,{}),style:{borderRadius:8,fontWeight:600,fontSize:16,minWidth:160},onClick:async()=>{try{const e=await p.validateFields();_(e),N(!0)}catch(e){q()}},children:"Submit Inquiry"})})]})})]}),(0,Y.jsx)(ge.A,{title:"Review your inquiry",open:k,onCancel:()=>N(!1),footer:[(0,Y.jsx)(u.Ay,{onClick:()=>N(!1),children:"Edit"},"edit"),(0,Y.jsx)(u.Ay,{type:"primary",onClick:async()=>{N(!1),await R(T)},children:"Confirm & Submit"},"confirm")],children:T&&(0,Y.jsxs)(ma.A,{column:1,bordered:!0,children:[(0,Y.jsx)(ma.A.Item,{label:"Inquiry Type",children:T.type}),(0,Y.jsx)(ma.A.Item,{label:"Assign to Role",children:T.assignedRole}),(0,Y.jsx)(ma.A.Item,{label:"Subject",children:T.subject}),(0,Y.jsx)(ma.A.Item,{label:"Message",children:T.message}),(0,Y.jsx)(ma.A.Item,{label:"Attachments",children:(S||[]).map(e=>e.name||e.originFileObj&&e.originFileObj.name).join(", ")})]})})]})})},ya=()=>{const e=(0,pe.Zp)();return(0,Y.jsxs)("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#f4f6fa"},children:[(0,Y.jsx)("h1",{style:{color:"#722ed1",fontWeight:700,fontSize:32},children:"You have been logged out"}),(0,Y.jsx)("p",{style:{fontSize:18,margin:"16px 0 32px"},children:"Thank you for using the Barangay Information System."}),(0,Y.jsx)(u.Ay,{type:"primary",size:"large",onClick:()=>e("/login",{replace:!0}),children:"Log In Again"})]})},Aa=()=>{const{logout:e}=Pe(),t=(0,pe.Zp)();return(0,s.useEffect)(()=>{e(),t("/login",{replace:!0})},[e,t]),null};var ja=n(59977);const va=()=>{const[e,t]=(0,s.useState)(!1),[n,a]=(0,s.useState)([]),[i,r]=(0,s.useState)(null),[l,o]=(0,s.useState)(null),[c,m]=(0,s.useState)(null),x=(0,pe.Zp)();(0,s.useEffect)(()=>{(async()=>{t(!0);try{const e=await G.contactAPI.getAllInquiries();a(Array.isArray(e)?e:e&&e.items?e.items:[])}catch(e){console.error("Failed to load inquiries",e),Gt.Ay.error({message:"Failed to load inquiries"}),a([])}finally{t(!1)}})()},[]);const g=(0,s.useMemo)(()=>Array.from(new Set(n.map(e=>e.type||"General"))),[n]),y=(0,s.useMemo)(()=>(n||[]).filter(e=>{if(i&&(!e.status||e.status.toString().toLowerCase()!==i.toLowerCase()))return!1;const t=e.type||"General";if(l&&t.toString().toLowerCase()!==l.toString().toLowerCase())return!1;if(c&&c[0]&&c[1]&&e.createdAt)try{const t=c[0].toDate?c[0].toDate():new Date(c[0]),n=c[1].toDate?c[1].toDate():new Date(c[1]),a=new Date(e.createdAt);if(a<t||a>n)return!1}catch(n){}return!0}),[n,i,l,c]);return(0,Y.jsxs)("div",{children:[(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[(0,Y.jsx)(h.A.Title,{level:4,style:{margin:0},children:"Inquiry Tracker"}),(0,Y.jsxs)(h.A.Text,{type:"secondary",children:["Showing ",n.length," records"]})]}),(0,Y.jsxs)(p.A,{spinning:e,children:[(0,Y.jsx)("div",{style:{marginBottom:12,display:"flex",justifyContent:"flex-end"},children:(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsxs)(d.A,{allowClear:!0,placeholder:"Status",style:{width:160},value:null!==i&&void 0!==i?i:void 0,onChange:e=>r(e||null),children:[(0,Y.jsx)(d.A.Option,{value:"open",children:"Open"}),(0,Y.jsx)(d.A.Option,{value:"in-progress",children:"In Progress"}),(0,Y.jsx)(d.A.Option,{value:"resolved",children:"Resolved"})]}),(0,Y.jsx)(d.A,{allowClear:!0,placeholder:"Type",style:{width:180},value:null!==l&&void 0!==l?l:void 0,onChange:e=>o(e||null),children:g.map(e=>(0,Y.jsx)(d.A.Option,{value:e,children:e},e))}),(0,Y.jsx)(An.A.RangePicker,{onChange:e=>m(e?e.filter(Boolean):null)}),(0,Y.jsx)(u.Ay,{onClick:()=>{r(null),o(null),m(null)},children:"Reset"})]})}),0!==y.length||e?(0,Y.jsxs)(zt.A,{dataSource:y.slice().sort((e,t)=>(new Date(t.createdAt).getTime()||0)-(new Date(e.createdAt).getTime()||0)),rowKey:e=>e._id,pagination:{pageSize:12},onRow:e=>({onClick:()=>{x("/staff/inbox",{state:{openInquiryId:e._id}})}}),children:[(0,Y.jsx)(zt.A.Column,{title:"Name",dataIndex:"username",render:(e,t)=>e||t.residentName||t.subject||"Unknown"},"username"),(0,Y.jsx)(zt.A.Column,{title:"Type of Inquiry",dataIndex:"type",render:e=>e?String(e):"General"},"type"),(0,Y.jsx)(zt.A.Column,{title:"Status",dataIndex:"status",render:e=>(e=>{const t=(e||"").toString().toLowerCase();return(0,Y.jsx)(f.A,{color:{pending:"gold",open:"gold",approved:"success",resolved:"green",rejected:"error"}[t]||"default",children:(e||"").toUpperCase()||"UNKNOWN"})})(e)},"status"),(0,Y.jsx)(zt.A.Column,{title:"Date Inquired",dataIndex:"createdAt",render:e=>(0,ja.Y)(e)},"createdAt"),(0,Y.jsx)(zt.A.Column,{title:"Date Resolved",dataIndex:"updatedAt",render:(e,t)=>t.status&&"resolved"===t.status.toString().toLowerCase()?(0,ja.Y)(e):""},"updatedAt")]}):(0,Y.jsx)(Jt.A,{description:"No inquiries"})]})]})};var ba=n(74117);const wa=e=>{let{visible:t,onClose:n,onCreated:a,defaultBarangayID:r,defaultUsername:l,defaultEmail:o}=e;const[d]=dt.A.useForm(),[u,h]=s.useState(!1);s.useEffect(()=>{t?d.setFieldsValue({barangayID:r||void 0,username:l||void 0,email:o||void 0}):d.resetFields()},[t,r,l,o,d]);return(0,Y.jsx)(ge.A,{title:"Create Resident Info",visible:t,onOk:async()=>{try{const e=await d.validateFields();h(!0);const t={firstName:e.firstName,lastName:e.lastName,barangayID:r||e.barangayID||"",username:l||e.username||"",email:o||e.email||""},s=await G.axiosInstance.put("/resident/personal-info",t);i.Ay.success("Resident container created"),a(s.data),d.resetFields(),n()}catch(s){var e,t;console.error("Failed to create resident container",s),null!==s&&void 0!==s&&null!==(e=s.response)&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.message?i.Ay.error(s.response.data.message):i.Ay.error("Failed to create resident container")}finally{h(!1)}},onCancel:()=>{d.resetFields(),n()},confirmLoading:u,children:(0,Y.jsxs)(dt.A,{form:d,layout:"vertical",children:[(0,Y.jsx)(dt.A.Item,{name:"firstName",label:"First name",rules:[{required:!0,message:"First name is required"}],children:(0,Y.jsx)(c.A,{})}),(0,Y.jsx)(dt.A.Item,{name:"lastName",label:"Last name",rules:[{required:!0,message:"Last name is required"}],children:(0,Y.jsx)(c.A,{})}),(0,Y.jsx)(dt.A.Item,{name:"barangayID",label:"Barangay ID",children:(0,Y.jsx)(c.A,{disabled:!0})}),(0,Y.jsx)(dt.A.Item,{name:"username",label:"Username",children:(0,Y.jsx)(c.A,{disabled:!0})}),(0,Y.jsx)(dt.A.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Invalid email"}],children:(0,Y.jsx)(c.A,{disabled:!0})})]})})};function Ia(){const[e,t]=(0,s.useState)(null),[n,m]=(0,s.useState)(!1),[p,x]=(0,s.useState)(!1),{setUser:g}=Pe(),{t:f,i18n:y}=(0,ba.Bd)(),[A,j]=(0,s.useState)(null),[v,b]=(0,s.useState)([]),[w,I]=(0,s.useState)(!1),[S,C]=(0,s.useState)(null),[k,N]=(0,s.useState)(!1),[T,_]=(0,s.useState)(!1),[P,D]=(0,s.useState)(!1),[R,q]=(0,s.useState)(!1),[B,L]=(0,s.useState)(null),[O,U]=(0,s.useState)(null),[z,F]=(0,s.useState)("");(0,s.useEffect)(()=>{G.axiosInstance.get("/resident/profile").then(e=>{var n;if(j(e.data),C(e.data),null!==(n=e.data)&&void 0!==n&&n.profileImage){const n=e.data.profileImage.startsWith("http")?e.data.profileImage:"".concat(window.location.origin).concat(e.data.profileImage);t(n)}}),G.residentPersonalInfoAPI.getPersonalInfo().then(e=>{if(L(e),U(e),null!==e&&void 0!==e&&e.profileImage){const n=e.profileImage.startsWith("http")?e.profileImage:"".concat(window.location.origin).concat(e.profileImage);t(n)}}).catch(e=>{e.response&&404===e.response.status&&(m(!0),L(null),U({firstName:"",lastName:"",age:void 0,birthDate:"",dateOfResidency:"",sex:"",civilStatus:"",facebook:"",email:"",contactNumber:"",emergencyContact:"",landlineNumber:"",spouseName:"",spouseAge:void 0,spouseBirthDate:"",spouseOccupation:"",spouseStatus:"",motherName:"",motherAge:void 0,motherBirthDate:"",motherOccupation:"",motherStatus:"",fatherName:"",fatherAge:void 0,fatherBirthDate:"",fatherOccupation:"",fatherStatus:""}))}),G.axiosInstance.get("/resident/requests").then(e=>{b(e.data)})},[]),(0,s.useEffect)(()=>{const e=()=>{const e=(new Date).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/,/g,"");F(e)};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[]);const E=e=>{S&&C((0,a.A)((0,a.A)({},S),{},{[e.target.name]:e.target.value}))},M=e=>{O&&U((0,a.A)((0,a.A)({},O),{},{[e.target.name]:e.target.value}))};return(0,Y.jsxs)("div",{className:"max-w-3xl mx-auto p-6",children:[(0,Y.jsxs)(r.A,{style:{background:"linear-gradient(90deg, #f7f8fa 0%, #e0e7ff 100%)",borderRadius:16,boxShadow:"0 4px 24px #40c9ff22",marginBottom:32,border:"none",padding:0},styles:{body:{padding:"24px 32px",display:"flex",alignItems:"center",justifyContent:"space-between"}},variant:"outlined",children:[(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:18},children:[(0,Y.jsx)("div",{style:{width:96,height:96,borderRadius:12,overflow:"hidden",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},children:e?(0,Y.jsx)("img",{src:e,alt:"avatar",style:{width:96,height:96,objectFit:"cover"}}):(0,Y.jsx)(Qe,{user:(()=>{let e=A;if(!e)try{const t=localStorage.getItem("userProfile");t&&(e=JSON.parse(t))}catch(t){}return e})(),size:96})}),(0,Y.jsxs)("div",{children:[(0,Y.jsx)(h.A.Title,{level:3,style:{margin:0,fontWeight:800},children:(null===A||void 0===A?void 0:A.username)||(null===A||void 0===A?void 0:A.email)||"Resident"}),(0,Y.jsxs)(h.A.Text,{type:"secondary",children:["Barangay ID: ",(null===A||void 0===A?void 0:A.barangayID)||"N/A"]}),(0,Y.jsx)("div",{style:{marginTop:8},children:(0,Y.jsx)(h.A.Text,{type:"secondary",children:z})})]})]}),(0,Y.jsx)("div",{children:(0,Y.jsx)(J.A,{showUploadList:!1,accept:"image/*",customRequest:async e=>{let{file:n,onSuccess:a,onError:s}=e;try{await(async e=>{if(!e)return;const n=new FileReader;n.onload=e=>{var n;return t(null===(n=e.target)||void 0===n?void 0:n.result)},n.readAsDataURL(e);const a=new FormData;a.append("avatar",e);try{var s,r;const e=await G.axiosInstance.post("/resident/personal-info/avatar",a,{headers:{"Content-Type":"multipart/form-data"}}),n=null===(s=e.data)||void 0===s?void 0:s.resident,o=null===(r=e.data)||void 0===r?void 0:r.user;if(n){if(L(n),U(n),n.profileImage){const e=n.profileImage.startsWith("http")?n.profileImage:"".concat(window.location.origin).concat(n.profileImage);t(e)}m(!1),i.Ay.success("Profile image updated")}else i.Ay.success("Profile image updated");if(o){try{"function"===typeof g?g(o):localStorage.setItem("userProfile",JSON.stringify(o))}catch(l){}try{const e=new CustomEvent("userProfileUpdated",{detail:o});window.dispatchEvent(e)}catch(l){}}}catch(l){i.Ay.error("Failed to upload avatar")}})(n),"function"===typeof a&&a("ok")}catch(r){"function"===typeof s&&s(r)}},children:(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(X.A,{}),children:"Replace / Upload Profile Picture"})})})]}),n&&(0,Y.jsx)("div",{style:{marginBottom:16},children:(0,Y.jsx)(Dn.A,{message:"Your resident profile is incomplete",description:(0,Y.jsxs)("div",{children:[(0,Y.jsx)("p",{children:"We couldn't find your resident information. Please create your resident profile so you can upload documents and profile pictures."}),(0,Y.jsx)(u.Ay,{type:"primary",onClick:()=>x(!0),children:"Create Resident Info"})]}),showIcon:!0})}),(0,Y.jsx)(wa,{visible:p,onClose:()=>x(!1),onCreated:e=>{L(e),U(e),m(!1)},defaultBarangayID:(null===A||void 0===A?void 0:A.barangayID)||"",defaultUsername:(null===A||void 0===A?void 0:A.username)||"",defaultEmail:(null===A||void 0===A?void 0:A.email)||""}),(0,Y.jsx)(r.A,{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e3e6f3 40%, #f6f1f7 100%)",borderRadius:20,boxShadow:"0 8px 32px #bfc7d6cc",marginBottom:32,border:"none",backdropFilter:"blur(2px)"},styles:{body:{padding:40}},variant:"outlined",children:(0,Y.jsxs)("div",{style:{maxWidth:900,margin:"0 auto"},children:[(0,Y.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:24,letterSpacing:1,textAlign:"left",fontSize:28,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:f("userInformation")}),S&&(0,Y.jsxs)(dt.A,{layout:"vertical",children:[(0,Y.jsxs)(l.A,{gutter:24,children:[(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{label:f("username"),children:(0,Y.jsx)(c.A,{name:"username",value:S.username,onChange:E,disabled:!P})})}),(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{label:f("email"),children:(0,Y.jsx)(c.A,{name:"email",value:S.email,onChange:E,disabled:!P})})})]}),(0,Y.jsxs)(l.A,{gutter:24,children:[(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{label:f("address"),children:(0,Y.jsx)(c.A,{name:"address",value:S.address,onChange:E,disabled:!P})})}),(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{label:f("contactNumber"),children:(0,Y.jsx)(c.A,{name:"contactNumber",value:S.contactNumber,onChange:E,disabled:!P})})})]}),(0,Y.jsxs)(l.A,{gutter:24,children:[(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{label:f("barangayID")||"Barangay ID",children:(0,Y.jsx)(c.A,{name:"barangayID",value:S.barangayID,disabled:!0})})}),(0,Y.jsx)(o.A,{span:12,children:(0,Y.jsx)(dt.A.Item,{label:f("role")||"Role",children:(0,Y.jsx)(c.A,{name:"role",value:S.role,disabled:!0})})})]}),(0,Y.jsxs)(Oe.A,{style:{marginTop:24},children:[P?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(u.Ay,{type:"primary",onClick:async()=>{if(S)try{const e=(()=>{let e=S.firstName||"",t=S.lastName||"";if((!e||!t)&&A&&A.fullName){const n=A.fullName.trim().split(" ");e=e||n[0]||"",t=t||(n.length>1?n.slice(1).join(" "):"")}return e=e||(null===A||void 0===A?void 0:A.username)||(null===A||void 0===A?void 0:A.email)||"Resident",t=t||"User",{first:e,last:t}})(),t={firstName:e.first,lastName:e.last,barangayID:(null===S||void 0===S?void 0:S.barangayID)||(null===A||void 0===A?void 0:A.barangayID)||"",email:(null===S||void 0===S?void 0:S.email)||(null===A||void 0===A?void 0:A.email)||"",contactNumber:(null===S||void 0===S?void 0:S.contactNumber)||(null===A||void 0===A?void 0:A.contactNumber)||"",address:(null===S||void 0===S?void 0:S.address)||(null===A||void 0===A?void 0:A.address)||""},n=await G.axiosInstance.put("/resident/personal-info",t);n&&n.data?j((0,a.A)((0,a.A)({},A),n.data)):j((0,a.A)((0,a.A)({},A),t)),D(!1),i.Ay.success("Profile saved")}catch(e){if(console.error("Failed to save user info:",e),null!==e&&void 0!==e&&e.response&&e.response.data){const t=e.response.data;if(t.errors){const e=Object.values(t.errors).map(e=>e.toString()).join("; ");i.Ay.error(e||t.message||"Validation error")}else i.Ay.error(t.message||"Failed to save")}else i.Ay.error("Failed to save user info")}},style:{background:"linear-gradient(90deg, #43e97b 0%, #38f9d7 100%)",border:"none",fontWeight:600},children:"Save"}),(0,Y.jsx)(u.Ay,{onClick:()=>{D(!1),C(A)},children:"Cancel"})]}):(0,Y.jsx)(u.Ay,{onClick:()=>D(!0),style:{fontWeight:600},children:"Edit"}),(0,Y.jsx)(u.Ay,{type:"dashed",onClick:async()=>{_(!0);try{var e;const t=await G.axiosInstance.post("/resident/request-staff-access"),n=(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.message)||"Request sent to admin for staff access";!t||200!==t.status&&201!==t.status?i.Ay.info(n):(i.Ay.success(n),N(!0))}catch(a){var t,n;console.error("Request staff access failed:",a);const e=a,s=(null===e||void 0===e||null===(t=e.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||(null===e||void 0===e?void 0:e.message)||"Failed to send staff access request";i.Ay.error(s)}finally{_(!1)}},disabled:k||T,style:{color:"#341f97",borderColor:"#341f97",fontWeight:600},children:k?"Request Sent":"Request Staff Access"})]})]})]})}),O&&(0,Y.jsx)(r.A,{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e3e6f3 40%, #f6f1f7 100%)",borderRadius:20,boxShadow:"0 8px 32px #bfc7d6cc",marginBottom:32,border:"none",backdropFilter:"blur(2px)"},styles:{body:{padding:40}},variant:"outlined",children:(0,Y.jsxs)(dt.A,{layout:"vertical",style:{maxWidth:900,margin:"0 auto"},children:[(0,Y.jsx)(h.A.Title,{level:2,style:{fontWeight:900,marginBottom:24,letterSpacing:1,textAlign:"left",fontSize:34,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Resident Information"}),(0,Y.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Personal Information"}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"First Name",children:(0,Y.jsx)(c.A,{name:"firstName",value:O.firstName,onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Middle Name",children:(0,Y.jsx)(c.A,{name:"middleName",value:O.middleName||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Last Name",children:(0,Y.jsx)(c.A,{name:"lastName",value:O.lastName,onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Age",children:(0,Y.jsx)(c.A,{name:"age",type:"number",value:O.age||"",onChange:M,disabled:!R})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Birth Date",children:(0,Y.jsx)(c.A,{name:"birthDate",type:"date",value:O.birthDate||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Place of Birth",children:(0,Y.jsx)(c.A,{name:"placeOfBirth",value:O.placeOfBirth||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Nationality",children:(0,Y.jsx)(c.A,{name:"nationality",value:O.nationality||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Religion",children:(0,Y.jsx)(c.A,{name:"religion",value:O.religion||"",onChange:M,disabled:!R})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Date of Residency",children:(0,Y.jsx)(c.A,{name:"dateOfResidency",type:"date",value:O.dateOfResidency||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Sex",children:(0,Y.jsxs)(d.A,{value:O.sex||"",onChange:e=>U(t=>t?(0,a.A)((0,a.A)({},t),{},{sex:e}):t),disabled:!R,children:[(0,Y.jsx)(d.A.Option,{value:"",children:"Select"}),(0,Y.jsx)(d.A.Option,{value:"Male",children:"Male"}),(0,Y.jsx)(d.A.Option,{value:"Female",children:"Female"}),(0,Y.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Blood Type",children:(0,Y.jsx)(c.A,{name:"bloodType",value:O.bloodType||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Disability Status",children:(0,Y.jsx)(c.A,{name:"disabilityStatus",value:O.disabilityStatus||"",onChange:M,disabled:!R})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Passport Number",children:(0,Y.jsx)(c.A,{name:"passportNumber",value:O.passportNumber||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Government ID Number",children:(0,Y.jsx)(c.A,{name:"governmentIdNumber",value:O.governmentIdNumber||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Occupation",children:(0,Y.jsx)(c.A,{name:"occupation",value:O.occupation||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Educational Attainment",children:(0,Y.jsx)(c.A,{name:"educationalAttainment",value:O.educationalAttainment||"",onChange:M,disabled:!R})})})]}),(0,Y.jsx)(l.A,{gutter:16,children:(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Civil Status",children:(0,Y.jsxs)(d.A,{value:O.civilStatus||"",onChange:e=>U(t=>t?(0,a.A)((0,a.A)({},t),{},{civilStatus:e}):t),disabled:!R,children:[(0,Y.jsx)(d.A.Option,{value:"",children:"Select"}),(0,Y.jsx)(d.A.Option,{value:"Single",children:"Single"}),(0,Y.jsx)(d.A.Option,{value:"Married",children:"Married"}),(0,Y.jsx)(d.A.Option,{value:"Widowed",children:"Widowed"}),(0,Y.jsx)(d.A.Option,{value:"Divorced",children:"Divorced"}),(0,Y.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,Y.jsx)(d.A.Option,{value:"Annulled",children:"Annulled"}),(0,Y.jsx)(d.A.Option,{value:"Domestic Partnership",children:"Domestic Partnership"}),(0,Y.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})})}),(0,Y.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Social Media Information"}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Facebook",children:(0,Y.jsx)(c.A,{name:"facebook",value:O.facebook||"",onChange:M,disabled:!R,placeholder:"Facebook profile/link"})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Valid Email",children:(0,Y.jsx)(c.A,{name:"email",type:"email",value:O.email||"",onChange:M,disabled:!R,placeholder:"Email address"})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Contact Number",children:(0,Y.jsx)(c.A,{name:"contactNumber",type:"number",value:O.contactNumber||"",onChange:M,disabled:!R,placeholder:"Contact No."})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Emergency Contact",children:(0,Y.jsx)(c.A,{name:"emergencyContact",type:"number",value:O.emergencyContact||"",onChange:M,disabled:!R,placeholder:"Emergency contact number"})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Landline Number",children:(0,Y.jsx)(c.A,{name:"landlineNumber",type:"number",value:O.landlineNumber||"",onChange:M,disabled:!R,placeholder:"Landline number"})})})]}),(0,Y.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Family Information"}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Spouse Name",children:(0,Y.jsx)(c.A,{name:"spouseName",value:O.spouseName||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Spouse Middle Name",children:(0,Y.jsx)(c.A,{name:"spouseMiddleName",value:O.spouseMiddleName||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Spouse Last Name",children:(0,Y.jsx)(c.A,{name:"spouseLastName",value:O.spouseLastName||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Spouse Age",children:(0,Y.jsx)(c.A,{name:"spouseAge",type:"number",value:O.spouseAge||"",onChange:M,disabled:!R})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Spouse Birthdate",children:(0,Y.jsx)(c.A,{name:"spouseBirthDate",type:"date",value:O.spouseBirthDate||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Spouse Nationality",children:(0,Y.jsx)(c.A,{name:"spouseNationality",value:O.spouseNationality||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Spouse Occupation",children:(0,Y.jsx)(c.A,{name:"spouseOccupation",value:O.spouseOccupation||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Spouse Contact Number",children:(0,Y.jsx)(c.A,{name:"spouseContactNumber",value:O.spouseContactNumber||"",onChange:M,disabled:!R})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Spouse Status",children:(0,Y.jsxs)(d.A,{value:O.spouseStatus||"",onChange:e=>U(t=>t?(0,a.A)((0,a.A)({},t),{},{spouseStatus:e}):t),disabled:!R,children:[(0,Y.jsx)(d.A.Option,{value:"",children:"Select status"}),(0,Y.jsx)(d.A.Option,{value:"Alive",children:"Alive"}),(0,Y.jsx)(d.A.Option,{value:"Deceased",children:"Deceased"}),(0,Y.jsx)(d.A.Option,{value:"Unknown",children:"Unknown"}),(0,Y.jsx)(d.A.Option,{value:"Missing",children:"Missing"}),(0,Y.jsx)(d.A.Option,{value:"Abroad",children:"Abroad"}),(0,Y.jsx)(d.A.Option,{value:"With Family",children:"With Family"}),(0,Y.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,Y.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Number of Children",children:(0,Y.jsx)(c.A,{name:"numberOfChildren",type:"number",value:O.numberOfChildren||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Children's Names",children:(0,Y.jsx)(c.A,{name:"childrenNames",value:O.childrenNames||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Children's Ages",children:(0,Y.jsx)(c.A,{name:"childrenAges",value:O.childrenAges||"",onChange:M,disabled:!R})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Emergency Contact Name",children:(0,Y.jsx)(c.A,{name:"emergencyContactName",value:O.emergencyContactName||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:6,children:(0,Y.jsx)(dt.A.Item,{label:"Emergency Contact Relationship",children:(0,Y.jsx)(c.A,{name:"emergencyContactRelationship",value:O.emergencyContactRelationship||"",onChange:M,disabled:!R})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Mother's Name",children:(0,Y.jsx)(c.A,{name:"motherName",value:O.motherName||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Mother's Age",children:(0,Y.jsx)(c.A,{name:"motherAge",type:"number",value:O.motherAge||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Mother's Birthdate",children:(0,Y.jsx)(c.A,{name:"motherBirthDate",type:"date",value:O.motherBirthDate||"",onChange:M,disabled:!R})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Mother's Occupation",children:(0,Y.jsx)(c.A,{name:"motherOccupation",value:O.motherOccupation||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Mother's Status",children:(0,Y.jsxs)(d.A,{value:O.motherStatus||"",onChange:e=>U(t=>t?(0,a.A)((0,a.A)({},t),{},{motherStatus:e}):t),disabled:!R,children:[(0,Y.jsx)(d.A.Option,{value:"",children:"Select status"}),(0,Y.jsx)(d.A.Option,{value:"Alive",children:"Alive"}),(0,Y.jsx)(d.A.Option,{value:"Deceased",children:"Deceased"}),(0,Y.jsx)(d.A.Option,{value:"Unknown",children:"Unknown"}),(0,Y.jsx)(d.A.Option,{value:"Missing",children:"Missing"}),(0,Y.jsx)(d.A.Option,{value:"Abroad",children:"Abroad"}),(0,Y.jsx)(d.A.Option,{value:"With Family",children:"With Family"}),(0,Y.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,Y.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Father's Name",children:(0,Y.jsx)(c.A,{name:"fatherName",value:O.fatherName||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Father's Age",children:(0,Y.jsx)(c.A,{name:"fatherAge",type:"number",value:O.fatherAge||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Father's Birthdate",children:(0,Y.jsx)(c.A,{name:"fatherBirthDate",type:"date",value:O.fatherBirthDate||"",onChange:M,disabled:!R})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Father's Occupation",children:(0,Y.jsx)(c.A,{name:"fatherOccupation",value:O.fatherOccupation||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Father's Status",children:(0,Y.jsxs)(d.A,{value:O.fatherStatus||"",onChange:e=>U(t=>t?(0,a.A)((0,a.A)({},t),{},{fatherStatus:e}):t),disabled:!R,children:[(0,Y.jsx)(d.A.Option,{value:"",children:"Select status"}),(0,Y.jsx)(d.A.Option,{value:"Alive",children:"Alive"}),(0,Y.jsx)(d.A.Option,{value:"Deceased",children:"Deceased"}),(0,Y.jsx)(d.A.Option,{value:"Unknown",children:"Unknown"}),(0,Y.jsx)(d.A.Option,{value:"Missing",children:"Missing"}),(0,Y.jsx)(d.A.Option,{value:"Abroad",children:"Abroad"}),(0,Y.jsx)(d.A.Option,{value:"With Family",children:"With Family"}),(0,Y.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,Y.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})})]}),(0,Y.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Business Information"}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Business Name",children:(0,Y.jsx)(c.A,{name:"businessName",value:O.businessName||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Business Type",children:(0,Y.jsxs)(d.A,{value:O.businessType||"",onChange:e=>U(t=>t?(0,a.A)((0,a.A)({},t),{},{businessType:e}):t),disabled:!R,children:[(0,Y.jsx)(d.A.Option,{value:"",children:"Select"}),(0,Y.jsx)(d.A.Option,{value:"Sole Proprietorship",children:"Sole Proprietorship"}),(0,Y.jsx)(d.A.Option,{value:"Partnership",children:"Partnership"}),(0,Y.jsx)(d.A.Option,{value:"Corporation",children:"Corporation"}),(0,Y.jsx)(d.A.Option,{value:"Cooperative",children:"Cooperative"}),(0,Y.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Nature of Business",children:(0,Y.jsx)(c.A,{name:"natureOfBusiness",value:O.natureOfBusiness||"",onChange:M,disabled:!R})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Business Address",children:(0,Y.jsx)(c.A,{name:"businessAddress",value:O.businessAddress||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Date Established",children:(0,Y.jsx)(c.A,{name:"dateEstablished",type:"date",value:O.dateEstablished||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"TIN",children:(0,Y.jsx)(c.A,{name:"tin",value:O.tin||"",onChange:M,disabled:!R})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"DTI/SEC/CDA Registration No.",children:(0,Y.jsx)(c.A,{name:"registrationNumber",value:O.registrationNumber||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Business Permit No.",children:(0,Y.jsx)(c.A,{name:"businessPermitNumber",value:O.businessPermitNumber||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Barangay Clearance No.",children:(0,Y.jsx)(c.A,{name:"barangayClearanceNumber",value:O.barangayClearanceNumber||"",onChange:M,disabled:!R})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Number of Employees",children:(0,Y.jsx)(c.A,{name:"numberOfEmployees",type:"number",value:O.numberOfEmployees||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Capital Investment",children:(0,Y.jsx)(c.A,{name:"capitalInvestment",type:"number",value:O.capitalInvestment||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Annual Gross Income",children:(0,Y.jsx)(c.A,{name:"annualGrossIncome",type:"number",value:O.annualGrossIncome||"",onChange:M,disabled:!R})})})]}),(0,Y.jsxs)(l.A,{gutter:16,children:[(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Contact Person",children:(0,Y.jsx)(c.A,{name:"businessContactPerson",value:O.businessContactPerson||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Contact Number",children:(0,Y.jsx)(c.A,{name:"businessContactNumber",value:O.businessContactNumber||"",onChange:M,disabled:!R})})}),(0,Y.jsx)(o.A,{span:8,children:(0,Y.jsx)(dt.A.Item,{label:"Email Address",children:(0,Y.jsx)(c.A,{name:"businessEmail",type:"email",value:O.businessEmail||"",onChange:M,disabled:!R})})})]}),(0,Y.jsx)("div",{style:{display:"flex",gap:8,marginTop:16},children:R?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(u.Ay,{type:"primary",onClick:async()=>{O&&null!==A&&void 0!==A&&A._id&&(await G.residentPersonalInfoAPI.updatePersonalInfo((0,a.A)((0,a.A)({},O),{},{userId:A._id})),L(O),q(!1))},style:{fontWeight:600},children:"Save"}),(0,Y.jsx)(u.Ay,{onClick:()=>{q(!1),U(B)},children:"Cancel"})]}):(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(u.Ay,{onClick:()=>q(!0),style:{fontWeight:600,marginRight:8},children:"Edit"}),B&&B.barangayID?(0,Y.jsx)(u.Ay,{type:"primary",disabled:!0,style:{fontWeight:600,background:"#b2bec3",border:"none"},children:"Registered"}):(0,Y.jsx)(u.Ay,{type:"primary",style:{fontWeight:600},onClick:async()=>{try{const e=(0,a.A)({barangayID:(null===S||void 0===S?void 0:S.barangayID)||"",username:(null===S||void 0===S?void 0:S.username)||""},O);await G.axiosInstance.post("/resident",e),alert("Resident registered successfully!")}catch(e){alert("Failed to register resident.")}},children:"Register"})]})})]})})]})}const Sa=()=>(0,Y.jsx)("div",{className:"landing-bg",style:{minHeight:"100vh",background:"linear-gradient(135deg, #40c9ff 0%, #e81cff 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif"},children:(0,Y.jsxs)("div",{className:"floating-box",style:{background:"rgba(255,255,255,0.95)",boxShadow:"0 8px 32px 0 rgba(64,201,255,0.15)",borderRadius:24,padding:"48px 32px",textAlign:"center",maxWidth:420,width:"100%",animation:"float 2s infinite ease-in-out alternate",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,Y.jsx)("img",{src:"".concat("","/logo-parian2.png"),alt:"Barangay Logo",style:{width:80,marginBottom:24}}),(0,Y.jsxs)("h1",{className:"responsive-system-title",style:{fontSize:"1.7rem",marginBottom:24,fontWeight:800,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",letterSpacing:1,maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"pre-line",wordBreak:"break-word",textAlign:"center"},children:["Welcome to",(0,Y.jsx)("br",{}),"Barangay Information Management System",(0,Y.jsx)("br",{}),"Parian"]}),(0,Y.jsx)("button",{className:"get-started-btn",style:{background:"linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",color:"#fff",border:"none",borderRadius:8,padding:"14px 40px",fontSize:"1.15rem",fontWeight:700,cursor:"pointer",boxShadow:"0 2px 8px #e81cff44",marginTop:8,transition:"background 0.2s"},onClick:()=>window.location.href="/login",onMouseOver:e=>e.currentTarget.style.background="linear-gradient(90deg, #40c9ff 0%, #e81cff 100%)",onMouseOut:e=>e.currentTarget.style.background="linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",children:"Get Started"})]})});var Ca=n(96603);const ka=()=>{const[e,t]=(0,s.useState)(!1),[n,a]=(0,s.useState)(!1),[i,l]=(0,s.useState)("link"),[o,d]=(0,s.useState)(null),[m,p]=(0,s.useState)(""),[x,g]=(0,s.useState)(!1),f=(0,pe.Zp)();return(0,Y.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:24},children:(0,Y.jsxs)(r.A,{style:{width:420,borderRadius:12},children:[(0,Y.jsx)(h.A.Title,{level:3,style:{textAlign:"center"},children:"Forgot Password"}),n?(0,Y.jsx)("div",{children:"otp"===i?(0,Y.jsxs)("div",{children:[(0,Y.jsxs)(h.A.Paragraph,{children:["Enter the 6-digit code sent to ",(0,Y.jsx)("strong",{children:o})]}),(0,Y.jsx)("div",{style:{display:"flex",justifyContent:"center",marginBottom:12},children:Array.from({length:6}).map((e,t)=>(0,Y.jsx)("div",{style:{width:40,height:48,margin:4,border:"1px solid #ddd",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18},children:m[t]||""},t))}),(0,Y.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:8,maxWidth:300,margin:"0 auto 12px"},children:[["1","2","3","4","5","6","7","8","9","0"].map(e=>(0,Y.jsx)(u.Ay,{onClick:()=>(e=>{m.length>=6||p(t=>t+e)})(e),disabled:x,children:e},e)),(0,Y.jsx)(u.Ay,{onClick:()=>p(e=>e.slice(0,-1)),disabled:x,children:"\u232b"}),(0,Y.jsx)(u.Ay,{onClick:()=>p(""),disabled:x,children:"Clear"}),(0,Y.jsx)(u.Ay,{type:"primary",onClick:async()=>{if(6===m.length){g(!0);try{var e;const t={token:m};o&&(t.email=o);const n=await G.axiosPublic.post("/auth/verify-otp",t);Gt.Ay.success({message:"If valid",description:(null===(e=n.data)||void 0===e?void 0:e.message)||"Check your email for the new temporary password."}),p(""),a(!1),d(null),f("/login")}catch(s){var t,n;const e=(null===s||void 0===s||null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||s.message||"Failed to verify code";Gt.Ay.error({message:"Error",description:e})}finally{g(!1)}}else Gt.Ay.error({message:"Enter code",description:"Please enter the 6-digit code."})},loading:x,disabled:x,children:"Verify"})]}),(0,Y.jsx)(u.Ay,{type:"link",block:!0,onClick:()=>{a(!1),d(null)},children:"Back"})]}):(0,Y.jsxs)("div",{children:[(0,Y.jsx)(h.A.Paragraph,{children:"Check your email for password reset instructions."}),(0,Y.jsx)(u.Ay,{type:"primary",block:!0,onClick:()=>f("/login"),children:"Back to login"})]})}):(0,Y.jsxs)(dt.A,{layout:"vertical",onFinish:async e=>{t(!0);try{var n;const t=await G.axiosPublic.post("/auth/forgot-password",{email:e.email,mode:i});Gt.Ay.success({message:"Request sent",description:(null===(n=t.data)||void 0===n?void 0:n.message)||"Check your email for instructions."}),a(!0),d(e.email)}catch(l){var s,r;const e=(null===l||void 0===l||null===(s=l.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||l.message||"Failed to send reset email";Gt.Ay.error({message:"Error",description:e})}finally{t(!1)}},requiredMark:!1,children:[(0,Y.jsx)(dt.A.Item,{label:"Choose how to receive reset instructions",children:(0,Y.jsxs)(Ca.Ay.Group,{value:i,onChange:e=>l(e.target.value),children:[(0,Y.jsx)(Ca.Ay,{value:"link",children:"Send reset link (email)"}),(0,Y.jsx)(Ca.Ay,{value:"otp",children:"Send 6-digit code (email)"})]})}),(0,Y.jsx)(dt.A.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Please input your email"},{type:"email",message:"Please enter a valid email"}],children:(0,Y.jsx)(c.A,{placeholder:"you@example.com",size:"large"})}),(0,Y.jsx)(dt.A.Item,{children:(0,Y.jsx)(u.Ay,{type:"primary",htmlType:"submit",block:!0,loading:e,children:e?"Sending...":"otp"===i?"Send code":"Send reset link"})}),(0,Y.jsx)(u.Ay,{type:"link",block:!0,onClick:()=>f("/login"),children:"Back to login"})]})]})})};var Na=n(57692);const Ta=()=>{const{token:e}=(0,pe.g)(),t=(0,pe.Zp)(),n=(0,pe.zy)(),a=new URLSearchParams(n.search).get("mode"),[i,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null),[m,p]=(0,s.useState)("");return(0,Y.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:24},children:(0,Y.jsxs)(r.A,{style:{width:420,borderRadius:12},children:[(0,Y.jsx)(h.A.Title,{level:3,style:{textAlign:"center"},children:"Reset Password"}),(0,Y.jsxs)(dt.A,{layout:"vertical",onFinish:async n=>{if(n.password!==n.confirm)return void Gt.Ay.error({message:"Passwords do not match"});if(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}$/.test(n.password)){l(!0);try{var s;let i;if(e)i=await G.axiosPublic.post("/auth/reset-password/".concat(e),{password:n.password});else if("otp"===a){if(!n.code)return Gt.Ay.error({message:"Please enter the 6-digit code sent to your email"}),void l(!1);i=await G.axiosPublic.post("/auth/reset-password",{token:n.code,password:n.password})}else i=await G.axiosPublic.post("/auth/reset-password",{token:n.code||"",password:n.password});Gt.Ay.success({message:"Password reset",description:(null===(s=i.data)||void 0===s?void 0:s.message)||"Your password has been reset. Please log in."}),t("/login")}catch(o){var i,r;const e=(null===o||void 0===o||null===(i=o.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.message)||o.message||"Failed to reset password";Gt.Ay.error({message:"Error",description:e})}finally{l(!1)}}else Gt.Ay.error({message:"Password does not meet complexity requirements. Use 8+ chars, mixed case, numbers and symbols."})},requiredMark:!1,children:["otp"===a&&!e&&(0,Y.jsx)(dt.A.Item,{label:"6-digit code",name:"code",rules:[{required:!0,message:"Please input the 6-digit code sent to your email"},{len:6,message:"Code must be 6 digits"}],children:(0,Y.jsx)(c.A,{placeholder:"123456",size:"large"})}),(0,Y.jsx)(dt.A.Item,{label:"New password",name:"password",rules:[{required:!0,message:"Please input your new password"},{min:6,message:"Password must be at least 6 characters"}],children:(0,Y.jsx)(c.A.Password,{size:"large",onChange:e=>(e=>{if(!e)return d(null),void p("");let t=0;e.length>=8&&(t+=2),/[A-Z]/.test(e)&&(t+=1),/[a-z]/.test(e)&&(t+=1),/\d/.test(e)&&(t+=1),/[^A-Za-z0-9]/.test(e)&&(t+=1);const n=Math.min(4,Math.floor(t/6*5));d(20*n),p(["Very weak","Weak","Fair","Good","Strong"][n]||"")})(e.target.value)})}),null!==o&&(0,Y.jsxs)("div",{style:{marginBottom:12},children:[(0,Y.jsx)(Na.A,{percent:o,size:"small",status:o<40?"exception":"normal"}),(0,Y.jsx)("div",{style:{textAlign:"right",fontSize:12,color:"#666"},children:m})]}),(0,Y.jsx)(dt.A.Item,{label:"Confirm password",name:"confirm",rules:[{required:!0,message:"Please confirm your new password"}],children:(0,Y.jsx)(c.A.Password,{size:"large"})}),(0,Y.jsx)(dt.A.Item,{children:(0,Y.jsx)(u.Ay,{type:"primary",htmlType:"submit",block:!0,loading:i,children:i?"Resetting...":"Reset password"})})]})]})})};var _a=n(8295);const{Title:Pa,Text:Da}=h.A,Ra=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!1),i=(0,pe.Zp)(),l=async()=>{a(!0);try{const e=await(0,G.getInbox)(),n=e&&e.data?e.data:[];t(Array.isArray(n)?n:[])}catch(e){console.error("Failed to fetch inbox messages",e),t([])}finally{a(!1)}};(0,s.useEffect)(()=>{l()},[]);return(0,Y.jsx)(p.A,{spinning:n,children:(0,Y.jsxs)("div",{style:{padding:24,backgroundColor:"#f0f2f5",minHeight:"100vh"},children:[(0,Y.jsxs)(Oe.A,{style:{marginBottom:24},children:[(0,Y.jsx)(u.Ay,{type:"default",icon:(0,Y.jsx)(_a.A,{}),onClick:()=>i("/admin/dashboard"),children:"Back to Dashboard"}),(0,Y.jsx)(Pa,{level:4,style:{marginBottom:0},children:"Message Inbox"})]}),(0,Y.jsx)(r.A,{children:(0,Y.jsx)(g.A,{dataSource:Array.isArray(e)?e:[],renderItem:e=>(0,Y.jsx)(g.A.Item,{actions:["unread"===e.status&&(0,Y.jsx)(u.Ay,{size:"small",icon:(0,Y.jsx)(an.A,{}),onClick:()=>(async e=>{if(e._id&&"read"!==e.status){a(!0);try{await G.axiosInstance.patch("/messages/".concat(e._id,"/read")),await l()}catch(t){}finally{a(!1)}}})(e),children:"Mark Read"})].filter(Boolean),children:(0,Y.jsx)(g.A.Item.Meta,{avatar:(0,Y.jsx)(y.A,{icon:(0,Y.jsx)(on.A,{}),style:{backgroundColor:"read"===e.status?"#8c8c8c":"#1890ff"}}),title:(0,Y.jsx)(Da,{strong:!0,children:e.subject}),description:(0,Y.jsxs)("div",{children:[(0,Y.jsx)(Da,{type:"secondary",children:new Date(e.createdAt).toLocaleString()}),"New Verification Request"===e.subject&&(0,Y.jsxs)("div",{style:{marginTop:8},children:[(0,Y.jsx)(Da,{strong:!0,children:"Verification request submitted."}),(0,Y.jsx)("div",{children:e.body})]})]})})}),locale:{emptyText:"No notifications"}})})]})})},qa="DocumentHistory_wrapper__KIqBy",Ba="DocumentHistory_title__UmSIq",La="DocumentHistory_cardList__yg+X2",Oa="DocumentHistory_card__XzJRq",Ua="DocumentHistory_cardRow__guh8i",za="DocumentHistory_cardCol__Pu-Rr",Fa="DocumentHistory_cardLabel__525-6",Ea="DocumentHistory_cardValue__sdvX8",Ma="DocumentHistory_rejected__tS2s+",Wa="DocumentHistory_completed__7G7DO",Ya=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!0),[i,l]=(0,s.useState)(!1);return(0,s.useEffect)(()=>{const e=()=>l(window.innerWidth<=720);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{let e=!0;return(async()=>{a(!0);try{const n=await G.documentsAPI.getDocumentRecords();e&&t(Array.isArray(n)?n:[])}catch(n){console.error("Failed to load document history",n),e&&t([])}finally{e&&a(!1)}})(),()=>{e=!1}},[]),(0,Y.jsxs)("div",{className:qa,children:[(0,Y.jsx)(h.A.Title,{level:3,className:Ba,children:"Document History"}),n?(0,Y.jsx)(p.A,{}):i?(0,Y.jsx)("div",{className:La,children:e.map(e=>(0,Y.jsxs)(r.A,{className:Oa,children:[(0,Y.jsxs)("div",{className:Ua,children:[(0,Y.jsxs)("div",{className:za,children:[(0,Y.jsx)("div",{className:Fa,children:"Requester"}),(0,Y.jsx)("div",{className:Ea,children:e.username||"Unknown"})]}),(0,Y.jsxs)("div",{className:za,children:[(0,Y.jsx)("div",{className:Fa,children:"Type"}),(0,Y.jsx)("div",{className:Ea,children:e.type||"Unknown"})]})]}),(0,Y.jsxs)("div",{className:Ua,children:[(0,Y.jsxs)("div",{className:za,children:[(0,Y.jsx)("div",{className:Fa,children:"Txn ID"}),(0,Y.jsx)("div",{className:Ea,children:e.transactionCode||"\u2014"})]}),(0,Y.jsxs)("div",{className:za,children:[(0,Y.jsx)("div",{className:Fa,children:"Date Approved"}),(0,Y.jsx)("div",{className:Ea,children:e.completedAt||e.dateApproved||e.approvedAt?(0,ja.Y)(e.completedAt||e.dateApproved||e.approvedAt):"\u2014"})]})]}),(0,Y.jsx)("div",{style:{marginTop:8},children:e.status&&"rejected"===e.status.toString().toLowerCase()?(0,Y.jsx)("div",{className:Ma,children:"Rejected"}):(0,Y.jsx)("div",{className:Wa,children:"Completed"})})]},e._id))}):(0,Y.jsx)(zt.A,{dataSource:e,rowKey:"_id",pagination:{pageSize:8},columns:[{title:"Requester Name",dataIndex:"username",key:"username",render:e=>e||"Unknown"},{title:"Transactional ID",dataIndex:"transactionCode",key:"transactionCode",render:e=>e||"\u2014"},{title:"Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Date Approved",dataIndex:"completedAt",key:"completedAt",render:(e,t)=>{const n=e||t.dateApproved||t.completedAt||t.approvedAt||null;if(!n)return"\u2014";try{return(0,ja.Y)(n)}catch(a){return String(n)}}},{title:"Status",dataIndex:"status",key:"status",render:(e,t)=>{var n,a,s;const i=(null===(n=t.processedBy)||void 0===n?void 0:n.fullName)||(null===(a=t.processedBy)||void 0===a?void 0:a.username)||"Unknown",r=(null===(s=t.processedBy)||void 0===s?void 0:s.barangayID)||"Unknown";return e&&"rejected"===e.toLowerCase()?(0,Y.jsxs)("span",{style:{color:"#FF3B3B",fontWeight:600},children:["Rejected by: ",i," (",r,")"]}):!e||"completed"!==e.toLowerCase()&&"approved"!==e.toLowerCase()?(0,Y.jsx)("span",{children:e}):(0,Y.jsxs)("span",{style:{color:"#43D96B",fontWeight:600},children:["Completed by: ",i," (",r,")"]})}}]})]})};var Ha=n(27783),Va=n(75207);const{TextArea:Ga}=c.A,Ka=()=>{const[e,t]=(0,s.useState)(""),[n,a]=(0,s.useState)(null),[l,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)([]),[m,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(null),[y,j]=(0,s.useState)(null),[v,b]=(0,s.useState)(""),[w,I]=(0,s.useState)(null),{user:S}=Pe(),C=async()=>{if(!S||"admin"!==S.role)return;if(localStorage.getItem("token")){p(!0);try{const e=await G.adminAPI.listAdminAnnouncements();c(Array.isArray(e)?e:[])}catch(t){var e;401===(null===t||void 0===t||null===(e=t.response)||void 0===e?void 0:e.status)?i.Ay.error("Not authorized. Please sign in as an admin."):(console.error("Failed to load announcements",t),i.Ay.error("Failed to load announcements"))}finally{p(!1)}}};(0,s.useEffect)(()=>{"admin"===(null===S||void 0===S?void 0:S.role)&&C()},[S]);const k=()=>a(null);return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(r.A,{title:(0,Y.jsx)(h.A.Title,{level:4,style:{margin:0},children:"admin"===(null===S||void 0===S?void 0:S.role)?"Post Announcement":"Announcements"}),children:(0,Y.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:["admin"===(null===S||void 0===S?void 0:S.role)&&(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(Ga,{value:e,onChange:e=>t(e.target.value),rows:6,placeholder:"Write your announcement here"}),(0,Y.jsx)(J.A,{beforeUpload:e=>e.type.startsWith("image/")?(a(e),J.A.LIST_IGNORE):(i.Ay.error("Only image files are allowed"),J.A.LIST_IGNORE),onRemove:k,accept:"image/*",maxCount:1,showUploadList:{showPreviewIcon:!1},children:(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(X.A,{}),children:"Upload Image (optional)"})}),n&&(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,color:"#237804"},children:[(0,Y.jsx)(an.A,{style:{color:"#52c41a"}}),(0,Y.jsx)("span",{style:{fontWeight:600},children:"Image uploaded:"}),(0,Y.jsx)("span",{style:{marginLeft:6},children:n.name}),(0,Y.jsx)(u.Ay,{type:"text",icon:(0,Y.jsx)(Va.A,{}),onClick:k,style:{marginLeft:8}})]}),(0,Y.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,Y.jsx)(u.Ay,{type:"primary",onClick:async()=>{if(!e||""===e.trim())return i.Ay.warning("Announcement text cannot be empty");o(!0);try{const s=new FormData;s.append("text",e.trim()),n&&s.append("image",n,n.name),await G.adminAPI.createAnnouncement(s),i.Ay.success("Announcement posted"),t(""),a(null)}catch(l){var s,r;console.error("Failed to post announcement",l),i.Ay.error((null===l||void 0===l||null===(s=l.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||"Failed to post announcement")}finally{o(!1)}},loading:l,disabled:!e.trim(),children:"Post Announcement"})})]}),(0,Y.jsxs)("div",{style:{marginTop:12},children:[(0,Y.jsx)(h.A.Title,{level:5,style:{marginBottom:8},children:"Existing Announcements"}),(0,Y.jsx)(g.A,{loading:m,dataSource:d,renderItem:e=>(0,Y.jsxs)(g.A.Item,{actions:[(0,Y.jsx)(A.A,{title:"View",placement:"top",children:(0,Y.jsx)(u.Ay,{shape:"circle",size:"small",icon:(0,Y.jsx)(Z.A,{}),onClick:()=>(e=>f(e))(e),"aria-label":"View announcement ".concat(e._id)})},"view"),"admin"===(null===S||void 0===S?void 0:S.role)?(0,Y.jsx)(A.A,{title:"Edit",placement:"top",children:(0,Y.jsx)(u.Ay,{shape:"circle",size:"small",icon:(0,Y.jsx)(jn.A,{}),onClick:()=>(e=>{j(e),b(e.text||""),I(null)})(e),"aria-label":"Edit announcement ".concat(e._id)})},"edit"):null,"admin"===(null===S||void 0===S?void 0:S.role)?(0,Y.jsx)(fn.A,{title:"Delete announcement?",onConfirm:async()=>{try{await G.adminAPI.deleteAnnouncement(e._id),i.Ay.success("Deleted"),C()}catch(t){console.error(t),i.Ay.error("Delete failed")}},children:(0,Y.jsx)(A.A,{title:"Delete",placement:"top",children:(0,Y.jsx)(u.Ay,{danger:!0,shape:"circle",size:"small",icon:(0,Y.jsx)(Q.A,{}),"aria-label":"Delete announcement ".concat(e._id)})})},"del"):null].filter(Boolean),children:[(0,Y.jsx)(g.A.Item.Meta,{title:new Date(e.createdAt).toLocaleString(),description:e.text}),e.imagePath&&(0,Y.jsx)(Ha.A,{className:"rounded-img",width:80,src:(0,G.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image"))})]})})]})]})}),(0,Y.jsx)(ge.A,{title:x?"Announcement - ".concat(new Date(x.createdAt).toLocaleString()):"Announcement",open:!!x,onCancel:()=>f(null),footer:[(0,Y.jsx)(u.Ay,{onClick:()=>f(null),children:"Close"},"close")],children:x&&(0,Y.jsxs)("div",{children:[(0,Y.jsx)("p",{children:x.text}),x.imagePath&&(0,Y.jsx)(Ha.A,{className:"rounded-img rounded-img-lg",src:(0,G.getAbsoluteApiUrl)("/announcements/".concat(x._id,"/image")),width:320})]})}),(0,Y.jsx)(ge.A,{title:"Edit Announcement",open:!!y,onCancel:()=>{j(null),I(null),b("")},onOk:async()=>{if(y)try{const e=new FormData;e.append("text",v.trim()),w&&e.append("image",w,w.name),await G.adminAPI.updateAnnouncement(y._id,e),i.Ay.success("Updated"),j(null),I(null),b(""),C()}catch(e){console.error(e),i.Ay.error("Update failed")}},okText:"Save",children:(0,Y.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,Y.jsx)(Ga,{value:v,onChange:e=>b(e.target.value),rows:6}),(0,Y.jsx)(J.A,{beforeUpload:e=>e.type.startsWith("image/")?(I(e),J.A.LIST_IGNORE):(i.Ay.error("Only image files are allowed"),J.A.LIST_IGNORE),onRemove:()=>I(null),accept:"image/*",maxCount:1,showUploadList:{showPreviewIcon:!1},children:(0,Y.jsx)(u.Ay,{icon:(0,Y.jsx)(X.A,{}),children:"Replace Image"})}),w&&(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,color:"#237804"},children:[(0,Y.jsx)(an.A,{style:{color:"#52c41a"}}),(0,Y.jsx)("span",{style:{fontWeight:600},children:"New image selected:"}),(0,Y.jsx)("span",{style:{marginLeft:6},children:null===w||void 0===w?void 0:w.name}),(0,Y.jsx)(u.Ay,{type:"text",icon:(0,Y.jsx)(Va.A,{}),onClick:()=>I(null),style:{marginLeft:8}})]})]})})]})},{Title:Ja,Paragraph:Za}=h.A,$a=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!1),[i,l]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async()=>{a(!0);try{const e=await G.contactAPI.getAnnouncements();t(Array.isArray(e)?e:[])}catch(e){console.error("Failed to load announcements",e)}finally{a(!1)}})()},[]),(0,Y.jsxs)(r.A,{title:(0,Y.jsx)(Ja,{level:4,style:{margin:0},children:"Announcements"}),children:[0===e.length?(0,Y.jsx)(Jt.A,{description:"No announcements"}):(0,Y.jsx)(g.A,{loading:n,dataSource:e,renderItem:e=>(0,Y.jsxs)(g.A.Item,{style:{cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},onClick:()=>l(e),children:[(0,Y.jsx)("div",{style:{flex:1,minWidth:0},children:(0,Y.jsx)(g.A.Item.Meta,{title:(0,Y.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,Y.jsx)("span",{children:new Date(e.createdAt).toLocaleString()})}),description:(0,Y.jsx)(Za,{ellipsis:{rows:2},children:e.text})})}),e.imagePath&&(0,Y.jsx)("div",{style:{marginLeft:12,width:80,display:"flex",justifyContent:"flex-end"},children:(0,Y.jsx)(Ha.A,{className:"rounded-img",width:72,height:48,src:(0,G.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image")),alt:"announcement",preview:!1})})]})}),(0,Y.jsx)(ge.A,{open:!!i,onCancel:()=>l(null),footer:null,title:"Announcement",children:i&&(0,Y.jsxs)("div",{children:[(0,Y.jsx)(Za,{children:i.text}),i.imagePath&&(0,Y.jsx)(Ha.A,{className:"rounded-img rounded-img-lg",src:(0,G.getAbsoluteApiUrl)("/announcements/".concat(i._id,"/image")),alt:"announcement"})]})})]})},Qa=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!1),r=async()=>{a(!0);try{const e=await G.verificationAPI.getRequests();t(Array.isArray(e)?e:[])}catch(e){console.error(e),i.Ay.error("Failed to load verification requests")}finally{a(!1)}};(0,s.useEffect)(()=>{r()},[]);const l=[{title:"Resident",dataIndex:"userId",key:"user",render:e=>e?e.fullName||e.username||e.email:"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>(0,Y.jsx)(f.A,{color:"pending"===e?"orange":"approved"===e?"green":"red",children:e})},{title:"Submitted",dataIndex:"createdAt",key:"createdAt",render:e=>new Date(e).toLocaleString()},{title:"Files",dataIndex:"gridFileIds",key:"files",render:e=>(0,Y.jsx)(Oe.A,{children:e&&e.map(e=>(0,Y.jsx)(u.Ay,{type:"link",href:(0,G.getAbsoluteApiUrl)("/verification/file/".concat(e)),target:"_blank",children:"Open"},e))})},{title:"Action",key:"action",render:(e,t)=>(0,Y.jsxs)(Oe.A,{children:[(0,Y.jsx)(u.Ay,{onClick:()=>(async e=>{a(!0);try{await G.verificationAPI.verifyUser(e,!0),i.Ay.success("User verified"),await r()}catch(t){console.error(t),i.Ay.error("Failed to verify user")}finally{a(!1)}})(t.userId._id||t.userId),type:"primary",children:"Verify"}),(0,Y.jsx)(u.Ay,{danger:!0,onClick:()=>(async e=>{a(!0);try{var t;if(e&&e._id)try{await G.verificationAPI.rejectRequest(e._id)}catch(n){}const a=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;a&&await G.verificationAPI.verifyUser(a,!1),i.Ay.success("Verification request rejected"),await r()}catch(s){console.error(s),i.Ay.error("Failed to reject verification")}finally{a(!1)}})(t),children:"Reject"}),(0,Y.jsx)(u.Ay,{type:"link",href:(0,G.getAbsoluteApiUrl)("/verification/file/".concat(t.gridFileIds&&t.gridFileIds[0]||"")),target:"_blank",children:"Check ID"})]})}];return(0,Y.jsxs)("div",{style:{padding:24},children:[(0,Y.jsx)("h2",{children:"Verification Requests"}),(0,Y.jsx)(p.A,{spinning:n,children:(0,Y.jsx)(zt.A,{rowKey:"_id",loading:n,dataSource:e,columns:l})})]})};const Xa=(0,n(77990).A)({palette:{primary:{main:"#1976d2",light:"#42a5f5",dark:"#1565c0"},secondary:{main:"#9c27b0",light:"#ba68c8",dark:"#7b1fa2"}},typography:{fontFamily:["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif"].join(",")},components:{MuiButton:{styleOverrides:{root:{textTransform:"none"}}},MuiPaper:{styleOverrides:{root:{borderRadius:8}}}}}),es=()=>{const{user:e}=Pe();return e?"admin"===e.role?(0,Y.jsx)(pe.C5,{to:"/admin/dashboard",replace:!0}):"staff"===e.role?(0,Y.jsx)(pe.C5,{to:"/staff-dashboard",replace:!0}):(0,Y.jsx)(pe.C5,{to:"/dashboard",replace:!0}):(0,Y.jsx)(pe.C5,{to:"/login",replace:!0})},ts=()=>(0,Y.jsxs)(Se.A,{theme:Xa,children:[(0,Y.jsx)(Ce.Ay,{}),(0,Y.jsx)(ke.Ay,{children:(0,Y.jsx)(pe.Kd,{children:(0,Y.jsx)(qe,{children:(0,Y.jsxs)(pe.BV,{children:[(0,Y.jsx)(pe.qh,{path:"/",element:(0,Y.jsx)(Sa,{})}),(0,Y.jsx)(pe.qh,{path:"/redirect",element:(0,Y.jsx)(es,{})}),(0,Y.jsx)(pe.qh,{path:"/login",element:(0,Y.jsx)(ft,{})}),(0,Y.jsx)(pe.qh,{path:"/forgot-password",element:(0,Y.jsx)(ka,{})}),(0,Y.jsx)(pe.qh,{path:"/reset-password/:token",element:(0,Y.jsx)(Ta,{})}),(0,Y.jsx)(pe.qh,{path:"/register",element:(0,Y.jsx)(Ot,{})}),(0,Y.jsx)(pe.qh,{path:"/goodbye",element:(0,Y.jsx)(ya,{})}),(0,Y.jsx)(pe.qh,{path:"/logout",element:(0,Y.jsx)(Aa,{})}),(0,Y.jsxs)(pe.qh,{element:(0,Y.jsx)(it,{}),children:[(0,Y.jsx)(pe.qh,{path:"/home",element:(0,Y.jsx)(rt,{children:(0,Y.jsx)(Ht,{})})}),(0,Y.jsx)(pe.qh,{path:"/request",element:(0,Y.jsx)(rt,{children:(0,Y.jsx)(ua,{})})}),(0,Y.jsx)(pe.qh,{path:"/dashboard",element:(0,Y.jsx)(rt,{children:(0,Y.jsx)(Ht,{})})}),(0,Y.jsx)(pe.qh,{path:"/guest/dashboard",element:(0,Y.jsx)(rt,{children:(0,Y.jsx)(Vt,{})})}),(0,Y.jsx)(pe.qh,{path:"/request-document",element:(0,Y.jsx)(rt,{children:(0,Y.jsx)(ua,{})})}),(0,Y.jsx)(pe.qh,{path:"/contact",element:(0,Y.jsx)(rt,{children:(0,Y.jsx)(fa,{})})}),(0,Y.jsx)(pe.qh,{path:"/inquiries",element:(0,Y.jsx)(rt,{children:(0,Y.jsx)(fa,{})})}),(0,Y.jsx)(pe.qh,{path:"/inquiry-tracker",element:(0,Y.jsx)(lt,{children:(0,Y.jsx)(va,{})})}),(0,Y.jsx)(pe.qh,{path:"/staff-dashboard",element:(0,Y.jsx)(lt,{children:(0,Y.jsx)(ln,{})})}),(0,Y.jsx)(pe.qh,{path:"/document-processing",element:(0,Y.jsx)(lt,{children:s.createElement(n(81190).A)})}),(0,Y.jsx)(pe.qh,{path:"/templates-manager",element:(0,Y.jsx)(lt,{children:(0,Y.jsx)(me,{})})}),(0,Y.jsx)(pe.qh,{path:"/staff/inbox",element:(0,Y.jsx)(lt,{children:(0,Y.jsx)(Ie,{})})}),(0,Y.jsx)(pe.qh,{path:"/admin/dashboard",element:(0,Y.jsx)(ot,{children:(0,Y.jsx)(gn,{})})}),(0,Y.jsx)(pe.qh,{path:"/admin/messages",element:(0,Y.jsx)(ot,{children:(0,Y.jsx)(Ra,{})})}),(0,Y.jsx)(pe.qh,{path:"/admin/verification-requests",element:(0,Y.jsx)(ot,{children:(0,Y.jsx)(Qa,{})})}),(0,Y.jsx)(pe.qh,{path:"/announcements",element:(0,Y.jsx)(rt,{children:(0,Y.jsx)($a,{})})}),(0,Y.jsx)(pe.qh,{path:"/admin/announcements",element:(0,Y.jsx)(ot,{children:(0,Y.jsx)(Ka,{})})}),(0,Y.jsx)(pe.qh,{path:"/admin",element:(0,Y.jsx)(pe.C5,{to:"/admin/dashboard",replace:!0})}),(0,Y.jsx)(pe.qh,{path:"/admin/users",element:(0,Y.jsx)(ot,{children:(0,Y.jsx)(Nn,{})})}),(0,Y.jsx)(pe.qh,{path:"/admin/activity",element:(0,Y.jsx)(ot,{children:(0,Y.jsx)(Tn,{})})}),(0,Y.jsx)(pe.qh,{path:"/admin/statistics",element:(0,Y.jsx)(ot,{children:(0,Y.jsx)(Kn,{})})}),(0,Y.jsx)(pe.qh,{path:"/admin/settings",element:(0,Y.jsx)(ot,{children:(0,Y.jsx)(ra,{})})}),(0,Y.jsx)(pe.qh,{path:"/profile",element:(0,Y.jsx)(rt,{children:(0,Y.jsx)(Ia,{})})}),(0,Y.jsx)(pe.qh,{path:"/document-history",element:(0,Y.jsx)(rt,{children:(0,Y.jsx)(Ya,{})})}),(0,Y.jsx)(pe.qh,{path:"/inbox",element:(0,Y.jsx)(rt,{children:(0,Y.jsx)(K,{})})})]})]})})})})]})},31694:(e,t,n)=>{n.r(t),n.d(t,{API_URL:()=>p,adminAPI:()=>S,authAPI:()=>k,authService:()=>y,axiosInstance:()=>x,axiosPublic:()=>g,contactAPI:()=>w,default:()=>x,documentsAPI:()=>b,getAbsoluteApiUrl:()=>f,getInbox:()=>A,getTemplateText:()=>c,notificationAPI:()=>u,requestsAPI:()=>I,residentPersonalInfoAPI:()=>C,staffRegister:()=>h,verificationAPI:()=>j});var a=n(89379),s=n(56403),i=n(72799);class r{constructor(){this.db=null}static getInstance(){return r.instance||(r.instance=new r),r.instance}async initialize(){this.db=await(0,i.P2)("barangay-system",1,{upgrade(e){if(!e.objectStoreNames.contains("users")){e.createObjectStore("users",{keyPath:"_id"}).createIndex("by-email","email")}if(!e.objectStoreNames.contains("documents")){e.createObjectStore("documents",{keyPath:"_id"}).createIndex("by-user","userId")}e.objectStoreNames.contains("syncQueue")||e.createObjectStore("syncQueue",{keyPath:"_id",autoIncrement:!0})}})}async addToSyncQueue(e,t,n){this.db||await this.initialize(),await this.db.add("syncQueue",{operation:e,collection:t,data:n,timestamp:Date.now()})}async getAllFromSyncQueue(){return this.db||await this.initialize(),this.db.getAll("syncQueue")}async clearSyncQueue(){this.db||await this.initialize();const e=this.db.transaction("syncQueue","readwrite");await e.objectStore("syncQueue").clear()}async saveUser(e){this.db||await this.initialize(),await this.db.put("users",e)}async getUser(e){return this.db||await this.initialize(),this.db.get("users",e)}async getAllUsers(){return this.db||await this.initialize(),this.db.getAll("users")}async deleteUser(e){this.db||await this.initialize(),await this.db.delete("users",e)}async saveDocument(e){this.db||await this.initialize(),await this.db.put("documents",e)}async getDocument(e){return this.db||await this.initialize(),this.db.get("documents",e)}async getAllDocuments(){return this.db||await this.initialize(),this.db.getAll("documents")}async deleteDocument(e){this.db||await this.initialize(),await this.db.delete("documents",e)}async saveSettings(e){this.db||await this.initialize(),await this.db.put("users",(0,a.A)({_id:"settings"},e))}async getSettings(){return this.db||await this.initialize(),this.db.get("users","settings")}}r.instance=void 0;const l=r.getInstance();class o{constructor(){this.isOnline=navigator.onLine,this.syncInterval=null,this.handleOnline=async()=>{this.isOnline=!0,console.log("Connection restored. Starting sync..."),await this.syncWithServer()},this.handleOffline=()=>{this.isOnline=!1,console.log("Connection lost. Operating in offline mode...")},this.setupEventListeners(),this.startSyncInterval()}static getInstance(){return o.instance||(o.instance=new o),o.instance}setupEventListeners(){window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline)}startSyncInterval(){this.syncInterval||(this.syncInterval=setInterval(async()=>{this.isOnline&&await this.syncWithServer()},3e5))}async syncWithServer(){try{const t=await l.getAllFromSyncQueue();if(0===t.length)return;console.log("Syncing ".concat(t.length," pending changes..."));for(const n of t)try{await this.processSyncItem(n)}catch(e){if(e&&"object"===typeof e&&"message"in e&&"string"===typeof e.message){if(console.error("Failed to sync item:",n,e),"Network Error"===e.message){this.isOnline=!1;break}}else console.error("Failed to sync item:",n,e)}await l.clearSyncQueue()}catch(e){e&&"object"===typeof e&&"message"in e&&"string"===typeof e.message?console.error("Sync failed:",e.message):console.error("Sync failed:",e)}}async processSyncItem(e){const{operation:t,collection:n,data:a}=e;switch(t){case"create":await x.post("/".concat(n),a);break;case"update":await x.put("/".concat(n,"/").concat(a._id),a);break;case"delete":await x.delete("/".concat(n,"/").concat(a._id))}}async performOperation(e,t,n){switch(e){case"create":case"update":await l.saveUser(n);break;case"delete":await l.deleteUser(n._id)}await l.addToSyncQueue(e,t,n),this.isOnline&&await this.syncWithServer()}cleanup(){this.syncInterval&&clearInterval(this.syncInterval),window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline)}}o.instance=void 0;const d=o.getInstance(),c=e=>x.get("/templates/".concat(e)).then(e=>e.data.text),u={getNotifications:async()=>{try{const e=await x.get("/notifications");return Array.isArray(e.data)?e.data:e.data&&e.data.data?e.data.data:[]}catch(e){try{const e=await x.get("/notifications/fallback");return Array.isArray(e.data)?e.data:e.data&&e.data.data?e.data.data:[]}catch(t){return console.error("notificationAPI.getNotifications failed:",e),[]}}},approveStaff:async(e,t)=>(await x.post("/notifications/approve",{userId:e,notificationId:t})).data,rejectStaff:async(e,t)=>(await x.post("/notifications/reject",{notificationId:e,reason:t})).data,markAsRead:async e=>(await x.post("/notifications/read",{notificationId:e})).data},h=async e=>(await x.post("/auth/register/staff",e)).data,m=globalThis.__APP_CONFIG__,p=m&&m.API_BASE||"https://my-backend.onrender.com/api",x=s.A.create({baseURL:p,headers:{"Content-Type":"application/json"},withCredentials:!0}),g=s.A.create({baseURL:p,headers:{"Content-Type":"application/json"},withCredentials:!1});function f(e){const t=globalThis.__APP_CONFIG__,n=t&&t.API_BASE||"https://my-backend.onrender.com/api";let a=String(n).replace(/\/$/,"");a.endsWith("/api")&&(a=a.replace(/\/api$/,""));const s=e.startsWith("/")?e:"/".concat(e);return s.startsWith("/api")?"".concat(a).concat(s):"".concat(a,"/api").concat(s)}const y={login:async(e,t)=>(await x.post("/auth/login",{email:e,password:t})).data,register:async e=>(await x.post("/auth/register",e)).data,logout:async()=>{await x.post("/auth/logout")},getCurrentUser:async()=>(await x.get("/auth/me")).data};x.interceptors.request.use(e=>{const t=localStorage.getItem("token")||localStorage.getItem("guestSessionToken");return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e}),x.interceptors.response.use(e=>e,e=>{try{var t;if(401===(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status)&&"undefined"!==typeof window){const t=window.location.pathname||"",s=(null===e||void 0===e?void 0:e.config)&&(e.config.url||"")||(null===e||void 0===e?void 0:e.request)&&e.request.responseURL||"",i=s.includes("/auth/login")||s.includes("/auth/me");if("/login"===t||t.startsWith("/login")||i)try{localStorage.removeItem("guestSessionToken")}catch(n){}else{console.warn("API responded 401 Unauthorized \u2014 clearing auth and redirecting to login");try{localStorage.removeItem("token"),localStorage.removeItem("guestSessionToken")}catch(n){}try{sessionStorage.getItem("redirectingToLogin")||(sessionStorage.setItem("redirectingToLogin","1"),setTimeout(()=>{window.location.href="/login"},100))}catch(n){try{window.location.href="/login"}catch(a){}}}}}catch(n){}return Promise.reject(e)});const A=async()=>x.get("/messages/inbox"),j={getRequests:async()=>x.get("/verification/admin/requests").then(e=>e.data),verifyUser:async(e,t)=>x.post("/verification/admin/verify-user/".concat(e),{verified:t}).then(e=>e.data),getFileUrl:e=>"".concat(p.replace(/\/$/,""),"/verification/file/").concat(e),approveRequest:async e=>x.post("/verification/admin/requests/".concat(e,"/approve")).then(e=>e.data),rejectRequest:async(e,t)=>x.post("/verification/admin/requests/".concat(e,"/reject"),{reason:t}).then(e=>e.data),cancelRequest:async e=>x.delete("/verification/requests/".concat(e)).then(e=>e.data),getMyRequests:async()=>x.get("/verification/requests/my").then(e=>e.data),getRequestById:async e=>x.get("/verification/requests/".concat(e)).then(e=>e.data)},v={login:e=>x.post("/auth/login",e).then(e=>e.data),register:e=>x.post("/auth/register",e).then(e=>e.data)},b={getMyDocuments:()=>x.get("/document-requests/my-requests").then(e=>e.data),requestDocument:e=>x.post("/document-requests",e).then(e=>e.data),getDocumentById:e=>x.get("/document-requests/".concat(e)).then(e=>e.data),getAllDocuments:()=>x.get("/document-requests/all").then(e=>e.data).catch(e=>{var t;if(401===(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status))return[];throw e}),getDocumentRecords:()=>x.get("/document-requests/all").then(e=>e.data),updateDocumentStatus:(e,t)=>x.patch("/document-requests/".concat(e,"/process"),t).then(e=>e.data),processDocument:e=>x.patch("/document-requests/".concat(e,"/process")).then(e=>e.data),listFiles:()=>x.get("/documents/list").then(e=>e.data),deleteFile:e=>x.delete("/documents/file/".concat(e)).then(e=>e.data),updateFileStatus:(e,t)=>x.patch("/documents/file/".concat(e,"/status"),t).then(e=>e.data),getFilledDocument:e=>x.get("/document-requests/".concat(e,"/filled")).then(e=>e.data),previewFilledDocument:e=>x.post("/document-requests/preview-filled",e).then(e=>e.data)},w={submitInquiry:e=>"undefined"!==typeof FormData&&e instanceof FormData?x.post("/inquiries",e,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>e.data):x.post("/inquiries",e).then(e=>e.data),getMyInquiries:(e,t)=>x.get("/inquiries/my-inquiries",{params:e&&t?{username:e,barangayID:t}:void 0}).then(e=>e.data),getInquiryById:e=>x.get("/inquiries/".concat(e)).then(e=>e.data),getAllInquiries:()=>x.get("/inquiries").then(e=>e.data),respondToInquiry:(e,t)=>x.post("/inquiries/".concat(e,"/responses"),t).then(e=>e.data),resolveInquiry:e=>x.patch("/inquiries/".concat(e),{status:"resolved"}).then(e=>e.data),getAnnouncements:()=>x.get("/announcements").then(e=>e.data),getAnnouncementById:e=>x.get("/announcements/".concat(e)).then(e=>e.data)},I={getAllRequests:async()=>x.get("/requests").then(e=>e.data),getRequestById:async e=>x.get("/requests/".concat(e)).then(e=>e.data),getStaffAccessRequests:async()=>{const e=await x.get("/requests").then(e=>e.data);return Array.isArray(e)?e.filter(e=>"staff_access"===(e.type||"").toString().toLowerCase()&&"pending"===(e.status||"").toString().toLowerCase()):[]},approveRequest:async e=>(await x.post("/requests/".concat(e,"/approve"))).data},S={createUser:async e=>{try{const n=await x.post("/admin/users",e);if(n.data){await l.saveUser(n.data);try{const e=new CustomEvent("userProfileUpdated",{detail:n.data});window.dispatchEvent(e)}catch(t){}}}catch(n){throw navigator.onLine||await d.performOperation("create","users",e),n}},updateUser:async(e,t)=>{try{const a=await x.put("/admin/users/".concat(e),t);if(a.data){await l.saveUser(a.data);try{const e=new CustomEvent("userProfileUpdated",{detail:a.data});window.dispatchEvent(e)}catch(n){}}}catch(s){throw navigator.onLine||await d.performOperation("update","users",(0,a.A)((0,a.A)({},t),{},{_id:e})),s}},demoteUser:async e=>{try{return(await x.put("/admin/users/".concat(e),{role:"resident"})).data}catch(t){if(!navigator.onLine)return void await d.performOperation("update","users",{_id:e,role:"resident"});throw t}},getSystemSettings:async()=>{try{return(await x.get("/admin/settings")).data}catch(e){if(!navigator.onLine){const e=await l.getSettings();if(e)return e}try{return(await x.get("/settings")).data}catch(t){try{return(await x.get("/admin/settings")).data}catch(n){try{return(await x.get("/settings")).data}catch(a){try{return(await x.get("/settings/public")).data}catch(s){try{const e=await l.getSettings();if(e)return e}catch(i){}console.warn("getSystemSettings: all fallbacks failed; returning empty defaults. Original error:",e);return{siteName:"Barangay Information System",contactEmail:"",smtp:{passwordSet:!1}}}}}}}},updateSystemSettings:async e=>{try{const t=await x.put("/admin/settings",e);return await l.saveSettings(e),t.data}catch(t){if(!navigator.onLine)return void await d.performOperation("update","settings",e);try{const t=await x.put("/admin/settings",e,{withCredentials:!0});try{await l.saveSettings(e)}catch(n){}return t.data}catch(a){throw t}}},testSmtp:async e=>(await x.post("/admin/settings/test-smtp",{to:e})).data,getUsers:async()=>{try{const e=(await x.get("/auth/users")).data;for(const t of e)await l.saveUser(t);return e}catch(e){if(!navigator.onLine)return l.getAllUsers();throw e}},updateUserStatus:async(e,t)=>{try{const a=await x.put("/admin/users/".concat(e,"/status"),{status:t}),s=await l.getUser(e);if(s){s.status=t,await l.saveUser(s);try{const e=new CustomEvent("userProfileUpdated",{detail:s});window.dispatchEvent(e)}catch(n){}}return a.data}catch(a){if(!navigator.onLine){const n=await l.getUser(e);return void(n&&(n.status=t,await d.performOperation("update","users",n)))}throw a}},deleteUser:async e=>{try{await x.delete("/admin/users/".concat(e)),await l.deleteUser(e);try{const t=new CustomEvent("userProfileUpdated",{detail:{_id:e,deleted:!0}});window.dispatchEvent(t)}catch(t){}}catch(n){if(!navigator.onLine)return void await d.performOperation("delete","users",{_id:e});throw n}},getActivityLogs:e=>x.get("/admin/logs",{params:e}).then(e=>e.data),getSystemStatistics:()=>x.get("/admin/statistics").then(e=>e.data),getStaffApplicants:async()=>(await x.get("/admin/staff-applications")).data,getUserWithResident:async e=>(await x.get("/admin/users/".concat(e,"/with-resident"))).data,getResidentByBarangayID:async e=>(await x.get("/admin/resident/".concat(encodeURIComponent(e)))).data,getResident:async e=>(await x.get("/admin/resident/id/".concat(e))).data,updateResident:async(e,t)=>(await x.put("/admin/resident/".concat(e),t)).data,uploadResidentAvatar:async(e,t)=>{const n=new FormData;n.append("avatar",t);return(await x.post("/admin/resident/".concat(e,"/avatar"),n,{})).data},getOfficials:async()=>{try{return(await x.get("/admin/officials")).data}catch(e){console.warn("getOfficials: primary request failed; attempting public backend fallback. Error:",e);try{const e=await g.get("/officials");return Array.isArray(e.data)?e.data:[]}catch(t){return[]}}},createOfficial:async e=>{try{return(await x.post("/admin/officials",e)).data}catch(t){throw t}},updateOfficial:async(e,t)=>{try{return(await x.put("/admin/officials/".concat(e),t)).data}catch(n){if(!navigator.onLine)return void await d.performOperation("update","officials",(0,a.A)((0,a.A)({},t),{},{_id:e}));throw n}},deleteOfficial:async e=>(await x.delete("/admin/officials/".concat(e))).data,disableUser:async(e,t)=>(await x.patch("/admin/users/".concat(e,"/disable"),t||{})).data,enableUser:async e=>(await x.patch("/admin/users/".concat(e,"/enable"))).data,uploadOfficialPhoto:async(e,t)=>{const n=new FormData;n.append("photo",t);try{return(await x.post("/admin/officials/".concat(e,"/photo"),n,{headers:{}})).data}catch(a){try{a&&a.response&&a.response.data?console.error("uploadOfficialPhoto axios error response:",a.response.data):console.error("uploadOfficialPhoto axios error",a)}catch(s){}try{const t="".concat(p,"/admin/officials/").concat(e,"/photo"),a=await fetch(t,{method:"POST",body:n,credentials:"include"}),s=await a.json().catch(()=>({}));if(!a.ok){const e=s&&s.message?s.message:"Upload failed with status ".concat(a.status),t=new Error(e);throw t.response={status:a.status,data:s},t}return s}catch(i){throw i}}},approveStaffApplicant:async e=>(await x.post("/admin/staff-applications/".concat(e,"/approve"))).data,createAnnouncement:async e=>(await x.post("/admin/announcements",e,{headers:{"Content-Type":"multipart/form-data"}})).data,listAdminAnnouncements:async()=>(await x.get("/admin/announcements/list")).data,deleteAnnouncement:async e=>(await x.delete("/admin/announcements/".concat(e))).data,updateAnnouncement:async(e,t)=>(await x.put("/admin/announcements/".concat(e),t,{headers:{"Content-Type":"multipart/form-data"}})).data},C={getPersonalInfo:async()=>{const e=["/resident/my-info","/resident/personal-info","/resident/profile"];for(const a of e)try{const e=await x.get(a);if(e&&e.data)return e.data}catch(n){}try{const e=await x.get("/resident/personal-info");if(e&&e.data)return e.data}catch(n){}const t=new Error("Resident personal info not found");throw t.response={status:404},t},updatePersonalInfo:async e=>(await x.put("/resident/my-info",e)).data},k=(0,a.A)((0,a.A)({},v),{},{getUsers:async()=>{try{return(await x.get("/auth/users")).data}catch(e){throw console.error("authAPI.getUsers failed",e),e}}})},59977:(e,t,n)=>{n.d(t,{Y:()=>i});var a=n(60446),s=n.n(a);function i(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"";try{const n=s()(e);return n.isValid()?t?n.format("MM/DD/YYYY h:mm:ss A"):n.format("MM/DD/YYYY"):String(e)}catch(n){return String(e)}}},81190:(e,t,n)=>{n.d(t,{A:()=>ee});var a=n(89379),s=n(65043);const i="DocumentProcessing_wrapper__mgdlQ",r="DocumentProcessing_pageTitle__6x0cP",l="DocumentProcessing_loadingWrap__6rGYa",o="DocumentProcessing_controls__oQbzN",d="DocumentProcessing_controlInput__WD8hf",c="DocumentProcessing_controlSelect__-KBnD",u="DocumentProcessing_controlDate__vbgUi",h="DocumentProcessing_mobileList__fzS+Q",m="DocumentProcessing_mobileCard__teinV",p="DocumentProcessing_mobileCardRow__ffMTN",x="DocumentProcessing_mobileMeta__0G75s",g="DocumentProcessing_iconWrap__AgQnd",f="DocumentProcessing_mobileTitleWrap__tkYpI",y="DocumentProcessing_mobileTitle__-0V-d",A="DocumentProcessing_mobileSubtitle__Z5HFo",j="DocumentProcessing_mobileActions__UKz34",v="DocumentProcessing_statusTag__xF-xu",b="DocumentProcessing_actionButtons__JVicD",w="DocumentProcessing_uploadDate__AiEGx",I="DocumentProcessing_modalContent__ZldTP",S="DocumentProcessing_previewWrapper__mLLdQ",C="DocumentProcessing_previewPane__ckBOK",k="DocumentProcessing_requestPane__EIwR2",N="DocumentProcessing_previewHtml__3X+05",T="DocumentProcessing_previewFooter__8KQ9W",_="DocumentProcessing_generateButton__hWg5N";var P=n(25352),D=n(91686),R=n(79617),q=n(89073),B=n(36621),L=n(65512),O=n(59772),U=n(70494),z=n(76399),F=n(15492),E=n(42524),M=n(6051),W=n(63942),Y=n(96603),H=n(80349),V=n(72411),G=n(48745),K=n(96891),J=n(49400),Z=n(61118),$=n(31694),Q=n(59977);var X=n(70579);const ee=()=>{var e,t,ee,te;const[ne,ae]=(0,s.useState)([]),[se,ie]=(0,s.useState)(!0),[re,le]=(0,s.useState)(!1),[oe,de]=(0,s.useState)(null),[ce,ue]=(0,s.useState)([]),[he,me]=(0,s.useState)({}),[pe,xe]=(0,s.useState)(!1),[ge,fe]=(0,s.useState)(""),[ye,Ae]=(0,s.useState)(!1),[je,ve]=(0,s.useState)([]),[be,we]=(0,s.useState)(""),[Ie,Se]=(0,s.useState)(null),[Ce,ke]=(0,s.useState)(!0),Ne=(0,s.useRef)({}),[Te,_e]=((0,s.useRef)(null),(0,s.useState)(null)),[Pe,De]=(0,s.useState)({}),[Re,qe]=(0,s.useState)(!1),[Be,Le]=(0,s.useState)([]),[Oe,Ue]=(0,s.useState)(null),[ze,Fe]=(0,s.useState)(null),[Ee,Me]=(0,s.useState)(null),[We,Ye]=(0,s.useState)(!1),[He,Ve]=(0,s.useState)(null),[Ge,Ke]=(0,s.useState)(!1),[Je,Ze]=(0,s.useState)(""),[$e,Qe]=(0,s.useState)(null),[Xe,et]=(0,s.useState)(null),[tt,nt]=(0,s.useState)(null),at=(0,P.zy)(),st=(0,P.Zp)(),it=at&&at.state&&at.state.openRequestId?at.state.openRequestId:null,rt=e=>{const t=he[e];return t?Array.isArray(t)?t:[t]:[]},lt=e=>{const t=rt(e);return t.length?t[0]:null},ot=e=>{const t=rt(e);if(!t||!t.length)return null;return t.find(e=>e.notes&&e.notes.toString().toLowerCase().includes("priority")||!0===e.priority)||t[0]},dt=async()=>{ie(!0);try{const e=await $.documentsAPI.listFiles(),t=await $.documentsAPI.getDocumentRecords(),n=Array.from(new Set((t||[]).map(e=>(e.type||"").toLowerCase()).filter(Boolean)));ue(n);const a={},s=e=>(e||"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase();e.forEach(e=>{if(!e||!e.filename)return;const n=s(e.filename),i=(t||[]).filter(e=>e.type&&n.includes(s(e.type)));i&&i.length&&(a[e._id]=i)});const i=e.filter(e=>{if(!e||!e.filename)return!1;if(0===n.length)return!0;const t=e.filename.replace(/[_\s]/g,"").toLowerCase();return n.some(e=>t.includes(e.replace(/[_\s]/g,"")))});ae(i),me(a)}catch(e){me({})}finally{ie(!1)}};(0,s.useEffect)(()=>{dt();const e=()=>Ke(window.innerWidth<=720);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{if(!it)return;const e=Object.keys(he).find(e=>(Array.isArray(he[e])?he[e]:he[e]?[he[e]]:[]).some(e=>(e._id||e.requestId)===it));if(e){const t=ne.find(t=>t._id===e);t&&(de(t),ct(t).then(()=>{Se(it),ut(it),xe(!0)}).catch(()=>{}))}else(async()=>{try{if($.documentsAPI.getDocumentById){const t=await $.documentsAPI.getDocumentById(it);if(t){ve([t]),Se(it);try{const e=t.fieldValues||{},n=Object.keys(e);if(n.length){const t="\n                    <table style=\"width:100%;border-collapse:collapse;\">\n                      <thead>\n                        <tr>\n                          <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Field</th>\n                          <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Submitted Value</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        ".concat(n.map(t=>"<tr><td style='border:1px solid #ccc;padding:8px;'>".concat(t,"</td><td style='border:1px solid #ccc;padding:8px;'>").concat(e[t]||"","</td></tr>")).join(""),"\n                      </tbody>\n                    </table>\n                    // when we open a preview for a request that wasn't tied to a specific file in mapping,\n                    // attempt to scroll to and highlight the request's entry if present in the UI\n                    setTimeout(() => {\n                      try {\n                        const el = rowRefs.current[openRequestIdFromNav];\n                        if (el && el.scrollIntoView) {\n                          el.scrollIntoView({ behavior: 'smooth', block: 'center' });\n                          el.classList.add('cv-highlight');\n                          if (highlightTimeoutRef.current) window.clearTimeout(highlightTimeoutRef.current);\n                          // remove highlight after 2s\n                          // @ts-ignore - window.setTimeout returns number in browser\n                          highlightTimeoutRef.current = window.setTimeout(() => el.classList.remove('cv-highlight'), 2000);\n                        }\n                      } catch (e) {}\n                    }, 120);\n                  ");fe(t)}else fe('<div style="color:#666">No submitted field values available.</div>')}catch(e){fe('<div style="color:red">Failed to build preview.</div>')}xe(!0)}}}catch(e){}})();try{st(at.pathname,{replace:!0,state:{}})}catch(t){}},[he,ne]);const ct=async e=>{xe(!0),Ae(!0),fe("");try{const t=(rt(e._id)||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase());ve(t);const a=ot(e._id),s=t[0]||null,i=a&&"pending"===(a.status||"").toString().toLowerCase()?a:null;Se(i?i._id||i.requestId:(null===s||void 0===s?void 0:s._id)||(null===s||void 0===s?void 0:s.requestId)||null);const r=await(await Promise.resolve().then(n.bind(n,31694))).axiosPublic.get("/documents/preview/".concat(e._id),{params:{format:"html"},responseType:"text"}),l=r&&r.data?r.data:"";we(l);const o=i?i._id||i.requestId:(null===s||void 0===s?void 0:s._id)||(null===s||void 0===s?void 0:s.requestId)||null;o&&await ut(o)}catch(t){fe('<div style="color:red">Failed to load preview.</div>')}Ae(!1)},ut=async e=>{try{const t=Object.values(he).flat().find(t=>(t._id||t.requestId)===e)||null,n=(null===t||void 0===t?void 0:t.fieldValues)||{},a=be||"",s=/\{(.*?)\}/g;let i;const r=[];for(;null!==(i=s.exec(a));)r.push(i[1].trim());if(r.length>0){const e="\n          <table style=\"width:100%;border-collapse:collapse;\">\n            <thead>\n              <tr>\n                <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Field</th>\n                <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Submitted Value</th>\n              </tr>\n            </thead>\n            <tbody>\n              ".concat(r.map(e=>{const t=n[e]||"";return"<tr><td style='border:1px solid #ccc;padding:8px;'>".concat(e,"</td><td style='border:1px solid #ccc;padding:8px;'>").concat(t,"</td></tr>")}).join(""),"\n            </tbody>\n          </table>\n        ");fe(e)}else fe('<div style="color:red">No { ... } content found.</div>')}catch(t){fe('<div style="color:red">Failed to load preview.</div>')}},ht=async e=>{de(e),await ct(e)};return se?(0,X.jsx)("div",{className:l,children:(0,X.jsx)(D.A,{size:"large"})}):(0,X.jsxs)("div",{className:i,children:[(0,X.jsx)(R.A.Title,{level:3,className:r}),(0,X.jsx)(q.A,{title:"Document Processing",extra:(0,X.jsxs)("div",{className:o,children:[(0,X.jsx)(B.A,{prefix:(0,X.jsx)(V.A,{}),placeholder:"Search documents",className:d,value:Je,onChange:e=>Ze(e.target.value),onPressEnter:()=>{}}),(0,X.jsx)(L.A,{allowClear:!0,placeholder:"Document Type",className:c,value:$e,onChange:e=>Qe(e),children:ce.map(e=>(0,X.jsx)(L.A.Option,{value:e,children:e},e))}),(0,X.jsxs)(L.A,{allowClear:!0,placeholder:"Status",className:c,value:Xe,onChange:e=>et(e),children:[(0,X.jsx)(L.A.Option,{value:"pending",children:"Pending"}),(0,X.jsx)(L.A.Option,{value:"approved",children:"Approved"}),(0,X.jsx)(L.A.Option,{value:"rejected",children:"Rejected"})]}),(0,X.jsx)(O.A.RangePicker,{className:u,onChange:e=>nt(e)})]}),children:Ge?(0,X.jsx)("div",{className:h,children:ne.filter(e=>{if(Je&&!(e.filename||"").toLowerCase().includes(Je.toLowerCase()))return!1;if($e&&(e.type||"").toLowerCase()!==$e.toLowerCase())return!1;const t=lt(e._id),n=(null===t||void 0===t?void 0:t.status)||"";if(Xe&&n.toLowerCase()!==Xe.toLowerCase())return!1;if(tt&&tt[0]&&tt[1]&&e.uploadDate){const t=new Date(e.uploadDate),n=tt[0].toDate(),a=tt[1].toDate();if(t<n||t>a)return!1}return!0}).map(e=>{const t=e.filename||"",n=(t.split(".").pop()||"").toLowerCase();let a=(0,X.jsx)(G.A,{style:{color:"#2B6CB0",fontSize:20}});"pdf"===n&&(a=(0,X.jsx)(K.A,{style:{color:"#E53E3E",fontSize:20}})),["png","jpg","jpeg","gif","svg","bmp"].includes(n)&&(a=(0,X.jsx)(J.A,{style:{color:"#319795",fontSize:20}}));const s=lt(e._id),i=(null===s||void 0===s?void 0:s.status)||"";return(0,X.jsx)(q.A,{size:"small",className:m,ref:t=>{const n=lt(e._id),a=n&&(n._id||n.requestId);a&&(Ne.current[a]=t)},children:(0,X.jsxs)("div",{className:p,children:[(0,X.jsxs)("div",{className:x,children:[(0,X.jsx)("div",{className:g,children:a}),(0,X.jsxs)("div",{className:f,children:[(0,X.jsx)(U.A,{title:t,children:(0,X.jsx)("div",{className:y,children:t.replace(/\.docx$/i,"")})}),(0,X.jsx)("div",{className:A,children:e.type||"Unknown"})]})]}),(0,X.jsxs)("div",{className:j,children:[(0,X.jsx)(z.A,{className:v,color:"pending"===i?"orange":"approved"===i?"green":"rejected"===i?"red":"default",children:(i||"").toUpperCase()}),(0,X.jsx)("div",{className:b,children:(0,X.jsx)(F.Ay,{size:"small",icon:(0,X.jsx)(Z.A,{}),onClick:()=>ht(e),children:Ge?null:"Preview"})}),(0,X.jsx)("div",{className:w,children:e.uploadDate?(0,Q.Y)(e.uploadDate):""})]})]})},e._id)})}):(0,X.jsx)(E.A,{rowKey:e=>e._id,dataSource:ne.filter(e=>{if(Je&&!(e.filename||"").toLowerCase().includes(Je.toLowerCase()))return!1;if($e&&(e.type||"").toLowerCase()!==$e.toLowerCase())return!1;const t=lt(e._id),n=(null===t||void 0===t?void 0:t.status)||"";if(Xe&&n.toLowerCase()!==Xe.toLowerCase())return!1;if(tt&&tt[0]&&tt[1]&&e.uploadDate){const t=new Date(e.uploadDate),n=tt[0].toDate(),a=tt[1].toDate();if(t<n||t>a)return!1}return!0}),pagination:{pageSize:10},columns:[{title:"File",dataIndex:"filename",key:"filename",sorter:(e,t)=>(e.filename||"").localeCompare(t.filename||""),render:(e,t)=>{const n=e||"",a=(n.split(".").pop()||"").toLowerCase();let s=(0,X.jsx)(G.A,{style:{color:"#2B6CB0"}});return"pdf"===a&&(s=(0,X.jsx)(K.A,{style:{color:"#E53E3E"}})),["png","jpg","jpeg","gif","svg","bmp"].includes(a)&&(s=(0,X.jsx)(J.A,{style:{color:"#319795"}})),(0,X.jsx)(U.A,{title:n,children:(0,X.jsx)("span",{style:{maxWidth:280,display:"inline-block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:(0,X.jsxs)(M.A,{align:"center",children:[s,(0,X.jsx)("span",{children:n.replace(/\.docx$/i,"")})]})})})}},{title:"Status",dataIndex:"status",key:"status",render:(e,t)=>{const n=t||{},a=n.metadata&&!0===n.metadata.online||("number"===typeof n.length?n.length>0:Boolean(n.contentType)),s=a?"ONLINE":"OFFLINE",i=a?"green":"red";return(0,X.jsx)(z.A,{color:i,children:s})}},{title:"Uploaded On",dataIndex:"uploadDate",key:"uploadDate",sorter:(e,t)=>new Date(e.uploadDate).getTime()-new Date(t.uploadDate).getTime(),render:e=>e?(0,Q.Y)(e):""},{title:"Actions",key:"actions",render:(e,t)=>(0,X.jsx)(M.A,{children:(0,X.jsx)(F.Ay,{size:"small",icon:(0,X.jsx)(Z.A,{}),onClick:()=>ht(t),children:"Preview"})})}],rowClassName:e=>"",onRow:e=>{const t=lt(e._id),n=t&&(t._id||t.requestId);return{ref:e=>{n&&(Ne.current[n]=e)}}}})}),(0,X.jsx)(W.A,{title:oe?oe.filename.replace(/\.docx$/i,""):"",open:re,onCancel:()=>le(!1),footer:null,width:800,children:oe?(0,X.jsx)("div",{className:I,children:(0,X.jsx)(E.A,{dataSource:[(0,a.A)((0,a.A)({},oe),{},{requesterName:(null===(e=lt(oe._id))||void 0===e?void 0:e.username)||(null===(t=lt(oe._id))||void 0===t?void 0:t.requesterName)||"Unknown",barangayID:(null===(ee=lt(oe._id))||void 0===ee?void 0:ee.barangayID)||"Unknown",status:(null===(te=lt(oe._id))||void 0===te?void 0:te.status)||"Unknown"})],pagination:!1,rowKey:"_id",columns:[{title:"Requester Name",dataIndex:"requesterName",key:"requesterName",render:e=>e||"Unknown"},{title:"Barangay ID",dataIndex:"barangayID",key:"barangayID",render:e=>e||"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>e||"Unknown"},{title:"Actions",key:"actions",render:(e,t)=>(0,X.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,X.jsx)("button",{style:{background:"#2196F3",color:"#fff",border:"none",borderRadius:6,padding:"4px 12px",cursor:"pointer",fontWeight:600},onClick:()=>ct(t),children:"Process"}),(0,X.jsx)("button",{style:{background:"#43D96B",color:"#fff",border:"none",borderRadius:6,padding:"4px 12px",cursor:"pointer",fontWeight:600},children:"Complete"}),(0,X.jsx)("button",{style:{background:"#FF3B3B",color:"#fff",border:"none",borderRadius:6,padding:"4px 12px",cursor:"pointer",fontWeight:600},children:"Reject"})]})}]})}):(0,X.jsx)(D.A,{})}),(0,X.jsx)(W.A,{title:"Generated / Processed Copy Saved",open:We,onCancel:()=>Ye(!1),footer:[(0,X.jsx)(F.Ay,{onClick:()=>Ye(!1),children:"Close"},"close")],children:(0,X.jsxs)("div",{children:[(0,X.jsx)("div",{style:{marginBottom:8},children:"A copy of the generated document was saved."}),Ee?(0,X.jsxs)("div",{style:{marginBottom:10},children:[(0,X.jsxs)("div",{style:{marginBottom:6},children:[(0,X.jsx)("strong",{children:"Generated metadata ID:"})," ",(0,X.jsx)("code",{children:Ee})]}),(0,X.jsx)("div",{children:(0,X.jsx)("a",{href:"".concat($.API_URL.replace(/\/$/,""),"/generated-documents/").concat(Ee,"/raw"),target:"_blank",rel:"noreferrer",children:"Open generated copy (generated_documents)"})})]}):null,He?(0,X.jsxs)("div",{children:[(0,X.jsxs)("div",{style:{marginBottom:6},children:[(0,X.jsx)("strong",{children:"Processed document ID:"})," ",(0,X.jsx)("code",{children:He})]}),(0,X.jsx)("div",{children:(0,X.jsx)("a",{href:"".concat($.API_URL.replace(/\/$/,""),"/processed-documents/").concat(He,"/raw"),target:"_blank",rel:"noreferrer",children:"Open processed copy (processed_documents)"})})]}):null,Ee||He?null:(0,X.jsx)("div",{children:"No saved copy id available."})]})}),(0,X.jsx)(W.A,{title:"Prioritize Request",open:Re,onCancel:()=>qe(!1),onOk:async()=>{if(Oe)try{if($.documentsAPI.prioritize)await $.documentsAPI.prioritize(Oe);else if($.documentsAPI.updateDocumentStatus){var e;let t=null;for(const e of Object.values(he)){const n=(Array.isArray(e)?e:[e]).find(e=>(e._id||e.requestId)===Oe);if(n){t=n;break}}const n=(null===(e=t)||void 0===e?void 0:e.status)||"pending";await $.documentsAPI.updateDocumentStatus(Oe,{status:n,notes:"PRIORITY"})}if(qe(!1),await dt(),ze)try{const e=rt(ze);let n=e.find(e=>(e._id||e.requestId)===Oe)||null;if(!n&&$.documentsAPI.getDocumentById)try{n=await $.documentsAPI.getDocumentById(Oe)}catch(t){n=null}me(n?t=>{const n=(0,a.A)({},t);return n[ze]=Array.isArray(e)?e:e?[e]:[],n}:e=>{try{const t=(0,a.A)({},e),n=t[ze],s=Array.isArray(n)?n.slice():n?[n]:[],i=s.findIndex(e=>(e._id||e.requestId)===Oe);return-1!==i&&(s[i]=(0,a.A)((0,a.A)({},s[i]),{},{priority:!0,notes:(s[i].notes||"")+" PRIORITY"})),t[ze]=s,t}catch(t){return e}})}catch(t){}if(oe&&ze&&oe._id===ze){const e=rt(ze);ve(e),Se(Oe),Oe&&await ut(Oe)}alert("Prioritization saved"),Fe(null)}catch(n){console.error(n),alert("Failed to prioritize")}else alert("Select a request to prioritize")},okText:"Save Priority",cancelText:"Cancel",okButtonProps:{disabled:0===Be.length||!Oe},children:0===Be.length?(0,X.jsx)("div",{children:"No other requests found for this document type."}):(0,X.jsx)(Y.Ay.Group,{onChange:e=>Ue(e.target.value),value:Oe,style:{display:"flex",flexDirection:"column",gap:8},children:Be.map(e=>(0,X.jsxs)(Y.Ay,{value:e.requestId||e.fileId,style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,X.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,X.jsx)("strong",{children:e.requesterName}),(0,X.jsx)("small",{style:{color:"#666"},children:e.createdAt?(0,Q.Y)(e.createdAt):""})]}),(0,X.jsx)("div",{style:{marginLeft:12},children:Oe===(e.requestId||e.fileId)?(0,X.jsx)(z.A,{color:"red",children:"Selected"}):null})]},e.requestId||e.fileId))})}),(0,X.jsx)(W.A,{title:oe?"Preview: ".concat(oe.filename.replace(/\.docx$/i,"")):"Preview",open:pe,onCancel:()=>xe(!1),footer:null,width:Ge?"100%":900,bodyStyle:{padding:Ge?10:void 0},children:ye?(0,X.jsx)(D.A,{}):(0,X.jsxs)(X.Fragment,{children:[Ge?(0,X.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginBottom:8},children:(0,X.jsx)(F.Ay,{size:"small",onClick:()=>ke(e=>!e),children:Ce?"Hide Requests":"Show Requests"})}):null,(0,X.jsxs)("div",{className:S,children:[(0,X.jsx)("div",{className:C,children:(0,X.jsx)("div",{className:N,dangerouslySetInnerHTML:{__html:ge}})}),Ce?(0,X.jsx)("div",{className:k,children:(0,X.jsxs)("div",{style:{marginTop:Ge?6:12,padding:8,border:"1px solid #eee",borderRadius:6},children:[(0,X.jsx)("div",{style:{marginBottom:8,fontWeight:600},children:"Select Request to Preview"}),(0,X.jsx)("div",{style:{maxHeight:300,overflowY:"auto",paddingRight:6},children:(0,X.jsx)(Y.Ay.Group,{value:Ie,onChange:async e=>{const t=e.target.value;Se(t),await ut(t)},style:{display:"flex",flexDirection:"column",gap:8},children:je&&je.length?je.map(e=>(0,X.jsx)(Y.Ay,{value:e._id||e.requestId,children:(0,X.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,X.jsxs)("div",{children:[(0,X.jsx)("div",{style:{fontWeight:600},children:e.username||e.requesterName||"Unknown"}),(0,X.jsx)("div",{style:{fontSize:12,color:"#666"},children:e.createdAt?(0,Q.Y)(e.createdAt):""})]}),(0,X.jsx)("div",{style:{alignSelf:"center"},children:e.notes&&e.notes.toString().toLowerCase().includes("priority")||e.priority?(0,X.jsx)(z.A,{color:"red",children:"PRIORITY"}):null})]})},e._id||e.requestId)):(0,X.jsx)("div",{style:{color:"#666"},children:"No pending requests available for this file."})})})]})}):null]}),(0,X.jsx)("div",{className:T,children:(0,X.jsx)("button",{className:_,onClick:async()=>{if(oe){try{var e;let i=null;if(Ie){i=rt(oe._id).find(e=>(e._id||e.requestId)===Ie)||null}if(i||(i=ot(oe._id)||lt(oe._id)),!i||!i.fieldValues)return void alert("No document request or field values found for this file.");const r=await async function(e,t,n){const a={fieldValues:t};n&&(a.requestId=n);const s=await $.axiosInstance.post("/documents/".concat(e,"/generate-filled"),a,{responseType:"blob"}),i=s.headers["content-disposition"]||s.headers["Content-Disposition"];let r="";if(i){const e=i.match(/filename\*=(?:UTF-8'')?([^;\n\r]+)/i),t=i.match(/filename="?([^";]+)"?/i);if(e&&e[1])try{r=decodeURIComponent(e[1].replace(/^UTF-8''/,""))}catch(m){r=e[1]}else t&&t[1]&&(r=t[1])}const l=s.headers["x-filled-file-id"]||s.headers["X-Filled-File-Id"]||null,o=s.headers["x-processed-gridfs-id"]||s.headers["X-Processed-GridFS-Id"]||null,d=o||l,c=s.headers["x-generated-doc-id"]||s.headers["X-Generated-Doc-Id"]||null,u=s.headers["x-processed-doc-id"]||s.headers["X-Processed-Doc-Id"]||null,h=s.headers["x-transaction-code"]||s.headers["X-Transaction-Code"]||null;return console.log("[generateFilledDocx] transactionCode=",h,"content-disposition filename=",r),{blob:s.data,filename:r,savedId:d,generatedCopyId:c,processedDocId:u,processedGridFsId:o,transactionCode:h}}(oe._id,i.fieldValues,i._id||i.requestId),l=r.blob,o=i&&(i.transactionCode||i.transactionId||i.txId||i.transaction_id||i._id||i.requestId)||r.transactionCode||r.generatedCopyId||r.processedDocId||null,d=o?String(o).replace(/[^a-zA-Z0-9-_.]/g,"_"):null,c=r.transactionCode||i&&i.transactionCode||d||null,u=c?"".concat(String(c).replace(/[^a-zA-Z0-9-_.]/g,"_"),".docx"):r.filename||"filled_".concat(oe.filename||"document",".docx"),h=window.URL.createObjectURL(new Blob([l],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"})),m=document.createElement("a");m.href=h,m.setAttribute("download",u),document.body.appendChild(m),m.click(),null===(e=m.parentNode)||void 0===e||e.removeChild(m),window.URL.revokeObjectURL(h);if(r.savedId||null){await dt();const e=r.processedDocId||null;e?(H.Ay.open({message:"Generated copy saved",description:(0,X.jsxs)("div",{children:["Saved to processed documents. ",(0,X.jsx)("a",{href:"".concat($.API_URL.replace(/\/$/,""),"/processed-documents/").concat(e,"/raw"),target:"_blank",rel:"noreferrer",children:"Open processed copy"})]}),duration:8}),Ve(e),Ye(!0)):H.Ay.open({message:"Generated document saved",description:"Saved to server processed documents.",duration:6}),r.generatedCopyId&&(Me(r.generatedCopyId),Ye(!0))}else try{const e=new FormData;e.append("file",new Blob([l],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),u),e.append("sourceTemplateId",oe._id||""),e.append("requestId",i._id||i.requestId||"");const n=$.API_URL.replace(/\/$/,"");let a=!1;const s=["".concat(n,"/processed-documents/upload"),"".concat(n,"/documents/upload-inline"),"".concat(n,"/documents/upload"),"".concat(n,"/documents"),"".concat(n,"/admin/documents/upload")];for(const i of s)try{if((await fetch(i,{method:"POST",body:e,credentials:"include"})).ok){a=!0;break}}catch(t){}if(a){await dt();const e=r.processedDocId||null;e?(H.Ay.open({message:"Generated copy saved",description:(0,X.jsxs)("div",{children:["Saved to processed documents. ",(0,X.jsx)("a",{href:"".concat($.API_URL.replace(/\/$/,""),"/processed-documents/").concat(e,"/raw"),target:"_blank",rel:"noreferrer",children:"Open processed copy"})]}),duration:8}),Ve(e),Ye(!0)):H.Ay.open({message:"Generated document uploaded",description:"Uploaded to server processed documents.",duration:6})}else console.warn("Upload fallback failed; generated file was downloaded but not uploaded to documents collection."),alert("Generated document downloaded. Server-side save not confirmed.")}catch(a){console.error("Upload fallback error",a),alert("Generated document downloaded but upload to server failed.")}try{let e=Ie;if(!e){const t=ot(oe._id)||lt(oe._id);e=t&&(t._id||t.requestId)||null}e&&($.documentsAPI.updateDocumentStatus?await $.documentsAPI.updateDocumentStatus(e,{status:"approved"}):await(await Promise.resolve().then(n.bind(n,31694))).axiosInstance.patch("/document-requests/".concat(e,"/process")),await dt(),xe(!1),alert("Request marked as completed."))}catch(s){console.warn("Failed to mark request complete after generation",(null===s||void 0===s?void 0:s.message)||s)}}catch(i){console.error("Generation error",i),alert("Failed to generate filled document.")}xe(!1)}},children:"Generate"})})]})})]})}}}]);
//# sourceMappingURL=87.7bda7803.chunk.js.map