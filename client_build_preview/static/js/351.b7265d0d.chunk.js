"use strict";(self.webpackChunkclient=self.webpackChunkclient||[]).push([[351],{24351:(e,t,n)=>{n.r(t),n.d(t,{default:()=>ia});var a=n(89379),s=n(65043),i=n(16569),r=n(89073),l=n(47419),o=n(11645),d=n(65512),c=n(36621),u=n(15492),h=n(79617),m=n(8354),p=n(91686),x=n(70644),g=n(54522),f=n(76399),y=n(45964),A=n(70494),j=n(58288),v=n(28795),b=n(42971),w=n(68397),S=n(70579);const{Option:I}=d.A,C={status:"all",search:""};var k=n(31694);const N=()=>{const[e,t]=(0,s.useState)(!0),[n,I]=(0,s.useState)([]),[N,T]=(0,s.useState)(C),[D,P]=(0,s.useState)("All"),[R,q]=(0,s.useState)({}),[B,L]=(0,s.useState)({}),[O,_]=(0,s.useState)(null),[z,F]=(0,s.useState)(!1),[E,U]=(0,s.useState)(!1),[M,W]=(0,s.useState)(!0),[Y,H]=(0,s.useState)(""),[G,V]=(0,s.useState)([]),[K,J]=(0,s.useState)(!1),$=(0,s.useRef)(null);(0,s.useEffect)(()=>{$.current&&$.current.scrollIntoView({behavior:"smooth"})},[O,O&&O.responses&&O.responses.length]);const Z=(()=>{try{return localStorage.getItem("userProfile")?JSON.parse(localStorage.getItem("userProfile")||"null"):null}catch(e){return null}})();(0,s.useEffect)(()=>{t(!0),k.contactAPI.getMyInquiries().then(e=>{I(e||[])}).catch(()=>{i.Ay.error("Failed to load inbox.")}).finally(()=>t(!1))},[]);const Q=n.filter(e=>{let t=!0;"pending"===N.status&&(t=!e.responses||0===e.responses.length),"responded"===N.status&&(t="resolved"===e.status||e.responses&&e.responses.length>0),"closed"===N.status&&(t="closed"===e.status);let n=!0;D&&"All"!==D&&(n=e.category===D);const a=N.search.toLowerCase(),s=!a||e.residentName&&e.residentName.toLowerCase().includes(a)||e.category&&e.category.toLowerCase().includes(a)||e.subject&&e.subject.toLowerCase().includes(a)||e.createdAt&&new Date(e.createdAt).toLocaleString().toLowerCase().includes(a);return t&&s&&n}),X=e=>{J(!0),W(!1),setTimeout(()=>{_(e),J(!1),F(!0)},250)},ee=e=>{if(!e)return"";const t=Date.now()-new Date(e).getTime(),n=Math.floor(t/6e4);if(n<1)return"just now";if(n<60)return"".concat(n,"m");const a=Math.floor(n/60);if(a<24)return"".concat(a,"h");const s=Math.floor(a/24);return"".concat(s,"d")},te=e=>{let{author:t,avatar:n,content:a,datetime:s,align:i="left"}=e;return(0,S.jsx)("div",{style:{display:"flex",justifyContent:"left"===i?"flex-start":"flex-end"},children:(0,S.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"flex-start",maxWidth:"80%"},children:["left"===i&&n,(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{style:{fontSize:13,fontWeight:600},children:t}),(0,S.jsx)("div",{style:{marginTop:6},children:a}),s&&(0,S.jsx)("div",{style:{marginTop:6,fontSize:12,color:"#777"},children:s})]}),"right"===i&&n]})})},ne=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?";if(!e)return t;try{const n=String(e).trim();return n.length>0?n.charAt(0).toUpperCase():t}catch(n){return t}};return(0,S.jsx)("div",{style:{minHeight:"100vh",background:"#f0f4f8",padding:"24px",fontFamily:"Poppins, Arial, sans-serif",position:"relative"},children:(0,S.jsxs)(r.A,{style:{maxWidth:1200,margin:"0 auto",borderRadius:18,boxShadow:"0 8px 32px 0 rgba(31, 38, 135, 0.08)",padding:0,background:"#fff"},bodyStyle:{padding:0,background:"#fff"},children:[(0,S.jsxs)("div",{style:{padding:"24px 32px 0 32px"},children:[(0,S.jsxs)(l.A,{gutter:[12,12],align:"middle",style:{marginBottom:12},children:[(0,S.jsx)(o.A,{xs:24,sm:6,children:(0,S.jsxs)(d.A,{value:D,onChange:e=>P(e),style:{width:"100%"},children:[(0,S.jsx)(d.A.Option,{value:"All",children:"All"}),(0,S.jsx)(d.A.Option,{value:"Complaints",children:"Complaints"}),(0,S.jsx)(d.A.Option,{value:"Requests",children:"Requests"}),(0,S.jsx)(d.A.Option,{value:"Announcements",children:"Announcements"})]})}),(0,S.jsx)(o.A,{xs:24,sm:12,children:(0,S.jsx)(c.A.Search,{placeholder:"Search by date, name, or category",allowClear:!0,value:N.search,onChange:e=>T(t=>(0,a.A)((0,a.A)({},t),{},{search:e.target.value})),onSearch:e=>T(t=>(0,a.A)((0,a.A)({},t),{},{search:e}))})}),(0,S.jsxs)(o.A,{xs:24,sm:6,style:{display:"flex",alignItems:"center",justifyContent:"flex-end",gap:8},children:[(0,S.jsx)("div",{style:{flex:1}}),(0,S.jsx)(u.Ay,{type:"text",onClick:()=>U(e=>!e),style:{borderRadius:8},title:E?"Show conversation list":"Hide conversation list",icon:E?(0,S.jsx)(j.A,{}):(0,S.jsx)(v.A,{})})]})]}),(0,S.jsxs)(h.A.Title,{level:3,style:{marginBottom:0,color:"#1890ff",display:"flex",alignItems:"center",gap:8,fontFamily:"Poppins, Arial, sans-serif"},children:[(0,S.jsx)("span",{role:"img","aria-label":"inbox",children:"\ud83d\udce9"})," Inbox"]})]}),(0,S.jsx)(m.A,{style:{margin:"16px 0 0 0"}}),(0,S.jsx)("div",{style:{padding:"0 32px 32px 32px"},children:e?(0,S.jsx)(p.A,{}):0===Q.length?(0,S.jsx)(x.Ay,{icon:(0,S.jsx)(b.A,{}),status:"info",title:"No messages yet",subTitle:"There are no messages in your inbox."}):(0,S.jsxs)("div",{style:{display:"flex",gap:16},children:[E?(0,S.jsxs)("div",{style:{width:72,maxHeight:500,overflowY:"auto",display:"flex",flexDirection:"column",alignItems:"center",gap:8,paddingTop:8},children:[(0,S.jsx)(u.Ay,{type:"text",onClick:()=>U(!1),style:{borderRadius:8,background:"#fff",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},title:"Show list",children:(0,S.jsx)(j.A,{})}),(0,S.jsx)("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:8,padding:8},children:Q.map(e=>{const t=e.residentName||e.username||e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||e.subject||"Unknown",n=t&&"Unknown"!==t?ne(t,"?"):"?",a=O&&O._id===e._id;return(0,S.jsx)(A.A,{title:"".concat(t," \u2014 ").concat(e.subject||"No subject"),placement:"right",children:(0,S.jsx)("button",{onClick:()=>X(e),style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",padding:6,borderRadius:8,border:a?"2px solid #1890ff":"1px solid transparent",background:a?"#e6f7ff":"transparent",cursor:"pointer"},"aria-label":t,children:(0,S.jsx)(y.A,{style:{background:"#1890ff",color:"#fff",fontWeight:700},size:36,children:n})})},e._id)})})]}):(0,S.jsxs)("div",{style:{flex:M?1:"0 0 300px",maxHeight:M?"calc(100vh - 220px)":500,overflowY:"auto",position:"relative"},children:[(0,S.jsx)(u.Ay,{type:"text",onClick:()=>U(!0),style:{position:"absolute",right:-12,top:-8,zIndex:10,borderRadius:8,background:"#fff",boxShadow:"0 2px 8px rgba(0,0,0,0.06)"},title:"Collapse list",children:(0,S.jsx)(v.A,{})}),(0,S.jsx)(g.A,{itemLayout:"vertical",dataSource:Q,renderItem:e=>{const t="resolved"===e.status?(0,S.jsx)(f.A,{color:"green",children:"Resolved"}):Array.isArray(e.responses)&&e.responses.length>0?null:(0,S.jsx)(f.A,{color:"gold",children:"Pending"}),n=(()=>{switch((e.category||"").toLowerCase()){case"complaints":return"\ud83d\uded1";case"requests":return"\ud83d\udce8";case"announcements":return"\ud83d\udce3";default:return"\u2709\ufe0f"}})(),a=O&&O._id===e._id;return(0,S.jsx)(g.A.Item,{style:{marginBottom:8,background:a?"#f7fbff":"#fff",borderRadius:12,border:"1px solid #e6edf3",boxShadow:"0 1px 4px rgba(31,38,135,0.04)",cursor:"pointer"},onClick:()=>X(e),children:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"12px 10px",gap:10},children:[(0,S.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:0},children:[(0,S.jsx)("span",{style:{fontSize:18},children:n}),(0,S.jsx)(h.A.Text,{strong:!0,style:{fontSize:14,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flex:1},children:e.residentName||e.username||e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||"Unknown"}),(0,S.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:12,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["\u2014 ",e.subject||"No subject"]}),(0,S.jsx)("span",{style:{marginLeft:"auto",fontSize:11,color:"#888"},children:e.createdAt?ee(e.createdAt):""}),t?s.cloneElement(t,{style:{fontSize:11,padding:"0 6px",marginLeft:8}}):null]}),(0,S.jsx)("div",{style:{marginTop:6},children:(0,S.jsx)(h.A.Text,{type:"secondary",style:{display:"block",margin:0,fontSize:13,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.message})}),(0,S.jsx)("div",{style:{marginTop:6},children:Array.isArray(e.responses)&&e.responses.length>0?(0,S.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:12},children:[e.responses.length," response(s)"]}):(0,S.jsx)(h.A.Text,{type:"secondary",style:{fontSize:12},children:"No responses yet"})})]}),(0,S.jsx)("div",{style:{flexShrink:0,marginLeft:10},children:(()=>{const t=e.residentName||e.username||e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||e.subject||"Unknown",n=t&&"Unknown"!==t?ne(t,"?"):"?";return(0,S.jsx)(y.A,{style:{background:"#1890ff",color:"#fff",fontWeight:700},size:36,children:n})})()})]})})}})]}),!M&&(0,S.jsxs)("div",{style:{flex:1},children:[")",(0,S.jsx)(r.A,{style:{borderRadius:12,height:"100%",background:"transparent",boxShadow:"none",border:"none"},bodyStyle:{display:"flex",flexDirection:"column",padding:0,gap:10,background:"transparent"},children:O?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,S.jsx)("div",{style:{display:"flex",gap:6,alignItems:"center"},children:"resolved"===O.status?(0,S.jsx)(f.A,{color:"green",children:"Resolved"}):(0,S.jsx)(f.A,{color:"gold",children:"Pending"})}),(0,S.jsx)("div",{style:{flex:1},children:(()=>{const e=O.residentName||O.username||O.subject||"Unknown";return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(h.A.Text,{strong:!0,style:{display:"block",textAlign:"right",fontSize:15},children:e}),(0,S.jsx)(h.A.Text,{type:"secondary",style:{fontSize:10,display:"block",textAlign:"right"},children:O.createdAt?new Date(O.createdAt).toLocaleString():""})]})})()}),(()=>{const e=O.residentName||O.username||O.createdBy&&(O.createdBy.fullName||O.createdBy.username)||O.subject||"Unknown",t=e&&"Unknown"!==e?ne(e,"?"):"?";return(0,S.jsx)(y.A,{size:40,style:{background:"#1890ff"},children:t})})()]}),(0,S.jsx)(m.A,{}),(0,S.jsxs)("div",{style:{overflowY:"auto",flex:1,display:"flex",flexDirection:"column",gap:10,paddingRight:6,minHeight:0,maxHeight:220},children:[(0,S.jsx)("div",{style:{alignSelf:"flex-end",maxWidth:"100%"},children:(()=>{const e=O.residentName||O.username||O.createdBy&&(O.createdBy.fullName||O.createdBy.username)||"Resident",t=e&&"Resident"!==e?ne(e,"U"):"U";return(0,S.jsx)(te,{author:e,avatar:(0,S.jsx)(y.A,{style:{background:"#1890ff"},children:t}),content:(0,S.jsxs)("div",{style:{background:"#e6f7ff",padding:10,borderRadius:8},children:[(0,S.jsx)(h.A.Paragraph,{style:{margin:0},children:O.message}),O.attachments&&O.attachments.length>0&&(0,S.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:O.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,S.jsx)("div",{children:s?(0,S.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:(0,S.jsx)("img",{src:n,alt:a,style:{maxWidth:220,maxHeight:140,borderRadius:8,objectFit:"cover",border:"1px solid #f0f0f0"}})}):(0,S.jsxs)("div",{children:[(0,S.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,S.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),datetime:(0,S.jsx)("span",{style:{fontSize:12},children:O.createdAt?new Date(O.createdAt).toLocaleString():""}),align:"right"})})()}),Array.isArray(O.responses)&&O.responses.map((e,t)=>{let n=(e.role||e.authorRole||e.author_role||""||"").toString().toLowerCase();const a=e.author||e.authorName||e.author_name||e.createdByName||e.createdByFullName||e.userName||e.user||"",s=e.createdBy?String(e.createdBy):void 0,i=Z&&(Z._id||Z.id)?String(Z._id||Z.id):void 0;if(!n)try{let t;O&&(O.createdBy&&"string"===typeof O.createdBy?t=String(O.createdBy):O.createdBy&&"object"===typeof O.createdBy&&(O.createdBy._id||O.createdBy.id)?t=String(O.createdBy._id||O.createdBy.id):O.residentId&&(t=String(O.residentId)));const i=O&&(O.residentName||O.username)?String(O.residentName||O.username).toLowerCase():"",r=(a||e.authorName||"").toString().toLowerCase();(t&&s&&t===s||i&&r&&i===r)&&(n="resident")}catch(u){}let r;if(a&&""!==a.trim())r=a;else if(i&&s&&i===s)r="You";else if(e.authorName&&""!==e.authorName.trim())r=e.authorName;else if(e.createdBy&&"object"===typeof e.createdBy&&(e.createdBy.fullName||e.createdBy.username))r=e.createdBy.fullName||e.createdBy.username;else if(e.createdByName&&"string"===typeof e.createdByName&&""!==e.createdByName.trim())r=e.createdByName;else if(e.user&&"object"===typeof e.user&&(e.user.fullName||e.user.username))r=e.user.fullName||e.user.username;else if("resident"===n)r=O&&(O.residentName||O.username)?O.residentName||O.username:"Resident";else{let t;try{if(s&&O&&Array.isArray(O.assignedTo)){const e=O.assignedTo.find(e=>String(e._id)===String(s));e&&(t=e.fullName||e.username)}}catch(u){}r=e.staffName||e.staffFullName||e.createdBy&&"object"===typeof e.createdBy&&(e.createdBy.fullName||e.createdBy.username)||t||"Staff"}const l="resident"===n||"user"===n,o=i&&s&&i===s,d=l||o?"right":"left",c=l||o?(0,S.jsx)(y.A,{style:{background:"#1890ff"},children:ne(r,"U")}):(0,S.jsx)(y.A,{style:{background:"#666"},children:ne(r,"B")});return(0,S.jsx)("div",{style:{alignSelf:l||o?"flex-end":"flex-start",maxWidth:"100%"},children:(0,S.jsx)(te,{author:o?"You":r,avatar:c,content:(0,S.jsxs)("div",{style:{background:l||o?"#e6f7ff":"#f6f6f6",padding:10,borderRadius:8},children:[(0,S.jsx)(h.A.Paragraph,{style:{margin:0},children:e.text}),e.attachments&&e.attachments.length>0&&(0,S.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:e.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,S.jsx)("div",{children:s?(0,S.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:(0,S.jsx)("img",{src:n,alt:a,style:{maxWidth:220,maxHeight:140,borderRadius:8,objectFit:"cover",border:"1px solid #f0f0f0"}})}):(0,S.jsxs)("div",{children:[(0,S.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,S.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),datetime:(0,S.jsx)("span",{style:{fontSize:12},children:e.createdAt?new Date(e.createdAt).toLocaleString():""}),align:d})},t)}),(0,S.jsx)("div",{ref:$})]}),(0,S.jsx)("div",{style:{marginTop:0,flexShrink:0},children:(0,S.jsxs)("div",{style:{background:"#fff",paddingTop:4,paddingBottom:4,borderTop:"1px solid #f0f0f0",display:"flex",alignItems:"flex-end",gap:8},children:[(0,S.jsx)("textarea",{value:Y,onChange:e=>{H(e.target.value);const t=e.target;t.style.height="auto",t.style.height=Math.min(200,t.scrollHeight)+"px"},onKeyDown:async e=>{if("Enter"===e.key&&!e.shiftKey){if(e.preventDefault(),!Y||""===Y.trim())return i.Ay.warning("Reply cannot be empty");if(!O||!O._id)return i.Ay.error("No inquiry selected");const n=O._id;L(e=>(0,a.A)((0,a.A)({},e),{},{[n]:!0}));try{const e=await k.contactAPI.respondToInquiry(O._id,{response:Y.trim()});I(t=>t.map(t=>t._id===e._id?e:t)),_(e),H(""),i.Ay.success("Reply sent")}catch(t){console.error("Failed to send reply",t),i.Ay.error("Failed to send reply")}finally{L(e=>(0,a.A)((0,a.A)({},e),{},{[n]:!1}))}}},placeholder:"Type your reply...",style:{width:"100%",minHeight:40,maxHeight:200,resize:"none",padding:"10px 12px",borderRadius:12,border:"1px solid #e6edf3",boxShadow:"0 1px 4px rgba(15, 23, 42, 0.04)",fontSize:14,outline:"none",fontFamily:"Poppins, Arial, sans-serif",color:"#222"}}),(0,S.jsx)("div",{style:{display:"flex",alignItems:"center"},children:(0,S.jsx)("button",{onClick:async()=>{if(!Y||""===Y.trim())return i.Ay.warning("Reply cannot be empty");if(!O||!O._id)return i.Ay.error("No inquiry selected");const e=O._id;L(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!0}));try{const e=await k.contactAPI.respondToInquiry(O._id,{response:Y.trim()});I(t=>t.map(t=>t._id===e._id?e:t)),_(e),H(""),i.Ay.success("Reply sent")}catch(t){console.error("Failed to send reply",t),i.Ay.error("Failed to send reply")}finally{L(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!1}))}},style:{background:"#0ea5a3",color:"#fff",border:"none",padding:"8px 14px",borderRadius:10,cursor:"pointer",fontSize:18,fontWeight:600,boxShadow:"0 4px 10px rgba(14,165,163,0.12)",display:"flex",alignItems:"center",justifyContent:"center"},title:"Send Reply",onMouseOver:e=>e.currentTarget.style.opacity="0.95",onMouseOut:e=>e.currentTarget.style.opacity="1",disabled:!(!O||!B[O._id]),children:(0,S.jsx)(w.A,{style:{fontSize:22,verticalAlign:"middle"}})})})]})})]}):(0,S.jsx)("div",{style:{textAlign:"center",padding:32},children:(0,S.jsx)(h.A.Text,{type:"secondary",children:"Select a message to view the conversation"})})})]})]})})]})})};var T=n(27297),D=n(61118),P=n(92003),R=n(9316),q=n(75698);const B=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(null),[r,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(!1),[c,h]=(0,s.useState)(null),[m,p]=(0,s.useState)(null),[x,g]=(0,s.useState)(null),[f,y]=(0,s.useState)("");return s.useEffect(()=>{(async()=>{d(!0),h(null);try{const e=await fetch("/api/documents/list");if(!e.ok)throw new Error("Failed to fetch templates");const n=await e.json();t(n)}catch(e){h("Could not load templates.")}d(!1)})()},[]),(0,S.jsxs)("div",{style:{padding:"2rem",background:"#f3f4f6",borderRadius:"16px",boxShadow:"0 2px 8px #e5e7eb",maxWidth:"2000px",margin:"2rem auto"},children:[(0,S.jsx)("h2",{style:{fontWeight:"bold",fontSize:"1.5rem",marginBottom:"1.5rem"},children:"\ud83d\udcc2 Templates Manager"}),(0,S.jsxs)("div",{style:{marginBottom:32},children:[(0,S.jsx)("h3",{style:{fontWeight:"bold",fontSize:"1.1rem",marginBottom:"0.5rem",color:"#374151"}}),o&&(0,S.jsx)("div",{children:"Loading templates..."}),c&&(0,S.jsx)("div",{style:{color:"red"},children:c}),(0,S.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"1.5rem"},children:e.filter(e=>e&&e.filename).map(e=>{return(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"row",alignItems:"center",padding:"1.5rem 2rem",border:"1px solid #e5e7eb",borderRadius:"12px",background:"#fff",color:"#374151",width:"500px",minHeight:"100px",boxShadow:"0 1px 4px rgba(0,0,0,0.04)",marginBottom:"1rem",position:"relative"},children:[(0,S.jsx)("img",{src:"/word.png",alt:"Word Icon",style:{width:56,height:56,marginRight:24}}),(0,S.jsxs)("div",{style:{flex:1},children:[(0,S.jsx)("span",{style:{fontWeight:"bold",fontSize:"1.1rem",marginBottom:4,display:"block"},children:(s=e.filename,s?s.replace(/_/g," ").replace(/\.docx$/,""):"Untitled")}),(0,S.jsxs)("div",{style:{display:"flex",gap:"1rem",marginTop:8},children:[(0,S.jsx)(A.A,{title:"Preview",children:(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(D.A,{}),onClick:async t=>{if(t.stopPropagation(),n===e._id)return a(null),void y("");a(e._id),y("");try{const t=await fetch("/api/documents/preview/".concat(e._id,"?format=html")),n=await t.text();y(n)}catch(s){y('<div style="color:red">Failed to load preview.</div>')}},children:"Preview"})}),(0,S.jsx)(A.A,{title:"Download",children:(0,S.jsx)(u.Ay,{type:"primary",icon:(0,S.jsx)(P.A,{}),onClick:async()=>{p(null);try{const t=await fetch("/api/documents/original/".concat(e._id));if(!t.ok)throw new Error("Download failed");const n=await t.blob(),a=window.URL.createObjectURL(n),s=document.createElement("a");s.href=a,s.download=e.filename,document.body.appendChild(s),s.click(),s.remove(),window.URL.revokeObjectURL(a)}catch(t){p("Failed to download ".concat(e.filename," from MongoDB."))}},children:"Download"})}),(0,S.jsx)(A.A,{title:"Remove",children:(0,S.jsx)(u.Ay,{danger:!0,icon:(0,S.jsx)(R.A,{}),onClick:async()=>{d(!0),h(null);try{const n=await fetch("/api/documents/file/".concat(e._id),{method:"DELETE"});if((await n.json()).success){const e=await fetch("/api/documents/list"),n=await e.json();t(n)}else h("Delete failed.")}catch(n){h("Delete failed.")}d(!1)},children:"Remove"})})]}),n===e._id&&f&&(0,S.jsxs)("div",{style:{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)",background:"#fff",border:"1px solid #e5e7eb",borderRadius:12,boxShadow:"0 4px 32px rgba(0,0,0,0.18)",padding:32,zIndex:1e3,minWidth:600,maxWidth:900,maxHeight:600,overflow:"auto"},children:[(0,S.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:12},children:[(0,S.jsx)("span",{style:{fontWeight:"bold",fontSize:"1.1rem"},children:"Preview"}),(0,S.jsx)("button",{style:{background:"#ef4444",color:"white",border:"none",borderRadius:4,padding:"4px 12px",cursor:"pointer"},onClick:()=>{a(null),y("")},children:"Close"})]}),(0,S.jsx)("div",{dangerouslySetInnerHTML:{__html:f}})]})]})]},e._id);var s})})]}),m&&(0,S.jsx)("div",{style:{color:"red",marginBottom:16},children:m}),(0,S.jsx)("div",{style:{marginTop:32},children:(0,S.jsx)(T.A,{accept:".docx",showUploadList:!1,customRequest:async e=>{let{file:n,onSuccess:a,onError:s}=e;d(!0),h(null);const r=new FormData;r.append("file",n);try{const e=await fetch("/api/documents/upload",{method:"POST",body:r});if((await e.json()).success){const e=await fetch("/api/documents/list"),n=await e.json();t(n),i.Ay.success("Upload successful"),a&&a("ok")}else h("Upload failed."),i.Ay.error("Upload failed"),s&&s(new Error("Upload failed"))}catch(l){h("Upload failed."),i.Ay.error("Upload failed"),s&&s(new Error("Upload failed"))}d(!1)},children:(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(q.A,{}),type:"primary",children:"Upload .docx"})})})]})};var L=n(25352),O=n(23811),_=n(63942),z=n(73847),F=n(31219);const E=()=>{const[e,t]=(0,s.useState)(!0),[n,f]=(0,s.useState)([]),[A,j]=(0,s.useState)({status:"all",search:""}),[v,I]=(0,s.useState)("All"),[C,N]=(0,s.useState)(null),[T,D]=(0,s.useState)(""),[P,R]=(0,s.useState)({}),[q,B]=(0,s.useState)(!1),[E,U]=(0,s.useState)(!1),[M,W]=(0,s.useState)([]),Y=(0,L.zy)(),H=(0,s.useRef)(null);(0,s.useEffect)(()=>{G();const e=Y&&Y.state||{};if(e&&e.openInquiryId){const t=e.openInquiryId,a=setInterval(()=>{const e=n.find(e=>e._id===t);e&&(N(e),clearInterval(a))},200);setTimeout(async()=>{if(!n.find(e=>e._id===t))try{const e=await k.contactAPI.getInquiryById(t);e&&N(e)}catch(e){}},3e3)}},[]);const G=async()=>{t(!0);try{const e=await k.contactAPI.getAllInquiries();f(e||[])}catch(e){console.error("Failed to load inquiries",e)}finally{t(!1)}};(0,s.useEffect)(()=>{H.current&&H.current.scrollIntoView({behavior:"smooth"})},[C,C&&C.responses&&C.responses.length]);const V=e=>{if(!e)return"";const t=Date.now()-new Date(e).getTime(),n=Math.floor(t/6e4);if(n<1)return"just now";if(n<60)return"".concat(n,"m");const a=Math.floor(n/60);if(a<24)return"".concat(a,"h");const s=Math.floor(a/24);return"".concat(s,"d")},K=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"?";if(!e)return t;try{const n=String(e).trim();return n.length?n.charAt(0).toUpperCase():t}catch(n){return t}},J=e=>{let{author:t,avatar:n,content:a,datetime:s,align:i="left"}=e;return(0,S.jsx)("div",{style:{display:"flex",justifyContent:"left"===i?"flex-start":"flex-end"},children:(0,S.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"flex-start",maxWidth:"80%"},children:["left"===i&&n,(0,S.jsxs)("div",{children:[(0,S.jsx)("div",{style:{fontSize:13,fontWeight:600},children:t}),(0,S.jsx)("div",{style:{marginTop:6},children:a}),s&&(0,S.jsx)("div",{style:{marginTop:6,fontSize:12,color:"#888"},children:s})]}),"right"===i&&n]})})},$=async()=>{if(!T||!C||!C._id)return;const e=C._id;R(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!0}));try{if(C.isNewThread){let e=C.residentUsername||C.username||C.userName||C.author||C.createdBy&&(C.createdBy.username||C.createdBy.userName),t=C.residentBarangayID||C.barangayID||C.createdBy&&C.createdBy.barangayID;if(e&&""!==e||!C.createdBy||("string"===typeof C.createdBy?e=C.createdBy:(C.createdBy.username||C.createdBy.userName)&&(e=C.createdBy.username||C.createdBy.userName),!t&&C.createdBy&&C.createdBy.barangayID&&(t=C.createdBy.barangayID)),(!e||""===e)&&Array.isArray(M)&&C.residentName){const n=M.find(e=>e.label&&e.label.toString().toLowerCase()===(C.residentName||"").toString().toLowerCase());n&&(e=n.username||e,t=n.barangayID||t)}const n=(0,a.A)((0,a.A)({type:"staff_message",subject:"Message to ".concat(C.residentName),message:T.trim()},e?{username:e}:{}),t?{barangayID:t}:{});if(!n.username)return i.Ay.error("Please select a resident to send this message to."),void console.warn("Blocked staff-created inquiry without recipient",{selectedInquiry:C,residents:M});console.debug("Submitting staff-created inquiry payload",n,{selectedInquirySummary:{residentName:C.residentName,residentUsername:C.residentUsername,residentBarangayID:C.residentBarangayID}});const s=await k.contactAPI.submitInquiry(n);i.Ay.success("Message sent to ".concat(C.residentName||n.username)),f(e=>[s].concat(e)),N(s),D("")}else{const t=await k.contactAPI.respondToInquiry(e,{response:T.trim()});f(e=>e.map(e=>e._id===t._id?t:e)),N(t),D("")}}catch(t){console.error("reply failed",t)}finally{R(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!1}))}},Z=n.filter(e=>{let t=!0;"pending"===A.status&&(t=!e.responses||0===e.responses.length),"responded"===A.status&&(t="resolved"===e.status||e.responses&&e.responses.length>0),"closed"===A.status&&(t="closed"===e.status);let n=!0;v&&"All"!==v&&(n=e.category===v);const a=(A.search||"").toLowerCase(),s=!a||e.residentName&&e.residentName.toLowerCase().includes(a)||e.subject&&e.subject.toLowerCase().includes(a);return t&&n&&s});return(0,S.jsx)("div",{style:{minHeight:"100vh",background:"#f7f9fb",padding:24},children:(0,S.jsxs)(r.A,{style:{maxWidth:1200,margin:"0 auto",borderRadius:12},bodyStyle:{padding:0},children:[(0,S.jsx)("div",{style:{padding:20},children:(0,S.jsxs)(l.A,{gutter:[12,12],align:"middle",children:[(0,S.jsx)(o.A,{xs:24,sm:6,children:(0,S.jsxs)(d.A,{value:v,onChange:e=>I(e),style:{width:"100%"},children:[(0,S.jsx)(d.A.Option,{value:"All",children:"All"}),(0,S.jsx)(d.A.Option,{value:"Complaints",children:"Complaints"}),(0,S.jsx)(d.A.Option,{value:"Requests",children:"Requests"}),(0,S.jsx)(d.A.Option,{value:"Announcements",children:"Announcements"})]})}),(0,S.jsx)(o.A,{xs:24,sm:12,children:(0,S.jsx)(c.A.Search,{placeholder:"Search by name or subject",allowClear:!0,value:A.search,onChange:e=>j(t=>(0,a.A)((0,a.A)({},t),{},{search:e.target.value})),onSearch:e=>j(t=>(0,a.A)((0,a.A)({},t),{},{search:e}))})}),(0,S.jsx)(o.A,{xs:24,sm:6,children:(0,S.jsxs)(O.A,{activeKey:A.status||"all",onChange:e=>j(t=>(0,a.A)((0,a.A)({},t),{},{status:e})),children:[(0,S.jsx)(O.A.TabPane,{tab:"All"},"all"),(0,S.jsx)(O.A.TabPane,{tab:"Pending"},"pending"),(0,S.jsx)(O.A.TabPane,{tab:(0,S.jsxs)("span",{children:["Responded"," ",(0,S.jsx)(u.Ay,{type:"link",size:"small",style:{marginLeft:20},icon:(0,S.jsx)(z.A,{}),onClick:e=>{e.stopPropagation(),(async()=>{B(!0),U(!0);try{const e=(await k.adminAPI.getUsers()||[]).filter(e=>{const t=(e.role||e.type||"").toString().toLowerCase();return t.includes("resident")||!t.includes("admin")&&!t.includes("staff")}).map(e=>({label:e.fullName||(e.firstName&&e.lastName?"".concat(e.firstName," ").concat(e.lastName):e.username||e.email||e.name),username:e.username||e.userName||e.email||e._id,barangayID:e.barangayID||e.brgy||e.barangay&&(e.barangay.id||e.barangayID)}));W(e.filter(e=>e&&e.label))}catch(e){W([])}finally{U(!1)}})()}})]})},"responded")]})})]})}),(0,S.jsx)(m.A,{style:{margin:0}}),(0,S.jsx)(_.A,{title:"Residents",visible:q,onCancel:()=>B(!1),footer:null,children:E?(0,S.jsx)("div",{style:{textAlign:"center"},children:(0,S.jsx)(p.A,{})}):0===M.length?(0,S.jsx)(h.A.Text,{type:"secondary",children:"No residents found."}):(0,S.jsx)(g.A,{dataSource:M,renderItem:e=>(0,S.jsx)(g.A.Item,{style:{cursor:"pointer"},onClick:()=>{const t=e.label,a=e.username,s=e.barangayID,i=n.find(e=>{const n=(e.username||e.residentName||e.createdBy&&(e.createdBy.username||"")||"").toString().toLowerCase();return n&&(a?n===(a||"").toString().toLowerCase():n===(t||"").toString().toLowerCase())});if(i)N(i),B(!1);else{const e={_id:"new-".concat(Date.now()),residentName:t,residentUsername:a,residentBarangayID:s,message:"",responses:[],isNewThread:!0};N(e),console.debug("Resident selected for new thread",e),B(!1)}},children:(0,S.jsx)(g.A.Item.Meta,{avatar:(0,S.jsx)(y.A,{style:{background:"#1890ff"},children:K(e.label)}),title:e.label})})})}),(0,S.jsx)("div",{style:{padding:16},children:e?(0,S.jsx)(p.A,{}):0===Z.length?(0,S.jsx)(x.Ay,{icon:(0,S.jsx)(b.A,{}),title:"No inquiries",subTitle:"There are no inquiries to show."}):(0,S.jsxs)("div",{style:{display:"flex",gap:16},children:[(0,S.jsx)("div",{style:{width:320,maxHeight:520,overflowY:"auto"},children:(0,S.jsx)(g.A,{dataSource:Z,renderItem:e=>(0,S.jsx)(g.A.Item,{onClick:()=>(e=>{N(e)})(e),style:{cursor:"pointer",marginBottom:8,borderRadius:8,padding:8,border:C&&C._id===e._id?"1px solid #1890ff":"1px solid #eee"},children:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,S.jsx)(y.A,{style:{background:"#1890ff"},children:K(e.residentName||e.username||e.subject,"?")}),(0,S.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,S.jsx)(h.A.Text,{strong:!0,style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.residentName||e.username||"Unknown"}),(0,S.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:12},children:["\u2014 ",e.subject||"No subject"]}),(0,S.jsx)("span",{style:{marginLeft:"auto",fontSize:11},children:e.createdAt?V(e.createdAt):""})]}),(0,S.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:13,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.message})]})]})})})}),(0,S.jsx)("div",{style:{flex:1},children:(0,S.jsx)(r.A,{style:{borderRadius:8},bodyStyle:{display:"flex",flexDirection:"column",gap:12,padding:12},children:C?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,S.jsxs)("div",{style:{flex:1},children:[(0,S.jsx)(h.A.Text,{strong:!0,style:{display:"block"},children:C.residentName||C.username||"Unknown"}),(0,S.jsx)(h.A.Text,{type:"secondary",children:C.createdAt?new Date(C.createdAt).toLocaleString():""})]}),(0,S.jsx)(y.A,{size:48,style:{background:"#1890ff"},children:K(C.residentName||C.username)})]}),(0,S.jsx)(m.A,{}),(0,S.jsxs)("div",{style:{overflowY:"auto",maxHeight:340},children:[(0,S.jsxs)("div",{style:{marginBottom:8},children:[(0,S.jsx)(h.A.Paragraph,{style:{margin:0},children:C.message}),C.attachments&&C.attachments.length>0&&(0,S.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:C.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,S.jsx)("div",{children:s?(0,S.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:(0,S.jsx)("img",{src:n,alt:a,style:{maxWidth:220,maxHeight:140,borderRadius:8,objectFit:"cover",border:"1px solid #f0f0f0"}})}):(0,S.jsxs)("div",{children:[(0,S.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,S.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),Array.isArray(C.responses)&&C.responses.map((e,t)=>{let n=(e.role||e.authorRole||e.author_role||""||"").toString().toLowerCase();const a=e.author||e.authorName||e.author_name||e.createdByName||e.createdByFullName||e.userName||e.user||"",s=e.createdBy?String(e.createdBy):void 0;if(!n)try{let t;C&&(C.createdBy&&"string"===typeof C.createdBy?t=String(C.createdBy):C.createdBy&&"object"===typeof C.createdBy&&(C.createdBy._id||C.createdBy.id)?t=String(C.createdBy._id||C.createdBy.id):C.residentId&&(t=String(C.residentId)));const i=C&&(C.residentName||C.username)?String(C.residentName||C.username).toLowerCase():"",r=(a||e.authorName||"").toString().toLowerCase();(t&&s&&t===s||i&&r&&i===r)&&(n="resident")}catch(d){}let i;i=a&&""!==a.trim()?a:e.authorName&&""!==e.authorName.trim()?e.authorName:e.createdBy&&"object"===typeof e.createdBy&&(e.createdBy.fullName||e.createdBy.username)?e.createdBy.fullName||e.createdBy.username:"resident"===n?C&&(C.residentName||C.username)?C.residentName||C.username:"Resident":"Staff";const r="resident"===n||"user"===n,l=r?"right":"left",o=r?(0,S.jsx)(y.A,{style:{background:"#1890ff"},children:K(i,"U")}):(0,S.jsx)(y.A,{style:{background:"#666"},children:K(i,"B")});return(0,S.jsx)("div",{style:{alignSelf:r?"flex-end":"flex-start",maxWidth:"100%"},children:(0,S.jsx)(J,{author:i,avatar:o,content:(0,S.jsxs)("div",{style:{background:r?"#e6f7ff":"#f6f6f6",padding:10,borderRadius:8},children:[(0,S.jsx)(h.A.Paragraph,{style:{margin:0},children:e.text}),e.attachments&&e.attachments.length>0&&(0,S.jsx)("div",{style:{marginTop:8,display:"flex",flexDirection:"column",gap:8},children:e.attachments.map((e,t)=>{const n=e.url||e.path||"#",a=e.name||e.filename||"attachment",s=e.contentType&&e.contentType.startsWith("image/")||/\.(jpe?g|png|gif|webp)$/i.test(a);return(0,S.jsx)("div",{children:s?(0,S.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:(0,S.jsx)("img",{src:n,alt:a,style:{maxWidth:220,maxHeight:140,borderRadius:8,objectFit:"cover",border:"1px solid #f0f0f0"}})}):(0,S.jsxs)("div",{children:[(0,S.jsx)("a",{href:n,target:"_blank",rel:"noreferrer",children:a}),e.size?(0,S.jsxs)("span",{style:{marginLeft:8,color:"#888",fontSize:12},children:["(",Math.round(e.size/1024)," KB)"]}):null]})},t)})})]}),datetime:(0,S.jsx)("span",{style:{fontSize:12},children:e.createdAt?new Date(e.createdAt).toLocaleString():""}),align:l})},t)}),(0,S.jsx)("div",{ref:H})]}),(0,S.jsxs)("div",{style:{display:"flex",gap:8,marginTop:8,alignItems:"center"},children:[(0,S.jsx)("textarea",{value:T,onChange:e=>{D(e.target.value);const t=e.target;t.style.height="auto",t.style.height=Math.min(200,t.scrollHeight)+"px"},onKeyDown:async e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),await $())},placeholder:"Type your reply...",style:{flex:1,minHeight:40,maxHeight:200,padding:10,borderRadius:8,resize:"none"}}),(0,S.jsx)(u.Ay,{type:"primary",icon:(0,S.jsx)(w.A,{}),loading:!(!C||!P[C._id]),onClick:$}),(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(F.A,{}),onClick:async()=>{if(!C||!C._id)return;const e=C._id;try{const t=await k.contactAPI.resolveInquiry(e);f(e=>e.map(e=>e._id===t._id?t:e)),N(t)}catch(t){console.error("resolve failed",t)}},children:"Resolve"})]})]}):(0,S.jsx)("div",{style:{textAlign:"center",padding:32},children:(0,S.jsx)(h.A.Text,{type:"secondary",children:"Select an inquiry to view details"})})})})]})})]})})};var U=n(98086),M=n(34943),W=n(50839),Y=n(54420);const H={isAuthenticated:!1,user:null,token:null},G=(0,s.createContext)((0,a.A)((0,a.A)({},H),{},{login:()=>{},logout:()=>{},isStaff:()=>!1,isAdmin:()=>!1,isResident:()=>!1,mode:"resident",switchMode:()=>{}})),V=()=>(0,s.useContext)(G);function K(e){if(!e||"string"!==typeof e)return null;if(3!==e.split(".").length)return console.warn("safeDecodeJwt: token does not have 3 parts, skipping decode"),null;try{return(0,Y.s)(e)}catch(t){return console.warn("safeDecodeJwt: failed to decode token",t),null}}const J=(e,t)=>{switch(t.type){case"LOGIN":case"RESTORE_TOKEN":{let e=null;return e=K(t.payload),{isAuthenticated:!!e,token:e?t.payload:null,user:e}}case"LOGOUT":return H;default:return e}},$=e=>{let{children:t}=e;const[i,r]=(0,s.useReducer)(J,H);(0,s.useEffect)(()=>{try{const e=localStorage.getItem("userProfile");if(e){const t=JSON.parse(e);if(t&&t.username){const e=localStorage.getItem("token")||null,t=K(e);e&&t&&r({type:"LOGIN",payload:e})}}}catch(e){}},[]);const[l,o]=s.useState("resident"),d=(0,L.Zp)();(0,s.useEffect)(()=>{const e=localStorage.getItem("token");e&&function(e){try{const t=K(e);if(!t)return!1;if(!t.exp)return!1;const n=Date.now()/1e3;return t.exp>n}catch(t){return!1}}(e)?(r({type:"RESTORE_TOKEN",payload:e}),(async()=>{try{const{authService:t}=await Promise.resolve().then(n.bind(n,31694)),a=await t.getCurrentUser();a&&(r({type:"LOGIN",payload:e}),localStorage.setItem("userProfile",JSON.stringify(a)))}catch(t){}})()):(localStorage.removeItem("token"),r({type:"LOGOUT"}))},[]),(0,s.useEffect)(()=>{const e=e=>{try{let t=null===e||void 0===e?void 0:e.detail;if(!t)return;t.user&&(t=t.user),t.data&&t.data.user&&(t=t.data.user);const n=i.user;if(!n)return;if(t.deleted&&t._id&&n._id&&t._id===n._id)return void c(null);(t._id&&n._id&&t._id===n._id||t.username&&n.username&&t.username===n.username)&&c(t)}catch(t){}};return window.addEventListener("userProfileUpdated",e),()=>window.removeEventListener("userProfileUpdated",e)},[i.user]);const c=e=>{if(e){localStorage.setItem("userProfile",JSON.stringify(e));const t=localStorage.getItem("token");t&&r({type:"LOGIN",payload:t})}else localStorage.removeItem("userProfile"),r({type:"LOGOUT"})};return(0,S.jsx)(G.Provider,{value:(0,a.A)((0,a.A)({},i),{},{login:e=>{localStorage.setItem("token",e),document.cookie="token=".concat(e,"; path=/; max-age=86400; SameSite=Lax"),r({type:"LOGIN",payload:e}),(async()=>{try{const{authService:t}=await Promise.resolve().then(n.bind(n,31694)),a=await t.getCurrentUser();a&&(localStorage.setItem("userProfile",JSON.stringify(a)),r({type:"LOGIN",payload:e}))}catch(t){}})()},logout:()=>{k.authService.logout().catch(()=>{}),localStorage.removeItem("token"),document.cookie="token=; path=/; expires=Thu, 01 Jan 1970 00:00:00 GMT;",r({type:"LOGOUT"}),d("/login",{replace:!0})},isStaff:()=>{var e;return"staff"===(null===(e=i.user)||void 0===e?void 0:e.role)},isAdmin:()=>{var e;return"admin"===(null===(e=i.user)||void 0===e?void 0:e.role)},isResident:()=>{var e;return"resident"===(null===(e=i.user)||void 0===e?void 0:e.role)},mode:l,switchMode:e=>{o(e)},setUser:c}),children:t})};var Z=n(98964),Q=n(79126),X=n(6051),ee=n(30326),te=n(45229),ne=n(56580),ae=n(13486),se=n(8272),ie=n(99214),re=n(81877),le=n(94532),oe=n(30703),de=n(58518),ce=n(85825),ue=n(71923),he=n(45608),me=n(38700),pe=n(40905);const xe=e=>{let{user:t,src:n,profileImageId:s,size:i=40,alt:r="",className:l,style:o}=e;const d=t,c=s||(null===d||void 0===d?void 0:d.profileImageId)||null,u=n||(null===d||void 0===d?void 0:d.profileImage)||(null===d||void 0===d?void 0:d.profilePicture)||null;if(c)return(0,S.jsx)("img",{src:"/api/resident/personal-info/avatar/".concat(c),alt:r||(null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||(null===d||void 0===d?void 0:d.email)||"avatar",width:i,height:i,style:(0,a.A)({width:i,height:i,borderRadius:"50%",objectFit:"cover"},o),className:l});if(u)return(0,S.jsx)("img",{src:u,alt:r||(null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||(null===d||void 0===d?void 0:d.email)||"avatar",width:i,height:i,style:(0,a.A)({width:i,height:i,borderRadius:"50%",objectFit:"cover"},o),className:l});const h=((null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||(null===d||void 0===d?void 0:d.email)||"").toString(),m="https://ui-avatars.com/api/?name=".concat(encodeURIComponent(h),"&background=2196F3&color=fff&size=").concat(Math.max(Math.min(i,256),32));return(0,S.jsx)("img",{src:m,alt:r||h||"avatar",width:i,height:i,style:(0,a.A)({width:i,height:i,borderRadius:"50%",objectFit:"cover"},o),className:l})},ge=()=>{const[e,t]=(0,s.useState)(new Date);(0,s.useEffect)(()=>{const e=setInterval(()=>t(new Date),1e3);return()=>clearInterval(e)},[]);const n=e=>e.toString().padStart(2,"0"),a="".concat(n(e.getMonth()+1),"/").concat(n(e.getDate()),"/").concat(e.getFullYear()),i="".concat(n(e.getHours()),":").concat(n(e.getMinutes()),":").concat(n(e.getSeconds()));return(0,S.jsxs)("span",{style:{fontSize:13,color:"#888",fontWeight:500,letterSpacing:.5,marginRight:8},children:[(0,S.jsx)(te.A,{style:{marginRight:4}}),a," ",i]})},{Header:fe,Content:ye,Sider:Ae}=Z.A,je={resident:[{key:"/home",icon:(0,S.jsx)(ne.A,{}),label:"Home"},{key:"/request",icon:(0,S.jsx)(ae.A,{}),label:"Request"},{key:"/inquiries",icon:(0,S.jsx)(se.A,{}),label:"Inquiries"},{key:"/inbox",icon:(0,S.jsx)(b.A,{}),label:"Inbox"}],admin:[{key:"/admin/dashboard",icon:(0,S.jsx)(ne.A,{}),label:"Admin Dashboard"},{key:"/admin/users",icon:(0,S.jsx)(ie.A,{}),label:"User Management"},{key:"/admin/activity",icon:(0,S.jsx)(re.A,{}),label:"Activity Logs"},{key:"/admin/statistics",icon:(0,S.jsx)(le.A,{}),label:"Statistics"},{key:"/admin/settings",icon:(0,S.jsx)(oe.A,{}),label:"System Settings"},{key:"/admin/verification-requests",icon:(0,S.jsx)(de.A,{}),label:"Verification Requests"}],staff:[{key:"/staff-dashboard",icon:(0,S.jsx)(ne.A,{}),label:"Staff Dashboard"},{key:"/staff/inbox",icon:(0,S.jsx)(b.A,{}),label:"Staff Inbox"},{key:"/templates-manager",icon:(0,S.jsx)(de.A,{}),label:"Templates Manager"},{key:"/document-processing",icon:(0,S.jsx)(ce.A,{}),label:"Document Processing"},{key:"/document-history",icon:(0,S.jsx)(ue.A,{}),label:"Document History"}]},ve=e=>{var t,i;let{children:r}=e;const l=(0,L.zy)(),o=(0,L.Zp)(),{user:d}=V();let c=d;if(!c)try{const e=localStorage.getItem("userProfile");e&&(c=JSON.parse(e))}catch(g){}const[h,m]=(0,s.useState)(null),[p,x]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async()=>{try{const e=await Promise.resolve().then(n.bind(n,31694));try{const t=await e.residentPersonalInfoAPI.getPersonalInfo();if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:"".concat(window.location.origin).concat(t.profileImage);return void m(e)}if(null!==t&&void 0!==t&&t.profileImageId)return void m("/api/resident/personal-info/avatar/".concat(t.profileImageId))}catch(g){}try{const t=(await e.default.get("/resident/profile")).data;if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:"".concat(window.location.origin).concat(t.profileImage);m(e)}else null!==t&&void 0!==t&&t.profileImageId&&m("/api/resident/personal-info/avatar/".concat(t.profileImageId))}catch(g){}}catch(g){}})();const e=e=>{try{const t=null===e||void 0===e?void 0:e.detail;if(!t)return;if(t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:"".concat(window.location.origin).concat(t.profileImage);m(e)}else t.profileImageId&&m("/api/resident/personal-info/avatar/".concat(t.profileImageId))}catch(g){}};return window.addEventListener("userProfileUpdated",e),()=>window.removeEventListener("userProfileUpdated",e)},[]),(0,S.jsxs)(Z.A,{style:{minHeight:"100vh",background:"#000"},children:[d&&(0,S.jsx)(Ae,{width:240,collapsed:p,collapsedWidth:64,style:{height:"100vh",position:"fixed",left:0,top:0,background:"linear-gradient(180deg, #40c9ff 0%, #e81cff 100%)",display:"flex",flexDirection:"column",padding:0,zIndex:100,boxShadow:"2px 0 16px 0 rgba(64,201,255,0.10)",borderRight:"none",overflowX:"hidden"},children:(0,S.jsx)("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"24px 0 0 0",display:"flex",flexDirection:"column"},children:(0,S.jsx)(Q.A,{theme:"light",mode:"inline",selectedKeys:[l.pathname],style:{background:"transparent",fontWeight:600,fontSize:17,border:"none"},inlineCollapsed:p,items:je["admin"===(null===d||void 0===d?void 0:d.role)?"admin":"staff"===(null===d||void 0===d?void 0:d.role)?"staff":"resident"].map(e=>(0,a.A)((0,a.A)({},e),{},{className:l.pathname===e.key?"ant-menu-item-active-custom":void 0})),onClick:e=>{let{key:t}=e;l.pathname!==t&&o(t)}})})}),(0,S.jsxs)(Z.A,{style:{marginLeft:d?p?64:240:0},children:[(0,S.jsxs)(fe,{style:{height:64,background:"#fff",display:"flex",alignItems:"center",justifyContent:"space-between",padding:"0 32px",position:"fixed",left:d?p?64:240:0,right:0,top:0,zIndex:101,boxShadow:"0 2px 8px #e3e6f3"},children:[(0,S.jsxs)("div",{className:"responsive-system-title",style:{display:"flex",alignItems:"center",gap:12,maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:[d&&(0,S.jsx)(u.Ay,{type:"text",onClick:()=>x(e=>!e),style:{marginRight:6},icon:p?(0,S.jsx)(j.A,{}):(0,S.jsx)(v.A,{})}),(0,S.jsx)("img",{src:"".concat("","/logo-parian2.png"),alt:"Logo",style:{width:36,height:36,marginRight:4}}),(0,S.jsxs)("span",{style:{fontSize:26,fontWeight:400,letterSpacing:1,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",display:"inline-block",maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:["Barangay Information ",(0,S.jsx)("span",{style:{fontWeight:800},children:"Management System"})]})]}),(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:16,position:"relative",marginRight:8},children:[(0,S.jsx)("span",{style:{marginRight:8},children:(0,S.jsx)(ge,{})}),(0,S.jsx)(X.A,{size:12,children:c&&(0,S.jsx)(u.Ay,{size:"small",onClick:()=>{var e;return o("admin"===(null===(e=c)||void 0===e?void 0:e.role)?"/admin/announcements":"/announcements")},icon:(0,S.jsx)(he.A,{})})}),(0,S.jsx)(ee.A,{popupRender:()=>(0,S.jsxs)(Q.A,{children:[(0,S.jsx)(Q.A.Item,{icon:(0,S.jsx)(me.A,{}),onClick:()=>o("/profile"),children:"Profile"},"profile"),(0,S.jsx)(Q.A.Item,{icon:(0,S.jsx)(oe.A,{}),onClick:()=>o("/admin/settings"),children:"Settings"},"settings"),(0,S.jsx)(Q.A.Divider,{}),(0,S.jsx)(Q.A.Item,{icon:(0,S.jsx)(pe.A,{}),onClick:()=>o("/logout"),children:"Logout"},"logout")]}),placement:"bottomRight",trigger:["click"],children:(0,S.jsx)(y.A,{size:36,shape:"circle",children:h?(0,S.jsx)("img",{src:h,alt:(null===(t=c)||void 0===t?void 0:t.fullName)||(null===(i=c)||void 0===i?void 0:i.username)||"avatar",width:36,height:36,style:{width:36,height:36,borderRadius:"50%",objectFit:"cover"}}):c&&(c.profileImage||c.profilePicture||c.profileImageId)?(0,S.jsx)(xe,{user:c,size:36}):(0,S.jsx)(me.A,{})})})]})]}),(0,S.jsx)("div",{style:{height:1,background:"#f0f0f0",width:"100%",margin:0,boxShadow:"none"}}),(0,S.jsx)(ye,{style:{marginTop:64,padding:32,background:"linear-gradient(135deg, #e3f6fd 0%, #b3e0ff 60%,  #b3e0ff 100%)",minHeight:"calc(100vh - ".concat(64,"px)")},children:r})]})]})},be=e=>{let{children:t}=e;return(0,S.jsx)(ve,{children:t||(0,S.jsx)(L.sv,{})})},we=e=>{let{children:t}=e;const{isAuthenticated:n,user:a}=V();return n||a&&"guest"===a.role?(0,S.jsx)(S.Fragment,{children:t}):(0,S.jsx)(L.C5,{to:"/login",replace:!0})},Se=e=>{let{children:t}=e;const{isAuthenticated:n,user:a}=V();return n?"staff"!==(null===a||void 0===a?void 0:a.role)&&"admin"!==(null===a||void 0===a?void 0:a.role)?(0,S.jsx)(L.C5,{to:"/dashboard",replace:!0}):(0,S.jsx)(S.Fragment,{children:t}):(0,S.jsx)(L.C5,{to:"/login",replace:!0})},Ie=e=>{let{children:t}=e;const n=V(),a=(0,L.Zp)(),s=null===n||void 0===n?void 0:n.user,i="function"===typeof(null===n||void 0===n?void 0:n.isAdmin)?n.isAdmin():"admin"===(null===s||void 0===s?void 0:s.role)||!0===(null===s||void 0===s?void 0:s.isAdmin),r="undefined"!==typeof window?localStorage.getItem("token"):null;return!s&&r?(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%"},children:(0,S.jsx)(p.A,{size:"large"})}):s?i?t:(0,S.jsx)(x.Ay,{status:"403",title:"403",subTitle:"Sorry, you are not authorized to access this page.",extra:(0,S.jsx)(u.Ay,{type:"primary",onClick:()=>a("/dashboard"),children:"Go to Dashboard"})}):(0,S.jsx)(L.C5,{to:"/login",replace:!0})};var Ce=n(95645),ke=n(88820);const Ne=function(e){return e?e.previewUrl?e.previewUrl:e.photo&&e._id?(0,k.getAbsoluteApiUrl)("/admin/officials/".concat(e._id,"/photo")):e.hasPhoto&&e._id?(0,k.getAbsoluteApiUrl)("/officials/".concat(e._id,"/photo")):e.photoUrl?e.photoUrl:e.photoPath?"/".concat(e.photoPath.replace(/^\//,"")):"/Templates/default-avatar.png":"/Templates/default-avatar.png"};var Te=n(26612),De=n(74044);const Pe=()=>{var e,t,n,i,d,c,u,m,x;const[g,f]=(0,s.useState)(null),[y,A]=(0,s.useState)(!0);if((0,s.useEffect)(()=>{let e=!0;return(async()=>{try{const[t,n,s,i]=await Promise.all([k.adminAPI.getSystemStatistics(),k.documentsAPI.listFiles().catch(()=>[]),k.documentsAPI.getAllDocuments().catch(()=>[]),k.contactAPI.getAnnouncements().catch(()=>[])]);if(e){const e=Array.isArray(n)?n.length:n&&n.length||0,r=Array.isArray(s)?s.length:s&&s.length||0,l=Array.isArray(i)?i.length:i&&i.length||0;f((0,a.A)((0,a.A)({},t),{},{filesCount:e,docRequestsCount:r,announcementsCount:l}))}}catch(t){console.error("Failed to load system statistics",t)}finally{e&&A(!1)}})(),()=>{e=!1}},[]),y)return(0,S.jsx)("div",{style:{width:"100%",textAlign:"center"},children:(0,S.jsx)(p.A,{})});if(!g)return(0,S.jsx)("div",{style:{textAlign:"center"},children:(0,S.jsx)(h.A.Text,{type:"secondary",children:"No statistics available"})});const j=g.users||{},v=(g.documents,null!==(e=g.filesCount)&&void 0!==e?e:0),b=[{key:"users",title:"Total Users",value:null!==(t=j.total)&&void 0!==t?t:0,icon:(0,S.jsx)(me.A,{style:{color:"#9254de",fontSize:20}})},{key:"admins",title:"Admins",value:null!==(n=null===(i=j.byRole)||void 0===i?void 0:i.admin)&&void 0!==n?n:0,icon:(0,S.jsx)(De.A,{style:{color:"#f5a623",fontSize:20}})},{key:"staff",title:"Staff",value:null!==(d=null===(c=j.byRole)||void 0===c?void 0:c.staff)&&void 0!==d?d:0,icon:(0,S.jsx)(ie.A,{style:{color:"#1677ff",fontSize:20}})},{key:"residents",title:"Residents",value:null!==(u=null===(m=j.byRole)||void 0===m?void 0:m.resident)&&void 0!==u?u:0,icon:(0,S.jsx)(ne.A,{style:{color:"#22c55e",fontSize:20}})},{key:"announcements",title:"Announcements",value:null!==(x=g.announcementsCount)&&void 0!==x?x:0,icon:(0,S.jsx)(he.A,{style:{color:"#faad14",fontSize:20}})},{key:"docFiles",title:"Documents Available",value:v,icon:(0,S.jsx)(ae.A,{style:{color:"#0ea5e9",fontSize:20}})}];return(0,S.jsxs)(r.A,{className:"glass-card stats-card",bordered:!1,style:{width:"100%"},children:[(0,S.jsx)(h.A.Title,{level:4,children:"Quick Stats"}),(0,S.jsx)("div",{style:{height:6,background:"linear-gradient(90deg, rgba(22,119,255,0.08), rgba(146,84,222,0.08))",borderRadius:4,marginBottom:12}}),(0,S.jsx)(l.A,{gutter:[12,12],style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap"},children:b.map(e=>(0,S.jsx)(o.A,{xs:12,sm:8,md:8,lg:8,style:{display:"flex"},children:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,width:"100%"},children:[(0,S.jsx)("div",{style:{width:44,height:44,display:"flex",alignItems:"center",justifyContent:"center",background:"rgba(255,255,255,0.9)",borderRadius:8,boxShadow:"0 6px 14px rgba(2,6,23,0.06)"},children:e.icon}),(0,S.jsx)("div",{style:{flex:1},children:(0,S.jsx)(Te.A,{title:e.title,value:e.value})})]})},e.key))})]})};var Re=n(98058),qe=n(77725);const Be=()=>{const{login:e,isAuthenticated:t,user:n,setUser:a}=V(),[d,m]=(0,s.useState)(!1),[p,x]=(0,s.useState)(!1),[g]=Ce.A.useForm(),f=(0,L.Zp)(),[y,A]=(0,s.useState)(!1),[j,v]=(0,s.useState)([]),[b,w]=(0,s.useState)("loading"),I=(0,s.useRef)(null);(0,s.useEffect)(()=>{t&&n&&("admin"===n.role?f("/admin/dashboard"):"staff"===n.role?f("/staff-dashboard"):"guest"===n.role?f("/guest/dashboard"):f("/dashboard"))},[t,n,f]),(0,s.useEffect)(()=>{let e=!0;return(async()=>{try{w("fetching public");const n=await async function(){try{const t=await k.axiosPublic.get("/officials");if(t.status>=400){console.warn("Public officials fetch failed; trying admin endpoint as fallback",t.status);try{const e=await k.axiosInstance.get("/admin/officials");if(200===e.status)return e.data}catch(e){console.warn("Admin fallback failed",e)}throw new Error("Failed to fetch officials: ".concat(t.status," ").concat(t.statusText))}let n=t.data;return n&&Array.isArray(n.data)&&(n=n.data),n&&Array.isArray(n.officials)&&(n=n.officials),Array.isArray(n)?(0===n.length&&console.info("fetchPublicOfficials: server returned empty list"),n):(console.warn("fetchPublicOfficials: unexpected payload shape",n),[])}catch(t){return console.error("fetchPublicOfficials error",t),[]}}();if(e&&Array.isArray(n)&&n.length>0)v(n),w("public:".concat(n.length));else{w("trying-admin-fallback");try{const t=await k.adminAPI.getOfficials();if(e&&Array.isArray(t)&&t.length>0){const e=t.map(e=>({_id:e._id,name:e.name,title:e.title,term:e.term,hasPhoto:!!e.photo||!!e.photoPath}));v(e),w("admin:".concat(e.length))}else w("no-officials")}catch(t){console.warn("Admin fallback failed",t),w("error")}}}catch(t){console.warn("Failed to fetch public officials for login preview",t),w("error")}})(),()=>{e=!1}},[]);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)("div",{className:"login-page",children:(0,S.jsx)("div",{className:"login-container two-pane",children:(0,S.jsxs)(l.A,{gutter:24,align:"stretch",justify:"center",className:"two-pane-row",children:[(0,S.jsx)(o.A,{xs:24,md:12,className:"pane left-pane combined-pane",children:(0,S.jsx)("div",{className:"pane-inner left-inner",children:(0,S.jsxs)("div",{style:{width:"100%",display:"flex",flexDirection:"column",gap:18},children:[(0,S.jsx)(Pe,{}),(0,S.jsxs)(r.A,{className:"glass-card preview-card invisible",variant:"outlined",children:[(0,S.jsx)(h.A.Title,{level:4,style:{marginBottom:8},children:"Barangay Officials"}),(0,S.jsx)("div",{style:{height:6,background:"linear-gradient(90deg, rgba(22,119,255,0.12), rgba(146,84,222,0.12))",borderRadius:4,marginBottom:12}}),(0,S.jsxs)("div",{className:"carousel-wrap",children:[(0,S.jsx)(u.Ay,{className:"carousel-arrow left",icon:(0,S.jsx)(Re.A,{}),onClick:()=>{I.current&&I.current.scrollBy({left:-240,behavior:"smooth"})}}),(0,S.jsx)("div",{ref:I,className:"carousel-scroll",children:0===j.length?(0,S.jsx)(h.A.Text,{type:"secondary",children:"No officials to preview"}):j.map(e=>(0,S.jsxs)("div",{className:"official-card",children:[(0,S.jsx)("div",{className:"official-avatar",children:(0,S.jsx)("img",{alt:e.name,src:Ne(e),style:{width:"100%",height:"100%",objectFit:"cover"}})}),(0,S.jsx)("div",{style:{fontWeight:700},children:e.name}),(0,S.jsx)("div",{style:{color:"#666",fontSize:13},children:e.title}),(0,S.jsx)("div",{style:{color:"#999",fontSize:12},children:e.term})]},e._id))}),(0,S.jsx)(u.Ay,{className:"carousel-arrow right",icon:(0,S.jsx)(qe.A,{}),onClick:()=>{I.current&&I.current.scrollBy({left:240,behavior:"smooth"})}})]})]})]})})}),(0,S.jsx)(o.A,{xs:24,md:12,className:"pane center-pane login-pane",children:(0,S.jsx)("div",{className:"pane-inner center-inner",children:(0,S.jsxs)(r.A,{className:"glass-card login-card",variant:"outlined",children:[(0,S.jsx)(h.A.Title,{level:2,className:"title-blue",style:{textAlign:"center",marginBottom:6},children:"Barangay Information System"}),(0,S.jsx)(h.A.Text,{style:{display:"block",textAlign:"center",color:"#9254de",fontWeight:500,marginBottom:18},children:"Sign In"}),(0,S.jsxs)(Ce.A,{name:"login",layout:"vertical",onFinish:async t=>{A(!0);try{const n=await k.axiosInstance.post("/auth/login",{identifier:t.username,password:t.password}),a=n&&n.data?n.data:{};if(!n||n.status>=400)throw console.error("Login response not OK:",{status:null===n||void 0===n?void 0:n.status,data:a}),new Error(a.message||"Login failed");if(!a.token)throw console.error("No token in response:",a),new Error("Login failed - No token received");e(a.token),i.Ay.success(a.message||"Login successful!")}catch(n){i.Ay.error(n.message||"Error logging in"),console.error("Login error:",n)}finally{A(!1)}},autoComplete:"off",requiredMark:!1,children:[(0,S.jsx)(Ce.A.Item,{label:"Email or Username",name:"username",rules:[{required:!0,message:"Please input your email or username!"}],children:(0,S.jsx)(c.A,{prefix:(0,S.jsx)(me.A,{style:{color:"#40a9ff"}}),placeholder:"Enter your email or username",size:"large"})}),(0,S.jsx)(Ce.A.Item,{label:"Password",name:"password",rules:[{required:!0,message:"Please input your password!"},{min:6,message:"Password must be at least 6 characters"}],children:(0,S.jsx)(c.A.Password,{autoComplete:"current-password",prefix:(0,S.jsx)(ke.A,{style:{color:"#40a9ff"}}),placeholder:"Enter your password",size:"large"})}),(0,S.jsx)(Ce.A.Item,{children:(0,S.jsx)(u.Ay,{htmlType:"submit",size:"large",loading:y,className:"signin-btn",children:y?"Signing In...":"Sign In"})}),(0,S.jsx)(Ce.A.Item,{children:(0,S.jsx)(u.Ay,{onClick:()=>m(!0),size:"large",className:"guest-warm-btn",block:!0,children:"Continue as Guest"})}),(0,S.jsxs)("div",{className:"links-row",children:[(0,S.jsx)(L.N_,{to:"/forgot-password",children:(0,S.jsx)(h.A.Text,{type:"secondary",children:"Forgot Password?"})}),(0,S.jsx)(L.N_,{to:"/register",children:(0,S.jsx)(h.A.Text,{type:"secondary",children:"Sign Up"})})]}),(0,S.jsx)("div",{style:{marginTop:8,textAlign:"center"},children:(0,S.jsx)(u.Ay,{type:"link",onClick:()=>x(!0),children:(0,S.jsx)(h.A.Text,{type:"danger",children:"Emergency Hotline"})})})]})]})})})]})})}),(0,S.jsx)(_.A,{title:"Continue as Guest",open:d,onCancel:()=>{m(!1),g.resetFields()},onOk:async()=>{try{const s=await g.validateFields();try{const n=await k.axiosPublic.post("/auth/guest",{name:s.name,contactNumber:s.contactNumber,email:s.email,intent:s.intent}),r=n&&n.data?n.data:{};if(!n||n.status>=400)return void i.Ay.error(r.message||"Failed to create guest");const l={_id:r._id,username:(s.name||"guest").toString().toLowerCase().replace(/\s+/g,"_"),firstName:s.name||"Guest",contactNumber:s.contactNumber||"",email:s.email||"",intent:s.intent||"",sessionToken:r.sessionToken,expiresAt:r.expiresAt,role:"guest"};if("function"===typeof a&&a(l),localStorage.setItem("guestInfo",JSON.stringify(l)),localStorage.setItem("guestSessionToken",r.sessionToken),r.token&&"function"===typeof e)try{await e(r.token)}catch(t){console.warn("Guest token login failed",t)}m(!1),g.resetFields(),f("/guest/dashboard")}catch(n){console.error("Failed to persist guest",n),i.Ay.error("Failed to create guest account")}}catch(n){}},children:(0,S.jsxs)(Ce.A,{layout:"vertical",form:g,children:[(0,S.jsx)(Ce.A.Item,{name:"name",label:"Full name",rules:[{required:!0,message:"Please enter your name"}],children:(0,S.jsx)(c.A,{placeholder:"Your full name"})}),(0,S.jsx)(Ce.A.Item,{name:"contactNumber",label:"Contact number",rules:[{required:!0,message:"Please enter a contact number"}],children:(0,S.jsx)(c.A,{placeholder:"0917..."})}),(0,S.jsx)(Ce.A.Item,{name:"email",label:"Email (optional)",rules:[{type:"email",message:"Enter a valid email"}],children:(0,S.jsx)(c.A,{placeholder:"you@example.com"})}),(0,S.jsx)(Ce.A.Item,{name:"intent",label:"Purpose / Intent",rules:[{required:!0,message:"Please tell us your intent"}],children:(0,S.jsx)(c.A.TextArea,{placeholder:"Why are you visiting (e.g., check documents, request info)",rows:3})})]})}),(0,S.jsx)(_.A,{title:"Emergency Hotlines",open:p,onCancel:()=>x(!1),footer:null,children:(0,S.jsxs)("div",{style:{lineHeight:1.6},children:[(0,S.jsxs)(h.A.Paragraph,{children:["For general emergencies: ",(0,S.jsx)("strong",{children:"911"})]}),(0,S.jsxs)(h.A.Paragraph,{children:["National Center for Mental Health (Crisis): ",(0,S.jsx)("strong",{children:"0917-899-8727"})]}),(0,S.jsxs)(h.A.Paragraph,{children:["Philippine National Police (Emergency Hotline): ",(0,S.jsx)("strong",{children:"9-1-1"})," / ",(0,S.jsx)("strong",{children:"8723-0401"})," / ",(0,S.jsx)("strong",{children:"8537-4500"})]})]})})]})};var Le=n(63516),Oe=n(80899),_e=n(53969),ze=n(65535),Fe=n(94799),Ee=n(25438),Ue=n(33699),Me=n(12097),We=n(58560),Ye=n(59024),He=n(31202),Ge=n(90160),Ve=n(4573),Ke=n(97250),Je=n(22632),$e=n(3665),Ze=n(32306),Qe=n(23241);const Xe=Oe.Ik({username:Oe.Yj().matches(/^[a-zA-Z0-9]{4,20}$/,"Username must be 4-20 characters and contain only letters and numbers").required("Username is required"),email:Oe.Yj().email("Invalid email address").required("Email is required"),password:Oe.Yj().matches(/^(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{6,}$/,"Password must be at least 6 characters long and contain at least one number, one uppercase letter, and one special character").required("Password is required"),confirmPassword:Oe.Yj().oneOf([Oe.KR("password"),void 0],"Passwords must match").required("Confirm Password is required"),address:Oe.Yj().required("Address is required"),contactNumber:Oe.Yj().required("Contact Number is required"),barangayID:Oe.Yj().required("Barangay ID is required")}),et=()=>{const e=(0,L.Zp)(),[t,n]=s.useState(""),[a,i]=s.useState(""),[r,l]=s.useState(""),[o,d]=s.useState(!1),[c,u]=s.useState(!1),[h,m]=s.useState(!1),[p,x]=s.useState({});const g=(0,Le.Wx)({initialValues:{firstName:"",middleName:"",lastName:"",username:"",email:"",password:"",confirmPassword:"",address:"",contactNumber:"",barangayID:function(){const e=(new Date).getFullYear(),t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";let n="";for(let a=0;a<6;a++)n+=t.charAt(Math.floor(62*Math.random()));return"brgyparian-".concat(e,"-").concat(n)}(),role:"resident"},validationSchema:Xe.shape({firstName:Oe.Yj().required("First name is required"),lastName:Oe.Yj().required("Last name is required"),role:Oe.Yj().oneOf(["resident"]).required("Role is required")}),onSubmit:async(t,a)=>{let{setSubmitting:s,resetForm:r}=a;n(""),x({});const l=await g.validateForm();if(Object.keys(l).length>0)return n("Please correct the highlighted errors before submitting."),void s(!1);try{const a=[t.firstName,t.middleName,t.lastName].filter(Boolean).join(" "),l=await k.axiosInstance.post("/auth/register",{fullName:a,firstName:t.firstName,middleName:t.middleName,lastName:t.lastName,username:t.username,email:t.email,password:t.password,address:t.address,contactNumber:t.contactNumber,barangayID:t.barangayID,role:t.role});let d={};try{d=l&&l.data?l.data:{}}catch(o){return void n("Server error: Could not parse response")}if(l&&l.status>=200&&l.status<300)i("Registration successful! You may now log in."),r(),setTimeout(()=>e("/login"),1500);else{if(d.errors&&"object"===typeof d.errors)return x(d.errors),n("Please correct the highlighted errors before submitting."),void s(!1);d.message?n(d.message):d.error?n(d.error):n("Registration failed")}}catch(d){n("Network or server error. Please try again later.")}finally{s(!1)}}});return(0,S.jsx)(_e.A,{sx:{minHeight:"100vh",background:"linear-gradient(135deg, #40c9ff 0%, #e81cff 100%)",display:"flex",alignItems:"center",justifyContent:"center",py:6},children:(0,S.jsx)(ze.A,{maxWidth:"sm",children:(0,S.jsxs)(Fe.A,{elevation:6,sx:{borderRadius:5,p:4,background:"rgba(255,255,255,0.95)",boxShadow:"0 8px 32px 0 rgba(64,201,255,0.15)"},children:[(0,S.jsx)(_e.A,{sx:{textAlign:"center",mb:3},children:(0,S.jsx)(_e.A,{sx:{fontWeight:800,fontSize:32,letterSpacing:1,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",display:"inline-block"},children:"Create Account"})}),(0,S.jsxs)("form",{onSubmit:g.handleSubmit,children:[(0,S.jsx)(Ee.A,{fullWidth:!0,margin:"normal",label:"First Name",name:"firstName",value:g.values.firstName,onChange:g.handleChange,error:g.touched.firstName&&Boolean(g.errors.firstName),helperText:g.touched.firstName&&g.errors.firstName,sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,S.jsx)(Ee.A,{fullWidth:!0,margin:"normal",label:"Middle Name (optional)",name:"middleName",value:g.values.middleName,onChange:g.handleChange,error:g.touched.middleName&&Boolean(g.errors.middleName),helperText:g.touched.middleName&&g.errors.middleName,sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,S.jsx)(Ee.A,{fullWidth:!0,margin:"normal",label:"Last Name",name:"lastName",value:g.values.lastName,onChange:g.handleChange,error:g.touched.lastName&&Boolean(g.errors.lastName),helperText:g.touched.lastName&&g.errors.lastName,sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,S.jsx)(Ee.A,{fullWidth:!0,margin:"normal",label:"Username",name:"username",value:g.values.username,onChange:g.handleChange,error:g.touched.username&&Boolean(g.errors.username)||Boolean(p.username),helperText:g.touched.username&&g.errors.username||p.username||"Username must be at least 4 characters long and contain only letters and numbers.",InputProps:{startAdornment:(0,S.jsx)(Ue.A,{position:"start",children:(0,S.jsx)(Ge.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,S.jsx)(Ee.A,{fullWidth:!0,margin:"normal",label:"Email",name:"email",value:g.values.email,onChange:g.handleChange,error:g.touched.email&&Boolean(g.errors.email)||Boolean(p.email),helperText:g.touched.email&&g.errors.email||p.email,InputProps:{startAdornment:(0,S.jsx)(Ue.A,{position:"start",children:(0,S.jsx)(Ve.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,S.jsx)(Ee.A,{fullWidth:!0,margin:"normal",label:"Password",name:"password",type:c?"text":"password",value:g.values.password,onChange:g.handleChange,error:g.touched.password&&Boolean(g.errors.password),helperText:g.touched.password&&g.errors.password||p.password||"Password must be at least 6 characters long and contain at least one number, one uppercase letter, and one special character.",InputProps:{startAdornment:(0,S.jsx)(Ue.A,{position:"start",children:(0,S.jsx)(Ke.A,{color:"primary"})}),endAdornment:(0,S.jsx)(Ue.A,{position:"end",children:(0,S.jsx)(Me.A,{onClick:()=>u(e=>!e),tabIndex:-1,sx:{minWidth:0,p:0,color:"inherit"},children:c?(0,S.jsx)(Je.A,{}):(0,S.jsx)($e.A,{})})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,S.jsx)(Ee.A,{fullWidth:!0,margin:"normal",label:"Confirm Password",name:"confirmPassword",type:h?"text":"password",value:g.values.confirmPassword,onChange:g.handleChange,error:g.touched.confirmPassword&&Boolean(g.errors.confirmPassword),helperText:g.touched.confirmPassword&&g.errors.confirmPassword,InputProps:{startAdornment:(0,S.jsx)(Ue.A,{position:"start",children:(0,S.jsx)(Ke.A,{color:"primary"})}),endAdornment:(0,S.jsx)(Ue.A,{position:"end",children:(0,S.jsx)(Me.A,{onClick:()=>m(e=>!e),tabIndex:-1,sx:{minWidth:0,p:0,color:"inherit"},children:h?(0,S.jsx)(Je.A,{}):(0,S.jsx)($e.A,{})})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,S.jsx)(Ee.A,{fullWidth:!0,margin:"normal",label:"Address",name:"address",value:g.values.address,onChange:g.handleChange,error:g.touched.address&&Boolean(g.errors.address),helperText:g.touched.address&&g.errors.address,InputProps:{startAdornment:(0,S.jsx)(Ue.A,{position:"start",children:(0,S.jsx)(Ze.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,S.jsx)(Ee.A,{fullWidth:!0,margin:"normal",label:"Contact Number",name:"contactNumber",value:g.values.contactNumber,onChange:g.handleChange,error:g.touched.contactNumber&&Boolean(g.errors.contactNumber),helperText:g.touched.contactNumber&&g.errors.contactNumber,InputProps:{startAdornment:(0,S.jsx)(Ue.A,{position:"start",children:(0,S.jsx)(Qe.A,{color:"primary"})})},sx:{borderRadius:3,background:"#f4f6fa",mb:2}}),(0,S.jsx)("input",{type:"hidden",name:"barangayID",value:g.values.barangayID}),(0,S.jsx)(_e.A,{sx:{mb:2},children:(0,S.jsx)(Ee.A,{select:!0,fullWidth:!0,label:"Role",name:"role",value:g.values.role,onChange:e=>{g.handleChange(e),"admin"!==e.target.value&&l("")},error:g.touched.role&&Boolean(g.errors.role),helperText:g.touched.role&&g.errors.role?g.errors.role:"",sx:{borderRadius:3,background:"#f4f6fa"},children:(0,S.jsx)(We.A,{value:"resident",children:"Resident"})})}),(0,S.jsx)(Me.A,{type:"submit",fullWidth:!0,variant:"contained",sx:{mt:3,mb:2,borderRadius:3,fontWeight:700,fontSize:"1.1rem",background:"linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",color:"#fff",boxShadow:"0 2px 8px #e81cff44",transition:"background 0.3s","&:hover":{background:"linear-gradient(90deg, #40c9ff 0%, #e81cff 100%)"}},disabled:g.isSubmitting,children:"Register"}),t&&(0,S.jsx)(Ye.A,{severity:"error",sx:{mt:2},children:t}),Object.keys(p).length>0&&!t&&(0,S.jsx)(Ye.A,{severity:"error",sx:{mt:2},children:Object.entries(p).map(e=>{let[t,n]=e;return(0,S.jsx)("div",{children:n},t)})}),o&&(0,S.jsx)(Ye.A,{severity:"info",sx:{mt:2},children:"Admin access is now unlocked! Redirecting to admin dashboard..."}),(0,S.jsx)(_e.A,{sx:{textAlign:"center",mt:2},children:(0,S.jsxs)(He.A,{component:L.N_,to:"/login",variant:"body2",sx:{color:"#e81cff",fontWeight:600},children:["Already have an account? ",(0,S.jsx)("span",{style:{textDecoration:"underline"},children:"Sign In"})]})})]})]})})})};var tt=n(37490),nt=n(42524),at=n(32513),st=n(80312),it=n(69123);const rt=()=>{var e,t,a,i;const{user:d,setUser:c}=V(),m=(null!==d&&void 0!==d||(()=>{try{const e=localStorage.getItem("userProfile");return e?JSON.parse(e):null}catch(e){return null}})(),(0,L.Zp)()),[p,x]=(0,s.useState)(null),[g,f]=(0,s.useState)(()=>(new Date).toLocaleString()),[y,j]=(0,s.useState)([]),[v,b]=(0,s.useState)(!0),[w,I]=(0,s.useState)(0),[C,N]=(0,s.useState)(0),[T,D]=(0,s.useState)(!1),[P,R]=(0,s.useState)(0),[q,B]=(0,s.useState)(!1),[O,z]=(0,s.useState)([]),[F,E]=(0,s.useState)(!1),[U,M]=(0,s.useState)(!1),[W,Y]=(0,s.useState)([]),[H,G]=(0,s.useState)(!1),[K,J]=(0,s.useState)(!1),[$,Z]=(0,s.useState)(()=>{try{return"true"===localStorage.getItem("residentTips.hide")}catch(e){return!1}}),[Q,X]=(0,s.useState)(!1),ee=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch(t){return String(e)}};(0,s.useEffect)(()=>{(async()=>{try{let e;e="admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?await k.documentsAPI.getAllDocuments():await k.documentsAPI.getMyDocuments(),j(e)}catch(e){console.error("Error fetching documents:",e)}finally{b(!1)}})(),(async()=>{try{try{const e=await(await Promise.resolve().then(n.bind(n,31694))).residentPersonalInfoAPI.getPersonalInfo();if(null!==e&&void 0!==e&&e.profileImage){const t=e.profileImage.startsWith("http")?e.profileImage:"".concat(window.location.origin).concat(e.profileImage);return void x(t)}if(null!==e&&void 0!==e&&e.profileImageId)return void x("/api/resident/personal-info/avatar/".concat(e.profileImageId))}catch(e){}try{const e=await Promise.resolve().then(n.bind(n,31694)),t=(await e.default.get("/resident/profile")).data;if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:"".concat(window.location.origin).concat(t.profileImage);x(e)}else null!==t&&void 0!==t&&t.profileImageId&&x("/api/resident/personal-info/avatar/".concat(t.profileImageId))}catch(e){}}catch(e){}})();const e=setInterval(()=>f((new Date).toLocaleString()),1e3);return()=>clearInterval(e)},[d]),(0,s.useEffect)(()=>{(async()=>{try{let e;e="admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?await k.contactAPI.getAllInquiries():await k.contactAPI.getMyInquiries(),Array.isArray(e)?R(e.length):e&&"number"===typeof e.count?R(e.count):R(e&&e.length||0)}catch(e){console.error("Failed to load inquiries:",e),R(0)}})();(async()=>{D(!0);try{const e=await k.contactAPI.getAnnouncements();Array.isArray(e)?N(e.length):e&&"number"===typeof e.count?N(e.count):N(e&&e.length||0)}catch(e){console.error("Failed to fetch announcements:",e),N(0)}finally{D(!1)}})()},[d]);const te=y.filter(e=>"pending"===(e.status||"").toString().toLowerCase()).length,ne=y.filter(e=>"approved"===(e.status||"").toString().toLowerCase()).length;return(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)("div",{style:{maxWidth:1200,margin:"40px auto",padding:"0 16px",position:"relative"},children:[(0,S.jsx)("div",{style:{marginBottom:18},children:(0,S.jsx)(l.A,{align:"middle",children:(0,S.jsx)(o.A,{children:(0,S.jsx)(h.A.Text,{style:{fontSize:16,color:"#888"},children:(0,S.jsxs)("span",{style:{marginRight:8},children:[(0,S.jsx)("span",{style:{color:"#1890ff",fontWeight:600},children:"Dashboard"})," ",">"," Home"]})})})})}),"resident"===(null===d||void 0===d?void 0:d.role)&&(0,S.jsxs)(r.A,{style:{width:"100%",margin:"0 auto 32px",borderRadius:32,boxShadow:"0 8px 32px #bfc7d6cc",background:"linear-gradient(120deg, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",border:"none",padding:0,position:"relative",overflow:"hidden",minHeight:170},bodyStyle:{padding:0},children:[(0,S.jsx)("div",{style:{position:"absolute",top:0,left:0,height:"100%",background:"radial-gradient(circle at 80% 20%, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",opacity:.18,zIndex:0}}),(0,S.jsx)(l.A,{align:"middle",style:{minHeight:170,padding:"32px 32px",position:"relative",zIndex:1},justify:"space-between",children:(0,S.jsx)(o.A,{xs:24,md:14,style:{display:"flex",alignItems:"center",gap:24},children:(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",gap:18,width:"100%",justifyContent:"space-between"},children:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:18},children:[(0,S.jsxs)("div",{style:{width:96,height:96,borderRadius:12,overflow:"hidden",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[p?(0,S.jsx)("img",{src:p,alt:(null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||"avatar",style:{width:96,height:96,objectFit:"cover",borderRadius:12}}):(0,S.jsx)(xe,{user:(()=>{let e=d;if(!e)try{const t=localStorage.getItem("userProfile");t&&(e=JSON.parse(t))}catch(t){}return e})(),size:96}),(0,S.jsx)("button",{onClick:()=>m("/profile"),title:"Edit profile",style:{position:"absolute",right:6,bottom:6,width:28,height:28,borderRadius:14,background:"#fff",border:"1px solid #e8e8e8",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 4px rgba(0,0,0,0.08)",cursor:"pointer"},children:(0,S.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,S.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z",fill:"#595959"}),(0,S.jsx)("path",{d:"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#595959"})]})})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)(h.A.Title,{level:3,style:{marginBottom:0,fontWeight:800},children:null!==(e=null!==(t=null!==(a=null===d||void 0===d?void 0:d.fullName)&&void 0!==a?a:null===d||void 0===d?void 0:d.username)&&void 0!==t?t:null===d||void 0===d?void 0:d.email)&&void 0!==e?e:""}),(0,S.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:18},children:["Barangay ID: ",null!==(i=null===d||void 0===d?void 0:d.barangayID)&&void 0!==i?i:(()=>{try{const e=localStorage.getItem("userProfile");if(e){const t=JSON.parse(e);return(null===t||void 0===t?void 0:t.barangayID)||"N/A"}}catch(e){}return"N/A"})()]}),(0,S.jsx)("div",{style:{marginTop:8},children:(0,S.jsx)(h.A.Text,{type:"secondary",children:(new Date).toLocaleString()})})]})]})})})})]}),(0,S.jsxs)(l.A,{gutter:[32,32],justify:"center",style:{marginBottom:40},children:[(0,S.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,S.jsx)(r.A,{hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #faad1444",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},onClick:async()=>{B(!0),E(!0);try{let e;"admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?(e=await k.documentsAPI.getAllDocuments(),e=(e||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase())):(e=await k.documentsAPI.getMyDocuments(),e=(e||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase())),z(e||[])}catch(e){z([])}finally{E(!1)}},bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,S.jsx)("div",{style:{background:"#faad14",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,S.jsx)(st.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,S.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:te}),(0,S.jsx)(h.A.Text,{style:{fontSize:18,color:"#faad14",fontWeight:700},children:"Pending Requests"})]})})}),(0,S.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,S.jsx)(r.A,{hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #52c41a44",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},bodyStyle:{padding:24},onClick:async()=>{M(!0),G(!0);try{let e;"admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?(e=await k.documentsAPI.getAllDocuments(),e=(e||[]).filter(e=>"approved"===(e.status||"").toString().toLowerCase())):(e=await k.documentsAPI.getMyDocuments(),e=(e||[]).filter(e=>"approved"===(e.status||"").toString().toLowerCase())),Y(e||[])}catch(e){Y([])}finally{G(!1)}},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,S.jsx)("div",{style:{background:"#52c41a",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,S.jsx)(ae.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,S.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:ne}),(0,S.jsx)(h.A.Text,{style:{fontSize:18,color:"#52c41a",fontWeight:700},children:"Approved Documents"})]})})}),(0,S.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,S.jsx)(r.A,{hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #1890ff44",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},onClick:()=>m("/inbox"),bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,S.jsx)("div",{style:{background:"#1890ff",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,S.jsx)(st.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,S.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:P}),(0,S.jsx)(h.A.Text,{style:{fontSize:18,color:"#1890ff",fontWeight:700},children:"Active Inquiries"})]})})}),(0,S.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,S.jsx)(r.A,{onClick:()=>m("/announcements"),hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #eb2f9644",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,S.jsx)("div",{style:{background:"#eb2f96",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,S.jsx)(tt.A,{count:C,offset:[8,0],children:(0,S.jsx)(he.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})})}),(0,S.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:C}),(0,S.jsx)(h.A.Text,{style:{fontSize:18,color:"#eb2f96",fontWeight:700},children:"Announcements"})]})})})]}),(0,S.jsx)(_.A,{title:"Pending Requests",visible:q,onCancel:()=>B(!1),footer:null,width:800,children:(0,S.jsx)(nt.A,{dataSource:O,loading:F,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,S.jsx)(_.A,{title:"Approved Documents",visible:U,onCancel:()=>M(!1),footer:null,width:1e3,children:(0,S.jsx)(nt.A,{dataSource:W,loading:H,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Date Requested",dataIndex:"dateRequested",key:"dateRequested",render:(e,t)=>ee(t.dateRequested||t.requestedAt||t.createdAt)},{title:"Date Approved",dataIndex:"dateApproved",key:"dateApproved",render:(e,t)=>ee(t.dateApproved||t.approvedAt||t.approvedOn||t.updatedAt)},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,S.jsx)(_.A,{title:"Resident Tool Tips",visible:K,onCancel:()=>J(!1),footer:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,S.jsx)(at.A,{checked:$,onChange:e=>{const t=e.target.checked;Z(t);try{localStorage.setItem("residentTips.hide",t?"true":"false")}catch(n){}},children:"Don't show again"}),(0,S.jsxs)("div",{children:[(0,S.jsx)(u.Ay,{onClick:()=>J(!1),style:{marginRight:8},children:"Cancel"}),(0,S.jsx)(u.Ay,{type:"primary",onClick:()=>{J(!1)},children:"Got it"})]})]}),width:720,children:(0,S.jsxs)("ul",{style:{paddingLeft:20},children:[(0,S.jsx)("li",{children:"Use the Request Document button to apply for barangay certificates and permits."}),(0,S.jsx)("li",{children:"Check your profile information regularly to ensure accuracy."}),(0,S.jsx)("li",{children:"Contact barangay staff for assistance with business registration or solo parent certification."}),(0,S.jsx)("li",{children:"For lost documents, use the Inquiry form to request help."}),(0,S.jsx)("li",{children:"All document requests are processed during office hours only."})]})}),(0,S.jsx)("div",{style:{position:"fixed",right:20,bottom:24,zIndex:1050},children:(0,S.jsx)(A.A,{title:$?"Tips hidden (will remain hidden if checked)":"Resident Tool Tips",children:(0,S.jsx)(u.Ay,{type:"primary",shape:"circle",size:"large",onClick:()=>J(!0),onMouseEnter:()=>X(!0),onMouseLeave:()=>X(!1),icon:(0,S.jsx)(it.A,{style:{color:"#fff",fontSize:20}}),style:{width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:Q?"0 10px 30px rgba(24,144,255,0.22)":"0 6px 18px rgba(0,0,0,0.12)",transform:Q?"translateY(-4px) scale(1.03)":"none",transition:"transform 160ms cubic-bezier(.2,.8,.2,1), box-shadow 160ms"}})})})]})})},lt=()=>{var e,t,a,i;const{user:d,setUser:c}=V(),m=(null!==d&&void 0!==d||(()=>{try{const e=localStorage.getItem("userProfile");return e?JSON.parse(e):null}catch(e){return null}})(),(0,L.Zp)()),[p,x]=(0,s.useState)(null),[g,f]=(0,s.useState)(()=>(new Date).toLocaleString()),[y,j]=(0,s.useState)([]),[v,b]=(0,s.useState)(!0),[w,I]=(0,s.useState)(0),[C,N]=(0,s.useState)(0),[T,D]=(0,s.useState)(!1),[P,R]=(0,s.useState)(!1),[B,O]=(0,s.useState)([]),[z,F]=(0,s.useState)(!1),[E,U]=(0,s.useState)(!1),[M,W]=(0,s.useState)([]),[Y,H]=(0,s.useState)(!1),[G,K]=(0,s.useState)(!1),[J,$]=(0,s.useState)(()=>{try{return"true"===localStorage.getItem("residentTips.hide")}catch(e){return!1}}),[Z,Q]=(0,s.useState)(!1),X=e=>{if(!e)return"";try{return new Date(e).toLocaleString()}catch(t){return String(e)}};(0,s.useEffect)(()=>{(async()=>{try{let e;e="admin"===(null===d||void 0===d?void 0:d.role)||"staff"===(null===d||void 0===d?void 0:d.role)?await k.documentsAPI.getAllDocuments():await k.documentsAPI.getMyDocuments(),j(e)}catch(e){console.error("Error fetching documents:",e)}finally{b(!1)}})(),(async()=>{try{try{const e=await(await Promise.resolve().then(n.bind(n,31694))).residentPersonalInfoAPI.getPersonalInfo();if(null!==e&&void 0!==e&&e.profileImage){const t=e.profileImage.startsWith("http")?e.profileImage:"".concat(window.location.origin).concat(e.profileImage);return void x(t)}if(null!==e&&void 0!==e&&e.profileImageId)return void x("/api/resident/personal-info/avatar/".concat(e.profileImageId))}catch(e){}try{const e=await Promise.resolve().then(n.bind(n,31694)),t=(await e.default.get("/resident/profile")).data;if(null!==t&&void 0!==t&&t.profileImage){const e=t.profileImage.startsWith("http")?t.profileImage:"".concat(window.location.origin).concat(t.profileImage);x(e)}else null!==t&&void 0!==t&&t.profileImageId&&x("/api/resident/personal-info/avatar/".concat(t.profileImageId))}catch(e){}}catch(e){}})();const e=setInterval(()=>f((new Date).toLocaleString()),1e3);return()=>clearInterval(e)},[d]),(0,s.useEffect)(()=>{(async()=>{D(!0);try{const e=await k.contactAPI.getAnnouncements();Array.isArray(e)?N(e.length):e&&"number"===typeof e.count?N(e.count):N(e&&e.length||0)}catch(e){console.error("Failed to fetch announcements:",e),N(0)}finally{D(!1)}})()},[d]);y.filter(e=>"pending"===(e.status||"").toString().toLowerCase()).length,y.filter(e=>"approved"===(e.status||"").toString().toLowerCase()).length;return(0,S.jsx)(S.Fragment,{children:(0,S.jsxs)("div",{style:{maxWidth:1200,margin:"40px auto",padding:"0 16px",position:"relative"},children:[(0,S.jsx)("div",{style:{marginBottom:18},children:(0,S.jsx)(l.A,{align:"middle",children:(0,S.jsx)(o.A,{children:(0,S.jsx)(h.A.Text,{style:{fontSize:16,color:"#888"},children:(0,S.jsxs)("span",{style:{marginRight:8},children:[(0,S.jsx)("span",{style:{color:"#1890ff",fontWeight:600},children:"Dashboard"})," ",">"," Home"]})})})})}),"resident"===(null===d||void 0===d?void 0:d.role)&&(0,S.jsxs)(r.A,{style:{width:"100%",margin:"0 auto 32px",borderRadius:32,boxShadow:"0 8px 32px #bfc7d6cc",background:"linear-gradient(120deg, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",border:"none",padding:0,position:"relative",overflow:"hidden",minHeight:170},bodyStyle:{padding:0},children:[(0,S.jsx)("div",{style:{position:"absolute",top:0,left:0,height:"100%",background:"radial-gradient(circle at 80% 20%, #e3e6f3 0%, #f8fafc 60%, #f6f1f7 100%)",opacity:.18,zIndex:0}}),(0,S.jsx)(l.A,{align:"middle",style:{minHeight:170,padding:"32px 32px",position:"relative",zIndex:1},justify:"space-between",children:(0,S.jsx)(o.A,{xs:24,md:14,style:{display:"flex",alignItems:"center",gap:24},children:(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",gap:18,width:"100%",justifyContent:"space-between"},children:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:18},children:[(0,S.jsxs)("div",{style:{width:96,height:96,borderRadius:12,overflow:"hidden",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[p?(0,S.jsx)("img",{src:p,alt:(null===d||void 0===d?void 0:d.fullName)||(null===d||void 0===d?void 0:d.username)||"avatar",style:{width:96,height:96,objectFit:"cover",borderRadius:12}}):(0,S.jsx)(xe,{user:(()=>{let e=d;if(!e)try{const t=localStorage.getItem("userProfile");t&&(e=JSON.parse(t))}catch(t){}return e})(),size:96}),(0,S.jsx)("button",{onClick:()=>m("/profile"),title:"Edit profile",style:{position:"absolute",right:6,bottom:6,width:28,height:28,borderRadius:14,background:"#fff",border:"1px solid #e8e8e8",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 1px 4px rgba(0,0,0,0.08)",cursor:"pointer"},children:(0,S.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,S.jsx)("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25z",fill:"#595959"}),(0,S.jsx)("path",{d:"M20.71 7.04a1 1 0 0 0 0-1.41l-2.34-2.34a1 1 0 0 0-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#595959"})]})})]}),(0,S.jsxs)("div",{children:[(0,S.jsx)(h.A.Title,{level:3,style:{marginBottom:0,fontWeight:800},children:null!==(e=null!==(t=null!==(a=null===d||void 0===d?void 0:d.fullName)&&void 0!==a?a:null===d||void 0===d?void 0:d.username)&&void 0!==t?t:null===d||void 0===d?void 0:d.email)&&void 0!==e?e:""}),(0,S.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:18},children:["Barangay ID: ",null!==(i=null===d||void 0===d?void 0:d.barangayID)&&void 0!==i?i:(()=>{try{const e=localStorage.getItem("userProfile");if(e){const t=JSON.parse(e);return(null===t||void 0===t?void 0:t.barangayID)||"N/A"}}catch(e){}return"N/A"})()]}),(0,S.jsx)("div",{style:{marginTop:8},children:(0,S.jsx)(h.A.Text,{type:"secondary",children:(new Date).toLocaleString()})})]})]})})})})]}),(0,S.jsxs)(l.A,{gutter:[32,32],justify:"center",style:{marginBottom:40},children:[(0,S.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,S.jsx)(r.A,{onClick:()=>m("/request"),hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #1890ff44",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,S.jsx)("div",{style:{background:"#1890ff",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,S.jsx)(q.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})}),(0,S.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:"Request"}),(0,S.jsx)(h.A.Text,{style:{fontSize:18,color:"#1890ff",fontWeight:700},children:"Request Document"})]})})}),(0,S.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,S.jsx)(r.A,{onClick:()=>m("/announcements"),hoverable:!0,style:{borderRadius:20,minHeight:170,boxShadow:"0 2px 12px #eb2f9644",transition:"box-shadow 0.2s, transform 0.2s",padding:0,cursor:"pointer"},bodyStyle:{padding:24},onMouseEnter:e=>e.currentTarget.style.transform="translateY(-6px) scale(1.03)",onMouseLeave:e=>e.currentTarget.style.transform="none",children:(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",gap:12},children:[(0,S.jsx)("div",{style:{background:"#eb2f96",borderRadius:"50%",width:54,height:54,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:8},children:(0,S.jsx)(tt.A,{count:C,offset:[8,0],children:(0,S.jsx)(he.A,{style:{color:"#fff",fontSize:28,transition:"transform 0.2s"}})})}),(0,S.jsx)(h.A.Title,{level:2,style:{margin:0,fontWeight:800},children:C}),(0,S.jsx)(h.A.Text,{style:{fontSize:18,color:"#eb2f96",fontWeight:700},children:"Announcements"})]})})})]}),(0,S.jsx)(_.A,{title:"Pending Requests",visible:P,onCancel:()=>R(!1),footer:null,width:800,children:(0,S.jsx)(nt.A,{dataSource:B,loading:z,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,S.jsx)(_.A,{title:"Approved Documents",visible:E,onCancel:()=>U(!1),footer:null,width:1e3,children:(0,S.jsx)(nt.A,{dataSource:M,loading:Y,rowKey:e=>e._id,pagination:{pageSize:8},columns:[{title:"First Name",dataIndex:"fieldValues",key:"firstName",render:(e,t)=>(null===e||void 0===e?void 0:e.firstName)||t.username||"Unknown"},{title:"Doc Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Date Requested",dataIndex:"dateRequested",key:"dateRequested",render:(e,t)=>X(t.dateRequested||t.requestedAt||t.createdAt)},{title:"Date Approved",dataIndex:"dateApproved",key:"dateApproved",render:(e,t)=>X(t.dateApproved||t.approvedAt||t.approvedOn||t.updatedAt)},{title:"Status",dataIndex:"status",key:"status",render:e=>(e||"").toString().toLowerCase()}]})}),(0,S.jsx)(_.A,{title:"Resident Tool Tips",visible:G,onCancel:()=>K(!1),footer:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,S.jsx)(at.A,{checked:J,onChange:e=>{const t=e.target.checked;$(t);try{localStorage.setItem("residentTips.hide",t?"true":"false")}catch(n){}},children:"Don't show again"}),(0,S.jsxs)("div",{children:[(0,S.jsx)(u.Ay,{onClick:()=>K(!1),style:{marginRight:8},children:"Cancel"}),(0,S.jsx)(u.Ay,{type:"primary",onClick:()=>{K(!1)},children:"Got it"})]})]}),width:720,children:(0,S.jsxs)("ul",{style:{paddingLeft:20},children:[(0,S.jsx)("li",{children:"Use the Request Document button to apply for barangay certificates and permits."}),(0,S.jsx)("li",{children:"Check your profile information regularly to ensure accuracy."}),(0,S.jsx)("li",{children:"Contact barangay staff for assistance with business registration or solo parent certification."}),(0,S.jsx)("li",{children:"For lost documents, contact barangay staff or visit the office for assistance."}),(0,S.jsx)("li",{children:"All document requests are processed during office hours only."})]})}),(0,S.jsx)("div",{style:{position:"fixed",right:20,bottom:24,zIndex:1050},children:(0,S.jsx)(A.A,{title:J?"Tips hidden (will remain hidden if checked)":"Resident Tool Tips",children:(0,S.jsx)(u.Ay,{type:"primary",shape:"circle",size:"large",onClick:()=>K(!0),onMouseEnter:()=>Q(!0),onMouseLeave:()=>Q(!1),icon:(0,S.jsx)(it.A,{style:{color:"#fff",fontSize:20}}),style:{width:56,height:56,display:"flex",alignItems:"center",justifyContent:"center",boxShadow:Z?"0 10px 30px rgba(24,144,255,0.22)":"0 6px 18px rgba(0,0,0,0.12)",transform:Z?"translateY(-4px) scale(1.03)":"none",transition:"transform 160ms cubic-bezier(.2,.8,.2,1), box-shadow 160ms"}})})})]})})};var ot=n(80349),dt=n(97326),ct=n(99472),ut=n(48677),ht=n(99098),mt=n(33498),pt=(n(96292),n(57305)),xt=n(89157),gt=n(57179),ft=n(82282),yt=n(41739),At=n(25870);const jt=()=>{const{user:e}=V(),t=(0,L.Zp)(),[n,a]=(0,s.useState)(!1),[i,d]=(0,s.useState)([]),[m,x]=(0,s.useState)([]),[A,j]=(0,s.useState)([]),[v,w]=(0,s.useState)(()=>{try{const e=localStorage.getItem("viewedInquiries"),t=e?JSON.parse(e):[];return new Set(t||[])}catch(e){return new Set}}),I=e=>{e&&w(t=>{const n=new Set(Array.from(t));n.add(String(e));try{localStorage.setItem("viewedInquiries",JSON.stringify(Array.from(n)))}catch(a){}return n})},[C,N]=(0,s.useState)([]),[T,D]=(0,s.useState)([]),[P,R]=(0,s.useState)(!1),[q,B]=(0,s.useState)(null),[O,z]=(0,s.useState)(!1),[E,U]=(0,s.useState)(null),[M,W]=(0,s.useState)(null),[Y,H]=(0,s.useState)(!1),[G,K]=(0,s.useState)(null),[J,$]=(0,s.useState)(""),[Z,Q]=(0,s.useState)(""),[ee,te]=(0,s.useState)(!1),[ne,ie]=(0,s.useState)(!1),[le,oe]=(0,s.useState)(!1),[de,ue]=(0,s.useState)([]),[he,me]=(0,s.useState)(!1),pe={};i.forEach(e=>{const t=e.type||"Unknown";pe[t]||(pe[t]=[]),pe[t].push(e)});const[xe,ge]=(0,s.useState)({pendingRequests:0,totalDocuments:0,completedRequests:0}),fe=e=>(0,S.jsx)(f.A,{color:{pending:"gold",approved:"success",rejected:"error",processing:"processing"}[(null===e||void 0===e?void 0:e.toLowerCase())||"default"],children:(null===e||void 0===e?void 0:e.toUpperCase())||"UNKNOWN"}),ye=async()=>{a(!0);try{const[n,a]=await Promise.all([k.documentsAPI.getDocumentRecords(),k.contactAPI.getAllInquiries()]);d(n),x(a);const s=a.filter(t=>t.assignedRole&&e&&t.assignedRole===e.role||t.assignedTo&&Array.isArray(t.assignedTo)&&e&&t.assignedTo.includes(e._id));j(s);let i=n.length;try{const e=await fetch("/api/processed-documents?page=1&limit=1",{credentials:"include"});if(e.ok){const t=await e.json();t&&"number"===typeof t.total&&(i=t.total)}}catch(t){}ge({pendingRequests:n.filter(e=>"pending"===e.status).length,totalDocuments:i,completedRequests:n.filter(e=>"approved"===e.status).length})}catch(n){console.error("Error fetching data:",n)}finally{a(!1)}};(0,s.useEffect)(()=>{ye(),Ae()},[]);const Ae=async()=>{R(!0);try{const e=await k.contactAPI.getAnnouncements();D(Array.isArray(e)?e.slice(0,6):[])}catch(e){console.error("Failed to load mini announcements",e),D([])}finally{R(!1)}};function je(e){if(!e)return"Unknown";let t=e;return t=t.replace(/^Other\s*/i,"").trim(),t.split("_").map(e=>{const t=e||"";return t.length>0?t.charAt(0).toUpperCase()+t.slice(1).toLowerCase():""}).filter(Boolean).join(" ")}function ve(e){if(!e)return"";return new Date(e).toLocaleString()}const be=function(){return((arguments.length>0&&void 0!==arguments[0]?arguments[0]:[])||[]).slice().sort((e,t)=>{const n=e&&e.createdAt?new Date(e.createdAt).getTime():0;return(t&&t.createdAt?new Date(t.createdAt).getTime():0)-n})},we=(e,n)=>{t(e,{state:n})},Se=e=>{try{t(e)}catch(n){window.location.href=e}};return(0,S.jsx)(p.A,{spinning:n,tip:"Loading...",children:(0,S.jsxs)("div",{children:[(0,S.jsxs)(l.A,{gutter:[16,16],style:{marginBottom:24},children:[(0,S.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,S.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>{const e=i.find(e=>"pending"===e.status);e&&e._id?we("/document-processing",{openRequestId:e._id}):we("/document-processing")},style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,S.jsx)(Te.A,{title:(0,S.jsxs)(X.A,{children:[(0,S.jsx)(y.A,{size:"small",style:{backgroundColor:"#fff7e6",color:"#faad14"},children:(0,S.jsx)(pt.A,{style:{fontSize:"14px"}})}),(0,S.jsx)("span",{children:"Pending Requests"})]}),value:xe.pendingRequests,valueStyle:{color:"#faad14",fontSize:"28px",marginBottom:"4px"},prefix:(0,S.jsx)(xt.A,{style:{fontSize:"16px"}})}),(0,S.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#faad14"},children:["View Pending Requests",(0,S.jsx)(qe.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})}),(0,S.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,S.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>(async()=>{me(!0);try{let n=[];try{const e=await fetch("/api/processed-documents?page=1&limit=200",{credentials:"include"});if(e.ok){const t=await e.json();t&&Array.isArray(t.items)?n=t.items:Array.isArray(t)&&(n=t)}}catch(e){try{const e=await k.documentsAPI.listFiles();n=(Array.isArray(e)?e:e&&e.data?e.data:[]).filter(e=>{const t=(e.status||"").toString().toLowerCase();return["processed","approved","completed"].includes(t)||!0===e.processed})}catch(t){n=[]}}ue(n||[])}catch(n){console.error("Failed to fetch documents for modal",n),ue([])}finally{me(!1),oe(!0)}})(),style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,S.jsx)(Te.A,{title:(0,S.jsxs)(X.A,{children:[(0,S.jsx)(y.A,{size:"small",style:{backgroundColor:"#e6f7ff",color:"#1890ff"},children:(0,S.jsx)(gt.A,{style:{fontSize:"14px"}})}),(0,S.jsx)("span",{children:"Total Documents"})]}),value:xe.totalDocuments,valueStyle:{color:"#1890ff",fontSize:"28px",marginBottom:"4px"},prefix:(0,S.jsx)(ft.A,{style:{fontSize:"16px"}})}),(0,S.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#1890ff"},children:["Browse Documents",(0,S.jsx)(qe.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})}),(0,S.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,S.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>ie(!0),style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,S.jsx)(Te.A,{title:(0,S.jsxs)(X.A,{children:[(0,S.jsx)(y.A,{size:"small",style:{backgroundColor:"#f6ffed",color:"#52c41a"},children:(0,S.jsx)(yt.A,{style:{fontSize:"14px"}})}),(0,S.jsx)("span",{children:"Completed Requests"})]}),value:xe.completedRequests,valueStyle:{color:"#52c41a",fontSize:"28px",marginBottom:"4px"},prefix:(0,S.jsx)(F.A,{style:{fontSize:"16px"}})}),(0,S.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#52c41a"},children:["View Completed",(0,S.jsx)(qe.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})}),(0,S.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,S.jsxs)(r.A,{hoverable:!0,bordered:!1,size:"small",onClick:()=>Se("/staff/inbox"),style:{cursor:"pointer",transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},children:[(0,S.jsx)(Te.A,{title:(0,S.jsxs)(X.A,{children:[(0,S.jsx)(y.A,{size:"small",style:{backgroundColor:"#f9f0ff",color:"#722ed1"},children:(0,S.jsx)(b.A,{style:{fontSize:"14px"}})}),(0,S.jsx)("span",{children:"Staff Inbox"})]}),value:A.length,valueStyle:{color:"#722ed1",fontSize:"28px",marginBottom:"4px"},prefix:(0,S.jsx)(se.A,{style:{fontSize:"16px"}})}),(0,S.jsxs)(h.A.Link,{style:{fontSize:"13px",color:"#722ed1"},children:["Open Inbox",(0,S.jsx)(qe.A,{style:{fontSize:"11px",marginLeft:"4px"}})]})]})})]}),(0,S.jsxs)(l.A,{gutter:[16,16],children:[(0,S.jsx)(o.A,{xs:24,lg:8,children:(0,S.jsx)(r.A,{title:(0,S.jsxs)(X.A,{children:[(0,S.jsx)(re.A,{})," Document Categories"]}),hoverable:!0,bordered:!1,size:"small",className:"dashboard-card",style:{transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)"},bodyStyle:{padding:"0",height:"400px",maxHeight:"400px",overflow:"hidden"},children:(0,S.jsx)(dt.A,{defaultActiveKey:["Certificates"],expandIcon:e=>{let{isActive:t}=e;return(0,S.jsx)(qe.A,{rotate:t?90:0})},style:{background:"white",height:"400px",overflowY:"auto"},children:Object.entries((e=>{const t={Certificates:{icon:(0,S.jsx)(ht.A,{style:{fontSize:"18px",color:"#1890ff"}}),items:[],color:"#1890ff",description:"Birth, Death, Residency Certificates and more"},Permits:{icon:(0,S.jsx)(mt.A,{style:{fontSize:"18px",color:"#52c41a"}}),items:[],color:"#52c41a",description:"Building, Business, and Special Event Permits"},Complete:{icon:(0,S.jsx)(ce.A,{style:{fontSize:"18px",color:"#52c41a"}}),items:[],color:"#52c41a",description:"All completed and approved document requests"}};return e.forEach(e=>{const n=(e.type||"").toLowerCase(),a=(e.status||"").toLowerCase();n.includes("certificate")||n.includes("certification")?t.Certificates.items.push(e):n.includes("permit")&&t.Permits.items.push(e),"approved"!==a&&"completed"!==a||t.Complete.items.push(e)}),t})(i)).map(e=>{let[n,a]=e;const s=a.items.filter(e=>{var t;return"pending"===(null===(t=e.status)||void 0===t?void 0:t.toLowerCase())}).length;return(0,S.jsxs)(dt.A.Panel,{header:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[(0,S.jsxs)(X.A,{align:"center",children:[(0,S.jsx)(y.A,{size:"small",style:{backgroundColor:a.color+"15",color:a.color},children:a.icon}),(0,S.jsx)("span",{style:{fontWeight:500,fontSize:"14px"},children:n})]}),(0,S.jsxs)("div",{style:{marginLeft:"auto",display:"flex",gap:"8px",alignItems:"center"},children:[s>0&&(0,S.jsxs)(f.A,{color:"gold",style:{marginRight:0},children:[s," pending"]}),(0,S.jsx)(tt.A,{count:a.items.length,style:{backgroundColor:a.color},size:"small"})]})]}),children:[(0,S.jsx)("div",{style:{marginBottom:"16px"},children:(0,S.jsx)(h.A.Text,{type:"secondary",style:{fontSize:"13px"},children:a.description})}),(0,S.jsx)(g.A,{size:"small",dataSource:a.items.slice(0,5),split:!0,renderItem:e=>{var n;const a={PENDING:{color:"#faad14",bg:"#fff7e6"},APPROVED:{color:"#52c41a",bg:"#f6ffed"},REJECTED:{color:"#ff4d4f",bg:"#fff1f0"},DEFAULT:{color:"#8c8c8c",bg:"#f5f5f5"}},s=(null===(n=e.status)||void 0===n?void 0:n.toUpperCase())||"DEFAULT",i=a[s]||a.DEFAULT;return(0,S.jsx)(g.A.Item,{onClick:()=>t("/document-processing",{state:{openRequestId:e._id}}),actions:["PENDING"===e.status&&(0,S.jsxs)(X.A,{size:4,children:[(0,S.jsx)(u.Ay,{type:"text",size:"small",icon:(0,S.jsx)(F.A,{style:{color:"#52c41a"}}),onClick:t=>{t.stopPropagation(),U(e),Q("APPROVED")}}),(0,S.jsx)(u.Ay,{type:"text",size:"small",icon:(0,S.jsx)(At.A,{style:{color:"#ff4d4f"}}),onClick:t=>{t.stopPropagation(),U(e),Q("REJECTED")}})]})].filter(Boolean),style:{padding:"12px 0"},children:(0,S.jsx)(g.A.Item.Meta,{avatar:(0,S.jsx)(y.A,{size:36,style:{backgroundColor:i.bg,color:i.color},icon:(0,S.jsx)(ae.A,{})}),title:(0,S.jsxs)(X.A,{size:8,style:{marginBottom:4},children:[(0,S.jsx)(h.A.Text,{strong:!0,style:{fontSize:"14px"},children:je(e.type||e.title)}),(0,S.jsx)(f.A,{color:i.color,style:{margin:0,padding:"0 6px",fontSize:"12px",lineHeight:"18px"},children:s})]}),description:(0,S.jsxs)(X.A,{direction:"vertical",size:0,children:[(0,S.jsxs)(h.A.Text,{type:"secondary",style:{fontSize:"13px"},children:["Requested by: ",e.username||"Unknown"]}),(0,S.jsx)(h.A.Text,{type:"secondary",style:{fontSize:"12px"},children:ve(e.dateRequested||"")})]})})})},locale:{emptyText:(0,S.jsx)(ct.A,{image:ct.A.PRESENTED_IMAGE_SIMPLE,description:(0,S.jsxs)(h.A.Text,{type:"secondary",children:["No ",n.toLowerCase()," requests"]})})}}),a.items.length>0&&(0,S.jsx)("div",{style:{textAlign:"center",marginTop:"16px",paddingTop:"16px",borderTop:"1px solid #f0f0f0"},children:(0,S.jsxs)(u.Ay,{type:"link",size:"small",icon:a.icon,onClick:()=>Se("/documents"),children:["View All ",n]})})]},n)})})})}),(0,S.jsx)(o.A,{xs:24,lg:8,children:(0,S.jsx)(r.A,{title:(0,S.jsxs)(X.A,{children:[(0,S.jsx)(st.A,{}),(0,S.jsx)("span",{children:"Inquiries Inbox"}),(0,S.jsx)(tt.A,{count:A.filter(e=>"open"===e.status||"PENDING"===e.status).length,style:{backgroundColor:"#722ed1"}})]}),extra:(0,S.jsx)(X.A,{children:(0,S.jsx)(Te.A,{value:A.length,suffix:"total",valueStyle:{fontSize:"14px",color:"#8c8c8c"}})}),hoverable:!0,bordered:!1,size:"small",className:"dashboard-card",style:{transition:"all 0.3s",boxShadow:"0 1px 2px rgba(0,0,0,0.05)",position:"relative"},bodyStyle:{height:"400px",maxHeight:"400px",padding:0,overflow:"hidden"},children:(0,S.jsxs)("div",{style:{padding:"0 12px"},children:[(0,S.jsxs)(dt.A,{accordion:!1,defaultActiveKey:["open"],expandIcon:e=>{let{isActive:t}=e;return(0,S.jsx)(qe.A,{rotate:t?90:0})},style:{background:"white"},children:[(0,S.jsx)(dt.A.Panel,{header:(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:(0,S.jsxs)(X.A,{align:"center",children:[(0,S.jsx)(st.A,{style:{color:"#722ed1",fontSize:"16px"}}),(0,S.jsx)(h.A.Text,{strong:!0,children:"Open Inquiries"}),(0,S.jsx)(tt.A,{count:A.filter(e=>"PENDING"===e.status||"open"===e.status).length,style:{backgroundColor:"#722ed1"}})]})}),children:(0,S.jsx)("div",{style:{maxHeight:300,overflowY:"auto",paddingRight:8},children:0===A.filter(e=>"PENDING"===e.status||"open"===e.status).length?(0,S.jsx)(ct.A,{image:ct.A.PRESENTED_IMAGE_SIMPLE,description:(0,S.jsx)(h.A.Text,{type:"secondary",children:"No open inquiries"})}):(0,S.jsx)(g.A,{size:"large",dataSource:be(A.filter(e=>"PENDING"===e.status||"open"===e.status)),renderItem:e=>{const n="PENDING"===e.status||"open"===e.status,a=n?"#722ed1":"#8c8c8c",s=n?"#f9f0ff":"#f5f5f5",i=e._id&&v.has(String(e._id)),r=e.username||e.residentName||e.subject||"Unknown",l=r&&"Unknown"!==r&&r.length>0?r.charAt(0).toUpperCase():"?";return(0,S.jsx)(g.A.Item,{style:{padding:"18px 20px",minHeight:72,borderBottom:"1px solid #f0f0f0",transition:"all 0.3s ease",cursor:"pointer",backgroundColor:"white"},onClick:()=>{e._id&&I(String(e._id)),t("/staff/inbox",{state:{openInquiryId:e._id}})},onMouseEnter:e=>{e.currentTarget.style.backgroundColor="#fafafa"},onMouseLeave:e=>{e.currentTarget.style.backgroundColor="white"},children:(0,S.jsx)(g.A.Item.Meta,{avatar:(0,S.jsx)(tt.A,{dot:n,color:n&&!i?"#faad14":"#722ed1",offset:[-6,6],children:(0,S.jsx)(y.A,{size:40,style:{backgroundColor:s,color:a,fontSize:"15px",fontWeight:600},children:l})}),title:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",marginBottom:0},children:[(0,S.jsx)("div",{style:{fontSize:"14px",fontWeight:600,color:"rgba(0, 0, 0, 0.85)"},children:e.username||"Unknown User"}),(0,S.jsx)(f.A,{color:n?"gold":"success",style:{margin:0,fontSize:"12px",lineHeight:"20px",height:"22px",padding:"0 10px",fontWeight:"normal",borderRadius:"4px"},children:n?"PENDING":"RESOLVED"}),n&&!i&&(0,S.jsx)(f.A,{color:"default",onClick:t=>{t.stopPropagation(),e._id&&I(String(e._id))},style:{marginLeft:8,cursor:"pointer",background:"#fff7e6",color:"#d48806",border:"1px solid #ffd591"},children:"UNREAD"})]}),description:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",width:"100%"},children:[(0,S.jsx)(h.A.Text,{style:{fontSize:"13px",color:"rgba(0, 0, 0, 0.65)",flexGrow:1,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.5"},children:e.message}),(0,S.jsx)(h.A.Text,{type:"secondary",style:{fontSize:"12px",flexShrink:0,color:"#8c8c8c"},children:ve(e.createdAt)})]})})})}})})},"open"),(0,S.jsx)(dt.A.Panel,{header:(0,S.jsx)("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:(0,S.jsxs)(X.A,{align:"center",children:[(0,S.jsx)(st.A,{style:{color:"#52c41a",fontSize:"16px"}}),(0,S.jsx)(h.A.Text,{strong:!0,children:"Resolved Inquiries"}),(0,S.jsx)(tt.A,{count:A.filter(e=>!("PENDING"===e.status||"open"===e.status)).length,style:{backgroundColor:"#52c41a"}})]})}),children:(0,S.jsx)("div",{style:{maxHeight:220,overflowY:"auto",paddingRight:8},children:0===A.filter(e=>!("PENDING"===e.status||"open"===e.status)).length?(0,S.jsx)(ct.A,{image:ct.A.PRESENTED_IMAGE_SIMPLE,description:(0,S.jsx)(h.A.Text,{type:"secondary",children:"No resolved inquiries"})}):(0,S.jsx)(g.A,{size:"small",dataSource:be(A.filter(e=>!("PENDING"===e.status||"open"===e.status))),renderItem:e=>(0,S.jsx)(g.A.Item,{style:{padding:"12px 0",borderBottom:"1px solid #f0f0f0"},onClick:()=>{e._id&&I(String(e._id)),W(e)},children:(0,S.jsx)(g.A.Item.Meta,{avatar:(0,S.jsx)(y.A,{size:40,style:{backgroundColor:"#f5f5f5",color:"#8c8c8c",fontSize:14},children:(e.username||"Unknown").charAt(0).toUpperCase()}),title:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,S.jsx)("div",{style:{fontSize:13,fontWeight:600},children:e.username||"Unknown User"}),(0,S.jsx)(f.A,{color:"success",style:{margin:0,fontSize:12},children:"RESOLVED"})]}),description:(0,S.jsx)("div",{style:{fontSize:12,color:"#888"},children:e.message})})})})})},"resolved")]}),(0,S.jsx)("div",{style:{position:"absolute",right:12,bottom:12,zIndex:40},children:(0,S.jsx)(u.Ay,{type:"link",style:{position:"absolute",right:16,bottom:0,fontSize:13,color:"#1890ff",zIndex:50,pointerEvents:"auto"},onClick:e=>{try{e.stopPropagation()}catch(n){}t("/inquiry-tracker")},children:"Expand"})})]})})}),(0,S.jsx)(o.A,{xs:24,lg:8,children:(0,S.jsxs)(r.A,{title:(0,S.jsxs)(X.A,{children:[(0,S.jsx)(ae.A,{})," Announcements"]}),style:{marginTop:0,background:"#fafbfc",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0",position:"relative"},styles:{body:{padding:12}},size:"small",hoverable:!1,children:[0===T.length?(0,S.jsx)(ct.A,{image:(0,S.jsx)(ae.A,{style:{fontSize:42,color:"#d9d9d9"}}),description:(0,S.jsx)("span",{style:{color:"#888"},children:"No announcements"})}):(0,S.jsx)("div",{style:{maxHeight:320,overflowY:"auto",paddingRight:6},children:(0,S.jsx)(g.A,{loading:P,dataSource:T,renderItem:e=>(0,S.jsxs)(g.A.Item,{style:{cursor:"pointer",padding:"10px 8px",alignItems:"center"},onClick:()=>{B(e),z(!0)},children:[(0,S.jsx)(g.A.Item.Meta,{title:(0,S.jsx)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:(0,S.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,S.jsx)("div",{style:{fontWeight:600,fontSize:13,display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.2em"},children:e.text||"Untitled"}),(0,S.jsx)("div",{style:{fontSize:12,color:"#888",marginTop:6},children:new Date(e.createdAt).toLocaleString()})]})}),description:null}),e.imagePath&&(0,S.jsx)("div",{style:{marginLeft:12,width:92,display:"flex",justifyContent:"flex-end",flexShrink:0},children:(0,S.jsx)("img",{loading:"lazy",className:"rounded-img",src:(0,k.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image")),alt:"ann",style:{width:92,height:60,objectFit:"cover",borderRadius:6,background:"#f0f0f0"}})})]}),size:"small"})}),(0,S.jsx)(u.Ay,{type:"link",style:{position:"absolute",right:16,bottom:0,fontSize:13,color:"#1890ff"},onClick:()=>t("/admin/announcements"),children:"Manage"}),(0,S.jsx)(ut.A,{open:O,onClose:()=>{z(!1),B(null)},title:"Announcement",width:720,placement:"right",children:q&&(0,S.jsxs)("div",{children:[(0,S.jsx)(h.A.Text,{style:{display:"block",marginBottom:12,whiteSpace:"pre-wrap"},children:q.text}),q.imagePath&&(0,S.jsx)("img",{loading:"lazy",className:"rounded-img rounded-img-lg",src:(0,k.getAbsoluteApiUrl)("/announcements/".concat(q._id,"/image")),alt:"announcement",style:{width:"100%",height:"auto",borderRadius:8,background:"#f6f6f6"}}),(0,S.jsx)("div",{style:{marginTop:8,color:"#888"},children:new Date(q.createdAt).toLocaleString()})]})})]})})]}),(0,S.jsxs)(_.A,{open:le,title:"Processed Documents (".concat(de.length,")"),onCancel:()=>{oe(!1)},footer:null,width:900,children:[(0,S.jsx)(p.A,{spinning:he,children:(0,S.jsx)(nt.A,{dataSource:de,rowKey:e=>e._id||e.id||e.filename,pagination:{pageSize:10},columns:[{title:"Title",dataIndex:"title",key:"title",render:(e,t)=>e||t.filename||t.name||"Untitled"},{title:"Date",dataIndex:"createdAt",key:"createdAt",render:e=>ve(e)},{title:"Action",key:"action",width:120,render:(e,t)=>(0,S.jsx)(u.Ay,{type:"link",onClick:()=>(async e=>{try{const a=e=>{if(!e&&0!==e)return null;if("string"===typeof e)return e;if("object"===typeof e){if("string"===typeof e.$oid)return e.$oid;try{const t=e.toString();if(t&&"[object Object]"!==t)return t}catch(t){}return null}return String(e)},s=[],i=a(e&&e._id),r=a(e&&e.gridFsFileId);i&&s.push(i),r&&s.push(r);const l=Array.from(new Set(s));let o=null,d=null,c=null;console.debug("[handleDownloadProcessed] record:",e,"candidateIds:",l);for(const e of l)try{console.debug("[handleDownloadProcessed] attempting id=",e);const n=await fetch("/api/processed-documents/".concat(e,"/raw"),{credentials:"include"});if(console.debug("[handleDownloadProcessed] response for id=",e,"status=",n.status,"headers:",{xProcessedSource:n.headers.get("x-processed-source"),contentDisposition:n.headers.get("content-disposition")}),n.ok){o=n,d=e;break}if(404===n.status){c={status:n.status,body:await(async()=>{try{return await n.json()}catch(e){return null}})()};continue}let a=null;try{a=await n.json()}catch(t){}return void ot.Ay.error({message:"Download failed",description:a&&a.message?a.message:"Server returned ".concat(n.status)})}catch(n){c=n;continue}if(!o){const e=c&&c.body&&c.body.message?c.body.message:c&&c.message?c.message:"File not found";return void ot.Ay.error({message:"Download failed",description:e})}const u=await o.blob();let h=null;const m=o.headers.get("content-disposition")||o.headers.get("Content-Disposition");if(m){const e=m.match(/filename\*=UTF-8''([^;\n\r]+)/i);if(e&&e[1])h=decodeURIComponent(e[1]);else{const e=m.match(/filename="?([^";]+)"?/i);e&&e[1]&&(h=e[1])}}h||(h=o.headers.get("x-processed-transactioncode")||o.headers.get("X-Processed-TransactionCode")||e.filename||e.name||"document_".concat(d||e._id,".docx"));const p=window.URL.createObjectURL(u),x=document.createElement("a");x.href=p;const g=h||"document_".concat(d||e._id,".docx");x.download=g,document.body.appendChild(x),x.click(),x.remove(),window.URL.revokeObjectURL(p)}catch(n){console.error("Download error",n),ot.Ay.error({message:"Download error",description:String(n)})}})(t),children:"Download"})}]})}),(0,S.jsx)(_.A,{title:"Manage Inquiries",open:Y,onCancel:()=>{H(!1),K(null)},footer:null,width:900,children:(0,S.jsxs)(nt.A,{dataSource:null!==G?G:be(m),rowKey:e=>e._id,pagination:{pageSize:10},onRow:e=>({onClick:()=>{e&&e._id&&I(String(e._id)),H(!1),t("/staff/inbox",{state:{openInquiryId:e._id}})}}),children:[(0,S.jsx)(nt.A.Column,{title:"Name",dataIndex:"username",render:(e,t)=>e||t.residentName||t.subject||"Unknown"},"username"),(0,S.jsx)(nt.A.Column,{title:"Type of Inquiry",dataIndex:"type",render:e=>e?String(e):"General"},"type"),(0,S.jsx)(nt.A.Column,{title:"Status",dataIndex:"status",render:e=>fe(e)},"status"),(0,S.jsx)(nt.A.Column,{title:"Date Inquired",dataIndex:"createdAt",render:e=>ve(e)},"createdAt")]})})]}),(0,S.jsx)(_.A,{open:!!E,title:E?"".concat(Z," Document Request"):"",onCancel:()=>{U(null),$(""),Q("")},footer:E?[(0,S.jsx)(c.A.TextArea,{rows:4,value:J,onChange:e=>$(e.target.value),placeholder:"Type notes..."},"notes"),(0,S.jsx)(u.Ay,{type:"primary",disabled:!J.trim(),onClick:async()=>{if(E&&Z)try{await k.documentsAPI.updateDocumentStatus(E._id||"",{status:Z,notes:J}),U(null),$(""),Q(""),ye()}catch(e){console.error("Error updating document status:",e)}},children:"Submit"},"submit")]:null,children:E&&(0,S.jsxs)("div",{children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Type:"})," ",je(E.type||E.title),(0,S.jsx)("br",{}),(0,S.jsx)(h.A.Text,{strong:!0,children:"Description:"})," ",E.description||"",(0,S.jsx)("br",{}),(0,S.jsx)(h.A.Text,{strong:!0,children:"Requested by:"})," ",E.username||"Unknown",(0,S.jsx)("br",{}),(0,S.jsx)(h.A.Text,{strong:!0,children:"Barangay ID:"})," ",E.barangayID||"Unknown",(0,S.jsx)("br",{}),(0,S.jsx)(h.A.Text,{strong:!0,children:"Date:"})," ",ve(E.dateRequested||""),(0,S.jsx)("br",{})]})}),(0,S.jsx)(_.A,{open:!!M,title:M?"Respond to Inquiry: ".concat(M.subject):"",onCancel:()=>{W(null),$("")},footer:M?[(0,S.jsx)(c.A.TextArea,{rows:4,value:J,onChange:e=>$(e.target.value),placeholder:"Type your response...",disabled:ee},"response"),(0,S.jsx)(u.Ay,{type:"primary",loading:ee,disabled:!J.trim(),onClick:async()=>{if(M&&J)try{te(!0),await k.contactAPI.respondToInquiry(M._id,{response:J}),W(null),$(""),ye()}catch(e){console.error("Error responding to inquiry:",e)}finally{te(!1)}},children:"Send Response"},"send")]:null,children:M&&(0,S.jsxs)("div",{children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Type:"})," ",M.type,(0,S.jsx)("br",{}),(0,S.jsx)(h.A.Text,{strong:!0,children:"Message:"})," ",M.message,(0,S.jsx)("br",{}),(0,S.jsx)(h.A.Text,{strong:!0,children:"From:"})," ",M.username?"".concat(M.username," (Barangay ID: ").concat(M.barangayID||"Unknown",")"):"Unknown",(0,S.jsx)("br",{}),(0,S.jsx)(h.A.Text,{strong:!0,children:"Date:"})," ",ve(M.createdAt),(0,S.jsx)("br",{})]})}),(0,S.jsx)(_.A,{open:ne,title:"Completed Requests (".concat(xe.completedRequests||0,")"),onCancel:()=>ie(!1),footer:null,width:1100,bodyStyle:{padding:12},children:(0,S.jsx)("div",{style:{overflowX:"auto"},children:(0,S.jsx)(nt.A,{dataSource:i.filter(e=>"approved"===(e.status||"").toLowerCase()||"completed"===(e.status||"").toLowerCase()),rowKey:e=>e._id,pagination:{pageSize:10},scroll:{x:1e3},columns:[{title:"Requester",dataIndex:"username",key:"username",width:200,render:(e,t)=>{var n;return e||(null===(n=t.requesterId)||void 0===n?void 0:n.fullName)||"Unknown"}},{title:"Document",dataIndex:"type",key:"type",width:220,render:(e,t)=>je(e||t.title)},{title:"Description",dataIndex:"description",key:"description",width:300,render:e=>e||"-"},{title:"Date Requested",dataIndex:"dateRequested",key:"dateRequested",width:180,render:e=>ve(e)},{title:"Status",dataIndex:"status",key:"status",width:120,render:e=>fe(e)},{title:"Action",key:"action",width:120,render:(e,t)=>(0,S.jsx)(u.Ay,{type:"link",onClick:()=>{U(t),ie(!1),Q("")},children:"View"})}]})})})]})})};var vt=n(87674),bt=n(42104);let wt=null;function St(e,t){wt&&wt.on(e,t)}function It(e,t){wt&&wt.off(e,t)}const Ct=["#6366F1","#22C55E","#F59E42","#EF4444","#3B82F6","#FBBF24","#A21CAF","#14B8A6"],{Title:kt,Text:Nt}=h.A,Tt=()=>{const e=(0,L.Zp)(),{user:t}=V(),[n,i]=(0,s.useState)(!1),[d,c]=(0,s.useState)(!1),[h,m]=(0,s.useState)([]),[x,f]=(0,s.useState)({totalUsers:0,activeUsers:0,pendingRequests:0,totalDocuments:0,completedRequests:0,unreadMessages:0}),[A,j]=(0,s.useState)([]),[v,b]=(0,s.useState)([]),[w,I]=(0,s.useState)([]),[C,N]=(0,s.useState)([]),[T,D]=(0,s.useState)([]),[P,R]=(0,s.useState)(!1),[q,B]=(0,s.useState)(!1),[O,z]=(0,s.useState)(null),[E,U]=(0,s.useState)(null),[M,W]=(0,s.useState)(""),[Y,H]=(0,s.useState)(!1),[G,K]=(0,s.useState)([]),[J,$]=(0,s.useState)([]),Z=[3,5,4,6,7,8,10],Q=[{type:"Clearance",value:12},{type:"Certificate",value:8},{type:"Permit",value:5},{type:"Other",value:3}],ee=[{type:"Clearance",value:27},{type:"Certificate",value:18},{type:"Permit",value:12},{type:"Other",value:8}];const te=async()=>{try{var e,n,a,s,r;i(!0);const d=await k.adminAPI.getSystemStatistics();try{const e=await k.documentsAPI.getDocumentRecords();m(e)}catch(l){m([])}const c=(await k.notificationAPI.getNotifications()).filter(e=>!e.read);j(c.slice(0,10));const u=c.filter(e=>(e.type||"").toString().toLowerCase().includes("staff"));b(u);try{const e=await k.requestsAPI.getStaffAccessRequests();I(e||[])}catch(l){I([])}const h=((null===(e=d.documents)||void 0===e?void 0:e.pending)||0)+u.length,p=(null===(n=d.documents)||void 0===n?void 0:n.total)||0;let x=0;try{const e=await k.documentsAPI.getDocumentRecords();x=((Array.isArray(e)?e:e&&e.data?e.data:[])||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase()).length}catch(o){x=h}const g=x+(u?u.length:0);f({totalUsers:(null===(a=d.users)||void 0===a?void 0:a.total)||0,activeUsers:(null===(s=d.users)||void 0===s?void 0:s.active)||0,pendingRequests:g,totalDocuments:p,completedRequests:(null===(r=d.documents)||void 0===r?void 0:r.completed)||0,unreadMessages:0});const y=await k.contactAPI.getAllInquiries();K(y);const A=y.filter(e=>e.assignedRole&&t&&e.assignedRole===t.role||e.assignedTo&&Array.isArray(e.assignedTo)&&t&&e.assignedTo.includes(t._id));$(A);const v=await k.adminAPI.getActivityLogs({});N(v.map(e=>({id:e.id,type:e.module||"system",description:e.description||e.action,timestamp:e.timestamp,user:e.userName||e.userId})))}catch(d){console.error("Error fetching dashboard data:",d)}finally{i(!1)}};(0,s.useEffect)(()=>{te();try{wt||(wt=(0,bt.Ay)("/",{path:"/socket.io",transports:["websocket"],auth:e?{token:e}:void 0,autoConnect:!0}));const t=e=>{console.log("Received document socket event, refreshing dashboard",e),te()};St("documentStatusUpdate",t),St("documentCreated",t),St("documentDeleted",t),St("documents-updated",t);const n=setInterval(()=>{te()},3e4);return()=>{It("documentStatusUpdate",t),It("documentCreated",t),It("documentDeleted",t),It("documents-updated",t),clearInterval(n)}}catch(t){const e=setInterval(()=>{te()},3e4);return()=>clearInterval(e)}var e},[]);const ne=async()=>{R(!0);try{const e=await k.verificationAPI.getRequests();D(Array.isArray(e)?e:[])}catch(e){console.error("Failed to load verification requests",e),D([])}finally{R(!1)}};(0,s.useEffect)(()=>{ne()},[]);const se=async()=>{try{const e=await k.adminAPI.getUsers(),t=Array.isArray(e)||e&&"number"===typeof e.length?e.length:0;f(e=>(0,a.A)((0,a.A)({},e),{},{totalUsers:t}))}catch(e){console.error("Failed to fetch users list for count:",e)}};(0,s.useEffect)(()=>{se();const e=setInterval(se,3e4);return()=>clearInterval(e)},[]);const re=async e=>{var t;if(null!==(t=e.data)&&void 0!==t&&t.userId&&e._id)try{i(!0),await k.notificationAPI.approveStaff(e.data.userId,e._id),await te()}catch(n){console.error("Failed to approve staff:",n)}finally{i(!1)}},le=()=>(0,S.jsx)("span",{style:{display:"inline-block",width:8,height:8,borderRadius:"50%",background:"#ff4d4f",marginLeft:6,verticalAlign:"middle"},"aria-label":"Unread"}),oe=[{label:"Users",value:x.totalUsers,icon:"\ud83d\udc64",bg:"linear-gradient(90deg, #1890ff 0%, #40a9ff 100%)",color:"#1890ff",labelColor:"#e6f7ff",onClick:void 0,chart:(0,S.jsx)("div",{style:{width:"100%",marginTop:8,height:32},children:(0,S.jsx)("svg",{width:"100%",height:"40",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:(0,S.jsx)("polyline",{fill:"none",stroke:"#4F46E5",strokeWidth:"2",points:Z.map((e,t)=>"".concat(t*(100/(Z.length-1)),",").concat(40-e/Math.max(...Z)*35)).join(" ")})})})},{label:"Pending Requests",value:x.pendingRequests,icon:"\u23f3",bg:"linear-gradient(90deg, #faad14 0%, #ffe58f 100%)",color:"#faad14",labelColor:"#fffbe6",onClick:void 0,chart:(0,S.jsx)("div",{style:{width:"100%",marginTop:8,height:32},children:(0,S.jsx)("svg",{width:"100%",height:"40",viewBox:"0 0 100 40",preserveAspectRatio:"none",children:Q.map((e,t)=>{const n=100/Q.length-2,a=e.value/Math.max(...Q.map(e=>e.value))*35;return(0,S.jsx)("rect",{x:t*(100/Q.length)+1,y:40-a,width:n,height:a,fill:"#22C55E",rx:"2"},t)})})})},{label:"Documents",value:x.totalDocuments,icon:"\ud83d\udcc4",bg:"linear-gradient(90deg, #52c41a 0%, #b7eb8f 100%)",color:"#52c41a",labelColor:"#f6ffed",onClick:void 0,chart:(0,S.jsx)("div",{style:{width:"100%",marginTop:8,height:32,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,S.jsx)("svg",{width:"40",height:"40",viewBox:"0 0 40 40",children:(()=>{const e=ee.reduce((e,t)=>e+t.value,0);let t=0;return ee.map((n,a)=>{const s=n.value/e*360,i=t+s,r=s>180?1:0,l=20+18*Math.cos(Math.PI*(t-90)/180),o=20+18*Math.sin(Math.PI*(t-90)/180),d=20+18*Math.cos(Math.PI*(i-90)/180),c=20+18*Math.sin(Math.PI*(i-90)/180),u="M20,20 L".concat(l,",").concat(o," A18,18 0 ").concat(r," 1 ").concat(d,",").concat(c," Z");return t+=s,(0,S.jsx)("path",{d:u,fill:Ct[a%Ct.length]},a)})})()})})},{label:(0,S.jsxs)("span",{children:["Messages ",(0,S.jsx)(le,{})]}),value:x.unreadMessages,icon:"\u2709\ufe0f",bg:"linear-gradient(90deg, #722ed1 0%, #b37feb 100%)",color:"#722ed1",labelColor:"#f9f0ff",onClick:()=>e("/admin/messages"),chart:null}],de=["Total Users","Pending Requests","Total Documents","Unread Messages"],[ce,ue]=(0,s.useState)([]),[he,pe]=(0,s.useState)(!1),[xe,ge]=(0,s.useState)(null),[fe,ye]=(0,s.useState)(!1);(0,s.useEffect)(()=>{(async()=>{pe(!0);try{const e=await k.contactAPI.getAnnouncements();ue(Array.isArray(e)?e.slice(0,6):[])}catch(e){console.error("Failed to load mini announcements",e),ue([])}finally{pe(!1)}})()},[]);const Ae=e=>{if(!e)return"";const t=new Date(e),n=Math.floor((Date.now()-t.getTime())/1e3);return n<60?"".concat(n,"s ago"):n<3600?"".concat(Math.floor(n/60),"m ago"):n<86400?"".concat(Math.floor(n/3600),"h ago"):n<604800?"".concat(Math.floor(n/86400),"d ago"):t.toLocaleDateString()};return(0,S.jsx)(p.A,{spinning:n,children:(0,S.jsxs)("div",{style:{padding:24,backgroundColor:"#f0f2f5",minHeight:"100vh"},children:[(0,S.jsx)(kt,{level:4,style:{marginBottom:24},children:"Admin Dashboard"}),(0,S.jsx)(l.A,{gutter:[24,24],style:{marginBottom:32},children:oe.map((e,t)=>(0,S.jsx)(o.A,{xs:24,sm:12,md:6,children:(0,S.jsxs)(r.A,{hoverable:!0,onClick:e.onClick,style:{background:e.bg,color:"#fff",borderRadius:20,minHeight:170,boxShadow:"0 2px 8px 0 rgba(0,0,0,0.08)",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",cursor:e.onClick?"pointer":"default",transition:"box-shadow 0.2s, transform 0.2s",position:"relative",marginBottom:8,padding:24},styles:{body:{width:"100%",padding:0,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"transparent"}},onMouseEnter:e=>{e.currentTarget.style.boxShadow="0 8px 32px 0 rgba(0,0,0,0.18)",e.currentTarget.style.transform="translateY(-4px)"},onMouseLeave:e=>{e.currentTarget.style.boxShadow="0 2px 8px 0 rgba(0,0,0,0.08)",e.currentTarget.style.transform="none"},children:[(0,S.jsx)("span",{style:{fontSize:40,marginBottom:8,opacity:.92},children:e.icon}),(0,S.jsx)("span",{style:{fontSize:38,fontWeight:700,lineHeight:1},children:e.value}),(0,S.jsx)("span",{style:{fontSize:15,color:e.labelColor,fontWeight:500,marginTop:2,letterSpacing:.5},children:e.label}),(0,S.jsx)("span",{style:{fontSize:13,color:"rgba(255,255,255,0.7)",marginTop:2,fontWeight:400},children:de[t]}),e.chart]})},"string"===typeof e.label?e.label:String(t)))}),(0,S.jsxs)(l.A,{gutter:[24,24],style:{marginTop:0},children:[(0,S.jsx)(o.A,{xs:24,lg:12,children:(0,S.jsxs)(r.A,{title:(0,S.jsxs)(X.A,{children:[(0,S.jsx)(vt.A,{})," Staff Access Approval"]}),style:{marginTop:0,background:"#fafbfc",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0",position:"relative"},styles:{body:{padding:16}},size:"small",hoverable:!1,children:[w&&w.length>0?(0,S.jsx)(nt.A,{size:"small",pagination:{pageSize:5},dataSource:w,rowKey:e=>e._id||String(e.createdAt),columns:[{title:"Name",dataIndex:"requestedBy",key:"requestedBy",render:(e,t)=>{var n;const a=null===t||void 0===t||null===(n=t.data)||void 0===n?void 0:n.fullName,s=null===t||void 0===t?void 0:t.requestedByName;let i=null;null!==t&&void 0!==t&&t.requestedBy&&("string"===typeof t.requestedBy?i=t.requestedBy:"object"===typeof t.requestedBy&&(i=t.requestedBy.fullName||t.requestedBy.username||t.requestedBy._id));const r=a||s||i||"Unknown";return(0,S.jsx)("span",{style:{fontWeight:600},children:r})}},{title:"Requested At",dataIndex:"createdAt",key:"createdAt",render:e=>(0,S.jsx)("span",{style:{fontSize:12,color:"#888"},children:new Date(e).toLocaleString()})},{title:"Actions",key:"actions",render:(e,t)=>(0,S.jsxs)(X.A,{children:[(0,S.jsx)(u.Ay,{type:"primary",size:"small",onClick:async()=>{try{i(!0),t&&"staff_access"===t.type&&t._id?await k.requestsAPI.approveRequest(t._id):await re(t),await te()}catch(e){console.error("Approve action failed",e)}finally{i(!1)}},icon:(0,S.jsx)(F.A,{}),children:"Approve"}),(0,S.jsx)(u.Ay,{danger:!0,size:"small",onClick:()=>(async e=>{if(!e._id)return;const t=window.prompt("Enter a brief reason for rejection (optional):");try{i(!0),await k.notificationAPI.rejectStaff(e._id,t||void 0),await te()}catch(n){console.error("Failed to reject staff request:",n)}finally{i(!1)}})(t),icon:(0,S.jsx)(At.A,{}),children:"Reject"})]})}]}):0===A.length?(0,S.jsx)(ct.A,{image:(0,S.jsx)(vt.A,{style:{fontSize:48,color:"#d9d9d9"}}),description:(0,S.jsx)("span",{style:{color:"#888"},children:"No notifications"})}):(0,S.jsx)(g.A,{dataSource:A,renderItem:e=>(0,S.jsx)(g.A.Item,{actions:[(e.type||"").toString().toLowerCase().includes("staff")&&!e.read&&(0,S.jsx)(u.Ay,{type:"primary",size:"small",icon:(0,S.jsx)(F.A,{}),onClick:()=>re(e),children:"Approve"})].filter(Boolean),children:(0,S.jsx)(g.A.Item.Meta,{avatar:(0,S.jsx)(y.A,{icon:(e.type||"").toString().toLowerCase().includes("staff")?(0,S.jsx)(ie.A,{}):(0,S.jsx)(vt.A,{}),style:{backgroundColor:e.read?"#8c8c8c":(e.type||"").toString().toLowerCase().includes("staff")?"#faad14":"#1890ff"}}),title:(0,S.jsx)(Nt,{strong:(e.type||"").toString().toLowerCase().includes("staff"),children:e.message}),description:(0,S.jsxs)("div",{children:[(0,S.jsx)(Nt,{type:"secondary",children:new Date(e.createdAt).toLocaleString()}),(e.type||"").toString().toLowerCase().includes("staff")&&e.data&&(0,S.jsxs)("div",{style:{marginTop:8},children:[(0,S.jsx)(Nt,{strong:!0,children:"Full Name:"})," ",e.data.fullName||"N/A",(0,S.jsx)("br",{}),(0,S.jsx)(Nt,{strong:!0,children:"Email:"})," ",e.data.email||"N/A",(0,S.jsx)("br",{}),(0,S.jsx)(Nt,{strong:!0,children:"Username:"})," ",e.data.username||"N/A"]})]})})}),size:"small"}),(0,S.jsx)(u.Ay,{type:"link",style:{position:"absolute",right:16,bottom:8,fontSize:13,color:"#1890ff"},onClick:()=>e("/admin/notifications"),children:"View all"})]})}),(0,S.jsx)(o.A,{xs:24,lg:12,children:(0,S.jsxs)(r.A,{title:(0,S.jsxs)(X.A,{children:[(0,S.jsx)(ae.A,{})," Announcements"]}),style:{marginTop:0,background:"#fafbfc",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0",position:"relative"},styles:{body:{padding:12}},size:"small",hoverable:!1,children:[0===ce.length?(0,S.jsx)(ct.A,{image:(0,S.jsx)(ae.A,{style:{fontSize:42,color:"#d9d9d9"}}),description:(0,S.jsx)("span",{style:{color:"#888"},children:"No announcements"})}):(0,S.jsx)("div",{style:{maxHeight:320,overflowY:"auto",paddingRight:6,paddingBottom:48},children:(0,S.jsx)(g.A,{loading:he,dataSource:ce,renderItem:e=>(0,S.jsxs)(g.A.Item,{style:{cursor:"pointer",padding:"10px 8px",alignItems:"center"},onClick:()=>{ge(e),ye(!0)},children:[(0,S.jsx)(g.A.Item.Meta,{title:(0,S.jsx)("div",{style:{display:"flex",alignItems:"flex-start",gap:8},children:(0,S.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,S.jsx)("div",{style:{fontWeight:600,fontSize:13,display:"-webkit-box",WebkitLineClamp:3,WebkitBoxOrient:"vertical",overflow:"hidden",textOverflow:"ellipsis",lineHeight:"1.2em"},children:e.text||"Untitled"}),(0,S.jsx)("div",{style:{fontSize:12,color:"#888",marginTop:6},children:Ae(e.createdAt)})]})}),description:null}),e.imagePath&&(0,S.jsx)("div",{style:{marginLeft:12,width:92,display:"flex",justifyContent:"flex-end",flexShrink:0},children:(0,S.jsx)("img",{loading:"lazy",className:"rounded-img",src:(0,k.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image")),alt:"ann",style:{width:92,height:60,objectFit:"cover",borderRadius:6,background:"#f0f0f0"}})})]}),size:"small"})}),(0,S.jsx)("div",{style:{marginTop:8,display:"flex",justifyContent:"flex-end"},children:(0,S.jsx)(u.Ay,{type:"link",style:{fontSize:13,color:"#1890ff"},onClick:()=>e("/admin/announcements"),children:"Manage"})}),(0,S.jsx)(ut.A,{open:fe,onClose:()=>{ye(!1),ge(null)},title:"Announcement",width:720,placement:"right",children:xe&&(0,S.jsxs)("div",{children:[(0,S.jsx)(Nt,{style:{display:"block",marginBottom:12,whiteSpace:"pre-wrap"},children:xe.text}),xe.imagePath&&(0,S.jsx)("img",{loading:"lazy",className:"rounded-img rounded-img-lg",src:(0,k.getAbsoluteApiUrl)("/announcements/".concat(xe._id,"/image")),alt:"announcement",style:{width:"100%",height:"auto",borderRadius:8,background:"#f6f6f6"}}),(0,S.jsx)("div",{style:{marginTop:8,color:"#888"},children:Ae(xe.createdAt)})]})})]})})]}),(0,S.jsx)(l.A,{gutter:[24,24],style:{marginTop:24},children:(0,S.jsx)(o.A,{xs:24,children:(0,S.jsxs)(r.A,{title:(0,S.jsxs)(X.A,{children:[(0,S.jsx)(me.A,{})," Verification Requests"]}),style:{marginTop:0,background:"#fff",borderRadius:12,boxShadow:"0 2px 8px #d9d9d933",border:"1px solid #f0f0f0"},size:"small",hoverable:!1,children:[P?(0,S.jsx)("div",{style:{textAlign:"center",padding:24},children:(0,S.jsx)(p.A,{})}):T&&0!==T.length?(0,S.jsx)(g.A,{dataSource:T.slice(0,6),renderItem:e=>(0,S.jsx)(g.A.Item,{actions:[(0,S.jsx)(u.Ay,{size:"small",onClick:()=>(z(e),void B(!0)),children:"Check ID"},"view"),(0,S.jsx)(u.Ay,{type:"primary",size:"small",onClick:()=>{var t;return(async e=>{try{if(R(!0),e&&"object"===typeof e){var t;const a=e._id,s=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;try{await k.verificationAPI.approveRequest(a)}catch(n){}s&&await k.verificationAPI.verifyUser(s,!0)}else"string"===typeof e&&await k.verificationAPI.verifyUser(e,!0);await ne()}catch(a){console.error("Failed to verify user",a)}finally{R(!1)}})((null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId)},children:"Verify"},"verify"),(0,S.jsx)(u.Ay,{danger:!0,size:"small",onClick:()=>{var t;return(async e=>{try{if(R(!0),e&&"object"===typeof e){var t;const a=e._id,s=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;try{await k.verificationAPI.rejectRequest(a)}catch(n){}s&&await k.verificationAPI.verifyUser(s,!1)}else"string"===typeof e&&await k.verificationAPI.verifyUser(e,!1);await ne()}catch(a){console.error("Failed to reject verification",a)}finally{R(!1)}})((null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId)},children:"Reject"},"reject")],children:(0,S.jsx)(g.A.Item.Meta,{title:(0,S.jsx)("span",{style:{fontWeight:600},children:e.userId&&(e.userId.fullName||e.userId.username)||"Unknown Resident"}),description:(0,S.jsxs)("span",{style:{color:"#888"},children:[e.status||"pending"," \xb7 ",new Date(e.createdAt).toLocaleString()]})})}),size:"small"}):(0,S.jsx)(ct.A,{description:"No verification requests"}),(0,S.jsx)(u.Ay,{type:"link",style:{marginTop:12},onClick:()=>e("/admin/verification-requests"),children:"View all"}),(0,S.jsx)(_.A,{title:"Verification Files",open:q,onCancel:()=>B(!1),footer:null,width:720,children:O?(0,S.jsxs)("div",{children:[(0,S.jsxs)("p",{children:[(0,S.jsx)("strong",{children:"Resident:"})," ",O.userId&&(O.userId.fullName||O.userId.username)||"Unknown"]}),(0,S.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:(O.gridFileIds||[]).map(e=>(0,S.jsxs)("div",{style:{border:"1px solid #f0f0f0",padding:8,borderRadius:6},children:[(0,S.jsx)("div",{style:{marginBottom:8},children:(0,S.jsx)("a",{href:(0,k.getAbsoluteApiUrl)("/verification/file/".concat(e)),target:"_blank",rel:"noreferrer",children:"Open file in new tab"})}),(0,S.jsx)("div",{children:(0,S.jsx)("img",{src:(0,k.getAbsoluteApiUrl)("/verification/file/".concat(e)),alt:"id",style:{maxWidth:"100%",maxHeight:400},onError:()=>{}})})]},e))})]}):(0,S.jsx)(ct.A,{description:"No files"})})]})})})]})})};var Dt=n(60647),Pt=n(18125),Rt=n(59772),qt=n(33359),Bt=n(94763),Lt=n(91522),Ot=n(26086),_t=n(60446),zt=n.n(_t);const Ft=[{text:"Admin",value:"admin"},{text:"Staff",value:"staff"},{text:"Resident",value:"resident"}],Et=[{text:"Active",value:!0},{text:"Inactive",value:!1}],Ut=()=>{const[e,t]=(0,s.useState)([]),[n,m]=(0,s.useState)(""),[x,g]=(0,s.useState)(void 0),[A,j]=(0,s.useState)(void 0),[v,b]=(0,s.useState)(null),[w,I]=(0,s.useState)(1),[C,N]=(0,s.useState)(10),[P,q]=(0,s.useState)([]),[B,L]=(0,s.useState)(!1),[z,E]=(0,s.useState)(null),[U,M]=(0,s.useState)(null),[W,Y]=(0,s.useState)(!1),[H,G]=(0,s.useState)(!1),[V,K]=(0,s.useState)(!1),[J,$]=(0,s.useState)(!1),[Z,te]=(0,s.useState)({}),[ne,ae]=(0,s.useState)(!1),[se,ie]=(0,s.useState)(0),[re,le]=(0,s.useState)(null),oe=s.useRef(null),[de,ce]=(0,s.useState)(!0),[ue,he]=(0,s.useState)({});const me=()=>{ce(!0),k.adminAPI.getUsers().then(e=>{t(e.map((e,t)=>({key:e._id||t,_id:e._id||null,fullName:e.fullName||e.username||"",email:e.email,role:e.role,isActive:e.isActive,createdAt:e.createdAt,lastLogin:e.lastLogin,avatar:e.avatar||null,barangayId:e.barangayId||e.barangayID||e.barangay_id||null})))}).catch(()=>t([])).finally(()=>ce(!1))};(0,s.useEffect)(()=>{me()},[]);const pe=async(e,t)=>{if(e)try{i.Ay.loading({content:"Disabling user...",key:"disable"});const n=t?{suspendedUntil:t}:{},a=await k.adminAPI.disableUser(e,n);i.Ay.success({content:"User disabled",key:"disable",duration:2}),await me(),z&&z._id===e&&E(a.user||a)}catch(n){console.error("Failed to disable user",n),i.Ay.error("Failed to disable user")}},ge=async e=>{if(e)try{i.Ay.loading({content:"Enabling user...",key:"enable"});const t=await k.adminAPI.enableUser(e);i.Ay.success({content:"User enabled",key:"enable",duration:2}),await me(),z&&z._id===e&&E(t.user||t)}catch(t){console.error("Failed to enable user",t),i.Ay.error("Failed to enable user")}},fe=async e=>{if(e)try{i.Ay.loading({content:"Demoting user...",key:"demote"});const t=await k.adminAPI.demoteUser(e);i.Ay.success({content:"User demoted to resident",key:"demote",duration:2}),await me(),z&&z._id===e&&E(t.user||t)}catch(t){console.error("Failed to demote user",t),i.Ay.error("Failed to demote user")}},ye=e.filter(e=>{const t=e.fullName.toLowerCase().includes(n.toLowerCase())||e.email.toLowerCase().includes(n.toLowerCase()),a=!x||e.role===x,s=void 0===A||e.isActive===A,i=!v||2!==v.length||zt()(e.createdAt).isAfter(v[0],"day")&&zt()(e.createdAt).isBefore(v[1],"day");return t&&a&&s&&i}),Ae=[{title:"Name",dataIndex:"fullName",key:"fullName",render:(e,t)=>(0,S.jsxs)(X.A,{children:[(0,S.jsx)(y.A,{style:{backgroundColor:"#1890ff",verticalAlign:"middle"},children:t.avatar?(0,S.jsx)(xe,{src:t.avatar,size:36}):((n,a)=>{let s=t;try{const e=localStorage.getItem("userProfile");e&&(s=JSON.parse(e))}catch(i){}return null!==(n=s)&&void 0!==n&&n.profileImage||null!==(a=s)&&void 0!==a&&a.profileImageId?(0,S.jsx)(xe,{user:s,size:36}):e&&e.length>0?e.charAt(0).toUpperCase():"?"})()}),(0,S.jsx)("b",{children:e})]}),sorter:(e,t)=>e.fullName.localeCompare(t.fullName),sortDirections:["ascend","descend"],fixed:"left"},{title:"Barangay ID",dataIndex:"barangayId",key:"barangayId",render:e=>e||"\u2014",width:160},{title:"Email",dataIndex:"email",key:"email",sorter:(e,t)=>e.email.localeCompare(t.email),sortDirections:["ascend","descend"]},{title:"Role",dataIndex:"role",key:"role",render:e=>{const t=e||"";return(0,S.jsx)(f.A,{color:"admin"===t?"magenta":"staff"===t?"blue":"green",children:t?t.charAt(0).toUpperCase()+t.slice(1):""})},filters:Ft,onFilter:(e,t)=>t.role===e},{title:"Status",dataIndex:"isActive",key:"isActive",render:e=>(0,S.jsx)(f.A,{color:e?"green":"red",children:e?"Active":"Inactive"}),filters:Et,onFilter:(e,t)=>t.isActive===e},{title:"Created",dataIndex:"createdAt",key:"createdAt",render:e=>zt()(e).format("YYYY-MM-DD"),sorter:(e,t)=>new Date(e.createdAt).getTime()-new Date(t.createdAt).getTime(),sortDirections:["ascend","descend"]},{title:"Actions",key:"actions",fixed:"right",render:(e,t)=>(0,S.jsx)(ee.A,{popupRender:()=>(0,S.jsxs)(Q.A,{children:[(0,S.jsx)(Q.A.Item,{icon:(0,S.jsx)(qt.A,{}),onClick:()=>{E(t),L(!0)},children:"Edit"},"edit"),(0,S.jsx)(Q.A.Item,{icon:(0,S.jsx)(D.A,{}),onClick:()=>{},children:"View Logs"},"logs"),(0,S.jsx)(Q.A.Item,{icon:(0,S.jsx)(Bt.A,{}),onClick:()=>{},children:"Deactivate"},"deactivate"),(0,S.jsx)(Q.A.Item,{icon:(0,S.jsx)(Bt.A,{}),onClick:async()=>{t&&t._id?_.A.confirm({title:"Disable user",content:"Are you sure you want to disable ".concat(t.fullName||t.email||t._id,"?"),onOk:async()=>{await pe(t._id)}}):i.Ay.error("No user selected")},children:"Disable"},"disable_now"),"staff"===t.role&&(0,S.jsx)(Q.A.Item,{icon:(0,S.jsx)(Lt.A,{}),onClick:async()=>{t&&t._id?_.A.confirm({title:"Demote user",content:"Are you sure you want to demote ".concat(t.fullName||t.email||t._id," to resident?"),onOk:async()=>{await fe(t._id)}}):i.Ay.error("No user selected")},children:"Demote to Resident"},"demote"),(0,S.jsx)(Q.A.Item,{icon:(0,S.jsx)(F.A,{}),onClick:async()=>{t&&t._id?_.A.confirm({title:"Enable user",content:"Are you sure you want to enable ".concat(t.fullName||t.email||t._id,"?"),onOk:async()=>{await ge(t._id)}}):i.Ay.error("No user selected")},children:"Enable"},"enable_now"),(0,S.jsx)(Q.A.Item,{icon:(0,S.jsx)(R.A,{}),danger:!0,onClick:()=>{},children:"Delete"},"delete")]}),trigger:["click"],children:(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(Ot.A,{}),size:"small"})})}],je=P.length>0&&(0,S.jsxs)(X.A,{style:{marginBottom:16},children:[(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(F.A,{}),onClick:()=>{},children:"Activate"}),(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(Bt.A,{}),onClick:()=>{},children:"Deactivate"}),(0,S.jsx)(Dt.A,{title:"Are you sure to delete selected users?",onConfirm:()=>{},okText:"Yes",cancelText:"No",children:(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(R.A,{}),danger:!0,children:"Delete"})}),(0,S.jsx)("span",{style:{marginLeft:8},children:"Selected ".concat(P.length," users")})]}),ve=(w-1)*C+1,be=Math.min(w*C,ye.length);return(0,S.jsxs)("div",{children:[(0,S.jsx)(r.A,{style:{marginBottom:16,borderRadius:8,background:"#fff"},bodyStyle:{padding:0},bordered:!1,title:(0,S.jsxs)(l.A,{align:"middle",justify:"space-between",children:[(0,S.jsxs)(o.A,{children:[(0,S.jsx)(h.A.Title,{level:4,style:{margin:0},children:"User Management"}),(0,S.jsxs)(Pt.A,{children:[(0,S.jsx)(Pt.A.Item,{children:"Admin"}),(0,S.jsx)(Pt.A.Item,{children:"User Management"})]})]}),(0,S.jsx)(o.A,{children:(0,S.jsx)(X.A,{})})]})}),(0,S.jsxs)(r.A,{style:{borderRadius:16,boxShadow:"0 2px 16px #40c9ff11"},children:[(0,S.jsxs)(l.A,{gutter:16,style:{marginBottom:16},align:"middle",children:[(0,S.jsx)(o.A,{children:(0,S.jsx)(c.A.Search,{placeholder:"Search by name or email",value:n,onChange:e=>m(e.target.value),allowClear:!0,style:{width:200}})}),(0,S.jsx)(o.A,{children:(0,S.jsx)(d.A,{placeholder:"Role",allowClear:!0,style:{width:120},value:x,onChange:g,options:Ft})}),(0,S.jsx)(o.A,{children:(0,S.jsx)(d.A,{placeholder:"Status",allowClear:!0,style:{width:120},value:A,onChange:j,options:Et})}),(0,S.jsx)(o.A,{children:(0,S.jsx)(Rt.A.RangePicker,{value:v,onChange:b,style:{width:220},allowClear:!0})}),(0,S.jsx)(o.A,{children:(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(Lt.A,{}),onClick:()=>{m(""),g(void 0),j(void 0),b(null)},children:"Reset Filters"})})]}),je,de?(0,S.jsx)(p.A,{size:"large"}):(0,S.jsx)(nt.A,{columns:Ae,dataSource:ye,rowSelection:{selectedRowKeys:P,onChange:q},pagination:{pageSize:C,current:w,onChange:I,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"],onShowSizeChange:(e,t)=>N(t),showTotal:e=>"Showing ".concat(ve,"\u2013").concat(be," of ").concat(e," users")},onRow:e=>({onClick:()=>{E(e),L(!0),(async e=>{if(e){Y(!0);try{const t=e.barangayId||e.barangayID||e.barangay_id;if(t){const e=await k.adminAPI.getResidentByBarangayID(t);M((null===e||void 0===e?void 0:e.resident)||null)}else if(e._id){const t=await k.adminAPI.getUserWithResident(e._id);M((null===t||void 0===t?void 0:t.resident)||null)}else M(null)}catch(t){console.error("Failed to fetch resident for user",t),M(null)}finally{Y(!1)}}})(e)}}),style:{cursor:"pointer"},scroll:{x:"max-content"},sticky:!0})]}),(0,S.jsx)(ut.A,{title:z?z.fullName:"User Profile",open:B,onClose:()=>L(!1),width:400,children:z&&(0,S.jsxs)(X.A,{direction:"vertical",size:"middle",style:{width:"100%"},children:[(0,S.jsxs)(l.A,{align:"middle",gutter:16,children:[(0,S.jsx)(o.A,{children:(0,S.jsx)(y.A,{size:64,style:{backgroundColor:"#1890ff"},children:U&&(U.profileImage||U.profileImageId)?U.profileImage?(0,S.jsx)(xe,{src:U.profileImage,size:64}):(0,S.jsx)(xe,{src:"/api/resident/personal-info/avatar/".concat(U.profileImageId),size:64}):z.avatar?(0,S.jsx)(xe,{src:z.avatar,size:64}):((e,t)=>{let n=z;try{const e=localStorage.getItem("userProfile");e&&(n=JSON.parse(e))}catch(a){}return null!==(e=n)&&void 0!==e&&e.profileImage||null!==(t=n)&&void 0!==t&&t.profileImageId?(0,S.jsx)(xe,{user:n,size:64}):z.fullName&&z.fullName.length>0?z.fullName.charAt(0).toUpperCase():"?"})()})}),(0,S.jsxs)(o.A,{children:[(0,S.jsx)(h.A.Title,{level:5,style:{margin:0},children:z.fullName}),(0,S.jsxs)("div",{style:{marginTop:4},children:[(0,S.jsx)(f.A,{color:z.isActive?"green":"red",style:{marginRight:8},children:z.isActive?"Active":"Inactive"}),(0,S.jsx)(f.A,{color:"admin"===z.role?"magenta":"staff"===z.role?"blue":"green",children:z.role?z.role.charAt(0).toUpperCase()+z.role.slice(1):""})]}),z.barangayId&&(0,S.jsxs)("div",{style:{marginTop:8},children:[(0,S.jsx)(h.A.Text,{type:"secondary",children:"Barangay ID: "}),(0,S.jsx)(h.A.Text,{copyable:!0,children:z.barangayId})]})]})]}),(0,S.jsx)(h.A.Text,{strong:!0,children:"Email:"}),(0,S.jsx)(h.A.Text,{children:z.email}),(0,S.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Resident Information"}),W?(0,S.jsx)(p.A,{}):U?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(h.A.Title,{level:5,children:"Personal Information"}),(0,S.jsxs)(l.A,{gutter:[8,8],children:[(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Full Name:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:"".concat(U.firstName||""," ").concat(U.middleName||""," ").concat(U.lastName||"").trim()||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Barangay ID:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.barangayID||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Username:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.username||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Email:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.email||z.email||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Phone:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.contactNumber||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Landline:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.landlineNumber||"N/A"})]}),(0,S.jsxs)(o.A,{span:24,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Address:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.address||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"DOB:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.birthDate?zt()(U.birthDate).format("YYYY-MM-DD"):U.birthDate||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Sex/Gender:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.sex||U.gender||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Civil/Marital Status:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.civilStatus||U.maritalStatus||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Nationality:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.nationality||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Occupation:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.occupation||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Education:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.educationalAttainment||"N/A"})]})]}),(0,S.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Identification"}),(0,S.jsxs)(l.A,{gutter:[8,8],children:[(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Passport #:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.passportNumber||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Gov ID #:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.governmentIdNumber||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"TIN:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.tin||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Barangay Clearance #:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.barangayClearanceNumber||"N/A"})]})]}),(0,S.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Family"}),(0,S.jsxs)(l.A,{gutter:[8,8],children:[(0,S.jsxs)(o.A,{span:24,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Spouse:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.spouseName?"".concat(U.spouseName," ").concat(U.spouseLastName||""):"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Number of Children:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.numberOfChildren||0===U.numberOfChildren?U.numberOfChildren:"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Children Names/Ages:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.childrenNames?"".concat(U.childrenNames," (").concat(U.childrenAges||"",")"):"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Mother:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.motherName||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Father:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.fatherName||"N/A"})]})]}),(0,S.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Emergency Contact"}),(0,S.jsxs)(l.A,{gutter:[8,8],children:[(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Contact Name:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.emergencyContactName||U.emergencyContact||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Relationship:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.emergencyContactRelationship||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Emergency Phone:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.emergencyContact||U.spouseContactNumber||"N/A"})]})]}),(0,S.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Business / Employment"}),(0,S.jsxs)(l.A,{gutter:[8,8],children:[(0,S.jsxs)(o.A,{span:24,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Business Name:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.businessName||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Business Type:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.businessType||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Business Contact:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.businessContactNumber||"N/A"})]}),(0,S.jsxs)(o.A,{span:24,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Business Address:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.businessAddress||"N/A"})]})]}),(0,S.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Other"}),(0,S.jsxs)(l.A,{gutter:[8,8],children:[(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Blood Type:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.bloodType||"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Disability Status:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.disabilityStatus||"N/A"})]})]}),(0,S.jsxs)(l.A,{style:{marginTop:12},gutter:[8,8],children:[(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Created At:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.createdAt?zt()(U.createdAt).format("YYYY-MM-DD HH:mm"):"N/A"})]}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Last Login:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:z.lastLogin?zt()(z.lastLogin).format("YYYY-MM-DD HH:mm"):"N/A"})]})]}),(0,S.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Social Media / Links"}),(0,S.jsxs)(l.A,{gutter:[8,8],children:[(0,S.jsxs)(o.A,{span:24,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Facebook:"}),U.facebook?(0,S.jsx)(h.A.Text,{style:{display:"block"},children:(0,S.jsx)("a",{href:U.facebook,target:"_blank",rel:"noreferrer",children:U.facebook})}):(0,S.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,S.jsxs)(o.A,{span:24,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Instagram:"}),U.instagram?(0,S.jsx)(h.A.Text,{style:{display:"block"},children:(0,S.jsx)("a",{href:U.instagram,target:"_blank",rel:"noreferrer",children:U.instagram})}):(0,S.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,S.jsxs)(o.A,{span:24,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Other Link:"}),(0,S.jsx)(h.A.Text,{style:{display:"block"},children:U.website||"N/A"})]})]})]}):(0,S.jsx)(h.A.Text,{type:"warning",children:"This resident doesn't have resident info yet."}),(0,S.jsx)(h.A.Title,{level:5,style:{marginTop:12},children:"Social Media"}),(0,S.jsxs)(l.A,{gutter:[8,8],children:[(0,S.jsxs)(o.A,{span:24,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Facebook:"}),z.facebook?(0,S.jsx)(h.A.Text,{style:{display:"block"},children:(0,S.jsx)("a",{href:z.facebook,target:"_blank",rel:"noreferrer",children:z.facebook})}):(0,S.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,S.jsxs)(o.A,{span:24,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Twitter:"}),z.twitter?(0,S.jsx)(h.A.Text,{style:{display:"block"},children:(0,S.jsx)("a",{href:z.twitter,target:"_blank",rel:"noreferrer",children:z.twitter})}):(0,S.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]}),(0,S.jsxs)(o.A,{span:24,children:[(0,S.jsx)(h.A.Text,{strong:!0,children:"Instagram:"}),z.instagram?(0,S.jsx)(h.A.Text,{style:{display:"block"},children:(0,S.jsx)("a",{href:z.instagram,target:"_blank",rel:"noreferrer",children:z.instagram})}):(0,S.jsx)(h.A.Text,{style:{display:"block"},children:"N/A"})]})]}),(0,S.jsxs)("div",{style:{marginTop:16,display:"flex",flexDirection:"column",gap:8},children:[(0,S.jsxs)(X.A,{children:[(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(qt.A,{}),onClick:()=>{te(z||{}),$(!0)},children:"Edit User"}),(0,S.jsx)(u.Ay,{onClick:()=>{U?(he(U||{}),K(!0)):i.Ay.warning("No resident data to edit")},children:"Edit Resident"})]}),(0,S.jsxs)(X.A,{children:[(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(D.A,{}),onClick:()=>{},children:"View Logs"}),z&&"staff"===z.role&&(0,S.jsx)(Dt.A,{title:"Demote ".concat(z.fullName||z.email,"?"),onConfirm:async()=>{z&&await fe(z._id)},okText:"Yes",cancelText:"No",children:(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(Lt.A,{}),children:"Demote"})}),z&&z.isActive?(0,S.jsx)(Dt.A,{title:"Disable ".concat(z.fullName||z.email,"?"),onConfirm:async()=>{await pe(z._id)},okText:"Yes",cancelText:"No",children:(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(Bt.A,{}),danger:!0,children:"Deactivate"})}):(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(F.A,{}),onClick:async()=>{z&&await ge(z._id)},children:"Enable"})]})]})]})}),(0,S.jsx)(_.A,{title:"Edit Resident",open:V,onCancel:()=>K(!1),onOk:async()=>{if(U)try{const e=(0,a.A)((0,a.A)({},U),ue),t=await k.adminAPI.updateResident(U._id,e);i.Ay.success("Resident updated"),M((null===t||void 0===t?void 0:t.resident)||(0,a.A)((0,a.A)({},U),e)),K(!1)}catch(e){console.error("Failed to save resident",e),i.Ay.error("Failed to update resident.")}},width:900,children:(0,S.jsx)(Ce.A,{layout:"vertical",initialValues:(0,a.A)((0,a.A)({},U||{}),{},{barangayID:(null===U||void 0===U?void 0:U.barangayID)||(null===z||void 0===z?void 0:z.barangayId)}),onValuesChange:(e,t)=>he(t),children:(0,S.jsxs)(O.A,{defaultActiveKey:"personal",children:[(0,S.jsxs)(O.A.TabPane,{tab:"Personal",children:[(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"firstName",label:"First Name",rules:[{required:!0,message:"First name is required"}],children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"middleName",label:"Middle Name",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"lastName",label:"Last Name",rules:[{required:!0,message:"Last name is required"}],children:(0,S.jsx)(c.A,{})})})]}),(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"username",label:"Username",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"barangayID",label:"Barangay ID",rules:[{required:!0,message:"Barangay ID is required"}],children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Enter a valid email"}],children:(0,S.jsx)(c.A,{})})})]}),(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"contactNumber",label:"Contact Number",rules:[{pattern:/^[0-9+\-() ]{6,20}$/,message:"Enter a valid phone number"}],children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"landlineNumber",label:"Landline",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"address",label:"Address",children:(0,S.jsx)(c.A,{})})})]}),(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"birthDate",label:"Birth Date",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"placeOfBirth",label:"Place of Birth",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"age",label:"Age",children:(0,S.jsx)(c.A,{type:"number"})})})]})]},"personal"),(0,S.jsxs)(O.A.TabPane,{tab:"IDs",children:[(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"passportNumber",label:"Passport #",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"governmentIdNumber",label:"Government ID #",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"tin",label:"TIN",children:(0,S.jsx)(c.A,{})})})]}),(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"bloodType",label:"Blood Type",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"disabilityStatus",label:"Disability Status",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"educationalAttainment",label:"Education",children:(0,S.jsx)(c.A,{})})})]})]},"ids"),(0,S.jsxs)(O.A.TabPane,{tab:"Family",children:[(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"spouseName",label:"Spouse Name",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"spouseMiddleName",label:"Spouse Middle",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"spouseLastName",label:"Spouse Last",children:(0,S.jsx)(c.A,{})})})]}),(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"spouseAge",label:"Spouse Age",children:(0,S.jsx)(c.A,{type:"number"})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"spouseBirthDate",label:"Spouse DOB",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"spouseOccupation",label:"Spouse Occupation",children:(0,S.jsx)(c.A,{})})})]}),(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"numberOfChildren",label:"# Children",children:(0,S.jsx)(c.A,{type:"number"})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"childrenNames",label:"Children Names",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"childrenAges",label:"Children Ages",children:(0,S.jsx)(c.A,{})})})]}),(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{name:"motherName",label:"Mother's Name",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{name:"fatherName",label:"Father's Name",children:(0,S.jsx)(c.A,{})})})]})]},"family"),(0,S.jsxs)(O.A.TabPane,{tab:"Business",children:[(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{name:"businessName",label:"Business Name",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{name:"businessType",label:"Business Type",children:(0,S.jsx)(c.A,{})})})]}),(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{name:"businessContactNumber",label:"Business Contact",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{name:"businessEmail",label:"Business Email",children:(0,S.jsx)(c.A,{})})})]}),(0,S.jsx)(l.A,{gutter:8,children:(0,S.jsx)(o.A,{span:24,children:(0,S.jsx)(Ce.A.Item,{name:"businessAddress",label:"Business Address",children:(0,S.jsx)(c.A,{})})})}),(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"registrationNumber",label:"Registration #",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"businessPermitNumber",label:"Business Permit #",children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{name:"barangayClearanceNumber",label:"Barangay Clearance #",children:(0,S.jsx)(c.A,{})})})]})]},"business"),(0,S.jsx)(O.A.TabPane,{tab:"Avatar / Media",children:(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:12,children:(0,S.jsxs)(Ce.A.Item,{label:"Upload Profile Image",children:[(0,S.jsx)(T.A,{accept:"image/*",showUploadList:!1,beforeUpload:()=>!1,customRequest:e=>{if(!U)return;const t=e.file;ae(!0),ie(10);const n=(async()=>{try{ie(30);const e=await k.adminAPI.uploadResidentAvatar(U._id,t);return ie(80),null!==e&&void 0!==e&&e.resident?(M(e.resident),he(t=>(0,a.A)((0,a.A)({},t),{},{profileImage:e.resident.profileImage,profileImageId:e.resident.profileImageId})),le(e.resident.profileImage||"/api/resident/personal-info/avatar/".concat(e.fileId))):null!==e&&void 0!==e&&e.fileId&&(he(t=>(0,a.A)((0,a.A)({},t),{},{profileImage:"/api/resident/personal-info/avatar/".concat(e.fileId),profileImageId:e.fileId})),le("/api/resident/personal-info/avatar/".concat(e.fileId))),ie(100),i.Ay.success("Avatar uploaded"),e}catch(e){throw console.error("Avatar upload failed",e),i.Ay.error((null===e||void 0===e?void 0:e.message)||"Avatar upload failed"),e}finally{ae(!1)}})();return oe.current=n,n},children:(0,S.jsx)(u.Ay,{type:"default",children:"Choose Image"})}),ne&&(0,S.jsxs)("div",{style:{marginTop:8},children:["Uploading: ",se,"%"]}),re&&(0,S.jsx)("div",{style:{marginTop:8},children:(0,S.jsx)("img",{src:re,alt:"preview",style:{maxWidth:120,maxHeight:120,borderRadius:6}})})]})}),(0,S.jsxs)(o.A,{span:12,children:[(0,S.jsx)(Ce.A.Item,{name:"profileImage",label:"Profile Image URL",children:(0,S.jsx)(c.A,{})}),(0,S.jsx)(Ce.A.Item,{name:"profileImageId",label:"Profile Image ID",children:(0,S.jsx)(c.A,{})})]})]})},"media")]})})}),(0,S.jsx)(_.A,{title:"Edit User",open:J,onCancel:()=>$(!1),onOk:async()=>{try{const n=(0,a.A)({},Z);delete n.barangayId,delete n.role,await k.adminAPI.updateUser(z._id,n),i.Ay.success("User updated");const s=e.map(e=>e._id===z._id?(0,a.A)((0,a.A)({},e),n):e);t(s),E(e=>e?(0,a.A)((0,a.A)({},e),n):e),$(!1)}catch(n){console.error("Failed to update user",n),i.Ay.error("Failed to update user")}},width:600,children:(0,S.jsxs)(Ce.A,{layout:"vertical",initialValues:Z,onValuesChange:(e,t)=>te(t),children:[(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{name:"fullName",label:"Full Name",rules:[{required:!0,message:"Full name required"}],children:(0,S.jsx)(c.A,{})})}),(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Enter a valid email"}],children:(0,S.jsx)(c.A,{})})})]}),(0,S.jsxs)(l.A,{gutter:8,children:[(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{name:"isActive",label:"Active",children:(0,S.jsx)(d.A,{options:[{label:"Active",value:!0},{label:"Inactive",value:!1}]})})}),(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{label:"Role",children:(0,S.jsx)(c.A,{value:null===z||void 0===z?void 0:z.role,disabled:!0})})})]}),(0,S.jsx)(l.A,{gutter:8,children:(0,S.jsx)(o.A,{span:24,children:(0,S.jsx)(Ce.A.Item,{label:"Barangay ID",children:(0,S.jsx)(c.A,{value:(null===z||void 0===z?void 0:z.barangayId)||(null===z||void 0===z?void 0:z.barangayID)||"",disabled:!0})})})})]})})]})},Mt=()=>(0,S.jsxs)("div",{style:{padding:20},children:[(0,S.jsx)("h3",{children:"Activity Logs Disabled"}),(0,S.jsx)("p",{children:"The Activity Logs feature has been temporarily disabled in the system."})]});var Wt=n(7650),Yt=n(12624),Ht=n(40426),Gt=n(44811),Vt=n(45725),Kt=n(16026),Jt=n(63248),$t=n(62370),Zt=n(94913),Qt=n(21218),Xt=n(31693),en=n(56403),tn=n(6396);const{RangePicker:nn}=Rt.A,{Option:an}=d.A,sn={gender:{title:"Sex Distribution",chartType:"pie",endpoint:"/api/analytics/gender",colors:["#1890ff","#00bcd4","#888888"]},age:{title:"Age Groups",chartType:"bar",endpoint:"/api/analytics/age",colors:["#1890ff"]},"civil-status":{title:"Civil Status",chartType:"bar",endpoint:"/api/analytics/civil-status",colors:["#1890ff"]},education:{title:"Education",chartType:"bar",endpoint:"/api/analytics/education",colors:["#13c2c2"]},"documents-monthly":{title:"Monthly Document Requests",chartType:"line",endpoint:"/api/analytics/documents-monthly",colors:["#722ed1"]}},rn=Object.keys(sn),ln=new Vt.E({defaultOptions:{queries:{retry:2,staleTime:6e4,refetchOnWindowFocus:!1}}}),on=()=>{var e,t,c,p,x;const[g,f]=(0,s.useState)(!0),[y,A]=(0,s.useState)(null),[j,v]=(0,s.useState)({}),[b,w]=(0,s.useState)({}),[I,C]=(0,s.useState)({dateRange:[],residentType:""}),[k,N]=(0,s.useState)(["gender","age","occupation","education","civil-status"]),[T,D]=(0,s.useState)(!1),P=(0,s.useRef)(null),[R,q]=(0,s.useState)(!1),[B,L]=(0,s.useState)(()=>{try{const e=localStorage.getItem("statsChartSettings");return e?JSON.parse(e):{}}catch(e){return{}}}),[O,z]=(0,s.useState)("gender"),[F,E]=(0,s.useState)(!1),[U,M]=(0,s.useState)(k),W=(0,s.useCallback)(async()=>{f(!0);try{var e,t,n,a,s,i;const r=await en.A.get("/api/analytics/summary",{params:{startDate:null===(e=I.dateRange)||void 0===e||null===(t=e[0])||void 0===t||null===(n=t.format)||void 0===n?void 0:n.call(t,"YYYY-MM-DD"),endDate:null===(a=I.dateRange)||void 0===a||null===(s=a[1])||void 0===s||null===(i=s.format)||void 0===i?void 0:i.call(s,"YYYY-MM-DD"),residentType:I.residentType}});A(r.data||null)}catch(r){A(null)}finally{f(!1)}},[I]);(0,s.useEffect)(()=>{W()},[W]);const Y=(0,s.useCallback)(async e=>{const t=sn[e];if(t){w(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!0}));try{var n,s,i,r,l,o,d,c,u,h,m,p,x;const g=B[e]||{},f=(null===(n=g.dateRange)||void 0===n||null===(s=n[0])||void 0===s||null===(i=s.format)||void 0===i?void 0:i.call(s,"YYYY-MM-DD"))||(null===(r=I.dateRange)||void 0===r||null===(l=r[0])||void 0===l||null===(o=l.format)||void 0===o?void 0:o.call(l,"YYYY-MM-DD")),y=(null===(d=g.dateRange)||void 0===d||null===(c=d[1])||void 0===c||null===(u=c.format)||void 0===u?void 0:u.call(c,"YYYY-MM-DD"))||(null===(h=I.dateRange)||void 0===h||null===(m=h[1])||void 0===m||null===(p=m.format)||void 0===p?void 0:p.call(m,"YYYY-MM-DD"));let A=(null===(x=(await en.A.get(t.endpoint,{params:{startDate:f,endDate:y}})).data)||void 0===x?void 0:x.data)||[];"gender"===e&&(A=A.map(e=>{var t,n,a;return{type:null!==(t=null!==(n=e.name)&&void 0!==n?n:e.type)&&void 0!==t?t:"N/A",value:null!==(a=e.value)&&void 0!==a?a:0}})),v(t=>(0,a.A)((0,a.A)({},t),{},{[e]:A}))}catch(g){console.error("Error fetching chart",e,g),v(t=>(0,a.A)((0,a.A)({},t),{},{[e]:[]}))}finally{w(t=>(0,a.A)((0,a.A)({},t),{},{[e]:!1}))}}},[I,B]);(0,s.useEffect)(()=>{try{localStorage.setItem("statsChartSettings",JSON.stringify(B))}catch(e){}},[B]);const H=null!==(e=null===y||void 0===y?void 0:y.totalResidents)&&void 0!==e?e:0,G=null!==(t=null===y||void 0===y?void 0:y.totalDocumentRequests)&&void 0!==t?t:0,V=j.age||[],K=V&&V.length?Math.max(...V.map(e=>Number(e.value)||0)):0,J=5*Math.ceil(K/5)||5,$=j["documents-monthly"]||[],Z=e=>{var t,n,a;let{id:s,title:i,chartType:l,data:o=[],loading:d,colors:c}=e;const u=Array.isArray(o)&&o.length>0,h=s&&B[s]||{},m=h.chartType||l,p=null===(t=h.showLabels)||void 0===t||t,x=null===(n=h.showTooltips)||void 0===n||n,g=null===(a=h.showLegend)||void 0===a||a;return(0,S.jsx)(r.A,{title:i,style:{borderRadius:12,boxShadow:"0 8px 24px rgba(15,15,15,0.06)"},styles:{body:{padding:16}},children:d?(0,S.jsx)(Wt.A,{active:!0}):u?"pie"===m?(0,S.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(()=>{const e=(o||[]).map(e=>{var t,n,a,s,i,r;return{label:(null!==(t=null!==(n=null!==(a=null!==(s=null===e||void 0===e?void 0:e.type)&&void 0!==s?s:null===e||void 0===e?void 0:e.name)&&void 0!==a?a:null===e||void 0===e?void 0:e.group)&&void 0!==n?n:null===e||void 0===e?void 0:e._id)&&void 0!==t?t:"Unknown").toString().trim(),valueNumber:Number(null!==(i=null!==(r=null===e||void 0===e?void 0:e.value)&&void 0!==r?r:null===e||void 0===e?void 0:e.count)&&void 0!==i?i:0)}});return(0,S.jsx)($t.A,{data:e,angleField:"valueNumber",colorField:"label",radius:.9,label:!!p&&{formatter:e=>{var t,n,a,s,i;const r=(null===e||void 0===e?void 0:e.data)||e||{},l=null!==(t=null!==(n=null===r||void 0===r?void 0:r.label)&&void 0!==n?n:null===r||void 0===r?void 0:r.type)&&void 0!==t?t:"Unknown",o=Number(null!==(a=null!==(s=null!==(i=null===r||void 0===r?void 0:r.valueNumber)&&void 0!==i?i:null===r||void 0===r?void 0:r.value)&&void 0!==s?s:null===r||void 0===r?void 0:r.count)&&void 0!==a?a:0)||0;return"".concat(l," (").concat(o,")")}},tooltip:!!x&&{formatter:e=>{var t,n,a,s,i;const r=(null===e||void 0===e?void 0:e.data)||e||{};return{name:null!==(t=null!==(n=null===r||void 0===r?void 0:r.label)&&void 0!==n?n:null===r||void 0===r?void 0:r.type)&&void 0!==t?t:"Unknown",value:Number(null!==(a=null!==(s=null!==(i=null===r||void 0===r?void 0:r.valueNumber)&&void 0!==i?i:null===r||void 0===r?void 0:r.value)&&void 0!==s?s:null===r||void 0===r?void 0:r.count)&&void 0!==a?a:0)||0}}},color:c,statistic:{title:{formatter:()=>i},content:{formatter:()=>"".concat((e||[]).reduce((e,t)=>e+(Number(t.valueNumber)||0),0)," total")}},legend:!!g&&{position:"bottom",formatter:t=>{const n=(e||[]).find(e=>e.label===t),a=n?Number(n.valueNumber||0):0;return"".concat(t," (").concat(a,")")}},height:220})})()}):"bar"===m?(0,S.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(0,S.jsx)(Zt.A,{data:o,xField:"type",yField:"value",color:c&&c[0],label:!!p&&void 0,legend:!!g&&void 0,tooltip:!!x&&void 0,yAxis:{min:0,max:J,tickInterval:5},height:220})}):"line"===m?(0,S.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(0,S.jsx)(Qt.A,{data:o,xField:"type",yField:"value",legend:!!g&&void 0,tooltip:!!x&&void 0,height:220})}):(0,S.jsx)("div",{ref:e=>{s&&(Q.current[s]=e)},style:{background:"#ffffff"},children:(0,S.jsx)(Xt.A,{data:o,xField:"type",yField:"value",legend:!!g&&void 0,tooltip:!!x&&void 0,height:220})}):(0,S.jsx)(ct.A,{description:"No data"})})},Q=(0,s.useRef)({}),te=(0,s.useRef)(null),ne=Object.keys(sn),ae=(0,Kt.E)({queries:ne.map(e=>{var t,n,a,s,i,r,l,o,d,c,u,h,m,p;return{queryKey:["chart",e,(null===(t=I.dateRange)||void 0===t||null===(n=t[0])||void 0===n||null===(a=n.format)||void 0===a?void 0:a.call(n,"YYYY-MM-DD"))||null,(null===(s=I.dateRange)||void 0===s||null===(i=s[1])||void 0===i||null===(r=i.format)||void 0===r?void 0:r.call(i,"YYYY-MM-DD"))||null,(null===(l=B[e])||void 0===l||null===(o=l.dateRange)||void 0===o||null===(d=o[0])||void 0===d||null===(c=d.format)||void 0===c?void 0:c.call(d,"YYYY-MM-DD"))||null,(null===(u=B[e])||void 0===u||null===(h=u.dateRange)||void 0===h||null===(m=h[1])||void 0===m||null===(p=m.format)||void 0===p?void 0:p.call(m,"YYYY-MM-DD"))||null,I.residentType||null],queryFn:async()=>{var t,n,a,s,i,r,l,o,d,c,u,h,m;const p=B[e]||{},x=(null===(t=p.dateRange)||void 0===t||null===(n=t[0])||void 0===n||null===(a=n.format)||void 0===a?void 0:a.call(n,"YYYY-MM-DD"))||(null===(s=I.dateRange)||void 0===s||null===(i=s[0])||void 0===i||null===(r=i.format)||void 0===r?void 0:r.call(i,"YYYY-MM-DD")),g=(null===(l=p.dateRange)||void 0===l||null===(o=l[1])||void 0===o||null===(d=o.format)||void 0===d?void 0:d.call(o,"YYYY-MM-DD"))||(null===(c=I.dateRange)||void 0===c||null===(u=c[1])||void 0===u||null===(h=u.format)||void 0===h?void 0:h.call(u,"YYYY-MM-DD"));return(null===(m=(await en.A.get(sn[e].endpoint,{params:{startDate:x,endDate:g,residentType:I.residentType}})).data)||void 0===m?void 0:m.data)||[]},retry:2}})}),se=ae.map(e=>JSON.stringify((null===e||void 0===e?void 0:e.data)||"")).join("|"),ie=(0,s.useMemo)(()=>{const e={};return rn.forEach((t,n)=>{e[t]=ae[n]}),e},[se]);(0,s.useEffect)(()=>{const e={},t={};ne.forEach(n=>{const s=ie[n];"gender"===n&&console.debug("chart query gender raw data:",null===s||void 0===s?void 0:s.data),e[n]="gender"===n?((null===s||void 0===s?void 0:s.data)||[]).map(e=>{var t,n,a,s,i;const r=((null!==(t=null!==(n=null!==(a=null===e||void 0===e?void 0:e.name)&&void 0!==a?a:null===e||void 0===e?void 0:e.type)&&void 0!==n?n:null===e||void 0===e?void 0:e._id)&&void 0!==t?t:"").toString().trim()||"").toLowerCase();let l="Other";return/^m/.test(r)?l="Male":/^f/.test(r)&&(l="Female"),{type:l,value:Number(null!==(s=null!==(i=null===e||void 0===e?void 0:e.value)&&void 0!==i?i:null===e||void 0===e?void 0:e.count)&&void 0!==s?s:0)}}).reduce((e,t)=>{const n=e.find(e=>e.type===t.type);return n?n.value+=t.value:e.push((0,a.A)({},t)),e},[]):(null===s||void 0===s?void 0:s.data)||[],t[n]=(null===s||void 0===s?void 0:s.isFetching)||(null===s||void 0===s?void 0:s.isLoading)||!1}),v(e),w(t)},[se,ie]),(0,s.useEffect)(()=>{k&&k.length&&k.forEach(e=>{var t;return(null===(t=ie[e])||void 0===t?void 0:t.refetch)&&ie[e].refetch()})},[k,ie]);const re=(0,s.useMemo)(()=>{const e=Object.keys(j||{}).filter(e=>Array.isArray(j[e])&&j[e].length>0);return new Set(e)},[j]);(0,s.useEffect)(()=>{if(T){P.current=k;const e=Array.from(re),t=rn.filter(t=>e.includes(t)).slice(0,6);t.length&&N(t)}else P.current&&(N(P.current),P.current=null)},[T,re]);const[le,oe]=(0,s.useState)(!1),[de,ce]=(0,s.useState)(""),[ue,he]=(0,s.useState)(()=>"undefined"!==typeof window&&window.innerWidth<700);(0,s.useEffect)(()=>{const e=()=>he(window.innerWidth<700);try{window.addEventListener("resize",e)}catch(t){}return()=>{try{window.removeEventListener("resize",e)}catch(t){}}},[]);return(0,S.jsx)(r.A,{title:(0,S.jsx)(h.A.Title,{level:4,style:{margin:0},children:"Statistics & Analytics"}),style:{borderRadius:16,boxShadow:"0 2px 16px #40c9ff11"},styles:{body:{padding:24}},children:(0,S.jsxs)("div",{ref:te,style:{background:"#ffffff",padding:8},children:[(0,S.jsxs)(Ce.A,{layout:ue?"vertical":"inline",style:{marginBottom:24,width:"100%",boxSizing:"border-box"},children:[(0,S.jsx)(Ce.A.Item,{label:"Date Range",children:(0,S.jsx)(nn,{value:I.dateRange,onChange:e=>C(t=>(0,a.A)((0,a.A)({},t),{},{dateRange:e?e.filter(Boolean):[]})),allowClear:!0})}),(0,S.jsx)(Ce.A.Item,{label:"Resident Type",children:(0,S.jsxs)(d.A,{value:I.residentType,onChange:e=>C(t=>(0,a.A)((0,a.A)({},t),{},{residentType:e})),style:{minWidth:140},allowClear:!0,placeholder:"All Types",children:[(0,S.jsx)(an,{value:"",children:"All"}),(0,S.jsx)(an,{value:"active",children:"Active"}),(0,S.jsx)(an,{value:"inactive",children:"Inactive"})]})}),(0,S.jsx)(Ce.A.Item,{label:"Charts",children:(0,S.jsx)(ee.A,{open:F,onOpenChange:e=>{M(k.slice()),E(e)},popupRender:()=>(0,S.jsxs)("div",{style:{padding:12,background:"#fff",borderRadius:8,boxShadow:"0 6px 20px rgba(0,0,0,0.08)",minWidth:340},children:[(0,S.jsx)("div",{style:{maxHeight:260,overflowY:"auto",paddingRight:8},onWheel:e=>{},children:(0,S.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:Object.keys(sn).map(e=>{const t=(U||[]).includes(e);return(0,S.jsx)(at.A,{checked:t,onChange:t=>{const n=new Set(U||[]);t.target.checked?n.add(e):n.delete(e),M(Array.from(n))},children:(0,S.jsx)("span",{style:{fontSize:13},children:sn[e].title})},e)})})}),(0,S.jsxs)("div",{style:{display:"flex",justifyContent:"flex-end",gap:8,marginTop:12},children:[(0,S.jsx)(u.Ay,{size:"small",onClick:()=>{M(k.slice()),E(!1)},children:"Cancel"}),(0,S.jsx)(u.Ay,{size:"small",type:"primary",onClick:()=>{N(U.slice()),E(!1)},children:"Apply"})]})]}),trigger:["click"],children:(0,S.jsxs)(u.Ay,{children:["Charts ",(0,S.jsx)(Gt.A,{})]})})}),(0,S.jsx)(Ce.A.Item,{style:{width:"100%",boxSizing:"border-box"},children:(0,S.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:8,alignItems:"center",width:"100%",boxSizing:"border-box"},children:[(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,minWidth:200},children:[(0,S.jsx)(Yt.A,{checked:T,onChange:e=>D(!!e)}),(0,S.jsx)("span",{style:{fontSize:13},children:"Enable when data exists"})]}),(0,S.jsxs)("div",{style:{display:"flex",gap:8,flexWrap:"wrap",flex:ue?"0 0 100%":"0 1 auto",alignItems:"center",width:ue?"100%":void 0,boxSizing:"border-box",paddingRight:8},children:[(0,S.jsx)(u.Ay,{onClick:()=>{q(!0),z(k[0]||"gender")},block:ue,style:ue?{width:"100%",marginBottom:8}:void 0,children:"Chart Settings"}),(0,S.jsx)(u.Ay,{type:"primary",onClick:()=>{const e=(e=>{var t,n,a;const s=e.summary||y||{},i=e.charts||j||{},r=Number(null!==(t=s.totalResidents)&&void 0!==t?t:0),l=i.gender||[],o=i.age||[],d=i["civil-status"]||[],c=i.education||[],u=i["documents-monthly"]||[],h=i.occupation||[],m=i.nationality||[],p=i.bloodType||[],x=i.disability||[],g=i.children||[],f=i.businessType||[],A=i.businessSize||[],v=i.incomeBrackets||[],b=Number((null===(n=l.find(e=>(e.type||"").toLowerCase().startsWith("m")))||void 0===n?void 0:n.value)||0),w=Number((null===(a=l.find(e=>(e.type||"").toLowerCase().startsWith("f")))||void 0===a?void 0:a.value)||0),S=Math.max(0,(l||[]).reduce((e,t)=>e+(Number(t.value)||0),0)-b-w);let I="";if(o.length){var C,k;const e=[...o].sort((e,t)=>(Number(t.value)||0)-(Number(e.value)||0));I=(null===(C=e[0])||void 0===C?void 0:C.type)||(null===(k=e[0])||void 0===k?void 0:k.group)||""}const N=d.length?d.slice(0,3).map(e=>"".concat(e.type," (").concat(e.value,")")).join(", "):"",T=c.length?c.slice(0,3).map(e=>"".concat(e.type," (").concat(e.value,")")).join(", "):"",D=u.length?u.reduce((e,t)=>e+(Number(t.value)||0),0):0;let P="",R=0;if(u.length){const e=u.reduce((e,t)=>(Number(t.value)||0)>(Number(e.value)||0)?t:e,u[0]);P=(null===e||void 0===e?void 0:e.type)||"",R=Number((null===e||void 0===e?void 0:e.value)||0)}const q=[];if(r>0){const e=b||w||S?"There are currently ".concat(r," residents, with ").concat(b," males, ").concat(w," females").concat(S?", and ".concat(S," identifying as other"):"","."):"There are currently ".concat(r," residents.");q.push(e)}else q.push("Resident count is not available.");if(I?q.push("The most common age group is ".concat(I,".")):o.length?q.push("Age distribution is available but no dominant age group could be determined."):q.push("Age distribution data is not available."),h.length){const e=h.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0)).slice(0,3).map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");q.push("Top occupations: ".concat(e,"."))}else q.push("Occupation distribution is not available.");if(m.length){const e=m.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0)).slice(0,3).map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");q.push("Nationality distribution (top): ".concat(e,"."))}if(N?q.push("Civil status (top): ".concat(N,".")):q.push("Civil status breakdown is not available."),p.length){const e=p.map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");q.push("Blood type breakdown: ".concat(e,"."))}if(x.length){const e=x.reduce((e,t)=>e+(Number(t.value)||0),0);q.push("Disability reported for ".concat(e," residents."))}if(T?q.push("Educational attainment (top): ".concat(T,".")):q.push("Educational attainment data is not available."),g.length){const e=g.reduce((e,t,n)=>e+(Number(t.value)||0)*(Number(t.type)||n),0)/Math.max(1,g.reduce((e,t)=>e+(Number(t.value)||0),0));q.push("Average reported children per household (approx): ".concat(Number(e).toFixed(2),"."))}if(u.length?q.push("During the selected period there were ".concat(D," document requests. The busiest month was ").concat(P," with ").concat(R," requests.")):q.push("Document request trends are not available for the selected period."),f.length){const e=f.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0)).slice(0,3).map(e=>"".concat(e.type||e.name," (").concat(e.value,")")).join(", ");q.push("Top business types: ".concat(e,"."))}if(A.length){const e=A.reduce((e,t)=>e+(Number(t.value)||0),0);q.push("Business size distribution available for ".concat(e," businesses."))}if(v.length){const e=v.reduce((e,t)=>e+(Number(t.value)||0),0),t=v.slice().sort((e,t)=>Number(t.value||0)-Number(e.value||0))[0];t&&q.push("Most residents fall into the ".concat(t.type||t.name," income bracket (").concat(t.value,"). Total reported incomes: ").concat(e,"."))}return q.join(" ")})({summary:y,charts:j});ce(e),oe(!0)},block:ue,style:ue?{width:"100%",marginBottom:8}:void 0,children:"Generate Report"}),(0,S.jsx)(u.Ay,{onClick:async()=>{await(async()=>{if(te.current){i.Ay.loading({content:"Preparing full report...",key:"report"});try{const e=(await n.e(239).then(n.t.bind(n,65239,23))).default,t=te.current,a=(await e(t,{background:"#ffffff"})).toDataURL("image/png"),s=new tn.Ay({unit:"pt",format:"a4",orientation:"portrait"}),r="Barangay Analytics Report";s.setFontSize(24),s.text(r,40,80),s.setFontSize(12),s.text("Generated: ".concat((new Date).toLocaleString()),40,110),s.addPage();const l=s.internal.pageSize.getWidth(),o=s.internal.pageSize.getHeight(),d=40,c=l-2*d,u=new Image;u.src=a,await new Promise(e=>u.onload=e);const h=c,m=u.height*h/u.width,p=u.height/m,x=o-2*d,g=Math.floor(x*p),f=document.createElement("canvas");f.width=u.width,f.height=u.height;const y=f.getContext("2d");if(!y)throw new Error("Canvas not supported");y.fillStyle="#ffffff",y.fillRect(0,0,f.width,f.height),y.drawImage(u,0,0);let A=0;for(;A<f.height;){const e=document.createElement("canvas");e.width=f.width,e.height=Math.min(g,f.height-A);const t=e.getContext("2d");if(!t)break;t.fillStyle="#ffffff",t.fillRect(0,0,e.width,e.height),t.drawImage(f,0,A,e.width,e.height,0,0,e.width,e.height);const n=e.toDataURL("image/png"),a=e.height/p;s.addImage(n,"PNG",d,d,h,a),A+=g,A<f.height&&s.addPage()}s.save("barangay-analytics-report.pdf"),i.Ay.success({content:"Report ready",key:"report"})}catch(e){console.error("Full report export failed",e),i.Ay.error({content:"Failed to export full report (see console).",key:"report"})}}else i.Ay.error("Dashboard not available for capture")})()},block:ue,style:ue?{width:"100%"}:void 0,children:"Download Full Analytics"})]})]})})]}),(0,S.jsx)(ut.A,{title:"Chart Settings",placement:"right",onClose:()=>q(!1),open:R,width:420,children:(0,S.jsxs)(Ce.A,{layout:"vertical",children:[(0,S.jsx)(Ce.A.Item,{label:"Select chart",children:(0,S.jsx)(d.A,{value:O,onChange:e=>z(e),children:Object.keys(sn).map(e=>(0,S.jsx)(d.A.Option,{value:e,children:sn[e].title},e))})}),(0,S.jsx)(Ce.A.Item,{label:"Chart type",children:(0,S.jsxs)(d.A,{value:B[O]&&B[O].chartType||sn[O].chartType,onChange:e=>L(t=>(0,a.A)((0,a.A)({},t),{},{[O]:(0,a.A)((0,a.A)({},t[O]||{}),{},{chartType:e})})),children:[(0,S.jsx)(d.A.Option,{value:"pie",children:"Pie"}),(0,S.jsx)(d.A.Option,{value:"bar",children:"Bar"}),(0,S.jsx)(d.A.Option,{value:"line",children:"Line"}),(0,S.jsx)(d.A.Option,{value:"area",children:"Area"})]})}),(0,S.jsx)(Ce.A.Item,{label:"Date range for this chart",children:(0,S.jsx)(nn,{value:B[O]&&B[O].dateRange||I.dateRange,onChange:e=>L(t=>(0,a.A)((0,a.A)({},t),{},{[O]:(0,a.A)((0,a.A)({},t[O]||{}),{},{dateRange:e?e.filter(Boolean):[]})})),allowClear:!0})}),(0,S.jsx)(Ce.A.Item,{label:"Show labels",children:(0,S.jsx)(Yt.A,{checked:null===(c=B[O]&&B[O].showLabels)||void 0===c||c,onChange:e=>L(t=>(0,a.A)((0,a.A)({},t),{},{[O]:(0,a.A)((0,a.A)({},t[O]||{}),{},{showLabels:e})}))})}),(0,S.jsx)(Ce.A.Item,{label:"Show tooltips",children:(0,S.jsx)(Yt.A,{checked:null===(p=B[O]&&B[O].showTooltips)||void 0===p||p,onChange:e=>L(t=>(0,a.A)((0,a.A)({},t),{},{[O]:(0,a.A)((0,a.A)({},t[O]||{}),{},{showTooltips:e})}))})}),(0,S.jsx)(Ce.A.Item,{label:"Show legend",children:(0,S.jsx)(Yt.A,{checked:null===(x=B[O]&&B[O].showLegend)||void 0===x||x,onChange:e=>L(t=>(0,a.A)((0,a.A)({},t),{},{[O]:(0,a.A)((0,a.A)({},t[O]||{}),{},{showLegend:e})}))})}),(0,S.jsx)(Ce.A.Item,{children:(0,S.jsxs)(X.A,{children:[(0,S.jsx)(u.Ay,{type:"primary",onClick:()=>{q(!1),Y(O)},children:"Apply"}),(0,S.jsx)(u.Ay,{onClick:()=>{L(e=>(0,a.A)((0,a.A)({},e),{},{[O]:{}}))},children:"Reset"})]})})]})}),(0,S.jsx)(_.A,{title:"Analytics Report",open:le,onCancel:()=>oe(!1),footer:[(0,S.jsx)(u.Ay,{onClick:async()=>{try{await navigator.clipboard.writeText(de),i.Ay.success("Report copied to clipboard")}catch(e){i.Ay.error("Failed to copy")}},children:"Copy"},"copy"),(0,S.jsx)(u.Ay,{type:"primary",onClick:async()=>{const e=new tn.Ay({orientation:"portrait"});e.setFontSize(16),e.text("Analytics Report",14,20),e.setFontSize(11);const t=e.splitTextToSize(de,180);e.text(t,14,30);try{const a=(await n.e(239).then(n.t.bind(n,65239,23))).default;let s=40+6*t.length;for(const t of k){const n=Q.current[t];if(!n)continue;const i=await a(n,{background:"#ffffff"}),r=i.toDataURL("image/png"),l=i.width,o=i.height,d=e.internal.pageSize.getWidth()-28,c=o*d/l;s+c>e.internal.pageSize.getHeight()-20&&(e.addPage(),s=20),e.addImage(r,"PNG",14,s,d,c),s+=c+8}}catch(a){console.warn("html2canvas not available or capture failed, exporting text only",a),i.Ay.warning("Chart capture failed; exporting text-only PDF. To include images, install html2canvas.")}e.save("analytics-report.pdf")},children:"Download as PDF"},"download")],children:(0,S.jsx)(h.A.Paragraph,{children:de||"No data available for report."})}),(0,S.jsxs)(l.A,{gutter:[24,24],style:{marginBottom:24},children:[(0,S.jsx)(o.A,{xs:24,sm:12,md:8,children:(0,S.jsx)(r.A,{variant:"borderless",style:{borderRadius:12,boxShadow:"0 8px 20px rgba(15,15,15,0.04)",textAlign:"left"},styles:{body:{padding:16}},children:g?(0,S.jsx)(Wt.A,{active:!0,paragraph:!1}):(0,S.jsxs)("div",{children:[(0,S.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12},children:"Total Residents"}),(0,S.jsx)(h.A.Title,{level:3,style:{margin:0},children:H})]})})}),(0,S.jsx)(o.A,{xs:24,sm:12,md:8,children:(0,S.jsx)(r.A,{variant:"borderless",style:{borderRadius:12,boxShadow:"0 8px 20px rgba(15,15,15,0.04)",textAlign:"left"},styles:{body:{padding:16}},children:g?(0,S.jsx)(Wt.A,{active:!0,paragraph:!1}):(0,S.jsxs)("div",{children:[(0,S.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12},children:"Total Documents"}),(0,S.jsx)(h.A.Title,{level:3,style:{margin:0},children:G})]})})}),(0,S.jsx)(o.A,{xs:24,sm:24,md:8,children:(0,S.jsx)(r.A,{style:{borderRadius:12,boxShadow:"0 8px 20px rgba(15,15,15,0.04)",textAlign:"left"},styles:{body:{padding:16}},children:g?(0,S.jsx)(Wt.A,{active:!0,paragraph:!1}):(0,S.jsxs)("div",{children:[(0,S.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12},children:"Requests (selected period)"}),(0,S.jsx)(h.A.Title,{level:3,style:{margin:0},children:$?$.reduce((e,t)=>e+(Number(t.value)||0),0):0}),(0,S.jsx)(h.A.Text,{type:"secondary",style:{display:"block",fontSize:12,marginTop:6},children:$&&$.length?"Latest: ".concat($[$.length-1].type," (").concat($[$.length-1].value,")"):""})]})})})]}),(0,S.jsx)(m.A,{}),ne.map(e=>{const t=ie[e];var n;return null!==t&&void 0!==t&&t.isError?(0,S.jsx)(Ht.A,{message:"Failed to load ".concat(sn[e].title),description:(0,S.jsxs)("div",{children:[String((null===(n=t.error)||void 0===n?void 0:n.message)||t.error)," ",(0,S.jsx)(u.Ay,{size:"small",onClick:()=>t.refetch(),children:"Retry"})]}),type:"error",showIcon:!0,style:{marginBottom:12}},"alert-".concat(e)):null}),(0,S.jsxs)(l.A,{gutter:[24,24],children:[k.includes("gender")&&(0,S.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,S.jsx)(Z,{id:"gender",title:sn.gender.title,chartType:sn.gender.chartType,data:j.gender,loading:b.gender,colors:sn.gender.colors})}),k.includes("age")&&(0,S.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,S.jsx)(Z,{id:"age",title:sn.age.title,chartType:sn.age.chartType,data:j.age,loading:b.age,colors:sn.age.colors})}),k.includes("documents-monthly")&&(0,S.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,S.jsx)(Z,{id:"documents-monthly",title:sn["documents-monthly"].title,chartType:sn["documents-monthly"].chartType,data:j["documents-monthly"],loading:b["documents-monthly"],colors:sn["documents-monthly"].colors})}),k.includes("civil-status")&&(0,S.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,S.jsx)(Z,{id:"civil-status",title:sn["civil-status"].title,chartType:sn["civil-status"].chartType,data:j["civil-status"],loading:b["civil-status"],colors:sn["civil-status"].colors})}),k.includes("education")&&(0,S.jsx)(o.A,{xs:24,md:12,lg:12,children:(0,S.jsx)(Z,{id:"education",title:sn.education.title,chartType:sn.education.chartType,data:j.education,loading:b.education,colors:sn.education.colors})})]})]})})},dn=()=>(0,S.jsx)(Jt.Ht,{client:ln,children:(0,S.jsx)(on,{})});var cn=n(94842),un=n(94527),hn=n(80172),mn=n(1725),pn=n(76384),xn=n(61190),gn=n(70916);const fn=e=>{let{open:t,onClose:n,contactEmail:a}=e;const[i,r]=(0,s.useState)(a||""),[l,o]=(0,s.useState)(!1);(0,s.useEffect)(()=>{r(a||"")},[a,t]);const[d,c]=(0,s.useState)(!1),[u,h]=(0,s.useState)(""),[m,p]=(0,s.useState)("success");return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(xn.A,{open:t,onClose:()=>{l||n()},children:(0,S.jsxs)(_e.A,{sx:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:420,bgcolor:"background.paper",boxShadow:24,p:3},children:[(0,S.jsx)("h3",{children:"Send Test Email"}),(0,S.jsx)(Ee.A,{label:"Recipient Email",type:"email",value:i,onChange:e=>r(e.target.value),fullWidth:!0,margin:"normal"}),(0,S.jsxs)(_e.A,{sx:{display:"flex",justifyContent:"flex-end",gap:2,mt:2},children:[(0,S.jsx)(Me.A,{onClick:n,disabled:l,children:"Cancel"}),(0,S.jsx)(Me.A,{variant:"contained",onClick:async()=>{try{o(!0);try{const e=await k.adminAPI.getSystemSettings();if(!e||!e.smtp||!e.smtp.host)return h("SMTP is not configured. Please configure SMTP settings before sending a test email."),p("error"),c(!0),void o(!1)}catch(r){}const e=await k.adminAPI.testSmtp(i),t=e&&e.message?e.message:"Test email sent successfully";h(t),p("success"),c(!0),o(!1),setTimeout(()=>{c(!1),n()},900)}catch(l){var e,t,a,s;o(!1);const n=(null===l||void 0===l||null===(e=l.response)||void 0===e||null===(t=e.data)||void 0===t?void 0:t.message)||(null===l||void 0===l||null===(a=l.response)||void 0===a||null===(s=a.data)||void 0===s?void 0:s.error)||(null===l||void 0===l?void 0:l.message)||"Failed to send test email";h(n),p("error"),c(!0)}},disabled:l||!i,children:l?(0,S.jsx)(hn.A,{size:20}):"Send Test Email"})]})]})}),(0,S.jsx)(gn.A,{open:d,autoHideDuration:4e3,onClose:()=>c(!1),children:(0,S.jsx)(Ye.A,{onClose:()=>c(!1),severity:m,sx:{width:"100%"},children:u})})]})};var yn=n(78354);const An={siteName:"Barangay Portal",barangayName:"Barangay Uno",barangayAddress:"123 Main St, City, Province",contactEmail:"info@barangayuno.local",contactPhone:"+63 912 345 6789",maintainanceMode:!1,allowNewRegistrations:!0,requireEmailVerification:!0,maxDocumentRequests:5,documentProcessingDays:3,allowMultipleAccountsPerIP:!1,maxAccountsPerIP:1,systemNotice:"",smtp:{host:"",port:587,user:"",password:""}},jn=()=>{var e,t,n,r,l;const[o,d]=(0,s.useState)(()=>(0,a.A)({},An)),[c,u]=(0,s.useState)(!0),[h,m]=(0,s.useState)(!1),[p,x]=(0,s.useState)(!1),[g,f]=(0,s.useState)(null),[A,j]=(0,s.useState)(!1),[v,b]=(0,s.useState)([]),[w,I]=(0,s.useState)(!1),[C,N]=(0,s.useState)(!1),[D,P]=(0,s.useState)(null),B=(0,s.useRef)({}),[L,O]=(0,s.useState)({}),_=(0,s.useRef)({}),z=(0,s.useRef)(null),F=(0,s.useRef)(0),[E,U]=(0,s.useState)([]),M=(0,s.useRef)({}),W=(0,s.useRef)(null),[Y,H]=(0,s.useState)(!1);(0,s.useEffect)(()=>{const e=new AbortController;return G(e.signal),()=>{try{e.abort()}catch(t){}try{Object.values(_.current).forEach(e=>{try{URL.revokeObjectURL(e)}catch(t){}})}catch(t){}}},[]),(0,s.useEffect)(()=>{try{const e=z.current;if(!e)return;v.length>F.current&&e.scrollTo({left:e.scrollWidth,behavior:"smooth"}),F.current=v.length}catch(e){}},[v.length]),(0,s.useEffect)(()=>{try{v.filter(e=>e._id&&e._id.toString().startsWith("new-")).map(e=>e._id).forEach(e=>{if(!E.includes(e)){U(t=>[...t,e]);const t=window.setTimeout(()=>{U(t=>t.filter(t=>t!==e)),delete M.current[e]},2500);M.current[e]=t}})}catch(e){}return()=>{Object.values(M.current).forEach(t=>{try{clearTimeout(t)}catch(e){}}),M.current={}}},[v,E]);const G=async e=>{u(!0);try{let a=null;try{a=await k.adminAPI.getSystemSettings()}catch(t){try{const t=await en.A.get("".concat(k.API_URL,"/admin/settings"),{withCredentials:!0,signal:e});null!==t&&void 0!==t&&t.data&&(a=t.data)}catch(n){console.warn("Failed to load system settings via adminAPI and API_URL fallback",t,n)}}a&&(d(a),W.current=a),I(!0);try{const t=await k.adminAPI.getOfficials();if(Array.isArray(t))b(t);else{const t=await en.A.get("".concat(k.API_URL,"/admin/officials"),{withCredentials:!0,signal:e});null!==t&&void 0!==t&&t.data&&b(t.data)}}catch(t){try{const t=await en.A.get("".concat(k.API_URL,"/admin/officials"),{withCredentials:!0,signal:e});null!==t&&void 0!==t&&t.data&&b(t.data)}catch(n){console.warn("Failed to load officials via adminAPI and API_URL fallback",t,n)}}finally{I(!1)}}catch(t){if("CanceledError"===(null===t||void 0===t?void 0:t.name)||"AbortError"===(null===t||void 0===t?void 0:t.name))return;console.error("Unexpected error in fetchSettings",t),i.Ay.error("Unexpected error while loading settings")}finally{u(!1)}},V=async()=>{try{await(async()=>{try{m(!0),f(null);const e=(0,a.A)((0,a.A)({},o),{},{maintenanceMode:o.maintainanceMode,allowRegistrations:o.allowNewRegistrations,maxDocumentRequestsPerUser:Number(o.maxDocumentRequests)||1,documentProcessingDays:Number(o.documentProcessingDays)||1},"undefined"!==typeof o.maxAccountsPerIP?{maxAccountsPerIP:Number(o.maxAccountsPerIP)||1}:{});await k.adminAPI.updateSystemSettings(e),W.current=e,H(!1),x(!0),i.Ay.success("Settings saved")}catch(e){console.error("Failed to save settings",e),f("Failed to save settings"),i.Ay.error("Failed to save settings")}finally{m(!1),window.setTimeout(()=>x(!1),2e3)}})()}catch(e){}try{await(async()=>{if(v&&0!==v.length){N(!0),P(null);try{const t=[];for(const n of v)if(!n._id||n._id.toString().startsWith("new-")){const e=await k.adminAPI.createOfficial({name:n.name,title:n.title,term:n.term});t.push(e)}else try{const e=await k.adminAPI.updateOfficial(n._id,{name:n.name,title:n.title,term:n.term});t.push(e)}catch(e){t.push(n)}try{const e=await k.adminAPI.getOfficials();Array.isArray(e)?b(e):b(t)}catch(e){b(t)}i.Ay.success("Officials saved")}catch(t){console.error("Manual save officials failed",t),P("Manual save failed"),i.Ay.error("Manual save failed")}finally{N(!1)}}})()}catch(e){}};(0,s.useEffect)(()=>{try{if(!W.current)return void H(!1);H(JSON.stringify(W.current)!==JSON.stringify(o))}catch(e){H(!1)}},[o]);return(0,S.jsx)(_e.A,{sx:{pt:"calc(var(--app-header-height, 64px) + 24px)",px:3,pb:3},children:(0,S.jsxs)(Fe.A,{sx:{p:3},children:[(0,S.jsx)(cn.A,{variant:"subtitle1",gutterBottom:!0,children:"Barangay Information"}),(0,S.jsxs)(_e.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,S.jsx)(Ee.A,{label:"Site Name",value:o.siteName,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{siteName:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,S.jsx)(Ee.A,{label:"Barangay Name",value:o.barangayName,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{barangayName:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,S.jsx)(Ee.A,{label:"Barangay Address",value:o.barangayAddress,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{barangayAddress:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0,multiline:!0,rows:2})]}),(0,S.jsx)(un.A,{sx:{my:3}}),(0,S.jsx)(cn.A,{variant:"subtitle1",gutterBottom:!0,children:"SMTP / Email Settings"}),(0,S.jsxs)(_e.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,S.jsx)(Ee.A,{label:"SMTP Host",value:(null===(e=o.smtp)||void 0===e?void 0:e.host)||"",onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{smtp:(0,a.A)((0,a.A)({},t.smtp),{},{host:e.target.value})})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,S.jsx)(Ee.A,{label:"SMTP Port",type:"number",value:(null===(t=o.smtp)||void 0===t?void 0:t.port)||"",onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{smtp:(0,a.A)((0,a.A)({},t.smtp),{},{port:parseInt(e.target.value||"0")})})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,S.jsx)(Ee.A,{label:"SMTP User",value:(null===(n=o.smtp)||void 0===n?void 0:n.user)||"",onChange:e=>d(t=>(0,a.A)((0,a.A)({},t),{},{smtp:(0,a.A)((0,a.A)({},t.smtp),{},{user:e.target.value})})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,S.jsxs)(_e.A,{sx:{display:"flex",gap:2},children:[(0,S.jsx)(Me.A,{variant:"outlined",onClick:()=>j(!0),children:"Send Test Email"}),(0,S.jsx)(Me.A,{variant:"text",onClick:()=>d(e=>(0,a.A)((0,a.A)({},e),{},{smtp:(0,a.A)((0,a.A)({},e.smtp),{},{password:""})})),children:"Clear SMTP Password"})]})]}),(0,S.jsx)(fn,{open:A,onClose:()=>j(!1),contactEmail:o.contactEmail}),(0,S.jsx)(un.A,{sx:{my:3}}),(0,S.jsx)(cn.A,{variant:"subtitle1",gutterBottom:!0,children:"Barangay Officials"}),(0,S.jsxs)(_e.A,{sx:{display:"flex",gap:3,alignItems:"flex-start",mb:3,flexDirection:{xs:"column",md:"row"}},children:[(0,S.jsxs)(_e.A,{sx:{flex:1,width:"100%"},children:[(0,S.jsxs)(_e.A,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[(0,S.jsx)(cn.A,{variant:"body1",children:"Manage officials (auto-saves changes)"}),(0,S.jsx)(Me.A,{onClick:()=>{const e={_id:"new-".concat(Date.now()),name:"",title:"",term:""};b(t=>[...t,e])},startIcon:(0,S.jsx)(yn.A,{}),children:"Add Official"})]}),(0,S.jsx)(_e.A,{sx:{maxHeight:420,overflowY:"auto",pr:1,border:"1px solid rgba(0,0,0,0.04)",borderRadius:1,boxShadow:"inset 0 1px 0 rgba(255,255,255,0.6)"},children:w?(0,S.jsx)(hn.A,{size:24}):(0,S.jsx)(_e.A,{sx:{display:"flex",flexDirection:"column",gap:2},children:v.map((e,t)=>(0,S.jsxs)(Fe.A,{sx:{p:2,display:"flex",gap:2,alignItems:"center"},children:[(0,S.jsx)(_e.A,{sx:{width:72,height:72,borderRadius:"50%",overflow:"hidden",flexShrink:0,border:"3px solid rgba(0,0,0,0.04)",boxShadow:"0 1px 6px rgba(0,0,0,0.06)"},children:(0,S.jsx)("img",{src:Ne(e),alt:e.name||"photo",style:{width:"100%",height:"100%",objectFit:"cover",transition:"transform .2s",display:"block"}})}),(0,S.jsxs)(_e.A,{sx:{flex:1},children:[(0,S.jsx)(Ee.A,{label:"Full name",value:e.name,onChange:t=>{const n=t.target.value;b(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{name:n}):t)),B.current[e._id||""]&&clearTimeout(B.current[e._id||""]),B.current[e._id||""]=window.setTimeout(async()=>{try{if(N(!0),e._id&&!e._id.toString().startsWith("new-"))await k.adminAPI.updateOfficial(e._id,(0,a.A)((0,a.A)({},e),{},{name:n}));else{const t=await k.adminAPI.createOfficial((0,a.A)((0,a.A)({},e),{},{name:n}));b(n=>n.map(n=>n._id===e._id?t:n))}P(null)}catch(t){console.error("auto-save failed",t),P("Auto-save failed")}finally{N(!1)}},900)},fullWidth:!0,size:"small",sx:{mb:1},variant:"outlined",InputLabelProps:{shrink:!0}}),(0,S.jsx)(Ee.A,{label:"Title/Position",value:e.title,onChange:t=>{const n=t.target.value;b(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{title:n}):t)),B.current[e._id||""]&&clearTimeout(B.current[e._id||""]),B.current[e._id||""]=window.setTimeout(async()=>{try{if(N(!0),e._id&&!e._id.toString().startsWith("new-"))await k.adminAPI.updateOfficial(e._id,(0,a.A)((0,a.A)({},e),{},{title:n}));else{const t=await k.adminAPI.createOfficial((0,a.A)((0,a.A)({},e),{},{title:n}));b(n=>n.map(n=>n._id===e._id?t:n))}P(null)}catch(t){console.error("auto-save failed",t),P("Auto-save failed")}finally{N(!1)}},900)},fullWidth:!0,size:"small",sx:{mb:1},variant:"outlined",InputLabelProps:{shrink:!0}}),(0,S.jsx)(Ee.A,{label:"Term",value:e.term,onChange:t=>{const n=t.target.value;b(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{term:n}):t)),B.current[e._id||""]&&clearTimeout(B.current[e._id||""]),B.current[e._id||""]=window.setTimeout(async()=>{try{if(N(!0),e._id&&!e._id.toString().startsWith("new-"))await k.adminAPI.updateOfficial(e._id,(0,a.A)((0,a.A)({},e),{},{term:n}));else{const t=await k.adminAPI.createOfficial((0,a.A)((0,a.A)({},e),{},{term:n}));b(n=>n.map(n=>n._id===e._id?t:n))}P(null)}catch(t){console.error("auto-save failed",t),P("Auto-save failed")}finally{N(!1)}},900)},fullWidth:!0,size:"small",variant:"outlined",InputLabelProps:{shrink:!0}}),(0,S.jsxs)(_e.A,{sx:{display:"flex",gap:1,mt:1},children:[(0,S.jsx)(T.A,{showUploadList:!1,beforeUpload:t=>{if(t.size>2097152)return i.Ay.warning("File is too large. Maximum allowed size is 2 MB."),!1;try{const n=URL.createObjectURL(t);_.current[e._id||"temp-".concat(Date.now())]=n,b(t=>t.map(t=>t._id===e._id?(0,a.A)((0,a.A)({},t),{},{previewUrl:n}):t))}catch(n){}return(async()=>{try{if(!e._id||e._id.toString().startsWith("new-"))return void i.Ay.warning("Please save official first by entering name/title/term");await k.adminAPI.uploadOfficialPhoto(e._id,t);const a=await k.adminAPI.getOfficials();b(Array.isArray(a)?a:v),i.Ay.success("Photo uploaded");try{const t=e._id||"",n=_.current[t];n&&(URL.revokeObjectURL(n),delete _.current[t])}catch(n){}}catch(a){console.error("upload failed",a),i.Ay.error("Upload failed")}})(),!1},children:(0,S.jsx)(Me.A,{startIcon:(0,S.jsx)(q.A,{}),children:"Upload Photo"})}),(0,S.jsx)(Me.A,{color:"error",startIcon:(0,S.jsx)(R.A,{}),onClick:()=>{e._id&&!e._id.toString().startsWith("new-")?(async e=>{if(e){N(!0);try{await k.adminAPI.deleteOfficial(e),b(t=>t.filter(t=>t._id!==e)),i.Ay.success("Official deleted")}catch(t){console.error("Delete official failed",t),i.Ay.error("Failed to delete official")}finally{N(!1)}}})(e._id):b(t=>t.filter(t=>t._id!==e._id))},children:"Delete"})]})]})]},e._id||t))})})]}),(0,S.jsxs)(_e.A,{sx:{width:{xs:"100%",md:360},position:{xs:"relative",md:"sticky"},top:{md:24},alignSelf:"flex-start",mt:{xs:2,md:0}},children:[(0,S.jsx)(cn.A,{variant:"body2",sx:{mb:1},children:"Officials Preview"}),(0,S.jsx)(_e.A,{sx:{background:"white",borderRadius:2,p:2},children:0===v.length?(0,S.jsx)(cn.A,{variant:"body2",color:"text.secondary",children:"No officials to preview"}):(()=>{const e=[...v.filter(e=>!(e._id&&e._id.toString().startsWith("new-"))),...v.filter(e=>e._id&&e._id.toString().startsWith("new-"))];return(0,S.jsx)("div",{ref:z,style:{display:"flex",gap:12,overflowX:"auto",padding:"6px 4px",scrollSnapType:"x mandatory"},"aria-label":"Officials preview",children:e.map(e=>{const t=e._id||"",n=E.includes(t);return(0,S.jsxs)("div",{style:{minWidth:140,textAlign:"center",padding:8,scrollSnapAlign:"center",transition:"box-shadow .25s, transform .18s",boxShadow:n?"0 10px 30px rgba(25,118,210,0.18)":void 0,transform:n?"translateY(-4px)":void 0,borderRadius:8,background:n?"linear-gradient(180deg, rgba(255,255,255,0.98), rgba(250,250,255,0.98))":void 0,flex:"0 0 auto"},children:[(0,S.jsx)(y.A,{size:80,src:Ne(e),style:{margin:"0 auto",boxShadow:"0 6px 18px rgba(0,0,0,0.06)"}}),(0,S.jsxs)("div",{style:{marginTop:8},children:[(0,S.jsx)("div",{style:{fontWeight:600,fontSize:14},children:e.name||"\u2014"}),(0,S.jsx)("div",{style:{color:"#888",fontSize:12},children:e.title}),(0,S.jsx)("div",{style:{color:"#888",fontSize:12},children:e.term})]})]},t||Math.random())})})})()})]})]}),D&&(0,S.jsx)(cn.A,{color:"error",sx:{mt:1},children:D}),(0,S.jsx)(cn.A,{variant:"subtitle1",gutterBottom:!0,children:"Contact Information"}),(0,S.jsxs)(_e.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,S.jsx)(Ee.A,{label:"Contact Email",type:"email",value:o.contactEmail,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{contactEmail:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0}),(0,S.jsx)(Ee.A,{label:"Contact Phone",value:o.contactPhone,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{contactPhone:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0})]}),(0,S.jsx)(un.A,{sx:{my:3}}),(0,S.jsx)(cn.A,{variant:"subtitle1",gutterBottom:!0,children:"System Configuration"}),(0,S.jsxs)(_e.A,{sx:{display:"flex",flexDirection:"column",gap:2,mb:3},children:[(0,S.jsx)(mn.A,{control:(0,S.jsx)(pn.A,{checked:o.maintainanceMode,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{maintainanceMode:e.target.checked}))}),label:"Maintenance Mode"}),(0,S.jsx)(mn.A,{control:(0,S.jsx)(pn.A,{checked:o.allowNewRegistrations,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{allowNewRegistrations:e.target.checked}))}),label:"Allow New Registrations"}),(0,S.jsxs)(_e.A,{children:[(0,S.jsx)(mn.A,{control:(0,S.jsx)(pn.A,{checked:o.allowMultipleAccountsPerIP,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{allowMultipleAccountsPerIP:e.target.checked}))}),label:"Allow multiple accounts per IP"}),(0,S.jsxs)(_e.A,{sx:{mt:1,ml:4,display:"flex",alignItems:"center",gap:2},children:[(0,S.jsx)(Ee.A,{label:"Max accounts per IP",type:"number",size:"small",value:null!==(r=o.maxAccountsPerIP)&&void 0!==r?r:1,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{maxAccountsPerIP:parseInt(e.target.value||"1")})),variant:"outlined",InputLabelProps:{shrink:!0},inputProps:{min:1,max:100},sx:{width:140}}),(0,S.jsxs)(cn.A,{variant:"caption",color:"text.secondary",children:["Current limit: ",null!==(l=o.maxAccountsPerIP)&&void 0!==l?l:1]})]})]}),(0,S.jsx)(mn.A,{control:(0,S.jsx)(pn.A,{checked:o.requireEmailVerification,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{requireEmailVerification:e.target.checked}))}),label:"Require Email Verification"}),(0,S.jsx)(Ee.A,{label:"Maximum Document Requests per User",type:"number",value:o.maxDocumentRequests,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{maxDocumentRequests:parseInt(e.target.value)})),variant:"outlined",InputLabelProps:{shrink:!0},inputProps:{min:1,max:20}}),(0,S.jsx)(Ee.A,{label:"Document Processing Days",type:"number",value:o.documentProcessingDays,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{documentProcessingDays:parseInt(e.target.value)})),variant:"outlined",InputLabelProps:{shrink:!0},inputProps:{min:1,max:30},helperText:"Standard number of days to process document requests"})]}),(0,S.jsx)(un.A,{sx:{my:3}}),(0,S.jsx)(cn.A,{variant:"subtitle1",gutterBottom:!0,children:"System Notice"}),(0,S.jsx)(_e.A,{sx:{mb:3},children:(0,S.jsx)(Ee.A,{label:"System-wide Notice",value:o.systemNotice,onChange:e=>d((0,a.A)((0,a.A)({},o),{},{systemNotice:e.target.value})),variant:"outlined",InputLabelProps:{shrink:!0},fullWidth:!0,multiline:!0,rows:3,helperText:"This notice will be displayed to all users"})}),(0,S.jsx)(_e.A,{sx:{position:"fixed",right:24,bottom:24,zIndex:1300},children:(0,S.jsx)(Me.A,{variant:"contained",onClick:()=>V(),disabled:h||C,sx:{width:64,height:64,borderRadius:"50%",minWidth:64,boxShadow:"0 8px 24px rgba(25,118,210,0.24)",backgroundColor:"#1976d2",color:"#fff","&:hover":{boxShadow:"0 12px 32px rgba(25,118,210,0.32)",backgroundColor:"#1565c0"},display:"flex",alignItems:"center",justifyContent:"center",fontWeight:600},"aria-label":"Save Settings and Officials",children:h||C?"...":"Save"})})]})})};var vn=n(48745);const{Title:bn,Text:wn}=h.A,{Search:Sn}=c.A,In=()=>{const[e,t]=(0,s.useState)([]),[h,m]=(0,s.useState)([]),[p,x]=(0,s.useState)(!1),[g,f]=(0,s.useState)(""),[y,A]=(0,s.useState)({}),[j,v]=(0,s.useState)(""),[b,w]=(0,s.useState)(""),[I,C]=(0,s.useState)("all"),[N,B]=(0,s.useState)("name"),[L,O]=(0,s.useState)(!1),[z,F]=(0,s.useState)(!1),[E,U]=(0,s.useState)(null),[M,W]=(0,s.useState)(!1),[Y,H]=(0,s.useState)([]),{user:G,setUser:K}=V();(0,s.useEffect)(()=>{(async()=>{O(!0);try{const e=await k.documentsAPI.listFiles();t(e)}catch(e){i.Ay.error("Failed to fetch document templates"),t([])}finally{O(!1)}})()},[]);const J=e.filter(e=>{const t=e.filename.toLowerCase(),n=b.toLowerCase(),a="all"===I||e.category===I;return t.includes(n)&&a}).sort((e,t)=>{var n;switch(N){case"date":return new Date(t.uploadDate).getTime()-new Date(e.uploadDate).getTime();case"type":return(null===(n=e.filename.split(".").pop())||void 0===n?void 0:n.localeCompare(t.filename.split(".").pop()||""))||0;default:return e.filename.localeCompare(t.filename)}});return(0,S.jsxs)("div",{style:{padding:"24px",minHeight:"80vh",background:"#f0f2f5"},children:[(0,S.jsx)(l.A,{justify:"start",align:"middle",style:{marginBottom:24},children:(0,S.jsxs)(o.A,{style:{textAlign:"left"},children:[(0,S.jsxs)(Pt.A,{style:{marginBottom:8},children:[(0,S.jsx)(Pt.A.Item,{children:"Home"}),(0,S.jsx)(Pt.A.Item,{children:"Documents"}),(0,S.jsx)(Pt.A.Item,{children:"Request"})]}),(0,S.jsx)(bn,{level:2,style:{margin:0,textAlign:"left"},children:"Request Document"})]})}),(0,S.jsxs)(l.A,{gutter:16,justify:"center",style:{marginBottom:24},children:[(0,S.jsx)(o.A,{xs:24,sm:16,md:10,lg:8,children:(0,S.jsx)(Sn,{placeholder:"Search documents...",value:b,onChange:e=>w(e.target.value),style:{width:"100%"}})}),(0,S.jsx)(o.A,{xs:24,sm:16,md:10,lg:8,children:(0,S.jsxs)(X.A,{children:[(0,S.jsxs)(d.A,{defaultValue:"all",style:{width:220},onChange:e=>C(e),children:[(0,S.jsx)(d.A.Option,{value:"all",children:"All Categories"}),(0,S.jsx)(d.A.Option,{value:"personal",children:"Personal Documents"}),(0,S.jsx)(d.A.Option,{value:"business",children:"Business Documents"}),(0,S.jsx)(d.A.Option,{value:"certificates",children:"Certificates"})]}),(0,S.jsxs)(d.A,{defaultValue:"name",style:{width:160},onChange:e=>B(e),children:[(0,S.jsx)(d.A.Option,{value:"name",children:"Sort by Name"}),(0,S.jsx)(d.A.Option,{value:"date",children:"Sort by Date"}),(0,S.jsx)(d.A.Option,{value:"type",children:"Sort by Type"})]})]})})]}),(0,S.jsx)(l.A,{gutter:[16,16],children:L?(0,S.jsx)(o.A,{span:24,style:{textAlign:"center",padding:"40px"},children:"Loading documents..."}):0===J.length?(0,S.jsx)(o.A,{span:24,style:{textAlign:"center",padding:"40px"},children:"No documents found"}):J.map(e=>(0,S.jsx)(o.A,{xs:24,sm:12,md:8,lg:6,children:(0,S.jsx)(r.A,{hoverable:!0,style:{transition:"all 0.3s ease",borderRadius:8},bodyStyle:{padding:16},onClick:()=>(async e=>{const t=G||(()=>{try{const e=localStorage.getItem("userProfile");return e?JSON.parse(e):null}catch(e){return null}})();if(!t||"resident"!==t.role||t.verified){f(e.filename.replace(/\.docx$/i,""));try{const t=await fetch("/api/documents/preview/".concat(e._id,"?format=html")),n=await t.text(),a=/\{(.*?)\}/g,s=[];let i;for(;null!==(i=a.exec(n));)s.push(i[1].trim());const r=s.filter(e=>e&&"qr"!==e.toLowerCase());m(r);const l={},o=new Date,d=o.getDate(),c=o.getMonth()+1,u=o.toLocaleString(void 0,{month:"long"}),h=o.getFullYear(),p=String(c).padStart(2,"0"),g=String(d).padStart(2,"0"),f="".concat(p,"/").concat(g,"/").concat(h);r.forEach(e=>{l[e]="",/^current(day|dayof)?$/i.test(e)||/currentday/i.test(e)?l[e]=String(d):/current(month)?$/i.test(e)||/currentmonth/i.test(e)?l[e]=u:/current(year)?$/i.test(e)||/currentyear/i.test(e)?l[e]=String(h):/currentdate|current_date|current date|dateofrequest|requesteddate/i.test(e)&&(l[e]=f)}),A(l),x(!0)}catch(n){i.Ay.error("Failed to load document preview"),m([]),A({})}}else W(!0)})(e),children:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"flex-start",marginBottom:12},children:[(0,S.jsx)(vn.A,{style:{fontSize:24,color:"#1890ff",marginRight:12,marginTop:4}}),(0,S.jsxs)("div",{style:{flex:1,minWidth:0},children:[(0,S.jsx)(wn,{strong:!0,style:{display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:e.filename.replace(/\.docx$/i,"")}),(0,S.jsxs)(wn,{type:"secondary",style:{fontSize:12},children:[new Date(e.uploadDate).toLocaleDateString()," \xb7 ",Math.round(e.length/1024)," KB"]})]}),(0,S.jsx)(ee.A,{menu:{items:[{key:"view",icon:(0,S.jsx)(D.A,{}),label:"View"},{key:"download",icon:(0,S.jsx)(P.A,{}),label:"Download"},{key:"delete",icon:(0,S.jsx)(R.A,{}),label:"Delete"}]},trigger:["click"],children:(0,S.jsx)(u.Ay,{type:"text",icon:(0,S.jsx)(Ot.A,{}),onClick:e=>e.stopPropagation()})})]})})},e._id))}),(0,S.jsx)(_.A,{open:p,onCancel:()=>x(!1),width:800,footer:null,children:0===h.length?(0,S.jsx)(ct.A,{description:"No fields found in this template"}):(0,S.jsx)(Ce.A,{layout:"vertical",initialValues:{fields:y},onFinish:async t=>{F(!0);try{var n,s;const r=(0,a.A)({},t.fields);Object.entries(r).forEach(e=>{let[t,n]=e;if(n&&"function"===typeof n.format)try{r[t]=n.format("MM/DD/YYYY")}catch(a){r[t]=String(n)}});const l={type:g,documentType:g,purpose:t.purpose,fileId:null===(n=e.find(e=>e.filename.replace(/\.docx$/i,"")===g))||void 0===n?void 0:n._id,fieldValues:r},o=await k.documentsAPI.requestDocument(l);i.Ay.success("Request submitted successfully!"),U((null===o||void 0===o||null===(s=o.documentRequest)||void 0===s?void 0:s._id)||(null===o||void 0===o?void 0:o._id)||null),x(!1)}catch(r){i.Ay.error("Failed to submit request.")}finally{F(!1)}},children:(0,S.jsxs)(l.A,{gutter:[16,16],children:[(0,S.jsx)(o.A,{span:24,children:(0,S.jsx)(Ce.A.Item,{name:"purpose",label:"Purpose",rules:[{required:!0,message:"Please enter the purpose"}],children:(0,S.jsx)(c.A.TextArea,{rows:4,placeholder:"Enter the purpose of your request"})})}),h.map((e,t)=>(0,S.jsx)(o.A,{xs:24,sm:12,children:(0,S.jsx)(Ce.A.Item,{name:["fields",e],label:e,rules:[{required:!0,message:"Please enter ".concat(e)}],children:/date|dob|birth|issued/i.test(e)?(0,S.jsx)(Rt.A,{style:{width:"100%"},format:"MM/DD/YYYY"}):(0,S.jsx)(c.A,{placeholder:"Enter ".concat(e)})})},t)),(0,S.jsx)(o.A,{span:24,style:{textAlign:"right"},children:(0,S.jsxs)(X.A,{children:[(0,S.jsx)(u.Ay,{onClick:()=>x(!1),children:"Cancel"}),(0,S.jsx)(u.Ay,{type:"primary",htmlType:"submit",loading:z,children:"Submit Request"})]})})]})})}),(0,S.jsxs)(_.A,{title:"Account Verification",open:M,onCancel:()=>W(!1),onOk:async()=>{if(Y.length<1)return void i.Ay.warning("Please select at least one ID to upload");const e=new FormData;Y.slice(0,2).forEach((t,n)=>e.append("ids",t.originFileObj||t));try{const a=await fetch("/api/verification/upload",{method:"POST",body:e,credentials:"include"});if(!a.ok)throw new Error(await a.text());await a.json();i.Ay.success("Verification documents uploaded. Admin will review shortly."),W(!1);try{const{authService:e}=await Promise.resolve().then(n.bind(n,31694)),t=await e.getCurrentUser();t&&K&&K(t)}catch(t){}}catch(a){console.error("Upload error",a),i.Ay.error("Upload failed")}},okText:"Upload",width:600,children:[(0,S.jsx)("p",{children:"Please upload up to two valid government IDs to verify your account. Admin will review and approve."}),(0,S.jsx)(T.A,{multiple:!0,accept:"image/*,application/pdf",beforeUpload:()=>!1,fileList:Y,onChange:e=>{let{fileList:t}=e;return H(t)},maxCount:2,children:(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(q.A,{}),children:"Select ID files (max 2)"})})]})]})};var Cn=n(64376),kn=n(20691),Nn=n(93795);const{TextArea:Tn}=c.A,Dn=[{label:"Requests",options:[{value:"DOCUMENT_REQUEST",label:"Document Request"},{value:"SCHEDULE_APPOINTMENT",label:"Schedule Appointment"},{value:"CERTIFICATE_REQUEST",label:"Certificate Request"}]},{label:"Concerns",options:[{value:"COMPLAINT",label:"Complaint"},{value:"ASSISTANCE",label:"Assistance"}]}],Pn=()=>{const{user:e}=V(),[t,n]=(0,s.useState)(!1),[a,m]=(0,s.useState)(!1),[p]=Ce.A.useForm(),[x,g]=s.useState(0),[f,y]=s.useState(0),j=100,v=500,[b,I]=s.useState(0),[C,N]=s.useState([]),[D,P]=s.useState(!1),[R,B]=s.useState(null),L="inquiryFormDraft_v1";s.useEffect(()=>{try{const e=localStorage.getItem(L);if(e){const t=JSON.parse(e);if(t){const{type:e,assignedRole:n,subject:a,message:s,attachments:i}=t;if(p.setFieldsValue({type:e,assignedRole:n,subject:a,message:s}),a&&g(a.length),s&&y(s.length),i&&Array.isArray(i)&&i.length){const e=i.map((e,t)=>({uid:"restored-".concat(t),name:e}));N(e),p.setFieldsValue({attachment:e})}a&&s&&(n||e)?I(2):i&&i.length?I(1):I(0)}}}catch(e){console.warn("Failed to load inquiry draft",e)}},[]),s.useEffect(()=>{const e=()=>{try{const e=p.getFieldsValue(!0),t={type:e.type||null,assignedRole:e.assignedRole||null,subject:e.subject||"",message:e.message||"",attachments:(C||[]).map(e=>e.name||e.originFileObj&&e.originFileObj.name||""),updatedAt:(new Date).toISOString()};localStorage.setItem(L,JSON.stringify(t))}catch(e){console.warn("Failed to save draft",e)}},t=setInterval(e,5e3),n=()=>e();return window.addEventListener("beforeunload",n),()=>{clearInterval(t),window.removeEventListener("beforeunload",n);try{const e=p.getFieldsValue(!0),t={type:e.type||null,assignedRole:e.assignedRole||null,subject:e.subject||"",message:e.message||"",attachments:(C||[]).map(e=>e.name||e.originFileObj&&e.originFileObj.name||""),updatedAt:(new Date).toISOString()};localStorage.setItem(L,JSON.stringify(t))}catch(e){}}},[C]);const O=e=>{if(0===e)return"0 B";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["B","KB","MB","GB"][t]},z=async t=>{n(!0),m(!1);try{let n=[];t.attachment&&(Array.isArray(t.attachment)?n=t.attachment:t.attachment.fileList&&Array.isArray(t.attachment.fileList)&&(n=t.attachment.fileList));const a=new FormData;if(a.append("type",t.type||""),a.append("subject",t.subject||""),a.append("message",t.message||""),a.append("assignedRole",t.assignedRole||"staff"),a.append("username",(null===e||void 0===e?void 0:e.username)||""),a.append("barangayID",(null===e||void 0===e?void 0:e.barangayID)||""),t.assignedTo&&Array.isArray(t.assignedTo))for(const e of t.assignedTo)a.append("assignedTo[]",e);for(const e of n)e.originFileObj&&a.append("attachments",e.originFileObj,e.name||e.originFileObj&&e.originFileObj.name);await k.contactAPI.submitInquiry(a),m(!0),p.resetFields(),N([]),localStorage.removeItem(L),i.Ay.success("Your inquiry has been submitted!")}catch(a){console.error(a),i.Ay.error("Failed to submit inquiry.")}finally{n(!1)}},F=e=>{i.Ay.error("Please complete all required fields")};return(0,S.jsx)("div",{style:{maxWidth:900,margin:"32px auto",padding:"0 12px"},children:(0,S.jsxs)(r.A,{style:{borderRadius:18,boxShadow:"0 4px 24px 0 rgba(64,201,255,0.10)",padding:0,background:"#fff"},headStyle:{borderRadius:"18px 18px 0 0",background:"linear-gradient(90deg, rgba(64,169,255,0.08) 0%, rgba(146,84,222,0.06) 100%)",padding:"16px 24px"},bodyStyle:{padding:24},bordered:!1,title:(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12},children:[(0,S.jsx)(st.A,{style:{fontSize:28,color:"#1890ff"}}),(0,S.jsxs)("div",{style:{lineHeight:1},children:[(0,S.jsx)(h.A.Title,{level:4,style:{margin:0,color:"#1890ff",fontWeight:700,fontFamily:"Poppins, Arial, sans-serif"},children:"Submit an Inquiry"}),(0,S.jsx)("div",{style:{fontSize:12,color:"#6c757d",marginTop:4},children:"Fill out the form below and our staff will get back to you."})]})]}),children:[a&&(0,S.jsx)(Ht.A,{type:"success",showIcon:!0,message:(0,S.jsxs)("span",{style:{fontWeight:600},children:[(0,S.jsx)("span",{role:"img","aria-label":"success",children:"\u2705"})," Your inquiry has been submitted!"]}),style:{marginBottom:16,borderRadius:8},banner:!0}),(0,S.jsxs)(Ce.A,{form:p,layout:"vertical",onFinish:z,onFinishFailed:F,autoComplete:"off",onFieldsChange:()=>a&&m(!1),onValuesChange:(e,t)=>{t&&t.attachment&&t.attachment.length>0?I(1):t&&t.message&&t.message.length>0&&I(0),t&&t.subject&&t.message&&(t.assignedRole||t.type)&&I(2)},children:[(0,S.jsx)("div",{style:{marginBottom:16},children:(0,S.jsxs)(Cn.A,{current:b,size:"small",children:[(0,S.jsx)(Cn.A.Step,{title:"Details"}),(0,S.jsx)(Cn.A.Step,{title:"Attachments"}),(0,S.jsx)(Cn.A.Step,{title:"Review & Submit"})]})}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsxs)(o.A,{xs:24,sm:12,children:[(0,S.jsx)(Ce.A.Item,{name:"type",label:(0,S.jsxs)("span",{children:["Inquiry Type ",(0,S.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,S.jsx)(A.A,{title:"Choose the category that best describes your issue.",children:(0,S.jsx)(Nn.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),rules:[{required:!0,message:"Please select an inquiry type"}],children:(0,S.jsx)(d.A,{placeholder:"Select inquiry type",className:"inquiry-rounded-input",children:Dn.map(e=>(0,S.jsx)(d.A.OptGroup,{label:e.label,children:e.options.map(e=>(0,S.jsx)(d.A.Option,{value:e.value,children:e.label},e.value))},e.label))})}),(0,S.jsx)(Ce.A.Item,{name:"assignedRole",label:(0,S.jsxs)("span",{children:["Assign to Role ",(0,S.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,S.jsx)(A.A,{title:"Select which role should handle your inquiry.",children:(0,S.jsx)(Nn.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),initialValue:"staff",rules:[{required:!0,message:"Please select a role to assign"}],children:(0,S.jsx)(d.A,{options:[{value:"staff",label:"Staff"},{value:"admin",label:"Admin"}],placeholder:"Assign to role",className:"inquiry-rounded-input"})}),(0,S.jsx)(Ce.A.Item,{name:"subject",label:(0,S.jsxs)("span",{children:["Subject ",(0,S.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,S.jsx)(A.A,{title:"Enter a short subject line.",children:(0,S.jsx)(Nn.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),rules:[{required:!0,message:"Please enter a subject"},{min:5,message:"Subject must be at least 5 characters"},{max:j,message:"Subject must be at most ".concat(j," characters")}],children:(0,S.jsxs)("div",{children:[(0,S.jsx)(c.A,{placeholder:"Enter subject",className:"inquiry-rounded-input",maxLength:120,onChange:e=>g(e.target.value.length)}),(0,S.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:6},children:(0,S.jsxs)("small",{style:{color:x>j?"red":"#8c8c8c"},children:[x,"/",j]})})]})})]}),(0,S.jsxs)(o.A,{xs:24,sm:12,children:[(0,S.jsx)(Ce.A.Item,{name:"message",label:(0,S.jsxs)("span",{children:["Message ",(0,S.jsx)("span",{style:{color:"red"},children:"*"})," ",(0,S.jsx)(A.A,{title:"Provide details about your inquiry.",children:(0,S.jsx)(Nn.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),rules:[{required:!0,message:"Please enter your message"},{min:10,message:"Message must be at least 10 characters"},{max:v,message:"Message must be at most ".concat(v," characters")}],children:(0,S.jsxs)("div",{children:[(0,S.jsx)(Tn,{rows:4,placeholder:"Enter your message",className:"inquiry-rounded-input inquiry-large-textarea",maxLength:550,onChange:e=>y(e.target.value.length)}),(0,S.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:6},children:(0,S.jsxs)("small",{style:{color:f>v?"red":"#8c8c8c"},children:[f,"/",v]})})]})}),(0,S.jsxs)(Ce.A.Item,{name:"attachment",label:(0,S.jsxs)("span",{children:["Attachments"," ",(0,S.jsx)(A.A,{title:"Attach supporting documents (PDF, JPG, PNG).",children:(0,S.jsx)(Nn.A,{style:{marginLeft:6,color:"#8c8c8c"}})})]}),valuePropName:"fileList",getValueFromEvent:e=>Array.isArray(e)?e:e&&e.fileList,extra:"Allowed: PDF, JPG, PNG. Max 5MB each.",children:[(0,S.jsxs)(T.A.Dragger,{multiple:!0,accept:".pdf,.jpg,.jpeg,.png",fileList:C,beforeUpload:()=>!1,onChange:e=>{const t=e.fileList||[],n=[];t.forEach(e=>{const t=e.originFileObj||e,a=["application/pdf","image/jpeg","image/png"].includes(t.type)||t.name&&/\.(pdf|jpe?g|png)$/i.test(t.name),s=(t.size||0)/1024/1024<5;if(a)if(s){if(t.type&&t.type.startsWith("image/")&&!e.url&&!e.preview)try{const n=URL.createObjectURL(t);e.preview=n}catch(r){}n.push(e)}else i.Ay.error("".concat(t.name," must be smaller than 5MB"));else i.Ay.error("".concat(t.name," is not a supported file type"))}),N(n),p.setFieldsValue({attachment:n})},onPreview:async e=>{const t=e,n=t.url||t.preview||t.originFileObj&&URL.createObjectURL(t.originFileObj);n&&window.open(n,"_blank")},showUploadList:!1,children:[(0,S.jsx)("p",{className:"ant-upload-drag-icon",children:(0,S.jsx)(q.A,{})}),(0,S.jsx)("p",{className:"ant-upload-text",children:"Drag files here or click to upload"}),(0,S.jsx)("p",{className:"ant-upload-hint",children:"Support for multiple files. Each must be PDF, JPG, or PNG, and under 5MB."})]}),C&&C.length>0&&(0,S.jsx)("div",{style:{marginTop:12},children:C.map(e=>{const t=e.name||e.originFileObj&&e.originFileObj.name||"file",n=e.size||e.originFileObj&&e.originFileObj.size||0,a=e.type&&e.type.startsWith("image/")||/\.(jpe?g|png)$/i.test(t),s="application/pdf"===e.type||/\.pdf$/i.test(t);return(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:12,padding:"8px 12px",border:"1px solid #f0f0f0",borderRadius:8,marginBottom:8},children:[(0,S.jsx)("div",{style:{width:48,height:48,display:"flex",alignItems:"center",justifyContent:"center",background:"#fafafa",borderRadius:6},children:a?(0,S.jsx)("img",{src:e.preview||e.originFileObj&&URL.createObjectURL(e.originFileObj),alt:t,style:{maxWidth:44,maxHeight:44,borderRadius:4}}):s?(0,S.jsx)("div",{style:{fontSize:20,color:"#ff4d4f"},children:"PDF"}):(0,S.jsx)("div",{style:{fontSize:20},children:"FILE"})}),(0,S.jsxs)("div",{style:{flex:1},children:[(0,S.jsx)("div",{style:{fontWeight:600},children:t}),(0,S.jsx)("div",{style:{color:"#8c8c8c",fontSize:12},children:O(n)})]}),(0,S.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,S.jsx)(u.Ay,{type:"link",onClick:()=>{const t=e.url||e.preview||e.originFileObj&&URL.createObjectURL(e.originFileObj);t&&window.open(t,"_blank")},children:"Preview"}),(0,S.jsx)(u.Ay,{type:"link",danger:!0,onClick:()=>{const t=C.filter(t=>t.uid!==e.uid&&t.name!==e.name);N(t),p.setFieldsValue({attachment:t})},children:"Remove"})]})]},e.uid||e.name)})})]})]})]}),(0,S.jsx)(Ce.A.Item,{children:(0,S.jsxs)(l.A,{justify:"end",gutter:[8,8],children:[(0,S.jsx)(o.A,{xs:24,sm:"auto",style:{display:"flex",justifyContent:"flex-end"},children:(0,S.jsx)(u.Ay,{type:"default",onClick:()=>{p.resetFields(),g(0),y(0),N([]),localStorage.removeItem(L)},block:!0,icon:(0,S.jsx)(Lt.A,{}),style:{borderRadius:8,minWidth:120},children:"Reset"})}),(0,S.jsx)(o.A,{xs:24,sm:"auto",style:{display:"flex",justifyContent:"flex-end"},children:(0,S.jsx)(u.Ay,{type:"primary",loading:t,className:"inquiry-gradient-btn",block:!0,icon:(0,S.jsx)(w.A,{}),style:{borderRadius:8,fontWeight:600,fontSize:16,minWidth:160},onClick:async()=>{try{const e=await p.validateFields();B(e),P(!0)}catch(e){F()}},children:"Submit Inquiry"})})]})})]}),(0,S.jsx)(_.A,{title:"Review your inquiry",open:D,onCancel:()=>P(!1),footer:[(0,S.jsx)(u.Ay,{onClick:()=>P(!1),children:"Edit"},"edit"),(0,S.jsx)(u.Ay,{type:"primary",onClick:async()=>{P(!1),await z(R)},children:"Confirm & Submit"},"confirm")],children:R&&(0,S.jsxs)(kn.A,{column:1,bordered:!0,children:[(0,S.jsx)(kn.A.Item,{label:"Inquiry Type",children:R.type}),(0,S.jsx)(kn.A.Item,{label:"Assign to Role",children:R.assignedRole}),(0,S.jsx)(kn.A.Item,{label:"Subject",children:R.subject}),(0,S.jsx)(kn.A.Item,{label:"Message",children:R.message}),(0,S.jsx)(kn.A.Item,{label:"Attachments",children:(C||[]).map(e=>e.name||e.originFileObj&&e.originFileObj.name).join(", ")})]})})]})})},Rn=()=>{const e=(0,L.Zp)();return(0,S.jsxs)("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",background:"#f4f6fa"},children:[(0,S.jsx)("h1",{style:{color:"#722ed1",fontWeight:700,fontSize:32},children:"You have been logged out"}),(0,S.jsx)("p",{style:{fontSize:18,margin:"16px 0 32px"},children:"Thank you for using the Barangay Information System."}),(0,S.jsx)(u.Ay,{type:"primary",size:"large",onClick:()=>e("/login",{replace:!0}),children:"Log In Again"})]})},qn=()=>{const{logout:e}=V(),t=(0,L.Zp)();return(0,s.useEffect)(()=>{e(),t("/login",{replace:!0})},[e,t]),null};var Bn=n(59977);const Ln=()=>{const[e,t]=(0,s.useState)(!1),[n,a]=(0,s.useState)([]),[i,r]=(0,s.useState)(null),[l,o]=(0,s.useState)(null),[c,m]=(0,s.useState)(null),x=(0,L.Zp)();(0,s.useEffect)(()=>{(async()=>{t(!0);try{const e=await k.contactAPI.getAllInquiries();a(Array.isArray(e)?e:e&&e.items?e.items:[])}catch(e){console.error("Failed to load inquiries",e),ot.Ay.error({message:"Failed to load inquiries"}),a([])}finally{t(!1)}})()},[]);const g=(0,s.useMemo)(()=>Array.from(new Set(n.map(e=>e.type||"General"))),[n]),y=(0,s.useMemo)(()=>(n||[]).filter(e=>{if(i&&(!e.status||e.status.toString().toLowerCase()!==i.toLowerCase()))return!1;const t=e.type||"General";if(l&&t.toString().toLowerCase()!==l.toString().toLowerCase())return!1;if(c&&c[0]&&c[1]&&e.createdAt)try{const t=c[0].toDate?c[0].toDate():new Date(c[0]),n=c[1].toDate?c[1].toDate():new Date(c[1]),a=new Date(e.createdAt);if(a<t||a>n)return!1}catch(n){}return!0}),[n,i,l,c]);return(0,S.jsxs)("div",{children:[(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",marginBottom:12},children:[(0,S.jsx)(h.A.Title,{level:4,style:{margin:0},children:"Inquiry Tracker"}),(0,S.jsxs)(h.A.Text,{type:"secondary",children:["Showing ",n.length," records"]})]}),(0,S.jsxs)(p.A,{spinning:e,children:[(0,S.jsx)("div",{style:{marginBottom:12,display:"flex",justifyContent:"flex-end"},children:(0,S.jsxs)(X.A,{children:[(0,S.jsxs)(d.A,{allowClear:!0,placeholder:"Status",style:{width:160},value:null!==i&&void 0!==i?i:void 0,onChange:e=>r(e||null),children:[(0,S.jsx)(d.A.Option,{value:"open",children:"Open"}),(0,S.jsx)(d.A.Option,{value:"in-progress",children:"In Progress"}),(0,S.jsx)(d.A.Option,{value:"resolved",children:"Resolved"})]}),(0,S.jsx)(d.A,{allowClear:!0,placeholder:"Type",style:{width:180},value:null!==l&&void 0!==l?l:void 0,onChange:e=>o(e||null),children:g.map(e=>(0,S.jsx)(d.A.Option,{value:e,children:e},e))}),(0,S.jsx)(Rt.A.RangePicker,{onChange:e=>m(e?e.filter(Boolean):null)}),(0,S.jsx)(u.Ay,{onClick:()=>{r(null),o(null),m(null)},children:"Reset"})]})}),0!==y.length||e?(0,S.jsxs)(nt.A,{dataSource:y.slice().sort((e,t)=>(new Date(t.createdAt).getTime()||0)-(new Date(e.createdAt).getTime()||0)),rowKey:e=>e._id,pagination:{pageSize:12},onRow:e=>({onClick:()=>{x("/staff/inbox",{state:{openInquiryId:e._id}})}}),children:[(0,S.jsx)(nt.A.Column,{title:"Name",dataIndex:"username",render:(e,t)=>e||t.residentName||t.subject||"Unknown"},"username"),(0,S.jsx)(nt.A.Column,{title:"Type of Inquiry",dataIndex:"type",render:e=>e?String(e):"General"},"type"),(0,S.jsx)(nt.A.Column,{title:"Status",dataIndex:"status",render:e=>(e=>{const t=(e||"").toString().toLowerCase();return(0,S.jsx)(f.A,{color:{pending:"gold",open:"gold",approved:"success",resolved:"green",rejected:"error"}[t]||"default",children:(e||"").toUpperCase()||"UNKNOWN"})})(e)},"status"),(0,S.jsx)(nt.A.Column,{title:"Date Inquired",dataIndex:"createdAt",render:e=>(0,Bn.Y)(e)},"createdAt"),(0,S.jsx)(nt.A.Column,{title:"Date Resolved",dataIndex:"updatedAt",render:(e,t)=>t.status&&"resolved"===t.status.toString().toLowerCase()?(0,Bn.Y)(e):""},"updatedAt")]}):(0,S.jsx)(ct.A,{description:"No inquiries"})]})]})};var On=n(74117);const _n=e=>{let{visible:t,onClose:n,onCreated:a,defaultBarangayID:r,defaultUsername:l,defaultEmail:o}=e;const[d]=Ce.A.useForm(),[u,h]=s.useState(!1);s.useEffect(()=>{t?d.setFieldsValue({barangayID:r||void 0,username:l||void 0,email:o||void 0}):d.resetFields()},[t,r,l,o,d]);return(0,S.jsx)(_.A,{title:"Create Resident Info",visible:t,onOk:async()=>{try{const e=await d.validateFields();h(!0);const t={firstName:e.firstName,lastName:e.lastName,barangayID:r||e.barangayID||"",username:l||e.username||"",email:o||e.email||""},s=await en.A.put("/api/resident/personal-info",t);i.Ay.success("Resident container created"),a(s.data),d.resetFields(),n()}catch(s){var e,t;console.error("Failed to create resident container",s),null!==s&&void 0!==s&&null!==(e=s.response)&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.message?i.Ay.error(s.response.data.message):i.Ay.error("Failed to create resident container")}finally{h(!1)}},onCancel:()=>{d.resetFields(),n()},confirmLoading:u,children:(0,S.jsxs)(Ce.A,{form:d,layout:"vertical",children:[(0,S.jsx)(Ce.A.Item,{name:"firstName",label:"First name",rules:[{required:!0,message:"First name is required"}],children:(0,S.jsx)(c.A,{})}),(0,S.jsx)(Ce.A.Item,{name:"lastName",label:"Last name",rules:[{required:!0,message:"Last name is required"}],children:(0,S.jsx)(c.A,{})}),(0,S.jsx)(Ce.A.Item,{name:"barangayID",label:"Barangay ID",children:(0,S.jsx)(c.A,{disabled:!0})}),(0,S.jsx)(Ce.A.Item,{name:"username",label:"Username",children:(0,S.jsx)(c.A,{disabled:!0})}),(0,S.jsx)(Ce.A.Item,{name:"email",label:"Email",rules:[{type:"email",message:"Invalid email"}],children:(0,S.jsx)(c.A,{disabled:!0})})]})})};function zn(){const[e,t]=(0,s.useState)(null),[n,m]=(0,s.useState)(!1),[p,x]=(0,s.useState)(!1),{setUser:g}=V(),{t:f,i18n:y}=(0,On.Bd)(),[A,j]=(0,s.useState)(null),[v,b]=(0,s.useState)([]),[w,I]=(0,s.useState)(!1),[C,N]=(0,s.useState)(null),[D,P]=(0,s.useState)(!1),[R,B]=(0,s.useState)(!1),[L,O]=(0,s.useState)(!1),[_,z]=(0,s.useState)(!1),[F,E]=(0,s.useState)(null),[U,M]=(0,s.useState)(null),[W,Y]=(0,s.useState)("");(0,s.useEffect)(()=>{en.A.get("/api/resident/profile").then(e=>{var n;if(j(e.data),N(e.data),null!==(n=e.data)&&void 0!==n&&n.profileImage){const n=e.data.profileImage.startsWith("http")?e.data.profileImage:"".concat(window.location.origin).concat(e.data.profileImage);t(n)}}),k.residentPersonalInfoAPI.getPersonalInfo().then(e=>{if(E(e),M(e),null!==e&&void 0!==e&&e.profileImage){const n=e.profileImage.startsWith("http")?e.profileImage:"".concat(window.location.origin).concat(e.profileImage);t(n)}}).catch(e=>{e.response&&404===e.response.status&&(m(!0),E(null),M({firstName:"",lastName:"",age:void 0,birthDate:"",dateOfResidency:"",sex:"",civilStatus:"",facebook:"",email:"",contactNumber:"",emergencyContact:"",landlineNumber:"",spouseName:"",spouseAge:void 0,spouseBirthDate:"",spouseOccupation:"",spouseStatus:"",motherName:"",motherAge:void 0,motherBirthDate:"",motherOccupation:"",motherStatus:"",fatherName:"",fatherAge:void 0,fatherBirthDate:"",fatherOccupation:"",fatherStatus:""}))}),en.A.get("/api/resident/requests").then(e=>{b(e.data)})},[]),(0,s.useEffect)(()=>{const e=()=>{const e=(new Date).toLocaleString("en-US",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(/,/g,"");Y(e)};e();const t=setInterval(e,1e3);return()=>clearInterval(t)},[]);const H=e=>{C&&N((0,a.A)((0,a.A)({},C),{},{[e.target.name]:e.target.value}))},G=e=>{U&&M((0,a.A)((0,a.A)({},U),{},{[e.target.name]:e.target.value}))};return(0,S.jsxs)("div",{className:"max-w-3xl mx-auto p-6",children:[(0,S.jsxs)(r.A,{style:{background:"linear-gradient(90deg, #f7f8fa 0%, #e0e7ff 100%)",borderRadius:16,boxShadow:"0 4px 24px #40c9ff22",marginBottom:32,border:"none",padding:0},styles:{body:{padding:"24px 32px",display:"flex",alignItems:"center",justifyContent:"space-between"}},variant:"outlined",children:[(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:18},children:[(0,S.jsx)("div",{style:{width:96,height:96,borderRadius:12,overflow:"hidden",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center"},children:e?(0,S.jsx)("img",{src:e,alt:"avatar",style:{width:96,height:96,objectFit:"cover"}}):(0,S.jsx)(xe,{user:(()=>{let e=A;if(!e)try{const t=localStorage.getItem("userProfile");t&&(e=JSON.parse(t))}catch(t){}return e})(),size:96})}),(0,S.jsxs)("div",{children:[(0,S.jsx)(h.A.Title,{level:3,style:{margin:0,fontWeight:800},children:(null===A||void 0===A?void 0:A.username)||(null===A||void 0===A?void 0:A.email)||"Resident"}),(0,S.jsxs)(h.A.Text,{type:"secondary",children:["Barangay ID: ",(null===A||void 0===A?void 0:A.barangayID)||"N/A"]}),(0,S.jsx)("div",{style:{marginTop:8},children:(0,S.jsx)(h.A.Text,{type:"secondary",children:W})})]})]}),(0,S.jsx)("div",{children:(0,S.jsx)(T.A,{showUploadList:!1,accept:"image/*",customRequest:async e=>{let{file:n,onSuccess:a,onError:s}=e;try{await(async e=>{if(!e)return;const n=new FileReader;n.onload=e=>{var n;return t(null===(n=e.target)||void 0===n?void 0:n.result)},n.readAsDataURL(e);const a=new FormData;a.append("avatar",e);try{var s,r;const e=await en.A.post("/api/resident/personal-info/avatar",a,{headers:{"Content-Type":"multipart/form-data"}}),n=null===(s=e.data)||void 0===s?void 0:s.resident,o=null===(r=e.data)||void 0===r?void 0:r.user;if(n){if(E(n),M(n),n.profileImage){const e=n.profileImage.startsWith("http")?n.profileImage:"".concat(window.location.origin).concat(n.profileImage);t(e)}m(!1),i.Ay.success("Profile image updated")}else i.Ay.success("Profile image updated");if(o){try{"function"===typeof g?g(o):localStorage.setItem("userProfile",JSON.stringify(o))}catch(l){}try{const e=new CustomEvent("userProfileUpdated",{detail:o});window.dispatchEvent(e)}catch(l){}}}catch(l){i.Ay.error("Failed to upload avatar")}})(n),"function"===typeof a&&a("ok")}catch(r){"function"===typeof s&&s(r)}},children:(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(q.A,{}),children:"Replace / Upload Profile Picture"})})})]}),n&&(0,S.jsx)("div",{style:{marginBottom:16},children:(0,S.jsx)(Ht.A,{message:"Your resident profile is incomplete",description:(0,S.jsxs)("div",{children:[(0,S.jsx)("p",{children:"We couldn't find your resident information. Please create your resident profile so you can upload documents and profile pictures."}),(0,S.jsx)(u.Ay,{type:"primary",onClick:()=>x(!0),children:"Create Resident Info"})]}),showIcon:!0})}),(0,S.jsx)(_n,{visible:p,onClose:()=>x(!1),onCreated:e=>{E(e),M(e),m(!1)},defaultBarangayID:(null===A||void 0===A?void 0:A.barangayID)||"",defaultUsername:(null===A||void 0===A?void 0:A.username)||"",defaultEmail:(null===A||void 0===A?void 0:A.email)||""}),(0,S.jsx)(r.A,{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e3e6f3 40%, #f6f1f7 100%)",borderRadius:20,boxShadow:"0 8px 32px #bfc7d6cc",marginBottom:32,border:"none",backdropFilter:"blur(2px)"},styles:{body:{padding:40}},variant:"outlined",children:(0,S.jsxs)("div",{style:{maxWidth:900,margin:"0 auto"},children:[(0,S.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:24,letterSpacing:1,textAlign:"left",fontSize:28,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:f("userInformation")}),C&&(0,S.jsxs)(Ce.A,{layout:"vertical",children:[(0,S.jsxs)(l.A,{gutter:24,children:[(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{label:f("username"),children:(0,S.jsx)(c.A,{name:"username",value:C.username,onChange:H,disabled:!L})})}),(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{label:f("email"),children:(0,S.jsx)(c.A,{name:"email",value:C.email,onChange:H,disabled:!L})})})]}),(0,S.jsxs)(l.A,{gutter:24,children:[(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{label:f("address"),children:(0,S.jsx)(c.A,{name:"address",value:C.address,onChange:H,disabled:!L})})}),(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{label:f("contactNumber"),children:(0,S.jsx)(c.A,{name:"contactNumber",value:C.contactNumber,onChange:H,disabled:!L})})})]}),(0,S.jsxs)(l.A,{gutter:24,children:[(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{label:f("barangayID")||"Barangay ID",children:(0,S.jsx)(c.A,{name:"barangayID",value:C.barangayID,disabled:!0})})}),(0,S.jsx)(o.A,{span:12,children:(0,S.jsx)(Ce.A.Item,{label:f("role")||"Role",children:(0,S.jsx)(c.A,{name:"role",value:C.role,disabled:!0})})})]}),(0,S.jsxs)(X.A,{style:{marginTop:24},children:[L?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(u.Ay,{type:"primary",onClick:async()=>{if(C)try{const e=(()=>{let e=C.firstName||"",t=C.lastName||"";if((!e||!t)&&A&&A.fullName){const n=A.fullName.trim().split(" ");e=e||n[0]||"",t=t||(n.length>1?n.slice(1).join(" "):"")}return e=e||(null===A||void 0===A?void 0:A.username)||(null===A||void 0===A?void 0:A.email)||"Resident",t=t||"User",{first:e,last:t}})(),t={firstName:e.first,lastName:e.last,barangayID:(null===C||void 0===C?void 0:C.barangayID)||(null===A||void 0===A?void 0:A.barangayID)||"",email:(null===C||void 0===C?void 0:C.email)||(null===A||void 0===A?void 0:A.email)||"",contactNumber:(null===C||void 0===C?void 0:C.contactNumber)||(null===A||void 0===A?void 0:A.contactNumber)||"",address:(null===C||void 0===C?void 0:C.address)||(null===A||void 0===A?void 0:A.address)||""},n=await en.A.put("/api/resident/personal-info",t);n&&n.data?j((0,a.A)((0,a.A)({},A),n.data)):j((0,a.A)((0,a.A)({},A),t)),O(!1),i.Ay.success("Profile saved")}catch(e){if(console.error("Failed to save user info:",e),null!==e&&void 0!==e&&e.response&&e.response.data){const t=e.response.data;if(t.errors){const e=Object.values(t.errors).map(e=>e.toString()).join("; ");i.Ay.error(e||t.message||"Validation error")}else i.Ay.error(t.message||"Failed to save")}else i.Ay.error("Failed to save user info")}},style:{background:"linear-gradient(90deg, #43e97b 0%, #38f9d7 100%)",border:"none",fontWeight:600},children:"Save"}),(0,S.jsx)(u.Ay,{onClick:()=>{O(!1),N(A)},children:"Cancel"})]}):(0,S.jsx)(u.Ay,{onClick:()=>O(!0),style:{fontWeight:600},children:"Edit"}),(0,S.jsx)(u.Ay,{type:"dashed",onClick:async()=>{B(!0);try{var e;const t=await en.A.post("/api/resident/request-staff-access"),n=(null===t||void 0===t||null===(e=t.data)||void 0===e?void 0:e.message)||"Request sent to admin for staff access";!t||200!==t.status&&201!==t.status?i.Ay.info(n):(i.Ay.success(n),P(!0))}catch(a){var t,n;console.error("Request staff access failed:",a);const e=a,s=(null===e||void 0===e||null===(t=e.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||(null===e||void 0===e?void 0:e.message)||"Failed to send staff access request";i.Ay.error(s)}finally{B(!1)}},disabled:D||R,style:{color:"#341f97",borderColor:"#341f97",fontWeight:600},children:D?"Request Sent":"Request Staff Access"})]})]})]})}),U&&(0,S.jsx)(r.A,{style:{background:"linear-gradient(135deg, #f8fafc 0%, #e3e6f3 40%, #f6f1f7 100%)",borderRadius:20,boxShadow:"0 8px 32px #bfc7d6cc",marginBottom:32,border:"none",backdropFilter:"blur(2px)"},styles:{body:{padding:40}},variant:"outlined",children:(0,S.jsxs)(Ce.A,{layout:"vertical",style:{maxWidth:900,margin:"0 auto"},children:[(0,S.jsx)(h.A.Title,{level:2,style:{fontWeight:900,marginBottom:24,letterSpacing:1,textAlign:"left",fontSize:34,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Resident Information"}),(0,S.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Personal Information"}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"First Name",children:(0,S.jsx)(c.A,{name:"firstName",value:U.firstName,onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Middle Name",children:(0,S.jsx)(c.A,{name:"middleName",value:U.middleName||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Last Name",children:(0,S.jsx)(c.A,{name:"lastName",value:U.lastName,onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Age",children:(0,S.jsx)(c.A,{name:"age",type:"number",value:U.age||"",onChange:G,disabled:!_})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Birth Date",children:(0,S.jsx)(c.A,{name:"birthDate",type:"date",value:U.birthDate||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Place of Birth",children:(0,S.jsx)(c.A,{name:"placeOfBirth",value:U.placeOfBirth||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Nationality",children:(0,S.jsx)(c.A,{name:"nationality",value:U.nationality||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Religion",children:(0,S.jsx)(c.A,{name:"religion",value:U.religion||"",onChange:G,disabled:!_})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Date of Residency",children:(0,S.jsx)(c.A,{name:"dateOfResidency",type:"date",value:U.dateOfResidency||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Sex",children:(0,S.jsxs)(d.A,{value:U.sex||"",onChange:e=>M(t=>t?(0,a.A)((0,a.A)({},t),{},{sex:e}):t),disabled:!_,children:[(0,S.jsx)(d.A.Option,{value:"",children:"Select"}),(0,S.jsx)(d.A.Option,{value:"Male",children:"Male"}),(0,S.jsx)(d.A.Option,{value:"Female",children:"Female"}),(0,S.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Blood Type",children:(0,S.jsx)(c.A,{name:"bloodType",value:U.bloodType||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Disability Status",children:(0,S.jsx)(c.A,{name:"disabilityStatus",value:U.disabilityStatus||"",onChange:G,disabled:!_})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Passport Number",children:(0,S.jsx)(c.A,{name:"passportNumber",value:U.passportNumber||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Government ID Number",children:(0,S.jsx)(c.A,{name:"governmentIdNumber",value:U.governmentIdNumber||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Occupation",children:(0,S.jsx)(c.A,{name:"occupation",value:U.occupation||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Educational Attainment",children:(0,S.jsx)(c.A,{name:"educationalAttainment",value:U.educationalAttainment||"",onChange:G,disabled:!_})})})]}),(0,S.jsx)(l.A,{gutter:16,children:(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Civil Status",children:(0,S.jsxs)(d.A,{value:U.civilStatus||"",onChange:e=>M(t=>t?(0,a.A)((0,a.A)({},t),{},{civilStatus:e}):t),disabled:!_,children:[(0,S.jsx)(d.A.Option,{value:"",children:"Select"}),(0,S.jsx)(d.A.Option,{value:"Single",children:"Single"}),(0,S.jsx)(d.A.Option,{value:"Married",children:"Married"}),(0,S.jsx)(d.A.Option,{value:"Widowed",children:"Widowed"}),(0,S.jsx)(d.A.Option,{value:"Divorced",children:"Divorced"}),(0,S.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,S.jsx)(d.A.Option,{value:"Annulled",children:"Annulled"}),(0,S.jsx)(d.A.Option,{value:"Domestic Partnership",children:"Domestic Partnership"}),(0,S.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})})}),(0,S.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Social Media Information"}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Facebook",children:(0,S.jsx)(c.A,{name:"facebook",value:U.facebook||"",onChange:G,disabled:!_,placeholder:"Facebook profile/link"})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Valid Email",children:(0,S.jsx)(c.A,{name:"email",type:"email",value:U.email||"",onChange:G,disabled:!_,placeholder:"Email address"})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Contact Number",children:(0,S.jsx)(c.A,{name:"contactNumber",type:"number",value:U.contactNumber||"",onChange:G,disabled:!_,placeholder:"Contact No."})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Emergency Contact",children:(0,S.jsx)(c.A,{name:"emergencyContact",type:"number",value:U.emergencyContact||"",onChange:G,disabled:!_,placeholder:"Emergency contact number"})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Landline Number",children:(0,S.jsx)(c.A,{name:"landlineNumber",type:"number",value:U.landlineNumber||"",onChange:G,disabled:!_,placeholder:"Landline number"})})})]}),(0,S.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Family Information"}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Spouse Name",children:(0,S.jsx)(c.A,{name:"spouseName",value:U.spouseName||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Spouse Middle Name",children:(0,S.jsx)(c.A,{name:"spouseMiddleName",value:U.spouseMiddleName||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Spouse Last Name",children:(0,S.jsx)(c.A,{name:"spouseLastName",value:U.spouseLastName||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Spouse Age",children:(0,S.jsx)(c.A,{name:"spouseAge",type:"number",value:U.spouseAge||"",onChange:G,disabled:!_})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Spouse Birthdate",children:(0,S.jsx)(c.A,{name:"spouseBirthDate",type:"date",value:U.spouseBirthDate||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Spouse Nationality",children:(0,S.jsx)(c.A,{name:"spouseNationality",value:U.spouseNationality||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Spouse Occupation",children:(0,S.jsx)(c.A,{name:"spouseOccupation",value:U.spouseOccupation||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Spouse Contact Number",children:(0,S.jsx)(c.A,{name:"spouseContactNumber",value:U.spouseContactNumber||"",onChange:G,disabled:!_})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Spouse Status",children:(0,S.jsxs)(d.A,{value:U.spouseStatus||"",onChange:e=>M(t=>t?(0,a.A)((0,a.A)({},t),{},{spouseStatus:e}):t),disabled:!_,children:[(0,S.jsx)(d.A.Option,{value:"",children:"Select status"}),(0,S.jsx)(d.A.Option,{value:"Alive",children:"Alive"}),(0,S.jsx)(d.A.Option,{value:"Deceased",children:"Deceased"}),(0,S.jsx)(d.A.Option,{value:"Unknown",children:"Unknown"}),(0,S.jsx)(d.A.Option,{value:"Missing",children:"Missing"}),(0,S.jsx)(d.A.Option,{value:"Abroad",children:"Abroad"}),(0,S.jsx)(d.A.Option,{value:"With Family",children:"With Family"}),(0,S.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,S.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Number of Children",children:(0,S.jsx)(c.A,{name:"numberOfChildren",type:"number",value:U.numberOfChildren||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Children's Names",children:(0,S.jsx)(c.A,{name:"childrenNames",value:U.childrenNames||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Children's Ages",children:(0,S.jsx)(c.A,{name:"childrenAges",value:U.childrenAges||"",onChange:G,disabled:!_})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Emergency Contact Name",children:(0,S.jsx)(c.A,{name:"emergencyContactName",value:U.emergencyContactName||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:6,children:(0,S.jsx)(Ce.A.Item,{label:"Emergency Contact Relationship",children:(0,S.jsx)(c.A,{name:"emergencyContactRelationship",value:U.emergencyContactRelationship||"",onChange:G,disabled:!_})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Mother's Name",children:(0,S.jsx)(c.A,{name:"motherName",value:U.motherName||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Mother's Age",children:(0,S.jsx)(c.A,{name:"motherAge",type:"number",value:U.motherAge||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Mother's Birthdate",children:(0,S.jsx)(c.A,{name:"motherBirthDate",type:"date",value:U.motherBirthDate||"",onChange:G,disabled:!_})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Mother's Occupation",children:(0,S.jsx)(c.A,{name:"motherOccupation",value:U.motherOccupation||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Mother's Status",children:(0,S.jsxs)(d.A,{value:U.motherStatus||"",onChange:e=>M(t=>t?(0,a.A)((0,a.A)({},t),{},{motherStatus:e}):t),disabled:!_,children:[(0,S.jsx)(d.A.Option,{value:"",children:"Select status"}),(0,S.jsx)(d.A.Option,{value:"Alive",children:"Alive"}),(0,S.jsx)(d.A.Option,{value:"Deceased",children:"Deceased"}),(0,S.jsx)(d.A.Option,{value:"Unknown",children:"Unknown"}),(0,S.jsx)(d.A.Option,{value:"Missing",children:"Missing"}),(0,S.jsx)(d.A.Option,{value:"Abroad",children:"Abroad"}),(0,S.jsx)(d.A.Option,{value:"With Family",children:"With Family"}),(0,S.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,S.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Father's Name",children:(0,S.jsx)(c.A,{name:"fatherName",value:U.fatherName||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Father's Age",children:(0,S.jsx)(c.A,{name:"fatherAge",type:"number",value:U.fatherAge||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Father's Birthdate",children:(0,S.jsx)(c.A,{name:"fatherBirthDate",type:"date",value:U.fatherBirthDate||"",onChange:G,disabled:!_})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Father's Occupation",children:(0,S.jsx)(c.A,{name:"fatherOccupation",value:U.fatherOccupation||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Father's Status",children:(0,S.jsxs)(d.A,{value:U.fatherStatus||"",onChange:e=>M(t=>t?(0,a.A)((0,a.A)({},t),{},{fatherStatus:e}):t),disabled:!_,children:[(0,S.jsx)(d.A.Option,{value:"",children:"Select status"}),(0,S.jsx)(d.A.Option,{value:"Alive",children:"Alive"}),(0,S.jsx)(d.A.Option,{value:"Deceased",children:"Deceased"}),(0,S.jsx)(d.A.Option,{value:"Unknown",children:"Unknown"}),(0,S.jsx)(d.A.Option,{value:"Missing",children:"Missing"}),(0,S.jsx)(d.A.Option,{value:"Abroad",children:"Abroad"}),(0,S.jsx)(d.A.Option,{value:"With Family",children:"With Family"}),(0,S.jsx)(d.A.Option,{value:"Separated",children:"Separated"}),(0,S.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})})]}),(0,S.jsx)(h.A.Title,{level:3,style:{fontWeight:900,marginBottom:16,letterSpacing:1,textAlign:"left",fontSize:24,background:"linear-gradient(90deg, #ffb347, #ff4e50)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Business Information"}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Business Name",children:(0,S.jsx)(c.A,{name:"businessName",value:U.businessName||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Business Type",children:(0,S.jsxs)(d.A,{value:U.businessType||"",onChange:e=>M(t=>t?(0,a.A)((0,a.A)({},t),{},{businessType:e}):t),disabled:!_,children:[(0,S.jsx)(d.A.Option,{value:"",children:"Select"}),(0,S.jsx)(d.A.Option,{value:"Sole Proprietorship",children:"Sole Proprietorship"}),(0,S.jsx)(d.A.Option,{value:"Partnership",children:"Partnership"}),(0,S.jsx)(d.A.Option,{value:"Corporation",children:"Corporation"}),(0,S.jsx)(d.A.Option,{value:"Cooperative",children:"Cooperative"}),(0,S.jsx)(d.A.Option,{value:"Other",children:"Other"})]})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Nature of Business",children:(0,S.jsx)(c.A,{name:"natureOfBusiness",value:U.natureOfBusiness||"",onChange:G,disabled:!_})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Business Address",children:(0,S.jsx)(c.A,{name:"businessAddress",value:U.businessAddress||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Date Established",children:(0,S.jsx)(c.A,{name:"dateEstablished",type:"date",value:U.dateEstablished||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"TIN",children:(0,S.jsx)(c.A,{name:"tin",value:U.tin||"",onChange:G,disabled:!_})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"DTI/SEC/CDA Registration No.",children:(0,S.jsx)(c.A,{name:"registrationNumber",value:U.registrationNumber||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Business Permit No.",children:(0,S.jsx)(c.A,{name:"businessPermitNumber",value:U.businessPermitNumber||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Barangay Clearance No.",children:(0,S.jsx)(c.A,{name:"barangayClearanceNumber",value:U.barangayClearanceNumber||"",onChange:G,disabled:!_})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Number of Employees",children:(0,S.jsx)(c.A,{name:"numberOfEmployees",type:"number",value:U.numberOfEmployees||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Capital Investment",children:(0,S.jsx)(c.A,{name:"capitalInvestment",type:"number",value:U.capitalInvestment||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Annual Gross Income",children:(0,S.jsx)(c.A,{name:"annualGrossIncome",type:"number",value:U.annualGrossIncome||"",onChange:G,disabled:!_})})})]}),(0,S.jsxs)(l.A,{gutter:16,children:[(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Contact Person",children:(0,S.jsx)(c.A,{name:"businessContactPerson",value:U.businessContactPerson||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Contact Number",children:(0,S.jsx)(c.A,{name:"businessContactNumber",value:U.businessContactNumber||"",onChange:G,disabled:!_})})}),(0,S.jsx)(o.A,{span:8,children:(0,S.jsx)(Ce.A.Item,{label:"Email Address",children:(0,S.jsx)(c.A,{name:"businessEmail",type:"email",value:U.businessEmail||"",onChange:G,disabled:!_})})})]}),(0,S.jsx)("div",{style:{display:"flex",gap:8,marginTop:16},children:_?(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(u.Ay,{type:"primary",onClick:async()=>{U&&null!==A&&void 0!==A&&A._id&&(await k.residentPersonalInfoAPI.updatePersonalInfo((0,a.A)((0,a.A)({},U),{},{userId:A._id})),E(U),z(!1))},style:{fontWeight:600},children:"Save"}),(0,S.jsx)(u.Ay,{onClick:()=>{z(!1),M(F)},children:"Cancel"})]}):(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(u.Ay,{onClick:()=>z(!0),style:{fontWeight:600,marginRight:8},children:"Edit"}),F&&F.barangayID?(0,S.jsx)(u.Ay,{type:"primary",disabled:!0,style:{fontWeight:600,background:"#b2bec3",border:"none"},children:"Registered"}):(0,S.jsx)(u.Ay,{type:"primary",style:{fontWeight:600},onClick:async()=>{try{const e=(0,a.A)({barangayID:(null===C||void 0===C?void 0:C.barangayID)||"",username:(null===C||void 0===C?void 0:C.username)||""},U);await en.A.post("/resident",e),alert("Resident registered successfully!")}catch(e){alert("Failed to register resident.")}},children:"Register"})]})})]})})]})}const Fn=()=>(0,S.jsx)("div",{className:"landing-bg",style:{minHeight:"100vh",background:"linear-gradient(135deg, #40c9ff 0%, #e81cff 100%)",display:"flex",alignItems:"center",justifyContent:"center",fontFamily:"Segoe UI, Roboto, Helvetica Neue, Arial, sans-serif"},children:(0,S.jsxs)("div",{className:"floating-box",style:{background:"rgba(255,255,255,0.95)",boxShadow:"0 8px 32px 0 rgba(64,201,255,0.15)",borderRadius:24,padding:"48px 32px",textAlign:"center",maxWidth:420,width:"100%",animation:"float 2s infinite ease-in-out alternate",display:"flex",flexDirection:"column",alignItems:"center"},children:[(0,S.jsx)("img",{src:"".concat("","/logo-parian2.png"),alt:"Barangay Logo",style:{width:80,marginBottom:24}}),(0,S.jsxs)("h1",{className:"responsive-system-title",style:{fontSize:"1.7rem",marginBottom:24,fontWeight:800,background:"linear-gradient(90deg, #40c9ff, #e81cff)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",letterSpacing:1,maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"pre-line",wordBreak:"break-word",textAlign:"center"},children:["Welcome to",(0,S.jsx)("br",{}),"Barangay Information Management System",(0,S.jsx)("br",{}),"Parian"]}),(0,S.jsx)("button",{className:"get-started-btn",style:{background:"linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",color:"#fff",border:"none",borderRadius:8,padding:"14px 40px",fontSize:"1.15rem",fontWeight:700,cursor:"pointer",boxShadow:"0 2px 8px #e81cff44",marginTop:8,transition:"background 0.2s"},onClick:()=>window.location.href="/login",onMouseOver:e=>e.currentTarget.style.background="linear-gradient(90deg, #40c9ff 0%, #e81cff 100%)",onMouseOut:e=>e.currentTarget.style.background="linear-gradient(90deg, #e81cff 0%, #40c9ff 100%)",children:"Get Started"})]})});var En=n(96603);const Un=()=>{const[e,t]=(0,s.useState)(!1),[n,a]=(0,s.useState)(!1),[i,l]=(0,s.useState)("link"),[o,d]=(0,s.useState)(null),[m,p]=(0,s.useState)(""),[x,g]=(0,s.useState)(!1),f=(0,L.Zp)();return(0,S.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:24},children:(0,S.jsxs)(r.A,{style:{width:420,borderRadius:12},children:[(0,S.jsx)(h.A.Title,{level:3,style:{textAlign:"center"},children:"Forgot Password"}),n?(0,S.jsx)("div",{children:"otp"===i?(0,S.jsxs)("div",{children:[(0,S.jsxs)(h.A.Paragraph,{children:["Enter the 6-digit code sent to ",(0,S.jsx)("strong",{children:o})]}),(0,S.jsx)("div",{style:{display:"flex",justifyContent:"center",marginBottom:12},children:Array.from({length:6}).map((e,t)=>(0,S.jsx)("div",{style:{width:40,height:48,margin:4,border:"1px solid #ddd",display:"flex",alignItems:"center",justifyContent:"center",fontSize:18},children:m[t]||""},t))}),(0,S.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:8,maxWidth:300,margin:"0 auto 12px"},children:[["1","2","3","4","5","6","7","8","9","0"].map(e=>(0,S.jsx)(u.Ay,{onClick:()=>(e=>{m.length>=6||p(t=>t+e)})(e),disabled:x,children:e},e)),(0,S.jsx)(u.Ay,{onClick:()=>p(e=>e.slice(0,-1)),disabled:x,children:"\u232b"}),(0,S.jsx)(u.Ay,{onClick:()=>p(""),disabled:x,children:"Clear"}),(0,S.jsx)(u.Ay,{type:"primary",onClick:async()=>{if(6===m.length){g(!0);try{var e;const t={token:m};o&&(t.email=o);const n=await en.A.post("/api/auth/verify-otp",t);ot.Ay.success({message:"If valid",description:(null===(e=n.data)||void 0===e?void 0:e.message)||"Check your email for the new temporary password."}),p(""),a(!1),d(null),f("/login")}catch(s){var t,n;const e=(null===s||void 0===s||null===(t=s.response)||void 0===t||null===(n=t.data)||void 0===n?void 0:n.message)||s.message||"Failed to verify code";ot.Ay.error({message:"Error",description:e})}finally{g(!1)}}else ot.Ay.error({message:"Enter code",description:"Please enter the 6-digit code."})},loading:x,disabled:x,children:"Verify"})]}),(0,S.jsx)(u.Ay,{type:"link",block:!0,onClick:()=>{a(!1),d(null)},children:"Back"})]}):(0,S.jsxs)("div",{children:[(0,S.jsx)(h.A.Paragraph,{children:"Check your email for password reset instructions."}),(0,S.jsx)(u.Ay,{type:"primary",block:!0,onClick:()=>f("/login"),children:"Back to login"})]})}):(0,S.jsxs)(Ce.A,{layout:"vertical",onFinish:async e=>{t(!0);try{var n;const t=await en.A.post("/api/auth/forgot-password",{email:e.email,mode:i});ot.Ay.success({message:"Request sent",description:(null===(n=t.data)||void 0===n?void 0:n.message)||"Check your email for instructions."}),a(!0),d(e.email)}catch(l){var s,r;const e=(null===l||void 0===l||null===(s=l.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||l.message||"Failed to send reset email";ot.Ay.error({message:"Error",description:e})}finally{t(!1)}},requiredMark:!1,children:[(0,S.jsx)(Ce.A.Item,{label:"Choose how to receive reset instructions",children:(0,S.jsxs)(En.Ay.Group,{value:i,onChange:e=>l(e.target.value),children:[(0,S.jsx)(En.Ay,{value:"link",children:"Send reset link (email)"}),(0,S.jsx)(En.Ay,{value:"otp",children:"Send 6-digit code (email)"})]})}),(0,S.jsx)(Ce.A.Item,{label:"Email",name:"email",rules:[{required:!0,message:"Please input your email"},{type:"email",message:"Please enter a valid email"}],children:(0,S.jsx)(c.A,{placeholder:"you@example.com",size:"large"})}),(0,S.jsx)(Ce.A.Item,{children:(0,S.jsx)(u.Ay,{type:"primary",htmlType:"submit",block:!0,loading:e,children:e?"Sending...":"otp"===i?"Send code":"Send reset link"})}),(0,S.jsx)(u.Ay,{type:"link",block:!0,onClick:()=>f("/login"),children:"Back to login"})]})]})})};var Mn=n(57692);const Wn=()=>{const{token:e}=(0,L.g)(),t=(0,L.Zp)(),n=(0,L.zy)(),a=new URLSearchParams(n.search).get("mode"),[i,l]=(0,s.useState)(!1),[o,d]=(0,s.useState)(null),[m,p]=(0,s.useState)("");return(0,S.jsx)("div",{style:{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:24},children:(0,S.jsxs)(r.A,{style:{width:420,borderRadius:12},children:[(0,S.jsx)(h.A.Title,{level:3,style:{textAlign:"center"},children:"Reset Password"}),(0,S.jsxs)(Ce.A,{layout:"vertical",onFinish:async n=>{if(n.password!==n.confirm)return void ot.Ay.error({message:"Passwords do not match"});if(/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[^A-Za-z0-9]).{8,}$/.test(n.password)){l(!0);try{var s;let i;if(e)i=await en.A.post("/api/auth/reset-password/".concat(e),{password:n.password});else if("otp"===a){if(!n.code)return ot.Ay.error({message:"Please enter the 6-digit code sent to your email"}),void l(!1);i=await en.A.post("/api/auth/reset-password",{token:n.code,password:n.password})}else i=await en.A.post("/api/auth/reset-password",{token:n.code||"",password:n.password});ot.Ay.success({message:"Password reset",description:(null===(s=i.data)||void 0===s?void 0:s.message)||"Your password has been reset. Please log in."}),t("/login")}catch(o){var i,r;const e=(null===o||void 0===o||null===(i=o.response)||void 0===i||null===(r=i.data)||void 0===r?void 0:r.message)||o.message||"Failed to reset password";ot.Ay.error({message:"Error",description:e})}finally{l(!1)}}else ot.Ay.error({message:"Password does not meet complexity requirements. Use 8+ chars, mixed case, numbers and symbols."})},requiredMark:!1,children:["otp"===a&&!e&&(0,S.jsx)(Ce.A.Item,{label:"6-digit code",name:"code",rules:[{required:!0,message:"Please input the 6-digit code sent to your email"},{len:6,message:"Code must be 6 digits"}],children:(0,S.jsx)(c.A,{placeholder:"123456",size:"large"})}),(0,S.jsx)(Ce.A.Item,{label:"New password",name:"password",rules:[{required:!0,message:"Please input your new password"},{min:6,message:"Password must be at least 6 characters"}],children:(0,S.jsx)(c.A.Password,{size:"large",onChange:e=>(e=>{if(!e)return d(null),void p("");let t=0;e.length>=8&&(t+=2),/[A-Z]/.test(e)&&(t+=1),/[a-z]/.test(e)&&(t+=1),/\d/.test(e)&&(t+=1),/[^A-Za-z0-9]/.test(e)&&(t+=1);const n=Math.min(4,Math.floor(t/6*5));d(20*n),p(["Very weak","Weak","Fair","Good","Strong"][n]||"")})(e.target.value)})}),null!==o&&(0,S.jsxs)("div",{style:{marginBottom:12},children:[(0,S.jsx)(Mn.A,{percent:o,size:"small",status:o<40?"exception":"normal"}),(0,S.jsx)("div",{style:{textAlign:"right",fontSize:12,color:"#666"},children:m})]}),(0,S.jsx)(Ce.A.Item,{label:"Confirm password",name:"confirm",rules:[{required:!0,message:"Please confirm your new password"}],children:(0,S.jsx)(c.A.Password,{size:"large"})}),(0,S.jsx)(Ce.A.Item,{children:(0,S.jsx)(u.Ay,{type:"primary",htmlType:"submit",block:!0,loading:i,children:i?"Resetting...":"Reset password"})})]})]})})};var Yn=n(8295);const{Title:Hn,Text:Gn}=h.A,Vn=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!1),i=(0,L.Zp)(),l=async()=>{a(!0);try{const e=await(0,k.getInbox)(),n=e&&e.data?e.data:[];t(Array.isArray(n)?n:[])}catch(e){console.error("Failed to fetch inbox messages",e),t([])}finally{a(!1)}};(0,s.useEffect)(()=>{l()},[]);return(0,S.jsx)(p.A,{spinning:n,children:(0,S.jsxs)("div",{style:{padding:24,backgroundColor:"#f0f2f5",minHeight:"100vh"},children:[(0,S.jsxs)(X.A,{style:{marginBottom:24},children:[(0,S.jsx)(u.Ay,{type:"default",icon:(0,S.jsx)(Yn.A,{}),onClick:()=>i("/admin/dashboard"),children:"Back to Dashboard"}),(0,S.jsx)(Hn,{level:4,style:{marginBottom:0},children:"Message Inbox"})]}),(0,S.jsx)(r.A,{children:(0,S.jsx)(g.A,{dataSource:Array.isArray(e)?e:[],renderItem:e=>(0,S.jsx)(g.A.Item,{actions:["unread"===e.status&&(0,S.jsx)(u.Ay,{size:"small",icon:(0,S.jsx)(yt.A,{}),onClick:()=>(async e=>{if(e._id&&"read"!==e.status){a(!0);try{await fetch("/api/messages/".concat(e._id,"/read"),{method:"PATCH",credentials:"include"}),await l()}catch(t){}finally{a(!1)}}})(e),children:"Mark Read"})].filter(Boolean),children:(0,S.jsx)(g.A.Item.Meta,{avatar:(0,S.jsx)(y.A,{icon:(0,S.jsx)(vt.A,{}),style:{backgroundColor:"read"===e.status?"#8c8c8c":"#1890ff"}}),title:(0,S.jsx)(Gn,{strong:!0,children:e.subject}),description:(0,S.jsxs)("div",{children:[(0,S.jsx)(Gn,{type:"secondary",children:new Date(e.createdAt).toLocaleString()}),"New Verification Request"===e.subject&&(0,S.jsxs)("div",{style:{marginTop:8},children:[(0,S.jsx)(Gn,{strong:!0,children:"Verification request submitted."}),(0,S.jsx)("div",{children:e.body})]})]})})}),locale:{emptyText:"No notifications"}})})]})})},Kn=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!0);return(0,s.useEffect)(()=>{(async()=>{a(!0);try{const e=(await k.documentsAPI.getAllDocuments()||[]).filter(e=>{const t=e.status&&e.status.toLowerCase();return"rejected"===t||"completed"===t||"approved"===t});t(e)}catch(e){t([])}finally{a(!1)}})()},[]),(0,S.jsxs)("div",{style:{maxWidth:2e3,margin:"12px auto",padding:"0 16px"},children:[(0,S.jsx)(h.A.Title,{level:3,style:{marginTop:8,marginBottom:12},children:"Document History"}),n?(0,S.jsx)(p.A,{}):(0,S.jsx)(nt.A,{dataSource:e,rowKey:"_id",pagination:{pageSize:8},columns:[{title:"Requester Name",dataIndex:"username",key:"username",render:e=>e||"Unknown"},{title:"Transactional ID",dataIndex:"transactionCode",key:"transactionCode",render:e=>e||"\u2014"},{title:"Type",dataIndex:"type",key:"type",render:e=>e||"Unknown"},{title:"Date Approved",dataIndex:"completedAt",key:"completedAt",render:(e,t)=>{const n=e||t.dateApproved||t.completedAt||t.approvedAt||null;if(!n)return"\u2014";try{return(0,Bn.Y)(n)}catch(a){return String(n)}}},{title:"Status",dataIndex:"status",key:"status",render:(e,t)=>{var n,a,s;const i=(null===(n=t.processedBy)||void 0===n?void 0:n.fullName)||(null===(a=t.processedBy)||void 0===a?void 0:a.username)||"Unknown",r=(null===(s=t.processedBy)||void 0===s?void 0:s.barangayID)||"Unknown";return e&&"rejected"===e.toLowerCase()?(0,S.jsxs)("span",{style:{color:"#FF3B3B",fontWeight:600},children:["Rejected by: ",i," (",r,")"]}):!e||"completed"!==e.toLowerCase()&&"approved"!==e.toLowerCase()?(0,S.jsx)("span",{children:e}):(0,S.jsxs)("span",{style:{color:"#43D96B",fontWeight:600},children:["Completed by: ",i," (",r,")"]})}}]})]})};var Jn=n(27783),$n=n(75207);const{TextArea:Zn}=c.A,Qn=()=>{const[e,t]=(0,s.useState)(""),[n,a]=(0,s.useState)(null),[l,o]=(0,s.useState)(!1),[d,c]=(0,s.useState)([]),[m,p]=(0,s.useState)(!1),[x,f]=(0,s.useState)(null),[y,j]=(0,s.useState)(null),[v,b]=(0,s.useState)(""),[w,I]=(0,s.useState)(null),{user:C}=V(),N=async()=>{if(!C||"admin"!==C.role)return;if(localStorage.getItem("token")){p(!0);try{const e=await k.adminAPI.listAdminAnnouncements();c(Array.isArray(e)?e:[])}catch(t){var e;401===(null===t||void 0===t||null===(e=t.response)||void 0===e?void 0:e.status)?i.Ay.error("Not authorized. Please sign in as an admin."):(console.error("Failed to load announcements",t),i.Ay.error("Failed to load announcements"))}finally{p(!1)}}};(0,s.useEffect)(()=>{"admin"===(null===C||void 0===C?void 0:C.role)&&N()},[C]);const P=()=>a(null);return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(r.A,{title:(0,S.jsx)(h.A.Title,{level:4,style:{margin:0},children:"admin"===(null===C||void 0===C?void 0:C.role)?"Post Announcement":"Announcements"}),children:(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:["admin"===(null===C||void 0===C?void 0:C.role)&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Zn,{value:e,onChange:e=>t(e.target.value),rows:6,placeholder:"Write your announcement here"}),(0,S.jsx)(T.A,{beforeUpload:e=>e.type.startsWith("image/")?(a(e),T.A.LIST_IGNORE):(i.Ay.error("Only image files are allowed"),T.A.LIST_IGNORE),onRemove:P,accept:"image/*",maxCount:1,showUploadList:{showPreviewIcon:!1},children:(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(q.A,{}),children:"Upload Image (optional)"})}),n&&(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,color:"#237804"},children:[(0,S.jsx)(yt.A,{style:{color:"#52c41a"}}),(0,S.jsx)("span",{style:{fontWeight:600},children:"Image uploaded:"}),(0,S.jsx)("span",{style:{marginLeft:6},children:n.name}),(0,S.jsx)(u.Ay,{type:"text",icon:(0,S.jsx)($n.A,{}),onClick:P,style:{marginLeft:8}})]}),(0,S.jsx)("div",{style:{display:"flex",justifyContent:"flex-end"},children:(0,S.jsx)(u.Ay,{type:"primary",onClick:async()=>{if(!e||""===e.trim())return i.Ay.warning("Announcement text cannot be empty");o(!0);try{const s=new FormData;s.append("text",e.trim()),n&&s.append("image",n,n.name),await k.adminAPI.createAnnouncement(s),i.Ay.success("Announcement posted"),t(""),a(null)}catch(l){var s,r;console.error("Failed to post announcement",l),i.Ay.error((null===l||void 0===l||null===(s=l.response)||void 0===s||null===(r=s.data)||void 0===r?void 0:r.message)||"Failed to post announcement")}finally{o(!1)}},loading:l,disabled:!e.trim(),children:"Post Announcement"})})]}),(0,S.jsxs)("div",{style:{marginTop:12},children:[(0,S.jsx)(h.A.Title,{level:5,style:{marginBottom:8},children:"Existing Announcements"}),(0,S.jsx)(g.A,{loading:m,dataSource:d,renderItem:e=>(0,S.jsxs)(g.A.Item,{actions:[(0,S.jsx)(A.A,{title:"View",placement:"top",children:(0,S.jsx)(u.Ay,{shape:"circle",size:"small",icon:(0,S.jsx)(D.A,{}),onClick:()=>(e=>f(e))(e),"aria-label":"View announcement ".concat(e._id)})},"view"),"admin"===(null===C||void 0===C?void 0:C.role)?(0,S.jsx)(A.A,{title:"Edit",placement:"top",children:(0,S.jsx)(u.Ay,{shape:"circle",size:"small",icon:(0,S.jsx)(qt.A,{}),onClick:()=>(e=>{j(e),b(e.text||""),I(null)})(e),"aria-label":"Edit announcement ".concat(e._id)})},"edit"):null,"admin"===(null===C||void 0===C?void 0:C.role)?(0,S.jsx)(Dt.A,{title:"Delete announcement?",onConfirm:async()=>{try{await k.adminAPI.deleteAnnouncement(e._id),i.Ay.success("Deleted"),N()}catch(t){console.error(t),i.Ay.error("Delete failed")}},children:(0,S.jsx)(A.A,{title:"Delete",placement:"top",children:(0,S.jsx)(u.Ay,{danger:!0,shape:"circle",size:"small",icon:(0,S.jsx)(R.A,{}),"aria-label":"Delete announcement ".concat(e._id)})})},"del"):null].filter(Boolean),children:[(0,S.jsx)(g.A.Item.Meta,{title:new Date(e.createdAt).toLocaleString(),description:e.text}),e.imagePath&&(0,S.jsx)(Jn.A,{className:"rounded-img",width:80,src:(0,k.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image"))})]})})]})]})}),(0,S.jsx)(_.A,{title:x?"Announcement - ".concat(new Date(x.createdAt).toLocaleString()):"Announcement",open:!!x,onCancel:()=>f(null),footer:[(0,S.jsx)(u.Ay,{onClick:()=>f(null),children:"Close"},"close")],children:x&&(0,S.jsxs)("div",{children:[(0,S.jsx)("p",{children:x.text}),x.imagePath&&(0,S.jsx)(Jn.A,{className:"rounded-img rounded-img-lg",src:(0,k.getAbsoluteApiUrl)("/announcements/".concat(x._id,"/image")),width:320})]})}),(0,S.jsx)(_.A,{title:"Edit Announcement",open:!!y,onCancel:()=>{j(null),I(null),b("")},onOk:async()=>{if(y)try{const e=new FormData;e.append("text",v.trim()),w&&e.append("image",w,w.name),await k.adminAPI.updateAnnouncement(y._id,e),i.Ay.success("Updated"),j(null),I(null),b(""),N()}catch(e){console.error(e),i.Ay.error("Update failed")}},okText:"Save",children:(0,S.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:[(0,S.jsx)(Zn,{value:v,onChange:e=>b(e.target.value),rows:6}),(0,S.jsx)(T.A,{beforeUpload:e=>e.type.startsWith("image/")?(I(e),T.A.LIST_IGNORE):(i.Ay.error("Only image files are allowed"),T.A.LIST_IGNORE),onRemove:()=>I(null),accept:"image/*",maxCount:1,showUploadList:{showPreviewIcon:!1},children:(0,S.jsx)(u.Ay,{icon:(0,S.jsx)(q.A,{}),children:"Replace Image"})}),w&&(0,S.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8,color:"#237804"},children:[(0,S.jsx)(yt.A,{style:{color:"#52c41a"}}),(0,S.jsx)("span",{style:{fontWeight:600},children:"New image selected:"}),(0,S.jsx)("span",{style:{marginLeft:6},children:null===w||void 0===w?void 0:w.name}),(0,S.jsx)(u.Ay,{type:"text",icon:(0,S.jsx)($n.A,{}),onClick:()=>I(null),style:{marginLeft:8}})]})]})})]})},{Title:Xn,Paragraph:ea}=h.A,ta=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!1),[i,l]=(0,s.useState)(null);return(0,s.useEffect)(()=>{(async()=>{a(!0);try{const e=await k.contactAPI.getAnnouncements();t(Array.isArray(e)?e:[])}catch(e){console.error("Failed to load announcements",e)}finally{a(!1)}})()},[]),(0,S.jsxs)(r.A,{title:(0,S.jsx)(Xn,{level:4,style:{margin:0},children:"Announcements"}),children:[0===e.length?(0,S.jsx)(ct.A,{description:"No announcements"}):(0,S.jsx)(g.A,{loading:n,dataSource:e,renderItem:e=>(0,S.jsxs)(g.A.Item,{style:{cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"space-between"},onClick:()=>l(e),children:[(0,S.jsx)("div",{style:{flex:1,minWidth:0},children:(0,S.jsx)(g.A.Item.Meta,{title:(0,S.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,S.jsx)("span",{children:new Date(e.createdAt).toLocaleString()})}),description:(0,S.jsx)(ea,{ellipsis:{rows:2},children:e.text})})}),e.imagePath&&(0,S.jsx)("div",{style:{marginLeft:12,width:80,display:"flex",justifyContent:"flex-end"},children:(0,S.jsx)(Jn.A,{className:"rounded-img",width:72,height:48,src:(0,k.getAbsoluteApiUrl)("/announcements/".concat(e._id,"/image")),alt:"announcement",preview:!1})})]})}),(0,S.jsx)(_.A,{open:!!i,onCancel:()=>l(null),footer:null,title:"Announcement",children:i&&(0,S.jsxs)("div",{children:[(0,S.jsx)(ea,{children:i.text}),i.imagePath&&(0,S.jsx)(Jn.A,{className:"rounded-img rounded-img-lg",src:(0,k.getAbsoluteApiUrl)("/announcements/".concat(i._id,"/image")),alt:"announcement"})]})})]})},na=()=>{const[e,t]=(0,s.useState)([]),[n,a]=(0,s.useState)(!1),r=async()=>{a(!0);try{const e=await k.verificationAPI.getRequests();t(Array.isArray(e)?e:[])}catch(e){console.error(e),i.Ay.error("Failed to load verification requests")}finally{a(!1)}};(0,s.useEffect)(()=>{r()},[]);const l=[{title:"Resident",dataIndex:"userId",key:"user",render:e=>e?e.fullName||e.username||e.email:"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>(0,S.jsx)(f.A,{color:"pending"===e?"orange":"approved"===e?"green":"red",children:e})},{title:"Submitted",dataIndex:"createdAt",key:"createdAt",render:e=>new Date(e).toLocaleString()},{title:"Files",dataIndex:"gridFileIds",key:"files",render:e=>(0,S.jsx)(X.A,{children:e&&e.map(e=>(0,S.jsx)(u.Ay,{type:"link",href:(0,k.getAbsoluteApiUrl)("/verification/file/".concat(e)),target:"_blank",children:"Open"},e))})},{title:"Action",key:"action",render:(e,t)=>(0,S.jsxs)(X.A,{children:[(0,S.jsx)(u.Ay,{onClick:()=>(async e=>{a(!0);try{await k.verificationAPI.verifyUser(e,!0),i.Ay.success("User verified"),await r()}catch(t){console.error(t),i.Ay.error("Failed to verify user")}finally{a(!1)}})(t.userId._id||t.userId),type:"primary",children:"Verify"}),(0,S.jsx)(u.Ay,{danger:!0,onClick:()=>(async e=>{a(!0);try{var t;if(e&&e._id)try{await k.verificationAPI.rejectRequest(e._id)}catch(n){}const a=(null===(t=e.userId)||void 0===t?void 0:t._id)||e.userId;a&&await k.verificationAPI.verifyUser(a,!1),i.Ay.success("Verification request rejected"),await r()}catch(s){console.error(s),i.Ay.error("Failed to reject verification")}finally{a(!1)}})(t),children:"Reject"}),(0,S.jsx)(u.Ay,{type:"link",href:(0,k.getAbsoluteApiUrl)("/verification/file/".concat(t.gridFileIds&&t.gridFileIds[0]||"")),target:"_blank",children:"Check ID"})]})}];return(0,S.jsxs)("div",{style:{padding:24},children:[(0,S.jsx)("h2",{children:"Verification Requests"}),(0,S.jsx)(p.A,{spinning:n,children:(0,S.jsx)(nt.A,{rowKey:"_id",loading:n,dataSource:e,columns:l})})]})};const aa=(0,n(77990).A)({palette:{primary:{main:"#1976d2",light:"#42a5f5",dark:"#1565c0"},secondary:{main:"#9c27b0",light:"#ba68c8",dark:"#7b1fa2"}},typography:{fontFamily:["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif"].join(",")},components:{MuiButton:{styleOverrides:{root:{textTransform:"none"}}},MuiPaper:{styleOverrides:{root:{borderRadius:8}}}}}),sa=()=>{const{user:e}=V();return e?"admin"===e.role?(0,S.jsx)(L.C5,{to:"/admin/dashboard",replace:!0}):"staff"===e.role?(0,S.jsx)(L.C5,{to:"/staff-dashboard",replace:!0}):(0,S.jsx)(L.C5,{to:"/dashboard",replace:!0}):(0,S.jsx)(L.C5,{to:"/login",replace:!0})},ia=()=>(0,S.jsxs)(U.A,{theme:aa,children:[(0,S.jsx)(M.Ay,{}),(0,S.jsx)(W.Ay,{children:(0,S.jsx)(L.Kd,{children:(0,S.jsx)($,{children:(0,S.jsxs)(L.BV,{children:[(0,S.jsx)(L.qh,{path:"/",element:(0,S.jsx)(Fn,{})}),(0,S.jsx)(L.qh,{path:"/redirect",element:(0,S.jsx)(sa,{})}),(0,S.jsx)(L.qh,{path:"/login",element:(0,S.jsx)(Be,{})}),(0,S.jsx)(L.qh,{path:"/forgot-password",element:(0,S.jsx)(Un,{})}),(0,S.jsx)(L.qh,{path:"/reset-password/:token",element:(0,S.jsx)(Wn,{})}),(0,S.jsx)(L.qh,{path:"/register",element:(0,S.jsx)(et,{})}),(0,S.jsx)(L.qh,{path:"/goodbye",element:(0,S.jsx)(Rn,{})}),(0,S.jsx)(L.qh,{path:"/logout",element:(0,S.jsx)(qn,{})}),(0,S.jsxs)(L.qh,{element:(0,S.jsx)(be,{}),children:[(0,S.jsx)(L.qh,{path:"/home",element:(0,S.jsx)(we,{children:(0,S.jsx)(rt,{})})}),(0,S.jsx)(L.qh,{path:"/request",element:(0,S.jsx)(we,{children:(0,S.jsx)(In,{})})}),(0,S.jsx)(L.qh,{path:"/dashboard",element:(0,S.jsx)(we,{children:(0,S.jsx)(rt,{})})}),(0,S.jsx)(L.qh,{path:"/guest/dashboard",element:(0,S.jsx)(we,{children:(0,S.jsx)(lt,{})})}),(0,S.jsx)(L.qh,{path:"/request-document",element:(0,S.jsx)(we,{children:(0,S.jsx)(In,{})})}),(0,S.jsx)(L.qh,{path:"/contact",element:(0,S.jsx)(we,{children:(0,S.jsx)(Pn,{})})}),(0,S.jsx)(L.qh,{path:"/inquiries",element:(0,S.jsx)(we,{children:(0,S.jsx)(Pn,{})})}),(0,S.jsx)(L.qh,{path:"/inquiry-tracker",element:(0,S.jsx)(Se,{children:(0,S.jsx)(Ln,{})})}),(0,S.jsx)(L.qh,{path:"/staff-dashboard",element:(0,S.jsx)(Se,{children:(0,S.jsx)(jt,{})})}),(0,S.jsx)(L.qh,{path:"/document-processing",element:(0,S.jsx)(Se,{children:s.createElement(n(93982).A)})}),(0,S.jsx)(L.qh,{path:"/templates-manager",element:(0,S.jsx)(Se,{children:(0,S.jsx)(B,{})})}),(0,S.jsx)(L.qh,{path:"/staff/inbox",element:(0,S.jsx)(Se,{children:(0,S.jsx)(E,{})})}),(0,S.jsx)(L.qh,{path:"/admin/dashboard",element:(0,S.jsx)(Ie,{children:(0,S.jsx)(Tt,{})})}),(0,S.jsx)(L.qh,{path:"/admin/messages",element:(0,S.jsx)(Ie,{children:(0,S.jsx)(Vn,{})})}),(0,S.jsx)(L.qh,{path:"/admin/verification-requests",element:(0,S.jsx)(Ie,{children:(0,S.jsx)(na,{})})}),(0,S.jsx)(L.qh,{path:"/announcements",element:(0,S.jsx)(we,{children:(0,S.jsx)(ta,{})})}),(0,S.jsx)(L.qh,{path:"/admin/announcements",element:(0,S.jsx)(Ie,{children:(0,S.jsx)(Qn,{})})}),(0,S.jsx)(L.qh,{path:"/admin",element:(0,S.jsx)(L.C5,{to:"/admin/dashboard",replace:!0})}),(0,S.jsx)(L.qh,{path:"/admin/users",element:(0,S.jsx)(Ie,{children:(0,S.jsx)(Ut,{})})}),(0,S.jsx)(L.qh,{path:"/admin/activity",element:(0,S.jsx)(Ie,{children:(0,S.jsx)(Mt,{})})}),(0,S.jsx)(L.qh,{path:"/admin/statistics",element:(0,S.jsx)(Ie,{children:(0,S.jsx)(dn,{})})}),(0,S.jsx)(L.qh,{path:"/admin/settings",element:(0,S.jsx)(Ie,{children:(0,S.jsx)(jn,{})})}),(0,S.jsx)(L.qh,{path:"/profile",element:(0,S.jsx)(we,{children:(0,S.jsx)(zn,{})})}),(0,S.jsx)(L.qh,{path:"/document-history",element:(0,S.jsx)(we,{children:(0,S.jsx)(Kn,{})})}),(0,S.jsx)(L.qh,{path:"/inbox",element:(0,S.jsx)(we,{children:(0,S.jsx)(N,{})})})]})]})})})})]})},31694:(e,t,n)=>{n.r(t),n.d(t,{API_URL:()=>p,adminAPI:()=>I,authAPI:()=>k,authService:()=>y,axiosInstance:()=>x,axiosPublic:()=>g,contactAPI:()=>w,default:()=>x,documentsAPI:()=>b,getAbsoluteApiUrl:()=>f,getInbox:()=>A,getTemplateText:()=>c,notificationAPI:()=>u,requestsAPI:()=>S,residentPersonalInfoAPI:()=>C,staffRegister:()=>h,verificationAPI:()=>j});var a=n(89379),s=n(56403),i=n(72799);class r{constructor(){this.db=null}static getInstance(){return r.instance||(r.instance=new r),r.instance}async initialize(){this.db=await(0,i.P2)("barangay-system",1,{upgrade(e){if(!e.objectStoreNames.contains("users")){e.createObjectStore("users",{keyPath:"_id"}).createIndex("by-email","email")}if(!e.objectStoreNames.contains("documents")){e.createObjectStore("documents",{keyPath:"_id"}).createIndex("by-user","userId")}e.objectStoreNames.contains("syncQueue")||e.createObjectStore("syncQueue",{keyPath:"_id",autoIncrement:!0})}})}async addToSyncQueue(e,t,n){this.db||await this.initialize(),await this.db.add("syncQueue",{operation:e,collection:t,data:n,timestamp:Date.now()})}async getAllFromSyncQueue(){return this.db||await this.initialize(),this.db.getAll("syncQueue")}async clearSyncQueue(){this.db||await this.initialize();const e=this.db.transaction("syncQueue","readwrite");await e.objectStore("syncQueue").clear()}async saveUser(e){this.db||await this.initialize(),await this.db.put("users",e)}async getUser(e){return this.db||await this.initialize(),this.db.get("users",e)}async getAllUsers(){return this.db||await this.initialize(),this.db.getAll("users")}async deleteUser(e){this.db||await this.initialize(),await this.db.delete("users",e)}async saveDocument(e){this.db||await this.initialize(),await this.db.put("documents",e)}async getDocument(e){return this.db||await this.initialize(),this.db.get("documents",e)}async getAllDocuments(){return this.db||await this.initialize(),this.db.getAll("documents")}async deleteDocument(e){this.db||await this.initialize(),await this.db.delete("documents",e)}async saveSettings(e){this.db||await this.initialize(),await this.db.put("users",(0,a.A)({_id:"settings"},e))}async getSettings(){return this.db||await this.initialize(),this.db.get("users","settings")}}r.instance=void 0;const l=r.getInstance();class o{constructor(){this.isOnline=navigator.onLine,this.syncInterval=null,this.handleOnline=async()=>{this.isOnline=!0,console.log("Connection restored. Starting sync..."),await this.syncWithServer()},this.handleOffline=()=>{this.isOnline=!1,console.log("Connection lost. Operating in offline mode...")},this.setupEventListeners(),this.startSyncInterval()}static getInstance(){return o.instance||(o.instance=new o),o.instance}setupEventListeners(){window.addEventListener("online",this.handleOnline),window.addEventListener("offline",this.handleOffline)}startSyncInterval(){this.syncInterval||(this.syncInterval=setInterval(async()=>{this.isOnline&&await this.syncWithServer()},3e5))}async syncWithServer(){try{const t=await l.getAllFromSyncQueue();if(0===t.length)return;console.log("Syncing ".concat(t.length," pending changes..."));for(const n of t)try{await this.processSyncItem(n)}catch(e){if(e&&"object"===typeof e&&"message"in e&&"string"===typeof e.message){if(console.error("Failed to sync item:",n,e),"Network Error"===e.message){this.isOnline=!1;break}}else console.error("Failed to sync item:",n,e)}await l.clearSyncQueue()}catch(e){e&&"object"===typeof e&&"message"in e&&"string"===typeof e.message?console.error("Sync failed:",e.message):console.error("Sync failed:",e)}}async processSyncItem(e){const{operation:t,collection:n,data:a}=e;switch(t){case"create":await x.post("/api/".concat(n),a);break;case"update":await x.put("/api/".concat(n,"/").concat(a._id),a);break;case"delete":await x.delete("/api/".concat(n,"/").concat(a._id))}}async performOperation(e,t,n){switch(e){case"create":case"update":await l.saveUser(n);break;case"delete":await l.deleteUser(n._id)}await l.addToSyncQueue(e,t,n),this.isOnline&&await this.syncWithServer()}cleanup(){this.syncInterval&&clearInterval(this.syncInterval),window.removeEventListener("online",this.handleOnline),window.removeEventListener("offline",this.handleOffline)}}o.instance=void 0;const d=o.getInstance(),c=e=>x.get("/templates/".concat(e)).then(e=>e.data.text),u={getNotifications:async()=>{try{const e=await x.get("/notifications");return Array.isArray(e.data)?e.data:e.data&&e.data.data?e.data.data:[]}catch(e){try{const e=await x.get("/notifications/fallback");return Array.isArray(e.data)?e.data:e.data&&e.data.data?e.data.data:[]}catch(t){return console.error("notificationAPI.getNotifications failed:",e),[]}}},approveStaff:async(e,t)=>(await x.post("/notifications/approve",{userId:e,notificationId:t})).data,rejectStaff:async(e,t)=>(await x.post("/notifications/reject",{notificationId:e,reason:t})).data,markAsRead:async e=>(await x.post("/notifications/read",{notificationId:e})).data},h=async e=>(await x.post("/auth/register/staff",e)).data,m=globalThis.__APP_CONFIG__,p=m&&m.API_BASE||"https://my-backend.onrender.com/api",x=s.A.create({baseURL:p,headers:{"Content-Type":"application/json"},withCredentials:!0}),g=s.A.create({baseURL:p,headers:{"Content-Type":"application/json"},withCredentials:!1});function f(e){const t=globalThis.__APP_CONFIG__,n=t&&t.API_BASE||"https://my-backend.onrender.com/api";let a=String(n).replace(/\/$/,"");a.endsWith("/api")&&(a=a.replace(/\/api$/,""));const s=e.startsWith("/")?e:"/".concat(e);return"".concat(a,"/api").concat(s)}const y={login:async(e,t)=>(await x.post("/auth/login",{email:e,password:t})).data,register:async e=>(await x.post("/auth/register",e)).data,logout:async()=>{await x.post("/auth/logout")},getCurrentUser:async()=>(await x.get("/auth/me")).data};x.interceptors.request.use(e=>{const t=localStorage.getItem("token")||localStorage.getItem("guestSessionToken");return t&&e.headers&&(e.headers.Authorization="Bearer ".concat(t)),e}),x.interceptors.response.use(e=>e,e=>{try{var t;if(401===(null===e||void 0===e||null===(t=e.response)||void 0===t?void 0:t.status)&&"undefined"!==typeof window){const t=window.location.pathname||"",s=(null===e||void 0===e?void 0:e.config)&&(e.config.url||"")||(null===e||void 0===e?void 0:e.request)&&e.request.responseURL||"",i=s.includes("/auth/login")||s.includes("/auth/me");if("/login"===t||t.startsWith("/login")||i)try{localStorage.removeItem("guestSessionToken")}catch(n){}else{console.warn("API responded 401 Unauthorized \u2014 clearing auth and redirecting to login");try{localStorage.removeItem("token"),localStorage.removeItem("guestSessionToken")}catch(n){}try{sessionStorage.getItem("redirectingToLogin")||(sessionStorage.setItem("redirectingToLogin","1"),setTimeout(()=>{window.location.href="/login"},100))}catch(n){try{window.location.href="/login"}catch(a){}}}}}catch(n){}return Promise.reject(e)});const A=async()=>x.get("/messages/inbox"),j={getRequests:async()=>x.get("/verification/admin/requests").then(e=>e.data),verifyUser:async(e,t)=>x.post("/verification/admin/verify-user/".concat(e),{verified:t}).then(e=>e.data),getFileUrl:e=>"".concat(p.replace(/\/$/,""),"/verification/file/").concat(e),approveRequest:async e=>x.post("/verification/admin/requests/".concat(e,"/approve")).then(e=>e.data),rejectRequest:async(e,t)=>x.post("/verification/admin/requests/".concat(e,"/reject"),{reason:t}).then(e=>e.data)},v={login:e=>x.post("/auth/login",e).then(e=>e.data),register:e=>x.post("/auth/register",e).then(e=>e.data)},b={getMyDocuments:()=>x.get("/document-requests/my-requests").then(e=>e.data),requestDocument:e=>x.post("/document-requests",e).then(e=>e.data),getDocumentById:e=>x.get("/document-requests/".concat(e)).then(e=>e.data),getAllDocuments:()=>x.get("/document-requests/all").then(e=>e.data),getDocumentRecords:()=>x.get("/document-requests/all").then(e=>e.data),updateDocumentStatus:(e,t)=>x.patch("/document-requests/".concat(e,"/process"),t).then(e=>e.data),processDocument:e=>x.patch("/document-requests/".concat(e,"/process")).then(e=>e.data),listFiles:()=>x.get("/documents/list").then(e=>e.data),deleteFile:e=>x.delete("/documents/file/".concat(e)).then(e=>e.data),updateFileStatus:(e,t)=>x.patch("/documents/file/".concat(e,"/status"),t).then(e=>e.data),getFilledDocument:e=>x.get("/document-requests/".concat(e,"/filled")).then(e=>e.data),previewFilledDocument:e=>x.post("/document-requests/preview-filled",e).then(e=>e.data)},w={submitInquiry:e=>"undefined"!==typeof FormData&&e instanceof FormData?x.post("/inquiries",e,{headers:{"Content-Type":"multipart/form-data"}}).then(e=>e.data):x.post("/inquiries",e).then(e=>e.data),getMyInquiries:(e,t)=>x.get("/inquiries/my-inquiries",{params:e&&t?{username:e,barangayID:t}:void 0}).then(e=>e.data),getInquiryById:e=>x.get("/inquiries/".concat(e)).then(e=>e.data),getAllInquiries:()=>x.get("/inquiries").then(e=>e.data),respondToInquiry:(e,t)=>x.post("/inquiries/".concat(e,"/responses"),t).then(e=>e.data),resolveInquiry:e=>x.patch("/inquiries/".concat(e),{status:"resolved"}).then(e=>e.data),getAnnouncements:()=>x.get("/announcements").then(e=>e.data),getAnnouncementById:e=>x.get("/announcements/".concat(e)).then(e=>e.data)},S={getAllRequests:async()=>x.get("/requests").then(e=>e.data),getRequestById:async e=>x.get("/requests/".concat(e)).then(e=>e.data),getStaffAccessRequests:async()=>{const e=await x.get("/requests").then(e=>e.data);return Array.isArray(e)?e.filter(e=>"staff_access"===(e.type||"").toString().toLowerCase()&&"pending"===(e.status||"").toString().toLowerCase()):[]},approveRequest:async e=>(await x.post("/requests/".concat(e,"/approve"))).data},I={createUser:async e=>{try{const n=await x.post("/admin/users",e);if(n.data){await l.saveUser(n.data);try{const e=new CustomEvent("userProfileUpdated",{detail:n.data});window.dispatchEvent(e)}catch(t){}}}catch(n){throw navigator.onLine||await d.performOperation("create","users",e),n}},updateUser:async(e,t)=>{try{const a=await x.put("/admin/users/".concat(e),t);if(a.data){await l.saveUser(a.data);try{const e=new CustomEvent("userProfileUpdated",{detail:a.data});window.dispatchEvent(e)}catch(n){}}}catch(s){throw navigator.onLine||await d.performOperation("update","users",(0,a.A)((0,a.A)({},t),{},{_id:e})),s}},demoteUser:async e=>{try{return(await x.put("/admin/users/".concat(e),{role:"resident"})).data}catch(t){if(!navigator.onLine)return void await d.performOperation("update","users",{_id:e,role:"resident"});throw t}},getSystemSettings:async()=>{try{return(await x.get("/admin/settings")).data}catch(e){if(!navigator.onLine){const e=await l.getSettings();if(e)return e}try{return(await x.get("/settings")).data}catch(t){try{return(await x.get("/admin/settings")).data}catch(n){try{return(await x.get("/settings")).data}catch(a){try{return(await x.get("/settings/public")).data}catch(s){try{const e=await l.getSettings();if(e)return e}catch(i){}console.warn("getSystemSettings: all fallbacks failed; returning empty defaults. Original error:",e);return{siteName:"Barangay Information System",contactEmail:"",smtp:{passwordSet:!1}}}}}}}},updateSystemSettings:async e=>{try{const t=await x.put("/admin/settings",e);return await l.saveSettings(e),t.data}catch(t){if(!navigator.onLine)return void await d.performOperation("update","settings",e);try{const t=await x.put("/admin/settings",e,{withCredentials:!0});try{await l.saveSettings(e)}catch(n){}return t.data}catch(a){throw t}}},testSmtp:async e=>(await x.post("/admin/settings/test-smtp",{to:e})).data,getUsers:async()=>{try{const e=(await x.get("/auth/users")).data;for(const t of e)await l.saveUser(t);return e}catch(e){if(!navigator.onLine)return l.getAllUsers();throw e}},updateUserStatus:async(e,t)=>{try{const a=await x.put("/admin/users/".concat(e,"/status"),{status:t}),s=await l.getUser(e);if(s){s.status=t,await l.saveUser(s);try{const e=new CustomEvent("userProfileUpdated",{detail:s});window.dispatchEvent(e)}catch(n){}}return a.data}catch(a){if(!navigator.onLine){const n=await l.getUser(e);return void(n&&(n.status=t,await d.performOperation("update","users",n)))}throw a}},deleteUser:async e=>{try{await x.delete("/admin/users/".concat(e)),await l.deleteUser(e);try{const t=new CustomEvent("userProfileUpdated",{detail:{_id:e,deleted:!0}});window.dispatchEvent(t)}catch(t){}}catch(n){if(!navigator.onLine)return void await d.performOperation("delete","users",{_id:e});throw n}},getActivityLogs:e=>x.get("/admin/logs",{params:e}).then(e=>e.data),getSystemStatistics:()=>x.get("/admin/statistics").then(e=>e.data),getStaffApplicants:async()=>(await x.get("/admin/staff-applications")).data,getUserWithResident:async e=>(await x.get("/admin/users/".concat(e,"/with-resident"))).data,getResidentByBarangayID:async e=>(await x.get("/admin/resident/".concat(encodeURIComponent(e)))).data,getResident:async e=>(await x.get("/admin/resident/id/".concat(e))).data,updateResident:async(e,t)=>(await x.put("/admin/resident/".concat(e),t)).data,uploadResidentAvatar:async(e,t)=>{const n=new FormData;n.append("avatar",t);return(await x.post("/admin/resident/".concat(e,"/avatar"),n,{})).data},getOfficials:async()=>{try{return(await x.get("/admin/officials")).data}catch(e){console.warn("getOfficials: primary request failed; attempting public backend fallback. Error:",e);try{const e=await g.get("/officials");return Array.isArray(e.data)?e.data:[]}catch(t){return[]}}},createOfficial:async e=>{try{return(await x.post("/admin/officials",e)).data}catch(t){throw t}},updateOfficial:async(e,t)=>{try{return(await x.put("/admin/officials/".concat(e),t)).data}catch(n){if(!navigator.onLine)return void await d.performOperation("update","officials",(0,a.A)((0,a.A)({},t),{},{_id:e}));throw n}},deleteOfficial:async e=>(await x.delete("/admin/officials/".concat(e))).data,disableUser:async(e,t)=>(await x.patch("/admin/users/".concat(e,"/disable"),t||{})).data,enableUser:async e=>(await x.patch("/admin/users/".concat(e,"/enable"))).data,uploadOfficialPhoto:async(e,t)=>{const n=new FormData;n.append("photo",t);try{return(await x.post("/admin/officials/".concat(e,"/photo"),n,{headers:{}})).data}catch(a){try{a&&a.response&&a.response.data?console.error("uploadOfficialPhoto axios error response:",a.response.data):console.error("uploadOfficialPhoto axios error",a)}catch(s){}try{const t="".concat(p,"/admin/officials/").concat(e,"/photo"),a=await fetch(t,{method:"POST",body:n,credentials:"include"}),s=await a.json().catch(()=>({}));if(!a.ok){const e=s&&s.message?s.message:"Upload failed with status ".concat(a.status),t=new Error(e);throw t.response={status:a.status,data:s},t}return s}catch(i){throw i}}},approveStaffApplicant:async e=>(await x.post("/admin/staff-applications/".concat(e,"/approve"))).data,createAnnouncement:async e=>(await x.post("/admin/announcements",e,{headers:{"Content-Type":"multipart/form-data"}})).data,listAdminAnnouncements:async()=>(await x.get("/admin/announcements/list")).data,deleteAnnouncement:async e=>(await x.delete("/admin/announcements/".concat(e))).data,updateAnnouncement:async(e,t)=>(await x.put("/admin/announcements/".concat(e),t,{headers:{"Content-Type":"multipart/form-data"}})).data},C={getPersonalInfo:async()=>{const e=["/resident/my-info","/resident/personal-info","/resident/profile"];for(const a of e)try{const e=await x.get(a);if(e&&e.data)return e.data}catch(n){}try{const e=await x.get("/resident/personal-info");if(e&&e.data)return e.data}catch(n){}const t=new Error("Resident personal info not found");throw t.response={status:404},t},updatePersonalInfo:async e=>(await x.put("/resident/my-info",e)).data},k=(0,a.A)((0,a.A)({},v),{},{getUsers:async()=>{try{return(await x.get("/auth/users")).data}catch(e){throw console.error("authAPI.getUsers failed",e),e}}})},59977:(e,t,n)=>{n.d(t,{Y:()=>i});var a=n(60446),s=n.n(a);function i(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!e)return"";try{const n=s()(e);return n.isValid()?t?n.format("MM/DD/YYYY h:mm:ss A"):n.format("MM/DD/YYYY"):String(e)}catch(n){return String(e)}}},93982:(e,t,n)=>{n.d(t,{A:()=>T});var a=n(89379),s=n(65043),i=n(25352),r=n(91686),l=n(79617),o=n(89073),d=n(36621),c=n(65512),u=n(59772),h=n(70494),m=n(76399),p=n(15492),x=n(42524),g=n(6051),f=n(63942),y=n(96603),A=n(80349),j=n(72411),v=n(48745),b=n(96891),w=n(49400),S=n(61118),I=n(31694),C=n(59977),k=n(56403);var N=n(70579);const T=()=>{var e,t,n,T;const[D,P]=(0,s.useState)([]),[R,q]=(0,s.useState)(!0),[B,L]=(0,s.useState)(!1),[O,_]=(0,s.useState)(null),[z,F]=(0,s.useState)([]),[E,U]=(0,s.useState)({}),[M,W]=(0,s.useState)(!1),[Y,H]=(0,s.useState)(""),[G,V]=(0,s.useState)(!1),[K,J]=(0,s.useState)([]),[$,Z]=(0,s.useState)(""),[Q,X]=(0,s.useState)(null),ee=(0,s.useRef)({}),[te,ne]=((0,s.useRef)(null),(0,s.useState)(null)),[ae,se]=(0,s.useState)({}),[ie,re]=(0,s.useState)(!1),[le,oe]=(0,s.useState)([]),[de,ce]=(0,s.useState)(null),[ue,he]=(0,s.useState)(null),[me,pe]=(0,s.useState)(null),[xe,ge]=(0,s.useState)(!1),[fe,ye]=(0,s.useState)(null),[Ae,je]=(0,s.useState)(!1),[ve,be]=(0,s.useState)(""),[we,Se]=(0,s.useState)(null),[Ie,Ce]=(0,s.useState)(null),[ke,Ne]=(0,s.useState)(null),Te=(0,i.zy)(),De=(0,i.Zp)(),Pe=Te&&Te.state&&Te.state.openRequestId?Te.state.openRequestId:null,Re=e=>{const t=E[e];return t?Array.isArray(t)?t:[t]:[]},qe=e=>{const t=Re(e);return t.length?t[0]:null},Be=e=>{const t=Re(e);if(!t||!t.length)return null;return t.find(e=>e.notes&&e.notes.toString().toLowerCase().includes("priority")||!0===e.priority)||t[0]},Le=async()=>{q(!0);try{const e=await I.documentsAPI.listFiles(),t=await I.documentsAPI.getDocumentRecords(),n=Array.from(new Set((t||[]).map(e=>(e.type||"").toLowerCase()).filter(Boolean)));F(n);const a={},s=e=>(e||"").replace(/[^a-zA-Z0-9]/g,"").toLowerCase();e.forEach(e=>{if(!e||!e.filename)return;const n=s(e.filename),i=(t||[]).filter(e=>e.type&&n.includes(s(e.type)));i&&i.length&&(a[e._id]=i)});const i=e.filter(e=>{if(!e||!e.filename)return!1;if(0===n.length)return!0;const t=e.filename.replace(/[_\s]/g,"").toLowerCase();return n.some(e=>t.includes(e.replace(/[_\s]/g,"")))});P(i),U(a)}catch(e){U({})}finally{q(!1)}};(0,s.useEffect)(()=>{Le();const e=()=>je(window.innerWidth<=720);return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,s.useEffect)(()=>{if(!Pe)return;const e=Object.keys(E).find(e=>(Array.isArray(E[e])?E[e]:E[e]?[E[e]]:[]).some(e=>(e._id||e.requestId)===Pe));if(e){const t=D.find(t=>t._id===e);t&&(_(t),Oe(t).then(()=>{X(Pe),_e(Pe),W(!0)}).catch(()=>{}))}else(async()=>{try{if(I.documentsAPI.getDocumentById){const t=await I.documentsAPI.getDocumentById(Pe);if(t){J([t]),X(Pe);try{const e=t.fieldValues||{},n=Object.keys(e);if(n.length){const t="\n                    <table style=\"width:100%;border-collapse:collapse;\">\n                      <thead>\n                        <tr>\n                          <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Field</th>\n                          <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Submitted Value</th>\n                        </tr>\n                      </thead>\n                      <tbody>\n                        ".concat(n.map(t=>"<tr><td style='border:1px solid #ccc;padding:8px;'>".concat(t,"</td><td style='border:1px solid #ccc;padding:8px;'>").concat(e[t]||"","</td></tr>")).join(""),"\n                      </tbody>\n                    </table>\n                    // when we open a preview for a request that wasn't tied to a specific file in mapping,\n                    // attempt to scroll to and highlight the request's entry if present in the UI\n                    setTimeout(() => {\n                      try {\n                        const el = rowRefs.current[openRequestIdFromNav];\n                        if (el && el.scrollIntoView) {\n                          el.scrollIntoView({ behavior: 'smooth', block: 'center' });\n                          el.classList.add('cv-highlight');\n                          if (highlightTimeoutRef.current) window.clearTimeout(highlightTimeoutRef.current);\n                          // remove highlight after 2s\n                          // @ts-ignore - window.setTimeout returns number in browser\n                          highlightTimeoutRef.current = window.setTimeout(() => el.classList.remove('cv-highlight'), 2000);\n                        }\n                      } catch (e) {}\n                    }, 120);\n                  ");H(t)}else H('<div style="color:#666">No submitted field values available.</div>')}catch(e){H('<div style="color:red">Failed to build preview.</div>')}W(!0)}}}catch(e){}})();try{De(Te.pathname,{replace:!0,state:{}})}catch(t){}},[E,D]);const Oe=async e=>{W(!0),V(!0),H("");try{const t=(Re(e._id)||[]).filter(e=>"pending"===(e.status||"").toString().toLowerCase());J(t);const n=Be(e._id),a=t[0]||null,s=n&&"pending"===(n.status||"").toString().toLowerCase()?n:null;X(s?s._id||s.requestId:(null===a||void 0===a?void 0:a._id)||(null===a||void 0===a?void 0:a.requestId)||null);const i=await fetch("/api/documents/preview/".concat(e._id,"?format=html")),r=await i.text();Z(r);const l=s?s._id||s.requestId:(null===a||void 0===a?void 0:a._id)||(null===a||void 0===a?void 0:a.requestId)||null;l&&await _e(l)}catch(t){H('<div style="color:red">Failed to load preview.</div>')}V(!1)},_e=async e=>{try{const t=Object.values(E).flat().find(t=>(t._id||t.requestId)===e)||null,n=(null===t||void 0===t?void 0:t.fieldValues)||{},a=$||"",s=/\{(.*?)\}/g;let i;const r=[];for(;null!==(i=s.exec(a));)r.push(i[1].trim());if(r.length>0){const e="\n          <table style=\"width:100%;border-collapse:collapse;\">\n            <thead>\n              <tr>\n                <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Field</th>\n                <th style='border:1px solid #ccc;padding:8px;text-align:left;'>Submitted Value</th>\n              </tr>\n            </thead>\n            <tbody>\n              ".concat(r.map(e=>{const t=n[e]||"";return"<tr><td style='border:1px solid #ccc;padding:8px;'>".concat(e,"</td><td style='border:1px solid #ccc;padding:8px;'>").concat(t,"</td></tr>")}).join(""),"\n            </tbody>\n          </table>\n        ");H(e)}else H('<div style="color:red">No { ... } content found.</div>')}catch(t){H('<div style="color:red">Failed to load preview.</div>')}},ze=async e=>{_(e),await Oe(e)};return R?(0,N.jsx)("div",{style:{width:"100%",minHeight:300,display:"flex",alignItems:"center",justifyContent:"center"},children:(0,N.jsx)(r.A,{size:"large"})}):(0,N.jsxs)("div",{style:{maxWidth:2e3,margin:"12px auto",padding:"16px 24px"},children:[(0,N.jsx)(l.A.Title,{level:3,style:{marginBottom:12,marginTop:0}}),(0,N.jsx)(o.A,{title:"Document Processing",extra:(0,N.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[(0,N.jsx)(d.A,{prefix:(0,N.jsx)(j.A,{}),placeholder:"Search documents",style:{width:420},value:ve,onChange:e=>be(e.target.value),onPressEnter:()=>{}}),(0,N.jsx)(c.A,{allowClear:!0,placeholder:"Document Type",style:{width:160},value:we,onChange:e=>Se(e),children:z.map(e=>(0,N.jsx)(c.A.Option,{value:e,children:e},e))}),(0,N.jsxs)(c.A,{allowClear:!0,placeholder:"Status",style:{width:140},value:Ie,onChange:e=>Ce(e),children:[(0,N.jsx)(c.A.Option,{value:"pending",children:"Pending"}),(0,N.jsx)(c.A.Option,{value:"approved",children:"Approved"}),(0,N.jsx)(c.A.Option,{value:"rejected",children:"Rejected"})]}),(0,N.jsx)(u.A.RangePicker,{onChange:e=>Ne(e)})]}),children:Ae?(0,N.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:12},children:D.filter(e=>{if(ve&&!(e.filename||"").toLowerCase().includes(ve.toLowerCase()))return!1;if(we&&(e.type||"").toLowerCase()!==we.toLowerCase())return!1;const t=qe(e._id),n=(null===t||void 0===t?void 0:t.status)||"";if(Ie&&n.toLowerCase()!==Ie.toLowerCase())return!1;if(ke&&ke[0]&&ke[1]&&e.uploadDate){const t=new Date(e.uploadDate),n=ke[0].toDate(),a=ke[1].toDate();if(t<n||t>a)return!1}return!0}).map(e=>{const t=e.filename||"",n=(t.split(".").pop()||"").toLowerCase();let a=(0,N.jsx)(v.A,{style:{color:"#2B6CB0",fontSize:20}});"pdf"===n&&(a=(0,N.jsx)(b.A,{style:{color:"#E53E3E",fontSize:20}})),["png","jpg","jpeg","gif","svg","bmp"].includes(n)&&(a=(0,N.jsx)(w.A,{style:{color:"#319795",fontSize:20}}));const s=qe(e._id),i=(null===s||void 0===s?void 0:s.status)||"";return(0,N.jsx)(o.A,{size:"small",ref:t=>{const n=qe(e._id),a=n&&(n._id||n.requestId);a&&(ee.current[a]=t)},children:(0,N.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,N.jsxs)("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[a,(0,N.jsxs)("div",{children:[(0,N.jsx)(h.A,{title:t,children:(0,N.jsx)("div",{style:{maxWidth:220,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontWeight:600},children:t.replace(/\.docx$/i,"")})}),(0,N.jsx)("div",{style:{fontSize:12,color:"#666"},children:e.type||"Unknown"})]})]}),(0,N.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end",gap:8},children:[(0,N.jsx)(m.A,{color:"pending"===i?"orange":"approved"===i?"green":"rejected"===i?"red":"default",children:(i||"").toUpperCase()}),(0,N.jsx)("div",{style:{display:"flex",gap:8},children:(0,N.jsx)(p.Ay,{size:"small",icon:(0,N.jsx)(S.A,{}),onClick:()=>ze(e),children:"Preview"})}),(0,N.jsx)("div",{style:{fontSize:11,color:"#999"},children:e.uploadDate?(0,C.Y)(e.uploadDate):""})]})]})},e._id)})}):(0,N.jsx)(x.A,{rowKey:e=>e._id,dataSource:D.filter(e=>{if(ve&&!(e.filename||"").toLowerCase().includes(ve.toLowerCase()))return!1;if(we&&(e.type||"").toLowerCase()!==we.toLowerCase())return!1;const t=qe(e._id),n=(null===t||void 0===t?void 0:t.status)||"";if(Ie&&n.toLowerCase()!==Ie.toLowerCase())return!1;if(ke&&ke[0]&&ke[1]&&e.uploadDate){const t=new Date(e.uploadDate),n=ke[0].toDate(),a=ke[1].toDate();if(t<n||t>a)return!1}return!0}),pagination:{pageSize:10},columns:[{title:"File",dataIndex:"filename",key:"filename",sorter:(e,t)=>(e.filename||"").localeCompare(t.filename||""),render:(e,t)=>{const n=e||"",a=(n.split(".").pop()||"").toLowerCase();let s=(0,N.jsx)(v.A,{style:{color:"#2B6CB0"}});return"pdf"===a&&(s=(0,N.jsx)(b.A,{style:{color:"#E53E3E"}})),["png","jpg","jpeg","gif","svg","bmp"].includes(a)&&(s=(0,N.jsx)(w.A,{style:{color:"#319795"}})),(0,N.jsx)(h.A,{title:n,children:(0,N.jsx)("span",{style:{maxWidth:280,display:"inline-block",whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},children:(0,N.jsxs)(g.A,{align:"center",children:[s,(0,N.jsx)("span",{children:n.replace(/\.docx$/i,"")})]})})})}},{title:"Status",dataIndex:"status",key:"status",render:(e,t)=>{const n=t||{},a=n.metadata&&!0===n.metadata.online||("number"===typeof n.length?n.length>0:Boolean(n.contentType)),s=a?"ONLINE":"OFFLINE",i=a?"green":"red";return(0,N.jsx)(m.A,{color:i,children:s})}},{title:"Uploaded On",dataIndex:"uploadDate",key:"uploadDate",sorter:(e,t)=>new Date(e.uploadDate).getTime()-new Date(t.uploadDate).getTime(),render:e=>e?(0,C.Y)(e):""},{title:"Actions",key:"actions",render:(e,t)=>(0,N.jsx)(g.A,{children:(0,N.jsx)(p.Ay,{size:"small",icon:(0,N.jsx)(S.A,{}),onClick:()=>ze(t),children:"Preview"})})}],rowClassName:e=>"",onRow:e=>{const t=qe(e._id),n=t&&(t._id||t.requestId);return{ref:e=>{n&&(ee.current[n]=e)}}}})}),(0,N.jsx)(f.A,{title:O?O.filename.replace(/\.docx$/i,""):"",open:B,onCancel:()=>L(!1),footer:null,width:800,children:O?(0,N.jsx)("div",{style:{minWidth:700},children:(0,N.jsx)(x.A,{dataSource:[(0,a.A)((0,a.A)({},O),{},{requesterName:(null===(e=qe(O._id))||void 0===e?void 0:e.username)||(null===(t=qe(O._id))||void 0===t?void 0:t.requesterName)||"Unknown",barangayID:(null===(n=qe(O._id))||void 0===n?void 0:n.barangayID)||"Unknown",status:(null===(T=qe(O._id))||void 0===T?void 0:T.status)||"Unknown"})],pagination:!1,rowKey:"_id",columns:[{title:"Requester Name",dataIndex:"requesterName",key:"requesterName",render:e=>e||"Unknown"},{title:"Barangay ID",dataIndex:"barangayID",key:"barangayID",render:e=>e||"Unknown"},{title:"Status",dataIndex:"status",key:"status",render:e=>e||"Unknown"},{title:"Actions",key:"actions",render:(e,t)=>(0,N.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,N.jsx)("button",{style:{background:"#2196F3",color:"#fff",border:"none",borderRadius:6,padding:"4px 12px",cursor:"pointer",fontWeight:600},onClick:()=>Oe(t),children:"Process"}),(0,N.jsx)("button",{style:{background:"#43D96B",color:"#fff",border:"none",borderRadius:6,padding:"4px 12px",cursor:"pointer",fontWeight:600},children:"Complete"}),(0,N.jsx)("button",{style:{background:"#FF3B3B",color:"#fff",border:"none",borderRadius:6,padding:"4px 12px",cursor:"pointer",fontWeight:600},children:"Reject"})]})}]})}):(0,N.jsx)(r.A,{})}),(0,N.jsx)(f.A,{title:"Generated / Processed Copy Saved",open:xe,onCancel:()=>ge(!1),footer:[(0,N.jsx)(p.Ay,{onClick:()=>ge(!1),children:"Close"},"close")],children:(0,N.jsxs)("div",{children:[(0,N.jsx)("div",{style:{marginBottom:8},children:"A copy of the generated document was saved."}),me?(0,N.jsxs)("div",{style:{marginBottom:10},children:[(0,N.jsxs)("div",{style:{marginBottom:6},children:[(0,N.jsx)("strong",{children:"Generated metadata ID:"})," ",(0,N.jsx)("code",{children:me})]}),(0,N.jsx)("div",{children:(0,N.jsx)("a",{href:"".concat(I.API_URL.replace(/\/$/,""),"/generated-documents/").concat(me,"/raw"),target:"_blank",rel:"noreferrer",children:"Open generated copy (generated_documents)"})})]}):null,fe?(0,N.jsxs)("div",{children:[(0,N.jsxs)("div",{style:{marginBottom:6},children:[(0,N.jsx)("strong",{children:"Processed document ID:"})," ",(0,N.jsx)("code",{children:fe})]}),(0,N.jsx)("div",{children:(0,N.jsx)("a",{href:"".concat(I.API_URL.replace(/\/$/,""),"/processed-documents/").concat(fe,"/raw"),target:"_blank",rel:"noreferrer",children:"Open processed copy (processed_documents)"})})]}):null,me||fe?null:(0,N.jsx)("div",{children:"No saved copy id available."})]})}),(0,N.jsx)(f.A,{title:"Prioritize Request",open:ie,onCancel:()=>re(!1),onOk:async()=>{if(de)try{if(I.documentsAPI.prioritize)await I.documentsAPI.prioritize(de);else if(I.documentsAPI.updateDocumentStatus){var e;let t=null;for(const e of Object.values(E)){const n=(Array.isArray(e)?e:[e]).find(e=>(e._id||e.requestId)===de);if(n){t=n;break}}const n=(null===(e=t)||void 0===e?void 0:e.status)||"pending";await I.documentsAPI.updateDocumentStatus(de,{status:n,notes:"PRIORITY"})}if(re(!1),await Le(),ue)try{const e=Re(ue);let n=e.find(e=>(e._id||e.requestId)===de)||null;if(!n&&I.documentsAPI.getDocumentById)try{n=await I.documentsAPI.getDocumentById(de)}catch(t){n=null}U(n?t=>{const n=(0,a.A)({},t);return n[ue]=Array.isArray(e)?e:e?[e]:[],n}:e=>{try{const t=(0,a.A)({},e),n=t[ue],s=Array.isArray(n)?n.slice():n?[n]:[],i=s.findIndex(e=>(e._id||e.requestId)===de);return-1!==i&&(s[i]=(0,a.A)((0,a.A)({},s[i]),{},{priority:!0,notes:(s[i].notes||"")+" PRIORITY"})),t[ue]=s,t}catch(t){return e}})}catch(t){}if(O&&ue&&O._id===ue){const e=Re(ue);J(e),X(de),de&&await _e(de)}alert("Prioritization saved"),he(null)}catch(n){console.error(n),alert("Failed to prioritize")}else alert("Select a request to prioritize")},okText:"Save Priority",cancelText:"Cancel",okButtonProps:{disabled:0===le.length||!de},children:0===le.length?(0,N.jsx)("div",{children:"No other requests found for this document type."}):(0,N.jsx)(y.Ay.Group,{onChange:e=>ce(e.target.value),value:de,style:{display:"flex",flexDirection:"column",gap:8},children:le.map(e=>(0,N.jsxs)(y.Ay,{value:e.requestId||e.fileId,style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,N.jsxs)("div",{style:{display:"flex",flexDirection:"column"},children:[(0,N.jsx)("strong",{children:e.requesterName}),(0,N.jsx)("small",{style:{color:"#666"},children:e.createdAt?(0,C.Y)(e.createdAt):""})]}),(0,N.jsx)("div",{style:{marginLeft:12},children:de===(e.requestId||e.fileId)?(0,N.jsx)(m.A,{color:"red",children:"Selected"}):null})]},e.requestId||e.fileId))})}),(0,N.jsx)(f.A,{title:O?"Preview: ".concat(O.filename.replace(/\.docx$/i,"")):"Preview",open:M,onCancel:()=>W(!1),footer:null,width:900,children:G?(0,N.jsx)(r.A,{}):(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("div",{style:{minHeight:300},dangerouslySetInnerHTML:{__html:Y}}),(0,N.jsxs)("div",{style:{marginTop:12,padding:8,border:"1px solid #eee",borderRadius:6},children:[(0,N.jsx)("div",{style:{marginBottom:8,fontWeight:600},children:"Select Request to Preview"}),(0,N.jsx)("div",{style:{maxHeight:300,overflowY:"auto",paddingRight:6},children:(0,N.jsx)(y.Ay.Group,{value:Q,onChange:async e=>{const t=e.target.value;X(t),await _e(t)},style:{display:"flex",flexDirection:"column",gap:8},children:K&&K.length?K.map(e=>(0,N.jsx)(y.Ay,{value:e._id||e.requestId,children:(0,N.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",width:"100%"},children:[(0,N.jsxs)("div",{children:[(0,N.jsx)("div",{style:{fontWeight:600},children:e.username||e.requesterName||"Unknown"}),(0,N.jsx)("div",{style:{fontSize:12,color:"#666"},children:e.createdAt?(0,C.Y)(e.createdAt):""})]}),(0,N.jsx)("div",{style:{alignSelf:"center"},children:e.notes&&e.notes.toString().toLowerCase().includes("priority")||e.priority?(0,N.jsx)(m.A,{color:"red",children:"PRIORITY"}):null})]})},e._id||e.requestId)):(0,N.jsx)("div",{style:{color:"#666"},children:"No pending requests available for this file."})})})]}),(0,N.jsx)("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:16,gap:12},children:(0,N.jsx)("button",{style:{background:"#43D96B",color:"#fff",border:"none",borderRadius:6,padding:"8px 24px",cursor:"pointer",fontWeight:600},onClick:async()=>{if(O){try{var e;let s=null;if(Q){s=Re(O._id).find(e=>(e._id||e.requestId)===Q)||null}if(s||(s=Be(O._id)||qe(O._id)),!s||!s.fieldValues)return void alert("No document request or field values found for this file.");const i=await async function(e,t,n){const a={fieldValues:t};n&&(a.requestId=n);const s=await k.A.post("/api/documents/".concat(e,"/generate-filled"),a,{responseType:"blob"}),i=s.headers["content-disposition"]||s.headers["Content-Disposition"];let r="";if(i){const e=i.match(/filename\*=(?:UTF-8'')?([^;\n\r]+)/i),t=i.match(/filename="?([^";]+)"?/i);if(e&&e[1])try{r=decodeURIComponent(e[1].replace(/^UTF-8''/,""))}catch(m){r=e[1]}else t&&t[1]&&(r=t[1])}const l=s.headers["x-filled-file-id"]||s.headers["X-Filled-File-Id"]||null,o=s.headers["x-processed-gridfs-id"]||s.headers["X-Processed-GridFS-Id"]||null,d=o||l,c=s.headers["x-generated-doc-id"]||s.headers["X-Generated-Doc-Id"]||null,u=s.headers["x-processed-doc-id"]||s.headers["X-Processed-Doc-Id"]||null,h=s.headers["x-transaction-code"]||s.headers["X-Transaction-Code"]||null;return console.log("[generateFilledDocx] transactionCode=",h,"content-disposition filename=",r),{blob:s.data,filename:r,savedId:d,generatedCopyId:c,processedDocId:u,processedGridFsId:o,transactionCode:h}}(O._id,s.fieldValues,s._id||s.requestId),r=i.blob,l=s&&(s.transactionCode||s.transactionId||s.txId||s.transaction_id||s._id||s.requestId)||i.transactionCode||i.generatedCopyId||i.processedDocId||null,o=l?String(l).replace(/[^a-zA-Z0-9-_.]/g,"_"):null,d=i.transactionCode||s&&s.transactionCode||o||null,c=d?"".concat(String(d).replace(/[^a-zA-Z0-9-_.]/g,"_"),".docx"):i.filename||"filled_".concat(O.filename||"document",".docx"),u=window.URL.createObjectURL(new Blob([r],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"})),h=document.createElement("a");h.href=u,h.setAttribute("download",c),document.body.appendChild(h),h.click(),null===(e=h.parentNode)||void 0===e||e.removeChild(h),window.URL.revokeObjectURL(u);if(i.savedId||null){await Le();const e=i.processedDocId||null;e?(A.Ay.open({message:"Generated copy saved",description:(0,N.jsxs)("div",{children:["Saved to processed documents. ",(0,N.jsx)("a",{href:"".concat(I.API_URL.replace(/\/$/,""),"/processed-documents/").concat(e,"/raw"),target:"_blank",rel:"noreferrer",children:"Open processed copy"})]}),duration:8}),ye(e),ge(!0)):A.Ay.open({message:"Generated document saved",description:"Saved to server processed documents.",duration:6}),i.generatedCopyId&&(pe(i.generatedCopyId),ge(!0))}else try{const e=new FormData;e.append("file",new Blob([r],{type:"application/vnd.openxmlformats-officedocument.wordprocessingml.document"}),c),e.append("sourceTemplateId",O._id||""),e.append("requestId",s._id||s.requestId||"");const n=I.API_URL.replace(/\/$/,"");let a=!1;const l=["".concat(n,"/processed-documents/upload"),"".concat(n,"/documents/upload-inline"),"".concat(n,"/documents/upload"),"".concat(n,"/documents"),"".concat(n,"/admin/documents/upload")];for(const s of l)try{if((await fetch(s,{method:"POST",body:e,credentials:"include"})).ok){a=!0;break}}catch(t){}if(a){await Le();const e=i.processedDocId||null;e?(A.Ay.open({message:"Generated copy saved",description:(0,N.jsxs)("div",{children:["Saved to processed documents. ",(0,N.jsx)("a",{href:"".concat(I.API_URL.replace(/\/$/,""),"/processed-documents/").concat(e,"/raw"),target:"_blank",rel:"noreferrer",children:"Open processed copy"})]}),duration:8}),ye(e),ge(!0)):A.Ay.open({message:"Generated document uploaded",description:"Uploaded to server processed documents.",duration:6})}else console.warn("Upload fallback failed; generated file was downloaded but not uploaded to documents collection."),alert("Generated document downloaded. Server-side save not confirmed.")}catch(n){console.error("Upload fallback error",n),alert("Generated document downloaded but upload to server failed.")}try{let e=Q;if(!e){const t=Be(O._id)||qe(O._id);e=t&&(t._id||t.requestId)||null}e&&(I.documentsAPI.updateDocumentStatus?await I.documentsAPI.updateDocumentStatus(e,{status:"approved"}):await fetch("/api/document-requests/".concat(e,"/process"),{method:"PATCH"}),await Le(),W(!1),alert("Request marked as completed."))}catch(a){console.warn("Failed to mark request complete after generation",(null===a||void 0===a?void 0:a.message)||a)}}catch(s){console.error("Generation error",s),alert("Failed to generate filled document.")}W(!1)}},children:"Generate"})})]})})]})}}}]);
//# sourceMappingURL=351.b7265d0d.chunk.js.map